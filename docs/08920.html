<html>
<head>
<title>Coverlet MSBuild Integration -Merging reports</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Coverlet MSBuild集成-合并报表</h1>
<blockquote>原文：<a href="https://medium.com/codex/coverlet-msbuild-integration-merging-reports-dae2dd1ca55c?source=collection_archive---------7-----------------------#2022-09-12">https://medium.com/codex/coverlet-msbuild-integration-merging-reports-dae2dd1ca55c?source=collection_archive---------7-----------------------#2022-09-12</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><blockquote class="if ig ih"><p id="f79d" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated">Coverlet是一个跨平台的代码覆盖框架。NET，支持行、分支和方法覆盖。它适用于。在Windows和。所有支持平台上的NET Core。</p></blockquote><h2 id="6b5b" class="jh ji hi bd jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke bi translated">关于代码覆盖率的一些话</h2><p id="f65c" class="pw-post-body-paragraph ii ij hi il b im kf io ip iq kg is it js kh iw ix jw ki ja jb ka kj je jf jg hb bi translated">代码覆盖率是一个软件质量度量，显示了当你的测试运行时有多少代码被执行。代码覆盖并不谈论测试的质量，但是它确实给了我们一些关于测试的理解。例如，当我们的方法有许多分支(条件语句)时，度量向我们显示了测试中使用了多少分支。代码覆盖不仅仅关注单元测试，而是所有类型的测试(甚至是手工测试)。任何涉及到运行代码的事情都是获得代码覆盖度量的有效方法。</p><p id="04e7" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it js iv iw ix jw iz ja jb ka jd je jf jg hb bi translated">有许多工具可以为我们的单元/集成测试获取代码覆盖度量；我会关注床罩。</p><p id="a1d8" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it js iv iw ix jw iz ja jb ka jd je jf jg hb bi translated"><strong class="il hj">床罩可以通过三种不同的<em class="ik">驱动:</em> </strong></p><ul class=""><li id="48f1" class="kk kl hi il b im in iq ir js km jw kn ka ko jg kp kq kr ks bi translated">VSTest引擎集成</li><li id="583a" class="kk kl hi il b im kt iq ku js kv jw kw ka kx jg kp kq kr ks bi translated">MSBuild任务集成</li><li id="8029" class="kk kl hi il b im kt iq ku js kv jw kw ka kx jg kp kq kr ks bi translated">作为. NET全局工具(支持独立集成测试)</li></ul><blockquote class="if ig ih"><p id="1d32" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated">目前，VSTest集成并不支持msbuild和。NET工具，例如在控制台上显示结果，报告合并和阈值验证。我们正在努力填补空白。(来自coverlet github)</p></blockquote><h2 id="1f36" class="jh ji hi bd jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke bi translated">MSBuild集成:</h2><p id="29c9" class="pw-post-body-paragraph ii ij hi il b im kf io ip iq kg is it js kh iw ix jw ki ja jb ka kj je jf jg hb bi translated">我创建了两个类库:<em class="ik"> MathFunctions.csproj，SimpleArithmetics.csproj. </em>此外，我还创建了两个测试项目，每个项目都引用了它测试的一个类库:<em class="ik"> MathFunctionsTests.csproj，simple arithmetics . csproj .</em></p><figure class="kz la lb lc fd ld er es paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="er es ky"><img src="../Images/4f384077e580c16427cb6ffa2b778257.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-vTMqTu8ZsGwhk5ECf1WfQ.png"/></div></div></figure><p id="b142" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it js iv iw ix jw iz ja jb ka jd je jf jg hb bi translated">在每个测试项目上安装coverlet包:</p><pre class="kz la lb lc fd lk ll lm ln aw lo bi"><span id="3fda" class="jh ji hi ll b fi lp lq l lr ls">dotnet add package coverlet.msbuild</span></pre><p id="a046" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it js iv iw ix jw iz ja jb ka jd je jf jg hb bi translated">Csproj文件应包含以下内容:</p><pre class="kz la lb lc fd lk ll lm ln aw lo bi"><span id="46a9" class="jh ji hi ll b fi lp lq l lr ls">&lt;ItemGroup&gt;<br/>&lt;PackageReference Include="<strong class="ll hj">coverlet.msbuild</strong>" Version="3.1.2"&gt;<br/>&lt;PrivateAssets&gt;all&lt;/PrivateAssets&gt;<br/>&lt;IncludeAssets&gt;runtime; build; native; contentfiles; analyzers; buildtransitive&lt;/IncludeAssets&gt;<br/>&lt;/PackageReference&gt;<br/>&lt;PackageReference Include="<strong class="ll hj">Microsoft.NET.Test.Sdk</strong>" Version="16.5.0" /&gt;<br/>&lt;PackageReference Include="MSTest.TestAdapter" Version="2.1.0" /&gt;&lt;PackageReference Include="MSTest.TestFramework" Version="2.1.0" /&gt;&lt;/ItemGroup&gt;</span></pre><p id="020e" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it js iv iw ix jw iz ja jb ka jd je jf jg hb bi translated">从sln位置运行以下命令:</p><pre class="kz la lb lc fd lk ll lm ln aw lo bi"><span id="7e67" class="jh ji hi ll b fi lp lq l lr ls">dotnet test SimpleArithmeticsTests\SimpleArithmeticsTests.csproj /p:CollectCoverage=true  /p:CoverletOutput=../CoverageResults/</span><span id="f199" class="jh ji hi ll b fi lt lq l lr ls">dotnet test MathFunctionsTests\MathFunctionsTests.csproj /p:CollectCoverage=true /p:CoverletOutput=../CoverageResults/ /p:MergeWith="../CoverageResults/coverage.json"</span></pre><figure class="kz la lb lc fd ld er es paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="er es lu"><img src="../Images/16ba326baa8f4fb5af92b6d2f026fef6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iExnEcbtNYyjNla5GbDt9Q.png"/></div></div></figure><p id="c2d3" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it js iv iw ix jw iz ja jb ka jd je jf jg hb bi translated">这将创建一个包含代码覆盖率报告的coverage.json文件，该报告结合了两个测试项目的执行。</p><p id="4281" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it js iv iw ix jw iz ja jb ka jd je jf jg hb bi translated">也可以用单个命令运行dotnet test和merge，生成像cobertura一样的有效格式，但是需要保证测试会顺序运行(<code class="du lv lw lx ll b">-m:1</code>)。这减慢了测试，但是避免了无效的覆盖结果:</p><pre class="kz la lb lc fd lk ll lm ln aw lo bi"><span id="9ddf" class="jh ji hi ll b fi lp lq l lr ls">dotnet test /p:CollectCoverage=true /p:CoverletOutput=../CoverageResults/ /p:MergeWith=”../CoverageResults/coverage.json” /p:CoverletOutputFormat=”cobertura” -m:1</span></pre><p id="b6b0" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it js iv iw ix jw iz ja jb ka jd je jf jg hb bi translated">该命令将创建一个coverage.cobertura.xml文件，该文件包含结合了两个测试项目执行的代码覆盖率报告。</p><p id="263b" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it js iv iw ix jw iz ja jb ka jd je jf jg hb bi translated">如果你在<strong class="il hj"> azure devops </strong>上运行你的测试，我推荐使用cobertura作为<em class="ik">coveretoutputformat。</em> Azure DevOps为我们提供了显示以cobertura格式生成的应用程序单元测试的代码覆盖率概览的能力。</p></div></div>    
</body>
</html>