<html>
<head>
<title>Use TypeScript to Synchronize Django REST Framework and Vue.js: Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用TypeScript同步Django REST框架和Vue.js:第2部分</h1>
<blockquote>原文：<a href="https://medium.com/codex/use-typescript-to-synchronize-django-rest-framework-and-vue-js-a2af07aabf89?source=collection_archive---------12-----------------------#2021-01-06">https://medium.com/codex/use-typescript-to-synchronize-django-rest-framework-and-vue-js-a2af07aabf89?source=collection_archive---------12-----------------------#2021-01-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/8f17eb64c8a94931b7a9b370979a106d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*pAWYIPrHvD9U-0t5"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">由<a class="ae iu" href="https://unsplash.com/@steve3p_0?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">史蒂夫·哈拉马</a>在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><h1 id="b90e" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">第2部分:消费元数据</h1><p id="0a5f" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">请参见<a class="ae iu" rel="noopener" href="/@johnfraney/use-typescript-to-synchronize-django-rest-framework-and-vue-js-d103cf416e23"> <em class="kr">第一部分:生成API元数据</em> </a>以跟上进度。这篇文章使用了通过文章中描述的步骤生成的<code class="du ks kt ku kv b">User.json</code>元数据。</p></div><div class="ab cl kw kx gp ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="hb hc hd he hf"><h2 id="c66c" class="ld iw hi bd ix le lf lg jb lh li lj jf ke lk ll jj ki lm ln jn km lo lp jr lq bi translated">(非)结构化数据</h2><p id="4e98" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">在客户端代码中使用API元数据的想法并不是革命性的。<a class="ae iu" href="https://github.com/Azure/AutoRest" rel="noopener ugc nofollow" target="_blank"> AutoRest </a>使用<a class="ae iu" href="https://swagger.io/resources/open-api/" rel="noopener ugc nofollow" target="_blank"> OpenAPI </a>模式为多种语言生成代码，Django REST框架的文档建议使用元数据来启动客户端库:</p><blockquote class="lr ls lt"><p id="9e01" class="jt ju kr jv b jw lu jy jz ka lv kc kd lw lx kg kh ly lz kk kl ma mb ko kp kq hb bi translated">API模式是一个有用的工具，它允许一系列用例，包括生成参考文档，或者驱动可以与API交互的动态客户端库。<br/>-<a class="ae iu" href="https://www.django-rest-framework.org/api-guide/schemas/#generating-an-openapi-schema" rel="noopener ugc nofollow" target="_blank">https://www.django-rest-framework.org/api-guide/schemas/</a></p></blockquote><p id="a859" class="pw-post-body-paragraph jt ju hi jv b jw lu jy jz ka lv kc kd ke lx kg kh ki lz kk kl km mb ko kp kq hb bi translated">本系列文章的第一部分介绍了如何生成在JavaScript/TypeScript客户机中使用的元数据，而本文兑现了这一承诺，并在<a class="ae iu" href="https://vuejs.org/" rel="noopener ugc nofollow" target="_blank"> Vue </a>前端中使用用户元数据。</p><p id="ea2b" class="pw-post-body-paragraph jt ju hi jv b jw lu jy jz ka lv kc kd ke lx kg kh ki lz kk kl km mb ko kp kq hb bi translated">怎么会？有很多方法可以使用API元数据来驱动前端，比如:</p><ul class=""><li id="8c7f" class="mc md hi jv b jw lu ka lv ke me ki mf km mg kq mh mi mj mk bi translated">生成常数</li><li id="de9c" class="mc md hi jv b jw ml ka mm ke mn ki mo km mp kq mh mi mj mk bi translated">创建类型安全的窗体</li><li id="b5b6" class="mc md hi jv b jw ml ka mm ke mn ki mo km mp kq mh mi mj mk bi translated">自动表单生成</li><li id="4c5d" class="mc md hi jv b jw ml ka mm ke mn ki mo km mp kq mh mi mj mk bi translated">数据类生成</li></ul><p id="4de8" class="pw-post-body-paragraph jt ju hi jv b jw lu jy jz ka lv kc kd ke lx kg kh ki lz kk kl km mb ko kp kq hb bi translated">这篇博文将涉及类型安全和(大部分)自动生成的表单。</p><h2 id="5e30" class="ld iw hi bd ix le lf lg jb lh li lj jf ke lk ll jj ki lm ln jn km lo lp jr lq bi translated">来自JSON元数据的类型安全表单</h2><p id="23bd" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">下面是一个简单的Vue组件，包含一个创建新用户的表单:</p><pre class="mq mr ms mt fd mu kv mv mw aw mx bi"><span id="d63b" class="ld iw hi kv b fi my mz l na nb">&lt;template&gt;<br/>  &lt;div id="app"&gt;<br/>    &lt;h1&gt;User Form&lt;/h1&gt;<br/>    &lt;form <a class="ae iu" href="http://twitter.com/submit" rel="noopener ugc nofollow" target="_blank">@submit</a>.prevent="onSubmit"&gt;<br/>      &lt;label&gt;First name&lt;/label&gt;<br/>      &lt;input<br/>        v-model="form.firstName"<br/>      &gt;</span><span id="8f09" class="ld iw hi kv b fi nc mz l na nb">      &lt;label&gt;Last name&lt;/label&gt;<br/>      &lt;input<br/>        v-model="form.lastName"<br/>      &gt;</span><span id="5448" class="ld iw hi kv b fi nc mz l na nb">      &lt;label&gt;Email address&lt;/label&gt;<br/>      &lt;input<br/>        v-model="form.firstName"<br/>      &gt;</span><span id="44f8" class="ld iw hi kv b fi nc mz l na nb">      &lt;label&gt;Username&lt;/label&gt;<br/>      &lt;input<br/>        v-model="form.username"<br/>      &gt;</span><span id="777e" class="ld iw hi kv b fi nc mz l na nb">      &lt;button type="submit"&gt;Submit&lt;/button&gt;<br/>    &lt;/form&gt;<br/>  &lt;/div&gt;<br/>&lt;/template&gt;<br/>&lt;script lang="ts"&gt;<br/>import Vue from 'vue';</span><span id="f13b" class="ld iw hi kv b fi nc mz l na nb">export default Vue.extend({<br/>  name: 'App',</span><span id="c1cc" class="ld iw hi kv b fi nc mz l na nb">  data() {<br/>    return {<br/>      form: {},<br/>    }<br/>  },<br/><br/>  methods: {<br/>    onSubmit() {<br/>      // Pretend a user is created<br/>    },<br/>  },<br/>});<br/>&lt;/script&gt;</span></pre><p id="0f59" class="pw-post-body-paragraph jt ju hi jv b jw lu jy jz ka lv kc kd ke lx kg kh ki lz kk kl km mb ko kp kq hb bi translated">注意到表格有什么问题吗？</p><p id="c57a" class="pw-post-body-paragraph jt ju hi jv b jw lu jy jz ka lv kc kd ke lx kg kh ki lz kk kl km mb ko kp kq hb bi translated">去吧，好好看看。</p><figure class="mq mr ms mt fd ij"><div class="bz dy l di"><div class="nd ne l"/></div></figure><p id="f125" class="pw-post-body-paragraph jt ju hi jv b jw lu jy jz ka lv kc kd ke lx kg kh ki lz kk kl km mb ko kp kq hb bi translated">首先，它看起来像一个标准的形式，当然。然而，你看得越多，你就越会意识到它是多么的简单。整体和局部都不起眼。它是如此之少，以至于很可能被认为是无可非议的。毕竟，这种形式并没有什么错，真的——但是它并没有什么不对。尽管Vue认为上述表单的类型是正确的，但是我们可以添加一些有用的与类型相关的改进:</p><ul class=""><li id="ffb4" class="mc md hi jv b jw lu ka lv ke me ki mf km mg kq mh mi mj mk bi translated">必填字段</li><li id="10a1" class="mc md hi jv b jw ml ka mm ke mn ki mo km mp kq mh mi mj mk bi translated">键入的输入(如<code class="du ks kt ku kv b">input="email"</code></li><li id="230d" class="mc md hi jv b jw ml ka mm ke mn ki mo km mp kq mh mi mj mk bi translated">键入的表单对象</li></ul><p id="c810" class="pw-post-body-paragraph jt ju hi jv b jw lu jy jz ka lv kc kd ke lx kg kh ki lz kk kl km mb ko kp kq hb bi translated">输入用户元数据。</p><p id="38d8" class="pw-post-body-paragraph jt ju hi jv b jw lu jy jz ka lv kc kd ke lx kg kh ki lz kk kl km mb ko kp kq hb bi translated">有许多方法可以使用<code class="du ks kt ku kv b"><a class="ae iu" href="https://gist.githubusercontent.com/johnfraney/d8fe9868948fdf7bdc599ff0a9c5cbcf/raw/5a32bd7c68e6eda0883241a1947b3d7d6e48c575/user_options.json" rel="noopener ugc nofollow" target="_blank">User.json</a></code>中指定的元数据(在本系列的<a class="ae iu" rel="noopener" href="/nepfin-engineering/use-typescript-to-synchronize-django-rest-framework-and-vue-js-d103cf416e23">第一部分中有详细描述)来改进这种形式。</a></p><p id="efe5" class="pw-post-body-paragraph jt ju hi jv b jw lu jy jz ka lv kc kd ke lx kg kh ki lz kk kl km mb ko kp kq hb bi translated">看看这个类型化的表单，然后我们来看看每种元数据的用法是如何改进上面的非类型化表单的:</p><pre class="mq mr ms mt fd mu kv mv mw aw mx bi"><span id="440e" class="ld iw hi kv b fi my mz l na nb">&lt;template&gt;<br/>  &lt;div id="app"&gt;<br/>    &lt;h1&gt;User Form&lt;/h1&gt;<br/>    &lt;form <a class="ae iu" href="http://twitter.com/submit" rel="noopener ugc nofollow" target="_blank">@submit</a>.prevent="onSubmit"&gt;<br/>      &lt;div&gt;<br/>        &lt;label v-text="userMetadata.first_name.label" /&gt;<br/>        &lt;input<br/>          v-model="form[userMetadata.first_name.field_name]"<br/>          :maxlength="userMetadata.first_name.max_length"<br/>          :name="userMetadata.first_name.field_name"<br/>          :required="userMetadata.first_name.required"<br/>        &gt;<br/>      &lt;/div&gt;<br/>      &lt;div&gt;<br/>        &lt;label v-text="userMetadata.last_name.label" /&gt;<br/>        &lt;input<br/>          v-model="form[userMetadata.last_name.field_name]"<br/>          :maxlength="userMetadata.last_name.max_length"<br/>          :name="userMetadata.last_name.field_name"<br/>          :required="userMetadata.last_name.required"<br/>        &gt;<br/>      &lt;/div&gt;<br/>      &lt;div&gt;<br/>        &lt;label v-text="userMetadata.email.label" /&gt;<br/>        &lt;input<br/>          v-model="form[userMetadata.email.field_name]"<br/>          :maxlength="userMetadata.email.max_length"<br/>          :name="userMetadata.email.field_name"<br/>          :required="userMetadata.email.required"<br/>          :type="userMetadata.email.format"<br/>        &gt;<br/>      &lt;/div&gt;<br/>      &lt;div&gt;<br/>        &lt;label v-text="userMetadata.username.label" /&gt;<br/>        &lt;input<br/>          v-model="form[userMetadata.username.field_name]"<br/>          :maxlength="userMetadata.username.max_length"<br/>          :name="userMetadata.username.field_name"<br/>          :required="userMetadata.username.required"<br/>        &gt;<br/>      &lt;/div&gt;<br/>      &lt;button type="submit"&gt;Submit&lt;/button&gt;<br/>    &lt;/form&gt;<br/>    &lt;pre v-text="userMetadata" /&gt;<br/>  &lt;/div&gt;<br/>&lt;/template&gt;</span><span id="7f89" class="ld iw hi kv b fi nc mz l na nb">&lt;script lang="ts"&gt;<br/>import Vue from 'vue'</span><span id="6318" class="ld iw hi kv b fi nc mz l na nb">import User from  './metadata/User.json'</span><span id="a2bc" class="ld iw hi kv b fi nc mz l na nb">export default Vue.extend({<br/>  name: 'App',</span><span id="d410" class="ld iw hi kv b fi nc mz l na nb">  data() {<br/>    return {<br/>      form: {},<br/>      userMetadata: User,<br/>    }<br/>  },</span><span id="11eb" class="ld iw hi kv b fi nc mz l na nb">  methods: {<br/>    onSubmit() {<br/>      // Pretend a user is created<br/>    },<br/>  },<br/>})<br/>&lt;/script&gt;</span></pre><p id="fc7d" class="pw-post-body-paragraph jt ju hi jv b jw lu jy jz ka lv kc kd ke lx kg kh ki lz kk kl km mb ko kp kq hb bi translated">这里的大多数更改都在模板中。在组件本身中，唯一的变化是<code class="du ks kt ku kv b">userMetadata</code>，它是从<code class="du ks kt ku kv b">User.json</code>创建的类型化对象。(这样使用JSON文件，确保你的<code class="du ks kt ku kv b"><a class="ae iu" href="https://www.staging-typescript.org/tsconfig#resolveJsonModule" rel="noopener ugc nofollow" target="_blank">tsconfig.json</a></code> <a class="ae iu" href="https://www.staging-typescript.org/tsconfig#resolveJsonModule" rel="noopener ugc nofollow" target="_blank">有</a> <code class="du ks kt ku kv b"><a class="ae iu" href="https://www.staging-typescript.org/tsconfig#resolveJsonModule" rel="noopener ugc nofollow" target="_blank">resolveJSONModule: true</a></code>。)</p><p id="b40e" class="pw-post-body-paragraph jt ju hi jv b jw lu jy jz ka lv kc kd ke lx kg kh ki lz kk kl km mb ko kp kq hb bi translated">模板包括这些更改，所有这些更改都有助于表单反映后端用户模型:</p><ul class=""><li id="f4a8" class="mc md hi jv b jw lu ka lv ke me ki mf km mg kq mh mi mj mk bi translated"><code class="du ks kt ku kv b">&lt;label v-text&gt;</code>:表单标签不是手工指定的，而是从用户元数据中提取的。</li><li id="1e93" class="mc md hi jv b jw ml ka mm ke mn ki mo km mp kq mh mi mj mk bi translated"><code class="du ks kt ku kv b">&lt;input v-model&gt;</code>:我们可以保证用户表单的键与数据库字段名相同，例如<code class="du ks kt ku kv b">form[userMetadata.first_name.field_name]</code>，而不是像<code class="du ks kt ku kv b">form.firtsName</code>那样在模板中编写属性访问器。哦，你注意到那个属性访问器中的<code class="du ks kt ku kv b">fristName</code>错别字了吗？将元数据用于字段名更能防止输入错误。</li><li id="2575" class="mc md hi jv b jw ml ka mm ke mn ki mo km mp kq mh mi mj mk bi translated"><code class="du ks kt ku kv b">&lt;input type&gt;</code> : API元数据可以指定每个字段应该使用哪种类型的输入，比如<code class="du ks kt ku kv b">email</code>或<code class="du ks kt ku kv b">number</code>。这有助于防止验证错误。</li><li id="c82d" class="mc md hi jv b jw ml ka mm ke mn ki mo km mp kq mh mi mj mk bi translated">输入验证属性(<code class="du ks kt ku kv b">required</code>，<code class="du ks kt ku kv b">maxlength</code>):说到防止验证错误，对使用字段的数据库级约束反映在JSON元数据中，我们可以在<code class="du ks kt ku kv b">&lt;input&gt;</code>元素中直接使用。<code class="du ks kt ku kv b">User.json</code>甚至包括<code class="du ks kt ku kv b">pattern</code>，因此您可以在您的客户端表单中重用服务器上定义的正则表达式。这是一个很好的胜利，因为<a class="ae iu" href="https://johnfraney.ca/posts/2019/03/24/human-readable-python-regular-expressions/" rel="noopener ugc nofollow" target="_blank">编写和维护正则表达式不是用户友好的</a>。</li><li id="35d5" class="mc md hi jv b jw ml ka mm ke mn ki mo km mp kq mh mi mj mk bi translated"><code class="du ks kt ku kv b">&lt;input name&gt;</code>:这是一个小的变化，但是它使得在单元测试中选择特定的输入变得容易。</li></ul><p id="58bc" class="pw-post-body-paragraph jt ju hi jv b jw lu jy jz ka lv kc kd ke lx kg kh ki lz kk kl km mb ko kp kq hb bi translated">既然我们已经有了一份打印好的表格，为什么不更进一步呢？因为我们的元数据告诉我们这么多关于API端点的期望，我们能使用这些数据自动生成表单吗？</p><p id="4f37" class="pw-post-body-paragraph jt ju hi jv b jw lu jy jz ka lv kc kd ke lx kg kh ki lz kk kl km mb ko kp kq hb bi translated">亲爱的读者，我们可以。</p><h2 id="7f35" class="ld iw hi bd ix le lf lg jb lh li lj jf ke lk ll jj ki lm ln jn km lo lp jr lq bi translated">从JSON元数据自动生成的表单</h2><p id="1574" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">这就是健壮元数据真正闪光的地方。通过一些调整，我们可以利用我们的元数据作为一个小的、可维护的模板的全类型组件的基础。</p><p id="05a5" class="pw-post-body-paragraph jt ju hi jv b jw lu jy jz ka lv kc kd ke lx kg kh ki lz kk kl km mb ko kp kq hb bi translated">看一看:</p><pre class="mq mr ms mt fd mu kv mv mw aw mx bi"><span id="fabe" class="ld iw hi kv b fi my mz l na nb">&lt;template&gt;<br/>  &lt;div id="app"&gt;<br/>    &lt;h1&gt;User Form&lt;/h1&gt;<br/>    &lt;form <a class="ae iu" href="http://twitter.com/submit" rel="noopener ugc nofollow" target="_blank">@submit</a>.prevent="onSubmit"&gt;<br/>      &lt;div v-for="(inputData, inputName) in fields" :key="inputName"&gt;<br/>        &lt;label v-text="inputData.label" /&gt;<br/>        &lt;input<br/>          v-model="form[inputName]"<br/>          v-bind="inputData.inputAttributes"<br/>        &gt;<br/>      &lt;/div&gt;<br/>      &lt;button type="submit"&gt;Submit&lt;/button&gt;<br/>    &lt;/form&gt;<br/>  &lt;/div&gt;<br/>&lt;/template&gt;</span><span id="5d26" class="ld iw hi kv b fi nc mz l na nb">&lt;script lang="ts"&gt;<br/>import Vue from 'vue';</span><span id="dcc1" class="ld iw hi kv b fi nc mz l na nb">import User from  './metadata/User.json'</span><span id="5edd" class="ld iw hi kv b fi nc mz l na nb">type UserForm = {<br/>  [UserField in keyof typeof User]?: typeof User[UserField]["initial"]<br/>}</span><span id="5725" class="ld iw hi kv b fi nc mz l na nb">interface InputAttributes {<br/>  [key: string]: boolean | number | string<br/>}</span><span id="39ad" class="ld iw hi kv b fi nc mz l na nb">interface InputData {<br/>  inputAttributes: InputAttributes<br/>  label: string<br/>}</span><span id="6ff4" class="ld iw hi kv b fi nc mz l na nb">function convertFieldMetadataToInputData(fieldMetadata: typeof User[keyof typeof User]): InputData {<br/>  const label = fieldMetadata.label<br/>  const inputAttributes: InputAttributes = {<br/>    name: fieldMetadata.field_name,<br/>    required: fieldMetadata.required,<br/>    type: fieldMetadata.type,<br/>  }<br/>  // Add non-universal properties<br/>  if ('max_length' in fieldMetadata) {<br/>    inputAttributes.maxlength = fieldMetadata.max_length<br/>  }<br/>  if ('pattern' in fieldMetadata) {<br/>    inputAttributes.maxlength = fieldMetadata.pattern<br/>  }<br/>  return {<br/>    inputAttributes,<br/>    label,<br/>  }<br/>}</span><span id="40b5" class="ld iw hi kv b fi nc mz l na nb">export default Vue.extend({<br/>  name: 'App',</span><span id="c8b1" class="ld iw hi kv b fi nc mz l na nb">  data() {<br/>    return {<br/>      fields: {<br/>        [User.first_name.field_name]: convertFieldMetadataToInputData(User.first_name),<br/>        [User.last_name.field_name]: convertFieldMetadataToInputData(User.last_name),<br/>        [User.email.field_name]: convertFieldMetadataToInputData(User.email),<br/>        [User.username.field_name]: convertFieldMetadataToInputData(User.username),<br/>      },<br/>      form: {},<br/>    }<br/>  },</span><span id="1b68" class="ld iw hi kv b fi nc mz l na nb">methods: {<br/>    onSubmit() {<br/>      // Pretend a user is created<br/>    },<br/>  },<br/>});<br/>&lt;/script&gt;</span></pre><p id="e1b6" class="pw-post-body-paragraph jt ju hi jv b jw lu jy jz ka lv kc kd ke lx kg kh ki lz kk kl km mb ko kp kq hb bi translated">尽管这个组件比前一个组件多了几行，但是这个组件中的大部分逻辑都可以删除，并在应用程序的每个表单中共享。</p><p id="d890" class="pw-post-body-paragraph jt ju hi jv b jw lu jy jz ka lv kc kd ke lx kg kh ki lz kk kl km mb ko kp kq hb bi translated">组件中发生了相当多的新变化，所以让我们来看看重要的变化。</p><p id="36b4" class="pw-post-body-paragraph jt ju hi jv b jw lu jy jz ka lv kc kd ke lx kg kh ki lz kk kl km mb ko kp kq hb bi translated">一、形体:</p><pre class="mq mr ms mt fd mu kv mv mw aw mx bi"><span id="3a6c" class="ld iw hi kv b fi my mz l na nb">&lt;div v-for="(inputData, inputName) in fields" :key="inputName"&gt;<br/>  &lt;label v-text="inputData.label" /&gt;<br/>  &lt;input<br/>    v-model="form[inputName]"<br/>    v-bind="inputData.inputAttributes"<br/>  &gt;<br/>&lt;/div&gt;</span></pre><p id="5b1a" class="pw-post-body-paragraph jt ju hi jv b jw lu jy jz ka lv kc kd ke lx kg kh ki lz kk kl km mb ko kp kq hb bi translated">就这样吗？你打赌。我们不需要指定每个字段，只需在组件中做一点工作，就可以遍历<code class="du ks kt ku kv b">fields</code>。</p><p id="c520" class="pw-post-body-paragraph jt ju hi jv b jw lu jy jz ka lv kc kd ke lx kg kh ki lz kk kl km mb ko kp kq hb bi translated">(我应该注意，这个实现只适用于all- <code class="du ks kt ku kv b">&lt;input&gt;</code>表单。如果您的表单包含<code class="du ks kt ku kv b">&lt;select&gt;</code>元素、复选框或单选按钮，您可能需要创建一个单独的组件来输出正确的表单域元素。)</p><p id="e3c1" class="pw-post-body-paragraph jt ju hi jv b jw lu jy jz ka lv kc kd ke lx kg kh ki lz kk kl km mb ko kp kq hb bi translated">我们还添加了一些额外的类型接口:</p><ul class=""><li id="f18a" class="mc md hi jv b jw lu ka lv ke me ki mf km mg kq mh mi mj mk bi translated"><code class="du ks kt ku kv b">UserForm</code>使用一些TypeScript魔法(特别是<a class="ae iu" href="https://www.staging-typescript.org/docs/handbook/advanced-types.html#index-types-and-index-signatures" rel="noopener ugc nofollow" target="_blank">索引类型和索引签名</a>)来生成表示用户表单的类型，使用来自用户元数据的<code class="du ks kt ku kv b">initial</code>值。</li><li id="b48c" class="mc md hi jv b jw ml ka mm ke mn ki mo km mp kq mh mi mj mk bi translated">对于<code class="du ks kt ku kv b">InputAttributes</code>，我们在元数据中指定的<a class="ae iu" href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/Input#Attributes" rel="noopener ugc nofollow" target="_blank"> HTML属性</a>采用三种类型中的一种:布尔属性，如<code class="du ks kt ku kv b"><a class="ae iu" href="https://developer.mozilla.org/en-US/docs/Web/HTML/Attributes/required" rel="noopener ugc nofollow" target="_blank">required</a></code>；数量等属性<code class="du ks kt ku kv b"><a class="ae iu" href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/Input#htmlattrdefmaxlength" rel="noopener ugc nofollow" target="_blank">maxlength</a></code>；以及属性字符串，如<code class="du ks kt ku kv b"><a class="ae iu" href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/Input#attr-type" rel="noopener ugc nofollow" target="_blank">type</a></code>。</li><li id="ea41" class="mc md hi jv b jw ml ka mm ke mn ki mo km mp kq mh mi mj mk bi translated"><code class="du ks kt ku kv b">InputData</code>是一个表示生成表单所需信息的对象。我们对<code class="du ks kt ku kv b">&lt;label&gt;</code>元素使用label属性，并使用Vue的<code class="du ks kt ku kv b"><a class="ae iu" href="https://vuejs.org/v2/api/#vm-attrs" rel="noopener ugc nofollow" target="_blank">v-bind</a></code>将<code class="du ks kt ku kv b">inputAttributes</code>传递给<code class="du ks kt ku kv b">&lt;input&gt;</code>元素，就像<code class="du ks kt ku kv b">v-bind="inputAttributes"</code>一样。这样我们就不必单独指定每个道具。</li></ul><p id="f3b2" class="pw-post-body-paragraph jt ju hi jv b jw lu jy jz ka lv kc kd ke lx kg kh ki lz kk kl km mb ko kp kq hb bi translated">为了获得可用的<code class="du ks kt ku kv b">inputAttributes</code>，我们需要将元数据字段的名称映射到正确的HTML属性名称。我们还需要对不是出现在每个元数据节点上的属性进行空值检查，因此输入元素也是如此。这项工作由<code class="du ks kt ku kv b">convertFieldMetadataToInputData</code>处理。</p><p id="3e6d" class="pw-post-body-paragraph jt ju hi jv b jw lu jy jz ka lv kc kd ke lx kg kh ki lz kk kl km mb ko kp kq hb bi translated">但是为什么我们首先需要<code class="du ks kt ku kv b">convertFieldMetadataToInputData</code>？</p><figure class="mq mr ms mt fd ij"><div class="bz dy l di"><div class="nd ne l"/></div></figure><p id="8fba" class="pw-post-body-paragraph jt ju hi jv b jw lu jy jz ka lv kc kd ke lx kg kh ki lz kk kl km mb ko kp kq hb bi translated">嗯，是因为我没有提前计划。如果API元数据使用这些HTML属性所期望的字符串，我们将能够直接使用它们，而不是转换它们。我真惭愧，没有早点想到这一点！</p></div><div class="ab cl kw kx gp ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="hb hc hd he hf"><h1 id="2c64" class="iv iw hi bd ix iy nf ja jb jc ng je jf jg nh ji jj jk ni jm jn jo nj jq jr js bi translated">总结</h1><p id="4c15" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">我们做到了！稍加修改，我们就能够使用来自类似REST的JSON API的元数据生成完全类型化的表单。这篇文章也是一个例子，说明保持web应用程序的前端和后端同步是多么困难——即使试图展示一种方法来做到这一点。</p><p id="8e9c" class="pw-post-body-paragraph jt ju hi jv b jw lu jy jz ka lv kc kd ke lx kg kh ki lz kk kl km mb ko kp kq hb bi translated">不过，如果仔细规划，利用API元数据可以简化SPA应用程序，并减少JavaScript web应用程序中的样板文件和难以同步的代码。我说的“仔细计划”是指比我的计划更仔细的计划。</p><p id="0506" class="pw-post-body-paragraph jt ju hi jv b jw lu jy jz ka lv kc kd ke lx kg kh ki lz kk kl km mb ko kp kq hb bi translated"><strong class="jv hj">快乐编码！</strong></p></div></div>    
</body>
</html>