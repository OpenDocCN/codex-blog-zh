<html>
<head>
<title>SQL Rank Functions OverSimplified</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SQL等级函数过于简单</h1>
<blockquote>原文：<a href="https://medium.com/codex/sql-rank-functions-oversimplified-d363cabb2648?source=collection_archive---------5-----------------------#2022-09-27">https://medium.com/codex/sql-rank-functions-oversimplified-d363cabb2648?source=collection_archive---------5-----------------------#2022-09-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><h1 id="c708" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">商务人士需要SQL吗？</h1><p id="0fe9" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">SQL是最容易学习的计算机语言之一。如今，越来越多的公司鼓励非IT领域(如销售、广告和财务)的员工学习和使用SQL。当企业能够自己回答与数据相关的问题时，决策者就可以将这些见解转化为可操作的项目，从而提高工作效率。如果您有兴趣了解更多关于SQL的知识，并且您熟悉SQL的基础知识，那么本文将帮助您快速了解一些非常有用的SQL函数。</p><h2 id="69b6" class="kb ig hi bd ih kc kd ke il kf kg kh ip jo ki kj it js kk kl ix jw km kn jb ko bi translated"><strong class="ak">窗口功能介绍</strong></h2><p id="65f6" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><strong class="jf hj">它为什么叫窗户？</strong>此处的窗口描述了函数操作的行集合。</p><p id="d08b" class="pw-post-body-paragraph jd je hi jf b jg kp ji jj jk kq jm jn jo kr jq jr js ks ju jv jw kt jy jz ka hb bi translated"><strong class="jf hj">它是做什么的？</strong>它对一组与当前行相关的表格行执行一系列计算。</p><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es ku"><img src="../Images/42a4a2446f5f428a024aef80ca9e6d24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UKnqJkNsCI2v1C1E-H1p3A.png"/></div></div></figure><p id="e840" class="pw-post-body-paragraph jd je hi jf b jg kp ji jj jk kq jm jn jo kr jq jr js ks ju jv jw kt jy jz ka hb bi translated"><strong class="jf hj">幕后发生了什么？</strong>它的工作方式类似于聚合函数，但是这里需要注意的是，与聚合函数不同的是，这些行不仅仅被分组到一个输出行中，相反，这些行仍然保持它们各自的身份。</p><p id="f1bc" class="pw-post-body-paragraph jd je hi jf b jg kp ji jj jk kq jm jn jo kr jq jr js ks ju jv jw kt jy jz ka hb bi translated">虽然窗口函数广泛涵盖了所有这些函数，但我们今天只关注<strong class="jf hj">排名。</strong></p><ul class=""><li id="65ca" class="lg lh hi jf b jg kp jk kq jo li js lj jw lk ka ll lm ln lo bi translated"><strong class="jf hj">聚合函数:</strong> MAX()、MIN()、AVG()、SUM()、COUNT()等。</li><li id="fd76" class="lg lh hi jf b jg lp jk lq jo lr js ls jw lt ka ll lm ln lo bi translated"><strong class="jf hj">排名函数:</strong> ROW_NUMBER()，RANK()，DENSE_RANK()，NTILE()，PERCENT_RANK()，CUME_DIST()等。</li><li id="270e" class="lg lh hi jf b jg lp jk lq jo lr js ls jw lt ka ll lm ln lo bi translated"><strong class="jf hj">解析函数:</strong> LEAD()，LAG()，FIRST_VALUE()，LAST_VALUE()等。</li></ul><h1 id="c3a1" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">主题</h1><ol class=""><li id="497f" class="lg lh hi jf b jg jh jk jl jo lu js lv jw lw ka lx lm ln lo bi translated">带分区的等级</li><li id="2aad" class="lg lh hi jf b jg lp jk lq jo lr js ls jw lt ka lx lm ln lo bi translated">无划分的秩</li><li id="bdae" class="lg lh hi jf b jg lp jk lq jo lr js ls jw lt ka lx lm ln lo bi translated">秩和稠密秩的区别</li><li id="bb79" class="lg lh hi jf b jg lp jk lq jo lr js ls jw lt ka lx lm ln lo bi translated">行号</li></ol><h2 id="b6e4" class="kb ig hi bd ih kc kd ke il kf kg kh ip jo ki kj it js kk kl ix jw km kn jb ko bi translated">1.带分区的等级用例(当您需要一起查看数据子集时)</h2><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es ly"><img src="../Images/3f860f479dc9b299200bc3e3889b13bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VL8mLVYgNBUpX_GJs2Ixvg.png"/></div></div></figure><p id="fac9" class="pw-post-body-paragraph jd je hi jf b jg kp ji jj jk kq jm jn jo kr jq jr js ks ju jv jw kt jy jz ka hb bi translated">想象你有一对双胞胎——伊莎贝尔和奥利维亚。他们在同一个班学习。为了给他们提供关于他们职业道路的家长谈话，你必须看到他们的分数。</p><p id="1b27" class="pw-post-body-paragraph jd je hi jf b jg kp ji jj jk kq jm jn jo kr jq jr js ks ju jv jw kt jy jz ka hb bi translated">商业逻辑→绕回数据问题，你将需要看到伊莎贝拉的科目和分数在一起，然后是奥利维亚的科目和分数。</p><p id="18f4" class="pw-post-body-paragraph jd je hi jf b jg kp ji jj jk kq jm jn jo kr jq jr js ks ju jv jw kt jy jz ka hb bi translated">SQL逻辑→这个业务逻辑应该引导您考虑如何根据学生的名字来划分数据。</p><p id="a695" class="pw-post-body-paragraph jd je hi jf b jg kp ji jj jk kq jm jn jo kr jq jr js ks ju jv jw kt jy jz ka hb bi translated">商业逻辑→作为一名家长，你可能希望看到孩子在哪些领域表现突出，这应该会让你想到“排名”。</p><p id="c5d2" class="pw-post-body-paragraph jd je hi jf b jg kp ji jj jk kq jm jn jo kr jq jr js ks ju jv jw kt jy jz ka hb bi translated">SQL逻辑→等级1分配给孩子得分最高的科目。<em class="lz">提示:按降序排列。</em></p><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es ma"><img src="../Images/59af67f80aef0b1599e7937c27840e00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xmDY8-bc9OrFV4iBSOvGHw.png"/></div></div></figure><pre class="kv kw kx ky fd mb mc md me aw mf bi"><span id="6da7" class="kb ig hi mc b fi mg mh l mi mj">SELECT Studentname,</span><span id="3b75" class="kb ig hi mc b fi mk mh l mi mj">Subject,</span><span id="0b92" class="kb ig hi mc b fi mk mh l mi mj">Marks,</span><span id="ab79" class="kb ig hi mc b fi mk mh l mi mj">RANK() OVER(PARTITION BY Studentname ORDER BY Marks DESC) Rank</span><span id="c3a6" class="kb ig hi mc b fi mk mh l mi mj">FROM ExamResult</span><span id="5781" class="kb ig hi mc b fi mk mh l mi mj">ORDER BY Studentname,</span><span id="34bd" class="kb ig hi mc b fi mk mh l mi mj">Rank;</span></pre><ul class=""><li id="59d4" class="lg lh hi jf b jg kp jk kq jo li js lj jw lk ka ll lm ln lo bi translated">为了区分孩子，我们使用PARTITION<strong class="jf hj">BY student name</strong>子句，这样我们就可以对每个学生组的分数进行计算。每个学生小组，我指的是伊莎贝拉和奥利维亚。</li><li id="7a40" class="lg lh hi jf b jg lp jk lq jo lr js ls jw lt ka ll lm ln lo bi translated">作为家长，你想先看到他们的最佳表现，所以让我们按降序排列</li><li id="bd14" class="lg lh hi jf b jg lp jk lq jo lr js ls jw lt ka ll lm ln lo bi translated">我们还将使用Order By子句对学生姓名的结果进行排序，因此您会首先看到Isabella。</li></ul><p id="4573" class="pw-post-body-paragraph jd je hi jf b jg kp ji jj jk kq jm jn jo kr jq jr js ks ju jv jw kt jy jz ka hb bi translated">这就对了。你现在可以给他们讲一讲文学。</p><h2 id="260f" class="kb ig hi bd ih kc kd ke il kf kg kh ip jo ki kj it js kk kl ix jw km kn jb ko bi translated">2.无划分的等级(不需要子集，需要等级)</h2><p id="5022" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">从小到大，我有一个好朋友，她的妈妈非常好胜。她经常会问别人过得怎么样。</p><blockquote class="ml mm mn"><p id="b77a" class="jd je lz jf b jg kp ji jj jk kq jm jn mo kr jq jr mp ks ju jv mq kt jy jz ka hb bi translated">“嗯……长时间的停顿……那么……有多少其他的孩子，得到了和你一样的分数？与你相比，其他人的表现如何？”</p></blockquote><p id="4279" class="pw-post-body-paragraph jd je hi jf b jg kp ji jj jk kq jm jn jo kr jq jr js ks ju jv jw kt jy jz ka hb bi translated">为了回答这些问题，我们可能需要对所有科目的学生分数进行排名。见下文。</p><ol class=""><li id="e83d" class="lg lh hi jf b jg kp jk kq jo li js lj jw lk ka lx lm ln lo bi translated">结果告诉你伊莎贝拉的英语成绩是班上最高的，奥利维亚的英语成绩也一样好。正在成长的作家！</li></ol><p id="667d" class="pw-post-body-paragraph jd je hi jf b jg kp ji jj jk kq jm jn jo kr jq jr js ks ju jv jw kt jy jz ka hb bi translated">2.如果你是那些争强好胜的父母中的一员，你可能希望把第三名(莉莉获得的<em class="lz">科学)给你的孩子</em>伊莎贝拉或奥利维亚，这样你的孩子就可以统治世界了！</p><figure class="kv kw kx ky fd kz er es paragraph-image"><div class="er es mr"><img src="../Images/08154ce7d21e4fa34370317e382b746b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1364/format:webp/1*mglm5HE8Gz15BGvjSbqSnw.png"/></div></figure><p id="4824" class="pw-post-body-paragraph jd je hi jf b jg kp ji jj jk kq jm jn jo kr jq jr js ks ju jv jw kt jy jz ka hb bi translated">我们没有使用按科目或学生划分，因为我们只是想对所有科目有一个整体的看法。相反，我们使用SQL Rank函数和Marks子句上的<strong class="jf hj"> OVER子句(按降序)来获得相应行的等级。</strong></p><h2 id="1ae9" class="kb ig hi bd ih kc kd ke il kf kg kh ip jo ki kj it js kk kl ix jw km kn jb ko bi translated">秩和密集秩差(Dense_Rank()给出唯一的秩)</h2><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es ms"><img src="../Images/1ea38b3905fe4060832c91e039aed4cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZTQekblUhxilcrdAswKs3g.png"/></div></div></figure><p id="bd7b" class="pw-post-body-paragraph jd je hi jf b jg kp ji jj jk kq jm jn jo kr jq jr js ks ju jv jw kt jy jz ka hb bi translated"><strong class="jf hj">排位→ </strong>与<code class="du mt mu mv mc b">DENSE_RANK</code>不同的是，<code class="du mt mu mv mc b">RANK</code>在排位相等后跳过位置。跳过的位置数取决于有多少行具有相同的排名。例如，伊莎贝拉在数学和科学两科中得分相同，所以这两科都名列第一。有了<code class="du mt mu mv mc b">RANK</code>，下一个位置就是# 3；用<code class="du mt mu mv mc b">DENSE_RANK</code>，下一个位置是#2。</p><p id="dbc8" class="pw-post-body-paragraph jd je hi jf b jg kp ji jj jk kq jm jn jo kr jq jr js ks ju jv jw kt jy jz ka hb bi translated"><strong class="jf hj"> Dense_Rank() → </strong>根据指定的列值，这将为您提供分区内唯一的等级号。</p><h2 id="fe9c" class="kb ig hi bd ih kc kd ke il kf kg kh ip jo ki kj it js kk kl ix jw km kn jb ko bi translated">行号()</h2><p id="af46" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">此函数为每一行提供一个唯一的顺序号(1、2、3等)，它为第一行提供一个等级，然后为每一行增加一个值。</p><p id="6f65" class="pw-post-body-paragraph jd je hi jf b jg kp ji jj jk kq jm jn jo kr jq jr js ks ju jv jw kt jy jz ka hb bi translated">这里需要注意的是，行的不同等级也有相似的值。</p><pre class="kv kw kx ky fd mb mc md me aw mf bi"><span id="48f0" class="kb ig hi mc b fi mg mh l mi mj">SELECT Studentname,</span><span id="13c9" class="kb ig hi mc b fi mk mh l mi mj">Subject,</span><span id="290a" class="kb ig hi mc b fi mk mh l mi mj">Marks,</span><span id="d3a6" class="kb ig hi mc b fi mk mh l mi mj">ROW_NUMBER() OVER(ORDER BY Marks) RowNumber</span><span id="7c0d" class="kb ig hi mc b fi mk mh l mi mj">FROM ExamResult;</span></pre><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es mw"><img src="../Images/a803b7ffc12d4ae0253e901ed74d4cb8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5QBkUzPVm3I5dPq41yR1fQ.png"/></div></div></figure><h1 id="8d7b" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">结论</h1><p id="499b" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">排名函数是数据分析师最常用的工具之一。要对SQL中的排名感到自信，请感到有能力并开始练习。您可以查看<a class="ae mx" href="http://sqlfiddle.com/" rel="noopener ugc nofollow" target="_blank"> SQL Fiddle </a>或<a class="ae mx" href="https://sqlzoo.net/wiki/SQL_Tutorial" rel="noopener ugc nofollow" target="_blank"> SQL Zoo </a>。这些是免费平台，以一种对初学者非常友好的方式呈现SQL。它非常直观&amp;将帮助您在舒适的环境中亲自操作SQL。</p></div></div>    
</body>
</html>