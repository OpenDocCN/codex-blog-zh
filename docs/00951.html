<html>
<head>
<title>The Curious Case of Rails Association</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Rails协会的奇特案例</h1>
<blockquote>原文：<a href="https://medium.com/codex/the-curious-case-of-rails-association-b3390b625af0?source=collection_archive---------23-----------------------#2021-03-26">https://medium.com/codex/the-curious-case-of-rails-association-b3390b625af0?source=collection_archive---------23-----------------------#2021-03-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="91f4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">感谢你选择阅读这篇文章。我向你保证阅读这个博客会很有趣。这篇博客是关于我在Rails Association中遇到的一个问题的经历，以及我是如何找到问题的根源并找到解决方案的。</p><p id="35d7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你是Rails用户，你可以跳过“搭建舞台”这一部分。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/60be2d09d97180707c9203749e741f66.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qxh1NTIX6yIyPR_862WH1Q.png"/></div></div></figure><p id="1838" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">搭建舞台。</strong></p><p id="bd77" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们熟悉一下我们一会儿将要用到的一些术语。</p><ul class=""><li id="1a36" class="jp jq hi ih b ii ij im in iq jr iu js iy jt jc ju jv jw jx bi translated"><strong class="ih hj"> Rails: </strong> Ruby on Rails或简称Rails是一个使用Ruby语言语法的web开发框架。它提供了一个有组织的结构来存储网站运行所需的不同文件。Ruby使编码变得简单，因为它的语法和英语几乎一样。</li><li id="1867" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated"><strong class="ih hj">数据库:</strong>数据库是用来存储和检索数据的应用程序。数据将存储在数据库的表(行和列)中。为了理解这一点，想象一下容器或文件是如何保存在橱柜里的。在橱柜里，你可以在架子上找到它们。在架子上，你可以找到它们。橱柜可以与数据库相关联，架子可以与桌子相关联。</li><li id="7d45" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated"><strong class="ih hj">关联:</strong>关联是数据库中两个表如何相互关联的一种方式。例如，如果book和page是两个表，那么它们的关联将是“<em class="kd">一本书‘有很多’页</em>”。</li><li id="afba" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated"><strong class="ih hj">单数和复数:</strong>我们都应该读过英语中的单数和复数形式。单数和复数是Rails中的库函数，分别用于将单词从复数形式转换为单数形式，反之亦然。</li><li id="a79f" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated"><strong class="ih hj"> API端点:</strong>应用编程接口(API)是两个应用程序进行交互和交换数据的手段。通常，开发移动应用程序是为了与另一个称为后端服务器的应用程序进行交互。这个后端服务器将使用特定的URL(端点)进行开发，移动应用程序可以使用这些URL进行交互。后端服务器也可以是一个可以使用Chrome、Firefox等互联网浏览器访问的网站。例如，可以使用移动应用程序和互联网浏览器访问脸书。为了更好地理解这一点，可以考虑swiggy和zomato等食品配送公司(这些公司可能与上面所说的移动应用程序有关)。这些服务与餐馆进行交互(可以与后端服务器相关联)，并根据我们的请求交付食物(可以使用后端服务器的API端点与移动应用程序相关联)。同样值得注意的是，我们可以直接去餐馆吃饭(这可能与作为网站工作的后端服务器有关)。</li><li id="4360" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated"><strong class="ih hj">类和对象:</strong>类是一个编程概念，允许将任何实体表示为属性和函数。对象是一个类的实例。例如，一所学校的学生可以表示为一个学生班级，包含姓名、性别、学号和属性等详细信息。听、说、写和玩可以是那门课的功能。每个学生都可以成为学生类的对象。</li><li id="09f8" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated"><strong class="ih hj"> ORM技术:</strong>允许分别以类和对象的形式访问数据库中的表和表中的行的技术。</li></ul><p id="45bb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">在一个晴朗的日子… </strong></p><p id="e779" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我被分配的任务是创建一个Rails应用程序，只为API端点服务，用于评估目的。一个迷你社交媒体应用程序作为一个开发的想法出现了。我使用ORM为应用程序创建表，并指定表之间的关联。基本表是User，包含使用该应用程序的用户的详细信息。用户发布许多博客。所以我创建了一个博客表。用户可以举报博客滥用。所以我创建了一个滥用表，关联“<em class="kd">一个用户‘有许多’滥用</em>”和“<em class="kd">一个博客‘有许多滥用</em>”。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ke"><img src="../Images/3e58544ebb56e6dcd168f7ae6dde8dc6.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*-JrrT7rk4t3WQK1xVcvPog.gif"/></div></figure><p id="7656" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于上面的表，我使用ORM在Rails应用程序中创建了User、Blog和Abuse类，并且在这些类中指定了关联，如下所示:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kf"><img src="../Images/9cb1c82331a88e7ad3dc85d4ff848d69.png" data-original-src="https://miro.medium.com/v2/resize:fit:598/format:webp/1*TYKOqPXFqk9C-x-1fyl4pg.png"/></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kf"><img src="../Images/666641962c505fdbb04fa74d2506af7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:598/format:webp/1*YP_eTMlHLvCjCf6yIH8AJw.png"/></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kf"><img src="../Images/8072b1d4ab059e1e0bcb0ff9856632cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:598/format:webp/1*0pAHj1UuvSAOlfrBFeEd-A.png"/></div></figure><p id="2528" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">测试阶段(一切都乱套了)</strong></p><p id="6ef2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了测试创建的表类及其关联，我创建了一个示例用户(<em class="kd"> user1 </em>)，一个由示例用户发布的示例博客(blog1)。创建了另一个用户(用户2)，该新用户(即用户2)报告示例博客(即博客1)被滥用(滥用1)。</p><p id="ebc7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对创建的对象使用关联的预期结果是:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kg"><img src="../Images/209cac5a022126b315ded83bcf341897.png" data-original-src="https://miro.medium.com/v2/resize:fit:1102/format:webp/1*s0cGpOZakWpel_3aUoGEhA.png"/></div></figure><p id="4876" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是，实际的结果是一个真正的大煞风景！看看会发生什么:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kg"><img src="../Images/197ff48e28ff29ce8a250e8eaed271ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1102/format:webp/1*ANh1evogZ6iUyQqdLsmXDA.png"/></div></figure><p id="be45" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">等等。什么？名为<strong class="ih hj">的类滥用</strong>没有定义吗？但是我们已经知道，根据英语语法，滥用的复数形式是滥用，我们已经定义了同样的意思。</p><p id="8aa5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">面对这样一个毫无头绪的错误，我首先在谷歌上搜索了这个问题。但是没有任何结果。</p><p id="bc73" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我联系了我的技术主管和团队中的同事。在我的机器里检查过之后，他们都不知道这个问题。一天在绝望中过去了。</p><p id="deb4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">突然灵光一现！</strong></p><p id="d654" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">不知从哪里，我想到了Rails中关联的工作方式。在上面的代码中，您会注意到两种类型的关联，分别是:'<strong class="ih hj"> has_many </strong>'和'<strong class="ih hj">归属_ T21 '。对于belongs _ to关联，在<em class="kd">单数形式</em>中提到了<em class="kd">目标表名</em>。但是对于has_many关联，在<em class="kd">复数形式</em>中提到了<em class="kd">目标表名</em>。</strong></p><p id="196d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Rails在各自的类中使用给定的关联词(用户、博客、滥用和博客)来确定目标类。例如，如果我们给定为<strong class="ih hj"> <em class="kd"> blog1.user </em> </strong>，Rails将使用user类查找表。类似地，如果我们给定为<strong class="ih hj"> <em class="kd"> user1.blogs </em> </strong>，Rails将使用singularize函数并将其转换为blog，之后它将使用blog类查找表Blog。</p><p id="576d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我通过给<strong class="ih hj"> <em class="kd">“滥用”来研究单词滥用的奇点化函数的工作。单数化</em> </strong>。不出所料，结果是<strong class="ih hj"><em class="kd">【abus】</em></strong>。原因是bus和abuse分别具有与bus和abuse相似的复数形式。因此，singularize函数将“滥用”的单数形式返回为“abus”，而不是“abuse”。</p><p id="1e6b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">朝着解决方案努力</strong></p><p id="d5d6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">由于这是Rails框架的一个问题，我想修复它并贡献给开源社区(在GitHub上)。在检查了过去关于同一主题的问题后，我了解到由于旧版本(向后兼容问题)，无法制定解决方案。作为替代，Rails的主要开发者建议将解决方案代码写入应用程序中的一个文件。我做了同样的事情，发现问题已经得到解决。</p><p id="d4e7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您对解决方案感兴趣，<a class="ae kh" href="https://github.com/rails/rails/pull/32332" rel="noopener ugc nofollow" target="_blank">请访问此处</a>。感谢你阅读这篇文章。</p><p id="24a1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">那都是乡亲们！</strong></p><p id="4d56" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个事件是一个在编码时相信直觉的经典例子。这将有助于解决我们可能不知道其根本原因或解决方案的问题。</p><p id="4d85" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">作者:斯里拉姆K </strong></p></div></div>    
</body>
</html>