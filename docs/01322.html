<html>
<head>
<title>Sending Better Data With Rails Serializers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Rails序列化程序发送更好的数据</h1>
<blockquote>原文：<a href="https://medium.com/codex/sending-better-data-with-rails-serializers-5d50cb7c750c?source=collection_archive---------7-----------------------#2021-04-19">https://medium.com/codex/sending-better-data-with-rails-serializers-5d50cb7c750c?source=collection_archive---------7-----------------------#2021-04-19</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/d7c18cf44e8e517488d851ce477e2e53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wB_1_TiEgC1OHQ0IZ9FlVQ.png"/></div></div></figure><p id="3a4d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">使用Ruby on Rails作为API很棒，因为它的render :json方法。唯一的问题是，很多时候JSON数据可能包含很多不必要的东西。我们希望有更多的选项来定制数据，我们可以使用序列化器来实现。我们可以使用序列化器来格式化我们的JSON，只选择我们真正需要的数据，并访问模型关系。让我们开始吧。</p></div><div class="ab cl jo jp gp jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="hb hc hd he hf"><p id="17a7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这个例子中，我们可以想象你想从数据库中查询一个口袋妖怪和它们的训练者的列表。让我们创建两个模型。</p><pre class="jv jw jx jy fd jz ka kb kc aw kd bi"><span id="0d04" class="ke kf hi ka b fi kg kh l ki kj">rails g model Trainer name:string age:integer<br/>rails g model Pokemon name:string poke_type:string</span></pre><p id="b63d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">之后，我们想建立我们的模型协会。</p><figure class="jv jw jx jy fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kk"><img src="../Images/d66fd038608a3e79c21cbebf5324d1fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3zUr7S2DkJfPF0zqQfRQmw.png"/></div></div></figure><p id="dcfe" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">接下来，我们必须设置我们的控制器。</p><pre class="jv jw jx jy fd jz ka kb kc aw kd bi"><span id="5bb2" class="ke kf hi ka b fi kg kh l ki kj">rails g controller pokemons<br/>rails g controller trainers</span></pre><p id="28b3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这将是我们的口袋妖怪控制器。</p><figure class="jv jw jx jy fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kl"><img src="../Images/8c2f400210e8063560b162802ab0256f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VTBMGTZnRRXwlhROc6vdLw.png"/></div></div></figure><p id="b0f2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这将是我们训练员的控制器。</p><figure class="jv jw jx jy fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es km"><img src="../Images/2922c48d35c829de0cd359a426f551b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oEbmmlLmtcysIXVzSREyTA.png"/></div></div></figure><p id="52e1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们必须像这样定义我们的路线。</p><figure class="jv jw jx jy fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kn"><img src="../Images/e0c58426e6d37b614603a30d4c6ad3ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m3-cchsr4u6We0YTmRpyqA.png"/></div></div></figure><p id="85bb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，我们可以运行迁移，并用这些命令播种我们的数据库。</p><figure class="jv jw jx jy fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ko"><img src="../Images/947999cbd896eac58e619acf68d54563.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mxMub-jKJrw-N2Y1j8DjUA.png"/></div></div></figure><pre class="jv jw jx jy fd jz ka kb kc aw kd bi"><span id="74db" class="ke kf hi ka b fi kg kh l ki kj">rails db:migrate<br/>rails db:seed</span></pre><p id="ee5e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在一切都已经设置好了，我们可以发出GET请求来查询数据库中所有口袋妖怪的列表。如果没有序列化程序，这就是我们的数据将会是什么样子。</p><figure class="jv jw jx jy fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kp"><img src="../Images/0313f9e7681a46536f859fe62424ab4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dYlTwkiuNZxLAT0QtHLQgA.png"/></div></div></figure><p id="99d4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你可以看到我们有一些并不需要的信息。没有必要知道口袋妖怪是什么时候被创造和更新的。隐藏这些信息就好了。还有一点就是我们只能得到一个整数作为trainer_id。每个口袋妖怪都有自己的训练师，但除了id之外，我们并没有得到任何训练师的信息。让我们让这些数据看起来更好。首先将序列化程序gem添加到您的gem文件中</p><pre class="jv jw jx jy fd jz ka kb kc aw kd bi"><span id="0a26" class="ke kf hi ka b fi kg kh l ki kj">gem ‘active_model_serializers’</span></pre><p id="4306" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">安装完这个包之后，你将能够非常容易地生成序列化器。继续运行这个命令。</p><pre class="jv jw jx jy fd jz ka kb kc aw kd bi"><span id="5ce9" class="ke kf hi ka b fi kg kh l ki kj">rails g serializer Pokemon</span></pre><p id="19e0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这将在你的应用程序文件夹中创建一个名为serializer的文件夹，其中包含一个pokemon_serializer.rb文件。您可以在这里添加想要在渲染中显示的属性。对于pokemon，我们希望显示名称、trainer_id和类型，因此序列化程序将如下所示。</p><figure class="jv jw jx jy fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kp"><img src="../Images/b4cf32eb283cc84b1dc371b979f7682c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PGysvzR6MBx6awb0jMV-0g.png"/></div></div></figure><p id="98fd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">执行GET请求后，您看到的数据将如下所示。</p><figure class="jv jw jx jy fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kq"><img src="../Images/2e0210c6a7a15c552749b4b1238f0c11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-hy39iUFSQJIKwcimj1WXQ.png"/></div></div></figure><p id="44d0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这看起来棒极了！我们不再显示已创建或已更新的属性。每个口袋妖怪都有一个教练，但我们没有任何关于教练的信息。我们希望能够显示的不仅仅是id，所以在我们的序列化程序中，我们将把它修改成这样。</p><figure class="jv jw jx jy fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kp"><img src="../Images/11a6e08192d6d8b468fd71346402d81d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KRpLOdt1td4fgI9jU-su8A.png"/></div></div></figure><p id="9fae" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最后，我们的数据将看起来像这样。</p><figure class="jv jw jx jy fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kr"><img src="../Images/dc9d49b0cfa01aa5d0ad07332d87e945.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nnHnV2K5UiKtjaKRJcokSQ.png"/></div></div></figure></div><div class="ab cl jo jp gp jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="hb hc hd he hf"><p id="24ab" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">仅此而已！使用序列化程序非常简单，并且是定制您正在呈现的数据的一种非常好的方式。试着在你的API上使用它，让我知道你的想法。编码快乐！😎</p></div></div>    
</body>
</html>