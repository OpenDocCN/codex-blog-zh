# 监控和更新您的模型

> 原文：<https://medium.com/codex/monitor-and-update-your-models-7eb7fc734708?source=collection_archive---------9----------------------->

## 部署您的模型只是开始…

在一个漫长的开发阶段之后，您必须处理特征工程、特征选择、正则化等等，您终于在您的生产环境中部署了令人敬畏的机器学习模型。

但是几周后，你会意识到你的模型失控了，它的预测毫无意义。发生什么事了？怎么解决呢？我们将在本文中回答这些问题

![](img/348001ce6558da61e1ffa3212baa4f00.png)

马里乌斯·马萨拉尔在 [Unsplash](https://unsplash.com/s/photos/machine-learning?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) 上的照片

# 一.模型折旧

所有模型最终都需要更新，以适应外部世界的变化

事实上，您的模型的性能可能会因为以下两个因素而下降:

*   **数据漂移**:可以描述为数据分布的变化。例如，标准偏差、平均值、中值的变化……像 [Kolmogorov-Smirnov](https://en.wikipedia.org/wiki/Kolmogorov%E2%80%93Smirnov_test) 这样的统计测试可以用来识别数据漂移
*   **概念漂移**:变量与输出之间的关系发生变化。事实上，数据中的模式和关系往往会随着时间的推移而演变，为分析某些初始数据而建立的模型会随着时间的推移而迅速过时，因为输入和输出变量之间的关系会发生变化

所以一旦部署，你的模型会越来越不被看好。这种现象被称为**模型漂移**。这就是为什么你必须定期重新训练你的模型，使它保持敏锐。一个很好的方法是实施**连续培训管道**。

> 持续培训(CT):它基本上是一个管道，使用来自生产环境的数据自动重新培训您的已部署模型。一旦经过训练，新模型就被用来代替旧模型。这是在不停止服务或中断操作的情况下完成的

要实现 CT 管道，您首先需要监控您的模型。之后，您需要**设置您的模型何时更新以及在什么条件下更新**

# 二。模型监控

实现 CT 管道的第一步:监控您的模型。

它基本上是设置所需的代码，以便您可以轻松地看到数据和概念漂移的影响，以及它们如何随着时间的推移而演变。

那么，我们需要监控什么？

*   **数据**:数据分布(平均值、标准差、分位数等等)、数据的模式、…
*   **模型**:模型的度量指标(准确度、精确度、召回率、…)、延迟、训练时间、…

您可以通过在模型运行时进行一些测试并记录结果来监控它们。然后你可以把你的日志放在一个[文件集](https://en.wikipedia.org/wiki/Fileset) ( [集](https://en.wikipedia.org/wiki/Set_(mathematics))[个计算机文件](https://en.wikipedia.org/wiki/Computer_file)中的个，通过定义属性或公共特征链接)或者一个弹性搜索中，你可以在以后分析它们。

既然已经进行了监控，那么当两个监控轴(数据或模型)中的一个变红时，您必须找到一种方法来**提醒**您的团队。例如，可以通过邮件

在这一点上，如果我们的模型失去控制，你有一个清晰的系统来监控和警告你的团队。所以现在，您必须设置更新机制

# 三。模型更新

通过“建立更新机制”，我的意思是决定我的模型在什么时候和什么条件下被更新。

第一步是决定模型何时更新。可以说，您必须决定使用哪个触发器:

*   **按需**:临时手动执行再培训
*   **按计划**:如果 ML 系统定期提供新数据，您可以在相同的基础上重新培训。
*   **关于模型性能退化**:现在您已经监控了您的模型，您可以在重新训练模型之前决定您接受的最小精度(或者您使用的任何度量)
*   **关于数据分布的重大变化**:现在您已经监视了您的模型，您可以在重新训练模型之前决定您接受的数据的最大变化

> 注意:只有最后两个触发器才需要监控你的模型。即使不是前两种情况，监控仍然可能是方便的，至少有一个可观察的系统

重新训练的频率还取决于:

*   重新训练你的模型有多贵:它越贵，你重新训练它就越少
*   你的模型被否决的速度:你的模型越不稳定，你就越需要重新训练它。例如，如果变量非常动态(随时间变化很大)，这个变量的一个小变化就可能在很大程度上影响模型。

既然已经决定了重新训练模型的时间，就必须决定是否要用新模型替换旧模型。为此，新系统/模型必须通过一些条件:

*   **数据验证**:测试数据模式是否已经改变，数据是否仍然具有代表性，……如果数据没有通过验证，那么模型甚至不会被重新训练
*   **模型验证**:比较新模型和新模型的准确性(或者你用来评估你的模型的任何度量)。如果根据您的要求，比较是可接受的，则更换模型

如果这两个条件都满足，您的旧型号可以被更新的型号取代。如果没有，在推广到生产之前，让数据科学家/企业审查新模型的解释可能是一个好主意。您可能需要引入新的功能工程步骤或类似的东西。所以你必须回到开发阶段

> 注意:你也可以发布你的新模型，这样它每次只服务于你的一部分用户，其余的由你的旧模型服务。新模式接管了越来越多的用户，直到它完全取代了以前的模式

# 结论

现在，由于 CT 管道的存在，您拥有了一个可靠且可维护的 ML 生产系统！用一个时髦的词来形容我刚才描述的，这是 **MLOps 的做法之一。**

> MLOps:用于使 ML 模型在生产中可维护和可靠的一组实践。因此，通过 CT(持续培训)管道监控和更新您的模型属于 MLOps 实践

我希望这篇文章对你有用。感谢阅读！

参考资料:

[1]:[https://cloud . Google . com/architecture/mlops-continuous-delivery-and-automation-pipeline-in-machine-learning](https://cloud.google.com/architecture/mlops-continuous-delivery-and-automation-pipelines-in-machine-learning)

【2】:[https://valohai.com/model-monitoring/](https://valohai.com/model-monitoring/)

[3]:[https://www.datarobot.com/wiki/model-monitoring/](https://www.datarobot.com/wiki/model-monitoring/)