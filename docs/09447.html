<html>
<head>
<title>Compliance-First Development for NodeJS Logins with Frontegg</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过Frontegg实现NodeJS登录的合规优先开发</h1>
<blockquote>原文：<a href="https://medium.com/codex/compliance-first-development-for-nodejs-logins-with-frontegg-28ec857f12c9?source=collection_archive---------16-----------------------#2022-10-20">https://medium.com/codex/compliance-first-development-for-nodejs-logins-with-frontegg-28ec857f12c9?source=collection_archive---------16-----------------------#2022-10-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/672497df8a3eed914e0ff96534dbe6d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*FN0m2ynvNNnZfZoH"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">克里斯汀·休姆在<a class="ae iu" href="https://unsplash.com/s/photos/user?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="4269" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">对无密码身份验证的需求正在增加，因为它比旧的身份验证系统有许多优势。用户不需要记住他们的密码，这是一种比需要密码的认证更安全的做法，因为它不太容易受到网络攻击。</p><p id="f890" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在本文中，我将演示如何使用Frontegg通过React和NodeJS创建一个无密码的用户认证系统。</p><h1 id="60aa" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">什么是用户认证？</h1><p id="c913" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated"><a class="ae iu" href="https://www.techtarget.com/searchsecurity/definition/user-authentication" rel="noopener ugc nofollow" target="_blank">用户认证</a>是一种用于验证试图访问系统的用户身份的系统。这是一个要求用户输入其凭证来证明他们所说的身份的过程。</p><p id="872e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">系统需要知道用户的身份，以允许他们访问他们的系统功能并对其执行任务，同时监控用户的活动，以保护他们的利益并优化用户体验。</p><h1 id="2594" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">为什么需要用户认证？</h1><p id="47b8" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">用户身份验证确保只有经过授权的用户才能访问系统，从而防止未经授权的用户从数据库中窃取信息或损坏系统。</p><p id="4903" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">可以使用各种认证系统(如密码和无密码认证系统)进行用户识别。</p><p id="efea" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在需要密码的认证系统中，用户必须输入他的用户名或电子邮件以及密码来验证他的身份。相比之下，在<a class="ae iu" href="https://www.onelogin.com/learn/passwordless-authentication#:~:text=Passwordless%20authentication%20is%20a%20means,safe%20for%20a%20long%20time." rel="noopener ugc nofollow" target="_blank">无密码认证</a>系统中，用户必须通过OTP(一次性密码)或验证链接之类的方式注册或登录系统，该链接在短期内到期，因此没有人可以使用它。</p><h1 id="ea2d" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">为什么无密码认证更安全？</h1><p id="6904" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">无密码认证比有密码的认证系统更难被黑客攻破，因此更不容易受到网络攻击，这也是它们更安全的原因。</p><p id="e5f6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">但是我们不能说这个系统是不可能被破解的，因为现在没有一个认证系统是不可能被破解的。当今世界黑客更高水平的经验和强大的AI智能，使得黑客攻击当今世界存在的任何系统成为可能。</p><h1 id="0320" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">使用Frontegg进行用户认证</h1><p id="ea36" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated"><a class="ae iu" href="https://portal.frontegg.com/" rel="noopener ugc nofollow" target="_blank"> Frontegg </a>是一个免费的现代用户管理系统，帮助开发者整合各种功能，如安全用户认证、档案管理、登录等。它提供了许多现代功能，如注册/登录卡外观的定制，与各种编程语言的集成，以及与第三方应用程序的轻松集成。</p><figure class="kw kx ky kz fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/fefb99e19f7232535604fa2fab0db70d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*0v-PeelAoQS5FmBC"/></div></div></figure><p id="adf6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">因此，让我们开始学习如何使用Frontegg来实现这一切。</p><p id="0f5c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在我们开始我们的项目之前，我们必须在我们的系统中安装<a class="ae iu" href="https://radixweb.com/blog/installing-npm-and-nodejs-on-windows-and-mac" rel="noopener ugc nofollow" target="_blank"> NodeJS和NPM </a>。</p><p id="88c3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">安装NodeJS和NPM之后，我们将在我们的系统上安装React JS。在项目终端中运行以下命令，在系统上安装React JS:</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="1edc" class="lf ju hi lb b fi lg lh l li lj">npx create-react-app frontegg_app<br/>cd frontegg_app</span></pre><p id="3ae2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">通过运行以下命令，在应用程序目录中安装react-router-dom(如果尚未安装):</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="7dbc" class="lf ju hi lb b fi lg lh l li lj">npm i react-router-dom</span></pre><p id="7cd3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">接下来，我们需要安装Frontegg npm库:</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="19cd" class="lf ju hi lb b fi lg lh l li lj">npm i @frontegg/react</span></pre><p id="5f5f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们已经为我们的项目准备好了所有需要的东西。现在打开React应用程序的index.js文件，复制以下代码:</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="0952" class="lf ju hi lb b fi lg lh l li lj">import React from ‘react’;<br/>import ReactDOM from ‘react-dom’;<br/>import App from ‘./App’;<br/>import ‘./index.css’;<br/>import { FronteggProvider } from ‘@frontegg/react’;<br/>import {BrowserRouter} from “react-router-dom”;<br/>const contextOptions = {<br/> baseUrl: “appURL”,<br/> clientId: ‘client-id’<br/>};<br/>ReactDOM.render(<br/> &lt;<strong class="lb hj">BrowserRouter</strong>&gt;<br/> &lt;<strong class="lb hj">FronteggProvider</strong> contextOptions={contextOptions}&gt;<br/> &lt;<strong class="lb hj">App</strong> /&gt;<br/> &lt;/<strong class="lb hj">FronteggProvider</strong>&gt;<br/> &lt;/<strong class="lb hj">BrowserRouter</strong>&gt;,<br/> document.getElementById(‘root’)<br/>);</span></pre><p id="eb03" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">看代码。这里我们用了一个宾语，<code class="du lk ll lm lb b">contextOptions</code>。该对象由基本URL和客户端id组成。你可以从点击上图所示的“发布到开发者”按钮时打开的页面中获得这些信息。这个基本URL对每个用户都是唯一的。</p><figure class="kw kx ky kz fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/ea1af2e7adfeabf60d6067aff4306450.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*IUpRXPwsllXtmBa2"/></div></div></figure><p id="4476" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">此外，用浏览器路由器包装FronteggProvider元素，以便您可以在页面之间平稳地导航。</p><p id="2110" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">打开app.js文件，复制以下代码:</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="b13f" class="lf ju hi lb b fi lg lh l li lj">import ‘./App.css’;<br/>import { useAuth} from “@frontegg/react”;<br/>function App() {<br/>const { user, isAuthenticated } = useAuth();<br/> return (<br/> &lt;<strong class="lb hj">div</strong> className=”App”&gt;<br/> { isAuthenticated &amp;&amp; (<br/> &lt;<strong class="lb hj">div</strong>&gt;<br/> &lt;<strong class="lb hj">img</strong> src={user?.profilePictureUrl} alt={user?.name}/&gt;<br/> &lt;<strong class="lb hj">span</strong>&gt;Logged in as: {user?.name}&lt;/<strong class="lb hj">span</strong>&gt;<br/> &lt;<strong class="lb hj">div</strong>&gt;<br/> &lt;<strong class="lb hj">button</strong> onClick={() =&gt; alert(user.accessToken)}&gt;What is my access token?&lt;/<strong class="lb hj">button</strong>&gt;<br/> &lt;/<strong class="lb hj">div</strong>&gt;<br/> &lt;/<strong class="lb hj">div</strong>&gt;<br/> )}<br/> &lt;/<strong class="lb hj">div</strong>&gt;<br/> );<br/>}<br/>export default App;</span></pre><p id="22bd" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在我们已经完成了前端部分，我们可以在localhost:3000/account/login上测试我们的应用程序了。</p><p id="5e23" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，让我们开始用NodeJS制作我们的后端。</p><p id="318f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">首先，我们将导入一些库来开始设置我们的后端。</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="0d7a" class="lf ju hi lb b fi lg lh l li lj">const express = require(“express”);<br/>const jwt = require(“jwt”);<br/>const nodemailer = require(“nodemailer”);<br/>const PORT = process.env.PORT || 5000;<br/>const app = express();<br/>app.use(cors());<br/>app.use(express.json());<br/>app.use(express.urlencoded({ extended: false }));</span></pre><p id="8060" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们将设置我们的登录端点，向我们的用户发送一个链接来登录他们的帐户。</p><p id="e7c3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">代码如下:</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="0a76" class="lf ju hi lb b fi lg lh l li lj"> app.post(“/login”, (req, res) =&gt; {<br/> const email = req.body.email;<br/> if (!email) {<br/> res.status(404).json({<br/> message: “There is no email address that matches this”,<br/> });<br/> }<br/> if (email) {<br/> const token = jwt.sign(<br/> {<br/> email,<br/> },<br/> process.env.JWT_SECRET,<br/> {<br/> expiresIn: “1h”,<br/> }<br/> );<br/> let transport = nodemailer.createTransport({<br/> host: “smtp.gmail.com”,<br/> port: 465,<br/> secure: true,<br/> auth: {<br/> user: process.env.EMAIL_USERNAME,<br/> pass: process.env.EMAIL_PASSWORD,<br/> },<br/> });<br/> const mailOptions = {<br/> from: “sender@gmail.com”, // Sender address<br/> to: “receiver@gmail.com”, // List of recipients<br/> subject: “Account log in”, // Subject line<br/> html: `<br/> &lt;p&gt;Hey ${username},<br/> Click on this link to log in to your account: http://localhost:5000/activate?token=${token}&lt;/p&gt;<br/> `,<br/> };<br/> return transport.sendMail(mailOptions, function (err, info) {<br/> if (err) {<br/> console.log(err);<br/> return res.status(404).json({message: “Email not send”});<br/> } else {<br/> console.log(info);<br/> }<br/> });<br/> }<br/>});</span></pre><p id="c3e9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在上面的代码中，我们首先检查电子邮件是否存在。如果电子邮件存在，我们制作了一个<a class="ae iu" href="https://jwt.io/" rel="noopener ugc nofollow" target="_blank"> JWT </a>令牌来存储用户电子邮件，有效期为1小时。</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="c1be" class="lf ju hi lb b fi lg lh l li lj">const token = jwt.sign(<br/> {<br/> email,<br/> },<br/> process.env.JWT_SECRET,<br/> {<br/> expiresIn: “1h”,<br/> }<br/> );</span></pre><p id="6600" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然后，我们使用HTML模板制作一个传送器来发送包含登录链接的电子邮件。</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="2a8c" class="lf ju hi lb b fi lg lh l li lj">let transport = nodemailer.createTransport({<br/> host: “smtp.gmail.com”,<br/> port: 465,<br/> secure: true,<br/> auth: {<br/> user: process.env.EMAIL_USERNAME,<br/> pass: process.env.EMAIL_PASSWORD,<br/> },<br/> });<br/> const mailOptions = {<br/> from: “sender@gmail.com”, // Sender address<br/> to: “receiver@gmail.com”, // List of recipients<br/> subject: “Account log in”, // Subject line<br/> html: `<br/> &lt;p&gt;Hey ${username},<br/> Click on this link to log in to your account: http://localhost:5000/account?token=${token}&lt;/p&gt;<br/> `,<br/> };</span></pre><p id="05e1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们已经完成了登录部分。我们现在将关注我们的帐户端点，以验证包含用户信息的令牌。</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="155d" class="lf ju hi lb b fi lg lh l li lj"> app.get(“/account”, (req, res) =&gt; {<br/> // get the token and check its details<br/> const { token } = req.body;<br/> if (token) {<br/> jwt.verify(token, process.env.JWT_SECRET, (err, decoded) =&gt; {<br/> if (err) {<br/> return res.status(403).json({<br/> errors: “Expired link. Signup again”,<br/> });<br/> } else {<br/> return res.status(200).json({<br/> message: “User identity has been verified”,<br/> });<br/> }<br/> });<br/> } else {<br/> console.log(“error in activation”);<br/> return res.status(403).json({<br/> message: “please try again later”,<br/> });<br/> }<br/>});</span></pre><p id="f166" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在上面的代码中，首先，我们用从前端接收到的令牌初始化令牌变量。然后，我们检查令牌是否存在。如果令牌存在，我们使用<code class="du lk ll lm lb b">jwt.verify()</code>方法验证它的到期时间。如果在验证中出现任何错误，前端的用户将收到一个错误。否则，系统将授予用户访问其功能的权限。</p><h1 id="dbd6" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">结论</h1><p id="04a2" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">在本教程中，我们学习了如何使用带有React和NodeJS的现代用户管理系统Frontegg来创建无密码认证系统。</p><p id="4d2e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这种无密码认证系统也有利于不喜欢多步认证过程并且经常忘记密码的用户。它有助于优化用户体验，并使SaaS公司能够将重点从用户管理转移到产品开发和客户问题上。</p></div></div>    
</body>
</html>