<html>
<head>
<title>Using Mailcow as a Mail Server</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Mailcow作为邮件服务器</h1>
<blockquote>原文：<a href="https://medium.com/codex/using-mailcow-as-a-mail-server-edfabb050e8?source=collection_archive---------1-----------------------#2021-04-10">https://medium.com/codex/using-mailcow-as-a-mail-server-edfabb050e8?source=collection_archive---------1-----------------------#2021-04-10</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="ef20" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你听说过mailcow吗？我最近买了一个新的域名，想建立一个邮件服务器。在完全自己设置和使用第三方服务之间做出选择，我运行了基于docker的邮件服务器套件，名为“<em class="jd"> mailcow </em>”。</p></div><div class="ab cl je jf gp jg" role="separator"><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj"/></div><div class="hb hc hd he hf"><p id="6b5c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Mailcow是一个dockerized，似乎很容易管理的邮件服务器套件。在这篇文章中，我想写下我使用Mailcow的头几个月的经历，并最终得出结论，使用它可能有哪些缺点，以及在我看来是否值得。</p><h1 id="e214" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">该装置</h1><p id="71dc" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated">首先，我显然必须安装Mailcow。安装本身实际上非常简单。但是，有几个先决条件:</p><ul class=""><li id="bf7a" class="ko kp hi ih b ii ij im in iq kq iu kr iy ks jc kt ku kv kw bi translated">你需要安装Docker和Docker Compose(如他们各自的网站所述)</li><li id="fd5a" class="ko kp hi ih b ii kx im ky iq kz iu la iy lb jc kt ku kv kw bi translated">由于Mailcow附带了一个完全集成的群件，它有时会占用大量资源。不过，这些组件中有许多是可以禁用的，对于普通用户来说并不是真正必要的。</li></ul><p id="74f5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">记住这些，我们可以通过克隆mailcow-dockerized的git存储库来开始安装(记住要为此使用合适的目录——我个人使用的是<em class="jd"> /opt/mailcow-dockerized/ </em>):</p><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="08df" class="ll jm hi lh b fi lm ln l lo lp"># git clone <a class="ae lq" href="https://github.com/mailcow/mailcow-dockerized" rel="noopener ugc nofollow" target="_blank">https://github.com/mailcow/mailcow-dockerized</a> &amp;&amp; cd mailcow-dockerized/</span></pre><p id="419a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">克隆完成后，我们可以运行包含的<em class="jd"> generate_config.sh </em>脚本，以交互方式生成必要的配置文件。最后，我们可以像启动任何其他docker compose项目一样启动mailcow。也就是说，我们运行:</p><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="8d6b" class="ll jm hi lh b fi lm ln l lo lp"># docker-compose pull &amp;&amp; docker-compose up -d</span></pre><p id="eb66" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，您应该能够通过导航到您在配置生成过程中指定的主机名来访问Mailcow的web界面。在我的例子中，我创建了一个<code class="du lr ls lt lh b">mail</code>子域。您应该能够使用凭证<code class="du lr ls lt lh b">admin / moohoo</code>登录(并随后更改这些凭证)。</p><h2 id="9268" class="ll jm hi bd jn lu lv lw jr lx ly lz jv iq ma mb jz iu mc md kd iy me mf kh mg bi translated">设置域</h2><figure class="lc ld le lf fd mi er es paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="er es mh"><img src="../Images/3201b4d552cc5caab40581bfdc8518e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FEyLRk7Jjq6CiWAaG7pXsA.png"/></div></div><figcaption class="mp mq et er es mr ms bd b be z dx translated">添加域</figcaption></figure><p id="e51f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">更改密码后，您的第一个操作可能是添加您的域。这可以在<em class="jd">配置→邮件设置→域→添加域</em>中完成，只需填写您的FQDN即可——以后一切都可以更改。一旦你完成了这些，你就可以打开DNS对话框来查看Mailcow建议你创建/修改的DNS记录。就我而言，我已经自己创建了其中的大部分。<strong class="ih hj">请记住:根据您的TTL，您的记录可能需要一段时间才能在全球范围内可用，因此您可以发送和接收邮件！</strong></p><figure class="lc ld le lf fd mi er es paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="er es mh"><img src="../Images/df1e8d7e62fda2d54bce2496f67e907a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GJCKdjR03Mdv-48fp94eQw.png"/></div></div><figcaption class="mp mq et er es mr ms bd b be z dx translated">我的邮箱建议的DNS记录</figcaption></figure><p id="5290" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建了所有必要的记录后，我还想使用<em class="jd"> DKIM </em>。为此，我必须导航到<em class="jd">配置→配置&amp;细节→配置→ ARC/DKIM密钥</em>并为各自的域生成一个密钥。一旦你生成了密钥，回到前面提到的DNS记录对话框；现在应该可以看到一个<code class="du lr ls lt lh b">dkim._domainkey.yourdomain</code>记录(TXT)。一旦你创建了这个记录，<em class="jd"> DKIM </em>就应该工作了。</p><h2 id="33cb" class="ll jm hi bd jn lu lv lw jr lx ly lz jv iq ma mb jz iu mc md kd iy me mf kh mg bi translated">设置邮箱</h2><figure class="lc ld le lf fd mi er es paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="er es mh"><img src="../Images/8ea9b002f8ba32f0e9e816ef3d80b399.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SdtREj8R8PXOmknzAKDZQA.png"/></div></div><figcaption class="mp mq et er es mr ms bd b be z dx translated">添加新邮箱</figcaption></figure><p id="494a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我的下一步是开始设置邮箱。这和添加域一样简单，可以在<em class="jd">配置→邮件设置→邮箱→添加邮箱中完成。</em>接下来的对话要求您输入用户名(即电子邮件地址的左边部分)和密码。如果您有多个域名，请确保选择正确的域名！</p><h2 id="1fef" class="ll jm hi bd jn lu lv lw jr lx ly lz jv iq ma mb jz iu mc md kd iy me mf kh mg bi translated">发送和接收邮件</h2><figure class="lc ld le lf fd mi er es paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="er es mh"><img src="../Images/fe849bea0a01321a3478f96b29cf7d17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h2IVsBHljTAEhViTqT6CWA.png"/></div></div><figcaption class="mp mq et er es mr ms bd b be z dx translated">SOGo群件为您提供了一个网络邮件系统</figcaption></figure><p id="db2f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">到目前为止，我们已经可以开始收发邮件了。你可以直接使用<em class="jd"> SMTP/IMAP </em>或者使用内置的群件<em class="jd"> SOGo </em>来实现。由于前者可能是不言自明的(只需使用Mailcow的主机名作为<em class="jd">SMTP</em>&amp;<em class="jd">IMAP</em>服务器)，在这一点上我将采用第二种方法。您可以在<code class="du lr ls lt lh b">https://{MAILCOW_HOSTNAME}/SOGo</code>访问您的Mailcow的<em class="jd"> SOGo </em>实例，并使用您刚刚选择的用户名和密码登录。顺便说一下，SOGo 也为你提供了可同步的日历和联系人管理。此外，<em class="jd"> SOGo </em>支持<strong class="ih hj"> <em class="jd"> ActiveSync </em> </strong> —也就是说，您可以将您的邮件帐户添加为Exchange帐户，从而获得即时推送通知！</p><figure class="lc ld le lf fd mi er es paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="er es mt"><img src="../Images/ebf42182aa2edea47f730177f0cb40dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TFatXFhRZ-CmY7FMl4FBtg.png"/></div></div><figcaption class="mp mq et er es mr ms bd b be z dx translated">从用户的角度看mailcow用户界面</figcaption></figure><p id="723a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后但同样重要的是，不仅管理员可以登录到<em class="jd"> mailcow UI </em>(您刚刚添加邮箱的那个)。用户也可以随后为自己创建临时别名、查看隔离邮件、更改密码或调整垃圾邮件过滤器的敏感度。此外，mailcow允许iOS/macOS用户下载一个<strong class="ih hj"> <em class="jd">配置描述文件，</em> </strong>自动设置他们的帐户。</p><h1 id="ba24" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">管理功能</h1><p id="f0a0" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated">我发现mailcow最棒的一点是我们提供了大量的管理功能。其中包括:</p><ul class=""><li id="5a6c" class="ko kp hi ih b ii ij im in iq kq iu kr iy ks jc kt ku kv kw bi translated">别名、临时别名和域别名</li><li id="cd19" class="ko kp hi ih b ii kx im ky iq kz iu la iy lb jc kt ku kv kw bi translated">资源(例如，您可以将物理房间作为资源进行管理，邀请它参加日历活动，从而查看它的使用情况等。)</li><li id="c99a" class="ko kp hi ih b ii kx im ky iq kz iu la iy lb jc kt ku kv kw bi translated">同步作业</li><li id="f51d" class="ko kp hi ih b ii kx im ky iq kz iu la iy lb jc kt ku kv kw bi translated">过滤器和地址重写(不是Mailcow独有的，但是非常容易管理)</li><li id="e624" class="ko kp hi ih b ii kx im ky iq kz iu la iy lb jc kt ku kv kw bi translated">多个管理用户，以及特定于域的管理帐户</li><li id="0156" class="ko kp hi ih b ii kx im ky iq kz iu la iy lb jc kt ku kv kw bi translated">一个扩展的REST API</li><li id="c7bf" class="ko kp hi ih b ii kx im ky iq kz iu la iy lb jc kt ku kv kw bi translated">oauth 2-支持</li><li id="26df" class="ko kp hi ih b ii kx im ky iq kz iu la iy lb jc kt ku kv kw bi translated">自动SSL证书生成和续订</li></ul><h1 id="e772" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">更新Mailcow</h1><p id="874b" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated">我们所有人的一个共同任务是保持事物的最新状态。使用mailcow，我们可以很容易地做到这一点，只需转到我们的mailcow目录并运行:</p><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="3240" class="ll jm hi lh b fi lm ln l lo lp"># ./update.sh</span></pre><p id="c071" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该脚本将更新配置文件和所有docker容器(有时可能需要很长时间)。有时，更新脚本本身已经改变，这将要求您运行它两次(但是，它会要求您这样做)。重要的文件已经提前备份了。</p><h1 id="717c" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">在低内存环境中使用Mailcow</h1><p id="8e0e" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated">我曾经在一个只有2GB内存的开发服务器上安装了mailcow，随后就遇到了mailcow内存不足的问题。在这种情况下，您可以通过禁用<em class="jd"> mailcow.conf </em>文件中的<em class="jd"> ClamAV </em>和<em class="jd"> Solr </em>来大幅减少mailcow的RAM使用，而不会影响其大部分功能:</p><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="c082" class="ll jm hi lh b fi lm ln l lo lp">SKIP_CLAMD=y<br/>SKIP_SOLR=y</span></pre><p id="6094" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过docker compose重新启动mailcow后，它应该使用更少的内存。</p><h1 id="ae54" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">我的经历</h1><p id="2589" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated">我已经使用mailcow大约一年半了，我对它非常满意。我一直在为我自己和我的家人使用它，我没有遇到任何明显的困难或问题。它非常适合我的用例。</p><p id="e943" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此外，我认为非常积极的一点是，mailcow不仅得到了维护，而且得到了积极的扩展和发展。当我回想并比较我大约一年前安装的套件和今天的安装时，其间有许多新引入的功能。此外，配置非常简单:大多数事情可以使用管理web界面立即完成——大多数其他事情可以通过中央<code class="du lr ls lt lh b">mailcow.conf</code>配置文件完成。</p><h2 id="07d4" class="ll jm hi bd jn lu lv lw jr lx ly lz jv iq ma mb jz iu mc md kd iy me mf kh mg bi translated">不足之处</h2><p id="d582" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated">在我看来，最大的缺点就是套件太泛。大多数功能我从未使用过。例如，mailcow带有一个XMPP消息服务器，或者一个设备齐全的群件。虽然肯定有这样的用例，但我们大多数人可能不会经常使用它们。但是，这些服务中有许多可以通过配置文件手动禁用。作为一名开发人员，经常困扰我的一件事是REST API没有得到很好的记录。不过，我不得不承认，随着<a class="ae lq" href="https://mailcow.docs.apiary.io/#" rel="noopener ugc nofollow" target="_blank">文档</a>的开发，这已经变得更好了。</p><h1 id="7683" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">我的裁决</h1><p id="cfcd" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated">我认为Mailcow是一个很棒的邮件服务器套件，尽管并不适合所有人。对于像我这样不关注邮件服务器管理的人来说，mailcow是拥有自己的、功能齐全的邮件服务器的一个非常好的方式，而不必花费大量的时间来微调它的配置。还有一个你可以获得支持的社区。不过，我认为，我们当中也有一些人更愿意“手动”配置他们的服务器，并对他们的系统拥有绝对的控制权。虽然使用mailcow也可以做到这一点，但在这种情况下，不使用mailcow可能更容易。</p></div></div>    
</body>
</html>