<html>
<head>
<title>SOAP WebService From ABAP FM</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">来自ABAP FM的SOAP网络服务</h1>
<blockquote>原文：<a href="https://medium.com/codex/soap-webservice-from-abap-fm-d53bc43b5b8d?source=collection_archive---------0-----------------------#2020-11-27">https://medium.com/codex/soap-webservice-from-abap-fm-d53bc43b5b8d?source=collection_archive---------0-----------------------#2020-11-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="f134" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">SAP ABAP是由德国软件公司SAP SE创建的高级编程语言。ABAP广泛用于基于SAP NetWeaver应用服务器的各种系统的编程，包括SAP Business Warehouse (BW)。SAP BW是面向企业数据仓库(DWH)的软件，是欧洲最受欢迎的解决方案之一。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/9c51afe79c84ea53b5f8c1a677c41167.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*MgCzt7ZZT-hrXYsboz0OvA.png"/></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">SAP Business Warehouse徽标</figcaption></figure><p id="06dd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">SAP BW支持的很大一部分日常工作时间通常用于规划、启动和分析流程链。过程链用于组织数据操作过程，如提取、转换和加载(ETL)。持续监控流程链的执行非常重要，因为许多业务决策都依赖于来自数据仓库的报告。</p><p id="a107" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本文中，我将描述基于运行在SAP BW实例内部的ABAP功能模块(FM)的SOAP web服务的创建和部署过程。下一次，我将展示如何从您的SOAP web服务消费信息，并在前端显示它。您可以使用这种方法从任何地方监控流程链的执行。通过主动监控BW系统中ETL过程的故障，可以帮助防止错误的管理决策和不正确的数据分析。</p></div><div class="ab cl jp jq gp jr" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="hb hc hd he hf"><p id="b827" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，您应该创建FM，它将作为SOAP web服务的后端。可以从Eclipse(带有ADT插件)或使用T代码SE80通过SAP登录来创建FM。我们将使用新表中的重要流程链。让我们用名称<strong class="ih hj"> ZBW_CHAIN </strong>创建它，并用进程链<strong class="ih hj"> ZCHAIN_TEST </strong>向它插入一个新行。(出于我自己将来的需要，我添加了第二列REF_CHAIN，这是我们在本文中不需要的。)</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jw"><img src="../Images/bec3f0493d4362a9d8c7362a1552603f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1162/format:webp/1*Ls0tqNuuxwbv0KfnUTbMjw.png"/></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">ZBW_CHAIN表中的重要流程链</figcaption></figure><p id="ea47" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们希望监控最后一个流程链运行的状态、日期和时间。该信息可以从SAP BW系统表<strong class="ih hj">rsclogchain</strong>中收集。您可以使用SQL INNER JOIN从该表中选择日志数据，该表仅由存储在<strong class="ih hj"> ZBW_CHAIN </strong>中的重要流程链过滤。FM将从网络中接收两个允许的命令之一(<strong class="ih hj"> /start </strong>或<strong class="ih hj"> /status </strong>)，并返回一条包含每个命令执行信息的消息。这是FM的ABAP代码示例(请不要忘记在首选项中将您的新FM类型更改为启用RFC):</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="jx jy l"/></div></figure><p id="f12e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以使用T代码<strong class="ih hj"> SE37 </strong>在您的BW系统中测试新的FM。如果它工作没有任何错误，那么可能你做了上述所有正确的。</p><p id="ff56" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">其次，您应该通过标准的SAP NetWeaver功能创建一个web服务。在<strong class="ih hj"> SE37 </strong>中，进入菜单Utilities，从功能模块中选择More Utilities-&gt;Create Web Service-&gt;:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="er es jz"><img src="../Images/76587f9c1dc8f99a36a586020727f5bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2lml2fyJsq7L1aFO2mAugg.png"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">用于创建web服务的菜单项</figcaption></figure><p id="4176" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为新的web服务选择任意名称，即<strong class="ih hj"> ZSDI_CHAINS </strong>，并输入最近创建的功能模块的名称(<strong class="ih hj"> ZSDI_GETSTATUS_RFC </strong>):</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="er es ke"><img src="../Images/5dafe6e8a727d967abc2097610ed33fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Jb7tUVcN-4ZvqX6pHU2jyg.png"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">为功能模块创建web服务</figcaption></figure><p id="4767" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在是为您的全新web服务选择端点的时候了。如果没有端点，就无法从网络访问web服务。使用T-Code <strong class="ih hj"> SOAMANAGER </strong>，选择Web服务配置:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kf"><img src="../Images/8de347a35e2e364f0558045f44da35ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1118/format:webp/1*-l1ZcHPIazYZx_PUGtXoig.png"/></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">t代码SOAMANAGER视图</figcaption></figure><p id="76b0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在打开的窗口中按名称查找您的web服务，并在搜索结果列表中单击其名称:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="er es kg"><img src="../Images/9fd9b5c1b109898f3f3c7c15fa414960.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zNfPt9YgTy7Cq3s_zQxVlA.png"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">按名称搜索服务</figcaption></figure><p id="0764" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在“配置”选项卡上，按“创建服务”按钮，并按照说明进行操作。您将被要求输入新端点的授权类型，我选择了通过用户和密码进行基本授权(您必须在SAP BW系统中拥有一个对RFC调用具有有效权限的帐户，才能使用此选项):</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kh"><img src="../Images/c83fedf598c5715fff62cb012a3661a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:866/format:webp/1*Y3l9QMndy58Q8dpOA4Ki-A.png"/></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">创建新端点</figcaption></figure><p id="c4ac" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在创建了一个新的端点(在我的例子中它被命名为<strong class="ih hj"> processChains </strong>)之后，您应该会看到类似这样的内容:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ki"><img src="../Images/91a801f319c0d3cf59a93ff01bd719bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:942/format:webp/1*iDtTbj52Jpxr5RiFQ6o27Q.png"/></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">web服务的端点列表</figcaption></figure><p id="7f19" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，您的SOAP服务已经联机，可以接受来自网络的请求。为了测试它，你可以使用像SoapUI这样的软件。要在SoapUI中添加一个新的SOAP-service项目，您需要获得一个WSDL文件。先前图像中的圆圈图标将带您到服务描述，在那里可以找到WSDL文件的链接。从“WSDL绑定的URL”复制它。如果它是空的，使用位于那里的按钮生成一个新的:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="er es kj"><img src="../Images/5a0f37d1a1cde66ab20d83f6c00af57a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Av4b_fjk17aO0swcd_7Jdw.png"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">web服务的WSDL生成</figcaption></figure><p id="a1fd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在使用SoapUI中的SOAP按钮创建一个新项目。将WSDL文件的链接粘贴到初始的WSDL字段，然后按确定:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="er es kk"><img src="../Images/7ea20680cdde6ff96f48394e7a3e56db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*psUa9Fe6ABdLAbmp-U6ykw.png"/></div></div></figure><p id="49f3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">WSDL文件提供了SOAP-service拥有的所有方法的信息，并帮助识别它们的所有输入和输出参数。您可以在左边看到您之前在SAP系统中创建的<strong class="ih hj"> processChain </strong>方法。在请求1 (1)上单击两次，并在该窗口底部的授权选项卡(2)上添加具有基本授权类型(3)的用户/密码:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="er es kl"><img src="../Images/37cd0bfb626bcff48546a1fdfdc37595.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S-McRB-5t5X-qvVEleZLgw.png"/></div></div></figure><p id="9920" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在尝试通过按绿色按钮(或按键盘上的Alt+Enter)来调用web服务。你会看到ABAP调频的回答。尝试请求中的<strong class="ih hj"> &lt; I_COMMAND &gt; </strong>和<strong class="ih hj"> &lt; /I_COMMAND &gt; </strong>标签之间允许的命令之一(<strong class="ih hj"> /start </strong>或<strong class="ih hj"> /status </strong>)。</p><p id="08c9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">基于ABAP FM的Web服务现已上线，并从SAP BW系统内部提供有关流程链执行的信息！</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="er es km"><img src="../Images/f37d91389a9463dce807082c4c4cf456.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j_SR5kJHY6q1aen8UXkDJw.png"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">SoapUI中的SOAP请求和响应</figcaption></figure></div></div>    
</body>
</html>