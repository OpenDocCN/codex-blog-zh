<html>
<head>
<title>How to Get Currency Exchange Rates in Laravel</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何获取拉韦勒的货币汇率</h1>
<blockquote>原文：<a href="https://medium.com/codex/how-to-get-currency-exchange-rates-in-laravel-a4e053bde494?source=collection_archive---------3-----------------------#2021-10-21">https://medium.com/codex/how-to-get-currency-exchange-rates-in-laravel-a4e053bde494?source=collection_archive---------3-----------------------#2021-10-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/72e17786364fa6cb1200cf4f4f1a5f47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TAJyXRcXBpKR3vFQgKJZWQ.png"/></div></div></figure><h1 id="0967" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">介绍</h1><p id="15d0" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">有时，当您构建web应用程序时，您可能需要一些功能来处理来自世界各地的不同货币。为了能够处理不同的货币，你需要找到汇率。</p><p id="b5e0" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">在本文中，我们将了解如何使用<a class="ae kr" href="https://github.com/ash-jc-allen/laravel-exchange-rates" rel="noopener ugc nofollow" target="_blank"> Laravel汇率</a>包与<a class="ae kr" href="http://exchangeratesapi.io" rel="noopener ugc nofollow" target="_blank">Exchange ratesapi . io</a>API进行交互。我们还将了解如何使用它来获取最新或历史汇率，并在不同货币之间转换货币值。</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ks"><img src="../Images/c93c5ac0690d4166f44f96b4fca80de2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*rcmdFBzRxa0U5ePf.png"/></div></div></figure><h1 id="b1eb" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">装置</h1><p id="7f35" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">要开始使用Laravel汇率包，我们首先需要运行以下命令来使用Composer安装它:</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="1a41" class="lc ir hi ky b fi ld le l lf lg">composer require ashallendesign/laravel-exchange-rates</span></pre><h1 id="9cea" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">获取您的API密钥</h1><p id="ae6c" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">现在我们已经安装了这个包，我们需要从<a class="ae kr" href="https://exchangeratesapi.io/pricing" rel="noopener ugc nofollow" target="_blank">https://exchangeratesapi.io/pricing</a>获得一个API密匙。您可以免费注册或使用付费层，这取决于您需要访问哪些功能。</p><h1 id="3866" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">配置</h1><p id="323b" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">现在，您可以使用以下命令发布包的配置文件:</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="3f51" class="lc ir hi ky b fi ld le l lf lg">php artisan vendor:publish --provider="AshAllenDesign\LaravelExchangeRates\Providers\ExchangeRatesProvider"</span></pre><p id="60c0" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">您现在应该有了一个新的<code class="du lh li lj ky b">config/laravel-exchange-rates.php</code>文件。默认情况下，包的配置设置为通过HTTP发出请求。但是，如果你在一个生产环境中，并且使用API的一个付费层，我强烈推荐使用HTTPS。为此，您可以简单地将配置文件更新为，并将<code class="du lh li lj ky b">api_url</code>字段更改为以<code class="du lh li lj ky b">https://</code>开头，而不是以<code class="du lh li lj ky b"><a class="ae kr" rel="noopener ugc nofollow" target="_blank" href="/">http://</a></code> <a class="ae kr" rel="noopener ugc nofollow" target="_blank" href="/"> : </a>开头</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="60ce" class="lc ir hi ky b fi ld le l lf lg">return [<br/>  <br/>    // ...<br/><br/>    'api_url' =&gt; env('EXCHANGE_RATES_API_URL', 'http://api.exchangeratesapi.io/v1/'),<br/><br/>    // ...<br/>  <br/>];</span></pre><p id="0070" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">您还需要确保将您的API密钥添加到您的<code class="du lh li lj ky b">.env</code>中:</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="adf1" class="lc ir hi ky b fi ld le l lf lg">EXCHANGE_RATES_API_KEY={Your-API-Key-Here}</span></pre><h1 id="ebc9" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">获取单个日期的汇率</h1><p id="8a99" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">为了将一种货币兑换成另一种货币，我们可以使用包的<code class="du lh li lj ky b">-&gt;exchangeRate()</code>方法。</p><p id="5a52" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">如果我们想得到今天英镑对欧元的汇率，我们可以这样写:</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="15fa" class="lc ir hi ky b fi ld le l lf lg">$exchangeRates = new ExchangeRate();<br/>$result = $exchangeRates-&gt;exchangeRate('GBP', 'EUR');<br/><br/>// $result: '1.10086'</span></pre><p id="b5bd" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">然而，如果我们想要获得特定日期的交换，我们可以传递一个我们想要的日期的<code class="du lh li lj ky b">Carbon</code>日期对象。例如，如果我们想获得2021年1月1日从“英镑”到“欧元”的汇率，我们可以使用以下公式:</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="498b" class="lc ir hi ky b fi ld le l lf lg">$exchangeRates = new ExchangeRate();<br/>$result = $exchangeRates-&gt;exchangeRate('GBP', 'EUR', Carbon::create('2021-01-01'));<br/><br/>// $result: '1.10086'</span></pre><h1 id="144d" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">获取两个日期之间的汇率</h1><p id="6352" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">如果我们想获得给定日期范围内两种货币之间的汇率，我们可以使用包的<code class="du lh li lj ky b">-&gt;exchangeRateBetweenDateRange()</code>方法。</p><p id="804f" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">假设我们想获取过去3天英镑对欧元的汇率。我们可以这样写代码:</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="450e" class="lc ir hi ky b fi ld le l lf lg">$exchangeRates = new ExchangeRate();<br/>$result = $exchangeRates-&gt;exchangeRateBetweenDateRange(<br/>    'GBP',<br/>    'EUR',<br/>    Carbon::now()-&gt;subDays(3),<br/>    Carbon::now(),<br/>);<br/><br/>// $result: [<br/>//     '2021-07-07' =&gt; 1.1092623405<br/>//     '2021-07-08' =&gt; 1.1120625424<br/>//     '2021-07-09' =&gt; 1.1153867604<br/>// ];</span></pre><h1 id="842f" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">转换单一日期的货币</h1><p id="959e" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">该软件包不仅允许我们获取货币之间的汇率，还允许我们将货币价值从一种货币转换为另一种货币。为此，我们可以使用<code class="du lh li lj ky b">-&gt;convert()</code>方法。</p><p id="b0bd" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">例如，我们可以用今天的汇率将1英镑兑换成欧元:</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="bbcf" class="lc ir hi ky b fi ld le l lf lg">$exchangeRates = new ExchangeRate();<br/>$result = $exchangeRates-&gt;convert(100, 'GBP', 'EUR', Carbon::now());<br/><br/>// $result: 110.15884906</span></pre><p id="c8b4" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">您可能已经注意到，我们将<code class="du lh li lj ky b">100</code>作为第一个参数传递。这是因为该包要求我们以货币的最低面额传递货币值。例如，在这种情况下，我们希望转换1，所以我们传递100，因为1等于100便士。</p><h1 id="1fbd" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">在两个日期之间转换货币</h1><p id="c1f6" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">类似于获取日期范围之间的汇率，您还可以使用包将货币值从一种货币转换为另一种货币。为此我们可以使用<code class="du lh li lj ky b">-&gt;convertBetweenDateRange()</code>方法。</p><p id="a899" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">假设我们想使用过去3天的汇率将1英镑兑换成欧元。我们可以这样写代码:</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="8069" class="lc ir hi ky b fi ld le l lf lg">exchangeRates = new ExchangeRate();<br/>$exchangeRates-&gt;convertBetweenDateRange(<br/>    100,<br/>    'GBP',<br/>    'EUR',<br/>    Carbon::now()-&gt;subDays(3),<br/>    Carbon::now()<br/>);<br/><br/>// $result: [<br/>//     '2020-07-07' =&gt; 110.92623405,<br/>//     '2020-07-08' =&gt; 111.20625424,<br/>//     '2020-07-09' =&gt; 111.53867604,<br/>// ];</span></pre><h1 id="c58b" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">通过使用包的缓存来提高性能</h1><p id="133e" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">默认情况下，来自<a class="ae kr" href="http://exchangeratesapi.io" rel="noopener ugc nofollow" target="_blank"> exchangeratesapi.io </a> API的所有API响应都被包缓存。这可以显著提高性能并减少服务器的带宽。这也是有益的，因为如果您已经获取了过去的汇率，它可以防止您使用一些每月的API请求。</p><p id="3869" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">但是，如果出于某种原因，您需要来自API的新结果，而不是缓存的结果，那么pacakge提供了一个我们可以使用的<code class="du lh li lj ky b">-&gt;shouldBustCache()</code>方法。</p><p id="38bb" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">让我们看看如何从API中获取新的汇率，并忽略任何缓存的汇率:</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="fe53" class="lc ir hi ky b fi ld le l lf lg">$exchangeRates = new ExchangeRate();<br/>$exchangeRates-&gt;shouldBustCache()-&gt;convert(100, 'GBP', 'EUR', Carbon::now());</span></pre><h1 id="6e89" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">使用包的验证规则</h1><p id="5539" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">有时，您可能允许用户选择要兑换的货币。在这种情况下，确保您的用户只能输入汇率API支持的货币非常重要。</p><p id="77f0" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">为了有助于这一点，Laravel汇率有自己的<code class="du lh li lj ky b">ValidCurrency</code>规则来验证货币。</p><p id="8d65" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">假设我们有一个表单请求，用于验证请求中发送的货币。我们的表单请求可能看起来有点像这样:</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="adfb" class="lc ir hi ky b fi ld le l lf lg">&lt;?php<br/><br/>namespace App\Http\Requests;<br/><br/>use AshAllenDesign\LaravelExchangeRates\Rules\ValidCurrency;<br/>use Illuminate\Foundation\Http\FormRequest;<br/><br/>class MyAwesomeRequest extends FormRequest<br/>{<br/>    // ...<br/>  <br/>    public function rules(): array<br/>    {<br/>        return [<br/>            'currency' =&gt; ['required', new ValidCurrency()],<br/>        ];<br/>    }<br/>  <br/>    // ...<br/>}</span></pre><h1 id="37d7" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">试验</h1><p id="5a49" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">如果您正在为处理Laravel汇率包的代码编写测试，您可能希望阻止任何API请求被实际发出。出于这个原因，您可能希望使用依赖注入或使用软件包提供的facade来实例化<code class="du lh li lj ky b">ExchangeRate</code>类。事实上，如果你有兴趣阅读更多关于这方面的内容，我建议你阅读一下我的<a class="ae kr" href="https://ashallendesign.co.uk/blog/how-to-make-your-laravel-app-more-testable" rel="noopener ugc nofollow" target="_blank">如何让你的Laravel应用程序更具可测试性</a>的文章。</p><p id="1871" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">让我们快速地看一下如何为一个控制器方法编写一个基本测试，该方法获取今天从“英镑”到“欧元”的汇率。我们的控制器可能看起来像这样:</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="d381" class="lc ir hi ky b fi ld le l lf lg">use AshAllenDesign\LaravelExchangeRates\Classes\ExchangeRate;<br/>use Illuminate\Http\JsonResponse;<br/>use Illuminate\Http\Request;<br/><br/>class MyAwesomeController extends Controller<br/>{<br/>    public function __invoke(Request $request, ExchangeRate $exchangeRate): JsonResponse<br/>    {<br/>        $rate = $exchangeRates-&gt;exchangeRate('GBP', 'EUR');<br/><br/>        return response()-&gt;json(['rate' =&gt; $rate]);<br/>    }<br/>}</span></pre><p id="c452" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">现在，让我们为这个控制器方法编写一个测试。我们将假设该方法的路由名称是<code class="du lh li lj ky b">awesome.route</code>。我们的测试可能看起来像这样:</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="cf93" class="lc ir hi ky b fi ld le l lf lg">use AshAllenDesign\LaravelExchangeRates\Classes\ExchangeRate;<br/>use Mockery\MockInterface;<br/>use Tests\TestCase;<br/><br/>class MyAwesomeControllerTest extends TestCase<br/>{<br/>    /** @test */<br/>    public function success_response_is_returned(): void<br/>    {<br/>        // Create the mock of the service class.<br/>        $this-&gt;mock(ExchangeRate::class, function (MockInterface $mock): void {<br/>            $mock-&gt;shouldReceive('exchangeRate')<br/>                -&gt;once()<br/>                -&gt;withArgs(['GBP', 'EUR'])<br/>                -&gt;andReturn(123.456);<br/>        });<br/>	<br/>        $this-&gt;postJson(route('awesome.route'))<br/>            -&gt;assertExactJson([<br/>                'rate' =&gt; 123.456<br/>            ]);<br/>    }<br/>}</span></pre><h1 id="bc78" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">结论</h1><p id="7473" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">希望本文已经向您展示了如何使用Laravel汇率包与汇率API进行交互，以获得汇率和货币转换。它还应该让您简要了解如何为使用该包的代码编写测试。</p><p id="92da" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">如果这篇文章对你有所帮助，我很乐意听听。同样，如果你对这篇文章有任何改进的反馈，我也很乐意听到。</p><p id="85ab" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">如果你有兴趣在我每次发布新帖子时得到更新，请随意<a class="ae kr" href="https://ashallendesign.co.uk/blog" rel="noopener ugc nofollow" target="_blank">注册我的简讯</a>。</p><p id="cb37" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">继续建造令人敬畏的东西！🚀</p></div><div class="ab cl lk ll gp lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="hb hc hd he hf"><p id="c401" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated"><em class="lr">原载于</em><a class="ae kr" href="https://ashallendesign.co.uk/blog/how-to-get-currency-exchange-rates-in-laravel" rel="noopener ugc nofollow" target="_blank"><em class="lr">https://ashallendesign.co.uk</em></a><em class="lr">。</em></p></div></div>    
</body>
</html>