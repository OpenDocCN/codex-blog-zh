<html>
<head>
<title>💪Consuming Bicep modules from a private registry</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">💪使用私有注册表中的Bicep模块</h1>
<blockquote>原文：<a href="https://medium.com/codex/consuming-bicep-modules-from-a-private-registry-77cc0775bcfd?source=collection_archive---------4-----------------------#2021-10-16">https://medium.com/codex/consuming-bicep-modules-from-a-private-registry-77cc0775bcfd?source=collection_archive---------4-----------------------#2021-10-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="fb9f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">了解如何轻松使用存储在私有注册表中的Bicep模块。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/0090bc122d207ae102386f2ca3d4a8bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lKW_l2BKKPKuxGsLTOxKyw.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">💪使用私有注册表中的Bicep模块</figcaption></figure></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><p id="7cb2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在之前的<a class="ae ka" rel="noopener" href="/codex/sharing-bicep-files-within-your-organization-using-a-private-registry-439294593a9b?source=friends_link&amp;sk=25c2cba024b53fcd91afb95c2d1ebda8">文章</a>中，我们回顾了如何使用私有注册表在您的组织内共享Bicep文件。本文将研究如何使用发布在私有注册中心的Bicep模块。</p><h2 id="adb7" class="kb kc hi bd kd ke kf kg kh ki kj kk kl iq km kn ko iu kp kq kr iy ks kt ku kv bi translated">先决条件:</h2><ul class=""><li id="f62e" class="kw kx hi ih b ii ky im kz iq la iu lb iy lc jc ld le lf lg bi translated">Bicep安装在您的本地机器上</li><li id="817e" class="kw kx hi ih b ii lh im li iq lj iu lk iy ll jc ld le lf lg bi translated">Azure订阅中的私有注册表</li><li id="e076" class="kw kx hi ih b ii lh im li iq lj iu lk iy ll jc ld le lf lg bi translated">私有注册表中的Bicep文件(模块)</li></ul><p id="8567" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该解决方案将由以下文件组成:</p><ul class=""><li id="6bf8" class="kw kx hi ih b ii ij im in iq lm iu ln iy lo jc ld le lf lg bi translated"><em class="lp"> main </em>:这个填充将包含参数的定义，一个资源组，并将消耗两个模块。</li><li id="b1ae" class="kw kx hi ih b ii lh im li iq lj iu lk iy ll jc ld le lf lg bi translated"><em class="lp"> appService </em>:这是一个二头肌模块，将从本地来源消费</li><li id="a7b3" class="kw kx hi ih b ii lh im li iq lj iu lk iy ll jc ld le lf lg bi translated"><em class="lp"> appServicePlan </em> —这是一个Bicep模块，将从私有注册中心使用。</li></ul><h1 id="1a1b" class="lq kc hi bd kd lr ls lt kh lu lv lw kl lx ly lz ko ma mb mc kr md me mf ku mg bi translated">使用私有注册表中的Bicep模块</h1><p id="cc56" class="pw-post-body-paragraph if ig hi ih b ii ky ik il im kz io ip iq mh is it iu mi iw ix iy mj ja jb jc hb bi translated">在下面的例子中，我们将使用Bicep创建一个web应用程序，并使用私有注册中心的Bicep模块。</p><p id="621a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了使用模块，我们提供Azure容器注册中心的名称和模块的路径，如下所示:</p><pre class="je jf jg jh fd mk ml mm mn aw mo bi"><span id="0f16" class="kb kc hi ml b fi mp mq l mr ms">module &lt;Your-Module-Symbolic-Name&gt; 'br:&lt;registry-name&gt;.azurecr.io/&lt;file-path&gt;:&lt;tag&gt;' = {</span></pre><p id="94af" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，我们将从私有注册中心的Bicep模块中提取信息；在这种情况下，私有注册表的名称是:</p><pre class="je jf jg jh fd mk ml mm mn aw mo bi"><span id="cd65" class="kb kc hi ml b fi mp mq l mr ms">azinsidercr.azurecr.io/bicep/modules/app-service-plan:v1.0</span></pre><p id="b500" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以使用Azure Portal或Azure PowerShell或Azure CLI从您的私有注册表中获取信息。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mt"><img src="../Images/4e629b393976eb9a2423938c516e95fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6esOLLl75og4fBe4zC760g.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">Bicep私人登记处</figcaption></figure><p id="9056" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下一步是定义我们的<em class="lp"> main.bicep </em>文件。该文件将包含参数和资源的定义。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="mu mv l"/></div></figure><p id="bd10" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意，我们使用两个模块:一个来自私有注册表，第二个来自本地Bicep文件。</p><p id="4863" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当引用注册表中的模块时，Visual Studio代码中的Bicep扩展将使用bicep <em class="lp"> restore </em>命令执行调用。该命令从注册表中获取所有必需模块的副本，并将这些副本存储在本地缓存中。</p><p id="6370" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们将定义<em class="lp"> appService.bicep </em>模块。下面的代码显示了这个Bicep模块的定义。</p><pre class="je jf jg jh fd mk ml mm mn aw mo bi"><span id="cd8b" class="kb kc hi ml b fi mp mq l mr ms">param appServicePrefix string<br/>param location string = 'eastus'<br/>param appServicePlanId string</span><span id="50c0" class="kb kc hi ml b fi mw mq l mr ms">resource appService 'Microsoft.Web/sites@2021-01-15' = {<br/>  name: '${appServicePrefix}site'<br/>  location: location<br/>  properties:{<br/>    siteConfig:{<br/>      linuxFxVersion: 'DOTNETCORE|3.0'<br/>    }<br/>    serverFarmId: appServicePlanId<br/>  }<br/>}<br/>// Set an output which can be accessed by the module consumer<br/>output siteURL string = appService.properties.hostNames[0]</span></pre><p id="fe73" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们将使用下面的命令继续部署<em class="lp"> main.bicep </em>文件:</p><pre class="je jf jg jh fd mk ml mm mn aw mo bi"><span id="de29" class="kb kc hi ml b fi mp mq l mr ms">New-AzDeployment -Name $deploymentName -TemplateFile .\main.bicep -Location eastus</span></pre><p id="67a0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请注意，我们的目标是订阅范围。为什么？我们将创建一个新的资源组，然后在新的资源组中部署资源。</p><p id="4749" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下图显示了部署输出:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mx"><img src="../Images/dcf6b638281fd38d9e87a533da5f20d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nh7Ein2A7snKqhtAoQ5RfA.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">部署输出。</figcaption></figure><p id="7e88" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您还可以访问Azure门户，验证新的资源组是否已随应用服务计划和应用服务一起提供，如下图所示:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es my"><img src="../Images/ea966b55edac12d0fe3a7bda06134966.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*luDtXiQKO5zxoxxrB7Aojw.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">Azure门户—部署</figcaption></figure><p id="eebe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在Bicep中使用模块非常简单，您可以轻松地在不同的部署中重用模块。</p><p id="0b6a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">👉<a class="ae ka" href="http://eepurl.com/gKmLdf" rel="noopener ugc nofollow" target="_blank"> <em class="lp">在此加入</em><strong class="ih hj"><em class="lp">azin sider</em></strong><em class="lp">邮箱列表。</em>T9】</a></p><p id="d223" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="lp">-戴夫·r·</em></p></div></div>    
</body>
</html>