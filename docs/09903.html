<html>
<head>
<title>Docker — Revenge of The Whale</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">码头工人——鲸鱼的复仇</h1>
<blockquote>原文：<a href="https://medium.com/codex/docker-revenge-of-the-whale-7ebd6a6f4488?source=collection_archive---------9-----------------------#2022-11-18">https://medium.com/codex/docker-revenge-of-the-whale-7ebd6a6f4488?source=collection_archive---------9-----------------------#2022-11-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/e31a69a4c8ab95bb7487768f65e981bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*DB-fgmX6AQxrnPQg.jpg"/></div></div></figure><p id="eec0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们留下了一些docker命令和docker的基础知识。现在，让我们像鲸鱼一样深入研究它，并回来掌握docker。</p><p id="2336" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">留给我们讨论的主题有</p><ol class=""><li id="1ec8" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn jt ju jv jw bi translated">Docker文件</li><li id="c29b" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">Docker撰写</li><li id="fc96" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">一些有用的命令</li></ol><p id="40f3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，如果我们可以用一行命令创建容器，为什么我们还需要一个文件呢？如果您必须部署10个容器，您会将该命令写10次吗？如果我在创建文件后必须在容器中运行一些命令，那么该文件的配置会怎么样呢？我不会做10次，一次又一次，这是不明智的，如果你是愚蠢的，你可以，但如果你像我一样精明，那么我们将需要像DockerFIle和Docker Compose更大的枪。</p><p id="8f0a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先，我们来讨论DockerFile。如果我通俗地说，Dockerfile是用来创建图像的。我在以前的博客中讨论过图像，如果你不知道什么是图像，看在上帝的份上，看看以前的博客或者谷歌一下，随便你怎么想。简而言之，我们可以用这个DockerFile文件创建自定义图像。</p><p id="02b1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们怎么写？好问题，如果你想说的话，它遵循一定的模式和一定的暗语。因此DockerFIle组件包括。</p><ol class=""><li id="b755" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn jt ju jv jw bi translated">从</li><li id="9eae" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">奔跑</li><li id="e23e" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">维护者</li><li id="f965" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">复制</li><li id="e65a" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">注意缺陷障碍 (Attention Deficit Disorder)</li><li id="4d0e" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">揭露</li><li id="bfcc" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">工作方向</li><li id="c88f" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">煤矿管理局</li><li id="8b0d" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">入口点</li><li id="1fa0" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">包封/包围（动词envelop的简写）</li></ol><p id="249b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">太多了？嗯，它们很简单，让我给你分解一下。</p><p id="d1b4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">“FROM”告诉docker引擎获取一个图像，比如ubuntu、arch、kali、OpenSUSE等等。“FROM”在docker文件中总是排在第一位。</p><p id="f8e8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">“RUN”告诉docker引擎在映像中运行一些命令，假设您想要更新存储库或下载一些东西。</p><p id="b0b5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">“维护者”基本上是图像创建者的作者名。那是你！对，就是你。</p><p id="8fd0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">“复制”从本地系统复制文件到镜像，你必须提供目标路径后，它只是复制它。</p><p id="0a7a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">“添加”类似于复制，但它提供了一个额外的功能，该功能是您可以从互联网上下载，然后将其包含在您的映像中。“复制”不允许这样。</p><p id="1d44" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">“EXPOSE”用于暴露映像中的端口。暴露端口意味着我们希望在映像上打开一个特定的端口，以便它可以与internet或外部网络通信，例如，HTTP的端口80或ssh的端口22等。</p><p id="064c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">“WORKDIR”用于设置创建容器的工作目录。</p><p id="520e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">“CMD”执行命令，但在容器创建期间</p><p id="86de" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">“入口点”类似于CMD，但优先级高于CMD。所以无论你在ENTRYPOINT中写什么都会被优先考虑</p><p id="f9e0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">“ENV”环境变量</p><p id="533e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在举一个Docker文件的例子，为了方便起见，我们将保持它的简单。</p><figure class="kd ke kf kg fd ij er es paragraph-image"><div class="er es kc"><img src="../Images/e04fbe60b7e65f8f089e1bee04057771.png" data-original-src="https://miro.medium.com/v2/resize:fit:1108/0*CjVaEq57Fzs42tR6"/></div></figure><p id="82c3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这是docker文件的样子。如上所述，您可以向其中添加更多组件。现在，让我们讨论docker-compose。</p><p id="156d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">创建这个docker文件后，您可以转到docker文件所在的路径，然后运行这个命令</p><pre class="kd ke kf kg fd kh ki kj bn kk kl bi"><span id="692c" class="km kn hi ki b be ko kp l kq kr">docker build -t &lt;image name&gt;</span></pre><p id="0a40" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，你的形象会建立起来。集装箱现在怎么样了？按需旋转容器的文件叫什么？Docker compose是来拯救世界的。Docker compose是Docker引擎的一部分，作为一个子实用程序，它可以一次旋转许多具有不同配置的容器。Docker合成文件是用YAML(另一种标记语言)编写。YAML很容易写和理解。docker-compose文件如下所示。</p><figure class="kd ke kf kg fd ij er es paragraph-image"><div class="er es ks"><img src="../Images/0ec1acca246ab9b495466a47b2918950.png" data-original-src="https://miro.medium.com/v2/resize:fit:1254/0*NmBQY0RFG4npQKQA"/></div></figure><p id="6baa" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">版本定义要使用的docker引擎版本。在服务下，我们写下容器名，就像这里一样，它被命名为test web。在这个构建下，我们给出了构建容器的路径。意味着使用当前目录。图像标签说明了它的作用。命令也是shell代码或启动后希望在容器中运行的任何内容。</p><p id="03a9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">compose文件的主要优点是，如果你想要更新容器，假设你想要新的配置，或者在容器中添加/删除一些东西，docker-compose可以很容易地做到这些。您只需在文件中进行正确的更改，然后运行该命令再次构建一个新的容器。</p><pre class="kd ke kf kg fd kh ki kj bn kk kl bi"><span id="e508" class="km kn hi ki b be ko kp l kq kr">docker-compose up -d — build</span></pre><p id="4347" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">请记住，该命令将在合成文件所在的目录中运行。根据惯例，文件的名称是“docker-compose . YAML ”, docker文件的名称是docker file，没有任何扩展名。</p><p id="5531" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们已经介绍了docker-compose和Dockerfile，该轮到您使用它们了，并探索更多，这两者在为微服务创建系统时都有巨大的潜力来帮助您。</p><p id="c9a8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">先简单讨论一下docker hub，它就像GitHub一样，docker hub包含docker容器的映像，就像GitHub包含代码和软件一样。Docker hub有两种存储库，私有的和公共的。私有和公共这两个标题足以告诉你这些存储库的本质到底是什么。</p><p id="1479" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你想从你创建的容器制作一个图像，我们可以使用这个命令</p><pre class="kd ke kf kg fd kh ki kj bn kk kl bi"><span id="5cbc" class="km kn hi ki b be ko kp l kq kr">docker commit &lt;container name&gt; &lt;image name&gt;</span></pre><p id="c0f4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后，您可以从查看新创建的图像</p><pre class="kd ke kf kg fd kh ki kj bn kk kl bi"><span id="a60b" class="km kn hi ki b be ko kp l kq kr">docker images</span></pre><p id="0318" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你想看到图像的不同，我们可以使用这个命令</p><pre class="kd ke kf kg fd kh ki kj bn kk kl bi"><span id="91ca" class="km kn hi ki b be ko kp l kq kr">docker diff &lt;image 1&gt; &lt;image 2&gt;</span></pre><p id="12bb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在让我们来看看现实场景中一些有用的命令。</p><p id="8a6e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">停止所有正在运行的容器:</p><pre class="kd ke kf kg fd kh ki kj bn kk kl bi"><span id="d6cb" class="km kn hi ki b be ko kp l kq kr">docker stop $(docker ps -a -q)</span></pre><p id="21da" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">删除所有停止的容器:</p><pre class="kd ke kf kg fd kh ki kj bn kk kl bi"><span id="ed73" class="km kn hi ki b be ko kp l kq kr">docker rm $(docker ps -a -q)</span></pre><p id="977e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">删除所有图像:</p><pre class="kd ke kf kg fd kh ki kj bn kk kl bi"><span id="34f6" class="km kn hi ki b be ko kp l kq kr">docker rm -f $(docker images -q)</span></pre><p id="e54d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这就是码头工人的全部。让我们在下一篇博客中介绍一些网络。技术的基石。</p><p id="568e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">安静点。</p></div></div>    
</body>
</html>