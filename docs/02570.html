<html>
<head>
<title>How to Create a Decorator in Python 3</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Python 3中创建装饰器</h1>
<blockquote>原文：<a href="https://medium.com/codex/how-to-create-a-decorator-in-python-3-4ac4bcec5e1d?source=collection_archive---------7-----------------------#2021-07-26">https://medium.com/codex/how-to-create-a-decorator-in-python-3-4ac4bcec5e1d?source=collection_archive---------7-----------------------#2021-07-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/cd39b7c20e508d391fa6a57388f91669.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_3Iou6ENdi16Yb-l"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">由<a class="ae iu" href="https://unsplash.com/@thephotographermom?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">沙希·查图尔维达</a>在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="65de" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">装饰器是编程中非常有用的设计模式，Python使得它非常容易实现。装饰器是一个用来<em class="jt"> d </em>装饰另一个函数的函数，其中<em class="jt">装饰</em>的意思是增加功能。开发人员使用decorators来扩展他人编写的代码，并实现其他目标。</p><p id="daf9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在python中，装饰者是用<code class="du ju jv jw jx b">@</code>符号指定的。你可能熟悉Python的一些内置装饰器，比如<code class="du ju jv jw jx b">property</code>、<code class="du ju jv jw jx b">classmethod</code>、<code class="du ju jv jw jx b">staticmethod</code>、<code class="du ju jv jw jx b">abstractmethod</code>。下面是一个使用装饰器的例子:</p><figure class="jy jz ka kb fd ij"><div class="bz dy l di"><div class="kc kd l"/></div></figure><p id="c99e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在Python中，decorators可以用来修改函数或类。需要注意的是，装饰者只是简写。这两个是相同的:</p><figure class="jy jz ka kb fd ij"><div class="bz dy l di"><div class="kc kd l"/></div></figure><p id="b75a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">装饰器将函数重新定义为其自身的修改版本。利用这种理解，让我们创建一个简单的装饰器。假设我们有一个创建偶数列表的函数。让我们制作一个总结这些元素的装饰器:</p><figure class="jy jz ka kb fd ij"><div class="bz dy l di"><div class="kc kd l"/></div></figure><p id="a238" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">装饰器接受一个函数作为参数。然后，它创建一个包装函数，调用该函数并扩展其功能。然后，它返回包装器，该包装器被指定为函数的别名。你可以直接使用函数的返回值，如果你愿意也可以返回一个新值。这是最简单的装饰类型之一。然而，它并不适用于所有场景；大多数函数都有一些参数。不仅如此，也许你希望装饰器本身有参数。让我们创建一个通用的装饰器来满足大多数目的:</p><h1 id="590f" class="ke kf hi bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">通用装饰器</h1><figure class="jy jz ka kb fd ij"><div class="bz dy l di"><div class="kc kd l"/></div></figure><p id="32fe" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">首先，当在装饰器中使用包装器时，你最好使用<code class="du ju jv jw jx b">functools.wraps</code>装饰器。<a class="ae iu" href="https://docs.python.org/3/library/functools.html" rel="noopener ugc nofollow" target="_blank"> Python文档</a>说:</p><blockquote class="lc ld le"><p id="84ae" class="iv iw jt ix b iy iz ja jb jc jd je jf lf jh ji jj lg jl jm jn lh jp jq jr js hb bi translated">如果不使用这个装饰器工厂，示例函数的名称将会是<code class="du ju jv jw jx b">'wrapper'</code>，而原来的<code class="du ju jv jw jx b">func()</code>的docstring将会丢失。</p></blockquote><p id="c70d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">使用这个装饰器可以让你创建一个更精炼、破坏性更小的装饰器。</p><p id="8f5b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，请注意这三个层次。外面是装饰工厂。这是一个创建函数的函数，因此是工厂设计模式。这个函数的名字定义了你为装饰器使用的名字。它还允许您向装饰器提供参数，如<code class="du ju jv jw jx b">functools.wraps</code>所示。</p><p id="2b1d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">下一层是真正的装饰者。这将为原始函数返回一个包装器(另一种设计模式)。创建包装器的方式可以通过提供给装饰器工厂的参数来修改。</p><p id="9d45" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">最后，还有包装函数。这个函数是原始函数的别名，这就是为什么它接受原始函数的参数。确保向函数提供这些参数，并使用返回值(如果适用)；您的函数可能不需要任意参数，也可能没有返回值。</p><p id="bd63" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果你想看，下面是第15到17行做的事情(不包括<code class="du ju jv jw jx b">wraps</code>做的事情):</p><figure class="jy jz ka kb fd ij"><div class="bz dy l di"><div class="kc kd l"/></div></figure></div><div class="ab cl li lj gp lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="hb hc hd he hf"><p id="06f9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">对于一个单一的设计模式，你已经接触到了三个。我建议花时间继续学习编程设计模式，因为它们是在程序中提供主要好处的抽象概念。困难的部分是决定何时使用某些模式而不是其他模式。当你想扩展一个函数或者一个类的功能，而不修改原始代码的时候，应该使用Decorators。它们还提供了一种简单的方法来以同样的方式修改多个函数。有些时候你应该避免使用装饰器，但是希望现在你能够在应该使用装饰器的时候实现它们。</p></div></div>    
</body>
</html>