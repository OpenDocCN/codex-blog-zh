<html>
<head>
<title>How to build end-to-end encrypted chat with Sendbird and Virgil</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何与Sendbird和Virgil建立端到端的加密聊天</h1>
<blockquote>原文：<a href="https://medium.com/codex/how-to-build-end-to-end-encrypted-chat-with-sendbird-and-virgil-d6cb03601fac?source=collection_archive---------7-----------------------#2022-03-17">https://medium.com/codex/how-to-build-end-to-end-encrypted-chat-with-sendbird-and-virgil-d6cb03601fac?source=collection_archive---------7-----------------------#2022-03-17</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/d7f4a034a61a9f3cd9408739f1ebbfc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Fls2C2vZj_lZrYPE.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">仙鸟2022</figcaption></figure><div class=""/><div class=""><h2 id="0d96" class="pw-subtitle-paragraph iu hw hx bd b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl dx translated">通过将Virgil的E3Kit群组加密应用到您的应用程序的聊天消息中，建立私密和安全的聊天</h2></div><p id="c320" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">杰森·奥尔肖恩<br/>解决方案工程师| <a class="ae ki" href="https://www.sendbird.com" rel="noopener ugc nofollow" target="_blank">仙鸟</a></p><p id="423c" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated"><em class="kj">您可能会发现查看我们的JavaScript示例代码很有用。如需更多指导，请参考我们的</em> <a class="ae ki" href="https://sendbird.com/docs/chat/v3/javascript/quickstart/send-first-message" rel="noopener ugc nofollow" target="_blank"> <em class="kj">文档</em> </a> <em class="kj">。您还可以查看仙鸟聊天的</em> <a class="ae ki" href="https://sendbird.com/demos/in-app-chat" rel="noopener ugc nofollow" target="_blank"> <em class="kj">演示</em> </a> <em class="kj">和</em> <a class="ae ki" href="https://sendbird.com/features/chat-messaging" rel="noopener ugc nofollow" target="_blank"> <em class="kj">了解更多关于</em> </a> <em class="kj">的功能。</em></p><blockquote class="kk kl km"><p id="2046" class="jm jn kj jo b jp jq iy jr js jt jb ju kn jw jx jy ko ka kb kc kp ke kf kg kh hb bi translated"><em class="hx">成为第一个了解新教程、开发者相关聊天/电话发布以及其他重要更新的人，</em> <a class="ae ki" href="https://get.sendbird.com/dev-newsletter-subscription.html" rel="noopener ugc nofollow" target="_blank"> <em class="hx">注册</em> </a> <em class="hx">我们的开发者简讯。</em></p></blockquote><h1 id="b6de" class="kq kr hx bd ks kt ku kv kw kx ky kz la jd lb je lc jg ld jh le jj lf jk lg lh bi translated">介绍</h1><p id="1edb" class="pw-post-body-paragraph jm jn hx jo b jp li iy jr js lj jb ju jv lk jx jy jz ll kb kc kd lm kf kg kh hb bi translated">本教程将向您展示如何使用Sendbird的<a class="ae ki" href="https://sendbird.com/features/chat-messaging/uikit" rel="noopener ugc nofollow" target="_blank"> UIKit </a>将<a class="ae ki" href="https://developer.virgilsecurity.com/docs/e3kit/end-to-end-encryption/group-chat/" rel="noopener ugc nofollow" target="_blank"> Virgil的E3Kit组加密</a>应用于您的应用程序的聊天消息。在深入实施细节之前，我们将首先了解更多关于端到端加密的知识，并仔细看看<a class="ae ki" href="https://virgilsecurity.com/" rel="noopener ugc nofollow" target="_blank"> Virgil Security </a>。然后，我们将介绍一个核心用例，并用一个用户故事来说明它。</p><p id="63fb" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">但首先，让我们来看看一些先决条件。</p><h1 id="6030" class="kq kr hx bd ks kt ku kv kw kx ky kz la jd lb je lc jg ld jh le jj lf jk lg lh bi translated">先决条件</h1><p id="7e92" class="pw-post-body-paragraph jm jn hx jo b jp li iy jr js lj jb ju jv lk jx jy jz ll kb kc kd lm kf kg kh hb bi translated">为了从本教程中获得最大收益，最好具备以下条件:</p><ol class=""><li id="f141" class="ln lo hx jo b jp jq js jt jv lp jz lq kd lr kh ls lt lu lv bi translated">运行UIKit的基于React.js的应用程序</li><li id="6ac2" class="ln lo hx jo b jp lw js lx jv ly jz lz kd ma kh ls lt lu lv bi translated">向Virgil用户发布jwt(JSON Web Token)的正常运行的服务器。请阅读维吉尔文件来理解JWT是如何工作的。<a class="ae ki" href="https://github.com/VirgilSecurity/demo-backend-nodejs" rel="noopener ugc nofollow" target="_blank">这个GitHub repo </a>包含了显示如何生成JWT的示例代码。</li></ol><p id="7e11" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">请注意，本教程的目标读者是具备JavaScript和网络安全背景知识的开发人员。</p><p id="ea54" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">说完了，让我们开始吧！</p><h1 id="b72a" class="kq kr hx bd ks kt ku kv kw kx ky kz la jd lb je lc jg ld jh le jj lf jk lg lh bi translated">什么是端到端加密？</h1><p id="0f59" class="pw-post-body-paragraph jm jn hx jo b jp li iy jr js lj jb ju jv lk jx jy jz ll kb kc kd lm kf kg kh hb bi translated">端到端加密是一种安全的通信系统，其中只有拥有私钥的用户才能读取传输的消息。受监管行业(如医疗保健或金融)通常需要端到端加密，以满足对数据可访问性的法规遵从性要求。端到端加密对传输、存储和检索的消息有效负载进行加密。只有有权使用用于加密数据的私钥的用户才能读取内容。</p><p id="2dbe" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">在<a class="ae ki" href="https://www.sendbird.com/" rel="noopener ugc nofollow" target="_blank"> Sendbird </a>的上下文中，端到端加密意味着Sendbird系统和人员无法访问消息的内容。这是Sendbird隐私保证的关键部分。值得注意的是，Sendbird中的所有通信在运动时都在传输层加密，在静止时都在持久性层加密。</p><p id="8a56" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">以一家医疗保健公司为例。HIPAA合规性在医疗保健行业是强制性的。需要采取一切手段保护患者数据。</p><p id="b317" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">用户故事是这样的:<strong class="jo hy">作为一个用户，我想发送只有我和我的收件人才能阅读的信息，以保护我的隐私。</strong>端到端加密满足用户需求。</p><p id="330b" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">记得考虑发送加密消息的影响。加密信息可以用于好的目的，也可以用于坏的目的。请务必检查在您的辖区内实施加密邮件的法律含义。</p><p id="a504" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">如果你想了解更多关于端到端加密的知识，请查看电子前沿基金会的<a class="ae ki" href="https://ssd.eff.org/en/module/deep-dive-end-end-encryption-how-do-public-key-encryption-systems-work" rel="noopener ugc nofollow" target="_blank">这篇优秀文章</a>。</p><p id="68d2" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">现在基础打好了，我们来讨论一下为什么要考虑用维吉尔的E3Kit搭配Sendbird。</p><h1 id="5e33" class="kq kr hx bd ks kt ku kv kw kx ky kz la jd lb je lc jg ld jh le jj lf jk lg lh bi translated">为什么要用维吉尔的E3Kit搭配Sendbird？</h1><p id="4f2d" class="pw-post-body-paragraph jm jn hx jo b jp li iy jr js lj jb ju jv lk jx jy jz ll kb kc kd lm kf kg kh hb bi translated">Virgil Security是一家加密软件和服务提供商。它提供了<a class="ae ki" href="https://developer.virgilsecurity.com/docs/e3kit/" rel="noopener ugc nofollow" target="_blank"> E3Kit </a>，这是一个面向许多平台的端到端加密SDK，可以简化加密、密钥管理和其他复杂的安全任务。</p><p id="8dcf" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">E3Kit提供:</p><ol class=""><li id="e12a" class="ln lo hx jo b jp jq js jt jv lp jz lq kd lr kh ls lt lu lv bi translated"><strong class="jo hy">完全隐私</strong>:只有用户可以阅读他们的消息；Sendbird、Virgil和任何其他第三方服务都无法解密消息和数据来访问私人信息。</li><li id="8199" class="ln lo hx jo b jp lw js lx jv ly jz lz kd ma kh ls lt lu lv bi translated"><strong class="jo hy">端到端加密</strong>:用户数据在静态和传输中受到保护。</li><li id="09ac" class="ln lo hx jo b jp lw js lx jv ly jz lz kd ma kh ls lt lu lv bi translated"><strong class="jo hy">独立数据保护</strong>:有了E3Kit，对第三方服务提供商及其网络的任何攻击都不会影响数据的完整性和保密性。</li><li id="1f4f" class="ln lo hx jo b jp lw js lx jv ly jz lz kd ma kh ls lt lu lv bi translated"><strong class="jo hy">数据完整性</strong>:作为加密和解密功能的一部分，E3Kit对数据进行签名和验证，确认数据来自加密数据的用户，并且在传输或存储过程中未被篡改。</li></ol><h1 id="4ae7" class="kq kr hx bd ks kt ku kv kw kx ky kz la jd lb je lc jg ld jh le jj lf jk lg lh bi translated">广泛的实施概述</h1><p id="b3e9" class="pw-post-body-paragraph jm jn hx jo b jp li iy jr js lj jb ju jv lk jx jy jz ll kb kc kd lm kf kg kh hb bi translated">实施由3个主要部分组成:</p><ol class=""><li id="f288" class="ln lo hx jo b jp jq js jt jv lp jz lq kd lr kh ls lt lu lv bi translated">注册用户</li><li id="cd02" class="ln lo hx jo b jp lw js lx jv ly jz lz kd ma kh ls lt lu lv bi translated">创建仙鸟群频道和维吉尔群</li><li id="ee64" class="ln lo hx jo b jp lw js lx jv ly jz lz kd ma kh ls lt lu lv bi translated">在Sendbird的UIKit中加密和解密消息</li></ol><p id="4ffc" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">首先，让我们快速浏览一下概述，然后通过代码示例更深入地研究实现。</p><h2 id="a311" class="mb kr hx bd ks mc md me kw mf mg mh la jv mi mj lc jz mk ml le kd mm mn lg mo bi translated">注册用户</h2><ol class=""><li id="2f8b" class="ln lo hx jo b jp li js lj jv mp jz mq kd mr kh ls lt lu lv bi translated">收藏一幅维吉尔·JWT的作品</li><li id="d00e" class="ln lo hx jo b jp lw js lx jv ly jz lz kd ma kh ls lt lu lv bi translated">向Virgil注册用户的设备</li></ol><p id="5de7" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">下图显示了高层沟通流程。请记住，注册的设备需要对应的消息发送者用户。</p><figure class="mt mu mv mw fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ms"><img src="../Images/2c3ca122b34d5f392d47621369f6fef6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*NcG-aC7TXOgEhAIc.png"/></div></div></figure><h2 id="d45e" class="mb kr hx bd ks mc md me kw mf mg mh la jv mi mj lc jz mk ml le kd mm mn lg mo bi translated">创建仙鸟群频道和维吉尔群</h2><figure class="mt mu mv mw fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ms"><img src="../Images/2174f2d1b7ff50c151a13e863ad07e5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*5dbZUEO9mnRxe_JC.png"/></div></div></figure><p id="8c7c" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">假设维吉尔<code class="du mx my mz na b">user_id</code>和仙鸟<code class="du mx my mz na b">user_id</code>是一样的:</p><p id="9130" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">当前用户:</p><ol class=""><li id="feec" class="ln lo hx jo b jp jq js jt jv lp jz lq kd lr kh ls lt lu lv bi translated">创建与其他用户的Sendbird群组频道</li><li id="b855" class="ln lo hx jo b jp lw js lx jv ly jz lz kd ma kh ls lt lu lv bi translated">与其他用户创建一个Virgil群，并且Sendbird频道URL与Virgil群ID相同</li></ol><p id="ebf5" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">当前用户自动:</p><ol class=""><li id="8176" class="ln lo hx jo b jp jq js jt jv lp jz lq kd lr kh ls lt lu lv bi translated">在Sendbird组频道中设置<code class="du mx my mz na b">created_by</code>字段</li><li id="370d" class="ln lo hx jo b jp lw js lx jv ly jz lz kd ma kh ls lt lu lv bi translated">设为维吉尔群主</li></ol><h2 id="4a9c" class="mb kr hx bd ks mc md me kw mf mg mh la jv mi mj lc jz mk ml le kd mm mn lg mo bi translated">在Sendbird的UIKit中加密和解密消息</h2><ol class=""><li id="5e76" class="ln lo hx jo b jp li js lj jv mp jz mq kd mr kh ls lt lu lv bi translated">加载Sendbird组通道</li><li id="4b43" class="ln lo hx jo b jp lw js lx jv ly jz lz kd ma kh ls lt lu lv bi translated">获取Sendbird组频道URL和<code class="du mx my mz na b">create_by user_id</code>。使用它们来加载相应的维吉尔组</li><li id="b716" class="ln lo hx jo b jp lw js lx jv ly jz lz kd ma kh ls lt lu lv bi translated">使用<a class="ae ki" href="https://developer.virgilsecurity.com/docs/e3kit/end-to-end-encryption/group-chat/" rel="noopener ugc nofollow" target="_blank">加载的Virgil组来</a> : <br/> a)解密获取的Sendbird组通道中的任何消息<br/> b)加密新的传出消息<br/> c)解密新到达的消息</li></ol><p id="be5e" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">现在让我们详细地看一下所有这些步骤。</p><h1 id="92a1" class="kq kr hx bd ks kt ku kv kw kx ky kz la jd lb je lc jg ld jh le jj lf jk lg lh bi translated">第一步。注册用户</h1><p id="c8de" class="pw-post-body-paragraph jm jn hx jo b jp li iy jr js lj jb ju jv lk jx jy jz ll kb kc kd lm kf kg kh hb bi translated">假设您有一个正在运行的Web应用服务器来颁发Virgil用户JWT令牌，请运行以下代码。</p><p id="4235" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">我们需要获得一个JWT和init Virgil实例，并在应用程序加载时获取一个JWT令牌。</p><figure class="mt mu mv mw fd hk"><div class="bz dy l di"><div class="nb nc l"/></div></figure><figure class="mt mu mv mw fd hk"><div class="bz dy l di"><div class="nb nc l"/></div></figure><figure class="mt mu mv mw fd hk"><div class="bz dy l di"><div class="nb nc l"/></div></figure><h1 id="0bbb" class="kq kr hx bd ks kt ku kv kw kx ky kz la jd lb je lc jg ld jh le jj lf jk lg lh bi translated">第二步。创建仙鸟群和维吉尔群</h1><ol class=""><li id="4a2b" class="ln lo hx jo b jp li js lj jv mp jz mq kd mr kh ls lt lu lv bi translated">利用Sendbird的UIKit内置onBeforeCreateChannel方法<br/> 1。生成一个随机的<code class="du mx my mz na b">channel_url</code>。考虑使用UUID。<br/> 2。开始创建维吉尔集团。请注意，Sendbird UIKit自带的<code class="du mx my mz na b">onBeforeCreateChannel</code>方法是同步的。因此，等待维吉尔集团被创建。输入任何冻结代码。<br/> a)不要在参与者身份中包含当前用户。只有由<code class="du mx my mz na b">onBeforeCreateChannel</code>的参数提供的用户列表。<br/> 3。从<code class="du mx my mz na b">onBeforeCreateChannel</code>开始无任何延迟地返回所需的Sendbird组通道参数。</li></ol><figure class="mt mu mv mw fd hk"><div class="bz dy l di"><div class="nb nc l"/></div></figure><p id="017f" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">创建维吉尔群:</p><figure class="mt mu mv mw fd hk"><div class="bz dy l di"><div class="nb nc l"/></div></figure><p id="b370" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">通道参数的同步生成:</p><figure class="mt mu mv mw fd hk"><div class="bz dy l di"><div class="nb nc l"/></div></figure><h1 id="0526" class="kq kr hx bd ks kt ku kv kw kx ky kz la jd lb je lc jg ld jh le jj lf jk lg lh bi translated">第三步。在Sendbird的UIKit中加密和解密消息</h1><h2 id="5a0f" class="mb kr hx bd ks mc md me kw mf mg mh la jv mi mj lc jz mk ml le kd mm mn lg mo bi translated">1.在Sendbird频道选择上，加载关联的Virgil组</h2><ol class=""><li id="4fff" class="ln lo hx jo b jp li js lj jv mp jz mq kd mr kh ls lt lu lv bi translated">Sendbird的UIKit有一个名为<code class="du mx my mz na b">onChannelSelect</code>的方法，当UIKit频道列表第一次加载时以及当用户点击频道列表中的一个频道时触发。</li><li id="a3dc" class="ln lo hx jo b jp lw js lx jv ly jz lz kd ma kh ls lt lu lv bi translated"><code class="du mx my mz na b">onChannelSelect</code>是同步。所以，加载维吉尔组不回调。加载的Virgil组将自动驻留在E3实例中进行加密操作。</li><li id="5e75" class="ln lo hx jo b jp lw js lx jv ly jz lz kd ma kh ls lt lu lv bi translated">考虑实现自己的错误处理。</li></ol><figure class="mt mu mv mw fd hk"><div class="bz dy l di"><div class="nb nc l"/></div></figure><p id="0d5f" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated"><strong class="jo hy">重要提示:</strong>要加载正确的Virgil组，您需要Sendbird频道URL和Virgil组创建者的<code class="du mx my mz na b">user_id</code>。在这种情况下，详细信息存储在Sendbird通道的creator字段中。</p><figure class="mt mu mv mw fd hk"><div class="bz dy l di"><div class="nb nc l"/></div></figure><h2 id="0152" class="mb kr hx bd ks mc md me kw mf mg mh la jv mi mj lc jz mk ml le kd mm mn lg mo bi translated">2.加载自定义消息输入</h2><p id="56ad" class="pw-post-body-paragraph jm jn hx jo b jp li iy jr js lj jb ju jv lk jx jy jz ll kb kc kd lm kf kg kh hb bi translated">Sendbird的UIKit消息输入目前不支持消息发送前的异步操作。因此，建议将Sendbird的useSendbirdStateContext与sendbirdSelectors结合使用。</p><p id="1359" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">呈现自定义消息输入并向下传递Sendbird SDK，以便访问useSendbirdStateContext和sendbirdSelectors。</p><figure class="mt mu mv mw fd hk"><div class="bz dy l di"><div class="nb nc l"/></div></figure><p id="4595" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">在这里检查代码<a class="ae ki" href="https://github.com/SendbirdCommunity/sendbird-uikit-javascript-e2e-encryption-sample/blob/1cb23db3d2ea1c808fdec5bd1ec79ebb3bbc89e7/src/CustomMessageInput.js#L43" rel="noopener ugc nofollow" target="_blank">中的整个输入组件。</a></p><h1 id="eb0a" class="kq kr hx bd ks kt ku kv kw kx ky kz la jd lb je lc jg ld jh le jj lf jk lg lh bi translated">3.对在频道的消息列表视图中自动更新的消息进行加密</h1><p id="ba33" class="pw-post-body-paragraph jm jn hx jo b jp li iy jr js lj jb ju jv lk jx jy jz ll kb kc kd lm kf kg kh hb bi translated">当用户发送消息时，会发生以下操作:</p><ol class=""><li id="ea0e" class="ln lo hx jo b jp jq js jt jv lp jz lq kd lr kh ls lt lu lv bi translated">该消息被撰写用于发送，并且用户点击发送(输入占位符被重置)。</li><li id="4a53" class="ln lo hx jo b jp lw js lx jv ly jz lz kd ma kh ls lt lu lv bi translated">消息是加密的，这需要在上面的步骤2中加载相应的Virgil组。</li><li id="ef4a" class="ln lo hx jo b jp lw js lx jv ly jz lz kd ma kh ls lt lu lv bi translated">将创建一个Sendbird消息实例。</li><li id="9fe9" class="ln lo hx jo b jp lw js lx jv ly jz lz kd ma kh ls lt lu lv bi translated">UIKit的<code class="du mx my mz na b">sendbirdSelectors</code>被用来发送消息，并将自动更新消息视图(下一步将有更多介绍)。<br/> 1。注意，通过设置消息的内置<code class="du mx my mz na b">custom_type</code>(字符串)，消息被标记为加密的</li></ol><figure class="mt mu mv mw fd hk"><div class="bz dy l di"><div class="nb nc l"/></div></figure><figure class="mt mu mv mw fd hk"><div class="bz dy l di"><div class="nb nc l"/></div></figure><h1 id="7c52" class="kq kr hx bd ks kt ku kv kw kx ky kz la jd lb je lc jg ld jh le jj lf jk lg lh bi translated">4.解密邮件并自动更新邮件列表视图</h1><p id="057b" class="pw-post-body-paragraph jm jn hx jo b jp li iy jr js lj jb ju jv lk jx jy jz ll kb kc kd lm kf kg kh hb bi translated">使用Sendbird的UIKit，可以监听消息列表视图的变化，并为每个新消息呈现一个消息卡。客户消息卡可以通过利用通道组件上UIKit的<code class="du mx my mz na b">renderChatItem</code>属性来创建。</p><ul class=""><li id="7332" class="ln lo hx jo b jp jq js jt jv lp jz lq kd lr kh nd lt lu lv bi translated">原始的加密消息文本被传入。</li><li id="d625" class="ln lo hx jo b jp lw js lx jv ly jz lz kd ma kh nd lt lu lv bi translated">当前的<code class="du mx my mz na b">user_id</code>被传入并用于检测当前用户是否发送了它们。</li><li id="c685" class="ln lo hx jo b jp lw js lx jv ly jz lz kd ma kh nd lt lu lv bi translated">E3实例也包括在内。</li><li id="f058" class="ln lo hx jo b jp lw js lx jv ly jz lz kd ma kh nd lt lu lv bi translated">添加当前频道，因为解密需要其<code class="du mx my mz na b">channel_url</code>和<code class="du mx my mz na b">created_by</code>字段。</li></ul><figure class="mt mu mv mw fd hk"><div class="bz dy l di"><div class="nb nc l"/></div></figure><p id="baff" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">每个消息的解密是异步的。因此，我们为每个消息设置占位符，完成解密，然后重新呈现未加密的消息。</p><ol class=""><li id="13f1" class="ln lo hx jo b jp jq js jt jv lp jz lq kd lr kh ls lt lu lv bi translated">用占位符呈现所有邮件。</li><li id="62ff" class="ln lo hx jo b jp lw js lx jv ly jz lz kd ma kh ls lt lu lv bi translated">检查每封邮件是否加密。</li><li id="0e3e" class="ln lo hx jo b jp lw js lx jv ly jz lz kd ma kh ls lt lu lv bi translated">解密每条消息。</li><li id="f50e" class="ln lo hx jo b jp lw js lx jv ly jz lz kd ma kh ls lt lu lv bi translated">使用解密的文本重新呈现邮件，根据邮件的发送者将其放在左侧或右侧。</li></ol><figure class="mt mu mv mw fd hk"><div class="bz dy l di"><div class="nb nc l"/></div></figure><p id="4097" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">注意消息发送者的<code class="du mx my mz na b">user_id</code>是必需的。然后我们得到了仙鸟群频道的关联维吉尔群。最后，消息可以被解密并返回。</p><figure class="mt mu mv mw fd hk"><div class="bz dy l di"><div class="nb nc l"/></div></figure><h1 id="95fd" class="kq kr hx bd ks kt ku kv kw kx ky kz la jd lb je lc jg ld jh le jj lf jk lg lh bi translated">结论</h1><p id="4a8a" class="pw-post-body-paragraph jm jn hx jo b jp li iy jr js lj jb ju jv lk jx jy jz ll kb kc kd lm kf kg kh hb bi translated">就是这样！我们已经介绍了如何将Virgil组与Sendbird组通道相关联，以及如何使用Sendbird的UIKit定制来加密、解密和显示解密的消息。使用Sendbird的UIKit和Virgil Security，您可以放心，您所有用户的消息都是安全的。</p><p id="110a" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">如果你需要额外的指导，查看一下<a class="ae ki" href="https://sendbird.com/docs/uikit" rel="noopener ugc nofollow" target="_blank">仙鸟</a>和<a class="ae ki" href="https://developer.virgilsecurity.com/" rel="noopener ugc nofollow" target="_blank">维吉尔</a>的文档。一如既往，如果您需要任何帮助，请不要犹豫<a class="ae ki" href="https://sendbird.com/contact-sales" rel="noopener ugc nofollow" target="_blank">联系我们</a>！</p><p id="2ca0" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">我们迫不及待地想看看你的作品！编码快乐！✌️</p><blockquote class="kk kl km"><p id="64f6" class="jm jn kj jo b jp jq iy jr js jt jb ju kn jw jx jy ko ka kb kc kp ke kf kg kh hb bi translated"><em class="hx">为了第一个了解新教程、与开发者相关的聊天/电话发布以及其他重要更新，</em> <a class="ae ki" href="https://get.sendbird.com/dev-newsletter-subscription.html" rel="noopener ugc nofollow" target="_blank"> <em class="hx">注册</em> </a> <em class="hx">我们的开发者简讯。</em></p></blockquote></div></div>    
</body>
</html>