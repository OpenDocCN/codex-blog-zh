<html>
<head>
<title>How to use webhooks to link API services with chat events</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用webhooks链接API服务和聊天事件</h1>
<blockquote>原文：<a href="https://medium.com/codex/how-to-use-webhooks-to-link-api-services-with-chat-events-7854467628d5?source=collection_archive---------15-----------------------#2022-03-03">https://medium.com/codex/how-to-use-webhooks-to-link-api-services-with-chat-events-7854467628d5?source=collection_archive---------15-----------------------#2022-03-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/fd49a1aabc5b79de5230f467c11b25bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*VJb0QwRZSkeGORWN.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">仙鸟2022</figcaption></figure><div class=""/><div class=""><h2 id="115f" class="pw-subtitle-paragraph iu hw hx bd b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl dx translated">关于如何使用webhooks从你的聊天应用程序中触发实时动作的教程</h2></div><p id="4264" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">由阿斯丁·崔<br/>解决方案工程师| <a class="ae ki" href="https://www.sendbird.com" rel="noopener ugc nofollow" target="_blank">森伯德</a></p><p id="f93b" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated"><em class="kj">您可能会发现参考</em> <a class="ae ki" href="https://sendbird.com/docs/chat/v3/platform-api/guides/webhooks" rel="noopener ugc nofollow" target="_blank"> <em class="kj">文档</em> </a> <em class="kj">会有所帮助。您可能还想查看完全实现聊天的</em> <a class="ae ki" href="https://sendbird.com/demos/in-app-chat" rel="noopener ugc nofollow" target="_blank"> <em class="kj">演示</em> </a> <em class="kj">。最后，别忘了查看一下</em> <a class="ae ki" href="https://sendbird.com/features/chat-messaging" rel="noopener ugc nofollow" target="_blank"> <em class="kj">仙鸟聊天</em> </a> <em class="kj">的所有炫酷功能！</em></p><h1 id="59b8" class="kk kl hx bd km kn ko kp kq kr ks kt ku jd kv je kw jg kx jh ky jj kz jk la lb bi translated">介绍</h1><p id="e123" class="pw-post-body-paragraph jm jn hx jo b jp lc iy jr js ld jb ju jv le jx jy jz lf kb kc kd lg kf kg kh hb bi translated">使用Sendbird Chat，您可以轻松地为您的应用程序设计、构建和定制完美的聊天消息解决方案。它安全、可靠且高度可扩展Sendbird平台API增加了服务器端的灵活性和功能。它非常容易接近，而且有<a class="ae ki" href="https://sendbird.com/docs/chat/v3/platform-api/getting-started/prepare-to-use-api" rel="noopener ugc nofollow" target="_blank">全面的文档</a>。要在应用程序中使用其他API服务构建响应性实时特性，首先需要启用webhooks。在本文中，您将找到关于webhooks需要了解的一切，包括如何使用Sendbird构建对聊天事件的定制响应。</p><h1 id="fc84" class="kk kl hx bd km kn ko kp kq kr ks kt ku jd kv je kw jg kx jh ky jj kz jk la lb bi translated">什么是webhook？</h1><p id="416f" class="pw-post-body-paragraph jm jn hx jo b jp lc iy jr js ld jb ju jv le jx jy jz lf kb kc kd lg kf kg kh hb bi translated">webhook用另一个web服务中的事件数据创建对一个服务器的HTTP回调。与轮询相比，webhooks的效率要高得多，并且使您能够构建使用实时数据的特性。这是开发人员以编程方式创建web服务操作以响应另一个web服务上的事件的最佳方式。</p><h1 id="39c4" class="kk kl hx bd km kn ko kp kq kr ks kt ku jd kv je kw jg kx jh ky jj kz jk la lb bi translated">webhooks如何支持定制实时特性和链接API服务</h1><p id="ec77" class="pw-post-body-paragraph jm jn hx jo b jp lc iy jr js ld jb ju jv le jx jy jz lf kb kc kd lg kf kg kh hb bi translated">通常，开发人员会使用webhooks为支持Sendbird的应用程序中的事件创建一个定制的通知系统。</p><p id="3821" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">这里有一个例子。当有人在通道内发送消息时，您希望向通道成员发送通知。webhook将通过发送一个包含消息和通道的特定数据的HTTP POST，让您的服务器知道消息何时被发送到通道。如果收到消息的用户登录到您的应用程序，您现在可以触发推送通知来提醒他们该消息。如果收件人没有登录应用程序，无法接收推送，您可以使用webhooks来触发向某个电话号码、电子邮件地址或两者发送短信。</p><p id="62f5" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">这是一个常见且重要的例子，因为不同行业的许多应用程序都需要通知用户新消息。使用案例包括:</p><ul class=""><li id="0a0b" class="lh li hx jo b jp jq js jt jv lj jz lk kd ll kh lm ln lo lp bi translated">医生、患者或医护人员在医疗保健应用程序中收到一条时间敏感的消息。</li><li id="00ad" class="lh li hx jo b jp lq js lr jv ls jz lt kd lu kh lm ln lo lp bi translated">用户在按需应用程序中接收信息和更新。</li><li id="5ec2" class="lh li hx jo b jp lq js lr jv ls jz lt kd lu kh lm ln lo lp bi translated">用户需要在约会应用程序中看到新的匹配或消息。</li><li id="3f3e" class="lh li hx jo b jp lq js lr jv ls jz lt kd lu kh lm ln lo lp bi translated">用户表达了对产品的兴趣，并且卖方想要接收通知以联系市场中的买方。</li><li id="bbf1" class="lh li hx jo b jp lq js lr jv ls jz lt kd lu kh lm ln lo lp bi translated">用户向游戏应用中的频道发送关于raid、公会或游戏事件的提醒。</li></ul><p id="2803" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">webhooks的其他用途包括触发支付API、触发社交媒体或电子邮件API等等。</p><h1 id="af6d" class="kk kl hx bd km kn ko kp kq kr ks kt ku jd kv je kw jg kx jh ky jj kz jk la lb bi translated">通过Sendbird使用webhooks</h1><p id="543c" class="pw-post-body-paragraph jm jn hx jo b jp lc iy jr js ld jb ju jv le jx jy jz lf kb kc kd lg kf kg kh hb bi translated">在Sendbird中使用时，当Sendbird服务器上发生事件时，webhooks会向您的服务器发送一个带有JSON有效负载的HTTP POST请求，例如:</p><ul class=""><li id="cacb" class="lh li hx jo b jp jq js jt jv lj jz lk kd ll kh lm ln lo lp bi translated">用户在频道中“发送”、“删除”或“阅读”消息</li><li id="57fd" class="lh li hx jo b jp lq js lr jv ls jz lt kd lu kh lm ln lo lp bi translated">一个用户“创建”或“离开”一个频道，或者“邀请”另一个用户进入一个频道</li><li id="05ab" class="lh li hx jo b jp lq js lr jv ls jz lt kd lu kh lm ln lo lp bi translated">一个用户“阻止”或“解除阻止”另一个用户</li></ul><p id="a138" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">请阅读我们平台API <a class="ae ki" href="https://docs.sendbird.com/platform/webhooks#3_webhook_events" rel="noopener ugc nofollow" target="_blank">文档</a>中Sendbird webhooks支持的事件的完整列表。</p><h1 id="66a6" class="kk kl hx bd km kn ko kp kq kr ks kt ku jd kv je kw jg kx jh ky jj kz jk la lb bi translated">如何为不同的事件启用webhooks</h1><p id="60c8" class="pw-post-body-paragraph jm jn hx jo b jp lc iy jr js ld jb ju jv le jx jy jz lf kb kc kd lg kf kg kh hb bi translated">通过为特定事件启用webhooks，您可以控制收到的HTTP请求的数量和类型。</p><p id="bbf8" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">要启用webhooks，请发出以下HTTP请求</p><pre class="lv lw lx ly fd lz ma mb mc aw md bi"><span id="f714" class="me kl hx ma b fi mf mg l mh mi">PUT https://api-{application_id}.sendbird.com/v3/applications/settings/webhook</span></pre><p id="1643" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">请求体只支持下面描述的属性enabled_events[] <strong class="jo hy">，</strong>。</p><figure class="lv lw lx ly fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mj"><img src="../Images/d216138c54ac43f7b3a9f43f82b3afd3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*01h0PKrgH4sN4y2G.png"/></div></div></figure><p id="53a4" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">下面的请求体示例显示了用户打开webhooks来“创建”和“加入”频道(<code class="du mk ml mm ma b">group_channel:create</code>和<code class="du mk ml mm ma b">group_channel:join</code>)，以及“邀请”用户加入频道(<code class="du mk ml mm ma b">group_channel:invite</code>)。</p><p id="669d" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">如果成功，该请求将在响应正文中返回有关webhook配置的信息，如下所示。</p><p id="4d05" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">要检索当前启用的webhooks列表，请使用以下请求:</p><pre class="lv lw lx ly fd lz ma mb mc aw md bi"><span id="733a" class="me kl hx ma b fi mf mg l mh mi">GET <a class="ae ki" href="https://api-{application_id}.sendbird.com/v3/applications/settings/webhook" rel="noopener ugc nofollow" target="_blank">https://api-{application_id}.sendbird.com/v3/applications/settings/webhook</a></span></pre><h1 id="ce50" class="kk kl hx bd km kn ko kp kq kr ks kt ku jd kv je kw jg kx jh ky jj kz jk la lb bi translated">正在验证来自Sendbird的webhooks</h1><p id="c23c" class="pw-post-body-paragraph jm jn hx jo b jp lc iy jr js ld jb ju jv le jx jy jz lf kb kc kd lg kf kg kh hb bi translated">验证未更改的webhook请求来自Sendbird对于维护安全性至关重要。因此，Sendbird在SHA-256生成一个签名，并将其应用于POST请求正文和您的访问令牌。</p><p id="2745" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">来自Sendbird的每个HTTP POST请求将包含以下标头:</p><figure class="lv lw lx ly fd hk"><div class="bz dy l di"><div class="mn mo l"/></div></figure><p id="9ff1" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated"><code class="du mk ml mm ma b">x-signature</code>是一个关键特性，可以确保您收到的HTTP POST请求</p><ol class=""><li id="0432" class="lh li hx jo b jp jq js jt jv lj jz lk kd ll kh mp ln lo lp bi translated">来自仙鸟</li><li id="c159" class="lh li hx jo b jp lq js lr jv ls jz lt kd lu kh mp ln lo lp bi translated">未被第三方更改</li></ol><p id="6aa0" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated"><code class="du mk ml mm ma b">x-signature</code>将SHA-256应用于POST请求体和您的API令牌。要验证请求，请将SHA-256应用于请求体和API令牌。接下来，确认结果值等于<code class="du mk ml mm ma b">x-signature</code>。</p><h1 id="13c5" class="kk kl hx bd km kn ko kp kq kr ks kt ku jd kv je kw jg kx jh ky jj kz jk la lb bi translated">Sendbird的webhook行为</h1><p id="797d" class="pw-post-body-paragraph jm jn hx jo b jp lc iy jr js ld jb ju jv le jx jy jz lf kb kc kd lg kf kg kh hb bi translated">有时，服务器不会收到请求。如果一个webhook请求失败，您可以预期Sendbird的webhooks会有以下行为。</p><figure class="lv lw lx ly fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mq"><img src="../Images/5a2f37d19ad397e6664a6a30dadce29a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*pI12CTLaMhUdhyQ6.png"/></div></div></figure><ul class=""><li id="1912" class="lh li hx jo b jp jq js jt jv lj jz lk kd ll kh lm ln lo lp bi translated">每个请求的超时时间:5秒</li><li id="5006" class="lh li hx jo b jp lq js lr jv ls jz lt kd lu kh lm ln lo lp bi translated">如果超时，Sendbird会重试三次对服务器的请求</li><li id="8944" class="lh li hx jo b jp lq js lr jv ls jz lt kd lu kh lm ln lo lp bi translated">如果您的服务器不能在15秒内收到三次请求，它将不会收到请求</li></ul><p id="046a" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">为了避免太多的请求，您应该实现您的端点，用200 OK响应立即响应服务器。</p><h1 id="74bb" class="kk kl hx bd km kn ko kp kq kr ks kt ku jd kv je kw jg kx jh ky jj kz jk la lb bi translated">设置你的webhook架构</h1><p id="e67f" class="pw-post-body-paragraph jm jn hx jo b jp lc iy jr js ld jb ju jv le jx jy jz lf kb kc kd lg kf kg kh hb bi translated">为了支持您的服务器的高流量(包括webhook请求)，我们建议您像下图这样设置您的架构。我们利用AWS技术堆栈(例如，API网关)来创建高度可扩展的架构。</p><figure class="lv lw lx ly fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mq"><img src="../Images/183739b9a5deb9b43adfdd7e1b243fda.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*buLEiFgPp0Fo3ymW.png"/></div></div></figure><h1 id="02b2" class="kk kl hx bd km kn ko kp kq kr ks kt ku jd kv je kw jg kx jh ky jj kz jk la lb bi translated">确保您的webhook端点满足这些要求</h1><p id="90f9" class="pw-post-body-paragraph jm jn hx jo b jp lc iy jr js ld jb ju jv le jx jy jz lf kb kc kd lg kf kg kh hb bi translated">当您的Sendbird应用程序中发生特定事件时，Sendbird将带有JSON有效负载的HTTP POST请求发送到您的webhook端点。您的webhook端点必须满足以下要求:</p><ul class=""><li id="1f37" class="lh li hx jo b jp jq js jt jv lj jz lk kd ll kh lm ln lo lp bi translated">端点必须支持HTTP/1.1和保持活动状态。</li><li id="ed23" class="lh li hx jo b jp lq js lr jv ls jz lt kd lu kh lm ln lo lp bi translated">端点必须响应POST请求。</li><li id="7d26" class="lh li hx jo b jp lq js lr jv ls jz lt kd lu kh lm ln lo lp bi translated">端点必须解析JSON有效负载。</li></ul><h1 id="453f" class="kk kl hx bd km kn ko kp kq kr ks kt ku jd kv je kw jg kx jh ky jj kz jk la lb bi translated">现有基础设施安全设置</h1><p id="4f9e" class="pw-post-body-paragraph jm jn hx jo b jp lc iy jr js ld jb ju jv le jx jy jz lf kb kc kd lg kf kg kh hb bi translated">如果您已经有了一个基础设施，并且您将在现有的基础设施中构建一个webhook接收服务，请考虑您当前基础设施的安全性和设置如何影响您从Sendbird接收web hook的能力。</p><p id="5b38" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">例如:</p><ul class=""><li id="313d" class="lh li hx jo b jp jq js jt jv lj jz lk kd ll kh lm ln lo lp bi translated">防火墙可以阻止来自Sendbird IP地址的呼叫。</li><li id="4580" class="lh li hx jo b jp lq js lr jv ls jz lt kd lu kh lm ln lo lp bi translated">跨站点脚本可以检测用户生成的有效负载，并阻止Sendbird webhooks。</li><li id="0a7f" class="lh li hx jo b jp lq js lr jv ls jz lt kd lu kh lm ln lo lp bi translated">带有400错误的不需要的/未使用的webhooks，不会用200响应代码标记。</li></ul><p id="e544" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">注意，如果返回400错误，Sendbird将尝试自动重新发送通知。</p><h1 id="187e" class="kk kl hx bd km kn ko kp kq kr ks kt ku jd kv je kw jg kx jh ky jj kz jk la lb bi translated">用户“发送”消息时来自Sendbird的webhook请求示例</h1><p id="0165" class="pw-post-body-paragraph jm jn hx jo b jp lc iy jr js ld jb ju jv le jx jy jz lf kb kc kd lg kf kg kh hb bi translated">以下是发送到您的服务器的webhook通知的示例。当用户发送消息时，Sendbird webhooks会发送这个通知。每当消息被发送到Sendbird客户端时，您可以使用JSON有效负载来实现其他服务器中的行为。</p><figure class="lv lw lx ly fd hk"><div class="bz dy l di"><div class="mn mo l"/></div></figure><figure class="lv lw lx ly fd hk"><div class="bz dy l di"><div class="mn mo l"/></div></figure><h1 id="5fa1" class="kk kl hx bd km kn ko kp kq kr ks kt ku jd kv je kw jg kx jh ky jj kz jk la lb bi translated">结论</h1><p id="1c84" class="pw-post-body-paragraph jm jn hx jo b jp lc iy jr js ld jb ju jv le jx jy jz lf kb kc kd lg kf kg kh hb bi translated">由于webhooks的灵活性和强大功能，开发人员可以在他们的应用程序中实现新的定制功能，并将Sendbird平台API链接到许多其他API服务。</p><p id="5d2a" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">最终，webhooks使得链接你的业务使用的所有API服务创造一些不可思议的体验成为可能。我们希望你能继续探索如何使用webhooks来引入你的用户会喜欢的特性。Sendbird团队随时为您提供帮助。</p><p id="b953" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">开心聊楼！✌️</p><pre class="lv lw lx ly fd lz ma mb mc aw md bi"><span id="aa49" class="me kl hx ma b fi mf mg l mh mi"><strong class="ma hy">Want to connect?</strong></span><span id="0537" class="me kl hx ma b fi mr mg l mh mi">To be the first to know about new tutorials, developer-related chat/calls launches, and other important updates, <a class="ae ki" href="https://get.sendbird.com/dev-newsletter-subscription.html" rel="noopener ugc nofollow" target="_blank">sign up</a> for our developer newsletter.</span></pre><h1 id="a145" class="kk kl hx bd km kn ko kp kq kr ks kt ku jd kv je kw jg kx jh ky jj kz jk la lb bi translated">资源</h1><ol class=""><li id="769c" class="lh li hx jo b jp lc js ld jv ms jz mt kd mu kh mp ln lo lp bi translated"><a class="ae ki" href="https://sendbird.com/docs/chat/v3/platform-api/guides/webhooks" rel="noopener ugc nofollow" target="_blank">发送鸟文档</a></li><li id="de17" class="lh li hx jo b jp lq js lr jv ls jz lt kd lu kh mp ln lo lp bi translated"><a class="ae ki" href="https://sendbird.com/demos/in-app-chat" rel="noopener ugc nofollow" target="_blank">演示完全实现的应用内聊天</a></li><li id="3385" class="lh li hx jo b jp lq js lr jv ls jz lt kd lu kh mp ln lo lp bi translated"><a class="ae ki" href="https://zapier.com/blog/what-are-webhooks/" rel="noopener ugc nofollow" target="_blank">什么是webhook </a>？作者:扎皮尔</li><li id="af27" class="lh li hx jo b jp lq js lr jv ls jz lt kd lu kh mp ln lo lp bi translated"><a class="ae ki" href="https://www.mparticle.com/blog/apis-vs-webhooks" rel="noopener ugc nofollow" target="_blank"> API vs Webhooks </a>按文章</li><li id="a0e4" class="lh li hx jo b jp lq js lr jv ls jz lt kd lu kh mp ln lo lp bi translated"><a class="ae ki" href="https://www.geeksforgeeks.org/what-is-a-webhook-and-how-to-use-it/" rel="noopener ugc nofollow" target="_blank">什么是Webhook以及如何使用它</a></li></ol></div></div>    
</body>
</html>