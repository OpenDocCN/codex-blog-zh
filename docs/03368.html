<html>
<head>
<title>Auto-Locking PC when you’re away with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python时自动锁定PC</h1>
<blockquote>原文：<a href="https://medium.com/codex/auto-locking-pc-when-youre-away-with-python-e184fe2b4bd5?source=collection_archive---------9-----------------------#2021-08-30">https://medium.com/codex/auto-locking-pc-when-youre-away-with-python-e184fe2b4bd5?source=collection_archive---------9-----------------------#2021-08-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="c299" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">完全披露，这不会是最安全的方式来锁定你的电脑，但它很酷。它也是在windows pc上设计的，但经过一些调整，在linux或osx上也能很好地工作。</p><p id="35cf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这背后的想法是，我们可以选择任何设备作为我们的“钥匙”，当这个设备不再连接到您的家庭网络时，您的pc将自动锁定。在这个例子中，我将使用我的手机作为钥匙，所以如果我离开房子但忘记锁我的笔记本电脑，它会在我的手机与我的WiFi断开时自动锁定，非常简单！</p></div><div class="ab cl jd je gp jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="hb hc hd he hf"><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es jk"><img src="../Images/91d852fa6b057349c3210b69c486e9d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_1GtvrjEFTNG1UAzW5xW7A.jpeg"/></div></div></figure><p id="74e2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个小python项目再简单不过了，可以用不到20行代码完成！首先，我们只需要导入两个库，这两个库都内置于python中，因此不需要安装外部包，这是一个额外的好处。我们需要的两个包是‘subprocess’和‘ctypes’，它们让python可以访问windows命令提示符和系统进程。</p><pre class="jl jm jn jo fd jw jx jy jz aw ka bi"><span id="03db" class="kb kc hi jx b fi kd ke l kf kg">import subprocess<br/>import ctypes</span></pre><p id="2806" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，您需要决定您希望哪个设备充当您的密钥。理想情况下，它应该是一个你可以随身携带的设备，这样手机就可以完美地工作，或者如果你有智能手表的话，也可以是智能手表，但这完全取决于你。</p><p id="1ead" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于您选择的任何设备，您需要找出它在您的网络上的名称，最好的方法是登录到您的路由器，找到您想要使用的设备，然后在我们的python脚本中将它定义为一个变量。</p><pre class="jl jm jn jo fd jw jx jy jz aw ka bi"><span id="392f" class="kb kc hi jx b fi kd ke l kf kg">my_device = 'Toms-iPhone'</span></pre><p id="7fa3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们还需要设置连接启动时的默认状态，这将是False。</p><pre class="jl jm jn jo fd jw jx jy jz aw ka bi"><span id="066e" class="kb kc hi jx b fi kd ke l kf kg">connected = False</span></pre><p id="b949" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以现在我们需要进入使这一切成为可能的主函数，我们称之为‘check _ connection’。在这个函数中，我们将使用“子进程”包来编写shell命令，这些命令ping本地网络以找到我们想要找到的设备。函数的开始看起来像这样:</p><pre class="jl jm jn jo fd jw jx jy jz aw ka bi"><span id="e100" class="kb kc hi jx b fi kd ke l kf kg">def check_connection():<br/>   check = subprocess.run(f'ping {my_device}',<br/>                          stdout=subprocess.PIPE,shell=True)</span><span id="69f7" class="kb kc hi jx b fi kh ke l kf kg">   check = check.stdout.decode('utf-8')<br/>   state = check.split('\r')[2].split()</span></pre><p id="bed6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这部分代码所做的就是为匹配我们之前定义的名称的任何设备发送一个ping，并返回shell输出。shell输出是一个长字符串，所以我们对它进行解码，并将其拆分成更容易识别和管理的内容，这可以通过多种方式实现。</p><p id="23ee" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们需要检查输出，看它是否在网络上找到了我们的设备，所以我们只需要一个if语句来检查输出是否说设备“不可达”最后。</p><pre class="jl jm jn jo fd jw jx jy jz aw ka bi"><span id="615d" class="kb kc hi jx b fi kd ke l kf kg">if state[-1]=='unreachable.':<br/>   connected = False<br/>else:<br/>   connected = True<br/>return connected</span></pre><p id="b43d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这就完成了我们的网络检查！我们现在有了一个可以随时调用的功能来扫描网络寻找我们的“密钥”。</p><p id="9555" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后要添加的部分，是不断检查我们设备的连接状态，并使其在连接值为假时锁定PC。为此，我们将简单地使用一个WHILE循环。</p><pre class="jl jm jn jo fd jw jx jy jz aw ka bi"><span id="b06c" class="kb kc hi jx b fi kd ke l kf kg">while True:<br/>   device_state = check_connection()<br/>   print(f'Last Device Connection State: {device_state}')</span></pre><p id="203c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了增加锁定能力，我们使用了“ctypes”库，以及一个IF语句来检查“device_state”何时为假。</p><pre class="jl jm jn jo fd jw jx jy jz aw ka bi"><span id="03fc" class="kb kc hi jx b fi kd ke l kf kg">if device_state == False:<br/>   ctypes.windll.user32.LockWorkStation()</span></pre><p id="94ec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这就够了！完整的代码如下所示:</p><pre class="jl jm jn jo fd jw jx jy jz aw ka bi"><span id="b94c" class="kb kc hi jx b fi kd ke l kf kg">import subprocess<br/>import ctypes</span><span id="f799" class="kb kc hi jx b fi kh ke l kf kg">my_device = 'Toms-iPhone'<br/>connected = False</span><span id="8cf8" class="kb kc hi jx b fi kh ke l kf kg">def check_connection():<br/>   check = subprocess.run(f'ping {my_device}',<br/>                          stdout=subprocess.PIPE,shell=True)<br/>   check = check.stdout.decode('utf-8')<br/>   state = check.split('\r')[2].split()<br/>   if state[-1]=='unreachble.':<br/>      connected = False<br/>   else:<br/>      connected = True<br/>   return connected</span><span id="e202" class="kb kc hi jx b fi kh ke l kf kg">while True:<br/>   device_state = check_connection()<br/>   print(f'Last Device Connection State: {device_state}')<br/>   if device_state = False:<br/>      ctypes.windll.user32.LockWorkStation()</span></pre><p id="33a9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">超级容易！只要在后台运行这个小脚本，就能让你的电脑更加安全，如果你出门时容易忘记锁电脑的话！</p></div><div class="ab cl jd je gp jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="hb hc hd he hf"><p id="4306" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我希望你喜欢这个快速的python教程，这绝不是你可以用这个概念做的唯一的事情。也许你不在乎锁定你的电脑，所以你可以让你的电脑做任何事情，当你离开家！</p></div></div>    
</body>
</html>