<html>
<head>
<title>Failing to add CodeMirror 6 (and then Succeeding)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">未能添加CodeMirror 6(然后成功)</h1>
<blockquote>原文：<a href="https://medium.com/codex/failing-to-add-codemirror-6-and-then-succeeding-cb4d6d2dcfa2?source=collection_archive---------9-----------------------#2021-04-27">https://medium.com/codex/failing-to-add-codemirror-6-and-then-succeeding-cb4d6d2dcfa2?source=collection_archive---------9-----------------------#2021-04-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="54eb" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">将非React项目引入React项目</h2></div><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="jc jd l"/></div></figure><p id="dc48" class="pw-post-body-paragraph je jf hi jg b jh ji ij jj jk jl im jm jn jo jp jq jr js jt ju jv jw jx jy jz hb bi translated">在上一篇文章中，我创建了一个React组件，它拦截并格式化了<code class="du kb kc kd ke b">console.log</code>和<code class="du kb kc kd ke b">console.error</code>的参数。</p><p id="1a52" class="pw-post-body-paragraph je jf hi jg b jh ji ij jj jk jl im jm jn jo jp jq jr js jt ju jv jw jx jy jz hb bi translated">在这篇文章中，我将从一个简单的<code class="du kb kc kd ke b">&lt;textarea&gt;</code>升级到一些被设计用来显示代码的东西。</p><h1 id="dd0b" class="kf kg hi bd kh ki kj kk kl km kn ko kp io kq ip kr ir ks is kt iu ku iv kv kw bi translated">我应该用什么？</h1><p id="2c3f" class="pw-post-body-paragraph je jf hi jg b jh kx ij jj jk ky im jm jn kz jp jq jr la jt ju jv lb jx jy jz hb bi translated">在考虑了几个不同的选项之后，甚至考虑从头开始做一些东西，我决定<a class="ae ka" href="https://codemirror.net/6" rel="noopener ugc nofollow" target="_blank"> CodeMirror </a>将是最适合短代码片段的。</p><p id="24c6" class="pw-post-body-paragraph je jf hi jg b jh ji ij jj jk jl im jm jn jo jp jq jr js jt ju jv jw jx jy jz hb bi translated">幸运的是，CodeMirror v6已经推出，这是一个绝佳的尝试机会。</p><h1 id="91d7" class="kf kg hi bd kh ki kj kk kl km kn ko kp io kq ip kr ir ks is kt iu ku iv kv kw bi translated">创建编辑器组件</h1><p id="f693" class="pw-post-body-paragraph je jf hi jg b jh kx ij jj jk ky im jm jn kz jp jq jr la jt ju jv lb jx jy jz hb bi translated">编辑器组件将驻留在<code class="du kb kc kd ke b">src/components/editor/index.tsx</code>中。现在，它将是一个空的react组件。</p><pre class="ix iy iz ja fd lc ke ld le aw lf bi"><span id="7b42" class="lg kg hi ke b fi lh li l lj lk">import React from "react";</span><span id="83ef" class="lg kg hi ke b fi ll li l lj lk">export const Editor = () =&gt; {<br/>  return &lt;&gt;&lt;/&gt;;<br/>};</span></pre><p id="fe9c" class="pw-post-body-paragraph je jf hi jg b jh ji ij jj jk jl im jm jn jo jp jq jr js jt ju jv jw jx jy jz hb bi translated">我们还需要安装一些来自<code class="du kb kc kd ke b">npm</code>的库</p><pre class="ix iy iz ja fd lc ke ld le aw lf bi"><span id="cc02" class="lg kg hi ke b fi lh li l lj lk">npm i @codemirror/view @codemirror/state</span></pre><p id="246b" class="pw-post-body-paragraph je jf hi jg b jh ji ij jj jk jl im jm jn jo jp jq jr js jt ju jv jw jx jy jz hb bi translated">CodeMirror需要附加到一个DOM节点，所以我们将通过一个<code class="du kb kc kd ke b">ref</code>来添加它。我们还将使用一个<code class="du kb kc kd ke b">&lt;section&gt;</code>来添加一些语义。在TypeScript类型的世界中，我了解到任何不需要比基本接口提供的更多的HTML元素，比如<code class="du kb kc kd ke b">&lt;section&gt;</code>，都应该使用<code class="du kb kc kd ke b">HTMLElement</code>类型。</p><pre class="ix iy iz ja fd lc ke ld le aw lf bi"><span id="a8fb" class="lg kg hi ke b fi lh li l lj lk">import React from "react";</span><span id="cb97" class="lg kg hi ke b fi ll li l lj lk">export const Editor = () =&gt; {<br/>  const editorRef = React.useRef&lt;HTMLElement&gt;(null);<br/>  return &lt;section ref="editorRef"/&gt;;<br/>};</span></pre><p id="e71d" class="pw-post-body-paragraph je jf hi jg b jh ji ij jj jk jl im jm jn jo jp jq jr js jt ju jv jw jx jy jz hb bi translated">在选择DOM节点之前，<code class="du kb kc kd ke b">editorRef</code>将会是<code class="du kb kc kd ke b">null</code>，所以需要一个<code class="du kb kc kd ke b">useEffect</code>来附加编辑器。</p><pre class="ix iy iz ja fd lc ke ld le aw lf bi"><span id="df42" class="lg kg hi ke b fi lh li l lj lk">React.useEffect(() =&gt; {<br/>  if(editorRef.current === null) return;<br/>  const view = new EditorView({<br/>    state: EditorState.create({ doc: "hello" }),<br/>    parent: editorRef.current<br/>  });<br/>}, [editorRef.current]);</span></pre><h1 id="24c5" class="kf kg hi bd kh ki kj kk kl km kn ko kp io kq ip kr ir ks is kt iu ku iv kv kw bi translated">通过状态</h1><p id="fd9b" class="pw-post-body-paragraph je jf hi jg b jh kx ij jj jk ky im jm jn kz jp jq jr la jt ju jv lb jx jy jz hb bi translated">注意:这部分偏离了视频，因为我在那里犯的错误不是特别重要。</p><p id="4927" class="pw-post-body-paragraph je jf hi jg b jh ji ij jj jk jl im jm jn jo jp jq jr js jt ju jv jw jx jy jz hb bi translated">将使用<code class="du kb kc kd ke b">&lt;Editor&gt;</code>的组件将需要评估正在输入的内容。换句话说，编辑器需要接受一个回调函数，它可以调用这个函数将状态传递给父级。</p><p id="ba8a" class="pw-post-body-paragraph je jf hi jg b jh ji ij jj jk jl im jm jn jo jp jq jr js jt ju jv jw jx jy jz hb bi translated">我尝试使用<code class="du kb kc kd ke b">EditorState["doc"]</code>和<code class="du kb kc kd ke b">EditorState</code>，但是，成功的是返回<code class="du kb kc kd ke b">EditorView</code>。</p><pre class="ix iy iz ja fd lc ke ld le aw lf bi"><span id="9000" class="lg kg hi ke b fi lh li l lj lk">type EditorProps = {<br/>  setView =&gt; (view: EditorView) =&gt; void<br/>}</span></pre><p id="69c1" class="pw-post-body-paragraph je jf hi jg b jh ji ij jj jk jl im jm jn jo jp jq jr js jt ju jv jw jx jy jz hb bi translated">我还意识到没有必要在组件内部声明<code class="du kb kc kd ke b">EditorState</code>，所以我把它移了出来。</p><pre class="ix iy iz ja fd lc ke ld le aw lf bi"><span id="ecb1" class="lg kg hi ke b fi lh li l lj lk">import React from "react";</span><span id="e69b" class="lg kg hi ke b fi ll li l lj lk">const state = EditorState.create({ doc: "hello" });</span><span id="3467" class="lg kg hi ke b fi ll li l lj lk">export const Editor = () =&gt; { /* ... */ };</span></pre><p id="b3f0" class="pw-post-body-paragraph je jf hi jg b jh ji ij jj jk jl im jm jn jo jp jq jr js jt ju jv jw jx jy jz hb bi translated">在编辑器中，一旦视图准备好，就可以调用组件<code class="du kb kc kd ke b">setView</code>。卸载编辑器时销毁视图也很重要。</p><pre class="ix iy iz ja fd lc ke ld le aw lf bi"><span id="11cf" class="lg kg hi ke b fi lh li l lj lk">React.useEffect(() =&gt; {<br/>  if(editorRef.current === null) return;</span><span id="880f" class="lg kg hi ke b fi ll li l lj lk">  const view = new EditorView({<br/>    state: EditorState.create({ doc: "hello" }),<br/>    parent: editorRef.current<br/>  });</span><span id="741d" class="lg kg hi ke b fi ll li l lj lk">  setView(view);</span><span id="fa14" class="lg kg hi ke b fi ll li l lj lk">  return () =&gt; {<br/>    view.destroy();<br/>    setView(null);<br/>  };<br/>}, [editorRef.current]);</span></pre><p id="d74b" class="pw-post-body-paragraph je jf hi jg b jh ji ij jj jk jl im jm jn jo jp jq jr js jt ju jv jw jx jy jz hb bi translated">可以更新父组件以使用<code class="du kb kc kd ke b">&lt;Editor&gt;</code>组件，也可以更新代码评估器以使用<code class="du kb kc kd ke b">EditorView.state.doc</code>。</p><pre class="ix iy iz ja fd lc ke ld le aw lf bi"><span id="505a" class="lg kg hi ke b fi lh li l lj lk"><em class="lm">import React from </em>"react";<br/><em class="lm">import </em>{ <em class="lm">Editor </em>} <em class="lm">from </em>"../../../components/editor";<br/><em class="lm">import </em>{ EditorView } <em class="lm">from </em>"@codemirror/view";<br/><br/><br/><em class="lm">const StringPage </em>= () =&gt; {<br/>  <em class="lm">const </em>[view, setView] = <em class="lm">React</em>.<em class="lm">useState</em>&lt;EditorView | <em class="lm">null</em>&gt;(<em class="lm">null</em>);<br/> <br/>  /* ... */</span><span id="ecd2" class="lg kg hi ke b fi ll li l lj lk">  <em class="lm">const </em>evaluateCode = () =&gt; {<br/>    <em class="lm">if </em>(view === <em class="lm">null</em>) <em class="lm">return</em>;<br/>    <em class="lm">const </em>code = view.state.doc.toString();<br/>    <em class="lm">try </em>{<br/>      <em class="lm">new </em>Function(code)();<br/>    } <em class="lm">catch </em>(e) {<br/>      console.error(e);<br/>    }<br/>  };<br/><br/>  <em class="lm">return </em>(<br/>    &lt;&gt;<br/>      {/* irrelevant components omitted */}<br/>      &lt;Editor <em class="lm">setView</em>={setView} /&gt;<br/>    &lt;/&gt;<br/>  );<br/>};<br/><br/><em class="lm">export default StringPage</em>;</span></pre><h1 id="43b4" class="kf kg hi bd kh ki kj kk kl km kn ko kp io kq ip kr ir ks is kt iu ku iv kv kw bi translated">TL；速度三角形定位法(dead reckoning)</h1><p id="92e7" class="pw-post-body-paragraph je jf hi jg b jh kx ij jj jk ky im jm jn kz jp jq jr la jt ju jv lb jx jy jz hb bi translated">我将CodeMirror版本6放入React组件中。</p></div><div class="ab cl ln lo gp lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="hb hc hd he hf"><p id="a43b" class="pw-post-body-paragraph je jf hi jg b jh ji ij jj jk jl im jm jn jo jp jq jr js jt ju jv jw jx jy jz hb bi translated"><em class="lm">原籍:</em></p><div class="lu lv ez fb lw lx"><a href="https://www.bayanbennett.com/posts/failing-to-add-codemirror-6-and-then-succeeding-devlog-004" rel="noopener  ugc nofollow" target="_blank"><div class="ly ab dw"><div class="lz ab ma cl cj mb"><h2 class="bd hj fi z dy mc ea eb md ed ef hh bi translated">无法添加CodeMirror 6(然后成功)| DevLog 004</h2><div class="me l"><h3 class="bd b fi z dy mc ea eb md ed ef dx translated">在上一篇文章中，我创建了一个React组件，它截取并格式化了console.log和…</h3></div><div class="mf l"><p class="bd b fp z dy mc ea eb md ed ef dx translated">www.bayanbennett.com</p></div></div></div></a></div></div><div class="ab cl ln lo gp lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="hb hc hd he hf"><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="er es mg"><img src="../Images/51104934595d20d6676a01de1f0acc72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3xNidVU4A6n0ZfBd0XHUTg.png"/></div></div><figcaption class="mn mo et er es mp mq bd b be z dx translated">这篇文章的缩略图</figcaption></figure></div></div>    
</body>
</html>