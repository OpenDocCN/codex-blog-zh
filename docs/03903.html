<html>
<head>
<title>💪Create an Azure Machine Learning Compute Instance using Azure Bicep</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">💪使用Azure Bicep创建Azure机器学习计算实例</h1>
<blockquote>原文：<a href="https://medium.com/codex/create-an-azure-machine-learning-compute-instance-using-azure-bicep-491783578656?source=collection_archive---------3-----------------------#2021-10-06">https://medium.com/codex/create-an-azure-machine-learning-compute-instance-using-azure-bicep-491783578656?source=collection_archive---------3-----------------------#2021-10-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="af55" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">了解如何使用Bicep模板利用基础设施即代码来创建Azure机器学习服务计算实例。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/524c2b08210f2739adeaa3fe175f6dc2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-iAJwnWeioXaCnXNHLCCeg.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">使用Azure Bicep创建Azure机器学习计算实例</figcaption></figure></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><p id="1432" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> Azure Machine Learning </strong>是一款用于加速和管理机器学习项目生命周期的云服务。</p><p id="7399" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在之前的<a class="ae ka" href="https://blog.azinsider.net/using-bicep-to-create-workspace-resources-and-get-started-with-azure-machine-learning-bcc57fd4fd09" rel="noopener ugc nofollow" target="_blank">文章</a>中，我们回顾了如何开始使用Azure机器学习服务和架构。我们还提供了一个创建工作空间的二头肌模板。在开始使用Azure Machine Learning之前，需要这个工作区。</p><p id="cdb0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下图显示了Azure机器学习的高级架构以及工作区中包含的组件:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kb"><img src="../Images/d55b78e189df4ca6d05576f986dec53b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*US6l8c6J5U6Wpadb.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">Azure机器学习</figcaption></figure><p id="af14" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦在Azure订阅中部署了工作空间，就可以开始开发自己的Azure机器学习服务，第一步是根据模型的需要添加计算实例和计算集群。</p><h1 id="0fad" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">Azure机器学习计算实例。</h1><p id="4c00" class="pw-post-body-paragraph if ig hi ih b ii la ik il im lb io ip iq lc is it iu ld iw ix iy le ja jb jc hb bi translated">将计算实例视为一个托管云工作站，供您使用机器学习模型。这是一个托管虚拟机，将包括一些预构建功能，以便您可以专注于您的机器学习开发环境。</p><p id="9c19" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一个计算实例将集成在工作区和Azure Machine Learning Studio之上。您可以使用集成的笔记本和工具(如Jupyter、JupyterLab、Visual Studio Code和RStudio)来构建和部署模型。</p><h2 id="7570" class="lf kd hi bd ke lg lh li ki lj lk ll km iq lm ln kq iu lo lp ku iy lq lr ky ls bi translated">创建计算实例</h2><p id="8a22" class="pw-post-body-paragraph if ig hi ih b ii la ik il im lb io ip iq lc is it iu ld iw ix iy le ja jb jc hb bi translated">可以使用Azure Machine Learning Studio中的工作区按需创建计算实例。您可以使用Azure门户、ARM模板、使用Azure机器学习SDF、使用AML的CLI扩展和使用Bicep来创建计算实例。</p><p id="2265" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在让我们看看如何使用Azure Bicep创建Azure机器学习计算实例。</p><h1 id="663d" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">使用Azure Bicep创建Azure机器学习计算实例</h1><h2 id="abbc" class="lf kd hi bd ke lg lh li ki lj lk ll km iq lm ln kq iu lo lp ku iy lq lr ky ls bi translated">1.先决条件</h2><p id="9069" class="pw-post-body-paragraph if ig hi ih b ii la ik il im lb io ip iq lc is it iu ld iw ix iy le ja jb jc hb bi translated">有两个先决条件:</p><ul class=""><li id="1505" class="lt lu hi ih b ii ij im in iq lv iu lw iy lx jc ly lz ma mb bi translated">创建资源组。</li><li id="c80f" class="lt lu hi ih b ii mc im md iq me iu mf iy mg jc ly lz ma mb bi translated">在创建、计算实例之前，请确保您有一个工作空间。你可以参考这篇<a class="ae ka" href="https://blog.azinsider.net/using-bicep-to-create-workspace-resources-and-get-started-with-azure-machine-learning-bcc57fd4fd09" rel="noopener ugc nofollow" target="_blank">文章</a>使用Bicep创建一个工作空间。</li></ul><p id="6788" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦你有了Azure机器学习工作空间，获取以下信息:</p><ul class=""><li id="afca" class="lt lu hi ih b ii ij im in iq lv iu lw iy lx jc ly lz ma mb bi translated">工作区名称:计算实例将部署到的Azure机器学习工作区的名称</li><li id="6593" class="lt lu hi ih b ii mc im md iq me iu mf iy mg jc ly lz ma mb bi translated">对象id:计算实例分配到的用户的Azure AD对象ID。你可以从你部署的Azure机器学习工作区获得这些信息。然后转到identity选项并获取对象ID，如下所示:</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mh"><img src="../Images/27be931d71fee91c68e4b5672fad1352.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rcgaEzxjzg73PJLuP4Lmqg.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">Azure机器学习-对象ID</figcaption></figure><h2 id="f4da" class="lf kd hi bd ke lg lh li ki lj lk ll km iq lm ln kq iu lo lp ku iy lq lr ky ls bi translated">2.部署Bicep文件以创建Azure机器学习计算实例</h2><p id="6086" class="pw-post-body-paragraph if ig hi ih b ii la ik il im lb io ip iq lc is it iu ld iw ix iy le ja jb jc hb bi translated">代码显示了创建Azure机器学习计算实例的Bifep文件的定义:</p><pre class="je jf jg jh fd mi mj mk ml aw mm bi"><span id="2cf1" class="lf kd hi mj b fi mn mo l mp mq"><a class="ae ka" href="http://twitter.com/description" rel="noopener ugc nofollow" target="_blank">@description</a>('Specifies the name of the Azure Machine Learning workspace to which compute instance will be deployed')<br/>param workspaceName string</span><span id="0abb" class="lf kd hi mj b fi mr mo l mp mq"><a class="ae ka" href="http://twitter.com/description" rel="noopener ugc nofollow" target="_blank">@description</a>('Specifies the name of the Azure Machine Learning compute instance to be deployed')<br/>param computeName string</span><span id="e7d7" class="lf kd hi mj b fi mr mo l mp mq"><a class="ae ka" href="http://twitter.com/description" rel="noopener ugc nofollow" target="_blank">@description</a>('Location of the Azure Machine Learning workspace.')<br/>param location string = resourceGroup().location</span><span id="2640" class="lf kd hi mj b fi mr mo l mp mq"><a class="ae ka" href="http://twitter.com/description" rel="noopener ugc nofollow" target="_blank">@description</a>('The VM size for compute instance')<br/>param vmSize string = 'Standard_DS3_v2'</span><span id="d680" class="lf kd hi mj b fi mr mo l mp mq"><a class="ae ka" href="http://twitter.com/description" rel="noopener ugc nofollow" target="_blank">@description</a>('Name of the resource group which holds the VNET to which you want to inject your compute instance in.')<br/>param vnetResourceGroupName string = ''</span><span id="6bb6" class="lf kd hi mj b fi mr mo l mp mq"><a class="ae ka" href="http://twitter.com/description" rel="noopener ugc nofollow" target="_blank">@description</a>('Name of the vnet which you want to inject your compute instance in.')<br/>param vnetName string = ''</span><span id="aebc" class="lf kd hi mj b fi mr mo l mp mq"><a class="ae ka" href="http://twitter.com/description" rel="noopener ugc nofollow" target="_blank">@description</a>('Name of the subnet inside the VNET which you want to inject your compute instance in.')<br/>param subnetName string = ''</span><span id="2915" class="lf kd hi mj b fi mr mo l mp mq"><a class="ae ka" href="http://twitter.com/description" rel="noopener ugc nofollow" target="_blank">@description</a>('AAD tenant id of the user to which compute instance is assigned to')<br/>param tenantId string = subscription().tenantId</span><span id="82cd" class="lf kd hi mj b fi mr mo l mp mq"><a class="ae ka" href="http://twitter.com/description" rel="noopener ugc nofollow" target="_blank">@description</a>('AAD object id of the user to which compute instance is assigned to')<br/>param objectId string</span><span id="cfc4" class="lf kd hi mj b fi mr mo l mp mq"><a class="ae ka" href="http://twitter.com/description" rel="noopener ugc nofollow" target="_blank">@description</a>('inline command')<br/>param inlineCommand string = 'ls'</span><span id="0471" class="lf kd hi mj b fi mr mo l mp mq"><a class="ae ka" href="http://twitter.com/description" rel="noopener ugc nofollow" target="_blank">@description</a>('Specifies the cmd arguments of the creation script in the storage volume of the Compute Instance.')<br/>param creationScript_cmdArguments string = ''</span><span id="63cc" class="lf kd hi mj b fi mr mo l mp mq">var subnet = {<br/>  id: resourceId(vnetResourceGroupName, 'Microsoft.Network/virtualNetworks/subnets', vnetName, subnetName)<br/>}</span><span id="1528" class="lf kd hi mj b fi mr mo l mp mq">resource workspaceName_computeName 'Microsoft.MachineLearningServices/workspaces/computes@2021-07-01' = {<br/>  name: '${workspaceName}/${computeName}'<br/>  location: location<br/>  properties: {<br/>    computeType: 'ComputeInstance'<br/>    properties: {<br/>      vmSize: vmSize<br/>      subnet: (((!empty(vnetResourceGroupName)) &amp;&amp; (!empty(vnetName)) &amp;&amp; (!empty(subnetName))) ? subnet : json('null'))<br/>      personalComputeInstanceSettings: {<br/>        assignedUser: {<br/>          objectId: objectId<br/>          tenantId: tenantId<br/>        }<br/>      }<br/>      setupScripts: {<br/>        scripts: {<br/>          creationScript: {<br/>            scriptSource: 'inline'<br/>            scriptData: base64(inlineCommand)<br/>            scriptArguments: creationScript_cmdArguments<br/>          }<br/>        }<br/>      }<br/>      <br/>    }<br/>  }<br/>}</span></pre><p id="b99c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们将定义参数文件。</p><h2 id="2e4c" class="lf kd hi bd ke lg lh li ki lj lk ll km iq lm ln kq iu lo lp ku iy lq lr ky ls bi translated">3.参数文件。</h2><p id="5dd3" class="pw-post-body-paragraph if ig hi ih b ii la ik il im lb io ip iq lc is it iu ld iw ix iy le ja jb jc hb bi translated">下面的代码显示了我们将在部署时传递的三个参数的定义:</p><pre class="je jf jg jh fd mi mj mk ml aw mm bi"><span id="e6ca" class="lf kd hi mj b fi mn mo l mp mq">{<br/>    "$schema": "<a class="ae ka" href="https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#" rel="noopener ugc nofollow" target="_blank">https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#</a>",<br/>    "contentVersion": "1.0.0.0",<br/>    "parameters": {<br/>        "workspaceName": {<br/>            "value": "YOUR-WORKSPACE-NAME"<br/>        },<br/>        "computeName": {<br/>            "value": "YOUR-COMPUTE-NAME"<br/>        },<br/>        "objectId": {<br/>            "value": "YOUR-WORKSPACE-OBJECT-ID"<br/>        }<br/>    }<br/>}</span></pre><p id="7fa0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们有了两个文件，创建Azure机器学习计算实例的Bicep文件和参数文件，我们将使用下面的命令执行部署:</p><pre class="je jf jg jh fd mi mj mk ml aw mm bi"><span id="41a1" class="lf kd hi mj b fi mn mo l mp mq">$date = Get-Date -Format "MM-dd-yyyy"<br/>$deploymentName = "AzInsiderDeployment"+"$date"</span><span id="ab11" class="lf kd hi mj b fi mr mo l mp mq">New-AzResourceGroupDeployment -Name $deploymentName -ResourceGroupName AzInsiderML -TemplateFile .\main.bicep -TemplateParameterFile .\azuredeploy.parameters.json -c</span></pre><p id="7935" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意:我们在末尾添加了标志-c，以便预览部署，如下所示:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ms"><img src="../Images/9f4220a7e74e40f68b306bce3bda8ab8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l2pfpzr_jqT1yoAkIM9Fxw.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">Azure机器学习计算实例— Bicep部署预览</figcaption></figure><p id="730c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">验证完成后，让我们执行部署。下图显示了此部署的输出。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mt"><img src="../Images/b39d2da76c38f36856a981ba5a1e2e92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Clf_otNJaK02WJUJWVlX3w.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">Azure机器学习计算实例部署输出。</figcaption></figure><p id="c20c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要验证部署，您可以转到Azure门户，然后选择您的工作区并选择Launch Studio选项，如下所示:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mu"><img src="../Images/fac58eac35163407c0d8c015b035ed9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hDfEklrRvgJa2eX-Axc9wg.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">Azure机器学习工作区</figcaption></figure><p id="79f8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您将被重定向到Microsoft Azure Machine Learning Studio门户，您将会看到一个通知，告知您已经提供了一个新的计算资源，如下所示:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mv"><img src="../Images/354219ceda755f387c6e442d668af6f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KhFaHBAsdKNhZludRvtAsw.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">微软Azure机器学习工作室门户</figcaption></figure><p id="19f8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这些计算资源可以在虚拟网络中安全地运行作业，而无需打开SSH端口。</p><p id="cbef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以将计算实例重新用作开发工作站或培训的计算目标。可以利用多个计算实例并将它们附加到您的工作区。</p><h1 id="f542" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">下一步。</h1><p id="5967" class="pw-post-body-paragraph if ig hi ih b ii la ik il im lb io ip iq lc is it iu ld iw ix iy le ja jb jc hb bi translated">我向您推荐以下资源:</p><div class="mw mx ez fb my mz"><a href="https://docs.microsoft.com/en-us/azure/machine-learning/how-to-access-terminal?WT.mc_id=AZ-MVP-5000671" rel="noopener  ugc nofollow" target="_blank"><div class="na ab dw"><div class="nb ab nc cl cj nd"><h2 class="bd hj fi z dy ne ea eb nf ed ef hh bi translated">如何访问工作区中的计算实例终端——Azure Machine Learning</h2><div class="ng l"><h3 class="bd b fi z dy ne ea eb nf ed ef dx translated">访问工作区中计算实例的终端，以使用Git和版本文件中的文件。这些文件是…</h3></div><div class="nh l"><p class="bd b fp z dy ne ea eb nf ed ef dx translated">docs.microsoft.com</p></div></div><div class="ni l"><div class="nj l nk nl nm ni nn jn mz"/></div></div></a></div><div class="mw mx ez fb my mz"><a href="https://docs.microsoft.com/en-us/azure/machine-learning/how-to-deploy-model-designer?WT.mc_id=AZ-MVP-5000671" rel="noopener  ugc nofollow" target="_blank"><div class="na ab dw"><div class="nb ab nc cl cj nd"><h2 class="bd hj fi z dy ne ea eb nf ed ef hh bi translated">使用studio部署在designer - Azure机器学习中训练的模型</h2><div class="ng l"><h3 class="bd b fi z dy ne ea eb nf ed ef dx translated">在本文中，您将了解如何在Azure Machine Learning studio中将设计器模型部署为实时端点…</h3></div><div class="nh l"><p class="bd b fp z dy ne ea eb nf ed ef dx translated">docs.microsoft.com</p></div></div><div class="ni l"><div class="no l nk nl nm ni nn jn mz"/></div></div></a></div><p id="7ea7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae ka" href="http://eepurl.com/gKmLdf" rel="noopener ugc nofollow" target="_blank"> <em class="np">在此加入</em><strong class="ih hj"><em class="np">azin sider</em></strong><em class="np">邮箱列表。</em>T9】</a></p><p id="86b7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="np">-戴夫·r·</em></p></div></div>    
</body>
</html>