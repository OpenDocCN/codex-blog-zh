<html>
<head>
<title>Migrating a Legacy App to Cloud Native — Part 4</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将传统应用迁移到云原生环境—第4部分</h1>
<blockquote>原文：<a href="https://medium.com/codex/migrating-a-legacy-app-to-cloud-native-part-4-2741585e4953?source=collection_archive---------0-----------------------#2020-08-09">https://medium.com/codex/migrating-a-legacy-app-to-cloud-native-part-4-2741585e4953?source=collection_archive---------0-----------------------#2020-08-09</a></blockquote><div><div class="dt gx gy gz ha hb"/><div class="hc hd he hf hg"><div class=""/><figure class="ew ey ih ii ij ik es et paragraph-image"><div role="button" tabindex="0" class="il im di in bf io"><div class="es et ig"><img src="../Images/a28fe7066c9be0af3f955771a19bb67b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*GGbTORDfQF7i8X66"/></div></div><figcaption class="ir is eu es et it iu bd b be z dy translated"><a class="ae iv" href="https://unsplash.com/@steve_j?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">斯蒂夫·约翰森</a>在<a class="ae iv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</figcaption></figure><p id="6186" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">在本系列的第4部分中，我添加了Amplify存储，并探讨了它的安全模型以及如何定制它…</p><ul class=""><li id="322e" class="ju jv hj iy b iz ja jd je jh jw jl jx jp jy jt jz ka kb kc bi translated">第一部分:背景</li><li id="4de5" class="ju jv hj iy b iz kd jd ke jh kf jl kg jp kh jt jz ka kb kc bi translated"><a class="ae iv" rel="noopener" href="/@kernwig/migrating-a-legacy-app-to-cloud-native-part-2-533dfebd38fb">第二部分:需求&amp;架构</a></li><li id="880d" class="ju jv hj iy b iz kd jd ke jh kf jl kg jp kh jt jz ka kb kc bi translated"><a class="ae iv" rel="noopener" href="/@kernwig/migrating-a-legacy-app-to-cloud-native-part-3-4bb187fea485">第3部分:认证</a></li></ul><p id="e293" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">Amplify有一个存储模块，可以由S3或DynamoDB在AWS中支持。回到第2部分，在探索应用程序需求时，我注意到S3将用于存储用户设置和数据集合。简而言之，DynamoDB不能使用，因为:</p><ol class=""><li id="f5a4" class="ju jv hj iy b iz ja jd je jh jw jl jx jp jy jt ki ka kb kc bi translated">记录被限制在400 KB以内，我不想将一个集合限制在这个大小。</li><li id="7318" class="ju jv hj iy b iz kd jd ke jh kf jl kg jp kh jt ki ka kb kc bi translated">Amplify的存储API可能使用S3 <em class="kj">或</em>DynamoDB；对于不同的数据，我们不能两者都用。因此，用户设置，虽然很小，也会进入S3。</li></ol><p id="7fab" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated"><em class="kj">注意:我后来发现，虽然CLI提供了DynamoDB存储选项，但任何语言的Amplify库都不支持它。</em></p><p id="0436" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">我们将使用DynamoDB进行搜索(参见需求)，但这将是以后的事情。现在，我们只想保存并回读用户设置和集合。</p><p id="8348" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">如果在这个系列中还不清楚，我写这个是因为我试图用<em class="kj">放大。这是一个关于<em class="kj">旅程</em>的系列，而不是简单的操作指南。</em></p><h1 id="98a3" class="kk kl hj bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">添加存储</h1><p id="8284" class="pw-post-body-paragraph iw ix hj iy b iz li jb jc jd lj jf jg jh lk jj jk jl ll jn jo jp lm jr js jt hc bi translated">我们在哪里停下来的？</p><pre class="ln lo lp lq fe lr ls lt lu aw lv bi"><span id="991e" class="lw kl hj ls b fj lx ly l lz ma">$ amplify status<br/><br/>Current Environment: dev<br/><br/>| Category | Resource name   | Operation | Provider plugin   |<br/>| -------- | --------------- | --------- | ----------------- |<br/>| Hosting  | S3AndCloudFront | No Change | awscloudformation |<br/>| Auth     | sqacauth        | No Change | awscloudformation |<br/><br/>Hosting endpoint: http://sqac-amplify-20190817123020-hostingbucket-dev.s3-website-us-west-2.amazonaws.com<br/>Hosted UI Endpoint: https://sqac-dev.auth.us-west-2.amazoncognito.com/</span></pre><p id="1e31" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">我只有托管和授权。因此，让我们添加存储:</p><pre class="ln lo lp lq fe lr ls lt lu aw lv bi"><span id="0d36" class="lw kl hj ls b fj lx ly l lz ma">$ amplify add storage<br/>? Please select from one of the below mentioned services Content (Images, audio, video, etc.)<br/>? Please provide a friendly name for your resource that will be used to label this category in the project: storage<br/>? Please provide bucket name: sqac-amplify-user-data<br/>? Who should have access: Auth and guest users<br/>? What kind of access do you want for Authenticated users? create/update, read, delete<br/>? What kind of access do you want for Guest users? read<br/>? Do you want to add a Lambda Trigger for your S3 Bucket? No<br/>Successfully added resource storage locally<br/><br/>Some next steps:<br/>"amplify push" builds all of your local backend resources and provisions them in the cloud<br/>"amplify publish" builds all of your local backend and front-end resources (if you added hosting category) and provisions them in the cloud</span></pre><p id="60a2" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">我选择“图像、音频、视频等”内容，而不是NoSQL选项。这就是你如何得到S3，而不是DynamoDB。然后我给这些东西起了友好的名字，而不是随机生成的默认值。</p><p id="9d65" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">在探索需求时，我声明我希望第一次访问我的应用程序的人不需要首先创建一个帐户，因此我选择提供来宾只读访问。经过身份验证的用户拥有完全读写权限。</p><p id="a80f" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">虽然我们最终会在S3桶中添加一个Lambda触发器，但这是一个很大的任务，所以我现在回答不。Amplify允许我们稍后使用<code class="dv mb mc md ls b">amplify storage update</code>命令来改变事情。</p><p id="fdd9" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">接下来，让我们部署这些变化…</p><pre class="ln lo lp lq fe lr ls lt lu aw lv bi"><span id="896b" class="lw kl hj ls b fj lx ly l lz ma">$ amplify push<br/><br/>Current Environment: dev<br/><br/>| Category | Resource name   | Operation | Provider plugin   |<br/>| -------- | --------------- | --------- | ----------------- |<br/>| Storage  | storage         | Create    | awscloudformation |<br/>| Hosting  | S3AndCloudFront | No Change | awscloudformation |<br/>| Auth     | sqacauth        | No Change | awscloudformation |<br/>? Are you sure you want to continue? Yes<br/>⠴ Updating resources in the cloud. This may take a few minutes...<br/><br/>… A few dozen lines of CloudFormation output over a few minutes … <br/><br/>✔ All resources are updated in the cloud</span></pre><p id="f336" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">没什么。在AWS控制台(网站)中，我看到一个新的<code class="dv mb mc md ls b">sqac-amplify-user-data-dev</code>空桶。(<code class="dv mb mc md ls b">-dev</code>是我的环境名；它被附加到任何东西上以支持多种环境。🥳)</p><p id="9c3b" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">所以我们结束了，对吗？嗯……那要看情况。</p><h1 id="fbb5" class="kk kl hj bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">安全策略和参数</h1><p id="39d9" class="pw-post-body-paragraph iw ix hj iy b iz li jb jc jd lj jf jg jh lk jj jk jl ll jn jo jp lm jr js jt hc bi translated"><em class="kj">警告:我将在这里深入探讨AWS政策和云形成。你可以跟着</em> <a class="ae iv" href="https://github.com/kernwig/sqac-amplify/pull/3" rel="noopener ugc nofollow" target="_blank"> <em class="kj">中的文件第四部分拉请求</em> </a> <em class="kj">，或者只是让你的目光呆滞。</em>😳</p><p id="5faf" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">我仔细研究了定义存储(包括策略)的新CloudFormation堆栈，发现这并不是我想要的。我希望用户将他们的私有数据保持在私有访问级别，将共享数据保持在受保护的访问级别，除此之外别无其他。虽然政策也允许用户在公共区域写访问，但这不是很有用，因为任何人都可以在这里写任何东西，任何人都可以修改或删除它。我真的不想那样。啊哦？但后来我意识到我正在查看堆栈的“参数”部分，在amplify文件夹中有一个<code class="dv mb mc md ls b">parameters.json</code>文件。💡这里是<code class="dv mb mc md ls b">parameters.json</code>:</p><pre class="ln lo lp lq fe lr ls lt lu aw lv bi"><span id="97c5" class="lw kl hj ls b fj lx ly l lz ma">{<br/>   "bucketName": "sqac-amplify-user-data",<br/>   "authPolicyName": "s3_amplify_7405df3b",<br/>   "unauthPolicyName": "s3_amplify_7405df3b",<br/>   "authRoleName": {<br/>       "Ref": "AuthRoleName"<br/>   },<br/>   "unauthRoleName": {<br/>       "Ref": "UnauthRoleName"<br/>   },<br/>   "selectedGuestPermissions": [<br/>       "s3:GetObject",<br/>       "s3:ListBucket"<br/>   ],<br/>   "selectedAuthenticatedPermissions": [<br/>       "s3:PutObject",<br/>       "s3:GetObject",<br/>       "s3:ListBucket",<br/>       "s3:DeleteObject"<br/>   ],<br/>   "s3PermissionsAuthenticatedPublic": "s3:PutObject,s3:GetObject,s3:DeleteObject",<br/>   "s3PublicPolicy": "Public_policy_9efc80af",<br/>   "s3PermissionsAuthenticatedUploads": "s3:PutObject",<br/>   "s3UploadsPolicy": "Uploads_policy_9efc80af",<br/>   "s3PermissionsAuthenticatedProtected": "s3:PutObject,s3:GetObject,s3:DeleteObject",<br/>   "s3ProtectedPolicy": "Protected_policy_7b753c06",<br/>   "s3PermissionsAuthenticatedPrivate": "s3:PutObject,s3:GetObject,s3:DeleteObject",<br/>   "s3PrivatePolicy": "Private_policy_7b753c06",<br/>   "AuthenticatedAllowList": "ALLOW",<br/>   "s3ReadPolicy": "read_policy_9efc80af",<br/>   "s3PermissionsGuestPublic": "s3:GetObject",<br/>   "s3PermissionsGuestUploads": "DISALLOW",<br/>   "GuestAllowList": "ALLOW",<br/>   "triggerFunction": "NONE"<br/>}</span></pre><p id="1cb1" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">酷毙了。让我们看看我在这里想要什么…</p><pre class="ln lo lp lq fe lr ls lt lu aw lv bi"><span id="e696" class="lw kl hj ls b fj lx ly l lz ma">"s3PermissionsAuthenticatedPublic": "s3:GetObject",</span></pre><p id="2338" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">我想那就行了。我只是取消了在公共区域写东西的许可。任何人，包括客人，仍然可以从中阅读。只有我手动放入的数据才能存在，因此我可以将它用于来宾“演示模式”内容。(我不会的，继续读下去。)这里没有什么能完全清楚地说明<em class="kj">受保护的</em>功能是如何工作的，但这些只是配置选项，而不是实际的策略。为此，我翻遍了Amplify创建的<code class="dv mb mc md ls b">s3-cloudformation-template.json</code>文件。JSON格式有点冗长，所以我在AWS控制台中弹出CloudFormation Designer (GUI)工具，并使用它来选择策略，以便在更简洁的结果YAML中查看。</p><p id="c336" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">我发现的第一个有趣的地方是:</p><pre class="ln lo lp lq fe lr ls lt lu aw lv bi"><span id="0b10" class="lw kl hj ls b fj lx ly l lz ma">S3GuestReadPolicy:<br/>    DependsOn:<br/>      - S3Bucket<br/>    Condition: GuestReadAndList<br/>    Type: 'AWS::IAM::Policy'<br/>    Properties:<br/>      PolicyName: !Ref s3ReadPolicy<br/>      Roles:<br/>        - !Ref unauthRoleName<br/>      PolicyDocument:<br/>        Version: 2012-10-17<br/>        Statement:<br/>          - Effect: Allow<br/>            Action:<br/>              - 's3:GetObject'<br/>            Resource:<br/>              - !Join <br/>                - ''<br/>                - - 'arn:aws:s3:::'<br/>                  - !Ref S3Bucket<br/>                  - /protected/*<br/>          - Effect: Allow<br/>            Action:<br/>              - 's3:ListBucket'<br/>            Resource:<br/>              - !Join <br/>                - ''<br/>                - - 'arn:aws:s3:::'<br/>                  - !Ref S3Bucket<br/>            Condition:<br/>              StringLike:<br/>                's3:prefix':<br/>                  - public/<br/>                  - public/*<br/>                  - protected/<br/>                  - protected/*</span></pre><p id="e3b1" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">如果您还没有注意到，Amplify通过在S3密匙前面加上<code class="dv mb mc md ls b">public</code>、<code class="dv mb mc md ls b">protected</code>或<code class="dv mb mc md ls b">private</code>来管理访问级别，后面是认证用户的ID。(您可以将它们视为文件系统文件夹，尽管从技术上讲它们并不是。)因此，假设一个Cognito ID为123的用户将在<code class="dv mb mc md ls b">private/123/</code>中存储私有数据，在<code class="dv mb mc md ls b">protected/123/</code>中存储受保护的数据。注意这里有一个<code class="dv mb mc md ls b">public/*</code>前缀匹配条件。这是不是意味着用户只能在自己的公共区域写？如果是，公开和受保护的区别是什么？我必须再挖一些！</p><p id="106f" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">这个政策确实回答了我的一个问题:一个访客用户<em class="kj">可以阅读受保护的内容，而不仅仅是公开的。我可能根本不需要公开。</em></p><p id="364f" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated"><code class="dv mb mc md ls b">S3AuthReadPolicy</code>(针对经过身份验证的用户，而不是来宾)与此类似，但是多了两个前缀，允许读取用户的私有数据。因此，经过身份验证的用户可以阅读除其他用户的私人部分之外的任何内容:</p><pre class="ln lo lp lq fe lr ls lt lu aw lv bi"><span id="f1d4" class="lw kl hj ls b fj lx ly l lz ma">Condition:<br/>      StringLike:<br/>        's3:prefix':<br/>          - public/<br/>          - public/*<br/>          - protected/<br/>          - protected/*<br/>          - 'private/${cognito-identity.amazonaws.com:sub}/'<br/>          - 'private/${cognito-identity.amazonaws.com:sub}/*'</span></pre><p id="2666" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">有一个<code class="dv mb mc md ls b">S3GuestUploadPolicy</code>允许客人上传到一个<code class="dv mb mc md ls b">uploads/</code>前缀，但是它被默认参数<code class="dv mb mc md ls b">s3PermissionsGuestUploads</code>设置为<code class="dv mb mc md ls b">DISALLOW</code>而无效。👍这导致了针对认证用户的<code class="dv mb mc md ls b">S3AuthUploadPolicy</code>，这允许用户将文件转储到<code class="dv mb mc md ls b">uploads/</code>前缀中，而没有办法读回它。我想这一定是一个允许上传的特性，然后由触发的Lambda处理。我不需要这样的上传，所以在<code class="dv mb mc md ls b">parameters.json</code>中，我将<code class="dv mb mc md ls b">s3PermissionsAuthenticatedUploads</code>设置为<code class="dv mb mc md ls b">DISALLOW</code>，就像为客人设置的参数一样。</p><p id="2d20" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">继续，我看到一个<code class="dv mb mc md ls b">S3AuthPublicPolicy</code>，它与我已经更改为<code class="dv mb mc md ls b">S3:GetObject</code>的<code class="dv mb mc md ls b">s3PermissionsAuthenticatedPublic</code>参数相关联；因此，经过身份验证的用户只能读取，不能写入公共区域。我发现这适用于public前缀中的任何地方，对用户ID没有任何限制:</p><pre class="ln lo lp lq fe lr ls lt lu aw lv bi"><span id="cea1" class="lw kl hj ls b fj lx ly l lz ma">Resource:<br/>      - !Join <br/>        - ''<br/>        - - 'arn:aws:s3:::'<br/>          - !Ref S3Bucket<br/>          - /public/*</span></pre><p id="2130" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">与<code class="dv mb mc md ls b">S3AuthProtectedPolicy</code>相比，哪个<em class="kj"/>限制对用户ID的写活动:</p><pre class="ln lo lp lq fe lr ls lt lu aw lv bi"><span id="b8f8" class="lw kl hj ls b fj lx ly l lz ma">Resource:<br/>       - !Join <br/>          - ''<br/>          - - 'arn:aws:s3:::'<br/>            - !Ref S3Bucket<br/>            - '/protected/${cognito-identity.amazonaws.com:sub}/*'</span></pre><p id="92c1" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated"><code class="dv mb mc md ls b">S3AuthPrivatePolicy</code>看起来几乎一样，保护私有文件夹:</p><pre class="ln lo lp lq fe lr ls lt lu aw lv bi"><span id="a238" class="lw kl hj ls b fj lx ly l lz ma">Resource:<br/>       - !Join <br/>          - ''<br/>          - - 'arn:aws:s3:::'<br/>            - !Ref S3Bucket<br/>            - '/private/${cognito-identity.amazonaws.com:sub}/*'</span></pre><p id="a5c0" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">那么有什么区别呢？向上滚动回到<code class="dv mb mc md ls b">S3GuestReadPolicy</code>和<code class="dv mb mc md ls b">S3AuthReadPolicy</code>。虽然<code class="dv mb mc md ls b">S3AuthProtectedPolicy</code>和<code class="dv mb mc md ls b">S3AuthPrivatePolicy</code>涵盖了用户可以<em class="kj">写入</em>的内容，但是早期的策略允许任何人<em class="kj">读取</em>前缀。</p><p id="a2f1" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">我一直很困惑为什么Amplify的文档没有明确定义访问角色:公共、受保护和私有。以前找不到任何解释，但是看到现在有一些细节<a class="ae iv" href="https://aws-amplify.github.io/docs/js/storage#using-amazon-s3" rel="noopener ugc nofollow" target="_blank">这里</a>。但是，我还是觉得有点暧昧。现在我看到了一些理由:这取决于你！编辑<code class="dv mb mc md ls b">parameters.json</code>文件让您决定行为。然而，这也没有记录在案。😔</p><p id="764f" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">基于这个快速的研究，我总结出了我<em class="kj">认为的规则。不过，我可能在某些方面弄错了；没有保证。假设您为经过身份验证的用户选择了guest访问和读写，那么这是默认行为，如果您愿意，可以更改该参数:</em></p><ul class=""><li id="19cf" class="ju jv hj iy b iz ja jd je jh jw jl jx jp jy jt jz ka kb kc bi translated">经过验证的用户可以上传到此。(<code class="dv mb mc md ls b">s3PermissionsAuthenticatedUploads</code> ) <br/>客人不得。(<code class="dv mb mc md ls b">s3PermissionsGuestUploads</code>)</li><li id="c475" class="ju jv hj iy b iz kd jd ke jh kf jl kg jp kh jt jz ka kb kc bi translated"><code class="dv mb mc md ls b">public/*<br/></code>认证用户可以读写。(<code class="dv mb mc md ls b">s3PermissionsAuthenticatedPublic</code> ) <br/>宾客可阅。(<code class="dv mb mc md ls b">s3PermissionsGuestPublic</code>)</li><li id="1a4e" class="ju jv hj iy b iz kd jd ke jh kf jl kg jp kh jt jz ka kb kc bi translated"><code class="dv mb mc md ls b">protected/<br/></code>任何人都可以阅读(不可配置)</li><li id="5e73" class="ju jv hj iy b iz kd jd ke jh kf jl kg jp kh jt jz ka kb kc bi translated"><code class="dv mb mc md ls b">protected/{user-id}/*<br/></code>任何人都可以读(不可配置)<br/>匹配的认证用户可以写(<code class="dv mb mc md ls b">s3PermissionsAuthenticatedProtected</code>)</li><li id="ab64" class="ju jv hj iy b iz kd jd ke jh kf jl kg jp kh jt jz ka kb kc bi translated"><code class="dv mb mc md ls b">protected/<br/></code>禁止进入</li><li id="27eb" class="ju jv hj iy b iz kd jd ke jh kf jl kg jp kh jt jz ka kb kc bi translated"><code class="dv mb mc md ls b">protected/{user-id}/*<br/></code>匹配的认证用户可以读写(<code class="dv mb mc md ls b">s3PermissionsAuthenticatedPrivate</code>)</li><li id="8875" class="ju jv hj iy b iz kd jd ke jh kf jl kg jp kh jt jz ka kb kc bi translated">认证用户可以列出他们可以阅读的任何前缀的内容(<code class="dv mb mc md ls b">AuthenticatedAllowList</code></li><li id="fe6d" class="ju jv hj iy b iz kd jd ke jh kf jl kg jp kh jt jz ka kb kc bi translated">客人可以列出他们可以阅读的任何前缀的内容(<code class="dv mb mc md ls b">GuestAllowList</code></li><li id="3cb7" class="ju jv hj iy b iz kd jd ke jh kf jl kg jp kh jt jz ka kb kc bi translated">如果在CLI中选择了无访客访问，则未经身份验证的用户没有访问权限。</li></ul><p id="afc0" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">这些属性的可能值是任何一个<code class="dv mb mc md ls b">s3:ListBucket</code>、<code class="dv mb mc md ls b">s3:GetObject</code>、<code class="dv mb mc md ls b">s3:PutObject</code>、<code class="dv mb mc md ls b">s3:DeleteObject</code>或简单的<code class="dv mb mc md ls b">DISALLOW</code>的逗号分隔列表。</p><p id="8614" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">参数文件还包括<code class="dv mb mc md ls b">selectedGuestPermissions</code>和<code class="dv mb mc md ls b">selectedAuthenticatedPermissions</code>，但是我没有在CloudFormation模板中看到它们。🤔🤦‍♂️</p><p id="84cd" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">对于SqAC，我修改了参数以完全禁用upload和public特性，同时保持protected和private的默认行为。</p><h1 id="7de3" class="kk kl hj bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">CORS？</h1><p id="0413" class="pw-post-body-paragraph iw ix hj iy b iz li jb jc jd lj jf jg jh lk jj jk jl ll jn jo jp lm jr js jt hc bi translated">作为使用亚马逊S3 文档进行放大的<em class="kj">存储</em> / <em class="kj">的一部分，<a class="ae iv" href="https://aws-amplify.github.io/docs/js/storage#amazon-s3-bucket-cors-policy-setup" rel="noopener ugc nofollow" target="_blank">这个位</a>告诉你在你的S3桶上手动配置CORS策略。😲这将打破基础设施代码(IaC)和多种环境的易用性！幸运的是，文档是一个转移注意力的话题——Amplify已经按照文档设置了存储桶策略。(我已经提交了一份<a class="ae iv" href="https://github.com/aws-amplify/docs/issues/918" rel="noopener ugc nofollow" target="_blank"> bug报告</a>来移除这个。)</em></p><h1 id="e371" class="kk kl hj bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">未完待续…</h1><p id="5450" class="pw-post-body-paragraph iw ix hj iy b iz li jb jc jd lj jf jg jh lk jj jk jl ll jn jo jp lm jr js jt hc bi translated">在<a class="ae iv" href="https://github.com/kernwig/sqac-amplify/pull/3" rel="noopener ugc nofollow" target="_blank">第4部分拉动请求</a>中找到所有这些。</p><p id="5d13" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">我本打算将更新客户端应用程序以使用存储作为这篇文章的一部分，但安全策略分析已经将这篇文章变成了一篇大文章，下一篇文章也将成为一篇好文章。</p><p id="2ac1" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">下次再来… <em class="kj">使用</em>放大存储！</p></div></div>    
</body>
</html>