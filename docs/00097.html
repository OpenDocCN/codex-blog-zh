<html>
<head>
<title>Migrating a Legacy App to Cloud Native â€” Part 4</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">å°†ä¼ ç»Ÿåº”ç”¨è¿ç§»åˆ°äº‘åŸç”Ÿç¯å¢ƒâ€”ç¬¬4éƒ¨åˆ†</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://medium.com/codex/migrating-a-legacy-app-to-cloud-native-part-4-2741585e4953?source=collection_archive---------0-----------------------#2020-08-09">https://medium.com/codex/migrating-a-legacy-app-to-cloud-native-part-4-2741585e4953?source=collection_archive---------0-----------------------#2020-08-09</a></blockquote><div><div class="dt gx gy gz ha hb"/><div class="hc hd he hf hg"><div class=""/><figure class="ew ey ih ii ij ik es et paragraph-image"><div role="button" tabindex="0" class="il im di in bf io"><div class="es et ig"><img src="../Images/a28fe7066c9be0af3f955771a19bb67b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*GGbTORDfQF7i8X66"/></div></div><figcaption class="ir is eu es et it iu bd b be z dy translated"><a class="ae iv" href="https://unsplash.com/@steve_j?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">æ–¯è’‚å¤«Â·çº¦ç¿°æ£®</a>åœ¨<a class="ae iv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>ä¸Šæ‹ç…§</figcaption></figure><p id="6186" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">åœ¨æœ¬ç³»åˆ—çš„ç¬¬4éƒ¨åˆ†ä¸­ï¼Œæˆ‘æ·»åŠ äº†Amplifyå­˜å‚¨ï¼Œå¹¶æ¢è®¨äº†å®ƒçš„å®‰å…¨æ¨¡å‹ä»¥åŠå¦‚ä½•å®šåˆ¶å®ƒâ€¦</p><ul class=""><li id="322e" class="ju jv hj iy b iz ja jd je jh jw jl jx jp jy jt jz ka kb kc bi translated">ç¬¬ä¸€éƒ¨åˆ†:èƒŒæ™¯</li><li id="4de5" class="ju jv hj iy b iz kd jd ke jh kf jl kg jp kh jt jz ka kb kc bi translated"><a class="ae iv" rel="noopener" href="/@kernwig/migrating-a-legacy-app-to-cloud-native-part-2-533dfebd38fb">ç¬¬äºŒéƒ¨åˆ†:éœ€æ±‚&amp;æ¶æ„</a></li><li id="880d" class="ju jv hj iy b iz kd jd ke jh kf jl kg jp kh jt jz ka kb kc bi translated"><a class="ae iv" rel="noopener" href="/@kernwig/migrating-a-legacy-app-to-cloud-native-part-3-4bb187fea485">ç¬¬3éƒ¨åˆ†:è®¤è¯</a></li></ul><p id="e293" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">Amplifyæœ‰ä¸€ä¸ªå­˜å‚¨æ¨¡å—ï¼Œå¯ä»¥ç”±S3æˆ–DynamoDBåœ¨AWSä¸­æ”¯æŒã€‚å›åˆ°ç¬¬2éƒ¨åˆ†ï¼Œåœ¨æ¢ç´¢åº”ç”¨ç¨‹åºéœ€æ±‚æ—¶ï¼Œæˆ‘æ³¨æ„åˆ°S3å°†ç”¨äºå­˜å‚¨ç”¨æˆ·è®¾ç½®å’Œæ•°æ®é›†åˆã€‚ç®€è€Œè¨€ä¹‹ï¼ŒDynamoDBä¸èƒ½ä½¿ç”¨ï¼Œå› ä¸º:</p><ol class=""><li id="f5a4" class="ju jv hj iy b iz ja jd je jh jw jl jx jp jy jt ki ka kb kc bi translated">è®°å½•è¢«é™åˆ¶åœ¨400 KBä»¥å†…ï¼Œæˆ‘ä¸æƒ³å°†ä¸€ä¸ªé›†åˆé™åˆ¶åœ¨è¿™ä¸ªå¤§å°ã€‚</li><li id="7318" class="ju jv hj iy b iz kd jd ke jh kf jl kg jp kh jt ki ka kb kc bi translated">Amplifyçš„å­˜å‚¨APIå¯èƒ½ä½¿ç”¨S3 <em class="kj">æˆ–</em>DynamoDBï¼›å¯¹äºä¸åŒçš„æ•°æ®ï¼Œæˆ‘ä»¬ä¸èƒ½ä¸¤è€…éƒ½ç”¨ã€‚å› æ­¤ï¼Œç”¨æˆ·è®¾ç½®ï¼Œè™½ç„¶å¾ˆå°ï¼Œä¹Ÿä¼šè¿›å…¥S3ã€‚</li></ol><p id="7fab" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated"><em class="kj">æ³¨æ„:æˆ‘åæ¥å‘ç°ï¼Œè™½ç„¶CLIæä¾›äº†DynamoDBå­˜å‚¨é€‰é¡¹ï¼Œä½†ä»»ä½•è¯­è¨€çš„Amplifyåº“éƒ½ä¸æ”¯æŒå®ƒã€‚</em></p><p id="0436" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">æˆ‘ä»¬å°†ä½¿ç”¨DynamoDBè¿›è¡Œæœç´¢(å‚è§éœ€æ±‚)ï¼Œä½†è¿™å°†æ˜¯ä»¥åçš„äº‹æƒ…ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬åªæƒ³ä¿å­˜å¹¶å›è¯»ç”¨æˆ·è®¾ç½®å’Œé›†åˆã€‚</p><p id="8348" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">å¦‚æœåœ¨è¿™ä¸ªç³»åˆ—ä¸­è¿˜ä¸æ¸…æ¥šï¼Œæˆ‘å†™è¿™ä¸ªæ˜¯å› ä¸ºæˆ‘è¯•å›¾ç”¨<em class="kj">æ”¾å¤§ã€‚è¿™æ˜¯ä¸€ä¸ªå…³äº<em class="kj">æ—…ç¨‹</em>çš„ç³»åˆ—ï¼Œè€Œä¸æ˜¯ç®€å•çš„æ“ä½œæŒ‡å—ã€‚</em></p><h1 id="98a3" class="kk kl hj bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">æ·»åŠ å­˜å‚¨</h1><p id="8284" class="pw-post-body-paragraph iw ix hj iy b iz li jb jc jd lj jf jg jh lk jj jk jl ll jn jo jp lm jr js jt hc bi translated">æˆ‘ä»¬åœ¨å“ªé‡Œåœä¸‹æ¥çš„ï¼Ÿ</p><pre class="ln lo lp lq fe lr ls lt lu aw lv bi"><span id="991e" class="lw kl hj ls b fj lx ly l lz ma">$ amplify status<br/><br/>Current Environment: dev<br/><br/>| Category | Resource name   | Operation | Provider plugin   |<br/>| -------- | --------------- | --------- | ----------------- |<br/>| Hosting  | S3AndCloudFront | No Change | awscloudformation |<br/>| Auth     | sqacauth        | No Change | awscloudformation |<br/><br/>Hosting endpoint: http://sqac-amplify-20190817123020-hostingbucket-dev.s3-website-us-west-2.amazonaws.com<br/>Hosted UI Endpoint: https://sqac-dev.auth.us-west-2.amazoncognito.com/</span></pre><p id="1e31" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">æˆ‘åªæœ‰æ‰˜ç®¡å’Œæˆæƒã€‚å› æ­¤ï¼Œè®©æˆ‘ä»¬æ·»åŠ å­˜å‚¨:</p><pre class="ln lo lp lq fe lr ls lt lu aw lv bi"><span id="0d36" class="lw kl hj ls b fj lx ly l lz ma">$ amplify add storage<br/>? Please select from one of the below mentioned services Content (Images, audio, video, etc.)<br/>? Please provide a friendly name for your resource that will be used to label this category in the project: storage<br/>? Please provide bucket name: sqac-amplify-user-data<br/>? Who should have access: Auth and guest users<br/>? What kind of access do you want for Authenticated users? create/update, read, delete<br/>? What kind of access do you want for Guest users? read<br/>? Do you want to add a Lambda Trigger for your S3 Bucket? No<br/>Successfully added resource storage locally<br/><br/>Some next steps:<br/>"amplify push" builds all of your local backend resources and provisions them in the cloud<br/>"amplify publish" builds all of your local backend and front-end resources (if you added hosting category) and provisions them in the cloud</span></pre><p id="60a2" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">æˆ‘é€‰æ‹©â€œå›¾åƒã€éŸ³é¢‘ã€è§†é¢‘ç­‰â€å†…å®¹ï¼Œè€Œä¸æ˜¯NoSQLé€‰é¡¹ã€‚è¿™å°±æ˜¯ä½ å¦‚ä½•å¾—åˆ°S3ï¼Œè€Œä¸æ˜¯DynamoDBã€‚ç„¶åæˆ‘ç»™è¿™äº›ä¸œè¥¿èµ·äº†å‹å¥½çš„åå­—ï¼Œè€Œä¸æ˜¯éšæœºç”Ÿæˆçš„é»˜è®¤å€¼ã€‚</p><p id="9d65" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">åœ¨æ¢ç´¢éœ€æ±‚æ—¶ï¼Œæˆ‘å£°æ˜æˆ‘å¸Œæœ›ç¬¬ä¸€æ¬¡è®¿é—®æˆ‘çš„åº”ç”¨ç¨‹åºçš„äººä¸éœ€è¦é¦–å…ˆåˆ›å»ºä¸€ä¸ªå¸æˆ·ï¼Œå› æ­¤æˆ‘é€‰æ‹©æä¾›æ¥å®¾åªè¯»è®¿é—®ã€‚ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·æ‹¥æœ‰å®Œå…¨è¯»å†™æƒé™ã€‚</p><p id="a80f" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">è™½ç„¶æˆ‘ä»¬æœ€ç»ˆä¼šåœ¨S3æ¡¶ä¸­æ·»åŠ ä¸€ä¸ªLambdaè§¦å‘å™¨ï¼Œä½†è¿™æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„ä»»åŠ¡ï¼Œæ‰€ä»¥æˆ‘ç°åœ¨å›ç­”ä¸ã€‚Amplifyå…è®¸æˆ‘ä»¬ç¨åä½¿ç”¨<code class="dv mb mc md ls b">amplify storage update</code>å‘½ä»¤æ¥æ”¹å˜äº‹æƒ…ã€‚</p><p id="fdd9" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬éƒ¨ç½²è¿™äº›å˜åŒ–â€¦</p><pre class="ln lo lp lq fe lr ls lt lu aw lv bi"><span id="896b" class="lw kl hj ls b fj lx ly l lz ma">$ amplify push<br/><br/>Current Environment: dev<br/><br/>| Category | Resource name   | Operation | Provider plugin   |<br/>| -------- | --------------- | --------- | ----------------- |<br/>| Storage  | storage         | Create    | awscloudformation |<br/>| Hosting  | S3AndCloudFront | No Change | awscloudformation |<br/>| Auth     | sqacauth        | No Change | awscloudformation |<br/>? Are you sure you want to continue? Yes<br/>â ´ Updating resources in the cloud. This may take a few minutes...<br/><br/>â€¦ A few dozen lines of CloudFormation output over a few minutes â€¦ <br/><br/>âœ” All resources are updated in the cloud</span></pre><p id="f336" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">æ²¡ä»€ä¹ˆã€‚åœ¨AWSæ§åˆ¶å°(ç½‘ç«™)ä¸­ï¼Œæˆ‘çœ‹åˆ°ä¸€ä¸ªæ–°çš„<code class="dv mb mc md ls b">sqac-amplify-user-data-dev</code>ç©ºæ¡¶ã€‚(<code class="dv mb mc md ls b">-dev</code>æ˜¯æˆ‘çš„ç¯å¢ƒåï¼›å®ƒè¢«é™„åŠ åˆ°ä»»ä½•ä¸œè¥¿ä¸Šä»¥æ”¯æŒå¤šç§ç¯å¢ƒã€‚ğŸ¥³)</p><p id="9c3b" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">æ‰€ä»¥æˆ‘ä»¬ç»“æŸäº†ï¼Œå¯¹å—ï¼Ÿå—¯â€¦â€¦é‚£è¦çœ‹æƒ…å†µã€‚</p><h1 id="fbb5" class="kk kl hj bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">å®‰å…¨ç­–ç•¥å’Œå‚æ•°</h1><p id="39d9" class="pw-post-body-paragraph iw ix hj iy b iz li jb jc jd lj jf jg jh lk jj jk jl ll jn jo jp lm jr js jt hc bi translated"><em class="kj">è­¦å‘Š:æˆ‘å°†åœ¨è¿™é‡Œæ·±å…¥æ¢è®¨AWSæ”¿ç­–å’Œäº‘å½¢æˆã€‚ä½ å¯ä»¥è·Ÿç€</em> <a class="ae iv" href="https://github.com/kernwig/sqac-amplify/pull/3" rel="noopener ugc nofollow" target="_blank"> <em class="kj">ä¸­çš„æ–‡ä»¶ç¬¬å››éƒ¨åˆ†æ‹‰è¯·æ±‚</em> </a> <em class="kj">ï¼Œæˆ–è€…åªæ˜¯è®©ä½ çš„ç›®å…‰å‘†æ»ã€‚</em>ğŸ˜³</p><p id="5faf" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">æˆ‘ä»”ç»†ç ”ç©¶äº†å®šä¹‰å­˜å‚¨(åŒ…æ‹¬ç­–ç•¥)çš„æ–°CloudFormationå †æ ˆï¼Œå‘ç°è¿™å¹¶ä¸æ˜¯æˆ‘æƒ³è¦çš„ã€‚æˆ‘å¸Œæœ›ç”¨æˆ·å°†ä»–ä»¬çš„ç§æœ‰æ•°æ®ä¿æŒåœ¨ç§æœ‰è®¿é—®çº§åˆ«ï¼Œå°†å…±äº«æ•°æ®ä¿æŒåœ¨å—ä¿æŠ¤çš„è®¿é—®çº§åˆ«ï¼Œé™¤æ­¤ä¹‹å¤–åˆ«æ— å…¶ä»–ã€‚è™½ç„¶æ”¿ç­–ä¹Ÿå…è®¸ç”¨æˆ·åœ¨å…¬å…±åŒºåŸŸå†™è®¿é—®ï¼Œä½†è¿™ä¸æ˜¯å¾ˆæœ‰ç”¨ï¼Œå› ä¸ºä»»ä½•äººéƒ½å¯ä»¥åœ¨è¿™é‡Œå†™ä»»ä½•ä¸œè¥¿ï¼Œä»»ä½•äººéƒ½å¯ä»¥ä¿®æ”¹æˆ–åˆ é™¤å®ƒã€‚æˆ‘çœŸçš„ä¸æƒ³é‚£æ ·ã€‚å•Šå“¦ï¼Ÿä½†åæ¥æˆ‘æ„è¯†åˆ°æˆ‘æ­£åœ¨æŸ¥çœ‹å †æ ˆçš„â€œå‚æ•°â€éƒ¨åˆ†ï¼Œåœ¨amplifyæ–‡ä»¶å¤¹ä¸­æœ‰ä¸€ä¸ª<code class="dv mb mc md ls b">parameters.json</code>æ–‡ä»¶ã€‚ğŸ’¡è¿™é‡Œæ˜¯<code class="dv mb mc md ls b">parameters.json</code>:</p><pre class="ln lo lp lq fe lr ls lt lu aw lv bi"><span id="97c5" class="lw kl hj ls b fj lx ly l lz ma">{<br/>   "bucketName": "sqac-amplify-user-data",<br/>   "authPolicyName": "s3_amplify_7405df3b",<br/>   "unauthPolicyName": "s3_amplify_7405df3b",<br/>   "authRoleName": {<br/>       "Ref": "AuthRoleName"<br/>   },<br/>   "unauthRoleName": {<br/>       "Ref": "UnauthRoleName"<br/>   },<br/>   "selectedGuestPermissions": [<br/>       "s3:GetObject",<br/>       "s3:ListBucket"<br/>   ],<br/>   "selectedAuthenticatedPermissions": [<br/>       "s3:PutObject",<br/>       "s3:GetObject",<br/>       "s3:ListBucket",<br/>       "s3:DeleteObject"<br/>   ],<br/>   "s3PermissionsAuthenticatedPublic": "s3:PutObject,s3:GetObject,s3:DeleteObject",<br/>   "s3PublicPolicy": "Public_policy_9efc80af",<br/>   "s3PermissionsAuthenticatedUploads": "s3:PutObject",<br/>   "s3UploadsPolicy": "Uploads_policy_9efc80af",<br/>   "s3PermissionsAuthenticatedProtected": "s3:PutObject,s3:GetObject,s3:DeleteObject",<br/>   "s3ProtectedPolicy": "Protected_policy_7b753c06",<br/>   "s3PermissionsAuthenticatedPrivate": "s3:PutObject,s3:GetObject,s3:DeleteObject",<br/>   "s3PrivatePolicy": "Private_policy_7b753c06",<br/>   "AuthenticatedAllowList": "ALLOW",<br/>   "s3ReadPolicy": "read_policy_9efc80af",<br/>   "s3PermissionsGuestPublic": "s3:GetObject",<br/>   "s3PermissionsGuestUploads": "DISALLOW",<br/>   "GuestAllowList": "ALLOW",<br/>   "triggerFunction": "NONE"<br/>}</span></pre><p id="1cb1" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">é…·æ¯™äº†ã€‚è®©æˆ‘ä»¬çœ‹çœ‹æˆ‘åœ¨è¿™é‡Œæƒ³è¦ä»€ä¹ˆâ€¦</p><pre class="ln lo lp lq fe lr ls lt lu aw lv bi"><span id="e696" class="lw kl hj ls b fj lx ly l lz ma">"s3PermissionsAuthenticatedPublic": "s3:GetObject",</span></pre><p id="2338" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">æˆ‘æƒ³é‚£å°±è¡Œäº†ã€‚æˆ‘åªæ˜¯å–æ¶ˆäº†åœ¨å…¬å…±åŒºåŸŸå†™ä¸œè¥¿çš„è®¸å¯ã€‚ä»»ä½•äººï¼ŒåŒ…æ‹¬å®¢äººï¼Œä»ç„¶å¯ä»¥ä»ä¸­é˜…è¯»ã€‚åªæœ‰æˆ‘æ‰‹åŠ¨æ”¾å…¥çš„æ•°æ®æ‰èƒ½å­˜åœ¨ï¼Œå› æ­¤æˆ‘å¯ä»¥å°†å®ƒç”¨äºæ¥å®¾â€œæ¼”ç¤ºæ¨¡å¼â€å†…å®¹ã€‚(æˆ‘ä¸ä¼šçš„ï¼Œç»§ç»­è¯»ä¸‹å»ã€‚)è¿™é‡Œæ²¡æœ‰ä»€ä¹ˆèƒ½å®Œå…¨æ¸…æ¥šåœ°è¯´æ˜<em class="kj">å—ä¿æŠ¤çš„</em>åŠŸèƒ½æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œä½†è¿™äº›åªæ˜¯é…ç½®é€‰é¡¹ï¼Œè€Œä¸æ˜¯å®é™…çš„ç­–ç•¥ã€‚ä¸ºæ­¤ï¼Œæˆ‘ç¿»éäº†Amplifyåˆ›å»ºçš„<code class="dv mb mc md ls b">s3-cloudformation-template.json</code>æ–‡ä»¶ã€‚JSONæ ¼å¼æœ‰ç‚¹å†—é•¿ï¼Œæ‰€ä»¥æˆ‘åœ¨AWSæ§åˆ¶å°ä¸­å¼¹å‡ºCloudFormation Designer (GUI)å·¥å…·ï¼Œå¹¶ä½¿ç”¨å®ƒæ¥é€‰æ‹©ç­–ç•¥ï¼Œä»¥ä¾¿åœ¨æ›´ç®€æ´çš„ç»“æœYAMLä¸­æŸ¥çœ‹ã€‚</p><p id="c336" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">æˆ‘å‘ç°çš„ç¬¬ä¸€ä¸ªæœ‰è¶£çš„åœ°æ–¹æ˜¯:</p><pre class="ln lo lp lq fe lr ls lt lu aw lv bi"><span id="0b10" class="lw kl hj ls b fj lx ly l lz ma">S3GuestReadPolicy:<br/>    DependsOn:<br/>      - S3Bucket<br/>    Condition: GuestReadAndList<br/>    Type: 'AWS::IAM::Policy'<br/>    Properties:<br/>      PolicyName: !Ref s3ReadPolicy<br/>      Roles:<br/>        - !Ref unauthRoleName<br/>      PolicyDocument:<br/>        Version: 2012-10-17<br/>        Statement:<br/>          - Effect: Allow<br/>            Action:<br/>              - 's3:GetObject'<br/>            Resource:<br/>              - !Join <br/>                - ''<br/>                - - 'arn:aws:s3:::'<br/>                  - !Ref S3Bucket<br/>                  - /protected/*<br/>          - Effect: Allow<br/>            Action:<br/>              - 's3:ListBucket'<br/>            Resource:<br/>              - !Join <br/>                - ''<br/>                - - 'arn:aws:s3:::'<br/>                  - !Ref S3Bucket<br/>            Condition:<br/>              StringLike:<br/>                's3:prefix':<br/>                  - public/<br/>                  - public/*<br/>                  - protected/<br/>                  - protected/*</span></pre><p id="e3b1" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">å¦‚æœæ‚¨è¿˜æ²¡æœ‰æ³¨æ„åˆ°ï¼ŒAmplifyé€šè¿‡åœ¨S3å¯†åŒ™å‰é¢åŠ ä¸Š<code class="dv mb mc md ls b">public</code>ã€<code class="dv mb mc md ls b">protected</code>æˆ–<code class="dv mb mc md ls b">private</code>æ¥ç®¡ç†è®¿é—®çº§åˆ«ï¼Œåé¢æ˜¯è®¤è¯ç”¨æˆ·çš„IDã€‚(æ‚¨å¯ä»¥å°†å®ƒä»¬è§†ä¸ºæ–‡ä»¶ç³»ç»Ÿæ–‡ä»¶å¤¹ï¼Œå°½ç®¡ä»æŠ€æœ¯ä¸Šè®²å®ƒä»¬å¹¶ä¸æ˜¯ã€‚)å› æ­¤ï¼Œå‡è®¾ä¸€ä¸ªCognito IDä¸º123çš„ç”¨æˆ·å°†åœ¨<code class="dv mb mc md ls b">private/123/</code>ä¸­å­˜å‚¨ç§æœ‰æ•°æ®ï¼Œåœ¨<code class="dv mb mc md ls b">protected/123/</code>ä¸­å­˜å‚¨å—ä¿æŠ¤çš„æ•°æ®ã€‚æ³¨æ„è¿™é‡Œæœ‰ä¸€ä¸ª<code class="dv mb mc md ls b">public/*</code>å‰ç¼€åŒ¹é…æ¡ä»¶ã€‚è¿™æ˜¯ä¸æ˜¯æ„å‘³ç€ç”¨æˆ·åªèƒ½åœ¨è‡ªå·±çš„å…¬å…±åŒºåŸŸå†™ï¼Ÿå¦‚æœæ˜¯ï¼Œå…¬å¼€å’Œå—ä¿æŠ¤çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿæˆ‘å¿…é¡»å†æŒ–ä¸€äº›ï¼</p><p id="106f" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">è¿™ä¸ªæ”¿ç­–ç¡®å®å›ç­”äº†æˆ‘çš„ä¸€ä¸ªé—®é¢˜:ä¸€ä¸ªè®¿å®¢ç”¨æˆ·<em class="kj">å¯ä»¥é˜…è¯»å—ä¿æŠ¤çš„å†…å®¹ï¼Œè€Œä¸ä»…ä»…æ˜¯å…¬å¼€çš„ã€‚æˆ‘å¯èƒ½æ ¹æœ¬ä¸éœ€è¦å…¬å¼€ã€‚</em></p><p id="364f" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated"><code class="dv mb mc md ls b">S3AuthReadPolicy</code>(é’ˆå¯¹ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·ï¼Œè€Œä¸æ˜¯æ¥å®¾)ä¸æ­¤ç±»ä¼¼ï¼Œä½†æ˜¯å¤šäº†ä¸¤ä¸ªå‰ç¼€ï¼Œå…è®¸è¯»å–ç”¨æˆ·çš„ç§æœ‰æ•°æ®ã€‚å› æ­¤ï¼Œç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·å¯ä»¥é˜…è¯»é™¤å…¶ä»–ç”¨æˆ·çš„ç§äººéƒ¨åˆ†ä¹‹å¤–çš„ä»»ä½•å†…å®¹:</p><pre class="ln lo lp lq fe lr ls lt lu aw lv bi"><span id="f1d4" class="lw kl hj ls b fj lx ly l lz ma">Condition:<br/>      StringLike:<br/>        's3:prefix':<br/>          - public/<br/>          - public/*<br/>          - protected/<br/>          - protected/*<br/>          - 'private/${cognito-identity.amazonaws.com:sub}/'<br/>          - 'private/${cognito-identity.amazonaws.com:sub}/*'</span></pre><p id="2666" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">æœ‰ä¸€ä¸ª<code class="dv mb mc md ls b">S3GuestUploadPolicy</code>å…è®¸å®¢äººä¸Šä¼ åˆ°ä¸€ä¸ª<code class="dv mb mc md ls b">uploads/</code>å‰ç¼€ï¼Œä½†æ˜¯å®ƒè¢«é»˜è®¤å‚æ•°<code class="dv mb mc md ls b">s3PermissionsGuestUploads</code>è®¾ç½®ä¸º<code class="dv mb mc md ls b">DISALLOW</code>è€Œæ— æ•ˆã€‚ğŸ‘è¿™å¯¼è‡´äº†é’ˆå¯¹è®¤è¯ç”¨æˆ·çš„<code class="dv mb mc md ls b">S3AuthUploadPolicy</code>ï¼Œè¿™å…è®¸ç”¨æˆ·å°†æ–‡ä»¶è½¬å‚¨åˆ°<code class="dv mb mc md ls b">uploads/</code>å‰ç¼€ä¸­ï¼Œè€Œæ²¡æœ‰åŠæ³•è¯»å›å®ƒã€‚æˆ‘æƒ³è¿™ä¸€å®šæ˜¯ä¸€ä¸ªå…è®¸ä¸Šä¼ çš„ç‰¹æ€§ï¼Œç„¶åç”±è§¦å‘çš„Lambdaå¤„ç†ã€‚æˆ‘ä¸éœ€è¦è¿™æ ·çš„ä¸Šä¼ ï¼Œæ‰€ä»¥åœ¨<code class="dv mb mc md ls b">parameters.json</code>ä¸­ï¼Œæˆ‘å°†<code class="dv mb mc md ls b">s3PermissionsAuthenticatedUploads</code>è®¾ç½®ä¸º<code class="dv mb mc md ls b">DISALLOW</code>ï¼Œå°±åƒä¸ºå®¢äººè®¾ç½®çš„å‚æ•°ä¸€æ ·ã€‚</p><p id="2d20" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">ç»§ç»­ï¼Œæˆ‘çœ‹åˆ°ä¸€ä¸ª<code class="dv mb mc md ls b">S3AuthPublicPolicy</code>ï¼Œå®ƒä¸æˆ‘å·²ç»æ›´æ”¹ä¸º<code class="dv mb mc md ls b">S3:GetObject</code>çš„<code class="dv mb mc md ls b">s3PermissionsAuthenticatedPublic</code>å‚æ•°ç›¸å…³è”ï¼›å› æ­¤ï¼Œç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·åªèƒ½è¯»å–ï¼Œä¸èƒ½å†™å…¥å…¬å…±åŒºåŸŸã€‚æˆ‘å‘ç°è¿™é€‚ç”¨äºpublicå‰ç¼€ä¸­çš„ä»»ä½•åœ°æ–¹ï¼Œå¯¹ç”¨æˆ·IDæ²¡æœ‰ä»»ä½•é™åˆ¶:</p><pre class="ln lo lp lq fe lr ls lt lu aw lv bi"><span id="cea1" class="lw kl hj ls b fj lx ly l lz ma">Resource:<br/>      - !Join <br/>        - ''<br/>        - - 'arn:aws:s3:::'<br/>          - !Ref S3Bucket<br/>          - /public/*</span></pre><p id="2130" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">ä¸<code class="dv mb mc md ls b">S3AuthProtectedPolicy</code>ç›¸æ¯”ï¼Œå“ªä¸ª<em class="kj"/>é™åˆ¶å¯¹ç”¨æˆ·IDçš„å†™æ´»åŠ¨:</p><pre class="ln lo lp lq fe lr ls lt lu aw lv bi"><span id="b8f8" class="lw kl hj ls b fj lx ly l lz ma">Resource:<br/>       - !Join <br/>          - ''<br/>          - - 'arn:aws:s3:::'<br/>            - !Ref S3Bucket<br/>            - '/protected/${cognito-identity.amazonaws.com:sub}/*'</span></pre><p id="92c1" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated"><code class="dv mb mc md ls b">S3AuthPrivatePolicy</code>çœ‹èµ·æ¥å‡ ä¹ä¸€æ ·ï¼Œä¿æŠ¤ç§æœ‰æ–‡ä»¶å¤¹:</p><pre class="ln lo lp lq fe lr ls lt lu aw lv bi"><span id="a238" class="lw kl hj ls b fj lx ly l lz ma">Resource:<br/>       - !Join <br/>          - ''<br/>          - - 'arn:aws:s3:::'<br/>            - !Ref S3Bucket<br/>            - '/private/${cognito-identity.amazonaws.com:sub}/*'</span></pre><p id="a5c0" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">é‚£ä¹ˆæœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿå‘ä¸Šæ»šåŠ¨å›åˆ°<code class="dv mb mc md ls b">S3GuestReadPolicy</code>å’Œ<code class="dv mb mc md ls b">S3AuthReadPolicy</code>ã€‚è™½ç„¶<code class="dv mb mc md ls b">S3AuthProtectedPolicy</code>å’Œ<code class="dv mb mc md ls b">S3AuthPrivatePolicy</code>æ¶µç›–äº†ç”¨æˆ·å¯ä»¥<em class="kj">å†™å…¥</em>çš„å†…å®¹ï¼Œä½†æ˜¯æ—©æœŸçš„ç­–ç•¥å…è®¸ä»»ä½•äºº<em class="kj">è¯»å–</em>å‰ç¼€ã€‚</p><p id="a2f1" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">æˆ‘ä¸€ç›´å¾ˆå›°æƒ‘ä¸ºä»€ä¹ˆAmplifyçš„æ–‡æ¡£æ²¡æœ‰æ˜ç¡®å®šä¹‰è®¿é—®è§’è‰²:å…¬å…±ã€å—ä¿æŠ¤å’Œç§æœ‰ã€‚ä»¥å‰æ‰¾ä¸åˆ°ä»»ä½•è§£é‡Šï¼Œä½†æ˜¯çœ‹åˆ°ç°åœ¨æœ‰ä¸€äº›ç»†èŠ‚<a class="ae iv" href="https://aws-amplify.github.io/docs/js/storage#using-amazon-s3" rel="noopener ugc nofollow" target="_blank">è¿™é‡Œ</a>ã€‚ä½†æ˜¯ï¼Œæˆ‘è¿˜æ˜¯è§‰å¾—æœ‰ç‚¹æš§æ˜§ã€‚ç°åœ¨æˆ‘çœ‹åˆ°äº†ä¸€äº›ç†ç”±:è¿™å–å†³äºä½ ï¼ç¼–è¾‘<code class="dv mb mc md ls b">parameters.json</code>æ–‡ä»¶è®©æ‚¨å†³å®šè¡Œä¸ºã€‚ç„¶è€Œï¼Œè¿™ä¹Ÿæ²¡æœ‰è®°å½•åœ¨æ¡ˆã€‚ğŸ˜”</p><p id="764f" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">åŸºäºè¿™ä¸ªå¿«é€Ÿçš„ç ”ç©¶ï¼Œæˆ‘æ€»ç»“å‡ºäº†æˆ‘<em class="kj">è®¤ä¸ºçš„è§„åˆ™ã€‚ä¸è¿‡ï¼Œæˆ‘å¯èƒ½åœ¨æŸäº›æ–¹é¢å¼„é”™äº†ï¼›æ²¡æœ‰ä¿è¯ã€‚å‡è®¾æ‚¨ä¸ºç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·é€‰æ‹©äº†guestè®¿é—®å’Œè¯»å†™ï¼Œé‚£ä¹ˆè¿™æ˜¯é»˜è®¤è¡Œä¸ºï¼Œå¦‚æœæ‚¨æ„¿æ„ï¼Œå¯ä»¥æ›´æ”¹è¯¥å‚æ•°:</em></p><ul class=""><li id="19cf" class="ju jv hj iy b iz ja jd je jh jw jl jx jp jy jt jz ka kb kc bi translated">ç»è¿‡éªŒè¯çš„ç”¨æˆ·å¯ä»¥ä¸Šä¼ åˆ°æ­¤ã€‚(<code class="dv mb mc md ls b">s3PermissionsAuthenticatedUploads</code> ) <br/>å®¢äººä¸å¾—ã€‚(<code class="dv mb mc md ls b">s3PermissionsGuestUploads</code>)</li><li id="c475" class="ju jv hj iy b iz kd jd ke jh kf jl kg jp kh jt jz ka kb kc bi translated"><code class="dv mb mc md ls b">public/*<br/></code>è®¤è¯ç”¨æˆ·å¯ä»¥è¯»å†™ã€‚(<code class="dv mb mc md ls b">s3PermissionsAuthenticatedPublic</code> ) <br/>å®¾å®¢å¯é˜…ã€‚(<code class="dv mb mc md ls b">s3PermissionsGuestPublic</code>)</li><li id="1a4e" class="ju jv hj iy b iz kd jd ke jh kf jl kg jp kh jt jz ka kb kc bi translated"><code class="dv mb mc md ls b">protected/<br/></code>ä»»ä½•äººéƒ½å¯ä»¥é˜…è¯»(ä¸å¯é…ç½®)</li><li id="5e73" class="ju jv hj iy b iz kd jd ke jh kf jl kg jp kh jt jz ka kb kc bi translated"><code class="dv mb mc md ls b">protected/{user-id}/*<br/></code>ä»»ä½•äººéƒ½å¯ä»¥è¯»(ä¸å¯é…ç½®)<br/>åŒ¹é…çš„è®¤è¯ç”¨æˆ·å¯ä»¥å†™(<code class="dv mb mc md ls b">s3PermissionsAuthenticatedProtected</code>)</li><li id="ab64" class="ju jv hj iy b iz kd jd ke jh kf jl kg jp kh jt jz ka kb kc bi translated"><code class="dv mb mc md ls b">protected/<br/></code>ç¦æ­¢è¿›å…¥</li><li id="27eb" class="ju jv hj iy b iz kd jd ke jh kf jl kg jp kh jt jz ka kb kc bi translated"><code class="dv mb mc md ls b">protected/{user-id}/*<br/></code>åŒ¹é…çš„è®¤è¯ç”¨æˆ·å¯ä»¥è¯»å†™(<code class="dv mb mc md ls b">s3PermissionsAuthenticatedPrivate</code>)</li><li id="8875" class="ju jv hj iy b iz kd jd ke jh kf jl kg jp kh jt jz ka kb kc bi translated">è®¤è¯ç”¨æˆ·å¯ä»¥åˆ—å‡ºä»–ä»¬å¯ä»¥é˜…è¯»çš„ä»»ä½•å‰ç¼€çš„å†…å®¹(<code class="dv mb mc md ls b">AuthenticatedAllowList</code></li><li id="fe6d" class="ju jv hj iy b iz kd jd ke jh kf jl kg jp kh jt jz ka kb kc bi translated">å®¢äººå¯ä»¥åˆ—å‡ºä»–ä»¬å¯ä»¥é˜…è¯»çš„ä»»ä½•å‰ç¼€çš„å†…å®¹(<code class="dv mb mc md ls b">GuestAllowList</code></li><li id="3cb7" class="ju jv hj iy b iz kd jd ke jh kf jl kg jp kh jt jz ka kb kc bi translated">å¦‚æœåœ¨CLIä¸­é€‰æ‹©äº†æ— è®¿å®¢è®¿é—®ï¼Œåˆ™æœªç»èº«ä»½éªŒè¯çš„ç”¨æˆ·æ²¡æœ‰è®¿é—®æƒé™ã€‚</li></ul><p id="afc0" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">è¿™äº›å±æ€§çš„å¯èƒ½å€¼æ˜¯ä»»ä½•ä¸€ä¸ª<code class="dv mb mc md ls b">s3:ListBucket</code>ã€<code class="dv mb mc md ls b">s3:GetObject</code>ã€<code class="dv mb mc md ls b">s3:PutObject</code>ã€<code class="dv mb mc md ls b">s3:DeleteObject</code>æˆ–ç®€å•çš„<code class="dv mb mc md ls b">DISALLOW</code>çš„é€—å·åˆ†éš”åˆ—è¡¨ã€‚</p><p id="8614" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">å‚æ•°æ–‡ä»¶è¿˜åŒ…æ‹¬<code class="dv mb mc md ls b">selectedGuestPermissions</code>å’Œ<code class="dv mb mc md ls b">selectedAuthenticatedPermissions</code>ï¼Œä½†æ˜¯æˆ‘æ²¡æœ‰åœ¨CloudFormationæ¨¡æ¿ä¸­çœ‹åˆ°å®ƒä»¬ã€‚ğŸ¤”ğŸ¤¦â€â™‚ï¸</p><p id="84cd" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">å¯¹äºSqACï¼Œæˆ‘ä¿®æ”¹äº†å‚æ•°ä»¥å®Œå…¨ç¦ç”¨uploadå’Œpublicç‰¹æ€§ï¼ŒåŒæ—¶ä¿æŒprotectedå’Œprivateçš„é»˜è®¤è¡Œä¸ºã€‚</p><h1 id="7de3" class="kk kl hj bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">CORSï¼Ÿ</h1><p id="0413" class="pw-post-body-paragraph iw ix hj iy b iz li jb jc jd lj jf jg jh lk jj jk jl ll jn jo jp lm jr js jt hc bi translated">ä½œä¸ºä½¿ç”¨äºšé©¬é€ŠS3 æ–‡æ¡£è¿›è¡Œæ”¾å¤§çš„<em class="kj">å­˜å‚¨</em> / <em class="kj">çš„ä¸€éƒ¨åˆ†ï¼Œ<a class="ae iv" href="https://aws-amplify.github.io/docs/js/storage#amazon-s3-bucket-cors-policy-setup" rel="noopener ugc nofollow" target="_blank">è¿™ä¸ªä½</a>å‘Šè¯‰ä½ åœ¨ä½ çš„S3æ¡¶ä¸Šæ‰‹åŠ¨é…ç½®CORSç­–ç•¥ã€‚ğŸ˜²è¿™å°†æ‰“ç ´åŸºç¡€è®¾æ–½ä»£ç (IaC)å’Œå¤šç§ç¯å¢ƒçš„æ˜“ç”¨æ€§ï¼å¹¸è¿çš„æ˜¯ï¼Œæ–‡æ¡£æ˜¯ä¸€ä¸ªè½¬ç§»æ³¨æ„åŠ›çš„è¯é¢˜â€”â€”Amplifyå·²ç»æŒ‰ç…§æ–‡æ¡£è®¾ç½®äº†å­˜å‚¨æ¡¶ç­–ç•¥ã€‚(æˆ‘å·²ç»æäº¤äº†ä¸€ä»½<a class="ae iv" href="https://github.com/aws-amplify/docs/issues/918" rel="noopener ugc nofollow" target="_blank"> bugæŠ¥å‘Š</a>æ¥ç§»é™¤è¿™ä¸ªã€‚)</em></p><h1 id="e371" class="kk kl hj bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">æœªå®Œå¾…ç»­â€¦</h1><p id="5450" class="pw-post-body-paragraph iw ix hj iy b iz li jb jc jd lj jf jg jh lk jj jk jl ll jn jo jp lm jr js jt hc bi translated">åœ¨<a class="ae iv" href="https://github.com/kernwig/sqac-amplify/pull/3" rel="noopener ugc nofollow" target="_blank">ç¬¬4éƒ¨åˆ†æ‹‰åŠ¨è¯·æ±‚</a>ä¸­æ‰¾åˆ°æ‰€æœ‰è¿™äº›ã€‚</p><p id="5d13" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">æˆ‘æœ¬æ‰“ç®—å°†æ›´æ–°å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºä»¥ä½¿ç”¨å­˜å‚¨ä½œä¸ºè¿™ç¯‡æ–‡ç« çš„ä¸€éƒ¨åˆ†ï¼Œä½†å®‰å…¨ç­–ç•¥åˆ†æå·²ç»å°†è¿™ç¯‡æ–‡ç« å˜æˆäº†ä¸€ç¯‡å¤§æ–‡ç« ï¼Œä¸‹ä¸€ç¯‡æ–‡ç« ä¹Ÿå°†æˆä¸ºä¸€ç¯‡å¥½æ–‡ç« ã€‚</p><p id="2ac1" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">ä¸‹æ¬¡å†æ¥â€¦ <em class="kj">ä½¿ç”¨</em>æ”¾å¤§å­˜å‚¨ï¼</p></div></div>    
</body>
</html>