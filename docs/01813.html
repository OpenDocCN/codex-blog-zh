<html>
<head>
<title>Color Detection of PCR Plate using Python and OpenCV</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python和OpenCV实现PCR板的颜色检测</h1>
<blockquote>原文：<a href="https://medium.com/codex/well-and-color-detection-of-pcr-plate-using-python-and-opencv-edb0aaa0ef9d?source=collection_archive---------4-----------------------#2021-06-03">https://medium.com/codex/well-and-color-detection-of-pcr-plate-using-python-and-opencv-edb0aaa0ef9d?source=collection_archive---------4-----------------------#2021-06-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="9866" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">以下是如何在PCR 96孔板中检测每个孔及其颜色</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/feebf09380700188fa167bdfdd87f9b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XO919YVgQ2UmquivvgCpjA.jpeg"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">在<a class="ae jn" href="https://unsplash.com/s/photos/covid-test?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae jn" href="https://unsplash.com/@_louisreed?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">路易斯·里德</a>拍摄的照片</figcaption></figure><p id="64cb" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><a class="ae jn" href="https://opencv.org/" rel="noopener ugc nofollow" target="_blank"> OpenCV </a>是一个针对计算机视觉的开源库。它具有强大的功能，使诸如对象和颜色检测等任务变得简单而直观。</p><p id="555b" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">为了检测每个孔的颜色，我们需要首先获得每个孔在图片中的位置。因此，我们的第一个目标是检测PCR板中的每个孔。一旦我们做到了这一点，我们就可以很容易地得到这些孔中的像素颜色。</p><h2 id="8b4c" class="kk kl hi bd km kn ko kp kq kr ks kt ku jx kv kw kx kb ky kz la kf lb lc ld le bi translated">我们将使用这些库:</h2><ul class=""><li id="0539" class="lf lg hi jq b jr lh ju li jx lj kb lk kf ll kj lm ln lo lp bi translated">numpy</li><li id="2d5e" class="lf lg hi jq b jr lq ju lr jx ls kb lt kf lu kj lm ln lo lp bi translated">KDTree</li><li id="01c5" class="lf lg hi jq b jr lq ju lr jx ls kb lt kf lu kj lm ln lo lp bi translated">网页颜色</li><li id="043c" class="lf lg hi jq b jr lq ju lr jx ls kb lt kf lu kj lm ln lo lp bi translated">cv2</li></ul><pre class="iy iz ja jb fd lv lw lx ly aw lz bi"><span id="e48e" class="kk kl hi lw b fi ma mb l mc md">import cv2<br/>import numpy as np<br/>import webcolors<br/>from scipy.spatial import KDTree</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es me"><img src="../Images/9a03c1f96b93ce2d7b42661e9d7fc04d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1292/format:webp/1*-62Mya0Htb6PZbdBAsO66g.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">PCR 96孔板</figcaption></figure><p id="60c4" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">OpenCV让我们在内置函数的帮助下轻松检测物体和形状。其中一个这样的函数叫做<a class="ae jn" href="https://docs.opencv.org/master/da/d53/tutorial_py_houghcircles.html" rel="noopener ugc nofollow" target="_blank"><em class="mf"/></a><em class="mf">。</em>让我们看看它的实际效果。</p><pre class="iy iz ja jb fd lv lw lx ly aw lz bi"><span id="369b" class="kk kl hi lw b fi ma mb l mc md"># Convert to gray-scale and reduce noise<br/>gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)<br/>img_blur = cv2.medianBlur(gray, 5)</span><span id="b57a" class="kk kl hi lw b fi mg mb l mc md">circles = cv2.HoughCircles(img_blur,<br/>                           cv2.HOUGH_GRADIENT,<br/>                           1,<br/>                           img.shape[0]/64,<br/>                           param1=200,<br/>                           param2=10,<br/>                           minRadius=14,<br/>                           maxRadius=15<br/>                          )<br/># Draw detected circles<br/>if circles is not None:<br/>    circles = np.uint16(np.around(circles))<br/>    for i in circles[0, :96]:<br/>        <br/>        # outer circle<br/>        ## cv2.circle(image, center_coordinates, radius, color, thickness)<br/>        cv2.circle(img, (i[0], i[1]), i[2], (0, 0, 0), 2)<br/>        <br/>        # rgb values<br/>        b = img[i[1], i[0], 0]<br/>        g = img[i[1], i[0], 1]<br/>        r = img[i[1], i[0], 2]<br/>        <br/>        color_name = convert_rgb_to_color_name((r, g, b))<br/>        <br/>        mapped_cell = {<br/>            "well_coordinates": (i[0], i[1]),<br/>            "well_color": color_name<br/>        }<br/>        mapped_cells_list.append(mapped_cell)<br/>        <br/>        # inner circle<br/>        cv2.circle(img, (i[0], i[1]), 1, (0, 0, 255), 2)</span></pre><p id="df35" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">cv2。HoughCircles()根据我们提供的参数返回圆的坐标。例如，最小半径和最大半径提供了我们的圆应该位于的范围。范围越小，结果越精确。</p><p id="8f0d" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">一旦我们获得了圆的坐标，我们就可以使用cv2.circle()函数重新创建圆。我们将在原始图像上绘制这些圆圈</p><pre class="iy iz ja jb fd lv lw lx ly aw lz bi"><span id="8421" class="kk kl hi lw b fi ma mb l mc md"><em class="mf"># cv2.circle(image, center_coordinates, radius, color, thickness)</em></span></pre><p id="c985" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">圆圈后的图像:</strong></p><pre class="iy iz ja jb fd lv lw lx ly aw lz bi"><span id="8deb" class="kk kl hi lw b fi ma mb l mc md"># View image in a window<br/>cv2.imshow('Image',img)<br/>cv2.waitKey(0)<br/>cv2.destroyAllWindows()</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mh"><img src="../Images/087f1be5af99d05e652b2060e7032639.png" data-original-src="https://miro.medium.com/v2/resize:fit:1298/format:webp/1*aKSMBf5yO8nHXSAZmbsnKg.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">带有圆圈和中心点的图像</figcaption></figure><p id="5581" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">现在，我们已经成功地检测到了所有的井，我们可以获得每个中心点的rgb值，并将其映射到颜色名称。注意，我们使用了<em class="mf">convert _ RGB _ to _ color _ name()</em>函数。它是这样做的。</p><pre class="iy iz ja jb fd lv lw lx ly aw lz bi"><span id="50f5" class="kk kl hi lw b fi ma mb l mc md"># Get Color names from RGB values<br/>def convert_rgb_to_color_name(rgb_input):<br/>    hexnames = webcolors.css3_hex_to_names<br/>    names = []<br/>    positions = []</span><span id="8b28" class="kk kl hi lw b fi mg mb l mc md">for hex, name in hexnames.items():<br/>        names.append(name)<br/>        positions.append(webcolors.hex_to_rgb(hex))</span><span id="f86b" class="kk kl hi lw b fi mg mb l mc md">spacedb = KDTree(positions)</span><span id="4801" class="kk kl hi lw b fi mg mb l mc md">querycolor = rgb_input<br/>    dist, index = spacedb.query(querycolor)<br/>    return names[index]</span></pre><p id="2355" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">它接受rgb值，并返回与之最匹配的颜色名称。我已经写了一篇文章解释了它是如何做到的。</p><p id="7117" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这是我们的mapped_cells_list目前返回的内容。</p><pre class="iy iz ja jb fd lv lw lx ly aw lz bi"><span id="20f1" class="kk kl hi lw b fi ma mb l mc md">[{'well_coordinates': (164, 150), 'well_color': 'lightslategrey'},<br/> {'well_coordinates': (72, 106), 'well_color': 'slategrey'},<br/> {'well_coordinates': (208, 150), 'well_color': 'slategrey'},<br/> {'well_coordinates': (210, 332), 'well_color': 'slategrey'},<br/>  .<br/>  .<br/>  .</span></pre><p id="132d" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这些灰色意味着井是空的。颜色是盘子的颜色。</p><p id="126e" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">OpenCV如何检测圆有一个小问题。它没有任何特定的顺序。它随机地或以最佳匹配的第一顺序进行。例如，如果我们预期有96个圆，第一个圆将是OpenCV的算法最有把握的一个。因此，如果我们要标记一个井A1、A2等等，我们需要知道哪个井是哪个井。</p><p id="5fef" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">让我们按照对我们有意义的顺序对井进行排序。</p><pre class="iy iz ja jb fd lv lw lx ly aw lz bi"><span id="6491" class="kk kl hi lw b fi ma mb l mc md"># Mapping Well names<br/>sorted_outer_list = sorted(mapped_cells_list, key=lambda k: k['well_coordinates'])</span><span id="6a61" class="kk kl hi lw b fi mg mb l mc md">for i in range(12):<br/>    sorted_inner_list = sorted(sorted_outer_list[8*i:8*(i+1)], key=lambda k: k['well_coordinates'][1])<br/>    for j in range(len(row_names)):<br/>        sorted_inner_list[j]['well_name'] = row_names[j]+ str(i+1)<br/>        sorted_final_list.append(sorted_inner_list[j])</span></pre><p id="17fe" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">让我们遍历排序后的列表。</p><pre class="iy iz ja jb fd lv lw lx ly aw lz bi"><span id="3d33" class="kk kl hi lw b fi ma mb l mc md">for d in sorted_final_list:<br/>    print(d)</span></pre><p id="cdbe" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">输出:</p><pre class="iy iz ja jb fd lv lw lx ly aw lz bi"><span id="f4a4" class="kk kl hi lw b fi ma mb l mc md">{'well_coordinates': (72, 60), 'well_color': 'slategrey', 'well_name': 'A1'}<br/>{'well_coordinates': (72, 106), 'well_color': 'slategrey', 'well_name': 'B1'}<br/>{'well_coordinates': (74, 150), 'well_color': 'slategrey', 'well_name': 'C1'}<br/>{'well_coordinates': (74, 196), 'well_color': 'slategrey', 'well_name': 'D1'}<br/>{'well_coordinates': (74, 242), 'well_color': 'slategrey', 'well_name': 'E1'}<br/>{'well_coordinates': (72, 286), 'well_color': 'lightslategrey', 'well_name': 'F1'}<br/>{'well_coordinates': (72, 332), 'well_color': 'lightslategrey', 'well_name': 'G1'}<br/>{'well_coordinates': (74, 376), 'well_color': 'slategrey', 'well_name': 'H1'}<br/>{'well_coordinates': (118, 60), 'well_color': 'slategrey', 'well_name': 'A2'}<br/>{'well_coordinates': (118, 106), 'well_color': 'slategrey', 'well_name': 'B2'}<br/>{'well_coordinates': (118, 150), 'well_color': 'slategrey', 'well_name': 'C2'}<br/>{'well_coordinates': (118, 196), 'well_color': 'slategrey', 'well_name': 'D2'}<br/>{'well_coordinates': (118, 242), 'well_color': 'slategrey', 'well_name': 'E2'}<br/>{'well_coordinates': (116, 288), 'well_color': 'lightslategrey', 'well_name': 'F2'}<br/>{'well_coordinates': (118, 332), 'well_color': 'slategrey', 'well_name': 'G2'}<br/>{'well_coordinates': (120, 376), 'well_color': 'slategrey', 'well_name': 'H2'}<br/>.<br/>.<br/>.</span></pre><p id="78f7" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">现在我们把事情安排好了。它仍然是灰色的。让我们在井里放一些颜色，看看它是否能识别它们。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mi"><img src="../Images/ebe2c0c93e9ce3c1b84e665fc1b1efdc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1284/format:webp/1*MkCGQRTbn6eRDJ_xSAHApw.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">带有彩色孔的图像</figcaption></figure><p id="4a2d" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">输出:</p><pre class="iy iz ja jb fd lv lw lx ly aw lz bi"><span id="5cc8" class="kk kl hi lw b fi ma mb l mc md">{'well_coordinates': (72, 60), 'well_color': 'red', 'well_name': 'A1'}<br/>{'well_coordinates': (70, 108), 'well_color': 'darkviolet', 'well_name': 'B1'}<br/>{'well_coordinates': (74, 150), 'well_color': 'blue', 'well_name': 'C1'}<br/>{'well_coordinates': (74, 196), 'well_color': 'lime', 'well_name': 'D1'}<br/>{'well_coordinates': (70, 240), 'well_color': 'blue', 'well_name': 'E1'}<br/>{'well_coordinates': (72, 286), 'well_color': 'red', 'well_name': 'F1'}<br/>{'well_coordinates': (72, 332), 'well_color': 'lime', 'well_name': 'G1'}<br/>{'well_coordinates': (74, 376), 'well_color': 'blue', 'well_name': 'H1'}<br/>{'well_coordinates': (118, 60), 'well_color': 'slategrey', 'well_name': 'A2'}<br/>{'well_coordinates': (118, 106), 'well_color': 'yellow', 'well_name': 'B2'}<br/>{'well_coordinates': (118, 150), 'well_color': 'darkviolet', 'well_name': 'C2'}<br/>{'well_coordinates': (118, 196), 'well_color': 'lime', 'well_name': 'D2'}<br/>{'well_coordinates': (116, 240), 'well_color': 'yellow', 'well_name': 'E2'}<br/>{'well_coordinates': (116, 288), 'well_color': 'darkviolet', 'well_name': 'F2'}<br/>{'well_coordinates': (118, 332), 'well_color': 'darkviolet', 'well_name': 'G2'}<br/>{'well_coordinates': (120, 376), 'well_color': 'red', 'well_name': 'H2'}</span></pre><p id="6c21" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">注意:<em class="mf">一些井是空的，因此是灰色的</em>。</p><p id="6257" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">完整代码:</strong></p><p id="6e01" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">你可以在这里找到完整的工作代码<a class="ae jn" href="https://github.com/mirabdulHaseeb/pcr-color-detection" rel="noopener ugc nofollow" target="_blank"/>。</p></div><div class="ab cl mj mk gp ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="hb hc hd he hf"><h2 id="b734" class="kk kl hi bd km kn ko kp kq kr ks kt ku jx kv kw kx kb ky kz la kf lb lc ld le bi translated">结论</h2><p id="5fd0" class="pw-post-body-paragraph jo jp hi jq b jr lh ij jt ju li im jw jx mq jz ka kb mr kd ke kf ms kh ki kj hb bi translated">看起来我们不得不自己做很多事情，但是OpenCV让大多数困难的工作变得很容易。您可以根据自己的需求修改这段代码。尽情享受吧！</p></div></div>    
</body>
</html>