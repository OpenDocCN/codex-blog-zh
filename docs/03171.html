<html>
<head>
<title>How To Implement Interceptors in Angular</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Angular中实现拦截器</h1>
<blockquote>原文：<a href="https://medium.com/codex/multiple-interceptors-in-angular-e0880b2f7d91?source=collection_archive---------0-----------------------#2021-08-21">https://medium.com/codex/multiple-interceptors-in-angular-e0880b2f7d91?source=collection_archive---------0-----------------------#2021-08-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="e73f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Angular提供的奇妙特性之一是<strong class="ih hj">拦截器，</strong>但是拦截器能做什么，我们能在Angular项目中实现多个拦截器吗？</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/5ab5a631f61e9b97275d460e5db2e9ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*aR4IMRSoPyOUIARq"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated"><a class="ae jt" href="https://unsplash.com/@baciutudor?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">都铎·巴休</a>在<a class="ae jt" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><p id="86f1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">什么是截击机？</strong></p><p id="7dac" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以使用拦截器来拦截传入和传出的HTTP请求，并使用Angular <code class="du kb kc kd ke b">HttpClient</code>来操纵它们。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kf"><img src="../Images/dcc280dd4003dc314c79134e6ac45c9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GSdNvyDUqyeOOApXBPcqIg.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">拦截器位于Angular应用程序和服务器的中间(使用<a class="ae jt" href="http://draw.io" rel="noopener ugc nofollow" target="_blank"> draw.io </a>创建的图像)</figcaption></figure><p id="9a24" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">向我们的Angular应用程序添加拦截器的一个最常见的用例是将<strong class="ih hj">令牌</strong>添加到传出HTTP请求的头部。</p><h2 id="96c9" class="kg kh hi bd ki kj kk kl km kn ko kp kq iq kr ks kt iu ku kv kw iy kx ky kz la bi translated">让我们在Angular应用程序中实现一个拦截器！</h2><p id="42c9" class="pw-post-body-paragraph if ig hi ih b ii lb ik il im lc io ip iq ld is it iu le iw ix iy lf ja jb jc hb bi translated">我们需要在我们的<code class="du kb kc kd ke b">app.module</code>中从<code class="du kb kc kd ke b">@angular/common/http</code>导入<code class="du kb kc kd ke b">HTTP_INTERCEPTORS</code>,以确保它能满足我们所有的请求。那么我们应该在我们的<code class="du kb kc kd ke b">providers</code>中提供。我们还应该导入我们的拦截器和模块，并为其设置<code class="du kb kc kd ke b">useClass</code>的值。</p><pre class="je jf jg jh fd lg ke lh bn li lj bi"><span id="bd64" class="lk kh hi ke b be ll lm l ln lo">import { HTTP_INTERCEPTORS } from '@angular/common/http';<br/>import { Interceptor } from './interceptor';<br/><br/>@NgModule({<br/>  providers: [<br/>    { provide: HTTP_INTERCEPTORS, useClass: Interceptor, multi:true},<br/>  ]<br/>})</span></pre><p id="2647" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在提供了<code class="du kb kc kd ke b">HTTP_INTERCEPTORS</code>之后，我们需要通知这个类我们将通过使用<code class="du kb kc kd ke b">useClass.</code>来实现我们的拦截器</p><blockquote class="lp lq lr"><p id="55c4" class="if ig ls ih b ii ij ik il im in io ip lt ir is it lu iv iw ix lv iz ja jb jc hb bi translated">将<strong class="ih hj"> multi </strong> <em class="hi">设置为true，确保您的项目中可以有多个拦截器。</em></p></blockquote><p id="704b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们在<code class="du kb kc kd ke b">/src/app</code>中创建<code class="du kb kc kd ke b">interceptor.ts</code>，由于拦截器是服务，我们需要在文件中使用<code class="du kb kc kd ke b">@Injectable()</code>装饰器:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lw lx l"/></div></figure><blockquote class="lp lq lr"><p id="600c" class="if ig ls ih b ii ij ik il im in io ip lt ir is it lu iv iw ix lv iz ja jb jc hb bi translated">请记住，拦截器是<strong class="ih hj">服务。</strong></p></blockquote><p id="2e50" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在每个HTTP请求之后，拦截器调用<code class="du kb kc kd ke b">intercept()</code>方法。在<code class="du kb kc kd ke b">Intercept()</code>方法中，我们克隆将要发送的HttpRequest，并将令牌添加到它的HttpHeaders中，一旦完成，我们调用<code class="du kb kc kd ke b">next.handle</code>将被操作的请求返回给应用程序。</p><h2 id="13f9" class="kg kh hi bd ki kj kk kl km kn ko kp kq iq kr ks kt iu ku kv kw iy kx ky kz la bi translated">添加第二个拦截器</h2><p id="de98" class="pw-post-body-paragraph if ig hi ih b ii lb ik il im lc io ip iq ld is it iu le iw ix iy lf ja jb jc hb bi translated">如果有一个用于整个项目的加载组件包装器就好了，一旦来自服务器的请求得到解决，我们就可以从项目的布局中删除加载。</p><p id="4723" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，我们需要创建如下所示的<code class="du kb kc kd ke b">loadingInterceptor.ts</code>文件:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lw lx l"/></div></figure><p id="8eb0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们稍后将讨论<code class="du kb kc kd ke b">LoadingService</code>，但是现在，让我们先检查一下<code class="du kb kc kd ke b">loadingInterceptor</code>。我们正在创建一个<code class="du kb kc kd ke b">Subscription</code>，然后在每个HTTP请求被处理并且<em class="ls">完成之后，</em>我们正在取消订阅<code class="du kb kc kd ke b">spinnerSubscription</code>，我们将在out <code class="du kb kc kd ke b">loadingService</code>中使用它来指示spinner加载。</p><p id="c3ce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们来看看<code class="du kb kc kd ke b">loadingService.ts</code></p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lw lx l"/></div></figure><p id="b006" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以在带有上述服务的Angular应用程序中添加和删除带有spinner组件的覆盖图(第22行),直到订阅没有被取消。<code class="du kb kc kd ke b">loadingComponent</code>可以是你想要的任何东西，GIF，旋转器，或者进度条。我把它设置成这样的一个<code class="du kb kc kd ke b">mat-progress-bar</code>:</p><pre class="je jf jg jh fd lg ke lh bn li lj bi"><span id="d4d1" class="lk kh hi ke b be ll lm l ln lo">&lt;mat-progress-bar color="warn" mode="indeterminate"&gt;&lt;/mat-progress-bar&gt;</span></pre><p id="b3d0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">不要忘记在您的<code class="du kb kc kd ke b">app.module.ts</code>文件中导入第二个拦截器:</p><pre class="je jf jg jh fd lg ke lh bn li lj bi"><span id="5be2" class="lk kh hi ke b be ll lm l ln lo">providers: [<br/>  { provide: HTTP_INTERCEPTORS, useClass: Interceptor, multi: true },<br/>  { provide: HTTP_INTERCEPTORS, useClass: LoadingInterceptor, multi:true }<br/>]</span></pre><blockquote class="lp lq lr"><p id="672a" class="if ig ls ih b ii ij ik il im in io ip lt ir is it lu iv iw ix lv iz ja jb jc hb bi translated"><strong class="ih hj">重要提示:</strong>提供拦截器的顺序很重要。例如，如果您按顺序提供三个拦截器A、B、C，正如Angular文档所说:“……请求流入A- &gt; B- &gt; C，响应流出C- &gt; B- &gt; A。”</p></blockquote></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><blockquote class="ly"><p id="af8e" class="lz ma hi bd mb mc md me mf mg mh jc dx translated"><strong class="ak">该项目的源代码可以在</strong><a class="ae jt" href="https://github.com/hossein13m/angular-multiple-interceptors" rel="noopener ugc nofollow" target="_blank"><strong class="ak">GitHub</strong></a><strong class="ak">获得。</strong></p></blockquote><h1 id="4491" class="mi kh hi bd ki mj mk ml km mm mn mo kq mp mq mr kt ms mt mu kw mv mw mx kz my bi translated">分享给你的朋友！拍手声👏最多50次。</h1><p id="a9b8" class="pw-post-body-paragraph if ig hi ih b ii lb ik il im lc io ip iq ld is it iu le iw ix iy lf ja jb jc hb bi translated">如果你在实现角度拦截器时有任何问题，请在下面评论。你也可以在<a class="ae jt" href="https://twitter.com/Hossein13M" rel="noopener ugc nofollow" target="_blank"> Twitter </a>或<a class="ae jt" href="https://github.com/hossein13m" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上联系我，或者访问我的作品集。</p><div class="mz na ez fb nb nc"><a href="https://hmousavi.dev/" rel="noopener  ugc nofollow" target="_blank"><div class="nd ab dw"><div class="ne ab nf cl cj ng"><h2 class="bd hj fi z dy nh ea eb ni ed ef hh bi translated">侯赛因穆萨维-软件开发人员</h2><div class="nj l"><h3 class="bd b fi z dy nh ea eb ni ed ef dx translated">你好。👋🏻发现侯赛因穆萨维的空间，找出我的作品。请随时与我联系，还有更多！</h3></div><div class="nk l"><p class="bd b fp z dy nh ea eb ni ed ef dx translated">hmousavi.dev</p></div></div><div class="nl l"><div class="nm l nn no np nl nq jn nc"/></div></div></a></div><blockquote class="lp lq lr"><p id="9c70" class="if ig ls ih b ii ij ik il im in io ip lt ir is it lu iv iw ix lv iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="hi">阅读更多来自我:</em> </strong></p></blockquote><div class="mz na ez fb nb nc"><a rel="noopener follow" target="_blank" href="/angular-in-depth/angular-forms-reactive-form-including-angular-material-and-custom-validator-9ef324cc3b08"><div class="nd ab dw"><div class="ne ab nf cl cj ng"><h2 class="bd hj fi z dy nh ea eb ni ed ef hh bi translated">角形(反应式)包括角形材料和自定义验证器</h2><div class="nj l"><h3 class="bd b fi z dy nh ea eb ni ed ef dx translated">表单是每个角度项目的主要部分，在这篇文章中，我们想实现一个反应式的角度表单，带有一个…</h3></div><div class="nk l"><p class="bd b fp z dy nh ea eb ni ed ef dx translated">medium.com</p></div></div><div class="nl l"><div class="nr l nn no np nl nq jn nc"/></div></div></a></div><div class="mz na ez fb nb nc"><a rel="noopener follow" target="_blank" href="/angular-in-depth/husky-6-lint-prettier-eslint-and-commitlint-for-javascript-project-d7174d44735a"><div class="nd ab dw"><div class="ne ab nf cl cj ng"><h2 class="bd hj fi z dy nh ea eb ni ed ef hh bi translated">git Hook Husky 6 Lint(beauty+eslint)和用于JavaScript项目的commitlint</h2><div class="nj l"><h3 class="bd b fi z dy nh ea eb ni ed ef dx translated">编程是一项团队工作，所以我们必须确保我们的代码库是干净的，对团队中的每个人都是可用的…</h3></div><div class="nk l"><p class="bd b fp z dy nh ea eb ni ed ef dx translated">medium.com</p></div></div><div class="nl l"><div class="ns l nn no np nl nq jn nc"/></div></div></a></div><div class="mz na ez fb nb nc"><a href="https://itnext.io/a-complete-guide-to-the-api-first-approach-ecd796dd0f10" rel="noopener  ugc nofollow" target="_blank"><div class="nd ab dw"><div class="ne ab nf cl cj ng"><h2 class="bd hj fi z dy nh ea eb ni ed ef hh bi translated">API-优先方法完全指南</h2><div class="nj l"><h3 class="bd b fi z dy nh ea eb ni ed ef dx translated">在您的软件开发生涯中，开发应用程序可能采用的许多方法之一是…</h3></div><div class="nk l"><p class="bd b fp z dy nh ea eb ni ed ef dx translated">itnext.io</p></div></div><div class="nl l"><div class="nt l nn no np nl nq jn nc"/></div></div></a></div><div class="mz na ez fb nb nc"><a href="https://javascript.plainenglish.io/how-to-implement-dark-light-themes-in-a-next-js-app-using-context-hook-tailwindcss-336558dd4579" rel="noopener  ugc nofollow" target="_blank"><div class="nd ab dw"><div class="ne ab nf cl cj ng"><h2 class="bd hj fi z dy nh ea eb ni ed ef hh bi translated">如何使用上下文挂钩在Next.js应用程序中实现暗/亮主题</h2><div class="nj l"><h3 class="bd b fi z dy nh ea eb ni ed ef dx translated">初始化一个Next.js应用程序，然后使用上下文钩子和TailwindCSS实现暗/亮主题切换</h3></div><div class="nk l"><p class="bd b fp z dy nh ea eb ni ed ef dx translated">javascript.plainenglish.io</p></div></div><div class="nl l"><div class="nu l nn no np nl nq jn nc"/></div></div></a></div><div class="mz na ez fb nb nc"><a href="https://javascript.plainenglish.io/take-a-good-look-at-filter-map-and-reduce-in-javascript-18d72f483ada" rel="noopener  ugc nofollow" target="_blank"><div class="nd ab dw"><div class="ne ab nf cl cj ng"><h2 class="bd hj fi z dy nh ea eb ni ed ef hh bi translated">详细了解JavaScript中的filter()、map()和reduce()</h2><div class="nj l"><h3 class="bd b fi z dy nh ea eb ni ed ef dx translated">深入了解JavaScript中的filter()、map()和reduce()方法。</h3></div><div class="nk l"><p class="bd b fp z dy nh ea eb ni ed ef dx translated">javascript.plainenglish.io</p></div></div><div class="nl l"><div class="nv l nn no np nl nq jn nc"/></div></div></a></div></div></div>    
</body>
</html>