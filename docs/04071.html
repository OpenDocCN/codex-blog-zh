<html>
<head>
<title>💪Deploying Moodle on Azure using Bicep Language</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">💪使用Bicep语言在Azure上部署Moodle</h1>
<blockquote>原文：<a href="https://medium.com/codex/deploying-moodle-on-azure-using-bicep-language-48da6111d0d1?source=collection_archive---------2-----------------------#2021-10-23">https://medium.com/codex/deploying-moodle-on-azure-using-bicep-language-48da6111d0d1?source=collection_archive---------2-----------------------#2021-10-23</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="811a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">简化Moodle在Azure上的部署和供应</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/d76de148e7f97402d9cc8335d5a8fd7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Cuy-AAf0-bq-GEKakvRnVg.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">💪使用Bicep语言在Azure上部署Moodle</figcaption></figure></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><p id="6560" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本文中，我们将回顾如何使用基础设施即代码在Azure中部署Moodle。我们将利用Bicep，新的领域特定语言(DSL)，以声明方式部署Azure资源。</p><pre class="je jf jg jh fd ka kb kc kd aw ke bi"><span id="d4c5" class="kf kg hi kb b fi kh ki l kj kk">                                 .-..-.<br/>   _____                         | || |<br/>  /____/-.---_  .---.  .---.  .-.| || | .---.<br/>  | |  _   _  |/  _  \/  _  \/  _  || |/  __ \<br/>  * | | | | | || |_| || |_| || |_| || || |___/<br/>    |_| |_| |_|\_____/\_____/\_____||_|\_____)<br/><br/><strong class="kb hj">Moodle - the world's open source learning platform<br/></strong><br/>Moodle &lt;<a class="ae kl" href="https://moodle.org/" rel="noopener ugc nofollow" target="_blank">https://moodle.org</a>&gt; is a learning platform designed to provide educators, administrators and learners with a single robust, secure and integrated system to create personalised learning environments.</span></pre><h1 id="548b" class="km kg hi bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">解决方案概述</h1><p id="b183" class="pw-post-body-paragraph if ig hi ih b ii lj ik il im lk io ip iq ll is it iu lm iw ix iy ln ja jb jc hb bi translated">这个模板在Debian VM上创建一个独立的Moodle节点。您可以选择虚拟机的大小。</p><p id="fb4a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该解决方案还包括一个私有IP、一个公共IP地址、一个虚拟网络、一个NSG和一个存储帐户。它非常适合在Azure上开发和测试Moodle。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lo"><img src="../Images/c597af88f9ede4295a49d8488ad1db06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2IDFogGEkyoux85A40E6kg.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">Azure上的Moodle</figcaption></figure><h1 id="0edd" class="km kg hi bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">部署的资源</h1><ul class=""><li id="992c" class="lp lq hi ih b ii lj im lk iq lr iu ls iy lt jc lu lv lw lx bi translated">Debian 10.10.VM</li><li id="ba30" class="lp lq hi ih b ii ly im lz iq ma iu mb iy mc jc lu lv lw lx bi translated">IP地址(公有和私有)</li><li id="566a" class="lp lq hi ih b ii ly im lz iq ma iu mb iy mc jc lu lv lw lx bi translated">虚拟网络</li><li id="37be" class="lp lq hi ih b ii ly im lz iq ma iu mb iy mc jc lu lv lw lx bi translated">网络安全配置</li><li id="a327" class="lp lq hi ih b ii ly im lz iq ma iu mb iy mc jc lu lv lw lx bi translated">它可以帮助教育工作者创建高效地在线学习社团。</li></ul><p id="66d3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要了解更多关于Moodle的信息，请查看:<a class="ae kl" href="https://github.com/moodle/moodle" rel="noopener ugc nofollow" target="_blank">https://github.com/moodle/moodle</a></p><h1 id="295a" class="km kg hi bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">💰订阅和费用</h1><p id="3279" class="pw-post-body-paragraph if ig hi ih b ii lj ik il im lk io ip iq ll is it iu lm iw ix iy ln ja jb jc hb bi translated">这个Bicep模板使用Azure Debian 10image，这是一个现收现付(PAYG)的虚拟机映像，不需要用户许可。</p><p id="839b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首次启动实例后，虚拟机将自动获得许可，除了微软的Linux虚拟机费率之外，还将按小时向用户收费。<a class="ae kl" href="https://azure.microsoft.com/pricing/details/virtual-machines/linux/#linux" rel="noopener ugc nofollow" target="_blank"> Linux虚拟机</a>提供定价详情。</p><p id="6dd6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Moodle作为GNU通用公共许可证【https://docs.moodle.org/dev/License&gt;&lt;<a class="ae kl" href="https://docs.moodle.org/dev/License" rel="noopener ugc nofollow" target="_blank">下的开源软件免费提供。</a></p><h1 id="3400" class="km kg hi bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">在部署到Azure之前</h1><p id="a654" class="pw-post-body-paragraph if ig hi ih b ii lj ik il im lk io ip iq ll is it iu lm iw ix iy ln ja jb jc hb bi translated">确保您具备以下条件:</p><ul class=""><li id="aee1" class="lp lq hi ih b ii ij im in iq md iu me iy mf jc lu lv lw lx bi translated">有效的Azure订阅</li><li id="c183" class="lp lq hi ih b ii ly im lz iq ma iu mb iy mc jc lu lv lw lx bi translated">Azure二头肌已安装</li><li id="e58b" class="lp lq hi ih b ii ly im lz iq ma iu mb iy mc jc lu lv lw lx bi translated">Azure PowerShell</li><li id="c037" class="lp lq hi ih b ii ly im lz iq ma iu mb iy mc jc lu lv lw lx bi translated">Azure订阅中的资源组</li><li id="8622" class="lp lq hi ih b ii ly im lz iq ma iu mb iy mc jc lu lv lw lx bi translated">注意:在部署此解决方案之前，您必须接受虚拟机映像的法律条款。要阅读并接受法律条款，您可以使用PowerShell通过下面的cmdlet接受条款和条件:</li></ul><pre class="je jf jg jh fd ka kb kc kd aw ke bi"><span id="79a0" class="kf kg hi kb b fi kh ki l kj kk">Get-AzMarketplaceTerms `<br/>-Publisher 'bitnami' `<br/>-Product 'moodle' `<br/>-Name '3-0' |<br/>Set-AzMarketplaceTerms -Accept</span></pre><p id="ec3e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以上命令适用于Bitnami的Moodle。</p><p id="81a7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您应该会看到以下输出:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mg"><img src="../Images/12d825814aa3528352fbbd395a37c67e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PjZFoIFIxZDZsNu6cZO37g.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">阅读并接受法律条款</figcaption></figure><p id="258e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在让我们使用Bicep模板在Azure上部署Moodle。</p><h1 id="6151" class="km kg hi bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">1.Azure二头肌模板-参数</h1><p id="4747" class="pw-post-body-paragraph if ig hi ih b ii lj ik il im lk io ip iq ll is it iu lm iw ix iy ln ja jb jc hb bi translated">我们将定义以下参数:</p><pre class="je jf jg jh fd ka kb kc kd aw ke bi"><span id="e68b" class="kf kg hi kb b fi kh ki l kj kk">param location string = resourceGroup().location<br/>param networkInterfaceName string<br/>param networkSecurityGroupName string<br/>param networkSecurityGroupRules array<br/>param subnetName string<br/>param virtualNetworkName string<br/>param addressPrefixes array<br/>param subnets array<br/>param publicIpAddressName string<br/>param publicIpAddressType string<br/>param publicIpAddressSku string<br/>param virtualMachineName string<br/>param virtualMachineComputerName string<br/>param osDiskType string<br/>param virtualMachineSize string<br/>param adminUsername string</span><span id="9c12" class="kf kg hi kb b fi mh ki l kj kk"><a class="ae kl" href="http://twitter.com/secure" rel="noopener ugc nofollow" target="_blank">@secure</a>()<br/>param adminPassword string</span></pre><h1 id="bb46" class="km kg hi bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">2.Azure二头肌模板-变量</h1><p id="2d48" class="pw-post-body-paragraph if ig hi ih b ii lj ik il im lk io ip iq ll is it iu lm iw ix iy ln ja jb jc hb bi translated">我们将定义以下变量:</p><pre class="je jf jg jh fd ka kb kc kd aw ke bi"><span id="c188" class="kf kg hi kb b fi kh ki l kj kk">var nsgId = resourceId(resourceGroup().name, 'Microsoft.Network/networkSecurityGroups', networkSecurityGroupName)<br/>var vnetId = resourceId(resourceGroup().name, 'Microsoft.Network/virtualNetworks', virtualNetworkName)<br/>var subnetRef = '${vnetId}/subnets/${subnetName}'</span></pre><h1 id="4d19" class="km kg hi bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">3.Azure二头肌模板—资源</h1><p id="f5a7" class="pw-post-body-paragraph if ig hi ih b ii lj ik il im lk io ip iq ll is it iu lm iw ix iy ln ja jb jc hb bi translated">我们将定义以下资源:</p><pre class="je jf jg jh fd ka kb kc kd aw ke bi"><span id="99f1" class="kf kg hi kb b fi kh ki l kj kk">resource networkInterfaceName_resource 'Microsoft.Network/networkInterfaces@2021-03-01' = {<br/>  name: networkInterfaceName<br/>  location: location<br/>  properties: {<br/>    ipConfigurations: [<br/>      {<br/>        name: 'ipconfig1'<br/>        properties: {<br/>          subnet: {<br/>            id: subnetRef<br/>          }<br/>          privateIPAllocationMethod: 'Dynamic'<br/>          publicIPAddress: {<br/>            id: pip.id<br/>          }<br/>        }<br/>      }<br/>    ]<br/>    networkSecurityGroup: {<br/>      id: nsgId<br/>    }<br/>  }<br/>  dependsOn: [<br/>    networkSecurityGroupName_resource<br/>    virtualNetworkName_resource<br/>    pip<br/>  ]<br/>}</span><span id="876b" class="kf kg hi kb b fi mh ki l kj kk">resource networkSecurityGroupName_resource 'Microsoft.Network/networkSecurityGroups@2019-02-01' = {<br/>  name: networkSecurityGroupName<br/>  location: location<br/>  properties: {<br/>    securityRules: networkSecurityGroupRules<br/>  }<br/>}</span><span id="59ff" class="kf kg hi kb b fi mh ki l kj kk">resource virtualNetworkName_resource 'Microsoft.Network/virtualNetworks@2020-11-01' = {<br/>  name: virtualNetworkName<br/>  location: location<br/>  properties: {<br/>    addressSpace: {<br/>      addressPrefixes: addressPrefixes<br/>    }<br/>    subnets: subnets<br/>  }<br/>}</span><span id="55be" class="kf kg hi kb b fi mh ki l kj kk">resource pip 'Microsoft.Network/publicIpAddresses@2019-02-01' = {<br/>  name: publicIpAddressName<br/>  location: location<br/>  properties: {<br/>    publicIPAllocationMethod: publicIpAddressType<br/>  }<br/>  sku: {<br/>    name: publicIpAddressSku<br/>  }<br/>}</span><span id="9d23" class="kf kg hi kb b fi mh ki l kj kk">resource vm 'Microsoft.Compute/virtualMachines@2021-03-01' = {<br/>  name: virtualMachineName<br/>  location: location<br/>  properties: {<br/>    hardwareProfile: {<br/>      vmSize: virtualMachineSize<br/>    }<br/>    storageProfile: {<br/>      osDisk: {<br/>        createOption: 'FromImage'<br/>        managedDisk: {<br/>          storageAccountType: osDiskType<br/>        }<br/>      }<br/>      imageReference: {<br/>        publisher: 'bitnami'<br/>        offer: 'moodle'<br/>        sku: '3-0'<br/>        version: 'latest'<br/>      }<br/>    }<br/>    networkProfile: {<br/>      networkInterfaces: [<br/>        {<br/>          id: networkInterfaceName_resource.id<br/>        }<br/>      ]<br/>    }<br/>    osProfile: {<br/>      computerName: virtualMachineComputerName<br/>      adminUsername: adminUsername<br/>      adminPassword: adminPassword<br/>      linuxConfiguration: {<br/>        patchSettings: {<br/>          patchMode: 'ImageDefault'<br/>        }<br/>      }<br/>    }<br/>    diagnosticsProfile: {<br/>      bootDiagnostics: {<br/>        enabled: true<br/>      }<br/>    }<br/>  }<br/>  plan: {<br/>    name: '3-0'<br/>    publisher: 'bitnami'<br/>    product: 'moodle'<br/>  }<br/>}</span></pre><h1 id="fc00" class="km kg hi bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">4.Azure二头肌模板-输出</h1><p id="a368" class="pw-post-body-paragraph if ig hi ih b ii lj ik il im lk io ip iq ll is it iu lm iw ix iy ln ja jb jc hb bi translated">我们将定义以下输出:</p><pre class="je jf jg jh fd ka kb kc kd aw ke bi"><span id="32d8" class="kf kg hi kb b fi kh ki l kj kk">output adminUsername string = adminUsername</span></pre><h1 id="8a0d" class="km kg hi bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">5.Azure Bicep模板-部署</h1><p id="0ba7" class="pw-post-body-paragraph if ig hi ih b ii lj ik il im lk io ip iq ll is it iu lm iw ix iy ln ja jb jc hb bi translated">我们将使用下面的命令来部署我们的二头肌模板:</p><pre class="je jf jg jh fd ka kb kc kd aw ke bi"><span id="0c10" class="kf kg hi kb b fi kh ki l kj kk">$date = Get-Date -Format "MM-dd-yyyy"<br/>$deploymentName = "AzInsiderDeployment"+"$date"</span><span id="efbd" class="kf kg hi kb b fi mh ki l kj kk">New-AzResourceGroupDeployment -Name $deploymentName -ResourceGroupName moodle -TemplateFile .\main.bicep -TemplateParameterFile .\azuredeploy.parameters.json -c</span></pre><p id="9f43" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下图显示了部署的预览:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mi"><img src="../Images/a2a1ddb55335bd709bfa962bef4104d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*73lsrEzR_Kn13k5GmztFPA.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">部署预览</figcaption></figure><p id="689e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后我们将执行部署。下图显示了部署输出:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mj"><img src="../Images/6f79a38926e34b1daaca9b34ac1b1435.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YrF2tVg4JmhRBxAbh7zOmg.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">部署输出</figcaption></figure><p id="a600" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦部署成功，转到部署的输出部分，获取Debian虚拟机的IP地址。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mk"><img src="../Images/32b9b4c090d510e03911371cfbc3708c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G0LFwkjzZHbhSqa4QAbj5w.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">虚拟机IP地址</figcaption></figure><p id="526b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以使用如下所示的IP地址在浏览器中访问Moodle应用程序:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ml"><img src="../Images/4a5a4a73eefc47cdb74e2d6a1b4abc50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ObZ9FXaQX_Ly38A6vVPnqg.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">Azure上的Moodle</figcaption></figure><p id="1c6e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以在以下GitHub资源库中找到完整的解决方案:</p><div class="mm mn ez fb mo mp"><a href="https://github.com/daveRendon/azinsider/tree/main/application-workloads/moodle" rel="noopener  ugc nofollow" target="_blank"><div class="mq ab dw"><div class="mr ab ms cl cj mt"><h2 class="bd hj fi z dy mu ea eb mv ed ef hh bi translated">主daveRendon/azinsider上的azin sider/应用程序工作负载/moodle</h2><div class="mw l"><h3 class="bd b fi z dy mu ea eb mv ed ef dx translated">在GitHub上创建一个帐户，为daveRendon/azinsider开发做出贡献。</h3></div><div class="mx l"><p class="bd b fp z dy mu ea eb mv ed ef dx translated">github.com</p></div></div><div class="my l"><div class="mz l na nb nc my nd jn mp"/></div></div></a></div><p id="8145" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">👉<a class="ae kl" href="http://eepurl.com/gKmLdf" rel="noopener ugc nofollow" target="_blank"> <em class="ne">在此加入</em><strong class="ih hj"><em class="ne">azin sider</em></strong><em class="ne">邮箱列表。</em>T9】</a></p><p id="751d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="ne">-戴夫·r·</em></p></div></div>    
</body>
</html>