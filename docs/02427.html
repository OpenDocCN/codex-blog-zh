<html>
<head>
<title>Dynamic Rails Forms With Simple Form, JavaScript &amp; Tailwind CSS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">具有简单表单、JavaScript和Tailwind CSS的动态Rails表单</h1>
<blockquote>原文：<a href="https://medium.com/codex/dynamic-rails-forms-with-simple-form-javascript-tailwind-css-af70749139bc?source=collection_archive---------3-----------------------#2021-07-20">https://medium.com/codex/dynamic-rails-forms-with-simple-form-javascript-tailwind-css-af70749139bc?source=collection_archive---------3-----------------------#2021-07-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/eda3e31007594e43eea6de2bd81669a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hrfjg3I6vXqK_PB_fM1QLw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated"><a class="ae iu" href="https://thoughtsandfitness.com" rel="noopener ugc nofollow" target="_blank">思想&amp;健身</a></figcaption></figure><p id="6236" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">查看这篇文章的视频【https://www.youtube.com/watch?v=gAXs3xhfHVg<a class="ae iu" href="https://www.youtube.com/watch?v=gAXs3xhfHVg" rel="noopener ugc nofollow" target="_blank"/>。感谢订阅！</p><p id="675c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在建立<a class="ae iu" href="https://thoughtsandfitness.com" rel="noopener ugc nofollow" target="_blank">思想&amp;健身</a>电子商务平台的时候，我遇到了一个非常有趣的问题。我的客户希望能够在他的网站上创建日常锻炼。每个锻炼项目都有一定的举重次数，并且每次锻炼的举重次数会有所不同。</p><p id="6d51" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">通常，在处理相关模型时，我们倾向于使用嵌套资源，但在这种情况下，嵌套资源会使每次锻炼增加锻炼变得非常麻烦。我需要一个动态表单，一个可以让我在日常锻炼中为每次举重无缝添加新表单的表单。</p><p id="3361" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果通过视频来学习更容易的话，这篇文章的YouTube版本<a class="ae iu" href="https://www.youtube.com/watch?v=gAXs3xhfHVg" rel="noopener ugc nofollow" target="_blank">https://www.youtube.com/watch?v=gAXs3xhfHVg</a></p><h1 id="86d5" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">Gem文件配置</h1><p id="9537" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">对于本教程，我们将使用<a class="ae iu" href="https://github.com/heartcombo/simple_form" rel="noopener ugc nofollow" target="_blank">简单形式</a>和<a class="ae iu" href="https://github.com/rails/tailwindcss-rails" rel="noopener ugc nofollow" target="_blank"> tailwindcss-rails </a> gems。简单表单使得编写Rails表单变得非常容易。我发现<a class="ae iu" href="https://tailwindcss.com/" rel="noopener ugc nofollow" target="_blank"> TailwindCSS </a>比<a class="ae iu" href="https://getbootstrap.com/" rel="noopener ugc nofollow" target="_blank"> Bootstrap </a>要好得多，因为它允许我对每个类应用单独的断点，给了我更多的控制权，它还提供了比<a class="ae iu" href="https://getbootstrap.com/" rel="noopener ugc nofollow" target="_blank"> Bootstrap </a>更多的组件。此外，我们将使用<a class="ae iu" href="https://github.com/tarellel/simple_form-tailwind" rel="noopener ugc nofollow" target="_blank">simple _ form _ tailwind</a>gem，它为我们设计了所有表单的样式。</p><p id="234b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们开始配置我们的gem文件。</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="315c" class="lf ju hi lb b fi lg lh l li lj">gem "tailwindcss-rails", "~&gt; 0.3.3"</span><span id="9431" class="lf ju hi lb b fi lk lh l li lj">gem 'simple_form'</span><span id="0be8" class="lf ju hi lb b fi lk lh l li lj">gem 'simple_form-tailwind'</span></pre><p id="83e6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为了简洁起见，我不打算介绍安装所有这些gem的命令，但是它们的git页面都在上面链接了。</p><h1 id="3e94" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">创建我们的模型</h1><p id="37ee" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">我们每天将有两个模型工作和电梯。每天的工作都会有一个焦点。我们今天要做的是身体的哪一部分，将会有很多托举。每个电梯将有一个名称，组数，代表人数，并属于一个日常工作。</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="b1ca" class="lf ju hi lb b fi lg lh l li lj">rails g model DailyWorkout focus </span><span id="4abc" class="lf ju hi lb b fi lk lh l li lj">rails g model Lift name sets:integer reps:integer daily_workout:references</span><span id="0e96" class="lf ju hi lb b fi lk lh l li lj">rails db:migrate</span></pre><p id="e44f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">引用是向我们的lift模型添加外键的一种方式。这个键将等于我们的电梯所属的DailyWorkout的ID。</p><p id="ca88" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们的提升模型文件应该如下所示:</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="6c61" class="lf ju hi lb b fi lg lh l li lj">class Lift &lt; ApplicationRecord<br/>  belongs_to :daily_workout<br/>end</span></pre><p id="4c4d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们的日常锻炼应该是这样的:</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="0330" class="lf ju hi lb b fi lg lh l li lj">class DailyWorkout &lt; ApplicationRecord<br/>  has_many :lifts<br/>  accepts_nested_attributes_for :lifts<br/>end</span></pre><p id="9e32" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">根据Rails文档，a<a class="ae iu" href="https://api.rubyonrails.org/classes/ActiveRecord/NestedAttributes/ClassMethods.html" rel="noopener ugc nofollow" target="_blank">ccepts _ nested _ attributes _ for</a>助手允许我们通过其父级保存相关记录。这基本上意味着我们将通过我们的日常工作模型来创造我们所有的提升。</p><h1 id="1e4b" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">控制器</h1><p id="3066" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">让我们创建我们的日常锻炼控制器，不要忘记配置您的路线！。</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="25d2" class="lf ju hi lb b fi lg lh l li lj">rails g controller DailyWorkouts new create</span></pre><p id="2128" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们的控制器现在应该是这样的:</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="59a2" class="lf ju hi lb b fi lg lh l li lj">class DailyWorkoutsController &lt; ApplicationController<br/> <br/>  def new<br/>    @daily_workout = DailyWorkout.new<br/>    @daily_workout.lifts.build<br/>  end<br/><br/>  def create<br/>    @daily_workout = DailyWorkout.create(daily_workout_params)<br/>    if @daily_workout.save<br/>      flash[:success] = "A daily Workout Was Created !"<br/>      redirect_to root_path<br/>    else<br/>       render :new<br/>    end<br/>  end<br/><br/>  private</span><span id="f6cb" class="lf ju hi lb b fi lk lh l li lj">  def daily_workout_params<br/>    params.require(:daily_workout).permit(:focus, <br/>       lifts_attributes: %i[name sets reps])<br/>  end<br/><br/>end</span></pre><p id="2382" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在我们的新动作中，我们创建了一个DailyWorkout，并使用active_record build辅助工具将一组举重动作添加到我们的日常锻炼中。创建操作与标准模型没有什么不同。</p><p id="97ce" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们的daily_workout_params方法允许值:我们锻炼的重点和每次锻炼的属性。让我们开始设计我们的视图。</p><h1 id="16f6" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">景色</h1><p id="fe03" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">在我们使我们的窗体动态化之前，我们将对它进行编程，以便我们只为我们的日常工作构建一个电梯。因为这种形式已经非常复杂，所以在扩展到复杂的任务之前，让事情尽可能简单是很重要的。</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="7411" class="lf ju hi lb b fi lg lh l li lj"># new.html.erb</span><span id="ef4d" class="lf ju hi lb b fi lk lh l li lj">&lt;%= simple_form_for @daily_workout do |f| %&gt;<br/>          &lt;%= f.input :focus %&gt;<br/>          &lt;%= f.simple_fields_for :lifts do |w| %&gt;<br/>            &lt;div id='fieldsetContainer'&gt;<br/>              &lt;fieldset id="0" class="text-indigo-500"&gt;<br/>                &lt;%= w.input :name %&gt;<br/>                &lt;%= w.input :sets %&gt;<br/>                &lt;%= w.input :reps %&gt;<br/>          &lt;% end %&gt;<br/>          &lt;/fieldset&gt;<br/>          &lt;/div&gt;<br/>          &lt;%= f.button :submit %&gt;<br/>&lt;% end %&gt;</span><span id="1094" class="lf ju hi lb b fi lk lh l li lj">&lt;br/&gt;</span><span id="dc00" class="lf ju hi lb b fi lk lh l li lj">&lt;button id=”addLift” onclick="addLift()"&gt;<br/>       Add another lift<br/>&lt;/button&gt;</span></pre><p id="6060" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">simple_fields_for方法用于为我们的电梯创建一个包装器，它几乎与默认的Rails fields_for helper相同。在我们的表单之后，我们创建了一个按钮，单击它将调用一个JavaScript函数。这个函数将负责添加一个新的电梯形式，从而使我们能够添加更多的电梯到我们的集合。</p><p id="5e2f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我将script标签直接放在HTML下面，并包含了一些用于调试的控制台日志记录，请查看下面的代码:</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="4a46" class="lf ju hi lb b fi lg lh l li lj">&lt;script&gt;<br/>    const addWorkout = ()=&gt; {<br/>        const lastId =   document.querySelector('#fieldsetContainer').lastElementChild.id;<br/>        console.log(lastId)<br/><br/>        const newId = parseInt(lastId,10) + 1<br/>        console.log(newId)<br/><br/>        const newFieldset = document.querySelector('[id="0"]').outerHTML.replace(/0/g, newId)<br/>        console.log(newFieldset)<br/>        document.querySelector("#fieldsetContainer").insertAdjacentHTML("beforeend", newFieldset)<br/>    }<br/>&lt;/script&gt;</span></pre><p id="7522" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">实际上，我们所做的就是找到最后创建的lift表单的ID，创建一个ID为N + 1的新表单，并将这个表单添加到我们的HTML中。</p><p id="76d6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">本教程到此为止，希望你学到了东西！</p><p id="ae52" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">一定要订阅！</p><p id="44bd" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">YouTube:【https://www.youtube.com/channel/UCfd8A1xfzqk7veapUhe8hLQ T2】</p><p id="7dd7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">科里的角落播客:【https://anchor.fm/coreys-corner T4】</p></div></div>    
</body>
</html>