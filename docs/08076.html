<html>
<head>
<title>AWS Certified Solutions Architect Professional — Identity Federation — Organizations Service Control Policies</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">AWS认证解决方案架构师专家—身份联盟—组织服务控制策略</h1>
<blockquote>原文：<a href="https://medium.com/codex/aws-certified-solutions-architect-professional-identity-federation-organizations-service-6192fab06d98?source=collection_archive---------9-----------------------#2022-07-14">https://medium.com/codex/aws-certified-solutions-architect-professional-identity-federation-organizations-service-6192fab06d98?source=collection_archive---------9-----------------------#2022-07-14</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="b291" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">关于AWS组织服务控制策略的简要说明。这篇文章是由夏羽·马瑞克教授的《终极AWS认证解决方案架构师》课程的一个简要说明。这个帖子的唯一目的是一个总结，如果你想要详细的学习，请购买夏羽·马雷克的课程。</p></div><div class="ab cl jd je gp jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="hb hc hd he hf"><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es jk"><img src="../Images/ce3d0e3e372652eac750b5500627689f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*_YDF75Aon3VgyhGx.png"/></div></div><figcaption class="jw jx et er es jy jz bd b be z dx translated">图片来自AWS</figcaption></figure><h1 id="5be7" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">服务控制策略</h1><p id="bf21" class="pw-post-body-paragraph if ig hi ih b ii ky ik il im kz io ip iq la is it iu lb iw ix iy lc ja jb jc hb bi translated">服务控制策略(scp)是一种组织策略，可用于管理组织中的权限。</p><p id="ddbf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">scp对您组织中所有帐户的最大可用权限进行集中控制。</p><p id="91c3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> SCP仅适用于OU或账户级别，不适用于管理账户</strong>。</p><p id="aced" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">SCP适用于帐户中的所有用户和角色，包括Root用户。SCP不影响与服务相关的角色。</p><p id="d302" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用案例:</p><ul class=""><li id="976c" class="ld le hi ih b ii ij im in iq lf iu lg iy lh jc li lj lk ll bi translated">限制对某些服务的访问。</li><li id="6183" class="ld le hi ih b ii lm im ln iq lo iu lp iy lq jc li lj lk ll bi translated">根据请求的AWS区域拒绝对AWS的访问。</li><li id="b068" class="ld le hi ih b ii lm im ln iq lo iu lp iy lq jc li lj lk ll bi translated">阻止根用户的服务访问。</li></ul><h1 id="55d7" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">SCP层次继承</h1><p id="ed2a" class="pw-post-body-paragraph if ig hi ih b ii ky ik il im kz io ip iq la is it iu lb iw ix iy lc ja jb jc hb bi translated">您可以将策略附加到组织中的组织实体(根ou、组织单位(OU)或帐户):</p><ul class=""><li id="2189" class="ld le hi ih b ii ij im in iq lf iu lg iy lh jc li lj lk ll bi translated">当您将策略附加到根ou时，组织中的所有OU和帐户都会继承该策略。</li><li id="f6e9" class="ld le hi ih b ii lm im ln iq lo iu lp iy lq jc li lj lk ll bi translated">您不能将策略附加到管理帐户。</li><li id="61cc" class="ld le hi ih b ii lm im ln iq lo iu lp iy lq jc li lj lk ll bi translated">当您将策略附加到特定ou时，直接位于该OU或任何子OU下的帐户将继承该策略。</li><li id="a386" class="ld le hi ih b ii lm im ln iq lo iu lp iy lq jc li lj lk ll bi translated">当您将策略附加到特定帐户时，它只会影响该帐户。</li></ul><p id="c266" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如，我们下面有一个AWS组织。</p><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es lr"><img src="../Images/00133c56d1784ba5eaf8e00379e891ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ctrcQqYRCiYpVE2oc9hqpw.png"/></div></div><figcaption class="jw jx et er es jy jz bd b be z dx translated">图片来自夏羽·马雷克</figcaption></figure><p id="d619" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">管理账户</p><ul class=""><li id="0a77" class="ld le hi ih b ii ij im in iq lf iu lg iy lh jc li lj lk ll bi translated">无所不能。</li><li id="dfbb" class="ld le hi ih b ii lm im ln iq lo iu lp iy lq jc li lj lk ll bi translated">(不适用SCP)。</li></ul><p id="7458" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">账户A</p><ul class=""><li id="f066" class="ld le hi ih b ii ij im in iq lf iu lg iy lh jc li lj lk ll bi translated">无所不能。</li><li id="f293" class="ld le hi ih b ii lm im ln iq lo iu lp iy lq jc li lj lk ll bi translated">除了访问红移(从Prod OU显式拒绝)。</li></ul><p id="2fe7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">账户B</p><ul class=""><li id="43fd" class="ld le hi ih b ii ij im in iq lf iu lg iy lh jc li lj lk ll bi translated">无所不能。</li><li id="7ec3" class="ld le hi ih b ii lm im ln iq lo iu lp iy lq jc li lj lk ll bi translated">除了访问红移(从Prod OU显式拒绝)。</li><li id="f7e1" class="ld le hi ih b ii lm im ln iq lo iu lp iy lq jc li lj lk ll bi translated">除了访问Lambda(来自HR OU的显式拒绝)。</li></ul><p id="c3a2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">账户C</p><ul class=""><li id="ed98" class="ld le hi ih b ii ij im in iq lf iu lg iy lh jc li lj lk ll bi translated">无所不能。</li><li id="bda2" class="ld le hi ih b ii lm im ln iq lo iu lp iy lq jc li lj lk ll bi translated">除了访问红移(从Prod OU显式拒绝)。</li></ul><h1 id="0d8e" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">使用scp的策略</h1><p id="b2bd" class="pw-post-body-paragraph if ig hi ih b ii ky ik il im kz io ip iq la is it iu lb iw ix iy lc ja jb jc hb bi translated">您可以将组织中的服务控制策略(scp)配置为以下任一方式:</p><ul class=""><li id="5a89" class="ld le hi ih b ii ij im in iq lf iu lg iy lh jc li lj lk ll bi translated">拒绝列表:默认情况下允许操作，您可以指定禁止哪些服务和操作。</li><li id="0b56" class="ld le hi ih b ii lm im ln iq lo iu lp iy lq jc li lj lk ll bi translated">允许列表:默认情况下禁止操作，您可以指定允许哪些服务和操作。</li></ul><p id="dae5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如，拒绝列表策略。</p><pre class="jl jm jn jo fd ls lt lu lv aw lw bi"><span id="c953" class="lx kb hi lt b fi ly lz l ma mb">{<br/>    "Version": "2012-10-17",<br/>    "Statement": [<br/>        {<br/>            "Sid": "AllowsAllActions",<br/>            "Effect": "Allow",<br/>            "Action": "*",<br/>            "Resource": "*"<br/>        },<br/>        {<br/>            "Sid": "DenyDynamoDB", <br/>            "Effect": "Deny",<br/>            "Action": "dynamodb:*",<br/>            "Resource": "*"<br/>        }<br/>    ]<br/>}</span></pre><p id="3df8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此策略启用除DynamoDB之外的帐户的完全权限。</p><p id="1741" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">允许列表策略示例。</p><pre class="jl jm jn jo fd ls lt lu lv aw lw bi"><span id="2365" class="lx kb hi lt b fi ly lz l ma mb">{<br/>    "Version": "2012-10-17",<br/>    "Statement": [<br/>        {<br/>            "Effect": "Allow",<br/>            "Action": [<br/>                "ec2:*",<br/>                "cloudwatch:*"<br/>            ],<br/>            "Resource": "*"<br/>        }<br/>    ]<br/>}</span></pre><p id="92d6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此策略允许帐户访问EC2和Cloudwatch。</p><h1 id="5889" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">IAM策略评估逻辑</h1><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es mc"><img src="../Images/2c930f3ad9fe0c895b800d86fe418479.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*nFim62yKC-8XGkv8.png"/></div></div><figcaption class="jw jx et er es jy jz bd b be z dx translated">图片来自AWS</figcaption></figure><p id="d7d3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">拒绝评估:</strong>默认情况下，所有请求都会被拒绝。这被称为隐式拒绝。</p><p id="f63f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">组织scp:</strong>然后代码评估应用于请求的AWS组织服务控制策略(scp)。如果强制代码在scp中没有找到任何适用的<code class="du md me mf lt b">Allow</code>语句，则请求被隐式拒绝。代码返回<strong class="ih hj">拒绝</strong>的最终决定。如果没有SCP，或者SCP允许所请求的动作，则代码继续。</p><p id="68c4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">基于资源的策略:</strong>根据主体的类型，基于资源的策略中的<code class="du md me mf lt b">Allow</code>可以导致<code class="du md me mf lt b">Allow</code>的最终决定，即使基于身份的策略、权限边界或会话策略中存在隐式拒绝。</p><p id="9b17" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">基于身份的策略:</strong>代码然后检查主体的基于身份的策略。如果没有基于身份的策略或基于身份的策略中没有允许所请求的操作的语句，则该请求被隐式拒绝，并且代码返回最终决定<strong class="ih hj"> Deny </strong>。如果任何适用的基于身份的策略中的任何语句允许所请求的操作，则代码继续执行。</p><p id="af26" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> IAM权限边界:</strong>然后，代码检查主体使用的IAM实体是否有权限边界。如果用于设置权限边界的策略不允许所请求的操作，则该请求会被隐式拒绝。</p><p id="5f95" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">会话策略:</strong>然后代码检查主体是否是会话主体。</p><h1 id="d3c1" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">使用IAM策略限制标记</h1><p id="8360" class="pw-post-body-paragraph if ig hi ih b ii ky ik il im kz io ip iq la is it iu lb iw ix iy lc ja jb jc hb bi translated">您可以限制AWS资源上的特定标记。使用<strong class="ih hj"> aws:TagKeys </strong>条件键。</p><p id="1869" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如，仅当EBS卷具有“Env”和“CostCenter”标记时，才允许IAM用户创建EBS卷。使用ForAllValues(必须包含所有键)或ForAnyValue(必须至少包含这些键中的任何一个)。</p><p id="7da4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ForAllValues。</p><pre class="jl jm jn jo fd ls lt lu lv aw lw bi"><span id="25d7" class="lx kb hi lt b fi ly lz l ma mb">{<br/>    "Version": "2012-10-17",<br/>    "Statement": [{<br/>        "Effect": "Allow",<br/>        "Action": "ec2:CreateVolume",<br/>        "Resource": "*",<br/>        "Condition": {"ForAllValues:StringEquals": {"aws:TagKeys": ["Env", "CostCenter"]}}<br/>    }]<br/>}</span></pre><p id="1567" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ForAnyValue。</p><pre class="jl jm jn jo fd ls lt lu lv aw lw bi"><span id="2d9d" class="lx kb hi lt b fi ly lz l ma mb">{<br/>    "Version": "2012-10-17",<br/>    "Statement": [{<br/>        "Effect": "Allow",<br/>        "Action": "ec2:CreateVolume",<br/>        "Resource": "*",<br/>        "Condition": {"ForAnyValue:StringEquals": {"aws:TagKeys": ["Env", "CostCenter"]}}<br/>    }]<br/>}</span></pre><h1 id="c2b8" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">使用SCP来限制创建资源</h1><p id="6401" class="pw-post-body-paragraph if ig hi ih b ii ky ik il im kz io ip iq la is it iu lb iw ix iy lc ja jb jc hb bi translated">如果受影响的成员帐户中的IAM用户/角色没有特定的标记，您可以阻止他们创建资源。</p><p id="c6c2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如，如果EBS卷没有“成本中心”标记，则限制IAM用户创建EBS卷。</p><pre class="jl jm jn jo fd ls lt lu lv aw lw bi"><span id="6c23" class="lx kb hi lt b fi ly lz l ma mb">{<br/>    "Version": "2012-10-17",<br/>    "Statement": [{<br/>        "Effect": "Deny",<br/>        "Action": "ec2:CreateVolume",<br/>        "Resource": "*",<br/>        "Condition": {"Null": {"aws:RequestTag": "true"}}<br/>    }]<br/>}</span></pre><h1 id="f5ce" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">标签策略</h1><p id="bafe" class="pw-post-body-paragraph if ig hi ih b ii ky ik il im kz io ip iq la is it iu lb iw ix iy lc ja jb jc hb bi translated">帮助您在AWS组织中跨资源标准化标记。确保一致的标记，审核标记的资源，并维护正确的资源分类。</p><p id="ca2f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以定义标记键及其允许值。帮助AWS成本分配标签和基于属性的访问控制。</p><h1 id="5f93" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">备份策略</h1><p id="2fd0" class="pw-post-body-paragraph if ig hi ih b ii ky ik il im kz io ip iq la is it iu lb iw ix iy lc ja jb jc hb bi translated">AWS备份使您能够创建定义如何备份AWS资源的备份计划。AWS组织中的备份策略将所有这些部分合并到JSON文本文档中。</p><p id="7d13" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以将备份策略附加到组织结构中的任何元素，如根、组织单位(ou)和个人帐户。</p><p id="b15f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">备份策略使您能够在组织要求的任何级别上对资源备份进行精细控制。例如，您可以在附加到组织根目录的策略中指定必须备份所有Amazon DynamoDB表。</p><p id="4a28" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">组织中每个AWS帐户的有效备份计划在AWS备份控制台中显示为该帐户的不可变计划(仅供查看)。</p><h1 id="3857" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">结束</h1><p id="944f" class="pw-post-body-paragraph if ig hi ih b ii ky ik il im kz io ip iq la is it iu lb iw ix iy lc ja jb jc hb bi translated">结束关于AWS组织服务控制策略的简短说明。</p><p id="f8d2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">关于身份联盟的所有帖子:</p><ol class=""><li id="1ae2" class="ld le hi ih b ii ij im in iq lf iu lg iy lh jc mg lj lk ll bi translated"><a class="ae mh" rel="noopener" href="/codex/aws-certified-solutions-architect-professional-identity-federation-iam-c67d0259ac90">身份&amp;联盟— IAM </a>。</li><li id="70da" class="ld le hi ih b ii lm im ln iq lo iu lp iy lq jc mg lj lk ll bi translated"><a class="ae mh" rel="noopener" href="/codex/aws-certified-solutions-architect-professional-identity-federation-sts-to-assume-a-role-1ca67105b81a">身份&amp;联邦— STS担当</a>。</li><li id="0553" class="ld le hi ih b ii lm im ln iq lo iu lp iy lq jc mg lj lk ll bi translated"><a class="ae mh" rel="noopener" href="/codex/aws-certified-solutions-architect-professional-identity-federation-cognito-ec80783c3fd1">身份联盟&amp;认知联盟</a>。</li><li id="8723" class="ld le hi ih b ii lm im ln iq lo iu lp iy lq jc mg lj lk ll bi translated"><a class="ae mh" rel="noopener" href="/codex/aws-certified-solutions-architect-professional-identity-federation-directory-services-895807d86497">身份联盟—目录服务</a>。</li><li id="0e9d" class="ld le hi ih b ii lm im ln iq lo iu lp iy lq jc mg lj lk ll bi translated"><a class="ae mh" rel="noopener" href="/codex/aws-certified-solutions-architect-professional-identity-federation-aws-organizations-dd63cd701a72">身份联盟— AWS组织</a>。</li><li id="d7bd" class="ld le hi ih b ii lm im ln iq lo iu lp iy lq jc mg lj lk ll bi translated"><a class="ae mh" rel="noopener" href="/codex/aws-certified-solutions-architect-professional-identity-federation-organizations-service-6192fab06d98">身份联盟—组织服务控制策略</a>。</li><li id="d24a" class="ld le hi ih b ii lm im ln iq lo iu lp iy lq jc mg lj lk ll bi translated"><a class="ae mh" rel="noopener" href="/codex/aws-certified-solutions-architect-professional-identity-federation-single-sign-on-7731df09e9a5">身份联盟—单点登录</a>。</li></ol><p id="4010" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下一个<a class="ae mh" rel="noopener" href="/codex/aws-certified-solutions-architect-professional-security-cloudtrail-850006168acb">安全— CloudTrail </a>。</p></div></div>    
</body>
</html>