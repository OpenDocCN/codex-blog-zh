<html>
<head>
<title>Setting up an Apache Hive Data Warehouse</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">设置Apache Hive数据仓库</h1>
<blockquote>原文：<a href="https://medium.com/codex/setting-up-an-apache-hive-data-warehouse-6074775cf66?source=collection_archive---------10-----------------------#2021-08-09">https://medium.com/codex/setting-up-an-apache-hive-data-warehouse-6074775cf66?source=collection_archive---------10-----------------------#2021-08-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="5a6a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Apache Hive数据仓库软件有助于在Hadoop分布式文件系统中使用SQL读取、写入和管理大型数据集。在这篇文章中，我将在Apache Hadoop 3.3.0上设置Apache Hive 3.1.2。Hive需要一个现成的Hadoop框架。我强烈建议你使用我已经发表的名为<a class="ae jd" rel="noopener" href="/codex/running-a-multi-node-hadoop-cluster-257068e5f276">运行多节点Hadoop集群</a>的帖子来设置你的Hadoop框架。</p><div class="je jf ez fb jg jh"><a rel="noopener follow" target="_blank" href="/codex/running-a-multi-node-hadoop-cluster-257068e5f276"><div class="ji ab dw"><div class="jj ab jk cl cj jl"><h2 class="bd hj fi z dy jm ea eb jn ed ef hh bi translated">运行多节点Hadoop集群</h2><div class="jo l"><h3 class="bd b fi z dy jm ea eb jn ed ef dx translated">Apache Hadoop软件库是一个框架，允许跨…分布式处理大型数据集</h3></div><div class="jp l"><p class="bd b fp z dy jm ea eb jn ed ef dx translated">medium.com</p></div></div><div class="jq l"><div class="jr l js jt ju jq jv jw jh"/></div></div></a></div><figure class="jy jz ka kb fd kc er es paragraph-image"><div role="button" tabindex="0" class="kd ke di kf bf kg"><div class="er es jx"><img src="../Images/c24cc0955217ac18a5c00639865e7ca7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nd79weIivnt7f43-mlP-DQ.png"/></div></div><figcaption class="ki kj et er es kk kl bd b be z dx translated"><a class="ae jd" href="https://hive.apache.org/" rel="noopener ugc nofollow" target="_blank">阿帕奇蜂巢</a></figcaption></figure><p id="f4a1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Apache Hive使用数据库来存储其元数据。我将使用一个<a class="ae jd" href="https://www.postgresql.org/" rel="noopener ugc nofollow" target="_blank"> Postgres </a>数据库作为外部metastore，因此我们应该首先安装一个Postgres数据库。我可能会使用一些CentOS (RHEL)命令。我们将通过以下步骤来运行Apache Hive。</p><ol class=""><li id="6cf8" class="km kn hi ih b ii ij im in iq ko iu kp iy kq jc kr ks kt ku bi translated">配置Postgres数据库</li><li id="16f2" class="km kn hi ih b ii kv im kw iq kx iu ky iy kz jc kr ks kt ku bi translated">配置Apache配置单元</li><li id="dfd8" class="km kn hi ih b ii kv im kw iq kx iu ky iy kz jc kr ks kt ku bi translated">解决一些错误</li><li id="8306" class="km kn hi ih b ii kv im kw iq kx iu ky iy kz jc kr ks kt ku bi translated">启动阿帕奇蜂房</li></ol></div><div class="ab cl la lb gp lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="hb hc hd he hf"><h1 id="d132" class="lh li hi bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">配置Postgres数据库</h1><p id="1784" class="pw-post-body-paragraph if ig hi ih b ii mf ik il im mg io ip iq mh is it iu mi iw ix iy mj ja jb jc hb bi mk translated">运行Hadoop框架后，我们可以开始设置Apache Hive。我将假设您已经使用我的帖子<a class="ae jd" rel="noopener" href="/codex/running-a-multi-node-hadoop-cluster-257068e5f276">运行多节点Hadoop集群</a>在同一页面上设置了Hadoop框架。选择一个Hadoop节点作为配置单元服务器，并在其上安装Postgres。Apache Hive使用一个执行引擎(默认为Map-Reduce、Tez或Spark)来分布式运行查询，尽管它只能在一个服务器上使用。现在，让我们配置Postgres数据库。</p><pre class="jy jz ka kb fd mt mu mv mw aw mx bi"><span id="3831" class="my li hi mu b fi mz na l nb nc">[root@hiveserver ~]# sudo -u postgres psql</span><span id="043f" class="my li hi mu b fi nd na l nb nc">postgres=# create user hive_user with encrypted password 'hive_password';<br/>postgres=# create database hive_database;<br/>postgres=# grant all privileges on database hive_database to hive_user;</span></pre><h1 id="867b" class="lh li hi bd lj lk ne lm ln lo nf lq lr ls ng lu lv lw nh ly lz ma ni mc md me bi translated">配置Apache配置单元</h1><p id="33d1" class="pw-post-body-paragraph if ig hi ih b ii mf ik il im mg io ip iq mh is it iu mi iw ix iy mj ja jb jc hb bi mk translated"><span class="l ml mm mn bm mo mp mq mr ms di"> D </span>下载并提取蜂箱。</p><pre class="jy jz ka kb fd mt mu mv mw aw mx bi"><span id="27a7" class="my li hi mu b fi mz na l nb nc">[hduser@hiveserver ~]# wget {Apache Hive LINK (I downloaded apache-hive-3.1.2-bin.tar.gz)}<br/>[hduser@hiveserver ~]# cd /opt<br/>[hduser@hiveserver /opt]# sudo tar xzf /home/hduser/apache-hive-3.1.2-bin.tar.gz<br/>[hduser@hiveserver /opt]# sudo ln -s apache-hive-3.1.2-bin/ hive<br/>[hduser@hiveserver /opt]# sudo chown -R hduser:hadoop hive<br/>[hduser@hiveserver /opt]# sudo chown -R hduser:hadoop apache-hive-3.1.2-bin</span></pre><p id="6fb1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所有配置单元配置文件都在目录<code class="du nj nk nl mu b">/pot/hive/conf</code>下。现在，编辑配置单元配置文件。</p><pre class="jy jz ka kb fd mt mu mv mw aw mx bi"><span id="918b" class="my li hi mu b fi mz na l nb nc">[hduser@hiveserver ~]# cd /opt/hive/conf/<br/>[hduser@hiveserver /opt/hive/conf]# cp hive-env.sh.template hive-env.sh<br/>[hduser@hiveserver /opt/hive/conf]# vi hive-env.sh</span><span id="fbf6" class="my li hi mu b fi nd na l nb nc"># Add these commands<br/>HADOOP_HOME=/opt/hadoop<br/>export HIVE_HOME=/opt/hive<br/>export HIVE_CONF_DIR=${HIVE_HOME}/conf</span><span id="fcd4" class="my li hi mu b fi nd na l nb nc">[hduser@hiveserver /opt/hive/conf]# cp hive-default.xml.template hive-site.xml<br/>[hduser@hiveserver /opt/hive/conf]# vi hive-site.xml</span><span id="7412" class="my li hi mu b fi nd na l nb nc"># Add these elements<br/>  &lt;property&gt;<br/>    &lt;name&gt;system:java.io.tmpdir&lt;/name&gt;<br/>    &lt;value&gt;/tmp/hive/java&lt;/value&gt;<br/>  &lt;/property&gt;<br/>  &lt;property&gt;<br/>    &lt;name&gt;system:user.name&lt;/name&gt;<br/>    &lt;value&gt;${user.name}&lt;/value&gt;<br/>  &lt;/property&gt;</span><span id="0f72" class="my li hi mu b fi nd na l nb nc"># Find javax.jdo.option.ConnectionUserName property and change its value to username of Postgres database: hive_user</span><span id="d720" class="my li hi mu b fi nd na l nb nc"># Find javax.jdo.option.ConnectionPassword property and change its value to username of Postgres database: hive_password</span><span id="5ced" class="my li hi mu b fi nd na l nb nc"># Find javax.jdo.option.ConnectionURL property and change its value to username of Postgres database: jdbc:postgresql://hiveserver:5432/hive_database</span><span id="f596" class="my li hi mu b fi nd na l nb nc"># Find hive.server2.enable.doAs property and change its value to false</span></pre><p id="f483" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Hive使用HDFS的一些目录作为临时目录或存储数据。</p><pre class="jy jz ka kb fd mt mu mv mw aw mx bi"><span id="1ee9" class="my li hi mu b fi mz na l nb nc">[hduser@hiveserver ~]# # Create Hive directories<br/>[hduser@hiveserver ~]# ## Create warehouse and temp directories<br/>[hduser@hiveserver ~]# hdfs dfs -mkdir /tmp<br/>[hduser@hiveserver ~]# hdfs dfs -chmod g+w /tmp<br/>[hduser@hiveserver ~]# hdfs dfs -mkdir -p /user/hive/warehouse<br/>[hduser@hiveserver ~]# hdfs dfs -chmod g+w /user/hive/warehouse<br/>[hduser@hiveserver ~]# ## Check permissions to be drwxrwxr-x<br/>[hduser@hiveserver ~]# hdfs dfs -ls /<br/>[hduser@hiveserver ~]# hdfs dfs -ls /user/hive</span></pre><p id="dd53" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">是时候设置环境变量了。</p><pre class="jy jz ka kb fd mt mu mv mw aw mx bi"><span id="5e31" class="my li hi mu b fi mz na l nb nc">[hduser@hiveserver ~]# vi .bashrc</span><span id="0b89" class="my li hi mu b fi nd na l nb nc"># Add these commands<br/># Hive<br/>export HIVE_HOME=/opt/hive<br/>export HIVE_CONF_DIR=$HIVE_HOME/conf<br/>export PATH=$HIVE_HOME/bin:$PATH</span></pre><p id="548a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">好吧！休息一下！</p><figure class="jy jz ka kb fd kc er es paragraph-image"><div role="button" tabindex="0" class="kd ke di kf bf kg"><div class="er es nm"><img src="../Images/e171c68d474c0a89f3309a49786e613d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xw5Q9a7sifdgVf8x"/></div></div><figcaption class="ki kj et er es kk kl bd b be z dx translated">照片由<a class="ae jd" href="https://unsplash.com/@mohammaddadkhah?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">穆罕默德·达德哈</a>在<a class="ae jd" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><h1 id="be4c" class="lh li hi bd lj lk ne lm ln lo nf lq lr ls ng lu lv lw nh ly lz ma ni mc md me bi translated">解决一些错误</h1><p id="d583" class="pw-post-body-paragraph if ig hi ih b ii mf ik il im mg io ip iq mh is it iu mi iw ix iy mj ja jb jc hb bi mk translated">虽然我们已经正确配置了配置单元，但是您可能会遇到一些错误。第一个是<code class="du nj nk nl mu b">com.ctc.wstx.WstxParsingException</code>类型的奇特<code class="du nj nk nl mu b">RuntimeException</code>。</p><pre class="jy jz ka kb fd mt mu mv mw aw mx bi"><span id="64d4" class="my li hi mu b fi mz na l nb nc">Exception in thread "main" java.lang.RuntimeException: com.ctc.wstx.exc.WstxParsingException: Illegal character entity: expansion character</span></pre><p id="90f7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我不知道为什么会这样，因为我们复制了模板配置文件并编辑了它们。但是解决方案很简单，我们需要删除<code class="du nj nk nl mu b">hive-site.xml</code>中的一个特殊字符。</p><pre class="jy jz ka kb fd mt mu mv mw aw mx bi"><span id="6f5e" class="my li hi mu b fi mz na l nb nc">[hduser@hiveserver /opt/hive/conf]# vi hive-site.xml</span><span id="13fc" class="my li hi mu b fi nd na l nb nc"># Find hive.txn.xlock.iow property and delete the special character between for and transactional words in its description.</span></pre><p id="d7cc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">另一个错误更奇怪。</p><pre class="jy jz ka kb fd mt mu mv mw aw mx bi"><span id="e745" class="my li hi mu b fi mz na l nb nc">Exception in thread "main" java.lang.NoSuchMethodError: com.google.common.base.Preconditions.checkArgument(ZLjava/lang/String;Ljava/lang/Object;)</span></pre><p id="4c07" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">发生此错误是因为库版本之间不一致。解决此错误需要小版本控制。检查Apache Hive和Apache Hadoop中<code class="du nj nk nl mu b">guava</code>库的版本，将最新的复制到对方。</p><pre class="jy jz ka kb fd mt mu mv mw aw mx bi"><span id="2017" class="my li hi mu b fi mz na l nb nc">[hduser@hiveserver ~]# ls /opt/hive/lib/ | grep guava<br/>guava-19.0.jar</span><span id="b2db" class="my li hi mu b fi nd na l nb nc">[hduser@hiveserver ~]# ls /opt/hadoop/share/hadoop/hdfs/lib/ | grep guava<br/>guava-27.0-jre.jar</span></pre><p id="99bb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我的例子中，我应该将<code class="du nj nk nl mu b">guava</code> jar文件从Hadoop库复制到Hive库。</p><pre class="jy jz ka kb fd mt mu mv mw aw mx bi"><span id="4dbd" class="my li hi mu b fi mz na l nb nc">[hduser@hiveserver ~]# mv /opt/hive/lib/guava-19.0.jar /opt/hive/lib/guava-19.0.jar.bak<br/>[hduser@hiveserver ~]# cp /opt/hadoop/share/hadoop/hdfs/lib/guava-27.0-jre.jar /opt/hive/lib/guava-27.0-jre.jar</span></pre><p id="190b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">希望不会再有错误了。让我们开始蜂巢。</p><h1 id="0b18" class="lh li hi bd lj lk ne lm ln lo nf lq lr ls ng lu lv lw nh ly lz ma ni mc md me bi translated">启动阿帕奇蜂房</h1><p id="4d73" class="pw-post-body-paragraph if ig hi ih b ii mf ik il im mg io ip iq mh is it iu mi iw ix iy mj ja jb jc hb bi translated">使用这些命令启动配置单元服务器和元存储服务器。</p><pre class="jy jz ka kb fd mt mu mv mw aw mx bi"><span id="1b03" class="my li hi mu b fi mz na l nb nc">[hduser@hiveserver ~]# hiveserver2<br/>[hduser@hiveserver ~]# hive --service metastore</span></pre><p id="2938" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您还可以创建服务来控制配置单元服务器和元存储服务器。</p><pre class="jy jz ka kb fd mt mu mv mw aw mx bi"><span id="56bc" class="my li hi mu b fi mz na l nb nc">[hduser@hiveserver ~]# cd /etc/systemd/system<br/>[hduser@hiveserver /etc/systemd/system]# sudo vi hive.service</span><span id="cbf8" class="my li hi mu b fi nd na l nb nc"># Add these lines<br/>[Unit]<br/>Description=Hive Server 2<br/>After=syslog.target network.target remote-fs.target nss-lookup.target network-online.target<br/>Requires=network-online.target hdfs.service yarn.service</span><span id="1540" class="my li hi mu b fi nd na l nb nc">[Service]<br/>User=hduser<br/>Group=hadoop<br/>Type=simple<br/>ExecStart=/opt/hive/bin/hiveserver2<br/>WorkingDirectory=/home/hduser<br/>TimeoutStartSec=2min<br/>Restart=on-failure</span><span id="ee69" class="my li hi mu b fi nd na l nb nc">[Install]<br/>WantedBy=multi-user.target</span><span id="ad7d" class="my li hi mu b fi nd na l nb nc">[hduser@hiveserver /etc/systemd/system]# sudo vi hive-metastore.service</span><span id="653b" class="my li hi mu b fi nd na l nb nc"># Add these lines<br/>[Unit]<br/>Description=Hive Meta Store Server<br/>After=syslog.target network.target remote-fs.target nss-lookup.target network-online.target<br/>Requires=network-online.target hdfs.service yarn.service hive.service</span><span id="a0d9" class="my li hi mu b fi nd na l nb nc">[Service]<br/>User=hduser<br/>Group=hadoop<br/>Type=simple<br/>ExecStart=/opt/hive/bin/hive --service metastore<br/>WorkingDirectory=/home/hduser<br/>TimeoutStartSec=2min<br/>Restart=on-failure</span><span id="e760" class="my li hi mu b fi nd na l nb nc">[Install]<br/>WantedBy=multi-user.target</span></pre></div><div class="ab cl la lb gp lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="hb hc hd he hf"><p id="84b9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我希望这个教程是有用的。谢谢你。</p></div></div>    
</body>
</html>