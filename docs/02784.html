<html>
<head>
<title>Generate dynamic form letters with R and Microsoft Word</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用R和Microsoft Word生成动态套用信函</h1>
<blockquote>原文：<a href="https://medium.com/codex/generate-dynamic-form-letters-with-r-and-microsoft-word-9923fc5fa9df?source=collection_archive---------9-----------------------#2021-08-05">https://medium.com/codex/generate-dynamic-form-letters-with-r-and-microsoft-word-9923fc5fa9df?source=collection_archive---------9-----------------------#2021-08-05</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/1b9c00e15144c6c4509c92a282b55d18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ggg-URopd4SP9qu8Ypj2zg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">r和Microsoft Word徽标(作者插图)</figcaption></figure><p id="7ee3" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果你曾经被要求在Microsoft Word中完成一封套用信函，你可能知道它有多乏味。有时，可以使用软件和工具生成信件和文档，例如Microsoft Word中的邮件合并功能，但其他时候，具有多个细微差别字段的文档通常只是在需要时才完成。</p><p id="89ac" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">使用大卫·戈赫尔 的<a class="ae js" href="https://davidgohel.github.io/officer/" rel="noopener ugc nofollow" target="_blank"> <strong class="iw hj"> officer软件包，可以在R中找到一个解决复杂格式信函的方法。这个简短的教程创建了一个模板工作聘书，并使用R来完成其占位符字段。如果你有兴趣复制这些例子，你可以在这里</strong> </a>找到教程代码和文件<a class="ae js" href="https://github.com/matthanc/dynamicword" rel="noopener ugc nofollow" target="_blank"> <strong class="iw hj">。首先，我们从创建模板文档开始。</strong></a></p><h1 id="5f7d" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">第一步:准备Word文档</h1><p id="6098" class="pw-post-body-paragraph iu iv hi iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr hb bi translated">用于更改占位符文本的方法本质上是一个“查找和替换”功能。因此，使用唯一的占位符并且不在文档的其他地方部分(或全部)使用是很重要的。例如，使用<em class="kw"> "appointment_type" </em>和<em class="kw">" appointment _ type _ abbr "</em>作为占位符将不起作用，因为该函数会错误地将第一个合并字段匹配到第二个。为此，我们使用<em class="kw">“约会类型”</em>和<em class="kw">“约会缩写”</em>来避免无意的混淆。</p><p id="a442" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">对于本教程，下面的聘书模板将被用作一个例子。</p><figure class="ky kz la lb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kx"><img src="../Images/e31b77a7fb46f2145470480799e3dda0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*FSSvbQw2V1D990dr.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">带有占位符的Word模板文档</figcaption></figure><h1 id="5f55" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">第二步:编写R脚本</h1><figure class="ky kz la lb fd ij"><div class="bz dy l di"><div class="lc ld l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">步骤1:加载R包。</figcaption></figure><p id="8f98" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我们将通过加载上述四个库来启动脚本。但是，在加载软件包之前，您需要使用<em class="kw">“install . packages”</em>函数安装每个软件包。更多关于如何安装包的信息可以在<a class="ae js" href="https://www.r-bloggers.com/2010/11/installing-r-packages/" rel="noopener ugc nofollow" target="_blank"> <strong class="iw hj">这里</strong> </a>找到。</p><figure class="ky kz la lb fd ij"><div class="bz dy l di"><div class="lc ld l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">步骤2:加载相关数据</figcaption></figure><p id="0ba3" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">接下来，我们加载相关的数据表。在上面的代码中，表格是从外部Excel文件中加载的。在本例中，我们将使用四个表中的虚拟数据— <em class="kw">、【position_data】、</em>、<em class="kw">、【union_data】、</em>、<em class="kw">、【appointment_data】、</em>、<em class="kw">、【department _ data】</em>。</p><figure class="ky kz la lb fd ij"><div class="bz dy l di"><div class="lc ld l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">步骤3:为输入和查找编写一个函数</figcaption></figure><p id="cad3" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">加载数据表后，我们将为用户输入编写一个函数。在上面的示例中，10个输入用于返回一个单行表。然后，使用职务代码和部门ID输入从以前使用各种连接和变异函数加载的表中查找信息。结果是一个有21个输入/变量的单行表格——其中许多将在以后输入到我们的套用信函中。</p><figure class="ky kz la lb fd ij"><div class="bz dy l di"><div class="lc ld l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">步骤4:编写一个查找和替换函数</figcaption></figure><p id="9a38" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">一旦我们编写了输入函数，接下来我们将编写“查找和替换”函数。在上面的例子中，读取Word文档，并为我们信函中的每个占位符编写一个<em class="kw"> "body_replace_all_text" </em>函数(来自officer包)。</p><figure class="ky kz la lb fd ij"><div class="bz dy l di"><div class="lc ld l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">步骤5:输入输入内容。</figcaption></figure><p id="1a72" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在上面的R代码中，我们调用前面创建的<em class="kw">“offer letter _ inputs”</em>函数，并提供必要的输入。这有效地创建了前面提到的21个变量的表。</p><figure class="ky kz la lb fd ij"><div class="bz dy l di"><div class="lc ld l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">步骤6:生成并保存。Docx文档</figcaption></figure><p id="545b" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在我们的最后一步，我们运行“查找和替换”功能，并保存录用通知书。上面的代码使用了<em class="kw">"</em><a class="ae js" href="https://www.rdocumentation.org/packages/glue/versions/1.4.2/topics/glue" rel="noopener ugc nofollow" target="_blank"><strong class="iw hj"><em class="kw">glue</em></strong></a><em class="kw">"</em>函数将输入表中的字段连接到文档的文件名中。结果是用我们选择的命名约定动态填充和保存的套用信函。</p><h1 id="a82c" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">超越剧本</h1><p id="5a9f" class="pw-post-body-paragraph iu iv hi iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr hb bi translated">编写生成动态套用信函的R脚本的一个限制是，运行该脚本需要一些R的工作知识。向非R用户提供该脚本需要添加关于如何安装R、软件包和运行代码的详细说明。然而，我们可以避免这种情况，通过将上面的代码工作到一个<a class="ae js" href="https://shiny.rstudio.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="iw hj">闪亮的应用程序</strong> </a>中来包含非R用户。</p><p id="157f" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">Shiny是一个R包，它使得快速创建web应用程序成为可能。例如，使用Shiny，我们可以创建一个web应用程序，利用我们的脚本允许用户直接从他们的web浏览器生成动态套用信函。</p><h1 id="5892" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">闪亮的包裹</h1><p id="c527" class="pw-post-body-paragraph iu iv hi iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr hb bi translated">这个闪亮的应用程序将利用我们已经编写的大部分R代码。特别是，我们将加载相同的包、数据和函数，尽管我们需要在这个过程中对代码进行一些修改。</p><figure class="ky kz la lb fd ij"><div class="bz dy l di"><div class="lc ld l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">加载R包——这一次，闪亮的包包括在内</figcaption></figure><p id="23e7" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我们将首先加载包，这一次也包括如上所示的闪亮的包。</p><figure class="ky kz la lb fd ij"><div class="bz dy l di"><div class="lc ld l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">加载相关数据</figcaption></figure><figure class="ky kz la lb fd ij"><div class="bz dy l di"><div class="lc ld l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">为输入和查找编写一个函数</figcaption></figure><p id="63d1" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在我们的包被加载之后，我们加载相关的数据并复制到我们的查找函数中。上面几行代码与我们之前编写的数据加载和查找功能相同。</p><p id="d459" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我们剩下的代码需要和这个闪亮的应用程序一起重写——尽管大部分代码和之前写的相似。闪亮的应用程序代码通常分为两个独立的部分——UI(用户界面)部分和服务器部分。UI将作为应用程序的前端，最终用户可以在这里看到和/或输入信息。服务器端部分将处理所有后端计算。在主要的Shiny网站上有更多的互动指南和教程，分享如上。我们将从用户界面开始。</p><figure class="ky kz la lb fd ij"><div class="bz dy l di"><div class="lc ld l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">闪亮的应用程序UI代码</figcaption></figure><p id="43f6" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">上面的UI代码包含10个输入，与我们的inputs函数所需的输入相同。使用界面输入的一个好处是我们可以指定如何输入信息。例如，在上面的代码中，我们允许用户自由地输入大部分文本，但只允许下拉选择其他内容(部门、职务代码、薪级和任命类型)。</p><figure class="ky kz la lb fd ij"><div class="bz dy l di"><div class="lc ld l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">闪亮的应用服务器端代码</figcaption></figure><p id="27d5" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">上面的服务器代码做了一些事情。代码被包装在<em class="kw">“Download handler”</em>函数中，当我们的最终用户单击“Download Offer Letter”按钮时执行。它首先调用并运行我们的inputs函数，然后将用户的输入输入到一个现已解构的find-and-replace函数中。最后，它“打印”文件——有效地用先前选择的相同命名约定保存它</p><figure class="ky kz la lb fd ij"><div class="bz dy l di"><div class="lc ld l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">函数运行闪亮的应用程序。</figcaption></figure><p id="c4f3" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">最后，启动闪亮的应用程序(如上面的代码所示)。您可以通过以下链接找到该应用程序的工作版本，如果您想查看的话:【https://matthanc.shinyapps.io/dynamicworddemo/】<strong class="iw hj"/>。</p><h1 id="435d" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">结束语</h1><p id="f6da" class="pw-post-body-paragraph iu iv hi iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr hb bi translated">就所使用的包的功能而言，本教程中使用的示例有一定的局限性。例如，officer包包括创建Word(.docx)和Powerpoint(。pptx)文档，而不需要带有占位符的外部文档。同样，我们可以用Shiny做更多的事情来改进和风格化应用程序的界面。</p><p id="9db7" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果你对这些脚本感兴趣，你可以在Github上找到代码:<a class="ae js" href="https://github.com/matthanc/dynamicword/" rel="noopener ugc nofollow" target="_blank"><strong class="iw hj">https://github.com/matthanc/dynamicword/</strong></a></p><h2 id="2b66" class="le ju hi bd jv lf lg lh jz li lj lk kd jf ll lm kh jj ln lo kl jn lp lq kp lr bi translated">额外资源</h2><ul class=""><li id="320f" class="ls lt hi iw b ix kr jb ks jf lu jj lv jn lw jr lx ly lz ma bi translated"><em class="kw">R:</em><a class="ae js" href="https://www.r-project.org/" rel="noopener ugc nofollow" target="_blank"><em class="kw">https://www.r-project.org/</em></a></li><li id="8a7c" class="ls lt hi iw b ix mb jb mc jf md jj me jn mf jr lx ly lz ma bi translated"><em class="kw">r studio:</em><a class="ae js" href="https://www.rstudio.com/" rel="noopener ugc nofollow" target="_blank"><em class="kw">https://www.rstudio.com/</em></a></li><li id="55f7" class="ls lt hi iw b ix mb jb mc jf md jj me jn mf jr lx ly lz ma bi translated"><em class="kw">潮汐:</em><a class="ae js" href="https://www.tidyverse.org/" rel="noopener ugc nofollow" target="_blank">T3】https://www.tidyverse.org/T5】</a></li><li id="2b26" class="ls lt hi iw b ix mb jb mc jf md jj me jn mf jr lx ly lz ma bi translated"><em class="kw">闪亮:</em><a class="ae js" href="https://shiny.rstudio.com/" rel="noopener ugc nofollow" target="_blank"><em class="kw">https://shiny.rstudio.com/</em></a></li><li id="f5ca" class="ls lt hi iw b ix mb jb mc jf md jj me jn mf jr lx ly lz ma bi translated"><em class="kw">官R包:</em><a class="ae js" href="https://davidgohel.github.io/officer/" rel="noopener ugc nofollow" target="_blank"><em class="kw">https://davidgohel.github.io/officer/</em></a></li><li id="021b" class="ls lt hi iw b ix mb jb mc jf md jj me jn mf jr lx ly lz ma bi translated"><em class="kw">教程文件:</em><a class="ae js" href="https://github.com/matthanc/dynamicword/" rel="noopener ugc nofollow" target="_blank">【https://github.com/matthanc/dynamicword/】T21</a></li><li id="7866" class="ls lt hi iw b ix mb jb mc jf md jj me jn mf jr lx ly lz ma bi translated"><em class="kw">原帖:</em><a class="ae js" href="https://matthanc.ghost.io/how-to-generate-dynamic-word-documents-with-r/" rel="noopener ugc nofollow" target="_blank"><em class="kw">https://matthanc . ghost . io/how-to-generate-dynamic-word-documents-with-r/</em></a></li></ul></div></div>    
</body>
</html>