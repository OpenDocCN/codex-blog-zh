<html>
<head>
<title>Hack The Boo: Downgrade</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">黑客嘘声:降级</h1>
<blockquote>原文：<a href="https://medium.com/codex/hack-the-boo-downgrade-34590cb026d5?source=collection_archive---------26-----------------------#2022-10-29">https://medium.com/codex/hack-the-boo-downgrade-34590cb026d5?source=collection_archive---------26-----------------------#2022-10-29</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/1a0575d5dede71efddb992af1e596b2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*F571Y8TEWQQjBb6CQ_VPAw.png"/></div></figure><p id="9f4e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这是我写的关于破解CTF降级法庭挑战的文章。在这项挑战中，我们需要分析Windows系统事件日志来回答几个问题。</p><figure class="jl jm jn jo fd ij er es paragraph-image"><div class="er es jk"><img src="../Images/26432a678e0b9e40990303379be6b603.png" data-original-src="https://miro.medium.com/v2/resize:fit:704/format:webp/1*BwluxthpRmqgJ5WLSth-Vw.png"/></div></figure><p id="949c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">首先，我们下载文件并查看内容，我们可以在上面看到许多evtx文件。为了处理这种类型的文件，我们将使用<a class="ae jp" href="https://github.com/omerbenamram/evtx" rel="noopener ugc nofollow" target="_blank"> evtx_dump </a>和JSON过滤工具jq。让我们来回答这些问题:</p><ol class=""><li id="478d" class="jq jr hi io b ip iq it iu ix js jb jt jf ju jj jv jw jx jy bi translated"><strong class="io hj">哪个事件日志包含登录和注销事件的信息？</strong></li></ol><p id="7284" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这个答案很快就可以从谷歌搜索中获得，尽管任何有一些审查这类文件经验的人都可以不用谷歌就能找到它。</p><pre class="jl jm jn jo fd jz ka kb kc aw kd bi"><span id="1670" class="ke kf hi ka b fi kg kh l ki kj">Security</span></pre><figure class="jl jm jn jo fd ij er es paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="er es kk"><img src="../Images/12087b89b9c379ef99273c89c37e7d35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HrFDwOQYS8iM2GA0sx-DFw.png"/></div></div></figure><p id="1518" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj"> 2。成功登录到本地计算机的日志的事件id是什么？</strong></p><p id="67b6" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在是时候做更多的研究了。首先，我们需要知道什么是事件ID。事件ID是系统注册的每种类型事件的唯一数字标识符。一旦我们弄清楚了这一点，我们就可以查找与成功登录到本地计算机相对应的事件ID。在谷歌的帮助下，我们可以很容易地知道答案并输入它。</p><figure class="jl jm jn jo fd ij er es paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="er es et"><img src="../Images/0969ca10a2d14e066f91de215981b68f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5dh4cpRl3t_taoytA3AMsQ.png"/></div></div></figure><p id="bf57" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在谷歌的帮助下，我们可以很容易地知道答案并输入它。</p><figure class="jl jm jn jo fd ij er es paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="er es kp"><img src="../Images/562dea6d0a6bc3bb210dd5cdf6eddfc6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wAZhHWqj2xfhy9Ppu--gdg.png"/></div></div></figure><p id="0711" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj"> 3。哪个是默认的Active Directory身份验证协议？</strong></p><p id="539d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">答案是Kerberos，您可以通过googling找到它，或者如果您以前使用过Active Directory，您可能已经知道它了。</p><figure class="jl jm jn jo fd ij er es paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="er es kq"><img src="../Images/535d135ebd6633c36f1b3db72e1cfc25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1332/format:webp/1*u6wQ0NE3X2fm_SyUaFw1QQ.png"/></div></div></figure><p id="9f19" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj"> 4。纵观所有登录事件，有什么AuthPackage与众不同？</strong></p><p id="2f54" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">首先，让我们将evtx转换成一种我们可以更容易处理的XML格式。</p><pre class="jl jm jn jo fd jz ka kb kc aw kd bi"><span id="4431" class="ke kf hi ka b fi kg kh l ki kj">evtx_dump Security.evtx --threads 1 -o json --dont-show-record-number &gt; Sec.json</span></pre><p id="262d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在是时候为我们寻找的值过滤事件了。</p><pre class="jl jm jn jo fd jz ka kb kc aw kd bi"><span id="3e62" class="ke kf hi ka b fi kg kh l ki kj">jq ".Event | select (.System.EventID == 4624) | .EventData | {AuthenticationPackageName}" Sec.json | grep ":" | sort | uniq -c</span></pre><p id="780f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">jq语法有点复杂，但是我们选择ID为4624(成功登录)的事件，并选择AuthenticationPackageName字段。然后我们清理输出，只包含我们想要的值，并计算出现的次数。</p><p id="f388" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这样，我们将检测到已经使用NTLM进行了几次认证。</p><figure class="jl jm jn jo fd ij er es paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="er es kr"><img src="../Images/44dd32b7d64790edbd852f542490a6bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ABMf91E9ozUE-6_tVaEZRg.png"/></div></div></figure><p id="caff" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj"> 5。可疑登录的时间戳是什么(yyyy-MM-ddTHH:mm:ss) UTC？</strong></p><p id="2181" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">是时候使用jqmagic了，我们必须编写一个更复杂的过滤器，为我们提供系统的NTLM登录的时间戳，以便能够更好地分析它们，并在输出中应用替换。</p><pre class="jl jm jn jo fd jz ka kb kc aw kd bi"><span id="d04f" class="ke kf hi ka b fi kg kh l ki kj">jq ".Event | select (.System.EventID == 4624) | select (.EventData.AuthenticationPackageName == \"NTLM\") | {Domain: .EventData.TargetDomainName , Username: .Event<br/>Data.TargetUserName, Time: .System.TimeCreated}" Sec.json</span></pre><p id="aebe" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们可以看到作为管理员在BOOCORP域中的单一登录。我们将使用时间戳作为最后一个问题的答案。</p><figure class="jl jm jn jo fd ij er es paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="er es kt"><img src="../Images/04e26f55fbf4e1f7e7cb1c244b8cd829.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g_N51yRmefIs5PfjaW_tfA.png"/></div></div></figure><p id="0cb8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我希望你喜欢这篇文章，并了解一些新的:D</p></div></div>    
</body>
</html>