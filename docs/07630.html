<html>
<head>
<title>Flutter Skill of ButtonStyle And MaterialStateProperty</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">按钮样式和材质状态属性的抖动技巧</h1>
<blockquote>原文：<a href="https://medium.com/codex/flutter-skill-of-buttonstyle-and-materialstateproperty-2e6d7003982d?source=collection_archive---------4-----------------------#2022-06-20">https://medium.com/codex/flutter-skill-of-buttonstyle-and-materialstateproperty-2e6d7003982d?source=collection_archive---------4-----------------------#2022-06-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="f323" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你还记得去年Flutter 2发布的时候，除了null safety之外，还有一系列关于Widget的突破性变化，比如:</p><blockquote class="jd je jf"><p id="0f45" class="if ig jg ih b ii ij ik il im in io ip jh ir is it ji iv iw ix jj iz ja jb jc hb bi translated"><code class="du jk jl jm jn b">FlatButton</code>被标记为已弃用，需要替换为<code class="du jk jl jm jn b">TextButton</code></p></blockquote><p id="79c0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们有了flutter 3，你确定你对<code class="du jk jl jm jn b"><em class="jg">TextButton</em></code>或者<code class="du jk jl jm jn b">MaterialStateProperty </code>有足够的了解吗？</p><p id="3ed1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">为什么</strong> <code class="du jk jl jm jn b"><strong class="ih hj">TextButton</strong></code> <strong class="ih hj">与</strong> <code class="du jk jl jm jn b"><strong class="ih hj">MaterialStateProperty </strong></code> <strong class="ih hj">相关联？</strong></p><p id="d76e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先说到<code class="du jk jl jm jn b">MaterialStateProperty </code>，就不得不提材质设计。<strong class="ih hj"/><code class="du jk jl jm jn b"><strong class="ih hj">MaterialStateProperty</strong></code><strong class="ih hj">的设计理念是基于材质设计兼容整个平台的交互。</strong></p><figure class="jp jq jr js fd jt er es paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="er es jo"><img src="../Images/2196086df8569a1449131c419bbef17c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9CSzvOCQtoTiQhNwYqawNg.png"/></div></div></figure><p id="0c5c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我相信当你从Fluter 1换到Fluter 2的时候，你应该有这个疑问:</p><blockquote class="jd je jf"><p id="50d3" class="if ig jg ih b ii ij ik il im in io ip jh ir is it ji iv iw ix jj iz ja jb jc hb bi translated"><strong class="ih hj">为什么</strong><code class="du jk jl jm jn b"><strong class="ih hj">FlatButton</strong></code><strong class="ih hj"/><code class="du jk jl jm jn b"><strong class="ih hj">RaisedButton</strong></code><strong class="ih hj">被弃用，而代之以</strong><code class="du jk jl jm jn b"><strong class="ih hj">TextButton</strong></code><strong class="ih hj"/><code class="du jk jl jm jn b"><strong class="ih hj">RaisedButton</strong></code><strong class="ih hj">？</strong></p></blockquote><figure class="jp jq jr js fd jt er es paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="er es ka"><img src="../Images/6e36aceb490b98527f5c9775cfc76f16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oaBow1_5VFOdyXYBKDeCtg.png"/></div></div></figure><p id="1d02" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以前只需要使用<code class="du jk jl jm jn b">textColor</code>、<code class="du jk jl jm jn b">backgroundColor</code>或者其他参数来设置颜色，而现在使用<strong class="ih hj"> </strong> <code class="du jk jl jm jn b">ButtonStyle</code>在代码量方面会造成很多麻烦。</p><p id="c0f0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当然，后续，Flutter也提供了<code class="du jk jl jm jn b">styleFrom</code><strong class="ih hj">等静态方法来简化代码，但是本质上切换到</strong> <code class="du jk jl jm jn b"><strong class="ih hj">ButtonStyle</strong></code> <strong class="ih hj">是什么意思呢？什么是</strong> <code class="du jk jl jm jn b"><strong class="ih hj">MaterialStateProperty</strong></code> <strong class="ih hj">？</strong></p><figure class="jp jq jr js fd jt er es paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="er es ka"><img src="../Images/f93a7ee56f001425aba6d908765b742c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JxmKFe1rSAhwok19m86u2w.png"/></div></div></figure><p id="59fe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，我们来看看<code class="du jk jl jm jn b">MaterialStateProperty</code>。<code class="du jk jl jm jn b">MaterialStateProperty</code>中有一个<code class="du jk jl jm jn b">MaterialState</code>枚举，包括:</p><ul class=""><li id="6625" class="kb kc hi ih b ii ij im in iq kd iu ke iy kf jc kg kh ki kj bi translated">禁用:当小部件或元素不能交互时</li><li id="8fb6" class="kb kc hi ih b ii kk im kl iq km iu kn iy ko jc kg kh ki kj bi translated">悬停:交互悬停时</li><li id="e8ca" class="kb kc hi ih b ii kk im kl iq km iu kn iy ko jc kg kh ki kj bi translated">聚焦:在键盘交互中突出显示</li><li id="675f" class="kb kc hi ih b ii kk im kl iq km iu kn iy ko jc kg kh ki kj bi translated">选中:例如，复选框的选中状态</li><li id="d1bd" class="kb kc hi ih b ii kk im kl iq km iu kn iy ko jc kg kh ki kj bi translated">按下:由鼠标、键盘或触摸发起的点击或点击</li><li id="b59b" class="kb kc hi ih b ii kk im kl iq km iu kn iy ko jc kg kh ki kj bi translated">拖动:当用户长按并移动小工具时</li><li id="ca06" class="kb kc hi ih b ii kk im kl iq km iu kn iy ko jc kg kh ki kj bi translated">错误:处于错误状态，如文本字段错误</li></ul><figure class="jp jq jr js fd jt er es paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="er es kp"><img src="../Images/73ef55a8f8c137e2ad7aa8e186fac775.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GhLnInNmUU-3ycbtwST9Sg.png"/></div></div></figure><p id="562e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以答案是:随着Web和桌面平台的发布，原有的<code class="du jk jl jm jn b">FlatButton</code>已经不能很好地满足新交互的需求，比如鼠标悬停在键下的交互。</p><p id="837e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">于是，<code class="du jk jl jm jn b"><strong class="ih hj">TextButton</strong></code> <strong class="ih hj">开始使用</strong> <code class="du jk jl jm jn b"><strong class="ih hj">MaterialStateProperty</strong></code> <strong class="ih hj">组成</strong> <code class="du jk jl jm jn b"><strong class="ih hj">ButtonStyle</strong></code> <strong class="ih hj">来支持不同平台下的UI状态显示。</strong></p><p id="931a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在此之前，如果你需要多平台改编，你可以写这个。你需要处理许多不同的状态条件来产生无数的<code class="du jk jl jm jn b"> if</code>或<code class="du jk jl jm jn b">case</code>:</p><pre class="jp jq jr js fd kq jn kr ks aw kt bi"><span id="5c7d" class="ku kv hi jn b fi kw kx l ky kz">getStateColor(Set&lt;MaterialState&gt; states) {<br/>    if (states.contains(MaterialState.hovered)) {<br/>      /// hovered and focused <br/>      if (states.contains(MaterialState.focused)) {<br/>        return Colors.red;<br/>      } else {<br/>        return Colors.blue;<br/>      }<br/>    } else if (states.contains(MaterialState.focused)) {<br/>      return Colors.yellow;<br/>    }<br/>    return Colors.green;<br/>  }</span></pre><p id="e4cb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是现在，你只需要继承<code class="du jk jl jm jn b">MaterialStateProperty</code>然后使用<a class="ae la" href="http://twitter.com/override" rel="noopener ugc nofollow" target="_blank"> @override </a> <code class="du jk jl jm jn b">resolve</code>方法。</p><p id="9e12" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如，<code class="du jk jl jm jn b">TextButton </code>中的悬停效果默认在<code class="du jk jl jm jn b">_TextButtonDefaultOverlay </code>实现中传递，以便<code class="du jk jl jm jn b">primary.withOpacity </code>实现悬停效果。</p><pre class="jp jq jr js fd kq jn kr ks aw kt bi"><span id="ce8d" class="ku kv hi jn b fi kw kx l ky kz">@immutable<br/>class _TextButtonDefaultOverlay extends MaterialStateProperty&lt;Color?&gt; {<br/>  _TextButtonDefaultOverlay(this.primary);</span><span id="0d80" class="ku kv hi jn b fi lb kx l ky kz">  final Color primary;</span><span id="40e4" class="ku kv hi jn b fi lb kx l ky kz">  @override<br/>  Color? resolve(Set&lt;MaterialState&gt; states) {<br/>    if (states.contains(MaterialState.hovered))<br/>      return primary.withOpacity(0.04);<br/>    if (states.contains(MaterialState.focused) || states.contains(MaterialState.pressed))<br/>      return primary.withOpacity(0.12);<br/>    return null;<br/>  }</span><span id="cff1" class="ku kv hi jn b fi lb kx l ky kz">  @override<br/>  String toString() {<br/>    return '{hovered: ${primary.withOpacity(0.04)}, focused,pressed: ${primary.withOpacity(0.12)}, otherwise: null}';<br/>  }<br/>}</span></pre><figure class="jp jq jr js fd jt er es paragraph-image"><div class="er es lc"><img src="../Images/994f42d3b130038b74f2e75df1165b7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1240/1*7AaYz-fZUZ55mJFPmN3emw.gif"/></div></figure><p id="6163" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">事实上，在<code class="du jk jl jm jn b">TextButton</code>内部，默认情况下，所需的<code class="du jk jl jm jn b">MaterialState</code>效果也是通过<code class="du jk jl jm jn b">styleFrom</code>配置的，包括:</p><ul class=""><li id="107a" class="kb kc hi ih b ii ij im in iq kd iu ke iy kf jc kg kh ki kj bi translated"><code class="du jk jl jm jn b">_TextButtonDefaultForeground</code>:用于通过<code class="du jk jl jm jn b">onSurface?.withOpacity(0.38)</code>改变颜色来处理禁用</li><li id="60d4" class="kb kc hi ih b ii kk im kl iq km iu kn iy ko jc kg kh ki kj bi translated"><code class="du jk jl jm jn b">_TextButtonDefaultOverlay</code>:通过<code class="du jk jl jm jn b">primary.withOpacity</code>进行悬停、聚焦、按压改变颜色</li><li id="e8d4" class="kb kc hi ih b ii kk im kl iq km iu kn iy ko jc kg kh ki kj bi translated"><code class="du jk jl jm jn b">_TextButtonDefaultMouseCursor</code>:不能处理鼠标光标；</li></ul><p id="a490" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">其余参数都是通过熟悉的<code class="du jk jl jm jn b">ButtonStyleButton.allOrNull </code>方法，其中的参数不需要特殊处理。</p><p id="638a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">但是</strong> <code class="du jk jl jm jn b"><strong class="ih hj">ButtonStyleButton.allOrNull</strong></code> <strong class="ih hj">的作用是什么？</strong></p><p id="caf7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">实际上，<code class="du jk jl jm jn b">ButtonStyleButton.allOrNull</code>是基于<code class="du jk jl jm jn b">MaterialStateProperty.all </code>可空版本，实现了<code class="du jk jl jm jn b">resolve</code>接口的<code class="du jk jl jm jn b">MaterialStateProperty</code>。</p><p id="82cf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果不需要支持null，也可以直接使用<code class="du jk jl jm jn b">MaterialStateProperty.all</code>。</p><pre class="jp jq jr js fd kq jn kr ks aw kt bi"><span id="7bcd" class="ku kv hi jn b fi kw kx l ky kz"><strong class="jn hj">static</strong> MaterialStateProperty&lt;T&gt;? allOrNull&lt;T&gt;(T? value) =&gt; value == <strong class="jn hj">null</strong> ? <strong class="jn hj">null</strong> : MaterialStateProperty.all&lt;T&gt;(value);</span></pre><figure class="jp jq jr js fd jt er es paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="er es ld"><img src="../Images/f96ac7ecd6b976e94035195950b91803.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1XoeiyFFzzYKcHut0BOCsQ.png"/></div></div></figure><p id="3024" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当然，如果您不想创建一个新的类，但是想定制逻辑，如下面的代码所示，您也可以使用<code class="du jk jl jm jn b">resolveWith</code>静态方法:</p><pre class="jp jq jr js fd kq jn kr ks aw kt bi"><span id="c6cc" class="ku kv hi jn b fi kw kx l ky kz">TextButton(<br/>  style: ButtonStyle(<br/>      backgroundColor: MaterialStateProperty.resolveWith((states) {<br/>    if (states.contains(MaterialState.hovered)) {<br/>      return Colors.green;<br/>    }<br/>    return Colors.transparent;<br/>  })),<br/>  onPressed: () {},<br/>  child: new Text(<br/>    "TEST",<br/>    style: TextStyle(fontSize: 100),<br/>  ),<br/>),</span></pre><figure class="jp jq jr js fd jt er es paragraph-image"><div class="er es le"><img src="../Images/e963aec04e362d396ea365b133b306bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/1*WOVsL8BG9kAcrTqP207elQ.gif"/></div></figure><p id="955c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Google在对Widget做出<code class="du jk jl jm jn b">MaterialState</code>的UI响应时，也遵循了Material Design的设计规范，比如hover <code class="du jk jl jm jn b">primary.withOpacity(0.04); </code>因此<code class="du jk jl jm jn b">TextButton</code>和<code class="du jk jl jm jn b">ElevatedButton</code>都遵循类似的规范:</p><figure class="jp jq jr js fd jt er es paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="er es lf"><img src="../Images/d567cbfc3445f061c3c696a140ba7a08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P92Q_reb4tP8QVQvjyamvg.png"/></div></div></figure><p id="f495" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">另外，有时候你不想每个地方都单独配置style，需要配合Theme来实现。</p><p id="73b9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">其实<code class="du jk jl jm jn b">TextButton</code>、<code class="du jk jl jm jn b">ElevatedButton</code>、<code class="du jk jl jm jn b">OutlinedButton</code>都是<code class="du jk jl jm jn b">ButtonStyleButton</code>的子类。它们都遵循以下原则:</p><pre class="jp jq jr js fd kq jn kr ks aw kt bi"><span id="2692" class="ku kv hi jn b fi kw kx l ky kz">final ButtonStyle? widgetStyle = widget.style;<br/>    final ButtonStyle? themeStyle = widget.themeStyleOf(context);<br/>    final ButtonStyle defaultStyle = widget.defaultStyleOf(context);<br/>    assert(defaultStyle != null);<br/><br/>    T? effectiveValue&lt;T&gt;(T? Function(ButtonStyle? style) getProperty) {<br/>      final T? widgetValue  = getProperty(widgetStyle);<br/>      final T? themeValue   = getProperty(themeStyle);<br/>      final T? defaultValue = getProperty(defaultStyle);<br/>      return widgetValue ?? themeValue ?? defaultValue;<br/>    }<br/>复制代码</span></pre><blockquote class="jd je jf"><p id="5c20" class="if ig jg ih b ii ij ik il im in io ip jh ir is it ji iv iw ix jj iz ja jb jc hb bi translated">如:<code class="du jk jl jm jn b">return widgetValue ?? themeValue ?? defaultValue;</code>。</p></blockquote><p id="0198" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以，比如当你需要全局去除水波纹效果时，如下面的代码所示，你可以修改<code class="du jk jl jm jn b">ThemeData</code>的<code class="du jk jl jm jn b">TextButtonTheme</code>来实现，因为<code class="du jk jl jm jn b">TextButton</code>中的<code class="du jk jl jm jn b">themeStyleOf</code>使用了<code class="du jk jl jm jn b">TextButtonTheme</code>。</p><pre class="jp jq jr js fd kq jn kr ks aw kt bi"><span id="19a8" class="ku kv hi jn b fi kw kx l ky kz">theme: ThemeData(<br/>  primarySwatch: Colors.blue,<br/>  textButtonTheme: TextButtonThemeData(<br/>    // remove<br/>    style: ButtonStyle(splashFactory: NoSplash.splashFactory),<br/>  ),<br/>),</span></pre><figure class="jp jq jr js fd jt er es paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="er es lg"><img src="../Images/e330370d6152f955192b0ac00a8fa2b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VlQTs7jhGkL-VjevqU7Flg.png"/></div></div></figure><p id="e5cf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后做个总结:</p><ul class=""><li id="df39" class="kb kc hi ih b ii ij im in iq kd iu ke iy kf jc kg kh ki kj bi translated">如果只是简单配置背景色，可以直接使用<code class="du jk jl jm jn b">styleFrom</code></li><li id="d58a" class="kb kc hi ih b ii kk im kl iq km iu kn iy ko jc kg kh ki kj bi translated">如果单独配置，可以使用<code class="du jk jl jm jn b">ButtonStyleButton.allOrNull</code></li><li id="7028" class="kb kc hi ih b ii kk im kl iq km iu kn iy ko jc kg kh ki kj bi translated">如果你需要灵活性，你可以使用<code class="du jk jl jm jn b">ButtonStyleButton.resolveWith</code>或者实现<code class="du jk jl jm jn b">MaterialStateProperty.</code>或者<code class="du jk jl jm jn b">resolve</code></li></ul></div></div>    
</body>
</html>