# 可维护程序宣言(MPM) ✍️

> 原文：<https://medium.com/codex/the-maintainable-program-manifesto-mpm-3ba5239f7a8?source=collection_archive---------16----------------------->

![](img/db7be6e375d5a214a17b70a4982a0d78.png)

# TL；MPM 博士

你的软件是防改变的吗？这份宣言为你提供了一份简单而实用的 **13 因素清单**，让你知道你的应用程序是否是**可维护的**和可靠的，不管是前端、后端还是基础设施技术。

它只关注应用程序级别，而不是团队和组织。你不会在这里看到诸如“有一个指定的 QA 团队”或“在小团队中开发”之类的东西。这些组织决策不属于这里。

**它被写得很轻，也很容易理解，**所以我们不会深究这 13 个因素中的任何一个。我试着在每一部分留下一段来自一位著名开发者/前开发者的**引文**，以防你想对这个话题做进一步的研究。我也很乐意在评论中回答你的任何疑问。

每个阶段都会有一个**积分系统**，你可以用它来获得一些硬分。(**寻找🏀**)。

对于所有(正当地)懒惰的开发者，我提供了一个表格，你可以用它来勾选你的答案并自动获得一个分数！(更在最后)

![](img/27ebd3d5a80279c7bb26f1cf7d34bf42.png)

# 这是给谁的？

MPM 是为那些曾经在维护任何类型的应用程序时挣扎过的开发者准备的。如果你想减少一个新加入者在你的项目中的摩擦，或者只是想了解你如何才能改进你的团队的应用，那么 bingo。在这篇文章结束时，你将有一些有趣的东西可以在你的下一次脱口秀或技术复古中谈论。

![](img/5cfa92c5147b75932c472a358eb91928.png)

我们漂亮的办公室里的一些同事( [SDC:LX](https://www.vwds.pt/about-us/software-development-center/) )

# 代码交换和访问

## 1 —源代码管理

> 如果你没有源代码控制，你会因为试图让程序员一起工作而感到压力。乔尔·斯波尔斯基，乔尔测验

这是一个又快又旧的。为了让开发人员立即交换新代码，拥有一个源代码控制系统是必不可少的。

开发人员需要一种方法来将更改推入最新的代码库，确保他们所构建的是其他人也在做的。

**这也带来了一些有用的功能，比如恢复到过去的提交，以快速回滚任何偷偷摸摸的错误，甚至版本跟踪。**

🏀*恭喜！如果你用的是源码控制系统，你刚刚得了 3 分！*

## 2 —单一回购

我不知道你是否已经知道了，但是我在开发的时候很懒。我最讨厌的事情是，当我开发一个新产品时，不得不在 3 或 4 个不同的来源之间跳来跳去，以获得已经存在的概述。

注意我没有说“monorepo”，因为根据维基百科:

> “(…)mono repo 是一种软件开发策略，其中许多项目的代码存储在同一个存储库中”，这绝对不是我所宣扬的。

我所说的是有一个单一的 repo，包含你的项目需要工作的一切(当然是秘密):数据库规则、后端、前端和基础设施。这保证了没有知识仅仅由一两个开发人员保存。

如果您的应用程序被神奇地从其托管数据中心清除，那么回购应该包含将它备份到与以前完全相同的规模和性能所需的所有内容。

🏀*单一回购实干家 3 分！*

# 交付

## 3 — CI/CD 管道—快速管道！

> 在抽象层面上，部署管道是将软件从版本控制交付到用户手中的过程的自动化体现—大卫·法利

如果你想变得灵活，CI/CD 是强制性的。你的代码的新特性不应该离开你的用户太久。如果您不断地部署和发布到产品中，您将更容易创建快速反馈文化，用户的行为和需求(正当地)指导您的开发。

对于适当的开发来说，这也应该是快速的，你应该能够在错误发生的那天对管道的错误和过失采取行动。如果您甚至需要等待很长时间才能知道管道需要修复，那么它将一直处于“红色”状态，累积错误并进入有害的级联模式。

🏀*管道运行时间不到 20 分钟得 3 分，超过 20 分钟得 2 分。如果你没有一个管道没有点*

## 4 —适当的测试

> “写测试，直到恐惧变成无聊”
> ――肯特·贝克

你应该有信心发布好的代码。此外，你应该有信心运送坏代码。您应该有绝对的信心，如果您的代码以任何方式损害了用户体验，您的管道将得到它，阻止它进入生产。

请注意，对您的管道有信心并不意味着有时一个粗略的错误不会悄悄通过。但是如果你对这些(希望如此)稀少的事件采取适当的行动，它们会越来越少发生。

这可以通过测试策略来实现。E2E 测试和 pact 测试都是策略，你可以使用它们来正确地捕捉任何可能被错误引入的偷偷摸摸的错误。

️⚠️ ***如果你没有超过 95%的测试覆盖率，你就不能对你的测试有信心。***

🏀*您是否有信心，如果您的渠道在新的推送中变绿，那么所有的功能都将交付给您的用户？恭喜你，你刚刚赢得了 5 分，正在向顾客提供令人愉快的产品*

## 5 —一步完成部署

> 要将软件部署到开发、测试或生产环境中，人们应该执行两项任务:选择版本和环境，并按下“部署”按钮。—大卫·法利谈[连续交货](https://www.goodreads.com/work/quotes/13558958)

我把范围缩小到一个，因为 99%的时候你都想测试最新的版本。

因此，`git push`是启动部署阶段所需要的全部时间。流程中的更多步骤会引入人为错误。如果有需要做的检查，就自动执行。

这也不会花太长时间。我建议只在推送阶段运行您的单元测试，从而使它尽可能地无痛和简单。

管道应该会处理好剩下的事情。

🏀*1 步部署者 3 分！*

## 6 —零停机部署

点击 deploy(或`git push`)应该是一个无畏的动作。如果你打算为你的使用提供停机时间，它自动不是。

🏀如果你的部署给予 0 秒停机时间，扣 3 分。30 秒内扣 2 分

# 理解和维护

## 7 —快速本地反馈循环

> “因为测试如此重要，我们应该一直把它作为开发过程中不可或缺的一部分。”—妮可·福斯格林

为了让任何应用程序生存下来，它需要有一个适当的本地开发环境。

开发人员必须能够**快速运行隔离检查**，检查他们在交付步骤之前**更改的代码。他们需要很快。**

这是评估代码库质量的唯一最有价值的指标。这些测试是你的代码库比喻体的免疫系统，因此，它们“行动”得越快越好。

当您更改任何一段代码时，您应该不断地运行这些扫描，它们越快，您运行它们的次数就越多。相信我，我很懒。

🏀如果你的单元测试运行时间少于 10 秒，得 3 分；少于 30 秒，得 2 分；否则得零分。

📝如果 10 秒钟对于你的单元测试来说看起来很漫长，那么很可能你正在使用一个过时的单元测试概念。单元测试应该被认为是对一个单元及其依赖项的集成测试，以一种 [*的方式*](https://martinfowler.com/bliki/UnitTest.html) *。如果这仍然让你困惑，我强烈推荐检查* [*这篇文章*](https://alramalho.medium.com/improve-your-codes-maintainability-by-dropping-unit-tests-92f115d5aa6b) *。*

## 8-重构规则的完整测试覆盖

> “重构是一种重组现有代码体的训练有素的技术，改变其内部结构而不改变其外部**行为**。”—马丁·福勒

你的单元测试测试行为或者[实现细节](https://kentcdodds.com/blog/testing-implementation-details)。如果你做的事情是正确的，那就是前者，所以很自然地可以得出**重构不应该让你的测试失败。**

行为驱动测试是必须的，以确保你的代码库反映你想要的功能。重构规则只是说重构代码不应该让任何测试失败。

如果你想了解更多关于如何做到这一点，我写了一篇[文章](https://alramalho.medium.com/improve-your-codes-maintainability-by-dropping-unit-tests-92f115d5aa6b)，肯定会对你有所帮助。

🏀*你的代码 100%遵守重构规则吗？给你 3 分！*

## 9 —进行测试驱动的开发

> "测试是我们告诉项目下一代程序员的故事."—罗伊·奥舍洛夫

你可能想知道为什么我把这句话放在 TDD 部分。只有当你以一种行为导向的方式思考它们时，把你的测试当作“要讲的故事”才是可能的。测试驱动的开发与行为测试紧密相关，因为它迫使你在实现之前编写测试，从而将你从细节中抽象出来。

开始时，这很奇怪，似乎会减缓发展。这有点像投资，你将主要从长期来看获得收益。

🏀*TDD 爱好者 2 分！*

## 10-无技术文档

> “单元测试是文档。它们描述了系统最底层的设计。”
> ――罗伯特·c·马丁，干净的编码者

文件腐烂了。句号。人们要么忘了，要么懒得更新。

产品的底层技术是不断变化的，试图“硬”记录它很可能是一个回旋镖，它会回来直接打在你的脸上。

你应该只记录那些你不想改变的事情。

如果你没有过度工程化，那么你的架构和代码结构对于新加入者来说会很容易理解。正如上面 Robert 所说，测试应该覆盖底层设计。

🏀*浏览您的文档。如果您没有找到任何与代码细节(代码结构、语法或架构)相关的内容，请给 3 分！*

## 11 —基础设施即代码

> “基础设施作为代码的理念是，用于运行软件的系统和设备可以被视为软件本身。”—凯夫·莫里斯

我非常喜欢“代码是活的文档”这个说法。代码(IaC)不可能“腐烂”,因为它不是基础设施的表示，而是基础设施本身！

忘记图纸，当一个小细节改变时，谁有时间或记忆来更新它？此外，它通常只有一个概览，像基础资源配置这样的小细节被留在回购的深角落，通常只有其神秘的创造者知道。

你应该有一个包含所有基础设施和[后台服务](https://12factor.net/backing-services)配置的文件。随着现代云应用程序开发的兴起，这不需要用传统的标记语言，Python 和 Typescript 作为广泛使用的 IaC 语言出现了。

如果您使用并正确组织您的 IaC，您将拥有一个始终最新的页面，准确说明您的应用程序在当前规模和速度下运行所需的内容。

🏀 *IaC 绝对值得 3 分*

## 12 —可访问的主机

有时你需要调试。当这种情况发生时，能够连接到底层的 REPL 壳可能是几分钟或几天痛苦挖掘的区别。

如果是本地开发，它是免费的，但是当您连接到远程机器时，您应该能够通过 SSH 连接来执行具有`sudo`权限的小脚本(尽管您不应该(需要)在生产环境中这样做)

🏀*如果您能够通过 SSH 连接到您的远程机器，则获得 2 分！*

## 13 —可观察性

遵循与最后一个因素相同的思路。当事情发生时，你想尽快解决。您必须随身携带的一个工具是后台服务的**事件流。**理想情况下，您还应该启用一些跟踪功能，使您更容易可视化和简化事件。但在这里我不会太挑剔，我宁愿你把精力集中在避免这些情况上，而不是应付它们。

🏀如果您有后台服务日志的事件流，您将获得 3 分。

# ⭐️积分系统和分类！

🏆 [**点击此链接，了解您的表现**](https://alramalho.notion.site/The-Maintainable-Program-Manifesto-MPM-point-system-84e1a17fb44c4614ab834ed72d3a9a03) 🏆

它将带你进入一个带有简单表格和结果表的网页。下面是截图:

![](img/7d6191f18a91613b7d6ffd71bc765c34.png)

也可以按照文章开头的表格。

那都是乡亲们！🥕

如果你想在评论中修改什么，请告诉我。