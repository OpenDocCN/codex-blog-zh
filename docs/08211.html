<html>
<head>
<title>How React.js Context works (TypeScript)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React.js上下文如何工作(TypeScript)</h1>
<blockquote>原文：<a href="https://medium.com/codex/how-react-js-context-works-typescript-72de02036f71?source=collection_archive---------3-----------------------#2022-07-24">https://medium.com/codex/how-react-js-context-works-typescript-72de02036f71?source=collection_archive---------3-----------------------#2022-07-24</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="4da0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您的React应用程序不断扩展，它最终会达到需要全局状态的时候。有许多可用的解决方案；现在，我将演示最简单的一个，它是在React中有意开发的:React上下文</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/8320664c8fb98f45033baea39fa7dbe3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bgisRWrTc0JwXw9yLqovSQ.png"/></div></div></figure><p id="2415" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">假设您或您的客户希望升级应用程序，以允许用户在亮暗模式之间进行选择。这意味着您必须以某种方式为每个应用程序组件提供对实际主题信息的访问。</p><p id="97be" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于应用程序中有限数量的组件，您可以使用<code class="du jp jq jr js b">props</code>来实现</p><pre class="je jf jg jh fd jt js ju jv aw jw bi"><span id="9383" class="jx jy hi js b fi jz ka l kb kc">🏑 <strong class="js hj">IN A SMALL APPLICATION YOU CAN PASS ANY INFORMATION WITH PROPS</strong><br/>const Navbar = () =&gt; {<br/>  const theme = useMemo(() =&gt; {<br/>    return props.theme<br/>  }, [])<br/>  return(<br/>    &lt;div className={theme === 'light' ? 'light' : 'dark'}&gt;<br/>      ...<br/>    &lt;/div&gt;<br/>  )<br/>}<br/>const Component = (props: { theme: string }) =&gt; {<br/>  const theme = useMemo(() =&gt; {<br/>    return props.theme<br/>  }, [])<br/>  return(<br/>    &lt;div className={theme === 'light' ? 'light' : 'dark'}&gt;<br/>      ...<br/>    &lt;/div&gt;<br/>  )<br/>}<br/>const Main = () =&gt; {<br/>  return(<br/>    &lt;div&gt;<br/>      &lt;Navbar theme='light' /&gt;<br/>      &lt;Component theme='light' /&gt;<br/>    &lt;/div&gt;<br/>  )<br/>}</span></pre><p id="414b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可以这样做，但这实际上是多余的，而且一点也不鼓励。更不用说如果你在许多不同的层上有许多组件会发生什么。在这种情况下，您必须跨多个级别提供<code class="du jp jq jr js b">props</code>,这些级别不一定需要知道传递给低级组件的信息。</p><pre class="je jf jg jh fd jt js ju jv aw jw bi"><span id="3738" class="jx jy hi js b fi jz ka l kb kc">⛔️ <strong class="js hj">YOU SHOULD AVOID SENDING PROPS THROUGH MANY LAYERS WHEN USING A LOT OF COMPONENTS</strong><br/>const Main = () =&gt; {<br/>  return(<br/>    &lt;div&gt;<br/>      &lt;Layout theme='light' /&gt;<br/>    &lt;/div&gt;<br/>  )<br/>}<br/>const Layout = (props: { theme: string }) =&gt; {<br/>  return(<br/>    &lt;div&gt;<br/>      &lt;Navbar theme={props.theme} /&gt;<br/>      &lt;Wrapper theme={props.theme} /&gt;<br/>    &lt;/div&gt;<br/>  )<br/>}<br/>const Wrapper = (props: { theme: string }) =&gt; {<br/>  ...<br/>}</span></pre><p id="ea05" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是，如果有一种方法可以让您的应用程序访问全局上下文呢？这将是很棒的，因为你可以提供全球信息，而不需要通过<code class="du jp jq jr js b">props</code>到任何级别和任何组件。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kd"><img src="../Images/ac30e75f867852a7efeb1da755f50298.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aLg1-G2UAlaKpBopRnmCRg.png"/></div></div></figure><p id="bb28" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">反应上下文是你所寻求的。这一次，不需要任何更多的库依赖，因此我们不会经历安装过程，我们将从一个名为<code class="du jp jq jr js b">contexts.ts</code>的<code class="du jp jq jr js b">src</code>新文件开始</p><pre class="je jf jg jh fd jt js ju jv aw jw bi"><span id="6ca6" class="jx jy hi js b fi jz ka l kb kc">📝 <strong class="js hj">CREATE A NEW FILE</strong><br/>src/contexts.tsx</span></pre><p id="5e27" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了保持在应用程序中提供实际主题信息的例子，我们将使用基于<code class="du jp jq jr js b">theme</code>的命名约定来创建主题信息<code class="du jp jq jr js b">Context</code>和主题信息<code class="du jp jq jr js b">Provider</code></p><pre class="je jf jg jh fd jt js ju jv aw jw bi"><span id="6d02" class="jx jy hi js b fi jz ka l kb kc">👍 <strong class="js hj">CREATE THE THEME CONTEXT AND THE INFORMATION PROVIDER</strong><br/>import React from 'react'<br/>export const ThemeContext = React.createContext('')<br/>export const ThemeProvider = ThemeContext.Provider</span></pre><p id="9f59" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下一步是用<code class="du jp jq jr js b">Provider</code>包装<code class="du jp jq jr js b">Main</code>或<code class="du jp jq jr js b">App</code>组件，并创建一个<code class="du jp jq jr js b">theme</code>状态</p><pre class="je jf jg jh fd jt js ju jv aw jw bi"><span id="5c99" class="jx jy hi js b fi jz ka l kb kc">🌯 <strong class="js hj">WRAP YOUR MAIN COMPONENT WITH THE PROVIDER AND CREATE A THEME STATE</strong><br/>import { ThemeProvider } from "../contexts";<br/>import { useState } from "react";<br/>const Main = () =&gt; {<br/>  <strong class="js hj">const [theme, setTheme] = useState&lt;'light' | 'dark'&gt;('light')</strong><br/>  return(<br/>    <strong class="js hj">&lt;ThemeProvider value={theme}&gt;</strong><br/>      &lt;Component /&gt;<br/>      &lt;button onClick={() =&gt; {setTheme('light')}}&gt;LIGHT&lt;/button&gt;<br/>      &lt;button onClick={() =&gt; {setTheme('dark')}}&gt;DARK&lt;/button&gt;<br/>    <strong class="js hj">&lt;/ThemeProvider&gt;</strong><br/>  )<br/>}<br/>export default Main</span></pre><p id="ae13" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">花点时间谈谈上面发生的事。您创建了一个具有两个可能值<code class="du jp jq jr js b">light</code>或<code class="du jp jq jr js b">dark</code>的<code class="du jp jq jr js b">theme</code>状态。之后，您将这个状态作为一个值传递给了<code class="du jp jq jr js b">Provider</code>包装器。这意味着如果你点击其中一个<code class="du jp jq jr js b">button</code>到<code class="du jp jq jr js b">set</code>到<code class="du jp jq jr js b">theme</code>，那么<code class="du jp jq jr js b">Provider</code>包装器中的更新信息(当然还有<code class="du jp jq jr js b">Context</code>中的)也会改变。</p><p id="f5d0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">只剩下一件事，这个故事的主要目的:用<code class="du jp jq jr js b">useContext()</code>钩子利用你的<code class="du jp jq jr js b">Component</code>中的这个<code class="du jp jq jr js b">theme</code>信息上下文</p><pre class="je jf jg jh fd jt js ju jv aw jw bi"><span id="abd4" class="jx jy hi js b fi jz ka l kb kc">🚀 <strong class="js hj">USE THE THEME CONTEXT IN ANY COMPONENT THAT'S WRAPPED IN THE PROVIDER</strong><br/>import { useContext } from 'react';<br/>import { ThemeContext } from "../contexts";<br/>const Component = () =&gt; {<br/>  <strong class="js hj">const theme = useContext(ThemeContext)</strong><br/>  return(<br/>    <strong class="js hj">&lt;div className={theme === 'light' ? 'light' : 'dark'}&gt;</strong><br/>      ...<br/>    <strong class="js hj">&lt;/div&gt;</strong><br/>  )<br/>}<br/>export default Component</span></pre><p id="a058" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这意味着您可以简单地使用<code class="du jp jq jr js b">useContext()</code>钩子从<code class="du jp jq jr js b">ThemeContext</code>中获取主题信息来设计<code class="du jp jq jr js b">ThemeProvider</code>中包装的任何组件。</p><p id="4065" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">恭喜您，您已经成功地创建了一个简单的React应用程序上下文，而无需借助Redux等更复杂的全局状态管理工具！</p></div><div class="ab cl ke kf gp kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="hb hc hd he hf"><p id="1910" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">👋我希望这在你寻找新的学习材料时对你有用。<strong class="ih hj">感谢您抽出时间阅读本文！</strong></p><p id="d66f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你从我的文章中更好地理解了一些东西，☕️，你可以给我买杯咖啡来支持我</p><p id="29ee" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">📯<strong class="ih hj">订阅我的电子邮件列表</strong>，如果你想在未来读到更多这样的故事，请在这里或在<a class="ae kl" href="https://twitter.com/daanwords" rel="noopener ugc nofollow" target="_blank"> Twitter </a> <strong class="ih hj">上关注我！</strong></p></div></div>    
</body>
</html>