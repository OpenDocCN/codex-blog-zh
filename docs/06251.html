<html>
<head>
<title>Tmuxinator Config File Generator</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Tmuxinator配置文件生成器</h1>
<blockquote>原文：<a href="https://medium.com/codex/tmuxinator-config-file-generator-41b93fa03728?source=collection_archive---------8-----------------------#2022-04-15">https://medium.com/codex/tmuxinator-config-file-generator-41b93fa03728?source=collection_archive---------8-----------------------#2022-04-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="3048" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你用过tmuxinator和tmux一起工作吗？您必须为您想要的每个会话编写自己的配置文件。如果有一个运行中的tmux会话有很多窗口和窗格，该怎么办？手动生成配置文件需要一些时间。在本文中，我将创建一个脚本，它将从正在运行的tmux会话中生成一个tmuxinator配置文件。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/5807aaba3beb9db7fa87a84d81d67689.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZNYLOsS8v_3xyQV4ywW0ow.png"/></div></div></figure><h1 id="7ff7" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">介绍</h1><blockquote class="kn ko kp"><p id="a7c8" class="if ig kq ih b ii ij ik il im in io ip kr ir is it ks iv iw ix kt iz ja jb jc hb bi translated">tmux是一个终端多路复用器。它可以让你在一个终端的几个程序之间轻松切换，分离它们(它们在后台保持运行)并重新连接到不同的终端。</p></blockquote><p id="1e90" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我假设你已经在使用tmux，否则先看看我关于<a class="ae ku" href="https://azolf.medium.com/start-using-tmux-3d6ce41ed138" rel="noopener">开始使用tmux </a>的文章。</p><blockquote class="kn ko kp"><p id="c8a9" class="if ig kq ih b ii ij ik il im in io ip kr ir is it ks iv iw ix kt iz ja jb jc hb bi translated">tmuxinator是一个ruby gem，可以让您轻松地创建和管理tmux会话。</p></blockquote><p id="ec8e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可以在他们的<a class="ae ku" href="https://github.com/tmuxinator/tmuxinator" rel="noopener ugc nofollow" target="_blank"> GitHub库页面</a>上了解更多。</p><p id="d92b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我使用tmux已经有几年了，这是我打算安装在任何操作系统上的第一个软件包。有一次，我运行了一个巨大的tmux会话，有如此多的窗口和窗格，这个会话被意外终止了。你能想象吗？然后我开始使用tmuxinator，它可以自动执行我的普通tmux会话，这样我就不需要每次都从头开始创建它们。创建一个定制的tmuxinator文件是非常容易的，你可以通过阅读他们的文档来轻松完成。但是，如果您已经有一个正在运行的tmux会话，就没有办法为它生成tmuxinator配置文件，您需要自己创建它。</p><p id="93f3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我将创建一个脚本，它将从正在运行的tmux会话中生成一个tmuxinator配置文件。</p><h1 id="743d" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">环境</h1><p id="abd4" class="pw-post-body-paragraph if ig hi ih b ii kv ik il im kw io ip iq kx is it iu ky iw ix iy kz ja jb jc hb bi translated">现在，我已经创建了一个名为<code class="du la lb lc ld b">servers</code>的示例tmux会话，包含几个窗口和窗格。</p><p id="dbff" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以使用下面的命令获得在您的会话中运行的窗口列表，我的如下所示。</p><pre class="je jf jg jh fd le ld lf lg aw lh bi"><span id="9601" class="li jq hi ld b fi lj lk l ll lm">$ tmux list-windows -t servers</span><span id="c08a" class="li jq hi ld b fi ln lk l ll lm">0: srv1 (1 panes) [136x36] [layout 6254,136x36,0,0,53] <a class="ae ku" href="http://twitter.com/42" rel="noopener ugc nofollow" target="_blank">@42</a><br/>1: srv2 (1 panes) [136x36] [layout 6255,136x36,0,0,54] <a class="ae ku" href="http://twitter.com/43" rel="noopener ugc nofollow" target="_blank">@43</a><br/>2: srv3 (1 panes) [136x36] [layout 6256,136x36,0,0,55] <a class="ae ku" href="http://twitter.com/44" rel="noopener ugc nofollow" target="_blank">@44</a><br/>3: srv4 (3 panes) [136x36] [layout 718b,136x36,0,0[136x18,0,0,56,136x8,0,19,57,136x8,0,28,59]] <a class="ae ku" href="http://twitter.com/45" rel="noopener ugc nofollow" target="_blank">@45</a><br/>4: srv-staging (1 panes) [136x36] [layout e251,136x36,0,0,60] <a class="ae ku" href="http://twitter.com/46" rel="noopener ugc nofollow" target="_blank">@46</a><br/>5: loadbalancer (4 panes) [136x36] [layout 6f5c,136x36,0,0[136x18,0,0{68x18,0,0,61,67x18,69,0,64},136x17,0,19{68x17,0,19,62,67x17,69,19,63}]] <a class="ae ku" href="http://twitter.com/47" rel="noopener ugc nofollow" target="_blank">@47</a><br/>6: databases- (3 panes) [136x36] [layout 95a1,136x36,0,0[136x18,0,0,65,136x17,0,19{68x17,0,19,66,67x17,69,19,67}]] <a class="ae ku" href="http://twitter.com/48" rel="noopener ugc nofollow" target="_blank">@48</a><br/>7: logs* (7 panes) [136x36] [layout 74ff,136x36,0,0[136x4,0,0,68,136x4,0,5,74,136x4,0,10,72,136x3,0,15,73,136x8,0,19,69,136x4,0,28,70,136x3,0,33,71]] <a class="ae ku" href="http://twitter.com/49" rel="noopener ugc nofollow" target="_blank">@49</a> (active)</span></pre><p id="f09d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这个会话中，我有7个窗口和18个窗格。</p><p id="8bfa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因为你正在使用tmuxinator，所以我假设你已经在你的系统上安装了一个ruby版本和<code class="du la lb lc ld b">bundler</code>。</p><p id="9e6e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，创建一个Gemfile来管理与<code class="du la lb lc ld b">bundle init</code>的依赖关系。现在，让我们将下面一行添加到我们需要的Gemfile中，然后运行<code class="du la lb lc ld b">bundle</code>来安装它。</p><pre class="je jf jg jh fd le ld lf lg aw lh bi"><span id="4e1d" class="li jq hi ld b fi lj lk l ll lm">gem "erb"</span></pre><p id="6e25" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在你的gem文件应该是这样的。</p><pre class="je jf jg jh fd le ld lf lg aw lh bi"><span id="88a6" class="li jq hi ld b fi lj lk l ll lm"># frozen_string_literal: true</span><span id="33c1" class="li jq hi ld b fi ln lk l ll lm">source "<a class="ae ku" href="https://rubygems.org" rel="noopener ugc nofollow" target="_blank">https://rubygems.org</a>"</span><span id="525d" class="li jq hi ld b fi ln lk l ll lm">git_source(:github) {|repo_name| "<a class="ae ku" href="https://github.com/#{repo_name" rel="noopener ugc nofollow" target="_blank">https://github.com/#{repo_name</a>}" }</span><span id="0aae" class="li jq hi ld b fi ln lk l ll lm">gem "erb"</span></pre><h1 id="3343" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">编码…</h1><p id="b3e3" class="pw-post-body-paragraph if ig hi ih b ii kv ik il im kw io ip iq kx is it iu ky iw ix iy kz ja jb jc hb bi translated">现在你应该创建一个名为<code class="du la lb lc ld b">generate.rb</code>的ruby文件。在这个文件中，我们将添加下面的代码行以供将来使用。</p><pre class="je jf jg jh fd le ld lf lg aw lh bi"><span id="aa71" class="li jq hi ld b fi lj lk l ll lm">require 'erb'</span></pre><p id="b2ed" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们将从STDIN输入中获取会话名称，并确保它已被提供。</p><pre class="je jf jg jh fd le ld lf lg aw lh bi"><span id="ccf0" class="li jq hi ld b fi lj lk l ll lm">session = ARGV[0]</span><span id="33ce" class="li jq hi ld b fi ln lk l ll lm">if session.nil? || session.empty?<br/>  puts "Provide a session name"<br/>  return 1<br/>end</span></pre><p id="3285" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，我们将准备一个tmux命令来获取在给定会话上运行的窗口列表。</p><pre class="je jf jg jh fd le ld lf lg aw lh bi"><span id="f74c" class="li jq hi ld b fi lj lk l ll lm">cmd = 'tmux list-windows -t ' + session.to_s + ' -F "window: \'#{window_name}\', panes: \'#{window_panes}\'"'</span></pre><p id="4e6b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可以在这里阅读所有的tmux命令。</p><blockquote class="kn ko kp"><p id="a3d5" class="if ig kq ih b ii ij ik il im in io ip kr ir is it ks iv iw ix kt iz ja jb jc hb bi translated"><strong class="ih hj">list-windows</strong>[<strong class="ih hj">-a</strong>[<strong class="ih hj">-F</strong><em class="hi">format</em>][<strong class="ih hj">-F</strong><em class="hi">filter</em>[<strong class="ih hj">-t</strong><em class="hi">target-session</em>]<br/>(别名:<strong class="ih hj"> lsw </strong> ) <br/>如果给定了<strong class="ih hj"> -a </strong>，则列出服务器上的所有窗口否则，<br/>列出当前会话或<em class="hi">目标会话</em>中的窗口。<br/> <strong class="ih hj"> -F </strong>指定每一行的格式和<strong class="ih hj"> -f </strong>一个过滤器。仅显示过滤器为真的<br/>窗口。参见<br/> <em class="hi">格式</em>部分。</p></blockquote><p id="ac10" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们正在定制带有<code class="du la lb lc ld b">-F</code>标志的tmux命令输出。</p><blockquote class="kn ko kp"><p id="d6ba" class="if ig kq ih b ii ij ik il im in io ip kr ir is it ks iv iw ix kt iz ja jb jc hb bi translated">- <strong class="ih hj">窗口名</strong>窗口名<br/> - <strong class="ih hj">窗口窗格数</strong>窗口中的窗格数</p></blockquote><p id="5e84" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们之前运行的<code class="du la lb lc ld b">servers</code>会话的命令如下所示。</p><pre class="je jf jg jh fd le ld lf lg aw lh bi"><span id="a870" class="li jq hi ld b fi lj lk l ll lm">$ tmux list-windows -t servers -F "window: '#{window_name}', panes: '#{window_panes}'"</span><span id="4e71" class="li jq hi ld b fi ln lk l ll lm">window: 'srv1', panes: '1'<br/>window: 'srv2', panes: '1'<br/>window: 'srv3', panes: '1'<br/>window: 'srv4', panes: '3'<br/>window: 'srv-staging', panes: '1'<br/>window: 'loadbalancer', panes: '4'<br/>window: 'databases', panes: '3'<br/>window: 'logs', panes: '7'</span></pre><p id="8de8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们将执行命令，将输出行分成一个数组，并确保会话存在。</p><pre class="je jf jg jh fd le ld lf lg aw lh bi"><span id="aac6" class="li jq hi ld b fi lj lk l ll lm">windows = %x(#{cmd}).split("\n")<br/>return 1 if windows.count == 0</span></pre><p id="ddea" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们要在regex的帮助下将这些字符串转换成一个散列数组。</p><pre class="je jf jg jh fd le ld lf lg aw lh bi"><span id="40fb" class="li jq hi ld b fi lj lk l ll lm">result = []<br/>windows.each do |window|<br/>  data = window.match(/window: '(?&lt;window_name&gt;.*)', panes: '(?&lt;panes_count&gt;\d+)'/)<br/>  result &lt;&lt; {<br/>    name: data['window_name'],<br/>    panes: data['panes_count'].to_i<br/>  }<br/>end</span></pre><p id="171a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">到目前为止，我们已经获得了结果变量中的所有信息。您可以检查该变量，应该会看到如下内容</p><pre class="je jf jg jh fd le ld lf lg aw lh bi"><span id="f0be" class="li jq hi ld b fi lj lk l ll lm">[{<br/>  : name =&gt; "srv1",<br/>  : panes =&gt; 1<br/>}, {<br/>  : name =&gt; "srv2",<br/>  : panes =&gt; 1<br/>}, {<br/>  : name =&gt; "srv3",<br/>  : panes =&gt; 1<br/>}, {<br/>  : name =&gt; "srv4",<br/>  : panes =&gt; 3<br/>}, {<br/>  : name =&gt; "srv-staging",<br/>  : panes =&gt; 1<br/>}, {<br/>  : name =&gt; "loadbalancer",<br/>  : panes =&gt; 4<br/>}, {<br/>  : name =&gt; "databases",<br/>  : panes =&gt; 3<br/>}, {<br/>  : name =&gt; "logs",<br/>  : panes =&gt; 7<br/>}]</span></pre><p id="237e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们需要将这个变量传递给一个<code class="du la lb lc ld b">erb</code>模板来获取我们的配置文件。</p><h1 id="41c1" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">创建模板</h1><blockquote class="kn ko kp"><p id="7cb7" class="if ig kq ih b ii ij ik il im in io ip kr ir is it ks iv iw ix kt iz ja jb jc hb bi translated">ERB为Ruby提供了一个简单易用但功能强大的模板系统。使用ERB，可以将实际的Ruby代码添加到任何纯文本文档中，以便生成文档信息细节和/或流程控制。</p></blockquote><p id="2d16" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在让我们创建一个名为<code class="du la lb lc ld b">template.erb</code>的文件，如下图所示。我们正在一行一行地检查那个。</p><pre class="je jf jg jh fd le ld lf lg aw lh bi"><span id="b5c2" class="li jq hi ld b fi lj lk l ll lm">  1 name: &lt;%= session %&gt;<br/>  2 windows:<br/>  3 &lt;% result.each do |window| %&gt;<br/>  4   - &lt;%= window[:name] %&gt;:<br/>  5       panes:<br/>  6       &lt;% window[:panes].times do %&gt;<br/>  7           - ls<br/>  8       &lt;% end %&gt;<br/>  9 &lt;% end %&gt;</span></pre><p id="1284" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个文件将为给定的会话名生成一个有效的tmuxinator配置文件。第一行定义了tmuxinator的会话名。</p><p id="7d9b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后我们使用关键字<code class="du la lb lc ld b">windows</code>来定义我们的窗口。我们将遍历结果变量并添加窗口名。然后，对于每一个窗格数量，我们用一个简单的<code class="du la lb lc ld b">ls</code>命令作为默认命令将其添加到该窗口中。您可以在这里或者在生成文件之后定制命令。</p><h1 id="92df" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">最后一步</h1><p id="31e6" class="pw-post-body-paragraph if ig hi ih b ii kv ik il im kw io ip iq kx is it iu ky iw ix iy kz ja jb jc hb bi translated">现在我们有了模板文件，我们需要传递变量并获取配置文件。</p><pre class="je jf jg jh fd le ld lf lg aw lh bi"><span id="a2c1" class="li jq hi ld b fi lj lk l ll lm">ERB.new(File.read('template.erb')).result(binding)</span></pre><p id="b0f2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后我们可以将输出写入一个文件。</p><pre class="je jf jg jh fd le ld lf lg aw lh bi"><span id="d69f" class="li jq hi ld b fi lj lk l ll lm">file_name = "#{session}.yml"<br/>File.write(file_name,<br/>           ERB.new(File.read('template.erb')).result(binding)<br/>          )</span><span id="0b51" class="li jq hi ld b fi ln lk l ll lm">puts "Write the config file"<br/>puts "#{Dir.pwd}/#{session}.yml"</span></pre><p id="b6fb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在你可以用一个tmux会话名运行你的脚本，然后你会看到一个名为<code class="du la lb lc ld b">servers.yml</code>的文件，如下所示。</p><pre class="je jf jg jh fd le ld lf lg aw lh bi"><span id="23df" class="li jq hi ld b fi lj lk l ll lm">ruby generate.rb servers</span><span id="72b0" class="li jq hi ld b fi ln lk l ll lm"># servers.yml</span><span id="29d1" class="li jq hi ld b fi ln lk l ll lm">name: servers<br/>windows:</span><span id="4330" class="li jq hi ld b fi ln lk l ll lm">- srv1:<br/>      panes:<br/>      <br/>          - ls</span><span id="1dc6" class="li jq hi ld b fi ln lk l ll lm">- srv2:<br/>      panes:<br/>      <br/>          - ls</span><span id="0879" class="li jq hi ld b fi ln lk l ll lm">- srv3:<br/>      panes:<br/>      <br/>          - ls</span><span id="13b5" class="li jq hi ld b fi ln lk l ll lm">- srv4:<br/>      panes:<br/>      <br/>          - ls<br/>      <br/>          - ls<br/>      <br/>          - ls</span><span id="fec9" class="li jq hi ld b fi ln lk l ll lm">- srv-staging:<br/>      panes:<br/>      <br/>          - ls</span><span id="e3d4" class="li jq hi ld b fi ln lk l ll lm">- loadbalancer:<br/>      panes:<br/>      <br/>          - ls<br/>      <br/>          - ls<br/>      <br/>          - ls<br/>      <br/>          - ls</span><span id="f23c" class="li jq hi ld b fi ln lk l ll lm">- databases:<br/>      panes:<br/>      <br/>          - ls<br/>      <br/>          - ls<br/>      <br/>          - ls</span><span id="019e" class="li jq hi ld b fi ln lk l ll lm">- logs:<br/>      panes:<br/>      <br/>          - ls<br/>      <br/>          - ls<br/>      <br/>          - ls<br/>      <br/>          - ls<br/>      <br/>          - ls<br/>      <br/>          - ls<br/>      <br/>          - ls</span></pre><p id="63a1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，您可以轻松地定制想要在每个窗格上运行的命令，或者轻松地添加更多配置，并根据您的喜好进行定制。</p><pre class="je jf jg jh fd le ld lf lg aw lh bi"><span id="97a9" class="li jq hi ld b fi lj lk l ll lm"># generate.rb</span><span id="e704" class="li jq hi ld b fi ln lk l ll lm">require 'erb'</span><span id="60b3" class="li jq hi ld b fi ln lk l ll lm">session = ARGV[0]</span><span id="7e08" class="li jq hi ld b fi ln lk l ll lm">if session.nil? || session.empty?<br/>  puts "Provide a session name"<br/>  return 1<br/>end</span><span id="21a0" class="li jq hi ld b fi ln lk l ll lm">cmd = 'tmux list-windows -t ' + session.to_s + ' -F "window: \'#{window_name}\', panes: \'#{window_panes}\'"'</span><span id="3ccd" class="li jq hi ld b fi ln lk l ll lm">windows = %x(#{cmd}).split("\n")<br/>return 1 if windows.count == 0</span><span id="614e" class="li jq hi ld b fi ln lk l ll lm">result = []<br/>windows.each do |window|<br/>  data = window.match(/window: '(?&lt;window_name&gt;.*)', panes: '(?&lt;panes_count&gt;\d+)'/)<br/>  result &lt;&lt; {<br/>    name: data['window_name'],<br/>    panes: data['panes_count'].to_i<br/>  }<br/>end</span><span id="228b" class="li jq hi ld b fi ln lk l ll lm">file_name = "#{session}.yml"<br/>File.write(file_name, ERB.new(File.read('template.erb')).result(binding))</span><span id="2ff2" class="li jq hi ld b fi ln lk l ll lm">puts "Write the config file"<br/>puts "#{Dir.pwd}/#{session}.yml"<br/></span></pre><p id="dce1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我还创建了一个<a class="ae ku" href="https://gitlab.com/azolf/tmuxinator-config-file-generator" rel="noopener ugc nofollow" target="_blank"> Gitlab库</a>，你可以克隆并使用它。愿意的话可以随意交流和扩展。</p></div></div>    
</body>
</html>