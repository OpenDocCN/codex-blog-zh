# åœ¨ Spring Boot ä¿®å¤ä¸@Async çš„ç”Ÿäº§é—®é¢˜

> åŸæ–‡ï¼š<https://medium.com/codex/fixing-production-issue-with-async-in-spring-boot-ab4c148561d1?source=collection_archive---------1----------------------->

![](img/b96cce6d0ebcb32dc1323ac87a3f0eec.png)

å…‹æ—ç‰¹Â·å¸•ç‰¹æ£®åœ¨ [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) ä¸Šæ‹æ‘„çš„ç…§ç‰‡

æˆ‘åœ¨ç”Ÿäº§ä¸­é‡åˆ°äº†è¿™ä¸ªåå¤å‡ºç°çš„é—®é¢˜ï¼Œæˆ‘æƒ³å’Œå¤§å®¶åˆ†äº«ä¸€ä¸‹ã€‚

## å‰æ

æˆ‘ä»¬æœ‰ä¸€ä¸ª web åº”ç”¨ç¨‹åºï¼Œå…¶ä¸­æˆ‘ä»¬ä¸ºç®¡ç†å‘˜æä¾›äº†ç”ŸæˆæŠ¥å‘Šçš„åŠŸèƒ½ã€‚é€šè¿‡ UI ç•Œé¢ï¼Œä»–ä»¬å¯ä»¥å¯¹å®ä½“åº”ç”¨å„ç§è¿‡æ»¤å™¨ï¼Œå¹¶å•å‡» Export CSVã€‚ç‚¹å‡»è¯¥æŒ‰é’®åï¼Œä¼šå‡ºç°ä¸€ä¸ªå¼¹å‡ºçª—å£ï¼Œæ˜¾ç¤ºâ€œ*æ‚¨çš„æŠ¥å‘Šæ­£åœ¨å¤„ç†ä¸­ï¼Œå°†å¾ˆå¿«å‘é€åˆ°æ‚¨çš„é‚®ç®±*â€ã€‚

å®é™…ä¸Šï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªæ§åˆ¶å™¨ï¼Œå®ƒæ¥å—è¯·æ±‚å¹¶å°†å…¶ä¼ é€’ç»™åŒ…è£…åœ¨å¼‚æ­¥å—ä¸‹çš„æœåŠ¡ã€‚å› ä¸ºå®ƒæ˜¯åœ¨åå°å¼‚æ­¥å¤„ç†çš„ï¼Œæ‰€ä»¥æ§åˆ¶å™¨ä¼šç«‹å³è¿”å›å“åº”ã€‚å¤„ç†å®Œæˆåï¼Œå®ƒè°ƒç”¨é€šçŸ¥æœåŠ¡å¹¶å‘é€é™„ä»¶ä¸­åŒ…å«æŠ¥å‘Šçš„é‚®ä»¶ã€‚

**æ§åˆ¶å™¨**

![](img/333cfd56dc79cc6b2e21d588fbb5ac14.png)

ä¼‘æ¯æ§åˆ¶å™¨

**æœåŠ¡**

![](img/4154595d626eea844fd897c8a1241ad0.png)

æœåŠ¡çº§åˆ«

# é—®é¢˜

è¿™ä¸ªæ§åˆ¶å™¨ä¸æ˜¯æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­æœ€å¸¸ç”¨çš„ REST æ§åˆ¶å™¨ä¹‹ä¸€ã€‚å®ƒå¾ˆå°‘è¢«ä½¿ç”¨ï¼Œæ¯”å¦‚æ¯ä¸ªå­£åº¦ 2-3 æ¬¡ã€‚æˆ‘ä»¬åœ¨ 2020 å¹´éƒ¨ç½²äº†è¿™é¡¹æœåŠ¡ï¼Œé‚£ä¸€å¹´æ²¡æœ‰æŠ¥å‘Šä»»ä½•é—®é¢˜ã€‚ä½†æ˜¯åœ¨ç¬¬äºŒå¹´(2021 å¹´)ï¼Œç®¡ç†å‘˜å¼€å§‹æŠ±æ€¨ä»–ä»¬æ²¡æœ‰æ”¶åˆ°é‚®ä»¶æŠ¥å‘Šã€‚å¥‡æ€ªï¼Ÿå®ƒè¿è¡Œäº†ä¸€å¹´ï¼Œä»é‚£ä»¥åæ²¡æœ‰ä»£ç éƒ¨ç½²ï¼Œé‚£ä¹ˆå‘ç”Ÿäº†ä»€ä¹ˆå‘¢ï¼Ÿæˆ‘æ£€æŸ¥äº†æ—¥å¿—ï¼Œå‘ç° HikariCP æ— æ³•è·å¾—æ–°çš„è¿æ¥ï¼Œå¹¶ä¸”åœ¨ç­‰å¾…ä¸€å®šæ—¶é—´åè¶…æ—¶ã€‚

**é”™è¯¯æ—¥å¿—**

![](img/3855f17f5b0f87509b7688b8079c4983.png)

2021 å¹´çš„é”™è¯¯æ—¥å¿—

**HikariCP é…ç½®**

![](img/96b1d0860de2542c74456f0cacaab68f.png)

HikariCP é…ç½®

# å³æ—¶ä¿®å¤

åœ¨æŸ¥çœ‹äº† StackOverflow ä¸Šçš„å¤šä¸ªèµ„æºå¹¶æŸ¥çœ‹äº† [HikariCP å®˜æ–¹æ–‡æ¡£](https://github.com/brettwooldridge/HikariCP#frequently-used)ä¹‹åï¼Œæˆ‘å¢åŠ äº†æœ€å¤§æ± å¤§å°(*è¯¥å€¼å°†ç¡®å®šåˆ°æ•°æ®åº“åç«¯çš„å®é™…è¿æ¥çš„æœ€å¤§æ•°é‡*å’Œè¿æ¥è¶…æ—¶(*è¯¥å±æ€§æ§åˆ¶å®¢æˆ·ç«¯ç­‰å¾…æ± ä¸­è¿æ¥çš„æœ€å¤§æ¯«ç§’æ•°*)å¹¶é‡æ–°å¯åŠ¨äº† podsã€‚ç§ï¼Œé—®é¢˜è§£å†³äº†ã€‚ä¸€å¹´å†…ä¸ä¼šå†æœ‰ç®¡ç†å‘˜æŠ•è¯‰ã€‚

**æ–°çš„ HikariCP é…ç½®**

![](img/c308e1cc92bf65566f8d8f413ef54242.png)

æ–° HikariCP é…ç½®

# é—®é¢˜é‡å¤å‡ºç°

ç°åœ¨æ˜¯ 2022 å¹´ 9 æœˆï¼Œç®¡ç†å‘˜é€šçŸ¥æˆ‘æ²¡æœ‰ç”ŸæˆæŠ¥å‘Šã€‚è¿™å°±æ˜¯æˆ‘è¯•å›¾æ·±å…¥è°ƒè¯•é—®é¢˜çš„æ—¶å€™ã€‚

# è°ƒè¯•é—®é¢˜

è®©æˆ‘ä»¬æ‰“å¼€ HikariCP è°ƒè¯•æ—¥å¿—ï¼Œçœ‹çœ‹åˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆã€‚

> logging . level . com . zax xer . hikari:TRACE
> logging . level . com . zax xer . hikari . hikari config:è°ƒè¯•

è¿™å°†å¼€å§‹å‘å‡ºå¦‚ä¸‹æ‰€ç¤ºçš„æ—¥å¿—:

![](img/2b69f7c5df73dc616d5891897a041b37.png)

HikariCP è°ƒè¯•æ—¥å¿—

å½“æˆ‘ç‚¹å‡»æ§åˆ¶å™¨ä¸€æ¬¡ï¼Œå…‰ CP æ‰“å¼€ä¸€ä¸ªæ•°æ®åº“è¿æ¥ï¼Œæˆ‘å°è¯•ç‚¹å‡»æ§åˆ¶å™¨å¤šæ¬¡ï¼Œçœ‹åˆ°æ´»åŠ¨è¿æ¥æ•°ä¸æ–­å¢åŠ ã€‚æŒç»­ç‚¹å‡»ç›´åˆ°**è¿æ¥ä¸å¯ç”¨ï¼Œè¶…æ—¶é—®é¢˜**å‘ç”Ÿã€‚HikariCP å·²è¾¾åˆ°æœ€å¤§æ± å¤§å°ï¼Œæ— æ³•åˆ›å»ºæ–°è¿æ¥ã€‚

> *æ¸…ç†åç»Ÿè®¡(æ€»æ•°=50ï¼Œæ´»è·ƒ=50ï¼Œç©ºé—²=10ï¼Œç­‰å¾…=0)*

æˆ‘æœŸæœ›åœ¨ä¸€ä¸ªå¼‚æ­¥çº¿ç¨‹å®Œæˆåï¼Œå¦ä¸€ä¸ªå¼‚æ­¥çº¿ç¨‹ä¼šé‡ç”¨ç°æœ‰çš„æ‰“å¼€çš„è¿æ¥è¿›è¡Œå¤„ç†ï¼Œä½†è¿™å¹¶æ²¡æœ‰å‘ç”Ÿã€‚ ***æ¯ä¸ªå¼‚æ­¥çº¿ç¨‹éƒ½ä¿æŒ DB è¿æ¥æ´»åŠ¨ï¼Œå¹¶ä¸”ä¸å°†å…¶è¿”å› HikariCP æ± ä»¥ä¾›é‡ç”¨*** ã€‚å› æ­¤ï¼ŒHikariCP å¿…é¡»å§‹ç»ˆä¸ºæ¯ä¸ªå¼‚æ­¥çº¿ç¨‹æ‰“å¼€ä¸€ä¸ªæ–°çš„è¿æ¥ï¼Œç›´åˆ°è¾¾åˆ°æœ€å¤§æ± å¤§å°é™åˆ¶ï¼Œå¹¶å¼€å§‹æŠ±æ€¨å®ƒæ— æ³•æ‰“å¼€æ–°çš„è¿æ¥ï¼Œå¹¶è¶…æ—¶æœ‰æ•ˆåœ°é˜»æ­¢ä»»ä½•æ–°çš„æŠ¥å‘Šè¯·æ±‚ã€‚

å¤ªæ£’äº†ï¼Œæˆ‘æ‰¾åˆ°é—®é¢˜äº†ã€‚é‚£æ€ä¹ˆä¿®å‘¢ï¼Ÿ

![](img/251e05cec744ea1fb0f37c856cd65634.png)

åœ¨å‡½æ•°ä¸­æ·»åŠ äº†@Transactional

***æ·»åŠ äº†äº‹åŠ¡å—(åªè¯»ï¼Œå› ä¸ºå‡½æ•°ä¸­æ²¡æœ‰æ’å…¥/æ›´æ–°)ã€‚äº‹åŠ¡æ€§åå°ç¡®ä¿ä¸€æ—¦å¤„ç†å®Œæˆï¼ŒDB è¿æ¥å°±è¢«çº¿ç¨‹é‡Šæ”¾ã€‚***

> å¦‚æœä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Œè¯·èŠ±ç‚¹æ—¶é—´ä¸ºæˆ‘é¼“æŒğŸ‘(å¯ä»¥å¤šæ¬¡é¼“æŒ)ï¼Œå…³æ³¨æˆ‘ï¼Œç”šè‡³è¯·æˆ‘å–å’–å•¡[https://www.buymeacoffee.com/abhiandy](https://www.buymeacoffee.com/abhiandy)