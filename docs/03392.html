<html>
<head>
<title>Kubernetes In Google Cloud</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">谷歌云中的Kubernetes</h1>
<blockquote>原文：<a href="https://medium.com/codex/kubernetes-in-google-cloud-f27bb8cc6603?source=collection_archive---------8-----------------------#2021-08-31">https://medium.com/codex/kubernetes-in-google-cloud-f27bb8cc6603?source=collection_archive---------8-----------------------#2021-08-31</a></blockquote><div><div class="dt gx gy gz ha hb"/><div class="hc hd he hf hg"><div class=""/><div class=""><h2 id="2516" class="pw-subtitle-paragraph ig hi hj bd b ih ii ij ik il im in io ip iq ir is it iu iv iw ix dy translated">让我们使用Google的Kubernetes引擎中的Docker运行我们的第一个容器集群。</h2></div><figure class="iz ja jb jc fe jd es et paragraph-image"><div role="button" tabindex="0" class="je jf di jg bf jh"><div class="es et iy"><img src="../Images/490d31f9a4656c74060069b1d4a65adf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_8ZYr7fBFwk3IYXg1l-xvA.png"/></div></div><figcaption class="jk jl eu es et jm jn bd b be z dy translated">多克和GKE</figcaption></figure><blockquote class="jo jp jq"><p id="055e" class="jr js jt ju b jv jw ik jx jy jz in ka kb kc kd ke kf kg kh ki kj kk kl km kn hc bi translated">如果你对如何构建你的第一个容器感兴趣，请访问我正在撰写的云计算系列文章的第一部分:容器化你的第一个应用程序 。</p></blockquote><p id="2592" class="pw-post-body-paragraph jr js hj ju b jv jw ik jx jy jz in ka kp kc kd ke kq kg kh ki kr kk kl km kn hc bi translated">谷歌云提供了许多在云上运行应用程序的方法，但我们讨论的是容器，所以，在这里我将详细阐述<a class="ae ko" href="https://cloud.google.com/kubernetes-engine" rel="noopener ugc nofollow" target="_blank"> Kubernetes引擎(GKE) </a>，尽管还有其他方法来运行容器，如<a class="ae ko" href="https://cloud.google.com/appengine" rel="noopener ugc nofollow" target="_blank"> App Engine灵活环境</a>。</p><h1 id="5c15" class="ks kt hj bd ku kv kw kx ky kz la lb lc ip ld iq le is lf it lg iv lh iw li lj bi translated">什么是Kubernetes？</h1><p id="4384" class="pw-post-body-paragraph jr js hj ju b jv lk ik jx jy ll in ka kp lm kd ke kq ln kh ki kr lo kl km kn hc bi translated">Kubernetes 是一个专注于帮助我们进行容器编排的工具。它简化了部署，同时管理数百个容器，甚至推出新版本，并在遇到困难时回滚。</p><p id="4c7d" class="pw-post-body-paragraph jr js hj ju b jv jw ik jx jy jz in ka kp kc kd ke kq kg kh ki kr kk kl km kn hc bi translated">如果您已经在使用容器打包您的应用程序，那么您可能希望它们以微服务的方式相互独立。这意味着每一个都有自己的功能和不同的需求，这意味着他们需要独立地扩展/缩小规模——可能跨多个主机——最重要的是，他们之间的通信可能是一个要求，Kubernetes可以简化所有这些管理。</p><p id="c19a" class="pw-post-body-paragraph jr js hj ju b jv jw ik jx jy jz in ka kp kc kd ke kq kg kh ki kr kk kl km kn hc bi translated">谷歌的Kubernetes引擎是一个完全托管的Kubernetes集群，由谷歌的计算引擎提供支持。您可以在自己的环境中建立自己的Kubernetes集群，但是之后您必须自己管理/维护它。GKE简单地拿走了大部分劳动力。</p><p id="70e0" class="pw-post-body-paragraph jr js hj ju b jv jw ik jx jy jz in ka kp kc kd ke kq kg kh ki kr kk kl km kn hc bi translated">对于开发，Docker桌面应用程序自带了Kubernetes。虽然我不打算在这里讨论这个问题，但我认为值得一试。</p><h1 id="09cd" class="ks kt hj bd ku kv kw kx ky kz la lb lc ip ld iq le is lf it lg iv lh iw li lj bi translated"><strong class="ak">要求</strong></h1><ul class=""><li id="5006" class="lp lq hj ju b jv lk jy ll kp lr kq ls kr lt kn lu lv lw lx bi translated"><a class="ae ko" href="https://cloud.google.com/apigee/docs/hybrid/v1.3/precog-gcpaccount" rel="noopener ugc nofollow" target="_blank">谷歌云账户</a></li></ul><blockquote class="jo jp jq"><p id="4af4" class="jr js jt ju b jv jw ik jx jy jz in ka kb kc kd ke kf kg kh ki kj kk kl km kn hc bi translated">不用说，在你自己的GCP遵循这个教程，可能会招致费用。有一个免费层，所以，你可能会被覆盖，如果你只是跟着走。<a class="ae ko" href="https://cloud.google.com/kubernetes-engine/pricing#cluster_management_fee_and_free_tier" rel="noopener ugc nofollow" target="_blank"> GKE定价</a>。</p></blockquote><p id="3057" class="pw-post-body-paragraph jr js hj ju b jv jw ik jx jy jz in ka kp kc kd ke kq kg kh ki kr kk kl km kn hc bi translated">考虑到为容器开发时开箱即用的可移植性，无需太多努力，您就可以准备好在云上运行应用程序，并预先知道它将如何运行。对于这个例子，我将使用在本系列的第1部分中创建的容器。</p><p id="6cc5" class="pw-post-body-paragraph jr js hj ju b jv jw ik jx jy jz in ka kp kc kd ke kq kg kh ki kr kk kl km kn hc bi translated">出于安全原因，许多谷歌云服务都被禁用了。确保通过转至<strong class="ju hk">API&amp;服务</strong>启用它们，如果它们被禁用，则通过<strong class="ju hk">启用</strong>它们:</p><ul class=""><li id="f556" class="lp lq hj ju b jv jw jy jz kp ly kq lz kr ma kn lu lv lw lx bi translated">Kubernetes引擎API</li><li id="ceda" class="lp lq hj ju b jv mb jy mc kp md kq me kr mf kn lu lv lw lx bi translated">容器注册API</li></ul><h1 id="3d5b" class="ks kt hj bd ku kv kw kx ky kz la lb lc ip ld iq le is lf it lg iv lh iw li lj bi translated">让我们兜一圈</h1><p id="1d95" class="pw-post-body-paragraph jr js hj ju b jv lk ik jx jy ll in ka kp lm kd ke kq ln kh ki kr lo kl km kn hc bi translated">现在，使用您的<a class="ae ko" href="https://cloud.google.com/shell" rel="noopener ugc nofollow" target="_blank">云外壳</a>，Google允许您使用<a class="ae ko" href="https://cloud.google.com/sdk/gcloud" rel="noopener ugc nofollow" target="_blank"> gcloud </a>命令以一种相当简单的方式创建容器集群。</p><figure class="iz ja jb jc fe jd es et paragraph-image"><div role="button" tabindex="0" class="je jf di jg bf jh"><div class="es et mg"><img src="../Images/3b2a0a795c206873f4058ce32f21310e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JRvdHMTiH4hqXJ278ANCEQ.png"/></div></div></figure><p id="3c59" class="pw-post-body-paragraph jr js hj ju b jv jw ik jx jy jz in ka kp kc kd ke kq kg kh ki kr kk kl km kn hc bi translated">首先，让我们请求google创建一个集群Kubernetes可以在其中调度工作负载的一组机器——有两个节点:</p><pre class="iz ja jb jc fe mh mi mj mk aw ml bi"><span id="d40d" class="mm kt hj mi b fj mn mo l mp mq">$&gt; gcloud container clusters create mykotlinapicluster --zone europe-west3-a --num-nodes 2</span></pre><p id="fcdf" class="pw-post-body-paragraph jr js hj ju b jv jw ik jx jy jz in ka kp kc kd ke kq kg kh ki kr kk kl km kn hc bi translated">这将创建一个Kubernetes <strong class="ju hk"> </strong>集群，在德国法兰克福有两个节点。您可以在您的<code class="dv mr ms mt mi b">VM Instances List</code>中找到您的节点，或者通过运行:</p><pre class="iz ja jb jc fe mh mi mj mk aw ml bi"><span id="769b" class="mm kt hj mi b fj mn mo l mp mq">$&gt; gcloud compute instances list</span></pre><figure class="iz ja jb jc fe jd es et paragraph-image"><div role="button" tabindex="0" class="je jf di jg bf jh"><div class="es et mu"><img src="../Images/86c09e31a052053034f2141c48aaff19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zJzqSuym0QEloE6GkobPwQ.png"/></div></div><figcaption class="jk jl eu es et jm jn bd b be z dy translated">集群创建命令中指定的2个计算实例。</figcaption></figure><p id="7ec3" class="pw-post-body-paragraph jr js hj ju b jv jw ik jx jy jz in ka kp kc kd ke kq kg kh ki kr kk kl km kn hc bi translated"><code class="dv mr ms mt mi b">clusters create</code>命令自动配置Kubernetes控制命令<code class="dv mr ms mt mi b">kubectl</code>,让您使用新创建的集群。要检查Kubernetes是否正常工作:</p><pre class="iz ja jb jc fe mh mi mj mk aw ml bi"><span id="9f20" class="mm kt hj mi b fj mn mo l mp mq">$&gt; <!-- -->kubectl version</span></pre><p id="5eb0" class="pw-post-body-paragraph jr js hj ju b jv jw ik jx jy jz in ka kp kc kd ke kq kg kh ki kr kk kl km kn hc bi translated">如果<code class="dv mr ms mt mi b">kubectl</code>命令按预期运行，那么您可以继续配置GKE来运行容器化的应用程序。</p></div><div class="ab cl mv mw gq mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="hc hd he hf hg"><p id="782d" class="pw-post-body-paragraph jr js hj ju b jv jw ik jx jy jz in ka kp kc kd ke kq kg kh ki kr kk kl km kn hc bi translated">我<a class="ae ko" href="https://docs.docker.com/engine/reference/commandline/push/" rel="noopener ugc nofollow" target="_blank">在<a class="ae ko" href="https://hub.docker.com/r/escoto/kotlinresthello" rel="noopener ugc nofollow" target="_blank"> DockerHub </a>发布了<a class="ae ko" rel="noopener" href="/codex/containerizing-your-application-b1644385e2ef"> Part 1 </a>中的app</a>让一切变得更简单。让我们告诉GKE创建该容器的部署:</p><pre class="iz ja jb jc fe mh mi mj mk aw ml bi"><span id="516c" class="mm kt hj mi b fj mn mo l mp mq">$&gt; <!-- -->kubectl create deploy kotlinresthello --image=escoto/kotlinresthello</span></pre><p id="ef13" class="pw-post-body-paragraph jr js hj ju b jv jw ik jx jy jz in ka kp kc kd ke kq kg kh ki kr kk kl km kn hc bi translated">这应该很快，你应该能看到一个<a class="ae ko" href="https://kubernetes.io/docs/concepts/workloads/pods/" rel="noopener ugc nofollow" target="_blank">吊舱</a>在几秒钟内运行:</p><pre class="iz ja jb jc fe mh mi mj mk aw ml bi"><span id="1aba" class="mm kt hj mi b fj mn mo l mp mq">$&gt; kubectl get pods</span></pre><figure class="iz ja jb jc fe jd es et paragraph-image"><div role="button" tabindex="0" class="je jf di jg bf jh"><div class="es et nc"><img src="../Images/c6e96f67b08ec5ce6ec26f4368a077f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sS6B_zMtqSGRd24Bdjjlkw.png"/></div></div></figure><p id="7004" class="pw-post-body-paragraph jr js hj ju b jv jw ik jx jy jz in ka kp kc kd ke kq kg kh ki kr kk kl km kn hc bi translated">随着我们的pod运行，让我们告诉Kubernetes向世界公开它，并检索公共IP:</p><pre class="iz ja jb jc fe mh mi mj mk aw ml bi"><span id="020b" class="mm kt hj mi b fj mn mo l mp mq">$&gt; <!-- -->kubectl expose deployment kotlinresthello --port 8080 --type LoadBalancer<br/>$&gt; kubectl get services</span></pre><figure class="iz ja jb jc fe jd es et paragraph-image"><div role="button" tabindex="0" class="je jf di jg bf jh"><div class="es et nd"><img src="../Images/b4dd90e34959563a343d9efc64465025.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I7R3iwqf3l1wKBVpqTD0QQ.png"/></div></div><figcaption class="jk jl eu es et jm jn bd b be z dy translated">这是一个为点播生成的随机IP——我将在随后击落它，所以，不要指望我的服务在你读到这篇文章时已经上线。</figcaption></figure><p id="8d90" class="pw-post-body-paragraph jr js hj ju b jv jw ik jx jy jz in ka kp kc kd ke kq kg kh ki kr kk kl km kn hc bi translated">将公共IP复制粘贴到浏览器中，并指定要通过打开的<code class="dv mr ms mt mi b">8080</code>端口访问:</p><figure class="iz ja jb jc fe jd es et paragraph-image"><div role="button" tabindex="0" class="je jf di jg bf jh"><div class="es et ne"><img src="../Images/5f4761740bde790c1b4778d7ce79cf2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KIqSIgI446zwrBgS_DX3eg.png"/></div></div></figure><p id="01a6" class="pw-post-body-paragraph jr js hj ju b jv jw ik jx jy jz in ka kp kc kd ke kq kg kh ki kr kk kl km kn hc bi translated">从这里，我们可以开始手动放大/缩小我们的应用程序:</p><pre class="iz ja jb jc fe mh mi mj mk aw ml bi"><span id="fc06" class="mm kt hj mi b fj mn mo l mp mq">$&gt; kubectl scale deployment kotlinresthello --replicas 3<br/>$&gt; <!-- -->kubectl get pods</span></pre><figure class="iz ja jb jc fe jd es et paragraph-image"><div role="button" tabindex="0" class="je jf di jg bf jh"><div class="es et nf"><img src="../Images/90eafe1f73ca8608ec4d63a9136b2d8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AgejItjiTdIxMtODtUKk8g.png"/></div></div><figcaption class="jk jl eu es et jm jn bd b be z dy translated">如果我们列出pod，您可以看到第一个创建的pod和2个新创建的pod。</figcaption></figure><p id="42b8" class="pw-post-body-paragraph jr js hj ju b jv jw ik jx jy jz in ka kp kc kd ke kq kg kh ki kr kk kl km kn hc bi translated">现在，让我们清洁我们的环境:</p><pre class="iz ja jb jc fe mh mi mj mk aw ml bi"><span id="2a22" class="mm kt hj mi b fj mn mo l mp mq">$&gt; <!-- -->gcloud container clusters delete <!-- -->mykotlinapicluster --zone europe-west3-a</span></pre><h1 id="ec9d" class="ks kt hj bd ku kv kw kx ky kz la lb lc ip ld iq le is lf it lg iv lh iw li lj bi translated">结论</h1><p id="40c1" class="pw-post-body-paragraph jr js hj ju b jv lk ik jx jy ll in ka kp lm kd ke kq ln kh ki kr lo kl km kn hc bi translated">Kubernetes提供了更多的特性，这只是对该工具的一个简单介绍。对于本教程，我遵循“命令式”方法，但是当你采用“<a class="ae ko" href="https://kubernetes.io/docs/tasks/manage-kubernetes-objects/declarative-config/" rel="noopener ugc nofollow" target="_blank">声明式</a>”方法时，它开始发光，告诉Kubernetes你想要什么，然后让工具为你完成。</p></div></div>    
</body>
</html>