<html>
<head>
<title>Creating a simple Stock Screener in minutes with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python在几分钟内创建一个简单的股票筛选程序</h1>
<blockquote>原文：<a href="https://medium.com/codex/creating-a-simple-stock-screener-in-minutes-with-python-68c888d2fbf0?source=collection_archive---------0-----------------------#2021-11-10">https://medium.com/codex/creating-a-simple-stock-screener-in-minutes-with-python-68c888d2fbf0?source=collection_archive---------0-----------------------#2021-11-10</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="d98a" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">学习用不到10行代码构建您的自定义股票筛选程序</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/7d0babe7c61abcb2978aa3b472ed9596.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*rq7w1Bhw63ZInoDg"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">约书亚·阿拉贡在<a class="ae jn" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="53ff" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">股票筛选是一个伟大的方式来排序和过滤数以千计的股票一次根据你的需要，但有些人可能会觉得很难从头编码。这时候<a class="ae jn" href="https://eodhistoricaldata.com/?utm_source=medium&amp;utm_medium=post&amp;utm_campaign=extracting_financial_news_seamlessly_using_python" rel="noopener ugc nofollow" target="_blank"> <strong class="jq hj"> EOD史料</strong> </a>来救场了。我们大多数人都熟悉用于历史数据、实时数据和日内数据的股票API，但EOD历史数据公司通过提供股票筛选API改变了游戏规则，使初学者易于入门并使用Python创建基本的股票筛选程序。</p><p id="9287" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在本文中，我将带您浏览由EOD历史提供的股票筛选API，并帮助您利用这些API来创建您想要的自定义股票筛选。不浪费更多的时间，让我们做一些编码！</p><blockquote class="kk kl km"><p id="ca4b" class="jo jp kn jq b jr js ij jt ju jv im jw ko jy jz ka kp kc kd ke kq kg kh ki kj hb bi translated"><strong class="jq hj">注</strong>:本文强烈基于<a class="ae jn" href="https://eodhistoricaldata.com/?utm_source=medium&amp;utm_medium=post&amp;utm_campaign=extracting_financial_news_seamlessly_using_python" rel="noopener ugc nofollow" target="_blank"> EOD史料</a>提供的API。因此，为了顺利地跟进即将到来的内容，请确保您拥有自己的帐户，因为它使您能够访问您的私有API密钥。您可以使用此处 的<a class="ae jn" href="https://eodhistoricaldata.com/register?utm_source=medium&amp;utm_medium=post&amp;utm_campaign=extracting_financial_news_seamlessly_using_python" rel="noopener ugc nofollow" target="_blank"> <strong class="jq hj">链接创建账户。此外，并非本文中提到的所有API都是免费提供的，但需要订阅。点击</strong> </a>查看所有套餐的价格，并选择最适合您的套餐。</p></blockquote><h1 id="2ce3" class="kr ks hi bd kt ku kv kw kx ky kz la lb io lc ip ld ir le is lf iu lg iv lh li bi translated">一个简单的Python股票筛选程序</h1><h2 id="a13a" class="lj ks hi bd kt lk ll lm kx ln lo lp lb jx lq lr ld kb ls lt lf kf lu lv lh lw bi translated">1.导入包</h2><p id="f4e7" class="pw-post-body-paragraph jo jp hi jq b jr lx ij jt ju ly im jw jx lz jz ka kb ma kd ke kf mb kh ki kj hb bi translated">让我们首先将所需的包导入到我们的python环境中，因为这是任何编程项目中最重要的过程。本文中我们需要的唯一包是进行API调用的请求和用于数据处理和操作的Pandas。如果您尚未安装这两个软件包，请在命令行中输入以下代码行:</p><pre class="iy iz ja jb fd mc md me mf aw mg bi"><span id="fb5f" class="lj ks hi md b fi mh mi l mj mk">pip install pandas<br/>pip install requests</span></pre><p id="829a" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">安装完包后，我们现在可以使用下面的代码将它们导入到我们的python环境中:</p><pre class="iy iz ja jb fd mc md me mf aw mg bi"><span id="da45" class="lj ks hi md b fi mh mi l mj mk">import pandas as pd<br/>import requests<br/><br/>api_key = 'YOUR API KEY'</span></pre><p id="848b" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">现在，我们已经成功地将基本包导入到我们的环境中，并将API键存储到<code class="du ml mm mn md b">api_key</code>变量中。</p><h2 id="7220" class="lj ks hi bd kt lk ll lm kx ln lo lp lb jx lq lr ld kb ls lt lf kf lu lv lh lw bi translated">2.带单个过滤器的基本筛分机</h2><p id="ebd1" class="pw-post-body-paragraph jo jp hi jq b jr lx ij jt ju ly im jw jx lz jz ka kb ma kd ke kf mb kh ki kj hb bi translated">我们现在将创建一个只有一个条件或过滤器的股票筛选程序。根据我们的条件，筛选者代表市值超过1000亿美元的股票。使用下面的代码，我们可以很容易地根据上述条件创建一个筛选程序:</p><pre class="iy iz ja jb fd mc md me mf aw mg bi"><span id="13c5" class="lj ks hi md b fi mh mi l mj mk"># SINGLE FILTER<br/><br/>mktcap_url = f'https://eodhistoricaldata.com/api/screener?api_token={api_key}&amp;sort=market_capitalization.desc&amp;filters=[["market_capitalization","&gt;",100000000000]]&amp;limit=10'<br/>mktcap = requests.get(mktcap_url).json()<br/><br/>mktcap_df = pd.DataFrame(mktcap['data']).drop(<br/>    [<br/>        'sector', 'industry','refund_1d', <br/>        'refund_1d_p','refund_5d', 'refund_5d_p'<br/>    ], axis = 1)<br/><br/>mktcap_df</span></pre><p id="278b" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在上面的代码中，我们首先将API URL存储到<code class="du ml mm mn md b">mktcap_url</code>变量中。在继续之前，我们需要理解API URL的结构和它所包含的参数。以下是网址:</p><pre class="iy iz ja jb fd mc md me mf aw mg bi"><span id="8f67" class="lj ks hi md b fi mh mi l mj mk">https://eodhistoricaldata.com/api/screener?api_token={api_key}&amp;filters=[["market_capitalization","&gt;",100000000000]]&amp;limit=10</span></pre><p id="0ddc" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">所以第一个参数是<code class="du ml mm mn md b">api_token</code>,我们必须在这里输入我们的API密钥。下一个参数是<code class="du ml mm mn md b">sort</code>，我们可以对选择字段的数量进行升序或降序排序。接下来，我们有一个<code class="du ml mm mn md b">filters</code>参数，用于输入筛选条件。最后，还有<code class="du ml mm mn md b">limit</code>参数，在这个参数中我们必须指定我们想要输出的股票数量(在我们的例子中是10)。尽管这些参数是主要参数，但仍有许多附加参数可用于更具体的筛分机。</p><p id="4443" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">回到我们的代码，在保存API URL之后，我们使用Requests包提供的<code class="du ml mm mn md b">get</code>函数进行API调用，并将JSON格式的API响应存储到<code class="du ml mm mn md b">mktcap</code>变量中。为了让数据更有意义，我们将API响应转换成Pandas数据帧，然后删除一些不需要的列。最终结果是一个股票筛选程序，其中包含市值超过1000亿美元的前10只股票，如下所示:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mo"><img src="../Images/1f826a8c1d5381c08d45f22eab863887.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-RZFZaXQGyWsa65flnrFMw.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">作者图片</figcaption></figure><h2 id="e19c" class="lj ks hi bd kt lk ll lm kx ln lo lp lb jx lq lr ld kb ls lt lf kf lu lv lh lw bi translated">3.具有多个过滤器的股票筛分机</h2><p id="0220" class="pw-post-body-paragraph jo jp hi jq b jr lx ij jt ju ly im jw jx lz jz ka kb ma kd ke kf mb kh ki kj hb bi translated">现在，为了让我们的项目更上一层楼，我们将在筛选程序中再添加三个条件。这些条件是:</p><pre class="iy iz ja jb fd mc md me mf aw mg bi"><span id="779e" class="lj ks hi md b fi mh mi l mj mk"><strong class="md hj">MARKET CAPITALIZATION &gt; 100 BILLION USD<br/>EXCHANGE = UNITED STATES<br/>SECTOR = TECHNOLOGY<br/>EARNINGS PER SHARE &gt; 5</strong></span></pre><p id="752f" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我们在这一部分的目标是构建一个股票筛选工具，根据上述条件过滤股票。这个筛选程序的代码或多或少与前一个筛选程序相同，尽管它有几个其他条件，如下所示:</p><pre class="iy iz ja jb fd mc md me mf aw mg bi"><span id="1105" class="lj ks hi md b fi mh mi l mj mk"># MULTIPLE FILTERS<br/><br/>mf_url = f'https://eodhistoricaldata.com/api/screener?api_token={api_key}&amp;sort=market_capitalization.desc&amp;filters=[["market_capitalization","&gt;",100000000000],["exchange","=","us"],["sector","=","Technology"],["earnings_share","&gt;",5]]&amp;limit=10'<br/>mf = requests.get(mf_url).json()<br/><br/>mf_df = pd.DataFrame(mf['data']).drop(<br/>    [<br/>        'currency_symbol', 'refund_1d', <br/>        'refund_1d_p','refund_5d', 'refund_5d_p', 'industry'<br/>    ], axis = 1)<br/><br/>mf_df</span></pre><p id="db79" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">正如我之前说过的，代码中发生的一切都与之前的‘screener’代码非常相似，但唯一略有变化的地方是API URL中的<code class="du ml mm mn md b">filters</code>参数。我们已经在那个参数中指定了我们所有的四个条件，而在前一节的代码中只提到了一个。否则，一切都是一样的。上述代码的输出是一个股票筛选程序，它根据四个指定的过滤器表示前10只股票，如下所示:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mp"><img src="../Images/b3a7f00d6b3cc1806ea3e49174397a83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HB7gUt2IWfn4CP-o5txvmg.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">作者图片</figcaption></figure><h1 id="c6f6" class="kr ks hi bd kt ku kv kw kx ky kz la lb io lc ip ld ir le is lf iu lg iv lh li bi translated">最后的想法！</h1><p id="1a4a" class="pw-post-body-paragraph jo jp hi jq b jr lx ij jt ju ly im jw jx lz jz ka kb ma kd ke kf mb kh ki kj hb bi translated">在本文中，我们学习了使用EOD历史数据的API创建两种基本的股票筛选程序，您会注意到它甚至没有超过15行代码。</p><p id="b19c" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">他们的screener APIs还有很多需要实验的地方，例如，我们在这篇文章中粗略地提到了四个过滤器，但是总共有将近十个过滤器可以用来创建完美的screener。</p><p id="400e" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">除了过滤器之外，还有另一个有趣的参数，即信号参数，它可用于查看达到新的50天高点、200天高点、负账面价值和许多更有趣的值的股票。在本文中，我们没有实际查阅这个概念，但是值得花些时间。</p><p id="fd60" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">虽然这些API可能不太适合高级用户或专业人员，因为他们更喜欢自定义过滤器，但它非常适合初学者，并获得一些基本的概念。希望你能从这篇文章中学到一些新的有用的东西。</p></div></div>    
</body>
</html>