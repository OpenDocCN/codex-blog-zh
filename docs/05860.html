<html>
<head>
<title>JavaScript diagram editor that renders diagrams from PNG images (open source)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从PNG图像呈现图表的JavaScript图表编辑器(开源)</h1>
<blockquote>原文：<a href="https://medium.com/codex/javascript-diagram-editor-that-renders-diagrams-from-png-images-open-source-d1de0f053088?source=collection_archive---------20-----------------------#2022-03-31">https://medium.com/codex/javascript-diagram-editor-that-renders-diagrams-from-png-images-open-source-d1de0f053088?source=collection_archive---------20-----------------------#2022-03-31</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/fef1e2ddfd0e601f723832044c2ccccc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*ByAACIYNrX8Hsgad0C0-rg.gif"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">图一。dgrm.net可以从PNG图像打开图表</figcaption></figure><p id="7389" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><a class="ae js" href="https://dgrm.net/" rel="noopener ugc nofollow" target="_blank">dgrm.net</a>|<a class="ae js" href="https://github.com/AlexeyBoiko/DgrmJS" rel="noopener ugc nofollow" target="_blank">GitHub</a></p><p id="c385" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><a class="ae js" rel="noopener" href="/codex/javascript-svg-diagram-editor-which-weighs-6-5-less-than-bootstrap-open-source-library-b753feaaf835"> &lt; &lt;上一篇</a></p><p id="a4b3" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">dgrm.net——是一个图表编辑器，着眼于转换成知识地图工具。</p><p id="a18d" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">独特的功能:</p><ul class=""><li id="6937" class="jt ju hi iw b ix iy jb jc jf jv jj jw jn jx jr jy jz ka kb bi translated">禁欲主义，</li><li id="a9b0" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr jy jz ka kb bi translated">在手机上工作，</li><li id="0cdc" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr jy jz ka kb bi translated">开源。</li></ul><p id="3883" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在开发过程中，有趣的时刻出现了。今天我们将谈论从PNG读取数据。附上您的项目中使用的源代码。</p><h1 id="0d78" class="kh ki hi bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">为什么从PNG图像打开图表？</h1><p id="1684" class="pw-post-body-paragraph iu iv hi iw b ix lf iz ja jb lg jd je jf lh jh ji jj li jl jm jn lj jp jq jr hb bi translated">开发人员制作的用户界面因怪异而臭名昭著。也许使用图像作为项目文件的想法就是如此。至少方法是原创的。</p><p id="48e2" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">所有编辑器都使用自己的项目文件。但这是不方便的:</p><ul class=""><li id="157f" class="jt ju hi iw b ix iy jb jc jf jv jj jw jn jx jr jy jz ka kb bi translated">没有预览，</li><li id="743d" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr jy jz ka kb bi translated">发送图像时，还必须发送来源。</li></ul><p id="7e39" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">有图更方便，需要的话可以编辑。</p><p id="27ec" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">查看图1，我们可以假设正在使用隐写术或图像识别。它实际上要简单得多，而且没有漏洞PNG格式支持存储附加信息，比如时间戳、作者姓名或任何其他信息。</p><p id="57e1" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">dgrm.net将带有图表数据的JSON写入png文件。</p><h1 id="5ded" class="kh ki hi bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">PNG块</h1><p id="1dfb" class="pw-post-body-paragraph iu iv hi iw b ix lf iz ja jb lg jd je jf lh jh ji jj li jl jm jn lj jp jq jr hb bi translated">下面是PNG规范:“<a class="ae js" href="https://www.w3.org/TR/PNG/" rel="noopener ugc nofollow" target="_blank">便携式网络图形(PNG)规范</a>”。</p><p id="946f" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">突出显示:</p><ul class=""><li id="ed27" class="jt ju hi iw b ix iy jb jc jf jv jj jw jn jx jr jy jz ka kb bi translated">png文件由称为块的块组成，</li><li id="bb4c" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr jy jz ka kb bi translated">您可以将自己的块添加到文件中。</li></ul><figure class="ll lm ln lo fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lk"><img src="../Images/8b293ab384d865693e348fbb6a255540.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9qgXxZWTw8AifJU4FKjlxg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">图二。一个PNG块的结构</figcaption></figure><p id="1a58" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">对于自定义数据，您可以考虑任何块名(例如“dgRm”):</p><ul class=""><li id="1b54" class="jt ju hi iw b ix iy jb jc jf jv jj jw jn jx jr jy jz ka kb bi translated">名称长度严格为4个拉丁字母；</li><li id="7d61" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr jy jz ka kb bi translated">字母大小写很重要。对于自定义块，将所有字母小写，第三个大写。</li></ul><p id="adc8" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">因此，要在PNG文件中存储JSON字符串，您需要向文件中添加自己的块。</p><h1 id="8c11" class="kh ki hi bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">在浏览器中用JavaScript读/写PNG块</h1><h2 id="9252" class="lp ki hi bd kj lq lr ls kn lt lu lv kr jf lw lx kv jj ly lz kz jn ma mb ld mc bi translated">读一大块</h2><p id="a1ca" class="pw-post-body-paragraph iu iv hi iw b ix lf iz ja jb lg jd je jf lh jh ji jj li jl jm jn lj jp jq jr hb bi translated">块彼此跟随，通过枚举来搜索所需的块。</p><p id="a07b" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">块搜索算法(清单1):</p><ol class=""><li id="26a0" class="jt ju hi iw b ix iy jb jc jf jv jj jw jn jx jr md jz ka kb bi translated">取第一个块的名称</li><li id="52a0" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr md jz ka kb bi translated">如果名称与搜索项不匹配<br/> -获取块的长度(前4个字节见图2) <br/> -知道块的长度，将光标移动到下一个块的开头</li><li id="4eee" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr md jz ka kb bi translated">重复1和2，直到我们找到想要的块或“IEND”(文件结尾)。</li></ol><pre class="ll lm ln lo fd me mf mg mh aw mi bi"><span id="d8fe" class="lp ki hi mf b fi mj mk l ml mm">/**<br/> * <a class="ae js" href="http://twitter.com/param" rel="noopener ugc nofollow" target="_blank">@param</a> {ArrayBuffer} pngData<br/> * <a class="ae js" href="http://twitter.com/param" rel="noopener ugc nofollow" target="_blank">@param</a> {number} chunkNameUint32 chunk name as Uint32<br/> * <a class="ae js" href="http://twitter.com/returns" rel="noopener ugc nofollow" target="_blank">@returns</a> {DataView | null} chunk data<br/> */<br/>function chunkGet(pngData, chunkNameUint32) {<br/>    const dataView = new DataView(pngData, 8);<br/>        // 8 byte — png signature<br/> <br/>    let chunkPosition = 0;<br/>    let chunkUint = dataView.getUint32(4);<br/>    let chunkLenght;<br/>    while (chunkUint !== 1229278788) { // last chunk ‘IEND’<br/>        chunkLenght = dataView.getUint32(chunkPosition);<br/>        if (chunkUint === chunkNameUint32) {<br/>            return new DataView(pngData, chunkPosition + 16, <br/>                chunkLenght);<br/>        }<br/>        chunkPosition = chunkPosition + 12 + chunkLenght;<br/>        chunkUint = dataView.getUint32(chunkPosition + 4);<br/>    }<br/>    return null;<br/>}</span></pre><p id="9917" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><em class="mn">清单1。组块查找功能</em></p><blockquote class="mo mp mq"><p id="ac05" class="iu iv mn iw b ix iy iz ja jb jc jd je mr jg jh ji ms jk jl jm mt jo jp jq jr hb bi translated">Q <strong class="iw hj"> uick参考:<br/> </strong> JavaScript处理二进制数据的方式很有趣。</p><p id="6b87" class="iu iv mn iw b ix iy iz ja jb jc jd je mr jg jh ji ms jk jl jm mt jo jp jq jr hb bi translated">ArrayBuffer对象用于表示一个通用的、固定长度的原始二进制数据缓冲区。… <br/>你不能直接操作一个数组缓冲区的内容<br/><a class="ae js" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer" rel="noopener ugc nofollow" target="_blank">developer.mozilla.org</a></p><p id="35a4" class="iu iv mn iw b ix iy iz ja jb jc jd je mr jg jh ji ms jk jl jm mt jo jp jq jr hb bi translated">要读取数据，您可以将其包装在一个<a class="ae js" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/DataView" rel="noopener ugc nofollow" target="_blank">数据视图</a>中。DataView允许您以数字形式读取任何位置的数据(使用getInt8()、getUint32()方法等)。).</p></blockquote><h1 id="ecb0" class="kh ki hi bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">写一大块</h1><p id="6453" class="pw-post-body-paragraph iu iv hi iw b ix lf iz ja jb lg jd je jf lh jh ji jj li jl jm jn lj jp jq jr hb bi translated">要写一个块，你需要在链中插入一个新的块。如果具有给定名称的块已经存在，则必须替换它。</p><p id="c16f" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">参见<a class="ae js" href="https://github.com/AlexeyBoiko/DgrmJS/blob/main/src/diagram-extensions/infrastructure/png-chunk-utils.js" rel="noopener ugc nofollow" target="_blank"> GitHub上的实现chunkSet函数</a>。</p><h1 id="e957" class="kh ki hi bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">源代码</h1><p id="a29d" class="pw-post-body-paragraph iu iv hi iw b ix lf iz ja jb lg jd je jf lh jh ji jj li jl jm jn lj jp jq jr hb bi translated">处理PNG块的函数位于一个文件中。该文件没有依赖项，所以您可以简单地将它复制到您的项目中。</p><p id="5c77" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><a class="ae js" href="https://github.com/AlexeyBoiko/DgrmJS/blob/main/src/diagram-extensions/infrastructure/png-chunk-utils.js" rel="noopener ugc nofollow" target="_blank"> png-chunk-utils.js </a></p><p id="1ae9" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">使用示例:</p><pre class="ll lm ln lo fd me mf mg mh aw mi bi"><span id="cbe2" class="lp ki hi mf b fi mj mk l ml mm">// Write a chunk, new blob output<br/>const newPngBlob = await pngChunkSet(<br/>    // png-image<br/>    pngBlob,<br/>    // chunk name<br/>    'dgRm',<br/>    // chunk value: string as a bytes<br/>    new TextEncoder().encode('...'));<br/> <br/> <br/>// read a chuk<br/>const dgrmChunkVal = await pngChunkGet(newPngBlob, 'dgRm');<br/>const str = new TextDecoder().decode(dgrmChunkVal);</span></pre><p id="053d" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><em class="mn">清单2。调用函数来读写PNG块</em></p><h1 id="72b8" class="kh ki hi bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">如何支持该项目</h1><ul class=""><li id="f26a" class="jt ju hi iw b ix lf jb lg jf mu jj mv jn mw jr jy jz ka kb bi translated">开始使用，告诉我们你的想法。<br/>任何方式:评论，私信，在<a class="ae js" href="https://github.com/AlexeyBoiko/DgrmJS" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上。我什么都读，我有一份提案清单。</li><li id="7dbd" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr jy jz ka kb bi translated">告诉你的朋友。</li><li id="a7cc" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr jy jz ka kb bi translated">在<a class="ae js" href="https://github.com/AlexeyBoiko/DgrmJS" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上放星星。</li></ul></div></div>    
</body>
</html>