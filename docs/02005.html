<html>
<head>
<title>Understanding Deployment Slots in Azure App Services</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">了解Azure应用服务中的部署插槽</h1>
<blockquote>原文：<a href="https://medium.com/codex/understanding-deployment-slots-in-azure-app-services-7c88a3e19e2f?source=collection_archive---------5-----------------------#2021-06-22">https://medium.com/codex/understanding-deployment-slots-in-azure-app-services-7c88a3e19e2f?source=collection_archive---------5-----------------------#2021-06-22</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/e57f234b9b179605cb958341caafe840.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L80OZxigEpDO8RqojOtKDQ.jpeg"/></div></div></figure><p id="e6f4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Azure应用服务对开发者来说是天赐良机。这主要归功于它附带的一系列特性，使开发人员的生活变得轻而易举。</p><p id="5386" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一些最受欢迎的功能包括自动缩放、轻松认证、离线同步(针对移动应用程序)、混合连接等等。</p><p id="f31b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这些应用共有的一个特性，也可能是所有特性中最被低估的一个，就是Azure部署槽。</p><p id="496f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这篇文章中，我们将了解什么是Azure部署插槽，以及为什么我们认为它是Azure推出的最佳功能之一。</p><p id="c8d0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">目录</strong></p><ol class=""><li id="9cbd" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn jt ju jv jw bi translated">简要背景</li><li id="5774" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">什么是Azure部署插槽？</li><li id="d27e" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">为什么选择部署插槽？</li><li id="1970" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">Azure服务部署插槽的工作方式</li><li id="97c8" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">Azure服务部署槽的实际应用</li><li id="7ccd" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">结论</li></ol><h1 id="c0d4" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">简要背景</h1><p id="e187" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">这是一个在开发世界中非常常见的场景——开发人员在执行测试和其他杂七杂八的过程之后，将应用程序推向生产阶段。然后，用户可以通过端点访问网站，主要是通过域名(例如— <a class="ae lf" href="http://www.application.com)." rel="noopener ugc nofollow" target="_blank"> www.application.com)。</a></p><p id="51ab" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，如果我们必须发布同一个应用程序的下一个版本，那么我们必须首先将最新的解决方案推送到一个试运行环境中，并注意环境设置。换句话说，必须在相同的设置中手动实现生产环境的精确复制。这是一项非常耗时的工作。</p><p id="6c23" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">发布管理中的另一个主要问题是回滚。如果最新版本有问题或错误，就需要手动回滚到以前的版本，这又是一项艰巨的任务。您必须恢复设置和环境——所有这些对开发人员来说都是非常困难的。发布期间回滚和更新的最大问题是用户在这段时间内无法使用应用程序，从而导致停机。</p><p id="dee7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这就是Azure部署插槽发挥作用的地方，在应用程序发布期间，它将您从复杂性和不必要的问题中解救出来。</p><h1 id="7ec9" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">什么是Azure部署插槽？</h1><p id="3bfa" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">Azure部署插槽允许您的web应用在称为插槽的不同实例中运行。插槽是通过公共可用端点访问的不同环境。一个应用程序实例总是被分配给生产插槽，您可以根据需要在多个应用程序实例之间切换。在应用服务计划下运行的应用可以容纳多个插槽，而对于未充分使用的计划，只允许一个插槽。</p><h1 id="353a" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">为什么选择部署插槽？</h1><h2 id="04cc" class="lg kd hi bd ke lh li lj ki lk ll lm km jb ln lo kq jf lp lq ku jj lr ls ky lt bi translated">交换实例的灵活性</h2><p id="cac4" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">不同应用实例从源到目标的交换无需停机，随时随地为用户提供最佳体验。流量重定向是无缝的，不会因为交换而遗漏任何请求。如果在交换过程中执行了一个函数，执行不会中断，下一个触发器将被重定向到交换的应用程序实例。</p><h2 id="6862" class="lg kd hi bd ke lh li lj ki lk ll lm km jb ln lo kq jf lp lq ku jj lr ls ky lt bi translated">回滚选项</h2><p id="eaeb" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">部署槽的另一个有利特性是回滚选项。如果您的团队对最新更新不满意，您可以在同一应用服务中将应用回滚到以前的版本。这消除了停机时间，让您的用户享受中断的服务。</p><h1 id="0a4c" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">Azure服务部署插槽的工作方式</h1><p id="71c7" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">假设您已经在web应用程序中部署了一个网站。这个网络应用程序有一个自定义的URL地址<a class="ae lf" href="https://www.azure-slots.com." rel="noopener ugc nofollow" target="_blank">https://www.azure-slots.com。</a>现在，您的团队创建了一个新版本的网站，您希望在将其推向生产环境之前对其进行测试。因此，您创建了一个名为staging的部署槽来推送新版本，它的URL是https://www.azureslots.staging.azureservices.net的<a class="ae lf" href="https://www.azureslots.staging.azureservices.net." rel="noopener ugc nofollow" target="_blank">。</a></p><p id="85c1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Azure确保暂存槽具有相同的配置值。因此，它使用与生产插槽相同的数据库和缓存值。</p><p id="958c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">既然新版本已经在部署槽中准备好了，那么它将被部署到生产中。您可以通过交换将新版本推向生产。</p><p id="b2e0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先，将源插槽预热。然后Azure向根槽发起请求。最后，Azure交换源和目标插槽的虚拟IP地址，从而交换插槽的URL。它还受到特定于目标插槽的某些设置的限制。比如发布端点，自定义域名等。</p><figure class="lv lw lx ly fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lu"><img src="../Images/bfb4468ccec871758e73db54ce6393a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*P6mLyOmJwrv_xH5_"/></div></div></figure><h1 id="7155" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">Azure服务部署槽的实际应用</h1><h2 id="7070" class="lg kd hi bd ke lh li lj ki lk ll lm km jb ln lo kq jf lp lq ku jj lr ls ky lt bi translated">创建应用服务资源</h2><p id="a2ee" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">要做的第一件事是用一个示例web服务器设置一个应用服务。这是为了测试更改并执行交换。整个过程包括以下内容:</p><ul class=""><li id="1ce0" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn lz ju jv jw bi translated">使用示例代码创建一个应用服务槽</li><li id="dd0f" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn lz ju jv jw bi translated">创建部署插槽</li><li id="8625" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn lz ju jv jw bi translated">使用CI-CD方法连接插槽以启用自动同步。这将导致对代码库的更改，并最终触发插槽进行交换。</li></ul><figure class="lv lw lx ly fd ij er es paragraph-image"><div class="er es ma"><img src="../Images/88f2dece9e4b57811272f2ad0609e2e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1362/0*ZyaMNv7mKOF59_8i"/></div></figure><p id="4ce3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一旦您的应用程序服务准备就绪，您将看到一个网页，其中显示的内容表明您的应用程序处于活动状态并正在运行。</p><h2 id="1284" class="lg kd hi bd ke lh li lj ki lk ll lm km jb ln lo kq jf lp lq ku jj lr ls ky lt bi translated">创建应用服务槽</h2><p id="b644" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">下一步是创建分段插槽。这可以从Azure门户轻松完成。以下是步骤-</p><ol class=""><li id="eaea" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn jt ju jv jw bi translated">导航到在您的环境中创建的Azure应用服务。</li><li id="5cf9" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">单击左侧面板中的部署插槽，然后选择“添加插槽”来创建您的登台环境。</li><li id="50fd" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">给它起一个像“Staging”这样的名字，以便于识别。</li></ol><p id="7dc3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">此时，您将看到部署插槽已经准备好了。您将在您的资源组中看到一个新的应用服务槽，专门用于托管从存储库中推送的代码。该分段插槽将在您的资源组中命名为“Staging/”。</p><p id="ab38" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">既然登台槽已经初始化，是时候将代码从repo推入登台槽了。要做到这一点-</p><ul class=""><li id="68bb" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn lz ju jv jw bi translated">导航到部署插槽，并单击新创建的登台插槽</li><li id="1753" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn lz ju jv jw bi translated">转到分段插槽的部署中心，并选择您选择的repo位置。</li></ul><h2 id="309a" class="lg kd hi bd ke lh li lj ki lk ll lm km jb ln lo kq jf lp lq ku jj lr ls ky lt bi translated">将生产插槽与分段插槽交换</h2><p id="563a" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">这是只需单击交换按钮的最后一步。一旦完成，你将体验插槽的交换。导航回您的生产插槽，并在“部署中心”中单击“交换”以启动交换。然后输入源和目标存储库，以指定要部署到的源和目标。</p><p id="28ab" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最后，您应该会看到一条成功消息，表明交换已经成功完成。现在，您可以看到您的应用程序在生产中得到更新。Azure还提供各种功能，如自动交换和带预览的交换，这涉及到在部署中心更改设置。</p><h1 id="3914" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">结论</h1><p id="bff2" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">如您所见，交换两个插槽只需要几个步骤。然而，不要对生产运行应用掉以轻心。在部署到生产环境之前，建议在非生产环境中测试您的应用程序，因为您永远不知道在交换过程中什么时候会遇到问题。</p></div><div class="ab cl mb mc gp md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="hb hc hd he hf"><p id="4232" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="mi">原载于</em><a class="ae lf" href="https://www.partech.nl/nl/publicaties/2021/06/understanding-deployment-slots-in-azure-app-services" rel="noopener ugc nofollow" target="_blank"><em class="mi">https://www . partech . nl</em></a><em class="mi">。</em></p></div></div>    
</body>
</html>