<html>
<head>
<title>Text extraction for unstructured data using easy OCR.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用简易OCR提取非结构化数据的文本。</h1>
<blockquote>原文：<a href="https://medium.com/codex/text-extraction-for-unstructured-data-using-easy-ocr-4258d983d264?source=collection_archive---------1-----------------------#2022-06-10">https://medium.com/codex/text-extraction-for-unstructured-data-using-easy-ocr-4258d983d264?source=collection_archive---------1-----------------------#2022-06-10</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/70bc91df2c7b1a8e1601eef8f3425dd0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8ISOkFW444TwFpt2z_sgmA.png"/></div></div></figure><blockquote class="iq ir is"><p id="6338" class="it iu iv iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">什么是OCR？</strong></p></blockquote><p id="350d" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">光学字符识别被称为文本识别。OCR程序从扫描的文档、相机图像和纯图像pdf中提取数据并重新调整其用途。OCR软件在图像上挑出字母，将它们放入单词中，然后将单词放入句子中，从而能够访问和编辑原始内容。它还消除了手动数据输入的需要。你可以浏览<a class="ae jv" href="https://towardsdatascience.com/a-gentle-introduction-to-ocr-ee1469a201aa" rel="noopener" target="_blank">这个</a>博客，了解更多关于OCR技术的内容。</p><blockquote class="iq ir is"><p id="75e1" class="it iu iv iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">OCR的应用:</strong></p></blockquote><p id="1e99" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">从图像中提取文本可用于多种应用，例如从扫描文档中读取信息、社交媒体数据分析，在医疗保健领域，数据科学家使用高级数据科学技术分析文本，银行使用文本提取来比较银行对账单，还有更多文本提取的应用。你可以通过<a class="ae jv" href="https://viso.ai/computer-vision/optical-character-recognition-ocr/" rel="noopener ugc nofollow" target="_blank">这个</a>博客阅读更多OCR的实时用例。</p><blockquote class="iq ir is"><p id="6bef" class="it iu iv iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">可用于文本提取的在线工具:</strong></p></blockquote><ul class=""><li id="84f9" class="jw jx hi iw b ix iy jb jc js jy jt jz ju ka jr kb kc kd ke bi translated">Google Cloud vision API:它是最强大的文本提取API。它使用机器学习来理解您的图像，具有行业领先的预测准确性。您可以使用此<a class="ae jv" href="https://cloud.google.com/vision" rel="noopener ugc nofollow" target="_blank">链接</a>尝试一些图像。</li></ul><figure class="kg kh ki kj fd ij er es paragraph-image"><div class="er es kf"><img src="../Images/1f50a67744cd07805d8c69098133028f.png" data-original-src="https://miro.medium.com/v2/resize:fit:738/format:webp/1*SnM3WI05RADuo9XADl_c1g.png"/></div></figure><ul class=""><li id="b149" class="jw jx hi iw b ix iy jb jc js jy jt jz ju ka jr kb kc kd ke bi translated">Amazon Textract: Amazon Textract使您能够检测和分析单页或多页输入文档中的文本。你可以参考这个<a class="ae jv" href="https://docs.aws.amazon.com/textract/latest/dg/what-is.html" rel="noopener ugc nofollow" target="_blank">链接</a>来获得更多关于Amazon Textract的见解。</li></ul><figure class="kg kh ki kj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kk"><img src="../Images/d32343b4d34d06fc7f493a67c8ba7b01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UY5XMRisG0CYfsQ83iyIlw.jpeg"/></div></div></figure><ul class=""><li id="c097" class="jw jx hi iw b ix iy jb jc js jy jt jz ju ka jr kb kc kd ke bi translated">Omnipage OCR: <a class="ae jv" href="https://docs.uipath.com/activities/docs/omnipage-ocr" rel="noopener ugc nofollow" target="_blank">文档</a></li></ul><figure class="kg kh ki kj fd ij er es paragraph-image"><div class="er es kl"><img src="../Images/507d5a478d85b4fdf48e12526f870743.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/format:webp/1*18uLe2Z6UKB4UPL_pfz7Ig.jpeg"/></div></figure><ul class=""><li id="75ce" class="jw jx hi iw b ix iy jb jc js jy jt jz ju ka jr kb kc kd ke bi translated">艾比云OCR: <a class="ae jv" href="https://www.abbyy.com/cloud-ocr-sdk/documentation/" rel="noopener ugc nofollow" target="_blank">文档</a></li></ul><figure class="kg kh ki kj fd ij er es paragraph-image"><div class="er es km"><img src="../Images/93ee218fafddd91aae472f1ce6049d43.png" data-original-src="https://miro.medium.com/v2/resize:fit:598/format:webp/1*XepbzgIpB3t59VIYfdJLsg.png"/></div></figure><ul class=""><li id="d1e6" class="jw jx hi iw b ix iy jb jc js jy jt jz ju ka jr kb kc kd ke bi translated">UiPath文档OCR: <a class="ae jv" href="https://docs.uipath.com/activities/docs/ui-path-document-ocr" rel="noopener ugc nofollow" target="_blank">文档</a></li></ul><figure class="kg kh ki kj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kn"><img src="../Images/8b0e61b5ff9584972b2ab8ba353e2d44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ygnb-GRVpF_FqxM-Gwgphg.jpeg"/></div></div></figure><blockquote class="iq ir is"><p id="f110" class="it iu iv iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">不同的文字提取技术:</strong></p></blockquote><ul class=""><li id="1c25" class="jw jx hi iw b ix iy jb jc js jy jt jz ju ka jr kb kc kd ke bi translated">宇宙魔方</li></ul><figure class="kg kh ki kj fd ij er es paragraph-image"><div class="er es ko"><img src="../Images/4048c0c0a37035870bf01febdec3ab64.png" data-original-src="https://miro.medium.com/v2/resize:fit:614/format:webp/1*e0ApwI5nlbahM29fvjercg.jpeg"/></div></figure><ul class=""><li id="c211" class="jw jx hi iw b ix iy jb jc js jy jt jz ju ka jr kb kc kd ke bi translated">简易OCR</li></ul><figure class="kg kh ki kj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kp"><img src="../Images/0dbe95721d59d571bdfeaebc8c1bf494.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SNbnIm3UKzi9ndq-xKp8Yg.png"/></div></div></figure><ul class=""><li id="6e47" class="jw jx hi iw b ix iy jb jc js jy jt jz ju ka jr kb kc kd ke bi translated">Keras OCR</li></ul><figure class="kg kh ki kj fd ij er es paragraph-image"><div class="er es kq"><img src="../Images/5c840c2c700c2bfbb05c67bbf9f2711c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1008/format:webp/1*xY2V6wTpWynYE7Uw-cFaNg.png"/></div></figure><blockquote class="iq ir is"><p id="1db7" class="it iu iv iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">非结构化数据的文本提取:</strong></p></blockquote><p id="1c9a" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">对于结构化数据，上述所有文本提取方法都能很好地执行。但是，对于非结构化数据，这些方法不能以适当的方式提取文本。所有这些方法都是水平地逐行扫描文档或图像。</p><p id="a7a6" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">对于这种情况，我实现了一种技术，它包括深度学习模型和简单的OCR模型<em class="iv">。</em></p><blockquote class="iq ir is"><p id="25d6" class="it iu iv iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">问题陈述:</strong></p></blockquote><p id="24d8" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">这是用于非结构化数据的文本提取的示例图像，</p><figure class="kg kh ki kj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kr"><img src="../Images/849ab5fcd167e0fbec06ed15bb2a2d76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GD8e5vdOKKGiWfXxoRBFeA.png"/></div></div><figcaption class="ks kt et er es ku kv bd b be z dx translated">sample.png</figcaption></figure><p id="2906" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">从这个图像中，我想提取所有房间名称及其适当尺寸的列表。</p><blockquote class="iq ir is"><p id="5bd9" class="it iu iv iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">解决方案:</strong></p></blockquote><p id="19ee" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">步骤1:使用对象检测模型(yolov4)并从平面图中裁剪仅包含文本部分的检测图像。</p><p id="4ee4" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">步骤2:使用简单的OCR检测裁剪图像中的文本。</p><p id="b9b4" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">步骤3:将房间名称与其对应的尺寸对应起来。</p><blockquote class="iq ir is"><p id="d009" class="it iu iv iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">实现:</strong></p></blockquote><p id="9d65" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">下面是检测的代码。在这里，我在不同的文本上训练了yolov4模型。因此，对于检测，它会给我裁剪图像，将只包含文本部分。</p><pre class="kg kh ki kj fd kw kx ky kz aw la bi"><span id="7265" class="lb lc hi kx b fi ld le l lf lg">net = cv2.dnn.readNet("custom-yolov4-detector.weights",<br/>                      "custom-yolov4-detector.cfg")<br/>#Reading class names<br/>classes = [0]<br/>layer_names = net.getLayerNames()<br/>output_layers = [layer_names[i- 1] for i in net.getUnconnectedOutLayers()]<br/>colors = np.random.uniform(0, 255, size=(len(classes), 3))<br/>#print(len(classes))<br/>img= IMG<br/>#print(img.shape)<br/>height, width,_ = img.shape<br/>blob = cv2.dnn.blobFromImage(img, 1 / 255.0, (416, 416),swapRB=True, crop=False)<br/># give images input to darknet module<br/>net.setInput(blob)<br/>#  Get the output layers of model<br/>out_names= net.getUnconnectedOutLayersNames()<br/>layerOutputs = net.forward(out_names)<br/># Generating detection in the form of bounding box, confidence and class id<br/>boxes=[]<br/>confidences=[]<br/>class_ids=[]<br/>qq = 0<br/>j = 0<br/>for out in layerOutputs:<br/>    for detection in out:<br/>        scores = detection[5:]<br/>        class_id = np.argmax(scores)<br/>        confidence = scores[class_id]<br/>        if confidence &gt; 0.5:<br/>            centerX= int(detection[0]* width)<br/>            centerY= int(detection[1]* height)<br/>            w= int(detection[2]* width*1.3)<br/>            #print(w)<br/>            h= int(detection[3]* height*1.3)<br/>            #print(h)<br/>            x = int(centerX - (w/ 2))<br/>            y = int(centerY - (h/ 2))<br/>            boxes.append([x, y, w, h])<br/>            confidences.append(float(confidence))<br/>            class_ids.append(class_id)<br/><br/>indexes= cv2.dnn.NMSBoxes(boxes, confidences, 0.3, 0.4)<br/>indexes= np.array(indexes)<br/>font= cv2.FONT_HERSHEY_PLAIN<br/>colors= np.random.uniform(0, 255, size=(len(boxes),3))<br/>Finaldf = []<br/>for i in indexes.flatten():<br/>    x, y, w, h= boxes[i]<br/>    label= str(classes[class_ids[i]])<br/>    color= colors[i]<br/>    confidence= str(round(confidences[i],2))<br/>    if label == '0':<br/>        cv2.rectangle(img, (x, y), (x+w,y+h),color, 2)<br/>        cv2.putText(img, str(qq), (x+10, y+10), font, 2, (0, 0, 255), 2)<br/>        #print([x, y, w, h])<br/>        obj= img[y: y+h, x: x+w]<br/>        img1 = np.asarray(obj)<br/>        #print(type(img1))<br/>    cv2.imwrite("PATH TO SAVE CROPPED IMAGES".format(j), obj)<br/></span></pre><figure class="kg kh ki kj fd ij er es paragraph-image"><div class="er es lh"><img src="../Images/62fe704c11dfbff25a9e8c37ce6e81c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:206/format:webp/1*t2ac4qVH6_895pN0EGojAg.png"/></div><figcaption class="ks kt et er es ku kv bd b be z dx translated">cropped_img.png</figcaption></figure><p id="4e6a" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">现在，我们将检查图像中文本的角度。</p><p id="3a5d" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">以下是检测裁剪图像中文本角度的函数:</p><pre class="kg kh ki kj fd kw kx ky kz aw la bi"><span id="8be6" class="lb lc hi kx b fi ld le l lf lg">def detect_angle(image):<br/>    mask = np.zeros(image.shape, dtype=np.uint8)<br/>    gray = cv2.cvtColor(image, cv2.COLOR_BGR2GRAY)<br/>    blur = cv2.GaussianBlur(gray, (3,3), 0)<br/>    adaptive = cv2.adaptiveThreshold(blur,255,cv2.ADAPTIVE_THRESH_GAUSSIAN_C, cv2.THRESH_BINARY_INV,15,4)<br/><br/>    cnts = cv2.findContours(adaptive, cv2.RETR_TREE, cv2.CHAIN_APPROX_SIMPLE)<br/>    cnts = cnts[0] if len(cnts) == 2 else cnts[1]<br/><br/>    for c in cnts:<br/>        area = cv2.contourArea(c)<br/>        if area &lt; 45000 and area &gt; 20:<br/>            cv2.drawContours(mask, [c], -1, (255,255,255), -1)<br/>    mask = cv2.cvtColor(mask, cv2.COLOR_BGR2GRAY)<br/>    h, w = mask.shape<br/>    <br/>    # Horizontal<br/>    if w &gt; h:<br/>        left = mask[0:h, 0:0+w//2]        <br/>        right = mask[0:h, w//2:]        <br/>        left_pixels = cv2.countNonZero(left)<br/>        #print("L",left_pixels)<br/>        right_pixels = cv2.countNonZero(right)<br/>        #print("R",right_pixels)<br/>        if left_pixels &gt;= right_pixels:<br/>            return 0<br/>        else:<br/>            return 180  <br/>   <br/>    # Vertical<br/>    else:<br/>        top = mask[0:h//2, 0:w]            <br/>        bottom = mask[h//2:, 0:w]        <br/>        top_pixels = cv2.countNonZero(top)<br/>        #print("T",top_pixels)<br/>        bottom_pixels = cv2.countNonZero(bottom)<br/>        #print("B",bottom_pixels)<br/>        if top_pixels &gt;= bottom_pixels:<br/>            return 270<br/>        else:<br/>            return 90</span></pre><p id="bd88" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">有时，图像中的文本是旋转的，在这种情况下，easy OCR将无法正确检测文本。对于这种情况，我使用了一种算法，将图像中的文本旋转0度。</p><p id="e6c3" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">如果文本的角度不是0度，这个函数将调整文本的角度。</p><pre class="kg kh ki kj fd kw kx ky kz aw la bi"><span id="8e7c" class="lb lc hi kx b fi ld le l lf lg">#Adjust the angle<br/>def rotation(angle):<br/>    if angle &lt; -45:<br/>        angle = -(90+ angle)<br/>    else:<br/>        angle = -angle<br/>    return angle</span></pre><p id="3a9e" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">在获得合适的图像后，现在我们可以应用简单的OCR来检测其中的文本。</p><pre class="kg kh ki kj fd kw kx ky kz aw la bi"><span id="af4b" class="lb lc hi kx b fi ld le l lf lg">def ocr(rotated_img):<br/>    img = rotated_img<br/>    gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)<br/>    import easyocr<br/>    reader = easyocr.Reader(['en'])<br/>    result = reader.readtext(img) <br/>    return result</span></pre><p id="0c4c" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">OCR的输出如下所示:</p><pre class="kg kh ki kj fd kw kx ky kz aw la bi"><span id="d9ef" class="lb lc hi kx b fi ld le l lf lg">[([[25, 11], [77, 11], [77, 25], [25, 25]], 'KITCHEN', 0.916220680138048), ([[17, 23], [85, 23], [85, 37], [17, 37]], '9\'7" x 12\'5"', 0.36220390889597476)]</span></pre><p id="fe4b" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">现在，我只使用了一个简单的python代码，它将访问列表中每隔一个的最后一个元素，并将房间名称与其对应的维度进行映射。</p><p id="24b8" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">最后，我的输出数据帧如下所示:</p><figure class="kg kh ki kj fd ij er es paragraph-image"><div class="er es li"><img src="../Images/483f66f10223895554142b0910987168.png" data-original-src="https://miro.medium.com/v2/resize:fit:1214/format:webp/1*HN9NKNpSr70EotQg2RUh1Q.png"/></div><figcaption class="ks kt et er es ku kv bd b be z dx translated">输出数据帧</figcaption></figure><p id="8496" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">参考资料:</p><ol class=""><li id="8030" class="jw jx hi iw b ix iy jb jc js jy jt jz ju ka jr lj kc kd ke bi translated"><a class="ae jv" href="https://www.analyticsvidhya.com/blog/2020/05/build-your-own-ocr-google-tesseract-opencv/" rel="noopener ugc nofollow" target="_blank">https://www . analyticsvidhya . com/blog/2020/05/build-your-own-ocr-Google-tesse ract-opencv/</a></li><li id="2e72" class="jw jx hi iw b ix lk jb ll js lm jt ln ju lo jr lj kc kd ke bi translated"><a class="ae jv" href="https://stackoverflow.com/questions/58010660/detect-image-orientation-angle-based-on-text-direction" rel="noopener ugc nofollow" target="_blank">https://stack overflow . com/questions/58010660/detect-image-orientation-angle-based-on-text-direction</a></li></ol><p id="6886" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">我希望这些内容能帮助你解决任何类型的文本提取问题。</p></div><div class="ab cl lp lq gp lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="hb hc hd he hf"><h1 id="d4d9" class="lw lc hi bd lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms bi translated"><strong class="ak">谢谢！！</strong></h1></div></div>    
</body>
</html>