<html>
<head>
<title>What goes in a software architecture document?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">软件架构文档中包含什么？</h1>
<blockquote>原文：<a href="https://medium.com/codex/what-goes-in-a-software-architecture-document-e97d808d5cec?source=collection_archive---------3-----------------------#2021-07-19">https://medium.com/codex/what-goes-in-a-software-architecture-document-e97d808d5cec?source=collection_archive---------3-----------------------#2021-07-19</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/d6ec1801cd3b4863363a3aa439f82aa9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xq-A9nom3s9gHRfAVKhupw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">软件架构文档</figcaption></figure><p id="255e" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">文档，没有人喜欢写它们，并且很难保持更新！有些人甚至认为没人读它们，所以写作毫无意义。如果你是一个紧密团结的小团队，挤在一个房间里开发软件，那可能是真的。然而，随着团队的成长和软件变得复杂，它会很快失控。总有一天，人们会问太多的基本问题，寻找信息却找不到。软件架构文档就是这样一个有价值的文档，它以某种方式帮助组织中的每个人提供上下文，因此努力做到这一点是非常重要的。在这篇文章中，我将深入探讨一种对我很有效的架构文档风格，并讨论诸如应该将它存储在哪里、谁应该更新它、何时更新等方面。<em class="js">注意</em> : <em class="js">我的专长是企业和云架构。所以我在这里说的可能不太适用于其他领域，比如嵌入式软件、游戏开发等。</em></p><h2 id="9a8a" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jf ke kf kg jj kh ki kj jn kk kl km kn bi translated">目标受众和目的:</h2><ul class=""><li id="4176" class="ko kp hi iw b ix kq jb kr jf ks jj kt jn ku jr kv kw kx ky bi translated">让团队的新成员了解软件系统的各个部分是如何工作的。</li><li id="0eba" class="ko kp hi iw b ix kz jb la jf lb jj lc jn ld jr kv kw kx ky bi translated">在大型软件系统中，作为不同团队中的人的参考，以了解系统的其他部分正在发生什么。</li><li id="540d" class="ko kp hi iw b ix kz jb la jf lb jj lc jn ld jr kv kw kx ky bi translated">一个单点视图和抽象层，架构师无需深入细节即可处理。</li><li id="2988" class="ko kp hi iw b ix kz jb la jf lb jj lc jn ld jr kv kw kx ky bi translated">在一个绿地项目中，作为第一个骨架来翻译正在构建的软件的远景。</li><li id="78a5" class="ko kp hi iw b ix kz jb la jf lb jj lc jn ld jr kv kw kx ky bi translated">对于工程经理来说，当事情发生变化时，可以看到影响，以计划QA和其他活动。</li></ul><h2 id="e4fd" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jf ke kf kg jj kh ki kj jn kk kl km kn bi translated">文档内容:</h2><p id="d1c8" class="pw-post-body-paragraph iu iv hi iw b ix kq iz ja jb kr jd je jf le jh ji jj lf jl jm jn lg jp jq jr hb bi translated">几十年来，公司和学术界已经尝试了不同的风格和图表来表达系统正在做什么。UML、C4、SSADM、数据流模型、房间图等。其中一些的问题是它列出了非常严格的规则和符号。显然，没有人能为我们着手构建的各种系统提出规则，事情变得难以遵循。在所有这些当中，我喜欢用T4的C4方法和UML的组合来表达软件架构，这也是我在这里所提倡的。现在让我深入探讨一下这份文件的内容。分享一个文档模板是很诱人的，但我将避免这种情况，并讨论进入它的部分。这样，你将基于对什么是有用的理解来构建自己的结构。</p><p id="40ce" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">因为我不能在这里展示一个真正的应用程序架构，所以我使用一个虚拟的游戏，名为FarmLords。为了画这些图，我最喜欢的工具是<a class="ae lh" href="https://structurizr.com/" rel="noopener ugc nofollow" target="_blank"> Structurizr </a>和<a class="ae lh" href="https://staruml.io/" rel="noopener ugc nofollow" target="_blank"> StarUML </a>(我不是这些公司赞助的)</p><p id="ff9f" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">系统上下文:</p><figure class="lj lk ll lm fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es li"><img src="../Images/2b074cb1d3d5bf11cce17c72e6937c37.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*bfJ0OX4bDIBu-p10"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">系统上下文图</figcaption></figure><p id="d1f3" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">系统上下文图是软件系统的50，000英尺视图。对你来说，软件系统的构成可能是不同的。如果你是一个处理特定子系统的团队领导，那么只有那个系统被认为是“软件系统”,其他的都被认为是外部系统。然而，如果你从整个公司的角度来看，包含许多子系统的整个软件系统将是“软件系统”</p><ul class=""><li id="d8ba" class="ko kp hi iw b ix iy jb jc jf ln jj lo jn lp jr kv kw kx ky bi translated">我们的系统与所有与之交互的外部系统一起显示。这种联系也被标记为两个系统之间最重要的相互作用。例如，在上图中，您可以看到系统与支付网关的交互显示为“授权支付”，但这并不意味着这是唯一的交互。这只是它所做的许多互动之一。这个图并不意味着包含系统之间的所有交互。</li><li id="9adc" class="ko kp hi iw b ix kz jb la jf lb jj lc jn ld jr kv kw kx ky bi translated">它还显示了使用该系统的演员。这里的actor和UML中的actor有相似的含义。他们基本上是使用我们系统的不同阶层的人。</li></ul><p id="c6ff" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">体系结构文档应该有这个图表，然后在下面的详细段落中，解释图表中的每个框以及详细列表中框之间的每个连接。</p><p id="a91a" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">容器图:</p><figure class="lj lk ll lm fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es li"><img src="../Images/8212a87ffe1a6fca3da87ff37dd3260f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*IxAw0V9CemWDPxRs"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">容器图</figcaption></figure><p id="ce58" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在，我们开始从50，000英尺的高度向下潜水，看到10，000英尺的系统视图。先前上下文图中的“软件系统”现在被分解到它的容器中。“软件系统”和外部系统之间的连接现在是从您系统中的特定容器发出的。当我说容器时，我指的并不是像docker这样的容器技术。它可以是一个独立存在的进程、服务器或服务。为了完整起见，该图还可以显示外部系统和参与者。此处的连接和接线盒在该图下方的详细列表中再次描述。</p><p id="7f74" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">组件图:</p><p id="ccbf" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这部分我觉得我们有选择。我们可以走UML的路，或者继续走C4的路。如果我们采用UML的方式，它将是如下的简单类图:</p><figure class="lj lk ll lm fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lq"><img src="../Images/8bbebf3cc0cfe9f2dccdea4977e323d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*mH6KhNUSsggJwnpM"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">UML组件图</figcaption></figure><p id="386c" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果我们选择C4方法(我推荐——我将进一步解释为什么),我们可以分解组件及其关系，如下图所示(来自一个不相关的项目)。前面容器图中的每个容器都需要分解成一个组件图。</p><figure class="lj lk ll lm fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lr"><img src="../Images/5c2d3e13155c74b0065e2a9073a412fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ovs-nrL2Plrn3FhnhgCwVQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">C4组件图</figcaption></figure><p id="4bd3" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这里我们需要在图表下面逐项详细解释每个组件。这三组图表将为所有常见的理解目的提供一个适当的深入视图。更重要的是，它显示了什么组件与什么其他组件相关联，因此很容易对任何更改进行影响分析。</p><p id="e7a4" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">架构上重要的用例:</p><p id="e9ac" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在是描述这些组件如何相互作用的时候了。尽管前面的图表显示了它们之间的关系，但是它们并没有完全描绘出在这些关系中进行了什么样的交流。描述组件之间交互的最佳方式是一组序列图，如下所示:</p><figure class="lj lk ll lm fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ls"><img src="../Images/66be0bf74ff57324f5c2b041fdd46c6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*TYhVGzAQdp_PkTsR"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">交互图1</figcaption></figure><figure class="lj lk ll lm fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es li"><img src="../Images/da8f94cc89d416d41cfb79393efe475a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*gdBDQyenn56x4lok"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">交互图2</figcaption></figure><p id="d0e7" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我们不能在这里建模所有的用例，所以我们需要识别一些我们称之为“架构上重要的”用例。换句话说，用例执行大部分组件或者展示交互的复杂性。我们应该挑选这些用例并记录下来。这些图看起来很复杂，但是可以用StarUML这样的工具快速绘制出来。</p><p id="9ab2" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">重要决策:</p><p id="c719" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在下一节中，我们将详细介绍项目中采取的重要技术决策。通常，在本文档中列出所有决策并不是一个好主意，因为它们太多了，而且每个决策都需要大量的上下文。因此，我们将这一部分链接到一组架构决策记录，在<a class="ae lh" rel="noopener" href="/@maruthijr/architecture-decision-records-7dff18f2a271">链接的</a>文章中有更详细的介绍。本节的目的是指出所有做出的决定以及做出这些决定的原因。</p><p id="3be5" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">部署图:</p><p id="97c9" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">容器图中显示的容器不一定是它们的部署方式。部署图显示了真实的服务器、服务器之间的连接以及服务器上的组件或容器。例如，容器图可以显示5个容器，但是在EKS上完成的部署可以显示这5个容器位于2个节点上。此外，生产上的配置可能不同于QA上的配置。部署图显示了所有这些信息。我们运行的每个环境都需要一个。下面是部分例子</p><figure class="lj lk ll lm fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lt"><img src="../Images/2c06051aac7beb2bb3e639a67642ea8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GPRUdL1WQMKow4eEc8fn-g.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">配置图</figcaption></figure><p id="cbb4" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">监控设置:</p><p id="80c8" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">接下来，我们将描述各种服务的监控设置。我对此没有具体的图表格式，但是需要说明或图表来解释各种服务是如何被监控的。该视图将清楚地显示被监控的服务和被监控的内容。</p><h2 id="e9f6" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jf ke kf kg jj kh ki kj jn kk kl km kn bi translated">C4模型在测试中的应用</h2><p id="473a" class="pw-post-body-paragraph iu iv hi iw b ix kq iz ja jb kr jd je jf le jh ji jj lf jl jm jn lg jp jq jr hb bi translated">C4模型在测试中会变得非常有用。以下是方法:</p><ul class=""><li id="e4c8" class="ko kp hi iw b ix iy jb jc jf ln jj lo jn lp jr kv kw kx ky bi translated">像structurizr这样的工具可以让你定义C4模型并将其导出为JSON文档。</li><li id="d122" class="ko kp hi iw b ix kz jb la jf lb jj lc jn ld jr kv kw kx ky bi translated">C4组件可以以编程方式导出为您的票务系统(如吉拉)中的组件</li><li id="78af" class="ko kp hi iw b ix kz jb la jf lb jj lc jn ld jr kv kw kx ky bi translated">C4组件可以选择引用github/bitbucket存储库路径</li><li id="0c2a" class="ko kp hi iw b ix kz jb la jf lb jj lc jn ld jr kv kw kx ky bi translated">每个拉取请求可以自动挑选出它所涉及的组件</li><li id="0dd5" class="ko kp hi iw b ix kz jb la jf lb jj lc jn ld jr kv kw kx ky bi translated">C4组件可以基于代码审查时的判断手动与票据相关联</li><li id="24dc" class="ko kp hi iw b ix kz jb la jf lb jj lc jn ld jr kv kw kx ky bi translated">集成测试或端到端测试可以与C4组件相关联。</li><li id="62ec" class="ko kp hi iw b ix kz jb la jf lb jj lc jn ld jr kv kw kx ky bi translated">所有这些都有助于根据发布中包含的标签来确定在发布时需要测试什么。</li></ul><h2 id="ef5d" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jf ke kf kg jj kh ki kj jn kk kl km kn bi translated">这份文件什么时候更新？</h2><p id="6a48" class="pw-post-body-paragraph iu iv hi iw b ix kq iz ja jb kr jd je jf le jh ji jj lf jl jm jn lg jp jq jr hb bi translated">必须为要更新的文档定义非常明确的触发点。否则这将很快变得陈旧和无用。</p><ul class=""><li id="4231" class="ko kp hi iw b ix iy jb jc jf ln jj lo jn lp jr kv kw kx ky bi translated">在代码评审期间由评审者更新或请求</li><li id="ff60" class="ko kp hi iw b ix kz jb la jf lb jj lc jn ld jr kv kw kx ky bi translated">由建筑师和设计师在ADR更新过程中更新。(参见此处的<a class="ae lh" rel="noopener" href="/@maruthijr/architecture-decision-records-7dff18f2a271">了解ADR流程的</a>)</li><li id="68cb" class="ko kp hi iw b ix kz jb la jf lb jj lc jn ld jr kv kw kx ky bi translated">在发布期间，在我们挑选组件进行测试时进行更新。我们一定会发现一些没有被它建造的方式所覆盖的东西。这项工作可能属于工程经理或他们委托的人。</li></ul><p id="cd49" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">根据我的经验，我试图为软件组织的架构文档构建一个很好的框架。希望这能帮助那些试图在自己的公司内部整合一些东西的人。我真的很想听听大家的意见和想法，这样我们就可以为了大家的利益完善这个模型。</p></div></div>    
</body>
</html>