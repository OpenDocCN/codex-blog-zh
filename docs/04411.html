<html>
<head>
<title>Product recommendation using Market Basket Analysis: A practical guide</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用购物篮分析的产品推荐:实用指南</h1>
<blockquote>原文：<a href="https://medium.com/codex/product-recommendation-using-market-basket-analysis-a-practical-guide-f1b76209b299?source=collection_archive---------2-----------------------#2021-11-29">https://medium.com/codex/product-recommendation-using-market-basket-analysis-a-practical-guide-f1b76209b299?source=collection_archive---------2-----------------------#2021-11-29</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/aaf1814ed8ce4324d619fdc35633c854.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s9aLaVRWZIOmR2ZrQ9-XyQ.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">https://unsplash.com/photos/rWMIbqmOxrY</figcaption></figure><p id="fe83" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">麦肯锡公司2018年的见解显示，消费者在<strong class="ix hj">亚马逊</strong>上购买的35%和在<strong class="ix hj">网飞</strong>上观看的75%来自产品推荐<a class="ae iu" href="https://www.mckinsey.com/industries/retail/our-insights/how-retailers-can-keep-up-with-consumers" rel="noopener ugc nofollow" target="_blank">【1】</a>——这是一个很大的比例，表明如果方法正确，推荐策略可以有多成功。产品推荐一直以来都是通过向客户提供感兴趣的相关产品来推动销售的绝佳方式。用于生成产品推荐的算法有很多种，但是，在本文中，我们的重点将是— <strong class="ix hj">关联规则(购物篮分析)</strong>。</p><h1 id="21d4" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">什么是关联规则？</h1><blockquote class="kr ks kt"><p id="fd38" class="iv iw ku ix b iy iz ja jb jc jd je jf kv jh ji jj kw jl jm jn kx jp jq jr js hb bi translated">关联规则学习是一种基于规则的机器学习方法，用于发现大型数据库中变量之间的有趣关系— <a class="ae iu" href="https://en.wikipedia.org/wiki/Association_rule_learning" rel="noopener ugc nofollow" target="_blank"> <em class="hi">维基百科</em> </a>。</p></blockquote><p id="09ef" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">关联规则用于发现数据集中的频繁模式。这种技术被证明可以成功地分析交易数据，了解客户行为，然后用于增加销售。给定一个包含多个项目的交易记录，通过市场购物篮分析(MBA)的关联规则试图找到解释为什么某些项目经常一起购买的规则。</p><p id="6a31" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">例如，凯伦·希斯在1992年发现啤酒和尿布之间有很强的相关性。希斯发现，购买尿布的顾客也更有可能购买啤酒。这一发现是一个很好的例子，表明如何使用关联规则轻松发现产品之间的大量隐藏相关性，从而最大限度地提高销售额。</p><h1 id="0107" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">流行的推荐策略</h1><p id="5cf3" class="pw-post-body-paragraph iv iw hi ix b iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo lc jq jr js hb bi translated">在我们进入MBA如何工作的细节之前，让我们对常见的产品推荐算法有一个概述:</p><ol class=""><li id="0118" class="ld le hi ix b iy iz jc jd jg lf jk lg jo lh js li lj lk ll bi translated"><strong class="ix hj">热门产品推荐</strong>:该算法根据给定商品的受欢迎程度向客户推荐商品。</li><li id="c07b" class="ld le hi ix b iy lm jc ln jg lo jk lp jo lq js li lj lk ll bi translated"><strong class="ix hj">内容过滤</strong>:这种推荐算法试图根据行为(如评级)生成客户档案。它试图根据客户的活动模式为他们提供建议。</li><li id="849a" class="ld le hi ix b iy lm jc ln jg lo jk lp jo lq js li lj lk ll bi translated"><strong class="ix hj">协同过滤</strong>:通过收集其他类似客户的偏好或活动模式信息，向客户提出建议。</li><li id="5e0a" class="ld le hi ix b iy lm jc ln jg lo jk lp jo lq js li lj lk ll bi translated"><strong class="ix hj">关联规则:</strong>关联规则不同于其他方法，因为它试图回答一个问题——“<em class="ku">哪些项目频繁出现在一起</em>”。</li></ol><h1 id="06c7" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">MBA如何工作</h1><figure class="ls lt lu lv fd ij er es paragraph-image"><div class="er es lr"><img src="../Images/10720005a35441b8793d853d3a865aee.png" data-original-src="https://miro.medium.com/v2/resize:fit:492/format:webp/1*TUj9ZLSDgCCjRPwWrPt9bw.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">图1:示例事务数据库</figcaption></figure><p id="fff2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">给定一个商店的样本交易记录，如图1所示，其中包含以下产品:</p><p id="84cf" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">={ <em class="ku">牛奶、面包、啤酒、尿布、可乐</em> }</p><ul class=""><li id="b1cc" class="ld le hi ix b iy iz jc jd jg lf jk lg jo lh js lw lj lk ll bi translated"><strong class="ix hj">项目集</strong>是产品列表中一个或多个项目的集合。</li></ul><p id="a917" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">例如={ <em class="ku">牛奶、面包、尿布</em> }、{ <em class="ku">牛奶</em> }</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div class="er es lx"><img src="../Images/9b21f091738713b7d1a9f8d63059bca5.png" data-original-src="https://miro.medium.com/v2/resize:fit:918/format:webp/0*wTFaHZJxmsnvSJ_M.png"/></div></figure><ul class=""><li id="6cfc" class="ld le hi ix b iy iz jc jd jg lf jk lg jo lh js lw lj lk ll bi translated"><strong class="ix hj">支持</strong>被定义为包含一个项目集的事务的一部分。支持度越高，项目集出现的频率越高。给定一个项集<strong class="ix hj">A</strong>,<strong class="ix hj">A</strong>的支持度是<strong class="ix hj">项集A </strong>在事务记录总列表中出现的比率。</li></ul><p id="551a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">例如，使用图1中的表格，支持{ <em class="ku">牛奶、面包、尿布</em> } = &gt; 2/5</p><ul class=""><li id="4247" class="ld le hi ix b iy iz jc jd jg lf jk lg jo lh js lw lj lk ll bi translated"><strong class="ix hj">另一方面，置信度</strong>是假定一个事务包含<strong class="ix hj">项集A </strong>时，该事务包含<strong class="ix hj">项集B </strong>的概率。</li></ul><p id="fef2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">例如:</p><p id="ef09" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="ku">Support _ count({ Bread })= 4</em></p><p id="baee" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="ku">Support _ count({面包，尿布})=3 </em></p><p id="dbbe" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">因此<strong class="ix hj"> <em class="ku">置信度=3/4 </em> </strong></p><ul class=""><li id="d78f" class="ld le hi ix b iy iz jc jd jg lf jk lg jo lh js lw lj lk ll bi translated"><strong class="ix hj">频繁模式</strong>或<strong class="ix hj">频繁项集</strong>是支持度大于或等于所选最小支持度阈值的项集。例如，如果表(图1)的最小支持度是2，这意味着任何频率小于2的项目集都低于阈值，不会被选择。</li></ul><figure class="ls lt lu lv fd ij er es paragraph-image"><div class="er es ly"><img src="../Images/1bba5221e996c0acf3a645c025fd4be7.png" data-original-src="https://miro.medium.com/v2/resize:fit:948/format:webp/0*K0SfqKj7adgumtb_.png"/></div></figure><ul class=""><li id="e2fc" class="ld le hi ix b iy iz jc jd jg lf jk lg jo lh js lw lj lk ll bi translated">最后，<strong class="ix hj">升力</strong>是对模型性能的测量。它有助于确定将一种产品与另一种产品结合是否会增加销售机会。</li></ul><h2 id="e07d" class="lz ju hi bd jv ma mb mc jz md me mf kd jg mg mh kh jk mi mj kl jo mk ml kp mm bi translated">了解提升分数</h2><ul class=""><li id="5f5d" class="ld le hi ix b iy ky jc kz jg mn jk mo jo mp js lw lj lk ll bi translated">如果<strong class="ix hj">提升&gt; 1 </strong>，这意味着关联规则提高了胜负的几率。</li><li id="d6e4" class="ld le hi ix b iy lm jc ln jg lo jk lp jo lq js lw lj lk ll bi translated">如果<strong class="ix hj">提升&lt; 1 </strong>，这意味着关联规则减少了期望结果的机会。</li><li id="549a" class="ld le hi ix b iy lm jc ln jg lo jk lp jo lq js lw lj lk ll bi translated">如果<strong class="ix hj"> Lift = 1，</strong>表示关联规则不影响结果。</li></ul></div><div class="ab cl mq mr gp ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="hb hc hd he hf"><h1 id="93b8" class="jt ju hi bd jv jw mx jy jz ka my kc kd ke mz kg kh ki na kk kl km nb ko kp kq bi translated">一个使用Python的实践实验</h1><p id="450f" class="pw-post-body-paragraph iv iw hi ix b iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo lc jq jr js hb bi translated">在这一节中，我们将探索Chris MOF fit<a class="ae iu" href="https://github.com/chris1610/pbpython/blob/master/notebooks/Market_Basket_Intro.ipynb" rel="noopener ugc nofollow" target="_blank">【3】</a>的GitHub笔记本入门，但是在深入研究代码之前，让我们先回顾一下运行时需求:</p><h2 id="d9f9" class="lz ju hi bd jv ma mb mc jz md me mf kd jg mg mh kh jk mi mj kl jo mk ml kp mm bi translated">要求</h2><p id="4af1" class="pw-post-body-paragraph iv iw hi ix b iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo lc jq jr js hb bi translated"><strong class="ix hj"> Python版本:</strong>T54】Python 3</p><p id="495e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj"> Python库:</strong></p><p id="8b2e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="ku"> pandas — </em> A是一个快速、强大、灵活的数据分析和操作工具，<br/>建立在Python编程语言之上。</p><p id="0356" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="ku"> mlxtend — </em>一个Python工具库，用于日常数据科学任务，如生成关联规则。</p><h2 id="a901" class="lz ju hi bd jv ma mb mc jz md me mf kd jg mg mh kh jk mi mj kl jo mk ml kp mm bi translated">入门指南</h2><p id="e098" class="pw-post-body-paragraph iv iw hi ix b iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo lc jq jr js hb bi translated">现在我们知道了将要使用的工具，让我们安装库。</p><pre class="ls lt lu lv fd nc nd ne nf aw ng bi"><span id="c106" class="lz ju hi nd b fi nh ni l nj nk">pip install pandas<br/>pip install mlxtend</span></pre><p id="f811" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">导入库:</p><pre class="ls lt lu lv fd nc nd ne nf aw ng bi"><span id="4a1c" class="lz ju hi nd b fi nh ni l nj nk"><strong class="nd hj">import</strong> <strong class="nd hj">pandas</strong> <strong class="nd hj">as</strong> <strong class="nd hj">pd</strong><br/><strong class="nd hj">from</strong> <strong class="nd hj">mlxtend.frequent_patterns</strong> <strong class="nd hj">import</strong> apriori<br/><strong class="nd hj">from</strong> <strong class="nd hj">mlxtend.frequent_patterns</strong> <strong class="nd hj">import</strong> association_rules</span></pre><p id="dde2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们可以使用各种技术来生成频繁模式(<strong class="ix hj"> <em class="ku"> FP Growth，ECLAT，Apriori </em> </strong>)。对于这个例子，我们将坚持使用Apriori(与其他方法相比，这是一种蛮力方法)。</p><p id="f5e8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">接下来我们加载<a class="ae iu" href="http://archive.ics.uci.edu/ml/machine-learning-databases/00352/Online%20Retail.xlsx" rel="noopener ugc nofollow" target="_blank"> <strong class="ix hj">数据集</strong> </a>，清理干净，为MBA准备数据。</p><pre class="ls lt lu lv fd nc nd ne nf aw ng bi"><span id="3b16" class="lz ju hi nd b fi nh ni l nj nk">df = pd.read_excel('http://archive.ics.uci.edu/ml/machine-learning-databases/00352/Online%20Retail.xlsx')</span><span id="b81f" class="lz ju hi nd b fi nl ni l nj nk">#cleaning &amp; prep<br/>df['Description'] = df['Description'].str.strip()<br/>df.dropna(axis=0, subset=['InvoiceNo'], inplace=<strong class="nd hj">True</strong>)<br/>df['InvoiceNo'] = df['InvoiceNo'].astype('str')<br/>df = df[~df['InvoiceNo'].str.contains('C')]</span><span id="4e8f" class="lz ju hi nd b fi nl ni l nj nk">#Filter data, fetch only data about France<br/>basket <strong class="nd hj">=</strong> (df[df['Country'] <strong class="nd hj">==</strong>"France"]<br/>          <strong class="nd hj">.</strong>groupby(['InvoiceNo', 'Description'])['Quantity']<br/>          <strong class="nd hj">.</strong>sum()<strong class="nd hj">.</strong>unstack()<strong class="nd hj">.</strong>reset_index()<strong class="nd hj">.</strong>fillna(0)<br/>          <strong class="nd hj">.</strong>set_index('InvoiceNo'))</span></pre><p id="a10f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">上面的代码已经加载了一家英国零售店的交易数据(从<a class="ae iu" href="https://archive.ics.uci.edu/ml/index.php" rel="noopener ugc nofollow" target="_blank"> <em class="ku"> UCI机器学习库</em> </a>中检索)。</p><p id="850f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">要生成最低支持o.o7的频繁模式，我们可以运行下面的代码:</p><pre class="ls lt lu lv fd nc nd ne nf aw ng bi"><span id="53d4" class="lz ju hi nd b fi nh ni l nj nk">frequent_itemsets = apriori(basket_sets, min_support=0.07, use_colnames=<strong class="nd hj">True</strong>)</span></pre><p id="6b21" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">最后，我们可以基于应得的置信度、支持度和提升阈值来生成关联规则和过滤规则。</p><pre class="ls lt lu lv fd nc nd ne nf aw ng bi"><span id="eec0" class="lz ju hi nd b fi nh ni l nj nk">rules = association_rules(frequent_itemsets, metric="lift", min_threshold=1)</span></pre><p id="64b9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">生成结果后，我们可以应用带有阈值的过滤器来选择具有更强提升或置信度值的规则:</p><p id="c4d5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="ku"> Lift=6 </em></p><p id="ca5f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="ku">信心=0.8 </em></p><pre class="ls lt lu lv fd nc nd ne nf aw ng bi"><span id="3d07" class="lz ju hi nd b fi nh ni l nj nk">rules[ (rules['lift'] &gt;= 6) &amp;<br/>       (rules['confidence'] &gt;= 0.8) ]</span></pre><p id="43b6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">生成的规则可以应用于商店记录，并用于产品放置和推荐。要更全面地了解代码实现及其结果，请查看笔记本中的完整代码。</p></div><div class="ab cl mq mr gp ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="hb hc hd he hf"><h1 id="606e" class="jt ju hi bd jv jw mx jy jz ka my kc kd ke mz kg kh ki na kk kl km nb ko kp kq bi translated">参考</h1><ol class=""><li id="e7ce" class="ld le hi ix b iy ky jc kz jg mn jk mo jo mp js li lj lk ll bi translated">麦肯锡(MacKenzie，I .)，迈耶(Meyer，c .)，&amp; Noble，s .，<a class="ae iu" href="https://www.mckinsey.com/industries/retail/our-insights/how-retailers-can-keep-up-with-consumers" rel="noopener ugc nofollow" target="_blank"> <em class="ku">零售商如何跟上消费者</em> </a> <em class="ku"> </em> (2018)，麦肯锡&amp;公司。<a class="ae iu" href="https://www.mckinsey.com/industries/retail/our-insights/how-retailers-can-keep-up-with-consumers" rel="noopener ugc nofollow" target="_blank">https://www . McKinsey . com/industries/retail/our-insights/how-retailers-can-keep-up-with-consumers</a></li><li id="cae2" class="ld le hi ix b iy lm jc ln jg lo jk lp jo lq js li lj lk ll bi translated">史蒂夫·斯沃耶，<a class="ae iu" href="https://tdwi.org/articles/2016/11/15/beer-and-diapers-impossible-correlation.aspx" rel="noopener ugc nofollow" target="_blank">啤酒和尿布:不可能的关联</a> (2016)，用智能转换数据。</li><li id="afb9" class="ld le hi ix b iy lm jc ln jg lo jk lp jo lq js li lj lk ll bi translated">克里斯·莫菲特，<a class="ae iu" href="https://github.com/chris1610/pbpython/blob/master/notebooks/Market_Basket_Intro.ipynb" rel="noopener ugc nofollow" target="_blank">市场篮子分析介绍</a> (2016)，GitHub。</li></ol></div></div>    
</body>
</html>