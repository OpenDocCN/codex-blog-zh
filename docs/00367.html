<html>
<head>
<title>Transfer Files to S3 Using REST API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用REST API将文件传输到S3</h1>
<blockquote>原文：<a href="https://medium.com/codex/transfer-files-to-s3-using-rest-api-3bb1823f04d9?source=collection_archive---------4-----------------------#2021-01-23">https://medium.com/codex/transfer-files-to-s3-using-rest-api-3bb1823f04d9?source=collection_archive---------4-----------------------#2021-01-23</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><h2 id="1623" class="hg hh hi bd b fp hj hk hl hm hn ho dx hp translated" aria-label="kicker paragraph"><a class="ae ge" href="http://medium.com/codex" rel="noopener">法典</a></h2><div class=""/><div class=""><h2 id="bd2a" class="pw-subtitle-paragraph io hr hi bd b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf dx translated">使用PowerShell调用API并得到后端的通知。</h2></div><figure class="jh ji jj jk fd jl er es paragraph-image"><div class="er es jg"><img src="../Images/2edba78ac93faacafc806f878ed88a31.png" data-original-src="https://miro.medium.com/v2/resize:fit:766/format:webp/1*Gidhama5lls266CsJt_bOg.png"/></div></figure><h1 id="8f37" class="jo jp hi bd jq jr js jt ju jv jw jx jy ix jz iy ka ja kb jb kc jd kd je ke kf bi translated">我的使用案例</h1><p id="5c75" class="pw-post-body-paragraph kg kh hi ki b kj kk is kl km kn iv ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">我有时会被问到:“你更喜欢用哪种方法将文件传输到S3？”我的回答是:“适合你的那个”。<em class="lc">作品</em>的定义因情况而异。最简单的方法是将bucket公开。如果不希望这样，则创建一个对S3存储桶具有编程访问权限的用户，或者创建一个拥有足够权限承担允许访问S3存储桶的角色的用户。问题是我可能会有很多用户身份。我可以使用Cognito [ <a class="ae ld" href="https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-identity.html" rel="noopener ugc nofollow" target="_blank"> 1 </a> ]来实现身份联合，以便更好地管理它。不用说，有不同的方法来请求临时安全凭证，每种方法都使用[ <a class="ae ld" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_temp_request.html#stsapi_comparison" rel="noopener ugc nofollow" target="_blank"> 2 </a> ]。</p><p id="3fc8" class="pw-post-body-paragraph kg kh hi ki b kj le is kl km lf iv ko kp lg kr ks kt lh kv kw kx li kz la lb hb bi translated">如果您真的不想使用任何用户凭证或身份，或者如果bucket中的对象需要一些处理，会发生什么情况呢？API Gateway-Lambda-S3无服务器模式可以提供帮助。</p><h1 id="86cc" class="jo jp hi bd jq jr js jt ju jv jw jx jy ix jz iy ka ja kb jb kc jd kd je ke kf bi translated">我的解决方案</h1><p id="a668" class="pw-post-body-paragraph kg kh hi ki b kj kk is kl km kn iv ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">我的模式基于集成了Lambda函数的REST API。该函数可以执行任意数量的任务，比如发布预先签名的URL，将对象上传或下载到指定的S3存储桶，向SNS主题发送通知，以及处理上传的对象(本文中没有介绍)。这是一种相对安全的传输文件的方法，因为预签名的URL可以设置为在必要时快速过期。SNS主题可以将所请求的操作通知给系统的涉众。使用S3事件通知作为其他Lambda函数的触发器，可以进一步扩展这个云堆栈。</p><p id="7c1c" class="pw-post-body-paragraph kg kh hi ki b kj le is kl km lf iv ko kp lg kr ks kt lh kv kw kx li kz la lb hb bi translated">通过应用程序或脚本实现自动化来充当用户和云之间的代理，这种云堆栈的可用性得到了提高。我更喜欢使用PowerShell来做这件事，因为在脚本中引入文档很容易。</p><p id="1270" class="pw-post-body-paragraph kg kh hi ki b kj le is kl km lf iv ko kp lg kr ks kt lh kv kw kx li kz la lb hb bi translated">我不打算深入PowerShell编程或集成API Gateway — Lambda响应的细节。后者我一步一步演示，代码包括[ <a class="ae ld" rel="noopener" href="/swlh/integrating-api-gateway-lambda-responses-476a4c0399c1"> 3 </a> ]。相反，我将把重点放在部署和使用方面。</p><h1 id="d0a5" class="jo jp hi bd jq jr js jt ju jv jw jx jy ix jz iy ka ja kb jb kc jd kd je ke kf bi translated">部署和使用</h1><p id="72ba" class="pw-post-body-paragraph kg kh hi ki b kj kk is kl km kn iv ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">为了部署解决方案，您可以克隆我的存储库[ <a class="ae ld" href="https://github.com/DanielEIlie/short-examples" rel="noopener ugc nofollow" target="_blank"> 4 </a> ]。您需要的代码可以通过“readme.md”中的链接找到，该链接位于与本文标题相同的标题下。无需深入细节，您需要:</p><ul class=""><li id="8917" class="lj lk hi ki b kj le km lf kp ll kt lm kx ln lb lo lp lq lr bi translated">准备承载代码的S3桶</li><li id="a8de" class="lj lk hi ki b kj ls km lt kp lu kt lv kx lw lb lo lp lq lr bi translated">创建CloudFormation堆栈:该堆栈最重要的输出是REST API Prod端点Url和Lambda Arn，它们用于</li><li id="ed86" class="lj lk hi ki b kj ls km lt kp lu kt lv kx lw lb lo lp lq lr bi translated">允许API调用Lambda:通过执行相关的CLI命令</li><li id="9231" class="lj lk hi ki b kj ls km lt kp lu kt lv kx lw lb lo lp lq lr bi translated">准备PowerShell脚本:通过编写正确的URI变量</li></ul><p id="8fdb" class="pw-post-body-paragraph kg kh hi ki b kj le is kl km lf iv ko kp lg kr ks kt lh kv kw kx li kz la lb hb bi translated">所有这些步骤都详细记录在位于<em class="lc">CFN-s3premiedurl</em>文件夹中的“readme.md”中。</p><p id="a411" class="pw-post-body-paragraph kg kh hi ki b kj le is kl km lf iv ko kp lg kr ks kt lh kv kw kx li kz la lb hb bi translated">在调用脚本之前，我建议阅读文档。使用PowerShell控制台，键入<em class="lc">帮助。/Transfer-Files.ps1 -Example </em>。我推荐PowerShell Core，但是任何最新的版本都可以。该脚本支持重命名对象，只需为目标指定一个不同于源的名称。在上载操作中省略了S3键的情况下，基于UTC日期时间的自动前缀被添加到对象中。如果您已经用通知主题确认了订阅，那么每次调用该脚本时，您的收件箱中都会收到一封电子邮件。</p></div><div class="ab cl lx ly gp lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="hb hc hd he hf"><p id="59e9" class="pw-post-body-paragraph kg kh hi ki b kj le is kl km lf iv ko kp lg kr ks kt lh kv kw kx li kz la lb hb bi translated">我希望您觉得这篇文章很有用，并且在剖析各种组件的过程中获得了一些乐趣。在我的例子中，最耗时的部分是确保PowerShell脚本被正确记录。如果您在使用脚本时没有任何问题，这意味着我已经正确地完成了。</p><p id="c195" class="pw-post-body-paragraph kg kh hi ki b kj le is kl km lf iv ko kp lg kr ks kt lh kv kw kx li kz la lb hb bi translated">请随时将您的意见发送给我…</p><h1 id="6f8b" class="jo jp hi bd jq jr js jt ju jv jw jx jy ix jz iy ka ja kb jb kc jd kd je ke kf bi translated">进一步阅读</h1><p id="9620" class="pw-post-body-paragraph kg kh hi ki b kj kk is kl km kn iv ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">[1] <a class="ae ld" href="https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-identity.html" rel="noopener ugc nofollow" target="_blank">亚马逊认知身份池(联合身份)</a></p><p id="fcaf" class="pw-post-body-paragraph kg kh hi ki b kj le is kl km lf iv ko kp lg kr ks kt lh kv kw kx li kz la lb hb bi translated">[2] <a class="ae ld" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_temp_request.html#stsapi_comparison" rel="noopener ugc nofollow" target="_blank">比较AWS STS API操作</a></p><p id="d4fc" class="pw-post-body-paragraph kg kh hi ki b kj le is kl km lf iv ko kp lg kr ks kt lh kv kw kx li kz la lb hb bi translated">[3] <a class="ae ld" rel="noopener" href="/swlh/integrating-api-gateway-lambda-responses-476a4c0399c1">集成API网关— Lambda响应</a></p><p id="5a22" class="pw-post-body-paragraph kg kh hi ki b kj le is kl km lf iv ko kp lg kr ks kt lh kv kw kx li kz la lb hb bi translated">[4] <a class="ae ld" href="https://github.com/DanielEIlie/short-examples" rel="noopener ugc nofollow" target="_blank">简短范例库</a></p><p id="7c0c" class="pw-post-body-paragraph kg kh hi ki b kj le is kl km lf iv ko kp lg kr ks kt lh kv kw kx li kz la lb hb bi translated">[5] <a class="ae ld" href="https://github.com/PowerShell/PowerShell" rel="noopener ugc nofollow" target="_blank"> PowerShell存储库</a></p></div></div>    
</body>
</html>