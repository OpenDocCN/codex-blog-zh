<html>
<head>
<title>Elasticsearch for Dummies: Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">假人的弹性研究:第一部分</h1>
<blockquote>原文：<a href="https://medium.com/codex/elasticsearch-for-dummies-part-1-be184a739b60?source=collection_archive---------0-----------------------#2021-04-25">https://medium.com/codex/elasticsearch-for-dummies-part-1-be184a739b60?source=collection_archive---------0-----------------------#2021-04-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/e6742fff110b23dc37cc509e520196c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:636/format:webp/1*MF4PZLr8lc5DjuJJnDXBAw.png"/></div></figure><p id="5eda" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我最喜欢的技术之一是Elasticsearch(从现在开始我将称之为Elastic)。Elastic是一个开源的搜索引擎，非常灵活和强大。我可以给出无数的<a class="ae jk" href="https://www.elastic.co/customers/" rel="noopener ugc nofollow" target="_blank">用例</a>来说明在哪里以及为什么使用Elastic，但是这将偏离本文的目的。</p><p id="dcd0" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这个系列是献给那些傻瓜们的。这是写给那些已经意识到他们对弹性一无所知并且愿意承认这一点的人的。对于那些体现了以下莎士比亚的报价:</p><figure class="jm jn jo jp fd ij er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es jl"><img src="../Images/33aaecb261b3d541bab28f04af0f1f76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YmD5Egizw5Itw4IVS6D3ZQ.png"/></div></div><figcaption class="ju jv et er es jw jx bd b be z dx translated">威廉·莎士比亚。信用:【tymoff.com】T4</figcaption></figure><p id="f89f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">当我试图自己解决所有这些问题时，这些文章是我希望存在的资源。我希望这将有助于、激励和简化你在软件工程的广阔世界中的旅程。</p><p id="1157" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们开始吧，好吗？</p></div><div class="ab cl jy jz gp ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="hb hc hd he hf"><h1 id="b402" class="kf kg hi bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">搭建舞台</h1><p id="d618" class="pw-post-body-paragraph im in hi io b ip ld ir is it le iv iw ix lf iz ja jb lg jd je jf lh jh ji jj hb bi translated">是时候发挥你的想象力了:你刚刚拿到了一个硬盘<a class="ae jk" href="https://github.com/timothestes/elastic-for-dummies/tree/main/shakespeare_hard_drive" rel="noopener ugc nofollow" target="_blank">,里面有威廉·莎士比亚所有出版的作品，现在就看你怎么把它放进橡皮筋里了。</a></p><p id="ba86" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们将开始索引莎士比亚的全部作品，但现在让我们从我之前引用的戏剧《如你所愿》中的一句开始。数据是JSON格式的，这样更容易放入Elastic。</p><pre class="jm jn jo jp fd li lj lk ll aw lm bi"><span id="3cbe" class="ln kg hi lj b fi lo lp l lq lr">{<br/>    "type": "line",<br/>    "line_id": 18122,<br/>    "play_name": "As you like it",<br/>    "speech_number": 19,<br/>    "line_number": "5.1.28",<br/>    "speaker": "TOUCHSTONE",<br/>    "text_entry": "The fool doth think he is wise, but the wise man knows himself to be a fool."<br/>}</span></pre><p id="501b" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">对于那些不熟悉的人来说，JSON只是一种使用键-值对存储数据的方式(你们Python人可能会认为这是一个<a class="ae jk" href="https://realpython.com/lessons/dictionary-python/" rel="noopener ugc nofollow" target="_blank"> Python字典</a>！)</p><p id="72df" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">看资料可以看到，这条线属于一个叫试金石的老乡，线号是<code class="du ls lt lu lj b">5.1.28</code>。现在不是非常有用的信息，但也许我们以后可以用它做一些很酷的事情。</p><p id="0d0f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们来制定一个游戏计划。我们需要做以下事情(如果你不知道每一步意味着什么也没关系):</p><ol class=""><li id="82a0" class="lv lw hi io b ip iq it iu ix lx jb ly jf lz jj ma mb mc md bi translated">旋转沙盒弹性集群。</li><li id="0930" class="lv lw hi io b ip me it mf ix mg jb mh jf mi jj ma mb mc md bi translated">创建一个索引来存储我们的数据。</li><li id="5432" class="lv lw hi io b ip me it mf ix mg jb mh jf mi jj ma mb mc md bi translated">将我们的文件插入索引中。</li></ol></div><div class="ab cl jy jz gp ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="hb hc hd he hf"><h1 id="d101" class="kf kg hi bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">旋转您的第一个集群</h1><p id="6ac1" class="pw-post-body-paragraph im in hi io b ip ld ir is it le iv iw ix lf iz ja jb lg jd je jf lh jh ji jj hb bi translated">首先，将Elastic下载到您的本地计算机上，为您的系统选择合适的下载文件(您可以在这里找到下载文件<a class="ae jk" href="https://www.elastic.co/downloads/elasticsearch" rel="noopener ugc nofollow" target="_blank"/>)。</p><p id="9554" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">要让Elastic在Mac上运行:</p><ul class=""><li id="c7f5" class="lv lw hi io b ip iq it iu ix lx jb ly jf lz jj mj mb mc md bi translated">下载并解压你下载的文件，并将<code class="du ls lt lu lj b">cd</code>放入解压后的目录。</li><li id="2fee" class="lv lw hi io b ip me it mf ix mg jb mh jf mi jj mj mb mc md bi translated">编辑config目录中的elasticsearch.yml文件，并禁用xpack-security特性标志。为了学习Elasticsearch，我不想让我们陷入认证和安全的细节中。仅在本地开发和易于测试时执行此步骤，不要在生产用例中执行。</li></ul><figure class="jm jn jo jp fd ij er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es mk"><img src="../Images/e18712201d9925774b415d0ef4588dec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HVRGH_9ZRny01cCSv499Kg.png"/></div></div><figcaption class="ju jv et er es jw jx bd b be z dx translated">禁用xpack身份验证(暂时)</figcaption></figure><ul class=""><li id="e3a9" class="lv lw hi io b ip iq it iu ix lx jb ly jf lz jj mj mb mc md bi translated">要启动elasticsearch，请运行<code class="du ls lt lu lj b">bin/elasticsearch</code>(或在Windows上运行<code class="du ls lt lu lj b">bin\elasticsearch.bat</code>)</li><li id="3936" class="lv lw hi io b ip me it mf ix mg jb mh jf mi jj mj mb mc md bi translated">为了验证集群已经启动并正在运行，让我们在一个单独的终端会话中向<code class="du ls lt lu lj b">http://localhost:9200/</code>发出一个未经身份验证的请求:</li></ul><pre class="jm jn jo jp fd li lj lk ll aw lm bi"><span id="2a54" class="ln kg hi lj b fi lo lp l lq lr">➜ curl <a class="ae jk" href="http://localhost:9200" rel="noopener ugc nofollow" target="_blank">http://localhost:9200</a><br/>{<br/>  "name" : "Tims-MacBook-Pro.local",<br/>  "cluster_name" : "elasticsearch",<br/>  "cluster_uuid" : "JZcAF-F1S-y-CmBtQ-roOQ",<br/>  "version" : {<br/>    "number" : "8.4.3",<br/>    "build_flavor" : "default",<br/>    "build_type" : "tar",<br/>    "build_hash" : "42f05b9372a9a4a470db3b52817899b99a76ee73",<br/>    "build_date" : "2022-10-04T07:17:24.662462378Z",<br/>    "build_snapshot" : false,<br/>    "lucene_version" : "9.3.0",<br/>    "minimum_wire_compatibility_version" : "7.17.0",<br/>    "minimum_index_compatibility_version" : "7.0.0"<br/>  },<br/>  "tagline" : "You Know, for Search"<br/>}</span></pre><p id="ed01" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在，让我们将可信的VSCode IDE连接到本地集群，这样我们就可以通过一些简单的REST APIs与它对话。</p><p id="63c3" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">要将本地弹性集群连接到VSCode:</p><ul class=""><li id="a9a9" class="lv lw hi io b ip iq it iu ix lx jb ly jf lz jj mj mb mc md bi translated">下载VSCode 扩展的<a class="ae jk" href="https://marketplace.visualstudio.com/items?itemName=ria.elastic" rel="noopener ugc nofollow" target="_blank"> Elasticsearch。</a></li><li id="ae56" class="lv lw hi io b ip me it mf ix mg jb mh jf mi jj mj mb mc md bi translated">在VSCode中创建新文件<code class="du ls lt lu lj b">hello_world.es.</code></li><li id="fbf6" class="lv lw hi io b ip me it mf ix mg jb mh jf mi jj mj mb mc md bi translated">当您创建一个启用了扩展名的<code class="du ls lt lu lj b">.es</code>文件时，它会提示您指定连接(您可以保留<code class="du ls lt lu lj b">localhost:9200</code>):</li></ul><figure class="jm jn jo jp fd ij er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es ml"><img src="../Images/bccd14c11251c803dbb5e1a0ce0b5d83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l_E8woum7dDFRnHTb416NQ.png"/></div></div></figure><ul class=""><li id="9897" class="lv lw hi io b ip iq it iu ix lx jb ly jf lz jj mj mb mc md bi translated">为了验证我们已经连接到我们的沙盒集群，在新文件中键入<code class="du ls lt lu lj b">GET _cluster/health </code>并按<code class="du ls lt lu lj b">ctrl+enter </code>运行命令。您应该会看到类似这样的内容:</li></ul><figure class="jm jn jo jp fd ij er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es mm"><img src="../Images/49a53178a805233cb4f706ad3f2dab43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nAyz11MB2OrpfFfHb-J9Rw.png"/></div></div></figure><p id="9132" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">恭喜:您刚刚创建了您的第一个集群！</p><figure class="jm jn jo jp fd ij er es paragraph-image"><div class="er es mn"><img src="../Images/84734b382a9d1433b22cbae7e45c5922.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/1*WxcI8dJPfJ9ZgpZY4-uSPA.gif"/></div><figcaption class="ju jv et er es jw jx bd b be z dx translated">你的第一个集群是ALIVEEEEE！</figcaption></figure></div><div class="ab cl jy jz gp ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="hb hc hd he hf"><h1 id="1432" class="kf kg hi bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">创建您的第一个索引</h1><p id="da98" class="pw-post-body-paragraph im in hi io b ip ld ir is it le iv iw ix lf iz ja jb lg jd je jf lh jh ji jj hb bi translated">首先，一些词汇:</p><ul class=""><li id="704f" class="lv lw hi io b ip iq it iu ix lx jb ly jf lz jj mj mb mc md bi translated">简单地说，一个<em class="mo">索引</em>是我们存储<em class="mo">文档</em>的一个极其优化的地方。索引通常由许多文档组成。</li><li id="e3d6" class="lv lw hi io b ip me it mf ix mg jb mh jf mi jj mj mb mc md bi translated"><em class="mo">文档</em>是一个或多个键值对的集合，我们可以对其进行搜索和过滤(想象一下类似于我们之前谈到的Shakespeare JSON对象)。</li><li id="c1e1" class="lv lw hi io b ip me it mf ix mg jb mh jf mi jj mj mb mc md bi translated">集群是我们存储和管理<em class="mo">索引</em>的地方。</li></ul><figure class="jm jn jo jp fd ij er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es mp"><img src="../Images/85af715e124e2e7319ed79821836e58b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YfwY-jK_Q2pRI6xCa9MgSw.png"/></div></div><figcaption class="ju jv et er es jw jx bd b be z dx translated">文档、索引和集群之间的关系</figcaption></figure><p id="c579" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在将文档放入集群之前，我们首先要创建一个索引。要创建您的第一个索引，请在您的<code class="du ls lt lu lj b">hello_world.es</code>文件中运行<code class="du ls lt lu lj b">PUT hello_world</code>:</p><figure class="jm jn jo jp fd ij er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es mq"><img src="../Images/4caaf4c589b32aea6c45bc8b08b21429.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Kw73Z2iCiXnVezZs5lSvHA.png"/></div></div></figure><p id="fa10" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在现实世界中，建立一个索引通常比这更复杂，但是我们现在尽量保持简单。我希望你把注意力放在概念上，而不是细节上(细节可以稍后再来)。</p><p id="e8e6" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在我们已经创建了一个索引，我们准备开始索引文档。</p></div><div class="ab cl jy jz gp ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="hb hc hd he hf"><h1 id="6182" class="kf kg hi bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">将文档插入第一个集群</h1><p id="57ec" class="pw-post-body-paragraph im in hi io b ip ld ir is it le iv iw ix lf iz ja jb lg jd je jf lh jh ji jj hb bi translated">如果你不喜欢打字，复制粘贴<a class="ae jk" href="https://github.com/timothestes/elastic-for-dummies/blob/main/part_1/put_document.es" rel="noopener ugc nofollow" target="_blank"> put_document.es </a>文件，运行<code class="du ls lt lu lj b">PUT hello_world/_doc/1</code>命令:</p><figure class="jm jn jo jp fd ij er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es mr"><img src="../Images/ef4d9c8506f5ecdd4c4ceb3d7ca58f9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AYbmflSbqFb6f6QM-5iyOQ.png"/></div></div></figure><p id="248b" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">让我们来分解一下刚刚发出的命令:<code class="du ls lt lu lj b">PUT hello_world/_doc/1</code></p><ul class=""><li id="50e2" class="lv lw hi io b ip iq it iu ix lx jb ly jf lz jj mj mb mc md bi translated">PUT指定动作类型。我们想<em class="mo">放</em>一个文档。</li><li id="0ff9" class="lv lw hi io b ip me it mf ix mg jb mh jf mi jj mj mb mc md bi translated"><code class="du ls lt lu lj b">hello_world</code>是我们要将文档放入的索引</li><li id="7c36" class="lv lw hi io b ip me it mf ix mg jb mh jf mi jj mj mb mc md bi translated"><code class="du ls lt lu lj b">_doc/1</code>是指定doc_id(与索引中的文档相关联的唯一id)的语法</li></ul><p id="4286" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">但是我们如何知道文档被编入了索引呢？嗯，我们从集群得到了一个成功的响应，但是为了确定，让我们进行第一次弹性查询并手动找到那个文档。</p></div><div class="ab cl jy jz gp ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="hb hc hd he hf"><h1 id="1bc2" class="kf kg hi bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">制作您的第一个弹性查询</h1><p id="1b08" class="pw-post-body-paragraph im in hi io b ip ld ir is it le iv iw ix lf iz ja jb lg jd je jf lh jh ji jj hb bi translated">Elastic使用基于JSON的专用查询DSL(领域特定语言)来定义查询。让自己习惯于查询语法将会有很大的帮助，所以不要盲目地将代码片段复制并粘贴到文件中！打几个出来可以帮助你理解它们的结构。</p><p id="40fb" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">要进行查询，我们首先必须决定要查询哪些字段。引用是我们想要找到的文档中最令人难忘的部分，所以让我们在<code class="du ls lt lu lj b">text_entry</code>字段中进行文本匹配短语查询。</p><p id="dd8e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">下面的<a class="ae jk" href="https://github.com/timothestes/elastic-for-dummies/blob/main/part_1/find_document.es" rel="noopener ugc nofollow" target="_blank">查询</a>将搜索其<code class="du ls lt lu lj b">text_entry</code>字段包含短语“傻瓜确实在想”的文档(加上一些高亮显示以准确显示我们找到的内容):</p><figure class="jm jn jo jp fd ij er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es ms"><img src="../Images/fc6d8169301ebd185b477da7dcb31a36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HDrXnCf4FoDrhSi2a1clhg.png"/></div></div></figure><p id="ab3e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">因为我们要求突出显示，我们可以在<code class="du ls lt lu lj b">response.json</code>中看到我们搜索的短语！超级酷。</p><p id="8d8f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">让我们换个话题:如果我们搜索“勇敢的傻瓜会思考”这个短语，你认为会发生什么？(注意我在查询中添加了一个额外的单词)</p><figure class="jm jn jo jp fd ij er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es mt"><img src="../Images/cd47cc0efe824796def33eef0adfe707.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lFUoraFXu6FpvB-88s2icQ.png"/></div></div></figure><p id="3894" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">如果你猜我们不会有结果，那你就猜对了！这是因为<code class="du ls lt lu lj b">match_phrase</code>查询只寻找精确的短语匹配。</p></div><div class="ab cl jy jz gp ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="hb hc hd he hf"><p id="3fa4" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们的第一次会议到此结束。要进行清理，请在运行集群的终端中使用命令<code class="du ls lt lu lj b">ctrl+c</code>来停止集群。</p><p id="1fba" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">如果你能走到这一步，我为你感到骄傲！希望您在概念层面上理解了什么是文档、索引和集群。您能够成功地创建您的第一个索引，索引您的第一个文档，然后进行您的第一个弹性查询。</p><p id="2288" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这只是冰山一角，还有很多东西要学。在我的下一篇文章中，我将讨论弹性搜索映射和虚拟数据类型…</p></div></div>    
</body>
</html>