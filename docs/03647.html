<html>
<head>
<title>Bokeh: An Interactive Data Visualization Library</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Bokeh:一个交互式数据可视化库</h1>
<blockquote>原文：<a href="https://medium.com/codex/bokeh-an-interactive-data-visualization-library-6dfbfb1c596c?source=collection_archive---------6-----------------------#2021-09-13">https://medium.com/codex/bokeh-an-interactive-data-visualization-library-6dfbfb1c596c?source=collection_archive---------6-----------------------#2021-09-13</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="0f68" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated"><strong class="ak">使用散景创建显示在Jupyter笔记本上的交互式可视化效果</strong></h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es ix"><img src="../Images/472c9dd94d7d59c7f759d4e2cfd9513b.png" data-original-src="https://miro.medium.com/v2/resize:fit:982/format:webp/1*8-qdwscPpRZETSM9R0XYww.png"/></div></figure><p id="a4ca" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">原文可以在<a class="ae kb" href="https://developers.refinitiv.com/en/article-catalog/article/bokeh--an-interactive-data-visualization-library-in-codebook" rel="noopener ugc nofollow" target="_blank">路孚特开发者社区</a>上找到。</p><h1 id="1e6c" class="kc kd hi bd ke kf kg kh ki kj kk kl km io kn ip ko ir kp is kq iu kr iv ks kt bi translated">散景概述</h1><p id="a4eb" class="pw-post-body-paragraph jf jg hi jh b ji ku ij jk jl kv im jn jo kw jq jr js kx ju jv jw ky jy jz ka hb bi translated">Bokeh是一个Python库，用于为现代web浏览器创建交互式可视化，包括Jupyter Notebook和路孚特码本。它允许用户几乎不需要太多调整就可以创建现成的吸引人的图表。</p><p id="178f" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">散景从2013年就有了。它的目标是让现代网络浏览器呈现交互式可视化，而不是静态图像。Bokeh提供了多种语言的库，比如Python、R、Lua和Julia。这些库为BokehJS(一个Javascript库)生成JSON数据，BokehJS反过来创建在现代web浏览器上显示的交互式可视化。散景有很多好处，包括:</p><ul class=""><li id="d9b4" class="kz la hi jh b ji jj jl jm jo lb js lc jw ld ka le lf lg lh bi translated"><strong class="jh hj">从简单到复杂的可视化:</strong>散景提供了不同的界面，面向不同技能水平的用户。用户可以使用基本界面实现快速简单的可视化，也可以使用高级界面实现更加复杂和高度可定制的可视化。</li><li id="b352" class="kz la hi jh b ji li jl lj jo lk js ll jw lm ka le lf lg lh bi translated"><strong class="jh hj">易于与Pandas一起使用:</strong> Bokeh提供了<strong class="jh hj"> ColumnDataSource </strong>类，这是Bokeh的基本数据结构。大多数图、数据表等。将由一个<strong class="jh hj">列数据源</strong>驱动。用户还可以将Pandas数据框指定为绘制图表的数据源。</li><li id="bb41" class="kz la hi jh b ji li jl lj jo lk js ll jw lm ka le lf lg lh bi translated"><strong class="jh hj">支持多种输出媒介:</strong>散景的输出可以在包括Jupyter Notebook在内的现代网络浏览器上显示。输出也可以导出到HTML文件。此外，通过在散景服务器上运行，散景可以用于创建交互式web应用程序。</li></ul><p id="d763" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">散景为用户提供了不同级别的界面，从具有很少可定制参数的基本绘图到完全控制其可视化的高级绘图。通常，接口分为两个级别:</p><ul class=""><li id="abc6" class="kz la hi jh b ji jj jl jm jo lb js lc jw ld ka le lf lg lh bi translated"><strong class="jh hj"> bokeh.plotting: </strong>堪比Matplotlib的中级接口。工作流是创建一个图形，然后用不同的元素来丰富这个图形，这些元素呈现图形中的数据点。</li><li id="1043" class="kz la hi jh b ji li jl lj jo lk js ll jw lm ka le lf lg lh bi translated"><strong class="jh hj"> bokeh.models </strong>:为应用开发者提供最大灵活性的底层接口。该界面提供了对如何组合、配置和显示散景图的完全控制。</li></ul><p id="ed4e" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">本文中的例子主要依赖于<strong class="jh hj"> bokeh.plotting </strong>接口。您可以参考<a class="ae kb" href="https://docs.bokeh.org/en/latest/docs/gallery.html" rel="noopener ugc nofollow" target="_blank">散景图库</a>获取可用图表和示例列表。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es ln"><img src="../Images/bc87136b0bc2fb869cddb434c6c597d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:774/format:webp/1*Dsr8rO-ljw1FmfI9nMc4pA.jpeg"/></div></figure><h1 id="3d8a" class="kc kd hi bd ke kf kg kh ki kj kk kl km io kn ip ko ir kp is kq iu kr iv ks kt bi translated">路孚特码本</h1><p id="77cd" class="pw-post-body-paragraph jf jg hi jh b ji ku ij jk jl kv im jn jo kw jq jr js kx ju jv jw ky jy jz ka hb bi translated">CodeBook是路孚特Eikon或Workspace中的一个应用程序，允许用户访问Python脚本的云托管开发环境，并利用路孚特API快速构建和部署符合工作流需求的模型、应用程序和分析。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es lo"><img src="../Images/2f9bbed278fa65d5847640dc3c1131dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K4kIBhXZq8mMmUBUjVvIIQ.jpeg"/></div></div></figure><p id="66a1" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">CodeBook为开发人员或数据科学家提供了许多预装的Python库，以从路孚特的平台检索数据、处理数据、绘制图表、构建机器学习模型等。</p><p id="b90e" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">Bokeh是码本环境中预装的可视化Python库之一。除了Bokeh，CodeBook中还有其他可用的图表库，如altair、bqplot、matplotlib、plotly和seaborn。</p><p id="c9b4" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">本文演示了如何使用散景来可视化从路孚特API中检索的财务数据。</p><h1 id="d3b3" class="kc kd hi bd ke kf kg kh ki kj kk kl km io kn ip ko ir kp is kq iu kr iv ks kt bi translated">示例用法</h1><p id="026d" class="pw-post-body-paragraph jf jg hi jh b ji ku ij jk jl kv im jn jo kw jq jr js kx ju jv jw ky jy jz ka hb bi translated">下面的示例演示了如何使用散景来绘制几个图表，以可视化从Eikon数据API检索的财务数据。这些示例还展示了如何创建布局以在笔记本单元格中显示图表。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es lt"><img src="../Images/0bfec6400f6944208780f5ba6be387ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DBLJ-ctENqSt5EyDjY9O8A.png"/></div></div></figure><p id="60f2" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">请按照下面的步骤运行示例。</p><h1 id="ebc6" class="kc kd hi bd ke kf kg kh ki kj kk kl km io kn ip ko ir kp is kq iu kr iv ks kt bi translated">先决条件</h1><p id="46a4" class="pw-post-body-paragraph jf jg hi jh b ji ku ij jk jl kv im jn jo kw jq jr js kx ju jv jw ky jy jz ka hb bi translated">代码可以在安装了散景和Eikon数据API库的路孚特码本或Jupyter笔记本上运行。您可以从Libraries&amp;Extensions.md文件中验证路孚特码本中安装的散景的版本。</p><h1 id="439a" class="kc kd hi bd ke kf kg kh ki kj kk kl km io kn ip ko ir kp is kq iu kr iv ks kt bi translated">导入所需的库</h1><p id="4051" class="pw-post-body-paragraph jf jg hi jh b ji ku ij jk jl kv im jn jo kw jq jr js kx ju jv jw ky jy jz ka hb bi translated">首先，导入Python库，如Eikon数据API、Bokeh和实用程序，以检索数据、处理数据和绘制图表。</p><pre class="iy iz ja jb fd lu lv lw lx aw ly bi"><span id="0596" class="lz kd hi lv b fi ma mb l mc md">import refinitiv.dataplatform.eikon as ek<br/>from bokeh.plotting import figure, show<br/>from bokeh.io import output_notebook<br/>from bokeh.models import ColumnDataSource, CDSView, BooleanFilter, HoverTool, FactorRange<br/>from bokeh.transform import factor_cmap, cumsum<br/>from bokeh.layouts import row, column, gridplot<br/>from bokeh.models.widgets import Tabs, Panel<br/>import pandas as pd<br/>from math import pi<br/>import datetime</span></pre><p id="741c" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">然后用application key初始化Eikon数据API，调用<strong class="jh hj"> output_notebook() </strong>方法，配置默认输出状态，在调用<strong class="jh hj"> show() </strong>方法时，在笔记本单元格中生成输出。</p><pre class="iy iz ja jb fd lu lv lw lx aw ly bi"><span id="6c5f" class="lz kd hi lv b fi ma mb l mc md">ek.set_app_key('DEFAULT_CODE_BOOK_APP_KEY')<br/>output_notebook()</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es me"><img src="../Images/963c691d65f8e59fda7be432a1b5c0e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:618/format:webp/1*ktbnUL_20rl3jr71ktMZDw.png"/></div></figure><h1 id="f6bc" class="kc kd hi bd ke kf kg kh ki kj kk kl km io kn ip ko ir kp is kq iu kr iv ks kt bi translated">折线图</h1><p id="84c5" class="pw-post-body-paragraph jf jg hi jh b ji ku ij jk jl kv im jn jo kw jq jr js kx ju jv jw ky jy jz ka hb bi translated">此示例显示如何使用散景绘制折线图，显示从Eikon数据API检索的每日历史收盘价。</p><p id="e714" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">调用Eikon数据API的<strong class="jh hj"> get_timeseries </strong>方法来检索IBM.N的每日历史收盘价。</p><pre class="iy iz ja jb fd lu lv lw lx aw ly bi"><span id="237e" class="lz kd hi lv b fi ma mb l mc md">df1 = ek.get_timeseries('IBM.N',<br/>   fields=['CLOSE'],<br/>   start_date=datetime.timedelta(days=-365),<br/>   end_date=datetime.datetime.now(),<br/>   interval='daily')<br/>df1</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mf"><img src="../Images/bde46800aea37414eaa1c06c5f2144c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:322/format:webp/1*tf6P_ZknzLFyuxjKie8lNw.png"/></div></figure><p id="c351" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">然后，它创建一个散景图并向该图添加一个折线图。它将从<strong class="jh hj"> get_timeseires </strong>方法中检索的数据帧指定为折线图的数据源，以绘制来自<strong class="jh hj"> Date </strong>和<strong class="jh hj"> CLOSE </strong>列的数据。它还向图中添加了一个悬停工具，以便当光标悬停在折线图上时以交互方式显示数据。接下来，它调用<strong class="jh hj"> show </strong>方法来显示图形。</p><pre class="iy iz ja jb fd lu lv lw lx aw ly bi"><span id="d51c" class="lz kd hi lv b fi ma mb l mc md">figure1 = figure(title="Daily Close Price (IBM.N)",          <br/>           x_axis_type="datetime",<br/>           x_axis_label='Date')<br/>figure1.line(x='Date', y='CLOSE', source=df1, legend_label="Close")<br/>figure1.add_tools(HoverTool(<br/>    tooltips=[<br/>        ( "Date",  "$x{%F}"            ),<br/>        ( "Price", "$y{"+f"0.00"+" a}" )<br/>    ],<br/>    formatters={<br/>        '$x'      : 'datetime',<br/>    },<br/>))<br/>figure1.legend.location = 'bottom_right'<br/>show(figure1)</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mg"><img src="../Images/30920de07405488671a07dde0efd77cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1134/format:webp/1*ZaJ4dZl34oviycce_bQfXA.png"/></div></figure><h1 id="099a" class="kc kd hi bd ke kf kg kh ki kj kk kl km io kn ip ko ir kp is kq iu kr iv ks kt bi translated">多线折线图</h1><p id="7405" class="pw-post-body-paragraph jf jg hi jh b ji ku ij jk jl kv im jn jo kw jq jr js kx ju jv jw ky jy jz ka hb bi translated">此示例通过添加另一条显示收盘价的15天简单移动平均线来增强前面的折线图。</p><p id="b445" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">它使用<strong class="jh hj">滚动</strong>和<strong class="jh hj">平均</strong>方法计算收盘价的15天简单移动平均线，并在数据框中创建一个包含计算值的新列(<strong class="jh hj"> SMA_15 </strong>)。</p><pre class="iy iz ja jb fd lu lv lw lx aw ly bi"><span id="ec81" class="lz kd hi lv b fi ma mb l mc md">df1['SMA_15'] = df1.CLOSE.rolling(15).mean()<br/>df1</span></pre><p id="59e1" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">然后，它使用类似于上一步的折线图创建了一个新的图形，并向该图形添加了另一条虚线来表示<strong class="jh hj"> SMA_15 </strong>列中的数据</p><pre class="iy iz ja jb fd lu lv lw lx aw ly bi"><span id="6b7d" class="lz kd hi lv b fi ma mb l mc md">figure2.line(x=’Date’, y=’SMA_15', source=df1, legend_label=”SMA 15", line_dash = ‘dashed’, color=”red”, name=”SMA 15")</span></pre><p id="9cbd" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">接下来，它调用<strong class="jh hj"> show </strong>方法来显示图形。</p><pre class="iy iz ja jb fd lu lv lw lx aw ly bi"><span id="63c9" class="lz kd hi lv b fi ma mb l mc md">figure2 = figure(title="Daily Close Price and SMA (IBM.N)",          <br/>           x_axis_type="datetime",<br/>           x_axis_label='Date')<br/> <br/>figure2.line(x='Date', y='CLOSE', source=df1, legend_label="Close", name="CLOSE")<br/>figure2.line(x='Date', y='SMA_15', source=df1, legend_label="SMA 15", line_dash = 'dashed', color="red", name="SMA 15")<br/> <br/>figure2.add_tools(HoverTool(<br/>    tooltips=[<br/>        ( "", "$name"),<br/>        ( "Date",  "$x{%F}"            ),<br/>        ( "Price", "$y{"+f"0.00"+" a}" )<br/>    ],<br/>    formatters={<br/>        '$x'      : 'datetime', <br/>    },<br/>))<br/>figure2.legend.location = 'bottom_right'<br/>show(figure2)</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mh"><img src="../Images/cfc80751e5e9d24bdb032d7c85462039.png" data-original-src="https://miro.medium.com/v2/resize:fit:1074/format:webp/1*ieMmp9RN4ztMkauHHlks7g.png"/></div></figure><h1 id="b19f" class="kc kd hi bd ke kf kg kh ki kj kk kl km io kn ip ko ir kp is kq iu kr iv ks kt bi translated">蜡烛图</h1><p id="54fe" class="pw-post-body-paragraph jf jg hi jh b ji ku ij jk jl kv im jn jo kw jq jr js kx ju jv jw ky jy jz ka hb bi translated">此示例绘制了一个蜡烛图，显示从Eikon数据API检索的每日历史开盘价、最高价、最低价和收盘价。</p><p id="54ba" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">首先，它调用<strong class="jh hj"> get_timeseries </strong>方法来检索IBM.N的每日历史OHLC价格</p><pre class="iy iz ja jb fd lu lv lw lx aw ly bi"><span id="1634" class="lz kd hi lv b fi ma mb l mc md">df2 = ek.get_timeseries('IBM.N',                  <br/>                  start_date=datetime.timedelta(days=-90), <br/>                  end_date=datetime.datetime.now(), <br/>                  interval='daily')<br/>df2</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es mi"><img src="../Images/d3ea835fab398edef30862eec2e5fc87.png" data-original-src="https://miro.medium.com/v2/resize:fit:824/format:webp/1*e5dYV17Iz4EeQhoWLI8xvQ.png"/></div></div></figure><p id="deed" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">然后，它创建一个包含线段和竖线标志符号的新图形。分段图示符用于显示最低价和最高价，竖线图示符用于显示开盘价和收盘价。如果收盘价大于或等于开盘价，竖线符号的颜色将为绿色。否则，竖线标志符号的颜色将为红色。</p><p id="039f" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">它还在图表中添加了一个悬停工具，以便当光标悬停在图表上时以交互方式显示OHLC数据。接下来，它调用<strong class="jh hj"> show </strong>方法来显示图形。</p><pre class="iy iz ja jb fd lu lv lw lx aw ly bi"><span id="01a6" class="lz kd hi lv b fi ma mb l mc md">source = ColumnDataSource(data=df2)<br/>hover = HoverTool(<br/>    tooltips=[<br/>        ('', '<a class="ae kb" href="http://twitter.com/Date" rel="noopener ugc nofollow" target="_blank">@Date</a>{%F}'),<br/>        ('O', '<a class="ae kb" href="http://twitter.com/OPEN" rel="noopener ugc nofollow" target="_blank">@OPEN</a>{"+f"0.00"+" a}'),<br/>        ('H', '<a class="ae kb" href="http://twitter.com/HIGH" rel="noopener ugc nofollow" target="_blank">@HIGH</a>{"+f"0.00"+" a}'),<br/>        ('L', '<a class="ae kb" href="http://twitter.com/LOW" rel="noopener ugc nofollow" target="_blank">@LOW</a>{"+f"0.00"+" a}'),<br/>        ('C', '<a class="ae kb" href="http://twitter.com/CLOSE" rel="noopener ugc nofollow" target="_blank">@CLOSE</a>{"+f"0.00"+" a}'),<br/>        ('V', '<a class="ae kb" href="http://twitter.com/VOLUME" rel="noopener ugc nofollow" target="_blank">@VOLUME</a>{0}'),<br/>    ],<br/> <br/>    formatters={<br/>        '<a class="ae kb" href="http://twitter.com/Date" rel="noopener ugc nofollow" target="_blank">@Date</a>': 'datetime'<br/>    },<br/>    mode='mouse'<br/>)<br/>inc_b = source.data['CLOSE'] &gt;= source.data['OPEN']<br/>inc = CDSView(source=source, filters=[BooleanFilter(inc_b)])<br/>dec_b = source.data['OPEN'] &gt; source.data['CLOSE']<br/>dec = CDSView(source=source, filters=[BooleanFilter(dec_b)])<br/>w = 12*60*60*1000 <br/>figure3 = figure(title="OHLC Candlestick Chart (IBM.N)",<br/>                 x_axis_type="datetime",<br/>                 sizing_mode="stretch_width",<br/>                 height=400,<br/>                 x_axis_label='Date')<br/>figure3.segment(source=source, x0='Date', x1='Date', y0='HIGH', y1='LOW', color="black")<br/>figure3.vbar(source=source, view=inc, x='Date', width=w, top='OPEN', bottom='CLOSE', fill_color="green", line_color="green")<br/>figure3.vbar(source=source, view=dec, x='Date', width=w, top='OPEN', bottom='CLOSE', fill_color="red", line_color="red")<br/>figure3.add_tools(hover)<br/> <br/>show(figure3)</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es mj"><img src="../Images/bad6d9f1a4b16af9789eb54a7154571e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9k6B0Dgpm-z9LSoqF0yIFg.png"/></div></div></figure><h1 id="308d" class="kc kd hi bd ke kf kg kh ki kj kk kl km io kn ip ko ir kp is kq iu kr iv ks kt bi translated">垂直条形图</h1><p id="587c" class="pw-post-body-paragraph jf jg hi jh b ji ku ij jk jl kv im jn jo kw jq jr js kx ju jv jw ky jy jz ka hb bi translated">此示例绘制了一个垂直条形图，显示了前几年的季度历史收入。</p><p id="12c8" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">首先，它调用<strong class="jh hj"> get_data </strong>方法来检索IBM的季度历史收入。n回溯到四年，然后按日期升序对数据进行排序。</p><pre class="iy iz ja jb fd lu lv lw lx aw ly bi"><span id="0ceb" class="lz kd hi lv b fi ma mb l mc md">quarter = pd.Timestamp(datetime.date.today()).quarter<br/>quarter = quarter + 14<br/>quarter = quarter*-1<br/>df3, err = ek.get_data(<br/>    instruments = ['IBM.N'],<br/>    fields = ['TR.Revenue.Date','TR.Revenue'],<br/>    parameters={'SDate':0,'EDate':quarter,'Period':'FQ0','Frq':'FQ'}<br/>)<br/>df3 = df3[::-1].reset_index().drop('index', axis=1)<br/>df3</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mk"><img src="../Images/502ba2b5a762a8183d473e8d3f131262.png" data-original-src="https://miro.medium.com/v2/resize:fit:690/format:webp/1*N-VnZyemBXcHhJz_Z1xY7g.png"/></div></figure><p id="ab9a" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">接下来，它将以下各列添加到数据框中。</p><ul class=""><li id="d1c5" class="kz la hi jh b ji jj jl jm jo lb js lc jw ld ka le lf lg lh bi translated"><strong class="jh hj"> Q </strong>:季度，如Q1、Q2、Q3或Q4。</li><li id="503c" class="kz la hi jh b ji li jl lj jo lk js ll jw lm ka le lf lg lh bi translated"><strong class="jh hj">年份</strong>:年份，如2021年。</li><li id="86d1" class="kz la hi jh b ji li jl lj jo lk js ll jw lm ka le lf lg lh bi translated"><strong class="jh hj"> QY </strong>:季度和年份，如2021Q1</li><li id="ffe0" class="kz la hi jh b ji li jl lj jo lk js ll jw lm ka le lf lg lh bi translated"><strong class="jh hj">组</strong>:年和Q的元组，例如(2021，Q2)</li></ul><p id="9e27" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">Bokeh使用这些列来绘制嵌套的垂直条形图。</p><pre class="iy iz ja jb fd lu lv lw lx aw ly bi"><span id="841a" class="lz kd hi lv b fi ma mb l mc md">df3['Date'] = pd.to_datetime(df3['Date'], format='%Y-%m-%d')<br/>df3['Q'] = ('Q' + df3['Date'].dt.quarter.astype(str))<br/>df3['Year'] = df3['Date'].dt.to_period("Y").astype(str)<br/>df3['QY'] = df3['Date'].dt.to_period("Q").astype(str)<br/>df3['Group'] = df3[['Year', 'Q']].apply(lambda x: (x[0],str(x[1])), axis=1)<br/>df3</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es ml"><img src="../Images/17d003d94b7fa045b42851a1a51ac6dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1120/format:webp/1*eT-kXXUyAqHDj6kAhnrJMw.png"/></div></figure><p id="0a73" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">接下来，它创建一个新图形，然后将垂直图表添加到该图形中。它使用数据框中的<strong class="jh hj">组</strong>列作为竖条的x坐标来创建嵌套竖条图。</p><p id="282a" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">它还向图中添加了一个悬停工具，以便当光标悬停在图表上时交互显示收入。接下来，它调用<strong class="jh hj"> show </strong>方法来显示图形。</p><pre class="iy iz ja jb fd lu lv lw lx aw ly bi"><span id="e441" class="lz kd hi lv b fi ma mb l mc md">palette = ['#0000ff', '#00ff00', '#ffff00', '#00ffff']<br/>years = ['Q1','Q2','Q3','Q4']<br/>figure4 = figure(<br/>    x_range=FactorRange(*list(df3["Group"])),<br/>    title="IBM.N Revenue",<br/>    width=800<br/>)<br/>figure4.vbar(<br/>    x="Group",<br/>    top="Revenue",<br/>    width=0.9,<br/>    source=df3,<br/>    fill_color=factor_cmap('Group', palette=palette, factors=years, start=1, end=3)<br/>)<br/>figure4.add_tools(HoverTool(<br/>    tooltips=[<br/>        ('', '<a class="ae kb" href="http://twitter.com/QY" rel="noopener ugc nofollow" target="_blank">@QY</a>'),<br/>        ('', '<a class="ae kb" href="http://twitter.com/Revenue" rel="noopener ugc nofollow" target="_blank">@Revenue</a>{0.00 a}')<br/>    ],<br/>    mode='mouse'<br/>))<br/>figure4.left[0].formatter.use_scientific = False<br/>show(figure4)</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es mm"><img src="../Images/e75904e5b4f87d1b1028683eef7dde97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cZPmS_O28ORm7IZazt2L-Q.png"/></div></div></figure><h1 id="b50c" class="kc kd hi bd ke kf kg kh ki kj kk kl km io kn ip ko ir kp is kq iu kr iv ks kt bi translated">圆形分格统计图表</h1><p id="38c3" class="pw-post-body-paragraph jf jg hi jh b ji ku ij jk jl kv im jn jo kw jq jr js kx ju jv jw ky jy jz ka hb bi translated">本示例绘制了一个饼图，显示道琼斯工业平均指数中各种成分的权重百分比。</p><p id="581f" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">首先，它调用<strong class="jh hj"> get_data </strong>方法来检索道琼斯工业平均指数中的成分和成分的重量百分比。接下来，它重命名列名，这样散景就可以很容易地引用它们。</p><pre class="iy iz ja jb fd lu lv lw lx aw ly bi"><span id="5a0b" class="lz kd hi lv b fi ma mb l mc md">df4, err = ek.get_data('0#.DJI', ['TR.IndexConstituentWeightPercent','TR.CommonName'])<br/>df4 = df4.rename(columns={"Weight percent": "Value", "Company Common Name":"Name"})<br/>df4</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mn"><img src="../Images/b7db98c893110c18e24f2cdaa8ea26f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:794/format:webp/1*qkV_z4oQJ90OzSVnW3CB0A.png"/></div></figure><p id="18c3" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">然后，它将下列添加到数据框中。</p><ul class=""><li id="610a" class="kz la hi jh b ji jj jl jm jo lb js lc jw ld ka le lf lg lh bi translated"><strong class="jh hj">角度</strong>:饼图中每个扇区的角度。它是根据重量百分比计算的。</li><li id="6d56" class="kz la hi jh b ji li jl lj jo lk js ll jw lm ka le lf lg lh bi translated"><strong class="jh hj">颜色</strong>:饼状图中每个扇区的颜色</li></ul><p id="f5d0" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">散景使用这些列来绘制饼图。</p><pre class="iy iz ja jb fd lu lv lw lx aw ly bi"><span id="a679" class="lz kd hi lv b fi ma mb l mc md">df4['angle'] = df4['Value']/df4['Value'].sum() * 2*pi<br/>df4['color']= ['#1f77b4', '#aec7e8', '#ff7f0e', '#ffbb78', '#2ca02c', '#98df8a', '#d62728', '#ff9896', '#9467bd', '#c5b0d5',<br/>    '#8c564b', '#c49c94', '#e377c2', '#f7b6d2', '#7f7f7f', '#c7c7c7', '#bcbd22', '#dbdb8d', '#17becf', '#9edae5',<br/>     '#0000ff', '#ff0000', '#ffff00', '#00ffff', '#ff00ff', '#F0F8FF', '#006B3C', '#00FF6F', '#392972', '#8F00FF']<br/>df4</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mo"><img src="../Images/98e4aaa0442efdfca99867df9dfcdc09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1038/format:webp/1*P_Fq-F8hNcaJkWc3uAdP7g.png"/></div></figure><p id="6252" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">接下来，它创建一个新图形，然后将饼图添加到该图形中。它使用数据框中的<strong class="jh hj">角度</strong>和<strong class="jh hj">颜色</strong>列来确定饼图中使用的角度和颜色。</p><pre class="iy iz ja jb fd lu lv lw lx aw ly bi"><span id="81cc" class="lz kd hi lv b fi ma mb l mc md">figure5 = figure(plot_height=800,plot_width=800, title="Dow Jones Industrials Constituents Weightings (.DJI)", toolbar_location=None,<br/>           tools="hover",tooltips="<a class="ae kb" href="http://twitter.com/Name" rel="noopener ugc nofollow" target="_blank">@Name</a> (<a class="ae kb" href="http://twitter.com/Instrument" rel="noopener ugc nofollow" target="_blank">@Instrument</a>): <a class="ae kb" href="http://twitter.com/Value" rel="noopener ugc nofollow" target="_blank">@Value</a>", x_range=(-0.5, 1.0))<br/>figure5.wedge(x=0, y=1, radius=0.4,<br/>        start_angle=cumsum('angle', include_zero=True), end_angle=cumsum('angle'),<br/>        line_color="white",fill_color='color', legend_field='Instrument', source=df4)<br/>figure5.axis.axis_label=None<br/>figure5.axis.visible=False<br/>figure5.grid.grid_line_color = None<br/> <br/>show(figure5)</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mp"><img src="../Images/11b6c2ded3fe119d2fc8c5997b01be55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1088/format:webp/1*dIGtmo6-o4STFPqjGvUlmQ.png"/></div></figure><h1 id="9ae5" class="kc kd hi bd ke kf kg kh ki kj kk kl km io kn ip ko ir kp is kq iu kr iv ks kt bi translated">行和列布局</h1><p id="5fc0" class="pw-post-body-paragraph jf jg hi jh b ji ku ij jk jl kv im jn jo kw jq jr js kx ju jv jw ky jy jz ka hb bi translated">此示例使用散景中的行和列布局来排列和显示图表。<strong class="jh hj"> column() </strong>方法用于垂直显示图表，而<strong class="jh hj"> row() </strong>方法用于水平显示图表。</p><p id="9272" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">它在下面的布局中显示了图1、图2和图3。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mq"><img src="../Images/ccf3f521b2869cab5c42ae359d3b450e.png" data-original-src="https://miro.medium.com/v2/resize:fit:630/format:webp/1*RUAlsFLsz4QZbPQKzyNB9Q.png"/></div></figure><pre class="iy iz ja jb fd lu lv lw lx aw ly bi"><span id="077e" class="lz kd hi lv b fi ma mb l mc md">row_layout = column(row(children=[figure1,figure2]), figure3)<br/>show(row_layout)</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es mr"><img src="../Images/c33b6bce1d82b2656bf73862d749ba8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z3CWhGOU_8wBs4pNNtH-dg.png"/></div></div></figure><h1 id="76a8" class="kc kd hi bd ke kf kg kh ki kj kk kl km io kn ip ko ir kp is kq iu kr iv ks kt bi translated">网格布局</h1><p id="5c58" class="pw-post-body-paragraph jf jg hi jh b ji ku ij jk jl kv im jn jo kw jq jr js kx ju jv jw ky jy jz ka hb bi translated">本例使用<strong class="jh hj"> gridplot() </strong>方法在网格中排列散景图。</p><p id="b0b8" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">它在下面的布局中显示了图1、图2、图3和图4。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es ms"><img src="../Images/27ac6a84392b8dbfb4b1e236d6e2aba7.png" data-original-src="https://miro.medium.com/v2/resize:fit:606/format:webp/1*0YipwyEcaiNUzm2dUUNGyg.png"/></div></figure><pre class="iy iz ja jb fd lu lv lw lx aw ly bi"><span id="895c" class="lz kd hi lv b fi ma mb l mc md">grid_layout = gridplot([[figure1, figure2], [figure3, figure4]], plot_width=500, plot_height=500)<br/>show(grid_layout)</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mt"><img src="../Images/28f052ed50567384378813f5f8c8e52e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1276/format:webp/1*0nkWSP-oy-pTT49Lq13fHA.png"/></div></figure><h1 id="6a58" class="kc kd hi bd ke kf kg kh ki kj kk kl km io kn ip ko ir kp is kq iu kr iv ks kt bi translated">面板和选项卡</h1><p id="f081" class="pw-post-body-paragraph jf jg hi jh b ji ku ij jk jl kv im jn jo kw jq jr js kx ju jv jw ky jy jz ka hb bi translated">本示例使用<strong class="jh hj"> Panel() </strong>和<strong class="jh hj"> Tabs() </strong>方法在选项卡式布局中排列图表。它创建了两个选项卡。第一个选项卡包含网格布局中的图1、图2、图3和图4，第二个选项卡包含图5。</p><pre class="iy iz ja jb fd lu lv lw lx aw ly bi"><span id="13e4" class="lz kd hi lv b fi ma mb l mc md">panel1 = Panel(child=grid_layout, title='IBM.N')<br/>panel2 = Panel(child=figure5, title='DJI')<br/>tabs_object = Tabs(tabs = [panel1, panel2])<br/>show(tabs_object)</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mu"><img src="../Images/0ea526bedf5f0278d0c64958a0e65828.png" data-original-src="https://miro.medium.com/v2/resize:fit:1288/format:webp/1*j_aNyU07xCsY002li7oO2g.png"/></div></figure><h1 id="e2c7" class="kc kd hi bd ke kf kg kh ki kj kk kl km io kn ip ko ir kp is kq iu kr iv ks kt bi translated">摘要</h1><p id="f530" class="pw-post-body-paragraph jf jg hi jh b ji ku ij jk jl kv im jn jo kw jq jr js kx ju jv jw ky jy jz ka hb bi translated">Bokeh是一个Python库，用于为包括Jupyter Notebook在内的现代web浏览器创建交互式可视化。该库在路孚特码本中可用。因此，开发人员或数据科学家可以使用这个库来可视化从路孚特的API中检索到的财务数据。</p><p id="03e0" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">本文提供了几个示例，演示如何使用路孚特码本中的散景根据Eikon数据API返回的数据帧绘制图表。此外，它还显示了如何使用散景行、列、网格和选项卡式布局来排列图表。</p><h1 id="076c" class="kc kd hi bd ke kf kg kh ki kj kk kl km io kn ip ko ir kp is kq iu kr iv ks kt bi translated">参考</h1><ol class=""><li id="8b44" class="kz la hi jh b ji ku jl kv jo mv js mw jw mx ka my lf lg lh bi translated">科克伦，南，2019。我喜欢用Python进行数据探索的6个理由。[在线]走向数据科学。可从以下网址获取:<a class="ae kb" href="https://towardsdatascience.com/6-reasons-i-love-bokeh-for-data-exploration-with-python-a778a2086a95" rel="noopener" target="_blank">https://towards data science . com/6-reasons-I-love-bokeh-for-data-exploration-with-python-a778a 2086 a95</a>【2021年8月18日获取】。</li><li id="8746" class="kz la hi jh b ji li jl lj jo lk js ll jw lm ka my lf lg lh bi translated">m .多布勒和t .格罗曼，2020年。数据可视化研讨会。第一版。[S.l.]: Packt Publishing。</li><li id="03b0" class="kz la hi jh b ji li jl lj jo lk js ll jw lm ka my lf lg lh bi translated">Developers.refinitiv.com。n.d. Eikon数据API |路孚特开发者。[在线]可从以下网址获取:<a class="ae kb" href="https://developers.refinitiv.com/en/api-catalog/eikon/eikon-data-api" rel="noopener ugc nofollow" target="_blank">https://developers . refinitiv . com/en/API-catalog/eikon/eikon-data-API</a>[2021年8月18日获取]。</li><li id="e710" class="kz la hi jh b ji li jl lj jo lk js ll jw lm ka my lf lg lh bi translated">堆栈溢出。2020.如何让Bokeh hovertool为烛台图表工作？。[在线]见:<a class="ae kb" href="https://stackoverflow.com/questions/61175554/how-to-get-bokeh-hovertool-working-for-candlesticks-chart" rel="noopener ugc nofollow" target="_blank">https://stack overflow . com/questions/61175554/how-to-get-bokeh-hover tool-work-for-candlesteds-chart</a>[2021年8月18日访问]。</li><li id="cf04" class="kz la hi jh b ji li jl lj jo lk js ll jw lm ka my lf lg lh bi translated">英国乔利，2018。用散景实现数据可视化。第一版。包装出版公司。</li><li id="d9db" class="kz la hi jh b ji li jl lj jo lk js ll jw lm ka my lf lg lh bi translated">雷，s，2015。使用散景的交互式数据可视化(Python语言)。[在线]分析维迪亚。可在:<a class="ae kb" href="https://www.analyticsvidhya.com/blog/2015/08/interactive-data-visualization-library-python-bokeh/" rel="noopener ugc nofollow" target="_blank">https://www . analyticsvidhya . com/blog/2015/08/interactive-data-visualization-library-python-bokeh/</a>【2021年8月18日访问】。</li><li id="797f" class="kz la hi jh b ji li jl lj jo lk js ll jw lm ka my lf lg lh bi translated">Refinitiv.com路孚特密码本。[在线]可在:<a class="ae kb" href="https://www.refinitiv.com/en/products/codebook" rel="noopener ugc nofollow" target="_blank">https://www.refinitiv.com/en/products/codebook</a>[2021年8月18日访问]。</li><li id="5df4" class="kz la hi jh b ji li jl lj jo lk js ll jw lm ka my lf lg lh bi translated">Ven，学士，2021年。散景。[在线]Bokeh.org。可在:<a class="ae kb" href="https://bokeh.org/" rel="noopener ugc nofollow" target="_blank">https://bokeh.org/</a>【2021年8月18日获取】。</li><li id="13d8" class="kz la hi jh b ji li jl lj jo lk js ll jw lm ka my lf lg lh bi translated">Docs.bokeh.org新画廊-散景1.4.0文档。[在线]可在:<a class="ae kb" href="https://docs.bokeh.org/en/1.4.0/docs/gallery.html" rel="noopener ugc nofollow" target="_blank">https://docs.bokeh.org/en/1.4.0/docs/gallery.html</a>[2021年8月18日访问]。</li></ol></div></div>    
</body>
</html>