<html>
<head>
<title>What is an IoC in a nutshell and why you should use it?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">简而言之，什么是IoC，为什么你应该使用它？</h1>
<blockquote>原文：<a href="https://medium.com/codex/how-to-understand-an-ioc-and-get-use-it-in-real-life-5b8527f4fc2c?source=collection_archive---------11-----------------------#2021-07-26">https://medium.com/codex/how-to-understand-an-ioc-and-get-use-it-in-real-life-5b8527f4fc2c?source=collection_archive---------11-----------------------#2021-07-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/312c339d437d3cf264095fa25ab8f878.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*fpxsFusKfmA-TRIu"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">照片由<a class="ae iu" href="https://unsplash.com/@maxweisbecker?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">马克西米利安·魏斯贝克尔</a>在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="014f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">IoC可能会让企业开发人员感到困惑，但简而言之，它是一个可以解决您的问题的工具。IoC或控制反转是企业软件工程中普遍使用的原则。国际奥委会不是火箭科学，但它需要一点努力才能进入。我想展示为什么你应该使用IoC，以及如何把它引入你的项目。</p><h2 id="afb5" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn bi translated">路标</h2><ol class=""><li id="323c" class="ko kp hi ix b iy kq jc kr jg ks jk kt jo ku js kv kw kx ky bi translated">普通代码——这里我将展示为什么IoC很重要。</li><li id="3ef7" class="ko kp hi ix b iy kz jc la jg lb jk lc jo ld js kv kw kx ky bi translated">国际奥委会的纯魔术概念——这是国际奥委会本身的核心理念。</li><li id="aa4c" class="ko kp hi ix b iy kz jc la jg lb jk lc jo ld js kv kw kx ky bi translated">DI作为一个现代IoC的配方——下面是如何实现IoC。</li></ol><p id="ba57" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我将使用Java来实现代码示例。但是如果你熟悉任何一种类似C语言的语言，你很可能在阅读它们时不会有任何困难。</p><h1 id="a673" class="le ju hi bd jv lf lg lh jz li lj lk kd ll lm ln kg lo lp lq kj lr ls lt km lu bi translated">普通代码</h1><p id="7fb9" class="pw-post-body-paragraph iv iw hi ix b iy kq ja jb jc kr je jf jg lv ji jj jk lw jm jn jo lx jq jr js hb bi translated">让我们假设您有一些服务，它通过各种事件发送通知。例如，当用户更改密码和登录你的应用时，你的应用会发送电子邮件。</p><figure class="ly lz ma mb fd ij"><div class="bz dy l di"><div class="mc md l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">AuthListener的普通实现</figcaption></figure><p id="5ab7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这里没什么特别的，<code class="du me mf mg mh b">AuthListener</code>以上按要求处理事件。但在企业中，你通常会遇到几十个事件，比如支付成功、应用崩溃或月度报告创建。你还会有一堆通知渠道，比如电子邮件、浏览器推送通知或WhatsApp消息。在上面的例子中，搜索和替换<code class="du me mf mg mh b">new EmailNotificationService()</code>的单一用法不成问题。但是对于拥有庞大代码库的应用程序来说，这可能太单调了。不要忘记单元测试。为了进行单元测试，<code class="du me mf mg mh b">AuthListener</code>你必须模拟所有第三方，包括<code class="du me mf mg mh b">emailNotificationService</code>。对我来说，我不太清楚如何在不改变<code class="du me mf mg mh b">AuthListener</code>类的情况下启用嘲讽。</p><p id="da78" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">因此，上面的问题是，由于一些代码基础规模进行手动搜索替换可能需要时间。作为一个懒惰的工程师，你更喜欢让你的生活简单一些。首先，这种批量替换可能会产生错误。并且不清楚如何将你的类从它们的依赖关系中分离出来以进行单元测试。</p><h1 id="d305" class="le ju hi bd jv lf lg lh jz li lj lk kd ll lm ln kg lo lp lq kj lr ls lt km lu bi translated">国际奥委会的纯魔术概念</h1><p id="9605" class="pw-post-body-paragraph iv iw hi ix b iy kq ja jb jc kr je jf jg lv ji jj jk lw jm jn jo lx jq jr js hb bi translated">你有很多像AuthListener这样的类，你想有一些神奇的工具把正确的实现放在正确的地方。您创建了一个通用的<code class="du me mf mg mh b">NotificationService</code>接口。您希望源代码中的行为如下所示。</p><figure class="ly lz ma mb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mi"><img src="../Images/4106d2120cb11d1f36d5ca9d9dcfaae4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*tBxMluWTBDrBYrvx3SSqEA.gif"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">我希望我的代码如何工作</figcaption></figure><p id="4267" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这是一个非常雄心勃勃的期望，不是吗？你不同意吗？</p><p id="ed55" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">简单地说，IoC就是说你的类应该依赖于抽象而不是实现。换句话说，你在你的类中使用像<code class="du me mf mg mh b">NotificationService</code>这样的抽象，然后用具体的实现来代替<em class="mj"/>。</p></div><div class="ab cl mk ml gp mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="hb hc hd he hf"><figure class="ly lz ma mb fd ij"><div class="bz dy l di"><div class="mc md l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">AuthListener的神奇IoC实现</figcaption></figure><p id="082f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们总结一下。控制反转就是不要在你的源代码中丢弃任何具体类型的变量。这是关于使用抽象类型的变量。有些魔法会将所需的实现替换成适当的抽象。国际奥委会没有说如何替代你的东西。但是它告诉了<em class="mj">你必须做什么</em>才不会像上面的普通代码例子那样一团糟。</p><h1 id="da12" class="le ju hi bd jv lf lg lh jz li lj lk kd ll lm ln kg lo lp lq kj lr ls lt km lu bi translated">DI是现代国际奥委会的秘方</h1><p id="cf34" class="pw-post-body-paragraph iv iw hi ix b iy kq ja jb jc kr je jf jg lv ji jj jk lw jm jn jo lx jq jr js hb bi translated">实际上，实现IoC的方法有很多，我想写一篇关于它们的全新文章。但是现在，我将只通过构造函数展示DI(依赖注入)。你很可能在你最喜欢的框架中遇到它。</p><p id="1620" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在上面的<code class="du me mf mg mh b">AuthListener</code>中，我们停留在魔法的概念上。但是有没有一些现实世界的方法来设置变量的值呢？嗯，<code class="du me mf mg mh b">=</code>完全如你所愿。在调用任何一个<code class="du me mf mg mh b">AuthListener</code>方法之前如何设置值？你需要的是构造函数。听起来很简单，不是吗？</p><figure class="ly lz ma mb fd ij"><div class="bz dy l di"><div class="mc md l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">DI通过AuthListener的构造函数实现</figcaption></figure><p id="bb5c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在我假设AuthListener的任何用户都提供了所需的NotificationService实现。在现实生活中的应用程序，你通常有某种集中的容器与所有的bean实例。这个容器可以通过API为你提供所需的实例。所以你不会写类似<code class="du me mf mg mh b">new AuthListener(new EmailNotificationService())</code>的东西。但是写<code class="du me mf mg mh b">new AuthListener(container.getBean(NotificationService.class))</code>之类的。</p><p id="a0d1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">或者你甚至可以根本不使用<code class="du me mf mg mh b">new</code>关键字，因为你的现代DI框架在注释的帮助下隐藏了<code class="du me mf mg mh b">container.getBean(/* …stuff… */)</code>。[ <em class="mj">在Java、Python和TS中，它在类、字段或方法上看起来像@MyAnnotation，它在Java中调用Annotation，在Python和TS中调用decorator。在C#中它调用属性，看起来像[MyAnnotation] </em>。当您使用注释时，您的框架会创建所需的实例并将其注入beans中。这就是现代框架中DI的实际情况。</p><p id="de37" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">所以总的来说是这样的。关于<em class="mj">用什么确切的类蕴涵来实例化</em>的知识是一种独立的知识。请把它放在某个特别的地方是很自然的。并使像<code class="du me mf mg mh b">AuthListener</code>这样的类只关心它们的业务逻辑。IoC原则说，你必须把<em class="mj">类实例化</em>逻辑留在专门的东西上。让你的豆子只关心他们必须关心的东西。而DI via构造函数说的是如何用老好的类构造函数实现IoC。场馆建设并不是贯彻国际奥委会原则的唯一途径。</p><h1 id="2fc7" class="le ju hi bd jv lf lg lh jz li lj lk kd ll lm ln kg lo lp lq kj lr ls lt km lu bi translated">摘要</h1><p id="15c1" class="pw-post-body-paragraph iv iw hi ix b iy kq ja jb jc kr je jf jg lv ji jj jk lw jm jn jo lx jq jr js hb bi translated">正如我在开头所说的，国际奥委会不是火箭科学，它的逻辑非常简单。实现业务逻辑可能会给单元测试带来困难，并会在将来迫使额外的努力。IoC给出了一个形象的概念，即您的类应该依靠抽象而不是实现来解决这些问题。而DI via constructor展示了一种将IoC理念融入生活的实用方式。</p><p id="fdcc" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">所有源代码示例你都可以在这里找到<a class="ae iu" href="https://github.com/dash39/ioc-break-in/tree/master/src/my/dash39/ioc" rel="noopener ugc nofollow" target="_blank"/>。所有问题都可以贴在下面的评论里。所有阅读的乐趣你都可以自己保留:)</p><p id="92ab" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">别忘了关注并感谢您的参与！</p></div></div>    
</body>
</html>