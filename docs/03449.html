<html>
<head>
<title>How a Python script satisfied my craving with the help of Zomato</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">一个Python脚本如何在Zomato的帮助下满足我的渴望</h1>
<blockquote>原文：<a href="https://medium.com/codex/how-a-python-script-satisfied-my-craving-with-the-help-of-zomato-a028a3781b19?source=collection_archive---------9-----------------------#2021-09-03">https://medium.com/codex/how-a-python-script-satisfied-my-craving-with-the-help-of-zomato-a028a3781b19?source=collection_archive---------9-----------------------#2021-09-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="ee1b" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">一个可爱的python脚本，当你最喜欢的餐馆和/或菜肴在Zomato上上线时，它会向你发送电子邮件</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/1319cf918ffcd814f5b258020f61d3bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*en3eQoqoGtdFeOQGHTmwhQ.jpeg"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">安娜·塔拉泽维奇摄于<a class="ae jn" href="https://www.pexels.com/photo/dumplings-with-chopped-onion-leaks-7251858/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">佩克斯</a></figcaption></figure><p id="7d7e" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在我的家乡巴雷利，有一家名为Momo Hut的餐厅，提供我吃过的最好吃、最美味的Momo。相信我，我在很多地方都有过很多momos但是不要告诉我的健身教练！你可能会想，在家工作期间，我有机会随时随心所欲地订购它们，对吗？不对！</p><p id="567b" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这家餐厅很受欢迎，因此由于负载，经常离线，大多数时候所需的食物都不可用，即使在线。比起在zoma to app/网站上不停刷新，我还有更重要的事情要做。我必须想出一个最佳的解决方案来满足我的渴望。我心想，这可能是一个尝试编写一个美味的Python脚本的好机会。</p><p id="0eab" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">让我们把任务分解成更小的问题:</p><ol class=""><li id="ebd7" class="kk kl hi jq b jr js ju jv jx km kb kn kf ko kj kp kq kr ks bi translated">获取所需网址的HTML</li><li id="0679" class="kk kl hi jq b jr kt ju ku jx kv kb kw kf kx kj kp kq kr ks bi translated">检查是否有在线餐厅和想要的项目</li><li id="a805" class="kk kl hi jq b jr kt ju ku jx kv kb kw kf kx kj kp kq kr ks bi translated">达到条件时通知我</li><li id="fd4e" class="kk kl hi jq b jr kt ju ku jx kv kb kw kf kx kj kp kq kr ks bi translated">定期不间断地运行该脚本</li></ol><h1 id="a5fb" class="ky kz hi bd la lb lc ld le lf lg lh li io lj ip lk ir ll is lm iu ln iv lo lp bi translated">获取HTML代码</h1><p id="ad7e" class="pw-post-body-paragraph jo jp hi jq b jr lq ij jt ju lr im jw jx ls jz ka kb lt kd ke kf lu kh ki kj hb bi translated">要获得静态网站的HTML，我们需要两样东西:</p><ul class=""><li id="a401" class="kk kl hi jq b jr js ju jv jx km kb kn kf ko kj lv kq kr ks bi translated">HTML页面的网址</li><li id="56ec" class="kk kl hi jq b jr kt ju ku jx kv kb kw kf kx kj lv kq kr ks bi translated"><a class="ae jn" href="https://docs.python-requests.org/en/master/" rel="noopener ugc nofollow" target="_blank">请求</a>库进行网络连接并发出请求</li></ul><p id="48b9" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">假设Python (python3)将被安装在我们正在工作的系统中，我们可以继续获取HTML。我有这家餐馆的网址:<a class="ae jn" href="https://www.zomato.com/bareilly/momo-hut-subhash-nagar-colony/order" rel="noopener ugc nofollow" target="_blank">https://www . zomato . com/bare illy/momo-hut-subhash-nagar-colony/order</a></p><p id="bd85" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">要安装请求库，请转到终端窗口，使用以下命令安装库:</p><pre class="iy iz ja jb fd lw lx ly lz aw ma bi"><span id="3622" class="mb kz hi lx b fi mc md l me mf">$ python3 -m pip install requests</span></pre><p id="737f" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">现在，我们应该能够使用我的简单代码获得页面HTML:</p><pre class="iy iz ja jb fd lw lx ly lz aw ma bi"><span id="647e" class="mb kz hi lx b fi mc md l me mf">import requests</span><span id="641f" class="mb kz hi lx b fi mg md l me mf">URL = "<a class="ae jn" href="https://www.zomato.com/bareilly/momo-hut-subhash-nagar-colony/order" rel="noopener ugc nofollow" target="_blank">https://www.zomato.com/bareilly/momo-hut-subhash-nagar-colony/order</a>"<br/>page = requests.get(URL)</span><span id="c554" class="mb kz hi lx b fi mg md l me mf">print(page.text)</span></pre><p id="17fb" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">但是等等，我们得到了一个拒绝访问的结果:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mh"><img src="../Images/a69290d1397db335d30bc0ab08732b4c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r8objuRE6y0OBXhQFuEaKA.png"/></div></div></figure><p id="1e4f" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">当使用浏览器访问这个网址时，我们不会面对这个问题，所以这有什么区别呢？让我们检查一下。</p><p id="326b" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在浏览器的匿名窗口中打开URL，然后检查页面。我们可以看到，很多额外的信息是从浏览器发送的，而不是从我们的脚本发送的。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mi"><img src="../Images/bc3e64e8885b0f03e814a2f2361bfd2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pO3mzVlpvcD7APtZq64FXA.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">正在发送的邮件头</figcaption></figure><p id="dcb8" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">让我们假设我们不理解这些，为什么和什么额外的东西被发送，我们只是想从我们的脚本中模仿这种行为。这个便利的<a class="ae jn" href="https://curl.trillworks.com/#Search" rel="noopener ugc nofollow" target="_blank">网站</a>可以给我们来自cURL的Python请求参数。</p><p id="18d8" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这个网站(【https://curl.trillworks.com】T2)也会指导你如何提取卷发，以防你需要帮助。现在我们有了我们需要的所有头文件，可以添加到我们的脚本中了。(旁注:我们可以去掉标题中的cookies):</p><pre class="iy iz ja jb fd lw lx ly lz aw ma bi"><span id="ea85" class="mb kz hi lx b fi mc md l me mf">import requests</span><span id="ad8b" class="mb kz hi lx b fi mg md l me mf">URL = "<a class="ae jn" href="https://www.zomato.com/bareilly/momo-hut-subhash-nagar-colony/order" rel="noopener ugc nofollow" target="_blank">https://www.zomato.com/bareilly/momo-hut-subhash-nagar-colony/order</a>"<br/>headers = {<br/>    'authority': '<a class="ae jn" href="http://www.zomato.com'" rel="noopener ugc nofollow" target="_blank">www.zomato.com'</a>,<br/>    'sec-ch-ua': '"Chromium";v="92", " Not A;Brand";v="99", "Google Chrome";v="92"',<br/>    'sec-ch-ua-mobile': '?0',<br/>    'upgrade-insecure-requests': '1',<br/>    'user-agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.159 Safari/537.36',<br/>    'accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9',<br/>    'sec-fetch-site': 'same-origin',<br/>    'sec-fetch-mode': 'navigate',<br/>    'sec-fetch-user': '?1',<br/>    'sec-fetch-dest': 'document',<br/>    'accept-language': 'en-GB,en;q=0.9',<br/>}</span><span id="2b84" class="mb kz hi lx b fi mg md l me mf">page = requests.get(URL, headers=headers)</span><span id="bd29" class="mb kz hi lx b fi mg md l me mf">print(page.text)</span></pre><p id="42a3" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">太棒了。我们能够接收HTML:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mj"><img src="../Images/f6b059400c93768a4f9f59b4229d1ca0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*812yb0ctxK5cYW17FCREVQ.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">从脚本中检索的HTML</figcaption></figure><h1 id="f7dc" class="ky kz hi bd la lb lc ld le lf lg lh li io lj ip lk ir ll is lm iu ln iv lo lp bi translated">检查餐厅是否在线，是否有食物</h1><p id="8b2e" class="pw-post-body-paragraph jo jp hi jq b jr lq ij jt ju lr im jw jx ls jz ka kb lt kd ke kf lu kh ki kj hb bi translated">从这些大量的HTML数据中，我们需要挑选出我们需要的信息。对我来说，需要满足两个条件才能称之为成功事件:</p><ul class=""><li id="4829" class="kk kl hi jq b jr js ju jv jx km kb kn kf ko kj lv kq kr ks bi translated">餐厅在线</li><li id="1b52" class="kk kl hi jq b jr kt ju ku jx kv kb kw kf kx kj lv kq kr ks bi translated">莫莫可供订购</li></ul><p id="84d1" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">HTML响应中的这个片段将告诉我们餐馆是否离线:</p><pre class="iy iz ja jb fd lw lx ly lz aw ma bi"><span id="8225" class="mb kz hi lx b fi mc md l me mf">&lt;div class=”subtitle”&gt;Currently closed for online ordering&lt;/div&gt;</span></pre><p id="1a6b" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">要检查所需的项目是否可用，我们只需在HTML响应中搜索它的名称。现在，为了从HTML中提取数据，我们将使用这个方便的库<a class="ae jn" href="https://www.crummy.com/software/BeautifulSoup/bs4/doc/" rel="noopener ugc nofollow" target="_blank">美丽的汤</a>。</p><pre class="iy iz ja jb fd lw lx ly lz aw ma bi"><span id="612c" class="mb kz hi lx b fi mc md l me mf">from bs4 import BeautifulSoup<br/>...<br/>soup = BeautifulSoup(page.content, "html.parser")<br/>subtitles = soup.find_all("div", class_="subtitle")</span><span id="98f1" class="mb kz hi lx b fi mg md l me mf"># Check if the restaurant is open or not<br/>is_open = False<br/>if len(subtitles) &gt; 0:<br/> is_open = "Currently closed" not in subtitles[0].decode_contents()<br/>else:<br/> is_open = True <br/>print("Is open: " + str(is_open))</span><span id="06ae" class="mb kz hi lx b fi mg md l me mf"># Find paneer momo<br/>paneer_momos = soup.find_all(text='Paneer Steamed Momos [6 Pieces]')<br/>are_paneer_momos_available = len(paneer_momos) &gt; 0</span><span id="3e28" class="mb kz hi lx b fi mg md l me mf">print("Are paneer momos available: " + str(are_paneer_momos_available))</span></pre><p id="770a" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">运行这个程序将会得到如下结果:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mk"><img src="../Images/f21622ffe3aeedfd4e444950f4b89bd4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8k4XkWrpT29fD_P-6DCK4A.png"/></div></div></figure><p id="57e6" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这对一个美食家来说看起来很棒！现在，只要运行这个脚本就可以告诉我们是否可以订购了。</p><h1 id="cb8e" class="ky kz hi bd la lb lc ld le lf lg lh li io lj ip lk ir ll is lm iu ln iv lo lp bi translated">通过电子邮件通知</h1><p id="eafd" class="pw-post-body-paragraph jo jp hi jq b jr lq ij jt ju lr im jw jx ls jz ka kb lt kd ke kf lu kh ki kj hb bi translated">当我们的成功条件得到满足时，如果我们通过邮件获得在线回电，那该有多好？美味的甜！让我们使用Python的内置模块<a class="ae jn" href="https://docs.python.org/3/library/smtplib.html" rel="noopener ugc nofollow" target="_blank"> smtplib </a>将邮件从脚本发送到指定的目的地。</p><p id="260e" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">注意</strong>:我们将从我们的脚本中发送敏感信息(如电子邮件的密码)，所以我们应该对加密保持警惕。为此，您也可以创建一个一次性电子邮件帐户。</p><p id="f619" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">以下代码通过TLS加密连接创建了与Gmail SMTP服务器的安全连接。SMTP本身并不安全，因此<a class="ae jn" href="https://docs.python.org/3/library/ssl.html" rel="noopener ugc nofollow" target="_blank"> ssl库</a>将帮助我们保护我们的通信。</p><pre class="iy iz ja jb fd lw lx ly lz aw ma bi"><span id="56d7" class="mb kz hi lx b fi mc md l me mf">import smtplib, ssl<br/><br/>port = 465 # Port for SMTP via SSL<br/><br/># Create a secure SSL context<br/>context = ssl.create_default_context()<br/><br/>with smtplib.SMTP_SSL("smtp.gmail.com", port, context=context) as server:<br/>    server.login("your.address@gmail.com", "your*password")<br/>    <!-- -->server.sendmail(<!-- -->"your.address@gmail.com"<!-- -->, "receiver.email@something.com", "Paneer momos are available on Momo Hut")</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ml"><img src="../Images/848549aff4cc2c6cda216f5c6f63bd78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GvbOnwgxBypCB9IKZONcTQ.jpeg"/></div></div></figure><p id="975f" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">尝试运行此脚本，并检查您是否正在接收邮件。如果您的g mail帐户无法接收邮件，请尝试<a class="ae jn" href="https://myaccount.google.com/lesssecureapps" rel="noopener ugc nofollow" target="_blank">允许连接不太安全的应用</a>。</p><p id="fc12" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">让我们把这个功能整合到我们的渴望脚本中，并在上菜前给它最后的润色。</p><p id="65fd" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">对于我们来说，完整功能的脚本应该是这样的:</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mm mn l"/></div></figure><h1 id="fe7b" class="ky kz hi bd la lb lc ld le lf lg lh li io lj ip lk ir ll is lm iu ln iv lo lp bi translated">计划脚本执行</h1><p id="fa1b" class="pw-post-body-paragraph jo jp hi jq b jr lq ij jt ju lr im jw jx ls jz ka kb lt kd ke kf lu kh ki kj hb bi translated">如果我们不得不一次又一次地显式运行这个脚本，那么从这个脚本中仍然没有取得多少成果。让我们试着安排它定期运行。</p><p id="d14b" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">更好的方法是把它放在一些托管平台上，比如pythonanywhere.com。我试过，但失败了，因为免费账户通常允许打电话到一些预先定义和指定的网址，而zomato.com不在其中。</p><p id="9bdb" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">相反，我使用<strong class="jq hj"> cron </strong>来安排我们的脚本在自己的机器上定期运行，比如你的笔记本电脑或台式机。如果您有一台基于UNIX的机器，这对您来说将是非常简单的。您需要告诉crontab文件您想要运行的脚本。您可以使用以下命令编辑crontab文件:</p><pre class="iy iz ja jb fd lw lx ly lz aw ma bi"><span id="85a1" class="mb kz hi lx b fi mc md l me mf">$ crontab -e</span></pre><p id="9735" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">终端中将打开一个Vi窗口，使用Vi编辑器将路径添加到您的脚本中，并指定时间间隔(此处为5分钟):</p><pre class="iy iz ja jb fd lw lx ly lz aw ma bi"><span id="cb13" class="mb kz hi lx b fi mc md l me mf">*/5 * * * * python3 /Users/Path/To/Directory/cravings_script.py</span></pre><p id="d8fa" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">然后按<strong class="jq hj"> Esc </strong>键进入Vi正常模式，输入<strong class="jq hj"> :wq </strong>然后<strong class="jq hj">回车</strong>写入文件并退出。好了，剧本已经排好了！</p></div><div class="ab cl mo mp gp mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="hb hc hd he hf"><p id="66c6" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在那里，高需求的momos问题得到解决。这个剧本已经获得了回报，自剧本推出以来，消费增长了许多倍。原谅我的困扰。</p><div class="mv mw ez fb mx my"><a href="https://github.com/ananthrajsingh" rel="noopener  ugc nofollow" target="_blank"><div class="mz ab dw"><div class="na ab nb cl cj nc"><h2 class="bd hj fi z dy nd ea eb ne ed ef hh bi translated">GITHUB: ananthrajsingh</h2><div class="nf l"><h3 class="bd b fi z dy nd ea eb ne ed ef dx translated">在Github上查看Ananth的知识库和gists</h3></div><div class="ng l"><p class="bd b fp z dy nd ea eb ne ed ef dx translated">github.com</p></div></div><div class="nh l"><div class="ni l nj nk nl nh nm jh my"/></div></div></a></div><p id="f17e" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">你也可以在这里找到代码要点<a class="ae jn" href="https://gist.github.com/ananthrajsingh/98eecfe0a351eb588445244ee9a673e3" rel="noopener ugc nofollow" target="_blank"/>。如果有任何问题、反馈、建议或关于一些很棒的餐馆的通知，请联系我。</p><p id="4866" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">邮箱:<a class="ae jn" href="mailto:ananthrajsingh@gmail.com" rel="noopener ugc nofollow" target="_blank">ananthrajsingh@gmail.com</a></p><div class="mv mw ez fb mx my"><a href="https://www.linkedin.com/in/ananthrajsingh/" rel="noopener  ugc nofollow" target="_blank"><div class="mz ab dw"><div class="na ab nb cl cj nc"><h2 class="bd hj fi z dy nd ea eb ne ed ef hh bi translated">Ananth Raj Singh -软件开发人员- Furlenco | LinkedIn</h2><div class="nf l"><h3 class="bd b fi z dy nd ea eb ne ed ef dx translated">为公司、开源和个人项目设计、构建、改进和调试软件。正在写作…</h3></div><div class="ng l"><p class="bd b fp z dy nd ea eb ne ed ef dx translated">www.linkedin.com</p></div></div><div class="nh l"><div class="nn l nj nk nl nh nm jh my"/></div></div></a></div></div></div>    
</body>
</html>