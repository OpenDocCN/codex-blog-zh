<html>
<head>
<title>Implement location sharing with Apple MapKit on iOS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在iOS上使用Apple MapKit实现位置共享</h1>
<blockquote>原文：<a href="https://medium.com/codex/implement-location-sharing-with-apple-mapkit-on-ios-2659bfb0994d?source=collection_archive---------4-----------------------#2022-09-13">https://medium.com/codex/implement-location-sharing-with-apple-mapkit-on-ios-2659bfb0994d?source=collection_archive---------4-----------------------#2022-09-13</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/816b4dc56b64b41567f90fdd20e5e080.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*BUGSuyscU-fQv20H.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">仙鸟2022</figcaption></figure><div class=""/><div class=""><h2 id="fc34" class="pw-subtitle-paragraph iu hw hx bd b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl dx translated">如何检测用户的地理坐标&amp;在聊天中显示一条位置消息，该消息显示一张带有位置大头针的地图</h2></div><p id="d1ca" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">解决方案工程师| <a class="ae ki" href="https://www.sendbird.com/" rel="noopener ugc nofollow" target="_blank"> Sendbird </a></p><p id="0c55" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated"><em class="kj">有关本教程材料的其他指导，请参见</em> <a class="ae ki" href="https://sendbird.com/docs/chat" rel="noopener ugc nofollow" target="_blank"> <em class="kj">文档</em> </a> <em class="kj">。要查看Sendbird聊天的运行情况，请参见此</em> <a class="ae ki" href="https://sendbird.com/demos/in-app-chat" rel="noopener ugc nofollow" target="_blank"> <em class="kj">演示</em> </a> <em class="kj">。您也可以访问我们的</em> <a class="ae ki" href="https://sendbird.com/features/chat-messaging" rel="noopener ugc nofollow" target="_blank"> <em class="kj">网站</em> </a> <em class="kj">了解更多关于仙鸟聊天的信息。</em></p><h1 id="0b4b" class="kk kl hx bd km kn ko kp kq kr ks kt ku jd kv je kw jg kx jh ky jj kz jk la lb bi translated">介绍</h1><p id="00cf" class="pw-post-body-paragraph jm jn hx jo b jp lc iy jr js ld jb ju jv le jx jy jz lf kb kc kd lg kf kg kh hb bi translated">位置共享是移动设备上最有用的功能之一。使用拼车服务时，您可以共享您的位置以确保更高的安全性，通过按需服务传达所需送货地点的位置，或者只是让朋友知道您的位置。</p><p id="1e1f" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">本教程讲解如何使用<a class="ae ki" href="https://www.sendbird.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy"> Sendbird </strong> </a>和苹果的<a class="ae ki" href="https://developer.apple.com/documentation/mapkit/" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy"> MapKit </strong> </a>在iOS上实现位置分享功能。在本教程中，我们假设您已经使用Sendbird实现了<a class="ae ki" href="https://sendbird.com/features/chat-messaging" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy">聊天</strong> </a>。如果没有，请参见本<a class="ae ki" href="https://sendbird.com/developer/tutorials/build-chat-uikit-ios" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy">教程</strong> </a>或<a class="ae ki" href="https://sendbird.com/docs/chat/v4/ios/getting-started/send-first-message" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy">文档</strong> </a>了解如何做到这一点。本教程提供的代码是对Sendbird的基本<a class="ae ki" href="https://github.com/sendbird/sendbird-chat-sample-ios" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy"> Swift示例</strong> </a>的修改。注意，如果你了解<a class="ae ki" href="https://developer.apple.com/swift/" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy"> Swift </strong> </a>，你将从本教程中获得最大收益。</p><p id="1e13" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">在深入讨论实现细节之前，我们先来讨论一些先决条件。</p><h1 id="a6c9" class="kk kl hx bd km kn ko kp kq kr ks kt ku jd kv je kw jg kx jh ky jj kz jk la lb bi translated">用苹果地图工具包在iOS上建立位置共享的前提条件</h1><p id="025d" class="pw-post-body-paragraph jm jn hx jo b jp lc iy jr js ld jb ju jv le jx jy jz lf kb kc kd lg kf kg kh hb bi translated">对于本教程，您需要:</p><ol class=""><li id="f3a0" class="lh li hx jo b jp jq js jt jv lj jz lk kd ll kh lm ln lo lp bi translated"><a class="ae ki" href="https://github.com/sendbird/sendbird-chat-sdk-ios" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy">仙鸟SDK </strong> </a></li><li id="ef2c" class="lh li hx jo b jp lq js lr jv ls jz lt kd lu kh lm ln lo lp bi translated"><a class="ae ki" href="https://developer.apple.com/maps/web/" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy">地图工具包</strong> </a></li><li id="915f" class="lh li hx jo b jp lq js lr jv ls jz lt kd lu kh lm ln lo lp bi translated"><a class="ae ki" href="https://www.dropbox.com/s/f4i12jvq299jmw3/sendbird_sample_with_location_sharing.zip?dl=0" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy">示例代码</strong> </a> <strong class="jo hy"> <br/> </strong> a .下载→解压<br/> b .在根文件夹中，如果需要的话，“pod install”<br/>c .在AppDelegate中，添加app_id <br/> d .在AppDelegate中，删除“return”语句<br/> e .打开“send bird-IOs . xc workspace”<br/>f .运行</li><li id="f1fa" class="lh li hx jo b jp lq js lr jv ls jz lt kd lu kh lm ln lo lp bi translated">搜索“//LOCATION_BUILDER”查看相关代码。</li></ol><h1 id="ba9c" class="kk kl hx bd km kn ko kp kq kr ks kt ku jd kv je kw jg kx jh ky jj kz jk la lb bi translated">使用Apple MapKit共享位置的过程</h1><p id="e3df" class="pw-post-body-paragraph jm jn hx jo b jp lc iy jr js ld jb ju jv le jx jy jz lf kb kc kd lg kf kg kh hb bi translated">让我们首先从较高的层面解释发送带有位置pin的地图的必要步骤。</p><p id="9ce9" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">用户按下“分享位置”按钮后，就会获得用户的地理坐标。该位置将通过“自定义类型”设置为“位置”的“用户消息”发送。成功发送消息后，它将被插入到消息视图委托中。根据MessageType(用户消息)和CustomType(位置)，消息将显示一个地图，地图坐标上有一个大头针，地图半径设置得足够小，可以清楚地显示位置。在上面分享的代码中，搜索“//LOCATION_BUILDER”找到位置分享代码所在的位置。</p><h1 id="625f" class="kk kl hx bd km kn ko kp kq kr ks kt ku jd kv je kw jg kx jh ky jj kz jk la lb bi translated">苹果地图工具包在iOS上的位置共享实现</h1><p id="a8bd" class="pw-post-body-paragraph jm jn hx jo b jp lc iy jr js ld jb ju jv le jx jy jz lf kb kc kd lg kf kg kh hb bi translated">要使用位置共享，您需要获得使用用户位置的权限。这将需要在运行时请求。info.plist需要以下设置:</p><figure class="lv lw lx ly fd hk"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="6bea" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">检测用户的位置包括两个部分。首先，开始检测用户的位置。</p><figure class="lv lw lx ly fd hk"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="041e" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">第二，监听何时找到用户的位置，然后发送Sendbird消息。</p><figure class="lv lw lx ly fd hk"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="15ab" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">最后，将位置共享中收集的坐标作为消息文本发送，并将消息的customType设置为“location”。请注意，下面的代码过于简化了示例中的内容。</p><figure class="lv lw lx ly fd hk"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="c58c" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">考虑显示传入和传出邮件的左右邮件视图。代码提供了两个。xib文件和相关的TableViewCell类来显示地图消息。其概念是读取消息，检测它是否具有customType位置，然后呈现正确的消息视图。在此过程中，还要设置消息的地图视图坐标和区域半径。</p><figure class="lv lw lx ly fd hk"><div class="bz dy l di"><div class="lz ma l"/></div></figure><h1 id="0c7b" class="kk kl hx bd km kn ko kp kq kr ks kt ku jd kv je kw jg kx jh ky jj kz jk la lb bi translated">结论</h1><p id="606b" class="pw-post-body-paragraph jm jn hx jo b jp lc iy jr js ld jb ju jv le jx jy jz lf kb kc kd lg kf kg kh hb bi translated">就是这样！我们讨论了如何获取位置坐标，将位置共享中收集的坐标作为消息文本发送，以及使用位置大头针渲染地图。您现在知道如何使用Apple MapKit为您的移动应用程序构建位置共享功能了！</p><p id="bff9" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">如需更多信息，请查看<a class="ae ki" href="https://sendbird.com/docs/chat/v4/ios/getting-started/send-first-message" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy">文档</strong> </a>，在<a class="ae ki" href="https://community.sendbird.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy">仙鸟社区</strong> </a>发布实施问题，或<a class="ae ki" href="https://sendbird.com/contact-us" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy">联系我们</strong> </a>。我们总是乐意帮忙！</p><p id="d7e5" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">位置分享快乐！✌️</p></div></div>    
</body>
</html>