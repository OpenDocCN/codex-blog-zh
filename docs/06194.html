<html>
<head>
<title>The importance of logical data modelling</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">逻辑数据建模的重要性</h1>
<blockquote>原文：<a href="https://medium.com/codex/the-importance-of-logical-data-modelling-c9686ccf4f1?source=collection_archive---------13-----------------------#2022-04-12">https://medium.com/codex/the-importance-of-logical-data-modelling-c9686ccf4f1?source=collection_archive---------13-----------------------#2022-04-12</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/43bc4975d2cecc50f4ab3cdf03a14dde.png" data-original-src="https://miro.medium.com/v2/resize:fit:1102/format:webp/1*WU2RwxQKUsBqIjoDHEKlpA.jpeg"/></div><figcaption class="im in et er es io ip bd b be z dx translated">结构体💥/枚举❤️</figcaption></figure><p id="344e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">作为一名iOS开发人员，我总是对在产品代码中看到<code class="du jo jp jq jr b">fatalError(“This should never happen”)</code>的频率感到震惊。这通常出现在编程上可能，但逻辑上不可能的情况下。</p><h1 id="6669" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">场景</h1><p id="9cce" class="pw-post-body-paragraph iq ir hi is b it kq iv iw ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn hb bi translated">想象一下这样一种情况，我想要一个应用程序来对我卧室书架上的CD和书籍进行分类。我创建了一个<code class="du jo jp jq jr b">Item</code> struct，它告诉我标题，并有可选的持续时间和页数字段，这取决于它是在模拟CD还是书。</p><pre class="kv kw kx ky fd kz jr la lb aw lc bi"><span id="6ab4" class="ld jt hi jr b fi le lf l lg lh">struct Item {<br/>    var title: String<br/>    var duration: TimeInterval?<br/>    var numberOfPages: Int?<br/>}</span></pre><p id="b1ab" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这个结构给我留下了一个问题。我可以创建一个既有<code class="du jo jp jq jr b">duration</code> <em class="li">又有</em>和<code class="du jo jp jq jr b">numberOfPages</code>的项目。我也可以创建一个没有字段的<code class="du jo jp jq jr b">Item</code>！</p><p id="e989" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当我试图将我的<code class="du jo jp jq jr b">Item</code>表示为表格中的行时，问题变得很明显:</p><pre class="kv kw kx ky fd kz jr la lb aw lc bi"><span id="77ae" class="ld jt hi jr b fi le lf l lg lh">func makeRow(for item: Item) -&gt; Row {<br/>    if let duration = item.duration {<br/>        return Row(heading: title, subHeading: duration)<br/>    } else if let numberOfPages = item.numberOfPages {<br/>        return Row(heading: title, subHeading: numberOfPages)<br/>    } else {<br/>        fatalError(“This should never happen”)<br/>    }<br/>}</span></pre><p id="bccf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">尽管有错误消息，但<code class="du jo jp jq jr b">fatalError</code> <em class="li">可能会</em>发生。为了让我的应用程序崩溃，我只需编写以下代码:</p><pre class="kv kw kx ky fd kz jr la lb aw lc bi"><span id="e489" class="ld jt hi jr b fi le lf l lg lh">let item = Item(title: “Moby-Dick”)<br/>let row = makeRow(for item) // 💥 Crash here!</span></pre><p id="c337" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这里很容易编写不重要的代码，而且仅仅从调用点来看，并不能立即看出会发生崩溃。</p><h1 id="2a38" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">对此能做些什么呢？</h1><p id="1ed3" class="pw-post-body-paragraph iq ir hi is b it kq iv iw ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn hb bi translated">任何时候，当我有两个互斥的字段，而我只需要一个字段时，我的经验法则就是去找一个<code class="du jo jp jq jr b">enum</code>！</p><p id="ff4f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">通过利用<code class="du jo jp jq jr b">enum</code> s，我们可以以一种确保编译器只允许逻辑状态存在的方式来构造我们的代码。一旦我们消除了不可能的状态，无意义的状态就消失了！</p><h1 id="b49f" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">第二次:拯救我的enums！</h1><p id="54a4" class="pw-post-body-paragraph iq ir hi is b it kq iv iw ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn hb bi translated">首先，我重构了我的代码，并用下面的<code class="du jo jp jq jr b">enum</code>表示这些项目:</p><pre class="kv kw kx ky fd kz jr la lb aw lc bi"><span id="bfda" class="ld jt hi jr b fi le lf l lg lh">enum Item {<br/>    case song(title: String, duration: TimeInterval)<br/>    case book(title: String, numberOfPages: Int)<br/>}</span></pre><p id="9251" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">行构建代码现在也需要重构:</p><pre class="kv kw kx ky fd kz jr la lb aw lc bi"><span id="820a" class="ld jt hi jr b fi le lf l lg lh">func makeRow(for item: Item) -&gt; Row {<br/>    switch item {<br/>    case let .song(title, duration):<br/>        return Row(heading: title, subHeading: duration)<br/>    case let .book(title, numberOfPages):<br/>        return Row(heading: title, subHeading: numberOfPages)<br/>    }<br/>}</span></pre><p id="6728" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">注意<code class="du jo jp jq jr b">fatalError</code>是如何消失的！现在这里不可能有崩溃，因为不可能有无效的<code class="du jo jp jq jr b">Item</code>。</p><h1 id="3116" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">结论</h1><p id="289d" class="pw-post-body-paragraph iq ir hi is b it kq iv iw ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn hb bi translated">给出的例子显然是人为的，但是架构模式是无价的。我在处理JSON解码的代码中最常看到这个问题。下次查看从JSON解码的结构时，试着找出互斥的字段。如果你最终得到一个无效的对象，很可能你的解码操作已经失败了！</p></div></div>    
</body>
</html>