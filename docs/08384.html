<html>
<head>
<title>How to Refactor Legacy Code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何重构遗留代码</h1>
<blockquote>原文：<a href="https://medium.com/codex/how-to-refactor-legacy-code-from-the-office-614f4860191d?source=collection_archive---------2-----------------------#2022-08-04">https://medium.com/codex/how-to-refactor-legacy-code-from-the-office-614f4860191d?source=collection_archive---------2-----------------------#2022-08-04</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="3fd9" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">关于反腐败层的指南</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/5525510222558c25efffa009931e07c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*0_fLg0WqbzPARQwU"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">路易斯·汉瑟在<a class="ae jn" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="2b7a" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">嗨，我是尼科，</p><p id="05f8" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我是伦敦(英国)一家票务经纪公司的高级工程师。</p><p id="eb1e" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">你在办公室看书！</p><p id="c809" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这是我每天(几乎)例行发布的日志，记录我在办公室的日常生活中使用的技术。</p><p id="e1b0" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">这个帖子是给谁的？</strong></p><p id="64c2" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这里我们讨论DDD、设计模式和反腐败层。</p><p id="069b" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">如果你还没到那一步，你可以这样开始:</p><p id="dd67" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><a class="ae jn" href="https://anastasionico.uk/blog/learn-php" rel="noopener ugc nofollow" target="_blank">https://anastasionico.uk/blog/learn-php</a></p><div class="kk kl ez fb km kn"><a href="https://anastasionico.uk/blog/domain-driven-design-quickest-the-basics" rel="noopener  ugc nofollow" target="_blank"><div class="ko ab dw"><div class="kp ab kq cl cj kr"><h2 class="bd hj fi z dy ks ea eb kt ed ef hh bi translated">领域驱动的设计最快{基础}</h2><div class="ku l"><h3 class="bd b fi z dy ks ea eb kt ed ef dx translated">让我对你做一个小小的猜测，你浏览这个网站并正在阅读这句话的原因是…</h3></div><div class="kv l"><p class="bd b fp z dy ks ea eb kt ed ef dx translated">anastasionico.uk</p></div></div><div class="kw l"><div class="kx l ky kz la kw lb jh kn"/></div></div></a></div><h1 id="d3c8" class="lc ld hi bd le lf lg lh li lj lk ll lm io ln ip lo ir lp is lq iu lr iv ls lt bi translated">问题是</h1><p id="c713" class="pw-post-body-paragraph jo jp hi jq b jr lu ij jt ju lv im jw jx lw jz ka kb lx kd ke kf ly kh ki kj hb bi translated">当我还是个孩子的时候，当我拜访我祖母家的时候，我喜欢四处逛逛，探索每一个旧房间。在那些旧盒子、信件和发黄的报纸中，发现惊人的发现并不罕见。</p><p id="3c22" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">尤其是从一个5岁小孩的角度来看。</p><p id="1bc2" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我仍然清楚地记得有一次我碰到一个奇怪形状的黄铜游戏手柄，侧面有数字，底部刻有日期。</p><p id="6671" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><em class="lz">1925年4月13日</em></p><p id="dc85" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">正如你可能已经理解的，尽管它是由金属制成的，但它的休息很快就结束了，在短短的几分钟内，那东西被分裂成许多碎片。</p><p id="ac06" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">很多时候，这些古董都是如此精致，所以明智的做法是不去碰它们，只让我看着它们。</p><p id="484a" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">今天，事情发生了变化，情况不太一样，但是，在某些方面。我也有同感。</p><p id="4ca1" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">事实上，我目前正在将一个10年前的API重构为更现代的东西，我必须说，这个任务并不缺乏挑战。</p><p id="8427" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">就像你们中从事遗留代码工作的人一样，徘徊和惊讶的感觉一天多次袭击我。</p><p id="1032" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">通常，它们伴随着生动的感叹词，如:</p><ul class=""><li id="98e4" class="ma mb hi jq b jr js ju jv jx mc kb md kf me kj mf mg mh mi bi translated">这是谁写的？</li><li id="23ac" class="ma mb hi jq b jr mj ju mk jx ml kb mm kf mn kj mf mg mh mi bi translated">这里究竟为什么会有这个回路？</li><li id="de59" class="ma mb hi jq b jr mj ju mk jx ml kb mm kf mn kj mf mg mh mi bi translated">我这一生在做什么？</li></ul><p id="033e" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">幸运的是，现在已经不是1925年了，人们已经开发了许多伟大的策略和模式，帮助我们不像一部旧的黄铜手机那样分解代码。</p><p id="e0d5" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我年轻的时候就知道，有时候，不去管那些东西是更明智的做法。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mo"><img src="../Images/0445a7240a8228cb5a156494fdd1ce8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*whh6x2mW9SF2sZmojONefg.png"/></div></div></figure><h1 id="07a6" class="lc ld hi bd le lf lg lh li lj lk ll lm io ln ip lo ir lp is lq iu lr iv ls lt bi translated">领域驱动设计</h1><p id="3f4c" class="pw-post-body-paragraph jo jp hi jq b jr lu ij jt ju lv im jw jx lw jz ka kb lx kd ke kf ly kh ki kj hb bi translated">我在上面提到的那些杰出人士中，有一个肯定是埃里克·埃文斯。</p><p id="c3b1" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">他是一名作家，提出了DDD的想法。</p><p id="2ff6" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">什么是DDD？</p><p id="1f02" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">想象一部电话。</p><p id="5ba0" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">电话不仅仅是一套金属和塑料的东西，我电话是某人的梦想，能够从很远的地方交流的概念。</p><p id="7612" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">它被塑造成尽可能好的形状来做它所做的事情，并且具有许多不同的功能，这些功能必须同步工作才能使通话成为可能。</p><p id="40d4" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">埃文斯解释说，代码不应被视为包含符号的文件。</p><p id="4f16" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">不仅仅是这样。</p><p id="7784" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">开始编码时，我们应该关注主要目标、梦想和目的是什么。</p><p id="dc43" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这需要代码在什么域中运行？</p><p id="b066" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">一旦我们完全理解了这一点，我们就可以确保编写正确的代码，而不会在代码库中引入错误</p><h1 id="e724" class="lc ld hi bd le lf lg lh li lj lk ll lm io ln ip lo ir lp is lq iu lr iv ls lt bi translated">保持完整性</h1><p id="41fa" class="pw-post-body-paragraph jo jp hi jq b jr lu ij jt ju lv im jw jx lw jz ka kb lx kd ke kf ly kh ki kj hb bi translated">当多个团队在同一个代码库上工作时，或者像我这样，当我们处理很容易损坏的非常旧的代码时，需要特别注意不要破坏正在工作的代码。</p><p id="1e83" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">精致并不是破和的同义词，有可能的是，一个10岁的东西已经成为了企业的核心。</strong></p><p id="3f7e" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在重构会话域、客户或订单的过程中，一个严重的错误就是弹指一挥间，一大块收入就会消失。</p><p id="172d" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">带来了几个在公司工作的人。</p><p id="6ec1" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在我看来，域也是这样的。</p><p id="cc89" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">那么，我们如何保存微妙的代码呢？</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mp"><img src="../Images/c0a529e75862b918fffc0c7315b09d55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Rkjt3dD9X0ZQfhm4.jpg"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">带有反腐败层的架构——来源:<a class="ae jn" href="https://docs.microsoft.com/en-us/azure/architecture/patterns/anti-corruption-layer" rel="noopener ugc nofollow" target="_blank">微软</a></figcaption></figure><h1 id="ae18" class="lc ld hi bd le lf lg lh li lj lk ll lm io ln ip lo ir lp is lq iu lr iv ls lt bi translated">反腐败层</h1><p id="c95b" class="pw-post-body-paragraph jo jp hi jq b jr lu ij jt ju lv im jw jx lw jz ka kb lx kd ke kf ly kh ki kj hb bi translated">听好了，</p><p id="0f9d" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">大多数应用程序都是在没有使用适当的独立模型的情况下开发的，<strong class="jq hj">如果这样的话，模型通常会很麻烦和混乱。</strong></p><p id="abf5" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">有时，这些模型已经与系统如此紧密地结合在一起，所以最好不要碰它们，把它们放在外面。</p><p id="09ac" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这是处理遗留代码时的另一个挑战。</p><p id="02fb" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">反腐败层是位于我们的客户端和外部应用程序之间的一层(它可以是一个包、一个类或整个系统)。</strong></p><p id="33cc" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这一层必须仍然被认为是领域的DDD架构的完整部分。</p><p id="353b" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">它的角色是两个不同领域之间的翻译者</p><h1 id="1c4b" class="lc ld hi bd le lf lg lh li lj lk ll lm io ln ip lo ir lp is lq iu lr iv ls lt bi translated">你是怎么实现的？</h1><p id="1920" class="pw-post-body-paragraph jo jp hi jq b jr lu ij jt ju lv im jw jx lw jz ka kb lx kd ke kf ly kh ki kj hb bi translated">反腐败层应该被视为来自客户端模型的服务。</p><p id="d6ff" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">如果被认为是一种服务，它将非常容易被消费，同时介于两者之间。</p><p id="cc14" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">服务将进行翻译，我们的模型保持隔离。</strong></p><p id="db90" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">该层的形成方式是为每个域使用一个facade，它转换这个facade，然后，为了被消费，需要一个可以使用它的适配器。</p><p id="f10c" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">如果像我这样，你的遗留代码中有许多不同的域。你将需要许多连接到它的门面，而且每个门面需要用它自己的适配器来“适应”,以避免混乱和多重责任。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mq"><img src="../Images/bd1717370bd8ab0bb79fd09311694a03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Pav3qHE-qvBYHNid.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">反腐败层结构—来源:<a class="ae jn" rel="noopener" href="/swlh/while-creating-something-new-take-care-of-those-who-use-the-old-92aa5f5c0039">介质</a></figcaption></figure><h1 id="862c" class="lc ld hi bd le lf lg lh li lj lk ll lm io ln ip lo ir lp is lq iu lr iv ls lt bi translated">你的观点是什么？</h1><p id="8177" class="pw-post-body-paragraph jo jp hi jq b jr lu ij jt ju lv im jw jx lw jz ka kb lx kd ke kf ly kh ki kj hb bi translated">你用过反腐败层吗？</p><p id="6903" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">你写这个的经历是怎样的？</p><p id="21f7" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在下面的评论中写下你的想法。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mr"><img src="../Images/b416d3a2fd7b97fc207e1c01ae3969b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*auxtTCGOOBPQH18GSkEKhA.png"/></div></div></figure><h1 id="84d6" class="lc ld hi bd le lf lg lh li lj lk ll lm io ln ip lo ir lp is lq iu lr iv ls lt bi translated">结论</h1><p id="7245" class="pw-post-body-paragraph jo jp hi jq b jr lu ij jt ju lv im jw jx lw jz ka kb lx kd ke kf ly kh ki kj hb bi translated">我已经做了将近十年的网页开发员了。</p><p id="f9ed" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">与位于伦敦市中心的世界级企业和屡获殊荣的营销机构合作。</p><p id="1ab5" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">此外，我在我的博客和在线社区上写文章和教程，并帮助企业在网上建立他们的存在。</p><p id="bfb8" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><a class="ae jn" href="https://anastasionico.uk/blog" rel="noopener ugc nofollow" target="_blank">点击这里阅读我100多篇博文</a></p></div></div>    
</body>
</html>