<html>
<head>
<title>Using Kustomize and Confd Notes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Kustomize和Confd笔记</h1>
<blockquote>原文：<a href="https://medium.com/codex/using-kustomize-and-confd-notes-3b0b440eb4b5?source=collection_archive---------4-----------------------#2021-09-28">https://medium.com/codex/using-kustomize-and-confd-notes-3b0b440eb4b5?source=collection_archive---------4-----------------------#2021-09-28</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="3dc7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">写这篇文章是为了收集不同来源的笔记。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/4af31fb4e0b85281bd96bb3535e182d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*fX0qRLUcLyvn-iGn.png"/></div></div></figure><p id="e453" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Kustomize[1]是一个独立的工具，可以通过kustomization文件定制Kubernetes对象。从1.14开始，Kubectl还支持使用库化文件管理Kubernetes对象。要查看在包含kustomization文件的目录中找到的资源，请运行以下命令"[0]:</p><pre class="je jf jg jh fd jp jq jr js aw jt bi"><span id="7ce7" class="ju jv hi jq b fi jw jx l jy jz">kubectl kustomize &lt;kustomization_directory&gt;</span></pre><p id="2b1f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要应用这些资源，请使用kustomize或-k标志运行kubectl apply:</p><pre class="je jf jg jh fd jp jq jr js aw jt bi"><span id="cc4a" class="ju jv hi jq b fi jw jx l jy jz">kubectl apply -k &lt;kustomization_directory&gt;</span></pre><p id="59d8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Kustomize用于声明性对象配置。</p><p id="d1e4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">什么是命令式和声明式对象配置？</p><h1 id="fbb8" class="ka jv hi bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">命令性对象配置</h1><p id="65dd" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated">在命令式对象配置中，kubectl命令指定操作(创建、替换等。)、可选标志和至少一个文件名。指定的文件必须包含YAML或JSON格式的对象的完整定义。[2]</p><h1 id="6d8c" class="ka jv hi bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">例子</h1><p id="67d4" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated">创建在配置文件中定义的对象:</p><pre class="je jf jg jh fd jp jq jr js aw jt bi"><span id="00db" class="ju jv hi jq b fi jw jx l jy jz">kubectl create -f nginx.yaml</span></pre><p id="f1c6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">删除两个配置文件中定义的对象:</p><pre class="je jf jg jh fd jp jq jr js aw jt bi"><span id="ead2" class="ju jv hi jq b fi jw jx l jy jz">kubectl delete -f nginx.yaml -f redis.yaml</span></pre><h1 id="daa0" class="ka jv hi bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">权衡取舍</h1><p id="f7ce" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated"><strong class="ih hj">与命令式命令相比的优势</strong>:</p><p id="6da0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对象配置可以存储在Git这样的源代码控制系统中。</p><p id="0ba5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对象配置可以与流程集成，例如在推送和审计跟踪之前检查更改。</p><p id="ab75" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对象配置提供了创建新对象的模板。</p><p id="ee03" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">与命令式命令相比的缺点</strong>:</p><p id="ac5b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对象配置需要对对象模式有基本的了解。</p><p id="78ab" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对象配置需要编写YAML文件的额外步骤。</p><p id="c5d6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">与声明性对象配置相比的优势</strong>:</p><p id="f053" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">命令式对象配置行为更简单，也更容易理解。</p><p id="3756" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从Kubernetes版本开始，命令式对象配置更加成熟。</p><p id="edfb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">与声明性对象配置相比的缺点</strong>:</p><p id="3af3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">命令式对象配置最适用于文件，而不是目录。</p><p id="b2da" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对活动对象的更新必须反映在配置文件中，否则它们将在下次替换时丢失。</p><h1 id="cab2" class="ka jv hi bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">声明性对象配置</h1><p id="651b" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated">当使用声明性对象配置时，用户对本地存储的对象配置文件进行操作，然而，用户不定义要对文件采取的操作。kubectl自动检测每个对象的创建、更新和删除操作。这允许在目录上工作，其中不同的对象可能需要不同的操作。</p><h1 id="ec0d" class="ka jv hi bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">权衡取舍</h1><p id="0908" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated">与命令式对象配置相比的优势:</p><p id="6efd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">直接对活动对象所做的更改会被保留，即使它们没有合并回配置文件中。</p><p id="d965" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">声明性对象配置更好地支持对目录的操作和自动检测每个对象的操作类型(创建、修补、删除)。</p><p id="cc00" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">与命令式对象配置相比的缺点:</p><p id="86be" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当结果出乎意料时，声明性对象配置更难调试和理解。</p><p id="2683" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用diffs的部分更新会产生复杂的合并和修补操作。</p><h1 id="c88a" class="ka jv hi bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">Kustomize用法</h1><ul class=""><li id="5f5a" class="lc ld hi ih b ii kx im ky iq le iu lf iy lg jc lh li lj lk bi translated">从其他来源获取资源</li><li id="c67e" class="lc ld hi ih b ii ll im lm iq ln iu lo iy lp jc lh li lj lk bi translated">为资源设置交叉域</li><li id="460d" class="lc ld hi ih b ii ll im lm iq ln iu lo iy lp jc lh li lj lk bi translated">编写和自定义资源集合</li></ul><h1 id="ed14" class="ka jv hi bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">生成资源</h1><p id="db73" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated">"配置映射和机密保存由其他Kubernetes对象(如pod)使用的配置或敏感数据。配置图或秘密的真实来源通常在集群外部，例如. properties文件或SSH密钥文件。Kustomize有secretGenerator和configMapGenerator，它们从文件或文字生成Secret和ConfigMap。[0]"</p><h1 id="7c1f" class="ka jv hi bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">configMapGenerator</h1><p id="49db" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated">要从文件生成配置映射，请在configMapGenerator[0]的文件列表中添加一个条目</p><pre class="je jf jg jh fd jp jq jr js aw jt bi"><span id="6fc7" class="ju jv hi jq b fi jw jx l jy jz">$ mkdir kustomizeDemo<br/>$ cd kustomizeDemo<br/>$ echo "ENV=DEMO" &gt; demo.yaml<br/>$ cat &lt;&lt;EOF &gt;./kustomization.yaml<br/>configMapGenerator:<br/>- name: demo-configmap<br/>  files:<br/>- demo.yaml<br/>  EOF<br/>  $ kubectl kustomize ./<br/>  apiVersion: v1<br/>  data:<br/>  demo.yaml: |<br/>  ENV=DEMO<br/>  kind: ConfigMap<br/>  metadata:<br/>  name: demo-configmap-47f78c8429<br/>  Other approaches:<br/>  configMapGenerator:<br/>- name: example-configmap-1<br/>  envs:<br/>    - .env<br/>      EOF<br/>      cat &lt;&lt;EOF &gt;./kustomization.yaml<br/>      configMapGenerator:<br/>- name: example-configmap-2<br/>  literals:<br/>    - FOO=Bar<br/>      EOF</span></pre><p id="eec1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是一个使用生成的配置图的示例部署:</p><pre class="je jf jg jh fd jp jq jr js aw jt bi"><span id="c26c" class="ju jv hi jq b fi jw jx l jy jz"># Create a application.properties file<br/>cat &lt;&lt;EOF &gt;application.properties<br/>FOO=Bar<br/>EOF</span><span id="b7f7" class="ju jv hi jq b fi lq jx l jy jz">cat &lt;&lt;EOF &gt;deployment.yaml<br/>apiVersion: apps/v1<br/>kind: Deployment<br/>metadata:<br/>  name: my-app<br/>  labels:<br/>    app: my-app<br/>spec:<br/>  selector:<br/>    matchLabels:<br/>      app: my-app<br/>  template:<br/>    metadata:<br/>      labels:<br/>        app: my-app<br/>    spec:<br/>      containers:<br/>      - name: app<br/>        image: my-app<br/>        volumeMounts:<br/>        - name: config<br/>          mountPath: /config<br/>      volumes:<br/>      - name: config<br/>        configMap:<br/>          name: example-configmap-1<br/>EOF</span><span id="1cbe" class="ju jv hi jq b fi lq jx l jy jz">cat &lt;&lt;EOF &gt;./kustomization.yaml<br/>resources:<br/>- deployment.yaml<br/>configMapGenerator:<br/>- name: example-configmap-1<br/>  files:<br/>  - application.properties<br/>EOF</span></pre><p id="def5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Kustomize生成配置映射，配置映射映射到卷。</p><p id="5566" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">可以在[0]找到secretGenerator。</p><h1 id="fcca" class="ka jv hi bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">设置交叉字段</h1><p id="5fa4" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated">在一个项目中为所有Kubernetes资源设置交叉字段是很常见的。设置交叉字段的一些用例:</p><ul class=""><li id="f520" class="lc ld hi ih b ii ij im in iq lr iu ls iy lt jc lh li lj lk bi translated">添加相同的名称前缀或后缀</li><li id="d9eb" class="lc ld hi ih b ii ll im lm iq ln iu lo iy lp jc lh li lj lk bi translated">添加同一组标签</li><li id="8a51" class="lc ld hi ih b ii ll im lm iq ln iu lo iy lp jc lh li lj lk bi translated">添加相同的注释集</li><li id="752b" class="lc ld hi ih b ii ll im lm iq ln iu lo iy lp jc lh li lj lk bi translated">为所有资源设置相同的命名空间</li></ul><p id="1dbf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里有一个例子:</p><pre class="je jf jg jh fd jp jq jr js aw jt bi"><span id="a529" class="ju jv hi jq b fi jw jx l jy jz"># Create a deployment.yaml<br/>cat &lt;&lt;EOF &gt;./deployment.yaml<br/>apiVersion: apps/v1<br/>kind: Deployment<br/>metadata:<br/>  name: nginx-deployment<br/>  labels:<br/>    app: nginx<br/>spec:<br/>  selector:<br/>    matchLabels:<br/>      app: nginx<br/>  template:<br/>    metadata:<br/>      labels:<br/>        app: nginx<br/>    spec:<br/>      containers:<br/>      - name: nginx<br/>        image: nginx<br/>EOF</span><span id="2cca" class="ju jv hi jq b fi lq jx l jy jz">cat &lt;&lt;EOF &gt;./kustomization.yaml<br/>namespace: my-namespace<br/>namePrefix: dev-<br/>nameSuffix: "-001"<br/>commonLabels:<br/>  app: bingo<br/>commonAnnotations:<br/>  oncallPager: 800-555-1212<br/>resources:<br/>- deployment.yaml<br/>EOF</span></pre><h1 id="ec5e" class="ka jv hi bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">构成和定制资源</h1><h2 id="ad3e" class="ju jv hi bd kb lu lv lw kf lx ly lz kj iq ma mb kn iu mc md kr iy me mf kv mg bi translated">组成</h2><p id="2f8e" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated">Kustomize支持不同资源的合成。kustomization.yaml文件中的resources字段定义了要包含在配置中的资源列表。在资源列表中设置资源配置文件的路径。下面是一个由部署和服务组成的NGINX应用程序的示例:</p><pre class="je jf jg jh fd jp jq jr js aw jt bi"><span id="d20d" class="ju jv hi jq b fi jw jx l jy jz"># Create a deployment.yaml file<br/>cat &lt;&lt;EOF &gt; deployment.yaml<br/>apiVersion: apps/v1<br/>kind: Deployment<br/>metadata:<br/>  name: my-nginx<br/>spec:<br/>  selector:<br/>    matchLabels:<br/>      run: my-nginx<br/>  replicas: 2<br/>  template:<br/>    metadata:<br/>      labels:<br/>        run: my-nginx<br/>    spec:<br/>      containers:<br/>      - name: my-nginx<br/>        image: nginx<br/>        ports:<br/>        - containerPort: 80<br/>EOF</span><span id="2df4" class="ju jv hi jq b fi lq jx l jy jz"># Create a service.yaml file<br/>cat &lt;&lt;EOF &gt; service.yaml<br/>apiVersion: v1<br/>kind: Service<br/>metadata:<br/>  name: my-nginx<br/>  labels:<br/>    run: my-nginx<br/>spec:<br/>  ports:<br/>  - port: 80<br/>    protocol: TCP<br/>  selector:<br/>    run: my-nginx<br/>EOF</span><span id="118c" class="ju jv hi jq b fi lq jx l jy jz"># Create a kustomization.yaml composing them<br/>cat &lt;&lt;EOF &gt;./kustomization.yaml<br/>resources:<br/>- deployment.yaml<br/>- service.yaml<br/>EOF</span></pre><p id="b6f1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">kubectl kustomize的资源。/包含部署和服务对象。</p><h2 id="27b9" class="ju jv hi bd kb lu lv lw kf lx ly lz kj iq ma mb kn iu mc md kr iy me mf kv mg bi translated">定制的</h2><p id="4632" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated">修补程序可用于对资源应用不同的自定义。Kustomize通过patchesStrategicMerge和patchesJson6902支持不同的修补机制。patchesStrategicMerge是文件路径列表。每个文件都应该被解析为一个战略性的合并补丁。修补程序中的名称必须与已经加载的资源名称相匹配。推荐做一件事的小补丁。例如，创建一个用于增加部署副本数量的补丁和另一个用于设置内存限制的补丁。</p><pre class="je jf jg jh fd jp jq jr js aw jt bi"><span id="692b" class="ju jv hi jq b fi jw jx l jy jz"># Create a deployment.yaml file<br/>cat &lt;&lt;EOF &gt; deployment.yaml<br/>apiVersion: apps/v1<br/>kind: Deployment<br/>metadata:<br/>  name: my-nginx<br/>spec:<br/>  selector:<br/>    matchLabels:<br/>      run: my-nginx<br/>  replicas: 2<br/>  template:<br/>    metadata:<br/>      labels:<br/>        run: my-nginx<br/>    spec:<br/>      containers:<br/>      - name: my-nginx<br/>        image: nginx<br/>        ports:<br/>        - containerPort: 80<br/>EOF</span><span id="79ea" class="ju jv hi jq b fi lq jx l jy jz"># Create a patch increase_replicas.yaml<br/>cat &lt;&lt;EOF &gt; increase_replicas.yaml<br/>apiVersion: apps/v1<br/>kind: Deployment<br/>metadata:<br/>  name: my-nginx<br/>spec:<br/>  replicas: 3<br/>EOF</span><span id="0f2a" class="ju jv hi jq b fi lq jx l jy jz"># Create another patch set_memory.yaml<br/>cat &lt;&lt;EOF &gt; set_memory.yaml<br/>apiVersion: apps/v1<br/>kind: Deployment<br/>metadata:<br/>  name: my-nginx<br/>spec:<br/>  template:<br/>    spec:<br/>      containers:<br/>      - name: my-nginx<br/>        resources:<br/>          limits:<br/>            memory: 512Mi<br/>EOF</span><span id="5ac4" class="ju jv hi jq b fi lq jx l jy jz">cat &lt;&lt;EOF &gt;./kustomization.yaml<br/>resources:<br/>- deployment.yaml<br/>patchesStrategicMerge:<br/>- increase_replicas.yaml<br/>- set_memory.yaml<br/>EOF</span></pre><p id="1f19" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">运行kubectl kustomize。/要查看部署:</p><pre class="je jf jg jh fd jp jq jr js aw jt bi"><span id="5810" class="ju jv hi jq b fi jw jx l jy jz">apiVersion: apps/v1<br/>kind: Deployment<br/>metadata:<br/>  name: my-nginx<br/>spec:<br/>  replicas: 3<br/>  selector:<br/>    matchLabels:<br/>      run: my-nginx<br/>  template:<br/>    metadata:<br/>      labels:<br/>        run: my-nginx<br/>    spec:<br/>      containers:<br/>      - image: nginx<br/>        name: my-nginx<br/>        ports:<br/>        - containerPort: 80<br/>        resources:<br/>          limits:<br/>            memory: 512Mi</span></pre><h1 id="2ef6" class="ka jv hi bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">CONFD</h1><p id="f925" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated"><strong class="ih hj"> confd </strong>是一款轻量级配置管理工具，专注于:</p><p id="5b6c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用存储在etcd、consul、dynamodb、redis、vault、zookeeper、aws ssm参数存储或env vars和处理模板资源中的数据来保持本地配置文件最新。重新加载应用程序以获取新的配置文件更改[3]。</p><p id="23a3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> AWS SSM </strong></p><p id="6850" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">AWS Systems Manager允许您集中来自多个AWS服务的操作数据，并跨您的AWS资源自动执行任务。您可以创建资源的逻辑组，例如应用程序、应用程序堆栈的不同层，或者生产和开发环境。使用Systems Manager，您可以选择一个资源组并查看其最近的API活动、资源配置更改、相关通知、操作警报、软件清单和修补程序符合性状态。您还可以根据操作需要对每个资源组采取措施。Systems Manager提供了一个查看和管理AWS资源的中心位置，因此您可以完全了解和控制您的操作。[4]</p><p id="d7fc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Confd与配置管理有关。这就是为什么我对SSM参数商店感兴趣。</p><p id="6a0d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> SSM参数存储</strong></p><p id="90d4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">AWS Systems Manager提供了一个集中的存储来管理您的配置数据，无论是纯文本数据(如数据库字符串)还是机密数据(如密码)。这允许您将您的秘密和配置数据从代码中分离出来。可以标记参数并将其组织成层次结构，从而帮助您更轻松地管理参数。例如，您可以使用相同的参数名称“db-string”和不同的层次路径“dev/db-string”或“prod/db-string”来存储不同的值。Systems Manager与AWS密钥管理服务(KMS)相集成，允许您自动加密存储的数据。您还可以使用AWS身份和访问管理(IAM)来控制用户和资源对参数的访问。参数可以通过其他AWS服务引用，比如亚马逊弹性容器服务、AWS Lambda、AWS CloudFormation。[4]</p><p id="8b34" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一个这样的服务是SSM参数存储，它是一个安全的和管理的键/值存储，非常适合存储参数、秘密和配置信息。然而，在2018年4月，AWS还推出了另一项名为AWS Secrets Manager的服务，提供类似的功能。鉴于这两种服务做的事情差不多，选择哪一种还不清楚。记住这一点，让我们看看这两种服务的相似之处和不同之处，以便更好地理解哪种服务最适合您的架构需求。[5]</p><p id="7398" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">SSM参数商店是免费的，这就是为什么我更喜欢它而不是AWS的秘密管理器。</p><pre class="je jf jg jh fd jp jq jr js aw jt bi"><span id="621c" class="ju jv hi jq b fi jw jx l jy jz">aws ssm put-parameter --name "/myapp/database/url" --type "String" --value "db.example.com"<br/>aws ssm put-parameter --name "/myapp/database/user" --type "SecureString" --value "rob"</span></pre><p id="42e4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上述命令将两个参数放入SSM参数存储中</p><p id="cce9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">confdir是存储模板资源配置和源模板的地方。</p><pre class="je jf jg jh fd jp jq jr js aw jt bi"><span id="8f5c" class="ju jv hi jq b fi jw jx l jy jz">sudo mkdir -p /etc/confd/{conf.d,templates}</span></pre><p id="2a21" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">模板资源定义在confdir下的<a class="ae mh" href="https://github.com/toml-lang/toml" rel="noopener ugc nofollow" target="_blank"> TOML </a>配置文件中。</p><p id="28c1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">/etc/confd/conf . d/my config . toml</p><pre class="je jf jg jh fd jp jq jr js aw jt bi"><span id="975c" class="ju jv hi jq b fi jw jx l jy jz">[template]<br/>src = "myconfig.conf.tmpl"<br/>dest = "/tmp/myconfig.conf"<br/>keys = [<br/>    "/myapp/database/url",<br/>    "/myapp/database/user",<br/>]</span></pre><p id="3b09" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">源模板是<a class="ae mh" href="https://pkg.go.dev/text/template#pkg-overview" rel="noopener ugc nofollow" target="_blank"> Golang文本模板</a>。</p><p id="7072" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">/etc/confd/templates/my config . conf . tmpl</p><pre class="je jf jg jh fd jp jq jr js aw jt bi"><span id="0432" class="ju jv hi jq b fi jw jx l jy jz">[myconfig]<br/>database_url = {{getv "/myapp/database/url"}}<br/>database_user = {{getv "/myapp/database/user"}}</span><span id="5c08" class="ju jv hi jq b fi lq jx l jy jz">confd -onetime -backend ssm</span><span id="8c2b" class="ju jv hi jq b fi lq jx l jy jz">$ cat /tmp/myconfig.conf <br/>[myconfig]<br/>database_url = db.example.com<br/>database_user = rob</span></pre><p id="028c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">0-)<a class="ae mh" href="https://github.com/kelseyhightower/confd" rel="noopener ugc nofollow" target="_blank">https://github.com/kelseyhightower/confd</a></p><p id="8a36" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">1-)【https://aws.amazon.com/systems-manager/features/ T2】</p><p id="f7dc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2-)<a class="ae mh" href="https://www.1strategy.com/blog/2019/02/28/aws-parameter-store-vs-aws-secrets-manager/" rel="noopener ugc nofollow" target="_blank">https://www . 1 strategy . com/blog/2019/02/28/AWS-parameter-store-vs-AWS-secrets-manager/</a></p><p id="c034" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3-)<a class="ae mh" href="https://kubernetes.io/docs/tasks/manage-kubernetes-objects/kustomization/" rel="noopener ugc nofollow" target="_blank">https://kubernetes . io/docs/tasks/manage-kubernetes-objects/kustomization/</a></p><p id="9aec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4-)<a class="ae mh" href="https://github.com/kubernetes-sigs/kustomize" rel="noopener ugc nofollow" target="_blank">https://github.com/kubernetes-sigs/kustomize</a></p><p id="7375" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">5-)<a class="ae mh" href="https://kubernetes.io/docs/concepts/overview/working-with-objects/object-management/" rel="noopener ugc nofollow" target="_blank">https://kubernetes . io/docs/concepts/overview/working-with-objects/object-management/</a></p></div></div>    
</body>
</html>