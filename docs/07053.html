<html>
<head>
<title>Fake webcam for your online meetings, with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python为您的在线会议制作假网络摄像头</h1>
<blockquote>原文：<a href="https://medium.com/codex/fake-webcam-for-your-online-meetings-with-python-755556d7667b?source=collection_archive---------0-----------------------#2022-05-27">https://medium.com/codex/fake-webcam-for-your-online-meetings-with-python-755556d7667b?source=collection_archive---------0-----------------------#2022-05-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="053c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">想象一下。您正在参加一个在线会议，由于这样或那样的原因，您并不真的想打开网络摄像头。但是你看到其他人都戴着它。所以你觉得有义务，你很快整理好你的头发，确保你的衣服看起来合适，你打开相机，不情愿地。我们都经历过。</p><p id="38e2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我有好消息。在Python的帮助下，强制性网络摄像头的暴政可以结束了。我将向您展示如何为您的在线会议创建一个假的网络摄像头，看起来像这样:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/c902ffbb729cce1af93bb2926200edeb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1312/1*48x2q3jDI_J0egzcbWeQbw.gif"/></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/6aeffc7c439057ecdf5d45854a14eb16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1312/1*11zo7CTNeOPl6Sxt5-cDEw.gif"/></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/eab9d746c27a6a93b3fadc9e3ceb59bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1312/1*dI8CD6Eb3bYcIT3Fyn7o_w.gif"/></div></figure><p id="d9cd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当然脸不一定是比尔·盖茨的，可以是自己的录音。</p><p id="f419" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我将向您展示如何用Python对此进行编码。在文章的最后，我会解释你如何为自己使用这个假的网络摄像头。</p><h2 id="f602" class="jl jm hi bd jn jo jp jq jr js jt ju jv iq jw jx jy iu jz ka kb iy kc kd ke kf bi translated">制作一个简单的假网络摄像头</h2><p id="e50e" class="pw-post-body-paragraph if ig hi ih b ii kg ik il im kh io ip iq ki is it iu kj iw ix iy kk ja jb jc hb bi translated">首先我们要导入一些模块，特别是openCV。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="kl km l"/></div></figure><p id="f925" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，我们将创建一个从视频中提取所有帧的函数:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="kl km l"/></div></figure><p id="c10c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们有了框架，我们可以创建一个循环来一个接一个地显示它们。当我们到达最后一帧时，我们将开始向后播放视频，然后当我们到达第一帧时，我们将再次向前播放，我们将永远重复这一过程。这样就不会出现从最后一帧到第一帧的突然过渡(但是要注意不要被看到熵反转)。我们还可以按“q”来停止网络摄像头。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="kl km l"/></div></figure><p id="fc22" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有了这个，我们已经有了一个简单的网络摄像头，可以永远无缝播放。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/c902ffbb729cce1af93bb2926200edeb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1312/1*48x2q3jDI_J0egzcbWeQbw.gif"/></div></figure><p id="d6e1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但我们不必就此止步。</p><p id="9fa5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">添加不同的模式</strong></p><p id="641f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果我们的假网络摄像头化身不只是被动地盯着看，那就更有说服力了。例如，有时在会议中你需要点头表示同意，或者微笑，或者说话，或者做其他事情。因此，我们希望我们的网络摄像头有多种“模式”，我们可以随时通过按键盘上的一个键切换到这些模式。</p><p id="d9fd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为此，你需要为每种模式做一个简短的记录，例如，你只是微笑。然后，我们可以从每个视频中读取帧，并将它们存储在字典中。当我们检测到一个按键(例如，“s”切换到“微笑模式”)，我们将活动模式更改为新的模式，并开始播放相应视频的帧。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="kl km l"/></div></figure><p id="7a1f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">默认情况下，我把切换到某个模式的键盘命令设为该模式名称的第一个字母。现在我把这个‘change _ mode’函数作为一个黑盒，但是我稍后会解释它。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/6aeffc7c439057ecdf5d45854a14eb16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1312/1*11zo7CTNeOPl6Sxt5-cDEw.gif"/></div><figcaption class="kn ko et er es kp kq bd b be z dx translated">这里我按“n”进入点头模式</figcaption></figure><h2 id="4e6a" class="jl jm hi bd jn jo jp jq jr js jt ju jv iq jw jx jy iu jz ka kb iy kc kd ke kf bi translated">优化过渡</h2><p id="59ec" class="pw-post-body-paragraph if ig hi ih b ii kg ik il im kh io ip iq ki is it iu kj iw ix iy kk ja jb jc hb bi translated">所以我们想从一个视频切换到另一个视频，比如从正常模式切换到点头模式。如何以最佳方式从一个过渡到另一个(即尽可能平稳地过渡)？</p><p id="c6aa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当我们进行转换时，我们希望转到与当前模式最相似的新模式框架。</p><p id="d734" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为此，我们可以首先定义图像之间的距离度量。这里我使用一个简单的欧几里德距离，它查看两幅图像的每个像素之间的差异。</p><p id="3dc7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有了这个距离，我们现在可以找到与当前图像最近的图像，并切换到这个图像。例如，如果我们想要从正常模式转换到点头模式，并且我们在正常视频的第132帧，我们将知道我们必须转到点头视频的第86帧，以具有最平滑的可能转换。</p><p id="2293" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以预计算所有这些最佳转换，针对每一帧以及从每一个模式到每一个其他模式。这样我们就不必每次想切换模式时都要重新计算。我还会先压缩图像，这样计算时间会更短。我们还将存储图像之间的最佳距离。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="kl km l"/></div></figure><p id="414b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我可以展示“change_mode”函数，它从预先计算的字典中检索要转换到的最佳帧。我这样做是为了如果你按下“s”来切换到微笑模式，再次按下它将切换回正常模式。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="kl km l"/></div></figure><p id="d411" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了让我们的过渡更加无缝，我们可以添加的另一个改进是，不要总是立即切换模式，而是等待一个更好的过渡机会。例如，如果我们的化身在点头，我们可以等到头部通过中间位置再转换到正常模式。为此，我们将引入一个时间窗口(这里我将其设置为0.5 s)，以便在切换模式之前，我们将在该窗口内等待最佳的转换时间。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="kl km l"/></div></figure><p id="34f1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们的过渡更加顺畅了。但是，它们有时还是很明显的。因此，另一个想法是有目的地向视频添加冻结，就像不稳定连接可能发生的那样，并使用它们来掩盖过渡(我们将使冻结持续时间与两个图像之间的距离成比例)。我们还将添加随机冻结，这样模式就不会变得明显。所以我们增加了这些新的线:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="kl km l"/></div></figure><p id="bda3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用或不使用这些冻结作为一种选择。好了，现在我们真的已经为这些转变打下了基础。我们还可以在网络摄像头上添加什么？</p><h2 id="c4f1" class="jl jm hi bd jn jo jp jq jr js jt ju jv iq jw jx jy iu jz ka kb iy kc kd ke kf bi translated">语音检测</h2><p id="8f5a" class="pw-post-body-paragraph if ig hi ih b ii kg ik il im kh io ip iq ki is it iu kj iw ix iy kk ja jb jc hb bi translated">一个有趣的事情是增加语音检测，这样当我们说话的时候头像也会说话。</p><p id="b25f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是使用pyaudio完成的。在这个stackoverflow线程中感谢Russell Borogove，我从其中获得了大部分代码。基本上，这个想法是看一段时间内麦克风发出的声音的平均振幅，如果它足够高，就可以认为我们一直在说话。最初这段代码是用来检测敲击声的，但是它也可以很好地检测声音。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="kl km l"/></div></figure><p id="65e8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们可以将它添加到主循环中。我这样做是为了在切换回正常模式之前，我们需要在一定数量的连续帧中检测到没有声音，这样我们就不会切换得太频繁。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="kl km l"/></div></figure><p id="050e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，当我们通过麦克风说话时，我们可以让我们的化身开始和停止说话。我把它做成可以通过按“v”来激活或关闭语音检测。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/eab9d746c27a6a93b3fadc9e3ceb59bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1312/1*dI8CD6Eb3bYcIT3Fyn7o_w.gif"/></div></figure><p id="3d08" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这些都是我到目前为止实现的功能。但我欢迎进一步改进的建议。</p><h2 id="d978" class="jl jm hi bd jn jo jp jq jr js jt ju jv iq jw jx jy iu jz ka kb iy kc kd ke kf bi translated">如何使用假网络摄像头</h2><p id="c0ce" class="pw-post-body-paragraph if ig hi ih b ii kg ik il im kh io ip iq ki is it iu kj iw ix iy kk ja jb jc hb bi translated">现在告诉你如何为自己使用所有这些。</p><p id="46e8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，从<a class="ae kr" href="https://github.com/FrancoisLeRoux1/Fake-webcam" rel="noopener ugc nofollow" target="_blank">这里</a>下载所有代码。</p><p id="f2ed" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你要做的是录制几段你自己的视频(在我的Mac上，我使用Photo Booth应用程序来录制)，并将它们放在“视频”文件夹内的一个新文件夹中。你可以为不同的设置创建不同的文件夹，例如，你穿不同的衬衫，或者你的头发看起来不同。</p><p id="b76f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这些视频可以而且应该很短(我用的是大约10秒的视频)，否则如果你用长视频，计算最佳过渡可能需要很长时间。你需要一个名为“正常”的视频，这将是你的默认模式。然后，如果你想让你的虚拟形象说话，你就必须录一段名为“说话”的视频，视频中你在说一些乱七八糟的话。在此之后，你可以记录任何你想要的其他模式(例如，“微笑”，“点头”，“再见”，“等等)。默认情况下，激活/停用这些模式的命令将是其名称的第一个字母(例如，对于“微笑”按“s”)。</p><p id="874c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后你将不得不计算最佳转换。为此，只需运行脚本compute-transitions.py</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="er es ks"><img src="../Images/846cf576a50f3f593a799a5a7b247e3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*caCs08hidmVu-yfDp1skFg.png"/></div></div></figure><p id="708f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这需要几分钟时间。</p><p id="e3e7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，当你完成后，你就可以启动你的假摄像头了。为此，运行fake-webcam.py脚本。您需要在“视频”中指定您的视频所在的文件夹。您还可以指定是否要使用冻结。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="er es kx"><img src="../Images/9e930bcac2be48793189e1b56679c541.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hHpAB8UHhGTMJWWXFqq1fw.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="er es ky"><img src="../Images/ca38486a12cedf1f0bb9618effc9466b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OTGrV6-mU97a1FZZCabsvQ.png"/></div></div></figure><p id="1687" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以现在你应该让你的假相机运行。接下来，您可以将其设置为在线会议的网络摄像头。为此我使用了<a class="ae kr" href="https://obsproject.com" rel="noopener ugc nofollow" target="_blank"> OBS </a>。</p><p id="b1ba" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">选择右侧Python窗口作为源，然后单击启动虚拟相机。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="er es kz"><img src="../Images/c2db4f9ca6ff9de37e24c1cec21dd922.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7d96U_JN4MazUv1f6sebNA.png"/></div></div></figure><p id="2782" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，您应该能够在您最喜欢的在线会议应用程序中选择这个虚拟摄像头作为您的网络摄像头。</p><p id="7064" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">就这样，现在享受不用让自己在会议上看起来像模像样吧！</p></div></div>    
</body>
</html>