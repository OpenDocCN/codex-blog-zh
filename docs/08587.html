<html>
<head>
<title>Extract Data from HTML Tables with Rvest [Export Table Data to a CSV in R]</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Rvest从HTML表格中提取数据</h1>
<blockquote>原文：<a href="https://medium.com/codex/extract-data-from-html-tables-with-rvest-export-table-data-to-a-csv-in-r-28ff329a8c07?source=collection_archive---------16-----------------------#2022-08-18">https://medium.com/codex/extract-data-from-html-tables-with-rvest-export-table-data-to-a-csv-in-r-28ff329a8c07?source=collection_archive---------16-----------------------#2022-08-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/021187956a2a46a873d94d5813d73de6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*8yRnVqqa6VhKf2_K.jpg"/></div></div></figure><p id="637b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最初发布于:</p><p id="369e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Scraper API - <a class="ae jo" href="https://www.scraperapi.com/blog/scrape-html-table-rvest/" rel="noopener ugc nofollow" target="_blank">用Rvest从HTML表格中提取数据【导出表格数据到R中的CSV】</a></p><p id="0aa3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">抓取表格数据这是数据科学家在大规模收集相关信息时所拥有的最强大的技能之一。</p><p id="b932" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如今，互联网上显示的几乎每一组数据都使用HTML表格，以更容易理解的格式组织和显示复杂的数据集。</p><p id="e1d2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在今天的文章中，我们将使用Rvest包从HTML表中提取数据，并将其发送到dataframe进行进一步分析，然后将其导入CSV文件。</p><p id="c2d3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">注意:</strong>如果这是你第一次使用R，按照我们的<a class="ae jo" href="https://www.scraperapi.com/blog/web-scraping-with-r/" rel="noopener ugc nofollow" target="_blank">网页抓取在R初学者教程</a>中的安装和设置说明。您还将学习如何使用我们将在本教程中使用的Rvest包进行基本的抓取。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jp"><img src="../Images/54e65a5809e329d3c137b1a44caaba3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*JAcN5P1B9VEnbReo.jpg"/></div></div></figure><h1 id="78ce" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">1.设置您的开发环境</h1><p id="b41b" class="pw-post-body-paragraph iq ir hi is b it ks iv iw ix kt iz ja jb ku jd je jf kv jh ji jj kw jl jm jn hb bi translated">我们需要做的第一件事是为我们的项目创建一个新目录。打开Rstudio，点击“创建项目”。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div class="er es kx"><img src="../Images/38a106a5bf33f73c760205534f0df595.png" data-original-src="https://miro.medium.com/v2/resize:fit:956/format:webp/0*u6DawBNQWNFhNbrs.png"/></div></figure><p id="5630" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在新文件夹中，点击“新建文件”并创建一个新的R脚本。我们称之为rvest_html_table(它会自动保存为. R文件)。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div class="er es ky"><img src="../Images/cc14ad99532e35f04aab56e18a643146.png" data-original-src="https://miro.medium.com/v2/resize:fit:358/format:webp/0*16Uekl1Nto3D5Sw5.png"/></div></figure><p id="75e1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在我们的新文件中，我们将使用以下命令安装Rvest和Dplyr包:</p><figure class="jq jr js jt fd ij"><div class="bz dy l di"><div class="kz la l"/></div></figure><p id="75c4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">安装可能需要几分钟的时间，但是在最后一步，我们已经准备好创建我们的刮刀了。</p><p id="1936" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先，让我们看看我们的目标站点:</p><h1 id="96b0" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">2.通过ScraperAPI发送初始请求</h1><p id="bc4c" class="pw-post-body-paragraph iq ir hi is b it ks iv iw ix kt iz ja jb ku jd je jf kv jh ji jj kw jl jm jn hb bi translated">对于本教程，我们将抓取<a class="ae jo" href="https://datatables.net/examples/basic_init/multiple_tables.html" rel="noopener ugc nofollow" target="_blank">https://datatables . net/examples/basic _ init/multiple _ tables . html</a>。这是一个伟大的网站来测试你的刮知识，并了解一切表格。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lb"><img src="../Images/af32e3b1a873547233c57d360fde7e94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*cF1DxMHEoGATA_uJ.png"/></div></div></figure><p id="5c0c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">正如我们所看到的，这一页上有两个表格。如果我们想的话，我们可以把它们都刮下来，但是为了这个指南，让我们试着只选择第一个。</p><p id="62bb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">开始时，我们需要做的就是向服务器发送一个HTTP请求并下载HTML文件，然而，随着数据变得越来越有价值，很多网站都在收紧他们的反抓取技术，这可能会使你的脚本无用。</p><p id="7f48" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了让我们的web抓取器有足够的弹性来完成工作，我们需要确保在抓取表数据时尽可能地模仿人类的有机行为。</p><p id="6b44" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">ScraperAPI是一个强大的解决方案，它只需向我们的目标URL添加一个字符串，就可以自动处理这些复杂问题。它使用机器学习，多年的统计数据，第三方代理，和巨大的浏览器农场，以确保你永远不会被反刮技术阻止。</p><p id="d9a8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要使用ScraperAPI，我们需要做的就是创建一个<a class="ae jo" href="https://www.scraperapi.com/signup" rel="noopener ugc nofollow" target="_blank">新的ScraperAPI帐户</a>来生成我们的API密钥并兑换5000个免费API调用。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div class="er es lc"><img src="../Images/846a219f5ea3920e7dbcdeb5bb0f5cde.png" data-original-src="https://miro.medium.com/v2/resize:fit:1284/format:webp/0*-E0v-dleQWMk-BU5.png"/></div></figure><p id="2f5b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们回到Rstudio:</p><ol class=""><li id="cdd0" class="ld le hi is b it iu ix iy jb lf jf lg jj lh jn li lj lk ll bi translated">将Rvest和Dplyr导入到我们的项目中，在文件顶部添加<code class="du lm ln lo lp b">library("rvest")</code>和<code class="du lm ln lo lp b">library("dplyr")</code>(如果您愿意，现在可以删除之前的安装命令)</li><li id="2996" class="ld le hi is b it lq ix lr jb ls jf lt jj lu jn li lj lk ll bi translated">接下来，我们将创建一个名为response的新变量，并使用<code class="du lm ln lo lp b">read_html()</code>方法下载HTML表格。</li></ol><p id="b6c4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因为我们将使用ScraperAPI来发送请求，所以我们需要以以下格式构造我们的URL:</p><figure class="jq jr js jt fd ij"><div class="bz dy l di"><div class="kz la l"/></div></figure><p id="8efe" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">将所有内容放在一起，我们的代码看起来是这样的:</p><figure class="jq jr js jt fd ij"><div class="bz dy l di"><div class="kz la l"/></div></figure><p id="b035" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">注意:</strong>如果您遇到类似“read_html function not found”的错误，请使用以下两个命令安装并导入XML2包:install . packages(“XML 2”)和library(“XML 2”)。</p><p id="cbf3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果一切顺利，在控制台中键入view(response ),它会向您显示从URL中检索到的数据。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div class="er es lv"><img src="../Images/fdc126a38838a8d04b59628370b69cad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1082/format:webp/0*xWqxbsKu4t03qRSs.png"/></div></figure><h1 id="68d9" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">3.将HTML表格数据发送到数据帧</h1><p id="8bb8" class="pw-post-body-paragraph iq ir hi is b it ks iv iw ix kt iz ja jb ku jd je jf kv jh ji jj kw jl jm jn hb bi translated">对于表格数据，Rvest有一个优雅的函数，它接受HTML响应并检测文档中的HTML表格。要使用它，让我们创建一个名为tables的新变量，并使用管道操作符(%&gt;%)对响应变量使用html_table()函数:</p><figure class="jq jr js jt fd ij"><div class="bz dy l di"><div class="kz la l"/></div></figure><p id="c101" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这将使用表中的数据自动创建一个数据框架。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lw"><img src="../Images/08383d8e96a058e336c3b557b6de9ee7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*eESIj1MvzlO2WMhD.png"/></div></div></figure><p id="f4fa" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一些注意事项:</p><ul class=""><li id="248a" class="ld le hi is b it iu ix iy jb lf jf lg jj lh jn lx lj lk ll bi translated">当表格缺少单元格中的数据时，您需要向<code class="du lm ln lo lp b">html_table()</code>函数添加一个<code class="du lm ln lo lp b">fill = TRUE</code>参数，但是现在已经没有必要了。</li><li id="6d70" class="ld le hi is b it lq ix lr jb ls jf lt jj lu jn lx lj lk ll bi translated">在这个表的例子中，标题的行是使用<code class="du lm ln lo lp b">&lt;th&gt;</code>标签构建的，所以不需要在<code class="du lm ln lo lp b">html_table()</code>函数中使用headers参数。</li></ul><h1 id="b29a" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">4.选择正确的表格</h1><p id="31ff" class="pw-post-body-paragraph iq ir hi is b it ks iv iw ix kt iz ja jb ku jd je jf kv jh ji jj kw jl jm jn hb bi translated">当应用于文档时，<code class="du lm ln lo lp b">html_table()</code>函数返回一个<a class="ae jo" href="https://www.educative.io/answers/what-is-tibble-versus-data-frame-in-r" rel="noopener ugc nofollow" target="_blank">tibles</a>的列表(“R编程语言中的一个包，用于操作和打印数据帧”)。如果你仔细观察，数据帧中的每个表都有一个指定的数字，我们可以用它来选择我们需要的表。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div class="er es ly"><img src="../Images/4e713b9437a9478738f7d30dae508996.png" data-original-src="https://miro.medium.com/v2/resize:fit:1186/format:webp/0*Oy7-3QLB6PKLg184.png"/></div></figure><figure class="jq jr js jt fd ij"><div class="bz dy l di"><div class="kz la l"/></div></figure><p id="f175" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">它将只返回第一个表数据，并将其放入dataframe中。在下图中，您可以看到只有table_one在右侧有dataframe图标。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jp"><img src="../Images/870b8619b5f8527044b52d4be52d579d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*E6hYn46eV1hAKZZD.png"/></div></div></figure><p id="6cbc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">单击table_one或在控制台上键入<code class="du lm ln lo lp b">View(table_one)</code>打开它——请记住，View命令区分大小写，因此请确保V是大写的。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div class="er es lz"><img src="../Images/4b75f7ce8b968d338df8a41d6dda1a66.png" data-original-src="https://miro.medium.com/v2/resize:fit:1002/format:webp/0*0qF_uMGn3699aUUv.png"/></div></figure><h1 id="5d45" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">5.将数据帧发送到CSV文件</h1><p id="ff7e" class="pw-post-body-paragraph iq ir hi is b it ks iv iw ix kt iz ja jb ku jd je jf kv jh ji jj kw jl jm jn hb bi translated">因为我们的数据框架已经创建好了，所以将这些数据导入CSV文件非常容易。首先，让我们<a class="ae jo" href="https://datatofish.com/export-dataframe-to-excel-in-r/" rel="noopener ugc nofollow" target="_blank">用<code class="du lm ln lo lp b">install.packages("writexl")</code>安装Writexl包</a>，然后将其导入到我们的项目<code class="du lm ln lo lp b">library("writexl")</code>中。</p><p id="670f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了创建我们的文件，我们将使用<code class="du lm ln lo lp b">write_xlsx()</code>函数，并向它传递我们的数据帧(table_one)和引号之间的文件路径。</p><figure class="jq jr js jt fd ij"><div class="bz dy l di"><div class="kz la l"/></div></figure><p id="785b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">的。/告诉我们的脚本在当前目录下(从我们的项目中)创建文件，然后创建文件名。</p><p id="ab49" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">注意:</strong>您可以为文件使用不同的扩展名，如. xlsx。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div class="er es ma"><img src="../Images/280017119689ab66714eccdee2eac7a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:834/format:webp/0*EnZIYT2YhoNT3ZQQ.png"/></div></figure><p id="ec30" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">仅此而已。恭喜你，你只用了几行代码就完成了整个HTML表格。</p><p id="1dae" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们的脚本是这样结束的:</p><figure class="jq jr js jt fd ij"><div class="bz dy l di"><div class="kz la l"/></div></figure><p id="4fec" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">多亏了html_table()函数，用Rvest抓取HTML表格变得非常容易。如果你从一个网站上抓取了几个表格，将每个表格分配给它们的our变量，这样你就可以为每个表格创建一个数据框架，并根据你的喜好导出它们。</p><p id="fd56" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你想从分页的页面中抓取HTML表格，看看我们的<a class="ae jo" href="https://www.scraperapi.com/blog/how-to-scrape-etsy/" rel="noopener ugc nofollow" target="_blank">高级Rvest web抓取教程</a>，在那里我们将更详细地介绍抓取多个页面并将它们合并成一个数据帧。</p><p id="847a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下次见，刮刮快乐！</p></div></div>    
</body>
</html>