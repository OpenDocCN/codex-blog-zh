<html>
<head>
<title>Tryhackme: Overpass</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Tryhackme:天桥</h1>
<blockquote>原文：<a href="https://medium.com/codex/tryhackme-overpass-c7bc995e196f?source=collection_archive---------13-----------------------#2022-12-17">https://medium.com/codex/tryhackme-overpass-c7bc995e196f?source=collection_archive---------13-----------------------#2022-12-17</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/6c591dc8adef66056f2667570ab03908.png" data-original-src="https://miro.medium.com/v2/resize:fit:540/format:webp/0*V1v64VIXUWJqWh3a.png"/></div></figure><p id="ff97" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">transition是一个简单的TryHackMe机器，我们将在其中利用一个失败的身份验证错误来访问应用程序中的ssh密钥。稍后，我们将通过模拟在计划作业中运行的脚本来提升权限。</p></div><div class="ab cl jk jl gp jm" role="separator"><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp"/></div><div class="hb hc hd he hf"><p id="2f50" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">像往常一样，在TryHackMe中，我们必须连接到VPN或使用攻击箱。我会选择VPN。我们按下启动机器按钮，一分钟后，他们给我们显示IP地址。现在，我们继续使用Nmap进行初始识别:</p><pre class="jr js jt ju fd jv jw jx bn jy jz bi"><span id="c4aa" class="ka kb hi jw b be kc kd l ke kf">nmap -p- -sV -Pn $IP</span></pre><p id="d63a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">带连字符的-p参数表示扫描所有端口,-sV参数表示对使用的版本进行指纹识别，而-Pn参数表示扫描机器，即使它不响应ping。</p><figure class="jr js jt ju fd ij er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es kg"><img src="../Images/00bdcd7fb9e0515eda395b82e278b159.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x0Y3GT-bKtWn4DHYf_i8bg.png"/></div></div></figure><p id="bd70" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们可以看到，该机器只暴露了一个web服务器和一个SSH服务器。让我们深入研究web服务器。</p><p id="80c9" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">首先，通过模糊化，我们可以找到一些有趣的端点。</p><figure class="jr js jt ju fd ij er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es kl"><img src="../Images/4bb68ee707bf1b65bd65a3e1887a8e3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HkPPzY9cPjHVQ3hE5eVKqw.png"/></div></div></figure><p id="4643" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在管理端点上，我们可以看到一个名为login.js的javascript文件，它在suscesfull auth:</p><pre class="jr js jt ju fd jv jw jx bn jy jz bi"><span id="ef60" class="ka kb hi jw b be kc kd l ke kf">async function login() {<br/>    const usernameBox = document.querySelector("#username");<br/>    const passwordBox = document.querySelector("#password");<br/>    const loginStatus = document.querySelector("#loginStatus");<br/>    loginStatus.textContent = ""<br/>    const creds = { username: usernameBox.value, password: passwordBox.value }<br/>    const response = await postData("/api/login", creds)<br/>    const statusOrCookie = await response.text()<br/>    if (statusOrCookie === "Incorrect credentials") {<br/>        loginStatus.textContent = "Incorrect Credentials"<br/>        passwordBox.value=""<br/>    } else {<br/>        Cookies.set("SessionToken",statusOrCookie)<br/>        window.location = "/admin"<br/>    }<br/>}</span></pre><p id="1177" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们可以从浏览器控制台生成cookie并绕过身份验证。</p><pre class="jr js jt ju fd jv jw jx bn jy jz bi"><span id="80e2" class="ka kb hi jw b be kc kd l ke kf">Cookies.set("SessionToken", 1)</span></pre><p id="cc01" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在我们可以在页面上看到james的加密SSH密钥:</p><figure class="jr js jt ju fd ij er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es km"><img src="../Images/a00ebe36a7423f32ec554c27f4c5b69b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PpvRO6QmViza3XaKzmI5lg.png"/></div></div></figure><p id="c9df" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在我们可以破解这个ssh密钥的密钥，以便能够在SSH服务中以James的身份登录。</p><figure class="jr js jt ju fd ij er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es kn"><img src="../Images/6d1b53ac6de2223c5a3c49755f2dbf3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A3xVQjd1za2QtKrHAQytbg.png"/></div></div></figure><p id="c642" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在，我们可以访问系统并查看待办事项列表，其中一项待办事项是关于自动化脚本的。能关注一下就好了。</p><figure class="jr js jt ju fd ij er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es ko"><img src="../Images/44fda06c2d4c1289bbb0cddcffd5060a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*umYa_qz-akE7JkM4SOukKQ.png"/></div></div></figure><p id="9d0d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">参考crontab，我们看到它下载并执行一个文件。</p><figure class="jr js jt ju fd ij er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es kp"><img src="../Images/c469e1f7404488da1bac56909dda09b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M4F7-V_3Z_eHK3vzqjQyJA.png"/></div></div></figure><p id="181c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">如果我们查看它的内容，我们会发现它调用date时没有指定完整的路径。</p><figure class="jr js jt ju fd ij er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es kq"><img src="../Images/cf2515cbf4ff842b49b777758a975483.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zsjkzqd5mHt1sa-u-fvfOQ.png"/></div></div></figure><p id="deea" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">因为我们可以操纵/etc/hosts，所以我们可以让域指向我们的机器，并利用它来为我们想要的任何脚本服务。</p><figure class="jr js jt ju fd ij er es paragraph-image"><div class="er es kr"><img src="../Images/9ea425e271bdd6bccbd0a68058275775.png" data-original-src="https://miro.medium.com/v2/resize:fit:930/format:webp/1*01HuqNHqCySCphkWSMa9qg.png"/></div></figure><p id="8752" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">一旦被操纵，我们就可以创建一个带有反向外壳的脚本并为其服务。</p><figure class="jr js jt ju fd ij er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es ks"><img src="../Images/7ff3cd0d6ad432adcd74656b128a2bbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*epKwSxKuQs8TMz3u13pdzg.png"/></div></div></figure><p id="a50d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">过了一会儿，一旦执行了cronjob，我们将得到一个shell作为root</p><figure class="jr js jt ju fd ij er es paragraph-image"><div class="er es kt"><img src="../Images/20a04586d306bdbb98b075f948e0f8a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1278/format:webp/1*O3SCvQRBno5AnX2dVBF87w.png"/></div><figcaption class="ku kv et er es kw kx bd b be z dx translated"><strong class="bd ky"> PWNed！</strong></figcaption></figure></div><div class="ab cl jk jl gp jm" role="separator"><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp"/></div><div class="hb hc hd he hf"><p id="648b" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我希望你喜欢我的文章，并发现我的内容有用。下一篇文章再见。</p></div></div>    
</body>
</html>