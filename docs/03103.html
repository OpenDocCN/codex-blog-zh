<html>
<head>
<title>Short-term Stock Price Prediction using Machine Learning and NLP models.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用机器学习和NLP模型的短期股票价格预测。</h1>
<blockquote>原文：<a href="https://medium.com/codex/short-term-stock-price-prediction-using-machine-learning-and-nlp-models-100440cc8ba2?source=collection_archive---------14-----------------------#2021-08-18">https://medium.com/codex/short-term-stock-price-prediction-using-machine-learning-and-nlp-models-100440cc8ba2?source=collection_archive---------14-----------------------#2021-08-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/71f81e4c0179f2600a86e6c7079193dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*T4l9RaIWCaGIcLee"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated"><a class="ae iu" href="https://unsplash.com/@m_b_m?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> M. B. M. </a>在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="6c49" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这篇博客中，我讨论了我的经验和我的学术研究概述，这些研究使用随机森林、LASSO回归和未来两天的分类模型预测公司的短期股价，还分析了其他经济因素，如公共新闻、Twitter feeds等。最后，该系统用简单有效的用户界面建议股票交易者买卖股票以避免他们在日常交易中的损失。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jt"><img src="../Images/dcf53d291dfb28ebade2b76672f60140.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Bjql65zZlCz3gcZYp-MFxg.jpeg"/></div></div></figure><p id="87cc" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">股票市场是一个国家经济的驱动因素，也是许多投资者和股东的创收因素。因此，已经提出了许多尝试来预测每日股票市场中股票指数的运动，但是大多数系统缺乏其他影响因素的实时相关性，例如特定公司的内部因素、公司的公众认知、国家的突然变化，这些因素可能间接影响预测。因此，即使是有经验的股票交易者，预测股票指数的走势也是一项平凡的任务。</p><p id="4379" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为了最小化交易者和购买者之间的非盈利交易决策的影响或减少其机会，以下系统解决了所有影响因素中的大部分，并防止当日股票交易者通过在错误的时间投资于非理想的公司来避免损失。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jy"><img src="../Images/e30c72ef54c24e316f60d00b50f72275.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n-McHrsqksNKW31gFiU2Yw.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">研究的概念图。</figcaption></figure><p id="7c67" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">该项目的第一步是将范围缩小到每日股票交易，重点是使用从开源数据网站收集的特定股票指数的开盘价、最高价、最低价和过去数据量来预测股票的收盘价。在分析模型之前，我必须做一些预处理步骤，如清理数据，删除空字符等(如果你是计算机科学的学生，知道我的意思😉).因此，在完成这项平凡的任务后，我开始训练多种机器学习模型，特别是回归模型，以最适合预测这家公司的未来业绩。顺便说一下，出于研究目的，我选择了苹果股票指数(<strong class="ix hj">【AAPL】</strong>)和道琼斯指数(<strong class="ix hj"> DWJA </strong>)，因为它们因产品或经济因素的突然发布而具有最高的不稳定表现。所以在比较了随机森林、SVM、决策树等模型后，XGBoost随机森林给了我更好的损失函数度量。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jz"><img src="../Images/d574e77896d107c04eb3113892d24d46.png" data-original-src="https://miro.medium.com/v2/resize:fit:594/format:webp/1*JU1eEBlr1RzDZWtWWuR78Q.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">所有回归模型的损失函数值。</figcaption></figure><p id="9399" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在最终确定主要模型后，我开始分析最佳分类模型，以使用NLP和从Kaggle收集的数据集来找到主导外部因素的影响。按照相同的预处理步骤去除停用词，减少数据集中的噪声，我能够找到最准确的模型是SoftMax分类模型，其准确率为97.07%。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es ka"><img src="../Images/5e906390170d1e24f9165e45b0d30b29.png" data-original-src="https://miro.medium.com/v2/resize:fit:660/format:webp/1*bB_ZUnFRtYioiiO1DCZeQw.jpeg"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">所有分类模型的准确性度量。</figcaption></figure><p id="1db6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">分类模型的目的是发现目前影响股票交易的用户情绪，因此Softamam模型非常擅长通过新闻话题和Twitter推文从经验证的股票市场用户中发现用户情绪，并将其建议给股票交易员。</p><p id="1cf7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">最终确定模型后，我进行了K倍验证，以证明我获得的模型是平衡的，既没有过度拟合也没有欠拟合。在执行了3层验证之后，测试数据获得了令人印象深刻的96%的分数。我在UI中添加了预测值与实际值的图表，为用户提供额外的信息。</p><p id="6c8e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">下图显示了随机森林回归模型的实现。</p><pre class="ju jv jw jx fd kb kc kd ke aw kf bi"><span id="a7f2" class="kg kh hi kc b fi ki kj l kk kl">#import Roandom Forest model<br/>from sklearn.ensemble import RandomForestRegressor<br/><br/>from datetime import datetime<br/>start_time = datetime.now()<br/><br/>#fitting into the model<br/>rfr = RandomForestRegressor(n_estimators=1000, criterion='mse', random_state=42,verbose=0)<br/>rfr.fit(x_training, y_training)<br/><br/>#predict target from training data<br/>rfr_predictions = rfr.predict(x_testing)<br/>rfr_predictions<br/><br/>pickle.dump(rfr, open("aapl_tdyPrediction.pkl", 'wb'))<br/>print('model saved...')</span></pre><p id="98cc" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">下图是预处理步骤和用户新闻情感分类模型的实现。</p><pre class="ju jv jw jx fd kb kc kd ke aw kf bi"><span id="f346" class="kg kh hi kc b fi ki kj l kk kl">#import aaple news set<br/>dataFrame=pds.read_csv("C:\\Users\\Acer\\Desktop\\AAPL\\AAPL_News(label-today).csv", encoding= "ISO-8859-1")<br/>dataFrame.head()<br/><br/>dataFrame.shape<br/><br/>#split into testing and traing set<br/>training_set = dataFrame[:3281]<br/>testing_set = dataFrame[-820:]<br/><br/>#preprocessing part<br/>#removing stop words and white spece.<br/>news_data= training_set.iloc[:, 2:27]<br/>news_data.replace("[^a-zA-Z]", " ", regex=True, inplace=True)<br/><br/>#converting upper to lower case letters<br/>for col in news_data.columns:<br/>    news_data[col]=news_data[col].str.lower()<br/>news_data.head(1)<br/><br/>#append all news to an array<br/>news_headlines = []<br/>for row in range(0, len(news_data.index)):<br/>    news_headlines.append(' '.join(str(x) for x in news_data.iloc[row, 0:25]))<br/><br/>from sklearn.feature_extraction.text import TfidfVectorizer<br/>from sklearn.feature_extraction.text import CountVectorizer<br/>from sklearn.ensemble import RandomForestClassifier<br/><br/># implement RandomForest Classifier model with parameters<br/>rfc=RandomForestClassifier(n_estimators=100,criterion='gini',max_features='auto',bootstrap=True,max_depth=1000,min_samples_split=2<br/><br/>#fit data to model<br/>rfc.fit(train_df, training_set['Label'])<br/><br/># transform text sentiment to vector sentiment<br/>test_transformVector= []<br/>for row in range(0, len(testing_set.index)):<br/>    test_transformVector.append(' '.join(str(x) for x in testing_set.iloc[row, 2:27]))<br/>test_tranform_data = count_vector.transform(test_transformVector)<br/><br/>#prediction for the Test Dataset<br/>rfc_predictions = rfc.predict(test_tranform_data)<br/><br/>#dumping the most efficent model<br/>pickle.dump(rfc, open("nlp_model.pkl", 'wb'))<br/>print('model saved...')</span></pre><p id="d048" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">下图显示了使用python flask集成模型和前端的web应用程序的API实现。</p><pre class="ju jv jw jx fd kb kc kd ke aw kf bi"><span id="c364" class="kg kh hi kc b fi ki kj l kk kl"><em class="km"># function to predict the price for AAPL and stock and news<br/></em>@app.route(<strong class="kc hj">'/predictAAPL'</strong>, methods=[<strong class="kc hj">'POST'</strong>])<br/>def predict():<br/>    <em class="km"># get stock values from the front end.<br/>    </em>getVal1 = float(request.form[<strong class="kc hj">'ph1'</strong>])<br/>    getVal2 = float(request.form[<strong class="kc hj">'ph2'</strong>])<br/>    getVal3 = float(request.form[<strong class="kc hj">'ph3'</strong>])<br/>    getVal4 = float(request.form[<strong class="kc hj">'ph4'</strong>])<br/>    finalarray = np.array([[getVal1, getVal2, getVal3, getVal4]])  <em class="km"># convert into an array<br/><br/>    # get news topic from the front end.<br/>    </em>getNewsVal = str(request.form[<strong class="kc hj">'ph'</strong>])<br/>    news_array = [getNewsVal]  <em class="km"># convert into an array<br/>    </em>predictions = nlpModel.predict(transform_model.transform(news_array))  <em class="km"># prediction<br/>    </em>pred = predictions[0]<br/><br/>    <em class="km"># condition to suggestion for trade<br/>    </em>if pred == 0:<br/>        predictText = <strong class="kc hj">'Not a good day to trade'<br/>    </strong>else:<br/>        predictText = <strong class="kc hj">'Good day to trade'<br/><br/>    </strong><em class="km"># prediction for the two days with .2 decimal places<br/>    </em>prediction = <strong class="kc hj">'%.2f' </strong>% aaplModelTdy.predict(finalarray)<br/>    tomoPrediction = <strong class="kc hj">'%.2f' </strong>% aaplModelTmrw.predict(finalarray)<br/><br/>    <em class="km"># return all values to the front end.<br/>    </em>return render_template(<strong class="kc hj">'AAPLPredict.html'</strong>, data=predictText, data1=prediction, data2=tomoPrediction)</span></pre><p id="6ca5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在通过所有测试和评估标准分析了系统的性能后，UI是designed❤，它来自Bootstrap和Javascript库，如chart.js等等😍…</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kn"><img src="../Images/d72367a3f814662519fc84559da49797.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1GSg5LT0y89eNJ0bnSOYzw.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">股票价格预测</figcaption></figure><p id="5a7e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">当用户进入网站时，他们只需输入他们刚刚获得的新闻的过去值。该系统将提供对今天和明天的即时预测，以及过去历史与预测值的图表，以使用户相信该系统是可靠的。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ko"><img src="../Images/8097422ae110141457b3d14bdccef9e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M08tcT32uldijf7PjxgkmQ.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">显示来自已验证信息的最新信息，以便用户使用。</figcaption></figure><p id="879a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">由于分类模型对用户输入的和最新发布的关于特定组织的新闻进行分类，股票交易者将获得关于今天和明天表现的更新信息。在从目标受众那里获得用户响应后，我能够得出这样的结论:这样的系统将在股票交易领域和领域专家中获得良好的认可和响应。</p><p id="17bd" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">因此，从这篇文章中，我很高兴分享我在研究期间的经历和面临的挑战。对于那些希望进一步了解我的技术实现的人，你们都可以查看我的<a class="ae iu" href="https://github.com/Purushothh/FYP/tree/master" rel="noopener ugc nofollow" target="_blank"> GitHub库</a>和我发表在I <a class="ae iu" href="https://icaeta.aiplustech.org/accepted.html" rel="noopener ugc nofollow" target="_blank"> CAETA 2021 Turkey </a>上的研究文章，或者在<a class="ae iu" href="https://youtu.be/jS5DySLBYaQ" rel="noopener ugc nofollow" target="_blank"> Youtube </a>上的产品演示(可以更详细地了解高层设计和技术栈)。</p><p id="c5bf" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我结束了这篇博客，它总结了我对金融领域一年的研究，我坚信这可以激励其他技术爱好者或学生从这一点上进一步尝试，或者找出可以添加到这个原型中的任何进一步的改进。</p><p id="4f95" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">到那时再见！！！干杯！🥂</p></div></div>    
</body>
</html>