<html>
<head>
<title>Accepting a payment using Stripe (Kotlin/Javalin)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Stripe (Kotlin/Javalin)接受付款</h1>
<blockquote>原文：<a href="https://medium.com/codex/accepting-a-payment-using-stripe-kotlin-javalin-ea97035222c?source=collection_archive---------6-----------------------#2022-06-16">https://medium.com/codex/accepting-a-payment-using-stripe-kotlin-javalin-ea97035222c?source=collection_archive---------6-----------------------#2022-06-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="09df" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">Stripe是一种基于云的服务，支持向客户收取产品或服务费用。使用Stripe API，您不会像管理信用卡那样管理敏感信息。让我们学习如何使用它。</h2></div><h1 id="b713" class="ix iy hi bd iz ja jb jc jd je jf jg jh io ji ip jj ir jk is jl iu jm iv jn jo bi translated">1.设置</h1><ol class=""><li id="e4f0" class="jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg bi translated"><a class="ae kh" href="https://dashboard.stripe.com/register" rel="noopener ugc nofollow" target="_blank">注册一个Stripe账户</a>如果你还没有。</li><li id="1e60" class="jp jq hi jr b js ki ju kj jw kk jy kl ka km kc kd ke kf kg bi translated"><a class="ae kh" href="https://lsoares.medium.com/kotlin-gradle-junit-starter-project-a113a2cc9cbb" rel="noopener">创建新的Kotlin项目。</a></li></ol><h1 id="7b1c" class="ix iy hi bd iz ja jb jc jd je jf jg jh io ji ip jj ir jk is jl iu jm iv jn jo bi translated">2.Web处理程序</h1><ol class=""><li id="faa9" class="jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg bi translated">将Javalin (web框架)和Stripe client添加到您的<code class="du kn ko kp kq b">build.gradle.kts</code>依赖关系中:</li></ol><pre class="kr ks kt ku fd kv kq kw kx aw ky bi"><span id="4d1a" class="kz iy hi kq b fi la lb l lc ld">implementation(“com.stripe:stripe-java:20.+”)<br/>implementation(“org.slf4j:slf4j-simple:1.+”)<br/>implementation(“io.javalin:javalin:4.+”)</span></pre><p id="7bbb" class="pw-post-body-paragraph le lf hi jr b js lg ij lh ju li im lj jw lk ll lm jy ln lo lp ka lq lr ls kc hb bi translated">2.<em class="lt">我们需要设置web请求处理程序。</em>创建一个包含以下内容的<code class="du kn ko kp kq b">src/kotlin/Main.kt</code>:</p><figure class="kr ks kt ku fd lu"><div class="bz dy l di"><div class="lv lw l"/></div></figure><p id="1f50" class="pw-post-body-paragraph le lf hi jr b js lg ij lh ju li im lj jw lk ll lm jy ln lo lp ka lq lr ls kc hb bi translated">请注意，您需要替换两个值:</p><ul class=""><li id="94be" class="jp jq hi jr b js lg ju li jw lx jy ly ka lz kc ma ke kf kg bi translated"><code class="du kn ko kp kq b"><strong class="jr hj">STRIPE_API_KEY</strong></code>:确保你的<a class="ae kh" href="https://dashboard.stripe.com/" rel="noopener ugc nofollow" target="_blank">条纹仪表盘</a>处于“测试模式”(右上角)。前往“<a class="ae kh" href="https://dashboard.stripe.com/developers" rel="noopener ugc nofollow" target="_blank">开发者</a>”(右上)→“<a class="ae kh" href="https://dashboard.stripe.com/developers" rel="noopener ugc nofollow" target="_blank">API密钥</a>”(左侧菜单)→“标准密钥”→“可发布密钥”(这是一个演示密钥)。注意，你应该用它来设置一个环境变量，而不是把它留在代码中，从而留在源代码控制中。</li><li id="273a" class="jp jq hi jr b js ki ju kj jw kk jy kl ka km kc ma ke kf kg bi translated"><code class="du kn ko kp kq b"><strong class="jr hj">PRICE_ID</strong></code>:在<a class="ae kh" href="https://dashboard.stripe.com/" rel="noopener ugc nofollow" target="_blank">条纹仪表盘</a>中找到并点击<a class="ae kh" href="https://dashboard.stripe.com/products?active=true" rel="noopener ugc nofollow" target="_blank">产品</a>，然后创建一个新产品。确认产品创建，并在新创建的产品中，滚动到“定价”部分。在那里，您可以复制所需价格的“API ID”。</li></ul><figure class="kr ks kt ku fd lu er es paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="er es mb"><img src="../Images/ac497a95d8282e58e95784f37f9fed50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3ahORWM3UZOO5Kdqz58Ecw.png"/></div></div></figure><p id="cd23" class="pw-post-body-paragraph le lf hi jr b js lg ij lh ju li im lj jw lk ll lm jy ln lo lp ka lq lr ls kc hb bi translated">📝<em class="lt">您可以通过</em> <code class="du kn ko kp kq b"><em class="lt">Product.retrieve(PROD_ID)</em></code> <em class="lt">获取产品详情(如标题、图片网址)。</em></p><h1 id="b205" class="ix iy hi bd iz ja jb jc jd je jf jg jh io ji ip jj ir jk is jl iu jm iv jn jo bi translated">3.网页</h1><p id="215f" class="pw-post-body-paragraph le lf hi jr b js jt ij lh ju jv im lj jw mi ll lm jy mj lo lp ka mk lr ls kc hb bi translated">我们需要用户将看到的HTML页面。在这个例子中，我们可以使用硬编码的HTML。但是，让我们添加一个服务器端模板库，这样我们就可以显示从Stripe API获得的价格细节。增加<a class="ae kh" href="https://jte.gg/" rel="noopener ugc nofollow" target="_blank"> jte </a>至<code class="du kn ko kp kq b">build.gradle.kts</code>:</p><pre class="kr ks kt ku fd kv kq kw kx aw ky bi"><span id="a5df" class="kz iy hi kq b fi la lb l lc ld">implementation(“gg.jte:jte:1.+”)</span></pre><p id="42f3" class="pw-post-body-paragraph le lf hi jr b js lg ij lh ju li im lj jw lk ll lm jy ln lo lp ka lq lr ls kc hb bi translated">我们需要一个结帐页面来表示购物车的结帐；它包含客户添加的所有产品。在我们的例子中，它包含单一产品。在实际情况下，它可能包含存储在会话中的产品。增加<code class="du kn ko kp kq b">src/main/jte/checkout.jte</code>，内容如下:</p><figure class="kr ks kt ku fd lu"><div class="bz dy l di"><div class="lv lw l"/></div></figure><p id="0b0f" class="pw-post-body-paragraph le lf hi jr b js lg ij lh ju li im lj jw lk ll lm jy ln lo lp ka lq lr ls kc hb bi translated"><em class="lt">我们需要一个成功的页面，代表支付成功时从条纹回调。</em>增加<code class="du kn ko kp kq b">src/main/jte/success.jte</code>，内容如下:</p><figure class="kr ks kt ku fd lu"><div class="bz dy l di"><div class="lv lw l"/></div></figure><p id="9540" class="pw-post-body-paragraph le lf hi jr b js lg ij lh ju li im lj jw lk ll lm jy ln lo lp ka lq lr ls kc hb bi translated"><em class="lt">取消页面处理用户取消支付。</em>增加<code class="du kn ko kp kq b">src/main/jte/cancel.jte</code>，内容如下:</p><figure class="kr ks kt ku fd lu"><div class="bz dy l di"><div class="lv lw l"/></div></figure><h1 id="74b9" class="ix iy hi bd iz ja jb jc jd je jf jg jh io ji ip jj ir jk is jl iu jm iv jn jo bi translated">4.测试付款</h1><p id="6df1" class="pw-post-body-paragraph le lf hi jr b js jt ij lh ju jv im lj jw mi ll lm jy mj lo lp ka mk lr ls kc hb bi translated">让我们在localhost中进行一次假支付:</p><ol class=""><li id="051c" class="jp jq hi jr b js lg ju li jw lx jy ly ka lz kc kd ke kf kg bi translated">跑<code class="du kn ko kp kq b">Main.kt</code>，去<code class="du kn ko kp kq b">http://localhost:7000/checkout</code>。</li><li id="86d7" class="jp jq hi jr b js ki ju kj jw kk jy kl ka km kc kd ke kf kg bi translated">点击“结帐”按钮进入条纹支付页面。</li><li id="fb12" class="jp jq hi jr b js ki ju kj jw kk jy kl ka km kc kd ke kf kg bi translated">现在可以使用<a class="ae kh" href="https://stripe.com/docs/testing" rel="noopener ugc nofollow" target="_blank">的伪卡</a>T5(其余细节可以随意设置)。他的假卡号模拟了一次假的成功支付，这样你就可以测试整个流程。</li></ol><figure class="kr ks kt ku fd lu er es paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="er es ml"><img src="../Images/14ca24243140bd22b113dbcb32b1f95a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fAoDU9K9bwnRzXxJ29O8SQ.png"/></div></div></figure><h1 id="6347" class="ix iy hi bd iz ja jb jc jd je jf jg jh io ji ip jj ir jk is jl iu jm iv jn jo bi translated">了解更多信息</h1><div class="mm mn ez fb mo mp"><a href="https://stripe.com/docs/payments/accept-a-payment?platform=web&amp;ui=checkout" rel="noopener  ugc nofollow" target="_blank"><div class="mq ab dw"><div class="mr ab ms cl cj mt"><h2 class="bd hj fi z dy mu ea eb mv ed ef hh bi translated">接受付款</h2><div class="mw l"><h3 class="bd b fi z dy mu ea eb mv ed ef dx translated">向您的网站添加一个结帐按钮，该按钮调用服务器端端点来创建结帐会话。结帐…</h3></div><div class="mx l"><p class="bd b fp z dy mu ea eb mv ed ef dx translated">stripe.com</p></div></div><div class="my l"><div class="mz l na nb nc my nd mg mp"/></div></div></a></div><div class="mm mn ez fb mo mp"><a href="https://javalin.io/tutorials/jte" rel="noopener  ugc nofollow" target="_blank"><div class="mq ab dw"><div class="mr ab ms cl cj mt"><h2 class="bd hj fi z dy mu ea eb mv ed ef hh bi translated">在Javalin - Javalin -一个轻量级Java和Kotlin web框架中呈现jte模板。创建…</h2><div class="mw l"><h3 class="bd b fi z dy mu ea eb mv ed ef dx translated">jte是一个现代的、类型安全的模板引擎，它用尽可能少的额外语法将HTML和Java结合在一起。在这个…</h3></div><div class="mx l"><p class="bd b fp z dy mu ea eb mv ed ef dx translated">javalin.io</p></div></div><div class="my l"><div class="ne l na nb nc my nd mg mp"/></div></div></a></div></div></div>    
</body>
</html>