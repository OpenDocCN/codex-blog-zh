<html>
<head>
<title>Creating an ML Model and Serving it as a RESTful API: Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">创建ML模型并将其作为RESTful API:第1部分</h1>
<blockquote>原文：<a href="https://medium.com/codex/creating-an-ml-model-and-serving-it-as-a-restful-api-part-1-4c8f7ed5e6ba?source=collection_archive---------4-----------------------#2021-01-20">https://medium.com/codex/creating-an-ml-model-and-serving-it-as-a-restful-api-part-1-4c8f7ed5e6ba?source=collection_archive---------4-----------------------#2021-01-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="7634" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我开始在当地一家专注于数据科学和机器学习的公司实习，作为我培训的一部分，我的任务是创建一个简单的虹膜分类模型，根据给定的花瓣和萼片宽度和长度识别虹膜类别的类型(杂色、海滨和刚毛)。作为一个只有很少机器学习背景的人，我需要大量的研究和阅读，以达到所需的输出，但这一切都是值得的。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/a302088f179f08536053d6658afe530f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XzV2hXshY9kME-ojSrtw4Q.jpeg"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">图片来源:<a class="ae jt" href="https://pixabay.com/images/id-3199253/" rel="noopener ugc nofollow" target="_blank">https://pixabay.com/images/id-3199253/</a></figcaption></figure><p id="4dc4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这篇文章中，我将分享我使用Python创建虹膜分类模型并通过Flask RESTful API提供该模型的步骤。我还创建了一个连接到API的简单PHP接口来演示它的用法。</p><h1 id="2c87" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">模型创建🤖</h1><p id="5d7d" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">在机器学习中，使用一组数据来训练模型，以识别某些模式。Python的开源机器学习库<a class="ae jt" href="https://scikit-learn.org/stable/" rel="noopener ugc nofollow" target="_blank"> Sci-kit Learn </a>，为监督和非监督学习提供模型训练。它使用简单，并且有很多教程可以开始使用。</p><p id="1bd5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，使用pip安装Sci-Kit库:</p><pre class="je jf jg jh fd kx ky kz la aw lb bi"><span id="636b" class="lc jv hi ky b fi ld le l lf lg">pip install -U scikit-learn</span></pre></div><div class="ab cl lh li gp lj" role="separator"><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm"/></div><div class="hb hc hd he hf"><p id="49a0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">安装完成后，创建一个名为“model.py”的文件，其中可以使用Sci-Kit Learn已经制作的Iris数据集:</p><pre class="je jf jg jh fd kx ky kz la aw lb bi"><span id="f061" class="lc jv hi ky b fi ld le l lf lg">from sklearn import datasets<br/>iris = datasets.load_iris()</span></pre><p id="63bb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">*注意:您可以使用自己的数据集，但需要对其进行预处理和格式化，以便Sci-Kit Learn尽可能高效地理解和训练模型。</p><p id="0354" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，数据集被分成<strong class="ih hj">数据和目标</strong>。<strong class="ih hj">数据</strong>由花瓣和萼片的厘米宽度和长度组成，而<strong class="ih hj">目标</strong>或标签是要预测的类。对于虹膜分类，目标由杂色、海滨和刚毛组成。</p><pre class="je jf jg jh fd kx ky kz la aw lb bi"><span id="f050" class="lc jv hi ky b fi ld le l lf lg">iris_data = iris.data<br/>iris_target = iris.target</span></pre><p id="f742" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在训练模型之前，数据和目标被再次分割，以便另一半用于实际的模型训练，而另一半用于验证模型(换句话说，测试模型的准确性)。</p><p id="bf14" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这可以通过使用train_test_split来实现:</p><pre class="je jf jg jh fd kx ky kz la aw lb bi"><span id="e661" class="lc jv hi ky b fi ld le l lf lg">from sklearn.model_selection import train_test_split<br/>iris_data_train, iris_data_test, iris_target_train, iris_target_test = train_test_split(iris_data, iris_target, test_size = .5)</span></pre><p id="5c0c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">test_size参数指定测试数据集的大小。</p><p id="1da9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们可以开始构建模型了。有许多分类算法可以用于这个模型，但是我选择了K-最近邻，因为它的准确度要高得多。</p><pre class="je jf jg jh fd kx ky kz la aw lb bi"><span id="f2af" class="lc jv hi ky b fi ld le l lf lg">from sklearn import neighbors<br/>classifier = neighbors.KNeighborsClassifier()</span></pre><p id="8600" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">由此，我们可以开始训练模型:</p><pre class="je jf jg jh fd kx ky kz la aw lb bi"><span id="dd53" class="lc jv hi ky b fi ld le l lf lg">classifier.fit(iris_data_train, iris_target_train)</span></pre><p id="9a5c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们做到了！我们有一个经过训练的虹膜分类模型。我们可以使用accuracy_score打印模型的精度级别:</p><pre class="je jf jg jh fd kx ky kz la aw lb bi"><span id="f1d7" class="lc jv hi ky b fi ld le l lf lg">from sklearn.metrics import accuracy_score<br/>predict_iris = classifier.predict(iris_data_test)<br/>print(accuracy_score(iris_target_test, predict_iris))<br/>From the above, the model has an accuracy score of 97%! Great!</span></pre><h1 id="0797" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">创建烧瓶API ⚙️</h1><p id="01c9" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">在我们创建Flask API之前，需要使用名为<a class="ae jt" href="https://docs.python.org/3/library/pickle.html#:~:text=%E2%80%9CPickling%E2%80%9D%20is%20the%20process%20whereby,back%20into%20an%20object%20hierarchy." rel="noopener ugc nofollow" target="_blank"> Pickle </a>的Python库对模型进行序列化。通过“酸洗”python代码，它被转换成字节流，以便于通过网络发送或保存在磁盘上。“拆包”则相反，它将python文件转换成其原始状态。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lo"><img src="../Images/cf208296d1701bb88e2b1a97dfc358c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G0sAisx6k2KWj4xoxRXXdA.jpeg"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">图片来源:【https://pixabay.com/images/id-1520638/ T2】</figcaption></figure><p id="8ae8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Pickle可以使用pip安装:</p><pre class="je jf jg jh fd kx ky kz la aw lb bi"><span id="b2b9" class="lc jv hi ky b fi ld le l lf lg">pip install pickle-mixin</span></pre><p id="c50b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们的虹膜分类模型可以使用以下代码进行“腌制”或序列化:</p><pre class="je jf jg jh fd kx ky kz la aw lb bi"><span id="bd22" class="lc jv hi ky b fi ld le l lf lg">import pickle<br/>pickle.dump(classifier, open(“iris_model”, “wb”))</span></pre><p id="5d05" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这将创建iris_model文件。如果你试图打开它，它会显示难以辨认的字符。</p><p id="c638" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">既然我们已经腌泡了我们的模型，我们现在可以开始与Flask API！</p><p id="2d82" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">像其他Python库一样，我们也安装了flask:</p><pre class="je jf jg jh fd kx ky kz la aw lb bi"><span id="9116" class="lc jv hi ky b fi ld le l lf lg">pip install flask</span></pre><p id="84cb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，我们创建名为“app.py”的主应用程序文件。在该文件中，我们导入Flask API所需的库:</p><pre class="je jf jg jh fd kx ky kz la aw lb bi"><span id="7214" class="lc jv hi ky b fi ld le l lf lg">from flask import Flask, jsonify<br/>from flask_restful import reqparse, abort, Api, Resource</span><span id="d640" class="lc jv hi ky b fi lp le l lf lg">app = Flask(__name__)<br/>api = Api(app)</span></pre><p id="4511" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，我们的虹膜分类模型被加载和“解钩”:</p><pre class="je jf jg jh fd kx ky kz la aw lb bi"><span id="fe67" class="lc jv hi ky b fi ld le l lf lg">import pickle<br/>loaded_model = pickle.load(open(“iris_model”, ‘rb’))</span></pre><p id="82df" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当我们稍后创建前端接口时，我们需要一种方法将用户输入发送到Iris分类Flask API。为此，我们为URL创建参数，并将用户输入传递到那里。我们需要的输入是花瓣和萼片的宽度和长度，从这些信息中，模型可以预测我们所指的鸢尾花的类型。</p><p id="aa41" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们使用以下代码创建参数:</p><pre class="je jf jg jh fd kx ky kz la aw lb bi"><span id="b4d8" class="lc jv hi ky b fi ld le l lf lg">parser = reqparse.RequestParser()<br/>parser.add_argument(‘slength’)<br/>parser.add_argument(‘swidth’)<br/>parser.add_argument(‘plength’)<br/>parser.add_argument(‘pwidth’)</span></pre><p id="4311" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦设置了查询，我们需要调用模型来根据给定的输入预测虹膜类型。然后，我们创建一个名为“requestIris”的类，它接受URL参数值，然后将其插入到模型中进行预测。预测将采用整数格式，因此0表示setosa，1表示versicolor，2表示virginica。另外，注意返回的数据应该是JSON格式的。</p><p id="52e7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">完整的代码如下所示:</p><pre class="je jf jg jh fd kx ky kz la aw lb bi"><span id="715e" class="lc jv hi ky b fi ld le l lf lg">class requestIris(Resource):<br/>   def get(self):<br/>   args = parser.parse_args()<br/>   slength= args[‘slength’]<br/>   swidth = args[“swidth”]<br/>   plength = args[“plength”]<br/>   pwidth = args[“pwidth”]<br/>   prediction = (loaded_model.predict([[slength, swidth, plength, pwidth]])).tolist()<br/>   if(prediction[0] == 0):<br/>      type=”setosa”<br/>   elif(prediction[0] == 1):<br/>      type=”versicolor”<br/>   else:<br/>      type=”virginica”<br/>   serve_model = {“Iris Type”:type}<br/>   print(serve_model)<br/>   return jsonify(serve_model)</span></pre><p id="90ed" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，我们将资源添加到我们的API，并为资源创建一个路由:</p><pre class="je jf jg jh fd kx ky kz la aw lb bi"><span id="57df" class="lc jv hi ky b fi ld le l lf lg">api.add_resource(requestIris, ‘/classify’)</span></pre><p id="58ca" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后但同样重要的是，我们添加代码来运行我们的Flask应用程序:</p><pre class="je jf jg jh fd kx ky kz la aw lb bi"><span id="6fbe" class="lc jv hi ky b fi ld le l lf lg">if __name__ == ‘__main__’:<br/> app.run()</span></pre><p id="45fb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">万岁！我们现在有了我们的虹膜分类API！</p><p id="dc7a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">API可以在本地运行，也可以发布到Heroku。我在这里发表了我的:</p><p id="a6fb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">【https://iris-classification-model.herokuapp.com/ T4】</p><p id="444a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在下一篇文章中，我将写PHP前端接口来演示API的应用。敬请期待！</p></div><div class="ab cl lh li gp lj" role="separator"><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm"/></div><div class="hb hc hd he hf"><p id="f125" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">嘿，你好！如果你喜欢读我的文章，并且想请我喝杯茶🍵，<em class="lq">我将非常感谢您在</em><a class="ae jt" href="https://www.buymeacoffee.com/andreagon" rel="noopener ugc nofollow" target="_blank">https://www.buymeacoffee.com/andreagon</a>的支持</p><p id="41de" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">祝你今天过得愉快！</p></div></div>    
</body>
</html>