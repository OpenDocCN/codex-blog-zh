<html>
<head>
<title>💪Publish Azure Static Web Apps using a Bicep template</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">💪使用Bicep模板发布Azure静态Web应用</h1>
<blockquote>原文：<a href="https://medium.com/codex/publish-azure-static-web-apps-using-a-bicep-template-ca315a825b74?source=collection_archive---------1-----------------------#2021-10-26">https://medium.com/codex/publish-azure-static-web-apps-using-a-bicep-template-ca315a825b74?source=collection_archive---------1-----------------------#2021-10-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="ff85" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">了解如何使用Bicep部署Azure静态Web应用。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/506c553df2278dea8343fa1764f0b089.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rz1tue9v4M6qqpskGbBRdA.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">使用Bicep模板发布Azure静态Web应用</figcaption></figure></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><p id="a4e3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">本文将回顾如何利用Bicep这种新的领域特定语言(DSL)来创建Azure静态Web App实例。</p><h1 id="a427" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">先决条件</h1><ul class=""><li id="4d6e" class="ky kz hi ih b ii la im lb iq lc iu ld iy le jc lf lg lh li bi translated">一个活跃的Azure账户:你可以<a class="ae lj" href="https://azure.microsoft.com/free/" rel="noopener ugc nofollow" target="_blank">免费</a>创建一个账户。</li><li id="fcd7" class="ky kz hi ih b ii lk im ll iq lm iu ln iy lo jc lf lg lh li bi translated">GitHub账号:你可以<a class="ae lj" href="https://github.com/" rel="noopener ugc nofollow" target="_blank">免费创建一个GitHub账号</a></li><li id="91c5" class="ky kz hi ih b ii lk im ll iq lm iu ln iy lo jc lf lg lh li bi translated"><a class="ae lj" href="https://github.com/azure/bicep" rel="noopener ugc nofollow" target="_blank"> Azure二头肌</a>安装在你的本地机器上。</li><li id="9641" class="ky kz hi ih b ii lk im ll iq lm iu ln iy lo jc lf lg lh li bi translated">Azure PowerShell。参见:<a class="ae lj" href="https://docs.microsoft.com/en-us/powershell/azure/install-az-ps" rel="noopener ugc nofollow" target="_blank">安装Azure PowerShell </a>。</li></ul><p id="e59f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将执行以下步骤:</p><p id="ccc6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">1.创建GitHub个人访问令牌</p><p id="bae6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.创建GitHub repo</p><p id="4642" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3.创建二头肌模板</p><p id="c0a3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4.创建参数文件</p><p id="43a2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">5.运行部署</p><p id="d6c9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们开始吧！</p><h1 id="7e6d" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">1.创建GitHub个人访问令牌</h1><p id="9fcf" class="pw-post-body-paragraph if ig hi ih b ii la ik il im lb io ip iq lp is it iu lq iw ix iy lr ja jb jc hb bi translated">我们将利用一个名为'<em class="ls"> repositoryToken </em>的参数，它允许部署流程与保存静态站点源代码的GitHub repo进行交互。</p><p id="67b6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在你的GitHub账户资料中(右上角)，选择<em class="ls">设置</em>。然后转到'<em class="ls">开发者设置</em>，选择'<em class="ls">个人访问令牌</em>。'</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lt"><img src="../Images/c9bd002128861efbbeabd1b391f55efd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZYC0h56xpchQxvDvlt7s6w.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">GitHub访问令牌</figcaption></figure><p id="5723" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在生成一个新令牌。您可以在“注释”字段中为此令牌提供一个名称。在这种情况下，我们将把它命名为'<em class="ls"> Bicep-Static-Webapp </em>'。</p><p id="5974" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">指定以下范围:'<em class="ls"> repo '，' workflow '，' write: packages' </em>。然后选择选项'<em class="ls">生成令牌</em>，如下图所示:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lu"><img src="../Images/03c6edab1659dafe75954ca108d539fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N0junUahQKk9SBkXyBCJaA.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">生成令牌</figcaption></figure><p id="3237" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请务必复制这个令牌，并将其存储在安全的地方。</p><p id="900a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在让我们创建一个新的GitHub存储库。</p><h1 id="b289" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">2.创建GitHub repo</h1><p id="52b8" class="pw-post-body-paragraph if ig hi ih b ii la ik il im lb io ip iq lp is it iu lq iw ix iy lr ja jb jc hb bi translated">导航到以下位置创建新的存储库:</p><p id="8eeb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae lj" href="https://github.com/login?return_to=/staticwebdev/vanilla-basic/generate" rel="noopener ugc nofollow" target="_blank">https://github.com/staticwebdev/vanilla-basic/generate</a></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lv"><img src="../Images/8894cefd5097b54e19e1a1ef637eff66.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7lEXHVybf0IR0iyrkWsM5w.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">创建GitHub repo</figcaption></figure><p id="f89b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，您应该会看到新的GitHub repo，如下所示:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lw"><img src="../Images/6a1d6e43ac81626ac2b7e5cba6c1873f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rrX2gLP48q-q-wN68Txfbg.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">GitHub回购</figcaption></figure><p id="133e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下一步是创建二头肌模板。</p><h1 id="ab2b" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">3.创建二头肌模板</h1><p id="d151" class="pw-post-body-paragraph if ig hi ih b ii la ik il im lb io ip iq lp is it iu lq iw ix iy lr ja jb jc hb bi translated">创建一个新文件夹来存储Bicep模板，并创建一个名为“main.bicep”的新文件。</p><p id="1f15" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们将定义参数。</p><h2 id="9b9a" class="lx kb hi bd kc ly lz ma kg mb mc md kk iq me mf ko iu mg mh ks iy mi mj kw mk bi translated">二头肌模板-参数</h2><p id="2e43" class="pw-post-body-paragraph if ig hi ih b ii la ik il im lb io ip iq lp is it iu lq iw ix iy lr ja jb jc hb bi translated">下面的代码显示了参数的定义:</p><pre class="je jf jg jh fd ml mm mn mo aw mp bi"><span id="b228" class="lx kb hi mm b fi mq mr l ms mt">param name string<br/>param location string = resourceGroup().location<br/>param sku string<br/>param skucode string<br/>param repositoryUrl string<br/>param branch string</span><span id="4982" class="lx kb hi mm b fi mu mr l ms mt"><a class="ae lj" href="http://twitter.com/secure" rel="noopener ugc nofollow" target="_blank">@secure</a>()<br/>param repositoryToken string<br/>param appLocation string<br/>param apiLocation string<br/>param appArtifactLocation string<br/>param resourceTags object<br/>param appSettings object</span></pre><p id="4d91" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意我们对repositoryToken使用了一个secure()装饰器。</p><p id="b2df" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，我们将定义资源。</p><h2 id="9b46" class="lx kb hi bd kc ly lz ma kg mb mc md kk iq me mf ko iu mg mh ks iy mi mj kw mk bi translated">Bicep模板—资源</h2><p id="9730" class="pw-post-body-paragraph if ig hi ih b ii la ik il im lb io ip iq lp is it iu lq iw ix iy lr ja jb jc hb bi translated">我们将定义两个资源:静态网站和配置。</p><p id="f0b1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面的代码显示了这些资源的定义:</p><pre class="je jf jg jh fd ml mm mn mo aw mp bi"><span id="39d2" class="lx kb hi mm b fi mq mr l ms mt">resource name_resource 'Microsoft.Web/staticSites@2021-01-15' = {<br/>  name: name<br/>  location: location<br/>  tags: resourceTags<br/>  properties: {<br/>    repositoryUrl: repositoryUrl<br/>    branch: branch<br/>    repositoryToken: repositoryToken<br/>    buildProperties: {<br/>      appLocation: appLocation<br/>      apiLocation: apiLocation<br/>      appArtifactLocation: appArtifactLocation<br/>    }<br/>  }<br/>  sku: {<br/>    tier: sku<br/>    name: skucode<br/>  }<br/>}</span><span id="c879" class="lx kb hi mm b fi mu mr l ms mt">resource name_appsettings 'Microsoft.Web/staticSites/config@2021-01-15' = {<br/>  parent: name_resource<br/>  name: 'appsettings'<br/>  properties: appSettings<br/>}</span></pre><p id="d577" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们将创建一个参数文件来传递所有的参数值。</p><h2 id="2d5b" class="lx kb hi bd kc ly lz ma kg mb mc md kk iq me mf ko iu mg mh ks iy mi mj kw mk bi translated">参数文件。</h2><p id="0761" class="pw-post-body-paragraph if ig hi ih b ii la ik il im lb io ip iq lp is it iu lq iw ix iy lr ja jb jc hb bi translated">创建一个名为“azuredeploy.parameters.json”的新文件。</p><p id="2ef6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面的代码显示了参数文件的定义。</p><pre class="je jf jg jh fd ml mm mn mo aw mp bi"><span id="2de6" class="lx kb hi mm b fi mq mr l ms mt">{<br/>    "$schema": "<a class="ae lj" href="https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#" rel="noopener ugc nofollow" target="_blank">https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#</a>",<br/>    "contentVersion": "1.0.0.0",<br/>    "parameters": {<br/>        "name": {<br/>            "value": "myfirstswadeployment"<br/>        },<br/>        "location": { <br/>            "value": "Central US"<br/>        },   <br/>        "sku": {<br/>            "value": "Free"<br/>        },<br/>        "skucode": {<br/>            "value": "Free"<br/>        },<br/>        "repositoryUrl": {<br/>            "value": "<a class="ae lj" href="https://github.com/" rel="noopener ugc nofollow" target="_blank">https://github.com/</a>&lt;YOUR-GITHUB-USER-NAME&gt;/&lt;YOUR-GITHUB-REPOSITORY-NAME&gt;"<br/>        },<br/>        "branch": {<br/>            "value": "main"<br/>        },<br/>        "repositoryToken": {<br/>            "value": "&lt;YOUR-GITHUB-PAT&gt;" <br/>        },<br/>        "appLocation": {<br/>            "value": "/"<br/>        },<br/>        "apiLocation": {<br/>            "value": ""<br/>        },<br/>        "appArtifactLocation": {<br/>            "value": "src"<br/>        },<br/>        "resourceTags": {<br/>            "value": {<br/>                "Environment": "Development",<br/>                "Project": "Testing SWA with Bicep",<br/>                "ApplicationName": "myfirstswadeployment"<br/>            }<br/>        },<br/>        "appSettings": {<br/>            "value": {<br/>                "MY_APP_SETTING1": "value 1",<br/>                "MY_APP_SETTING2": "value 2"<br/>            }<br/>        }<br/>    }<br/>}</span></pre><p id="0066" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">根据您的设置，更新参数'<em class="ls"> name </em>'、<em class="ls">repository rl</em>和'<em class="ls"> repositoryToken </em>'。</p><p id="079a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，我们将部署这个二头肌模板。</p><h1 id="efbc" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">5.运行部署</h1><p id="dbfa" class="pw-post-body-paragraph if ig hi ih b ii la ik il im lb io ip iq lp is it iu lq iw ix iy lr ja jb jc hb bi translated">确保您事先创建了资源组。</p><p id="a86a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以使用以下命令使用Azure PowerShell登录到您的Azure订阅:</p><pre class="je jf jg jh fd ml mm mn mo aw mp bi"><span id="114e" class="lx kb hi mm b fi mq mr l ms mt">Connect-AzAccount -Tenant 'YOUR-TENANT-ID' -SubscriptionId 'YOUR-SUBSCRIPTION-ID'</span></pre><p id="026c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将使用下面的命令来部署该模板:</p><pre class="je jf jg jh fd ml mm mn mo aw mp bi"><span id="2dba" class="lx kb hi mm b fi mq mr l ms mt">$date = Get-Date -Format "MM-dd-yyyy"<br/>$deploymentName = "AzInsiderDeployment"+"$date"</span><span id="594f" class="lx kb hi mm b fi mu mr l ms mt">New-AzResourceGroupDeployment -Name $deploymentName -ResourceGroupName azinsider-static-webapp -TemplateFile .\main.bicep -TemplateParameterFile .\azuredeploy.parameters.json -c</span></pre><p id="40ef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因为我们使用了-C标志，所以我们将能够预览部署，如下所示:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mv"><img src="../Images/6a7ee069b8a922f0bc3ef5ef2ee8c351.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E3sYkwZ4r0ocLhYz5s0Udw.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">部署预览</figcaption></figure><p id="8e51" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">验证完成后，让我们执行部署。几秒钟后，您应该会看到如下所示的部署输出:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mw"><img src="../Images/f135d92f1cb69c324a54149d60d8c3bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qLMLgEixRudQgtDWqSvSog.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">静态Web应用程序—部署输出</figcaption></figure><p id="1d7f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可以去Azure门户寻找静态web应用，然后浏览到静态web应用的URL:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mx"><img src="../Images/6c78645bf37271a636099ab72d8cf3f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n0ENPI_Qys4NEMOBWAmPaQ.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">Azure Porta —静态web应用程序</figcaption></figure><p id="d5cb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以看到静态web应用程序的初始屏幕，如下所示:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es my"><img src="../Images/6a23d6871d12042a0a4c287e0f624b6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VGDxCI-Sij3wxv1vlHBt1g.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">使用Bicep模板发布Azure静态Web应用</figcaption></figure><h1 id="ee5f" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">源代码—使用Bicep模板发布Azure静态Web应用。</h1><p id="70b0" class="pw-post-body-paragraph if ig hi ih b ii la ik il im lb io ip iq lp is it iu lq iw ix iy lr ja jb jc hb bi translated">您可以在以下URL中找到所有代码:</p><div class="mz na ez fb nb nc"><a href="https://github.com/daveRendon/azinsider/tree/main/application-workloads/static-webapp" rel="noopener  ugc nofollow" target="_blank"><div class="nd ab dw"><div class="ne ab nf cl cj ng"><h2 class="bd hj fi z dy nh ea eb ni ed ef hh bi translated">主daveRendon/azinsider上的azin sider/应用程序工作负载/静态webapp</h2><div class="nj l"><h3 class="bd b fi z dy nh ea eb ni ed ef dx translated">在GitHub上创建一个帐户，为daveRendon/azinsider开发做出贡献。</h3></div><div class="nk l"><p class="bd b fp z dy nh ea eb ni ed ef dx translated">github.com</p></div></div><div class="nl l"><div class="nm l nn no np nl nq jn nc"/></div></div></a></div><p id="e975" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">希望这能让您更好地理解Bicep的基础设施即代码功能。</p><p id="8f32" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">👉<a class="ae lj" href="http://eepurl.com/gKmLdf" rel="noopener ugc nofollow" target="_blank"> <em class="ls">在此加入</em><strong class="ih hj"><em class="ls">azin sider</em></strong><em class="ls">邮箱列表。</em>T15】</a></p><p id="a878" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="ls">-戴夫·r</em></p></div></div>    
</body>
</html>