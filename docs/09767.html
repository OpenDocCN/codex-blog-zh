<html>
<head>
<title>volatile keyword in Java</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Java中的volatile关键字</h1>
<blockquote>原文：<a href="https://medium.com/codex/volatile-keyword-in-java-9e8792b4e6ba?source=collection_archive---------6-----------------------#2022-11-08">https://medium.com/codex/volatile-keyword-in-java-9e8792b4e6ba?source=collection_archive---------6-----------------------#2022-11-08</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="649d" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">为什么、何时以及如何使用它</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/5a99574ed7b95acce5448435b2a4890d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iSSbjpLQkYh080qDGYvxUQ.png"/></div></div></figure><p id="9963" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">修饰符是Java中的特定关键字，我们可以使用它们来改变变量、方法或类的特征，并限制其范围。Java编程语言有丰富的修饰语。</p><p id="17ea" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">Java中的修饰语分为两种<strong class="jl hj"> — </strong> <a class="ae kf" href="https://www.geeksforgeeks.org/access-modifiers-java/?ref=lbp" rel="noopener ugc nofollow" target="_blank"> <strong class="jl hj">访问修饰语</strong> </a>和<strong class="jl hj">非访问修饰语</strong>。</p><h1 id="01f1" class="kg kh hi bd ki kj kk kl km kn ko kp kq io kr ip ks ir kt is ku iu kv iv kw kx bi translated">非访问修饰符</h1><p id="41b4" class="pw-post-body-paragraph jj jk hi jl b jm ky ij jo jp kz im jr js la ju jv jw lb jy jz ka lc kc kd ke hb bi translated">非访问修饰符向JVM提供关于类、方法或变量的特征的信息。Java中有七种类型的非访问修饰符。他们是</p><ol class=""><li id="9c08" class="ld le hi jl b jm jn jp jq js lf jw lg ka lh ke li lj lk ll bi translated"><strong class="jl hj">决赛</strong></li><li id="8ad1" class="ld le hi jl b jm lm jp ln js lo jw lp ka lq ke li lj lk ll bi translated"><strong class="jl hj">静态</strong></li><li id="a1d5" class="ld le hi jl b jm lm jp ln js lo jw lp ka lq ke li lj lk ll bi translated"><strong class="jl hj">摘要</strong></li><li id="4e55" class="ld le hi jl b jm lm jp ln js lo jw lp ka lq ke li lj lk ll bi translated"><strong class="jl hj">同步</strong></li><li id="9d57" class="ld le hi jl b jm lm jp ln js lo jw lp ka lq ke li lj lk ll bi translated"><strong class="jl hj">易变</strong></li><li id="ab20" class="ld le hi jl b jm lm jp ln js lo jw lp ka lq ke li lj lk ll bi translated"><strong class="jl hj">瞬发</strong></li><li id="b1ff" class="ld le hi jl b jm lm jp ln js lo jw lp ka lq ke li lj lk ll bi translated"><strong class="jl hj">原生</strong></li></ol><p id="fe79" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">本文将深入讨论<strong class="jl hj"> volatile </strong>关键字的细节。我们先来探讨一下，我们为什么要用它，如果决定要用的话应该什么时候用，最后也是最重要的，怎么用。</p><h2 id="b54a" class="lr kh hi bd ki ls lt lu km lv lw lx kq js ly lz ks jw ma mb ku ka mc md kw me bi translated">为什么:</h2><p id="84d4" class="pw-post-body-paragraph jj jk hi jl b jm ky ij jo jp kz im jr js la ju jv jw lb jy jz ka lc kc kd ke hb bi translated">Java中的volatile关键字用于将一个Java变量标记为“存储在主存中”。</p><p id="b409" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">每个访问volatile变量的线程都将从主内存中读取它，而不是从CPU缓存中读取。这样，所有线程看到的volatile变量的值都是相同的。</p><p id="63f5" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">volatile关键字可以用于任何类型的变量，包括基本类型和对象引用。当与对象一起使用时，所有线程都将看到对象中所有字段的最新值。</p><p id="6233" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">volatile关键字通常与指示线程需要停止运行的标志一起使用。例如，一个线程可能有一个名为“done”的布尔标志，当另一个线程将该标志设置为“true”时，第一个线程将知道停止运行。如果没有volatile关键字，第一个线程可能会无限期地运行，因为它永远不会看到“done”标志的更新值。</p><p id="c8c2" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">volatile关键字还有其他用法，但这是最常见的用法之一。一般来说，如果您需要确保所有线程都看到某个变量的相同值，那么您应该将该变量标记为volatile。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mf"><img src="../Images/623485c01fb734040ace8fbf4b1cc9d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1004/format:webp/1*sV1FdqGl-ND8CAwSH4RODg.png"/></div></figure><h2 id="0982" class="lr kh hi bd ki ls lt lu km lv lw lx kq js ly lz ks jw ma mb ku ka mc md kw me bi translated">时间和方式:</h2><h2 id="62e2" class="lr kh hi bd ki ls lt lu km lv lw lx kq js ly lz ks jw ma mb ku ka mc md kw me bi translated">1.易变场</h2><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mg mh l"/></div></figure><p id="a76b" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">在上面的例子中，我们在第一个请求到来时创建实例。</p><p id="3824" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">如果我们不把<code class="du mi mj mk ml b">_instance</code>变成变量<code class="du mi mj mk ml b">volatile</code>，那么创建<code class="du mi mj mk ml b">Singleton</code>实例的线程就不能与另一个线程通信。因此，如果线程A正在创建单例实例，并且在创建之后，CPU损坏了等等，所有其他线程将不能看到<code class="du mi mj mk ml b">_instance</code>的值不为空，并且它们将认为它仍然被赋值为空。</p><p id="97cb" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">为什么会这样？因为读线程不做任何锁定，直到写线程从同步块中出来，内存将不会同步，<code class="du mi mj mk ml b">_instance</code>的值也不会在主内存中更新。对于Java中的Volatile关键字，这是由Java本身处理的，所有的阅读器线程都可以看到这样的更新。</p></div><div class="ab cl mm mn gp mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="hb hc hd he hf"><p id="eb80" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">最清楚为什么、如何以及何时使用<strong class="jl hj"> volatile </strong>以及其他修饰语，来自于经验，而经验来自于时间。</p><p id="bfc8" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">享受旅程，快乐编码！</p><blockquote class="mt"><p id="6b7a" class="mu mv hi bd mw mx my mz na nb nc ke dx translated">亲爱的读者，感谢您的宝贵时间！</p></blockquote><blockquote class="ne nf ng"><p id="8be1" class="jj jk nh jl b jm ni ij jo jp nj im jr nk nl ju jv nm nn jy jz no np kc kd ke hb bi translated"><em class="hi">我的一些文章:</em></p></blockquote><p id="2a15" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated"><a class="ae kf" rel="noopener" href="/@alexthedev/10-best-practices-in-java-dc0b06dda858">Java中的10个最佳实践</a><br/><a class="ae kf" rel="noopener" href="/@alexthedev/hashing-in-java-f0436cd4284b">Java中的哈希</a><br/><a class="ae kf" rel="noopener" href="/@alexthedev/final-keyword-in-java-dd0281080643">Java中的最终关键词</a> <br/> <a class="ae kf" rel="noopener" href="/@alexthedev/the-struggle-of-getting-my-first-job-as-a-software-developer-d48a198f57f4">我的第一份软件开发工作的奋斗</a><br/><a class="ae kf" rel="noopener" href="/@alexthedev/will-java-still-be-worth-in-2023-849921b21080">2023年的Java还值吗？☕</a><br/><a class="ae kf" rel="noopener" href="/@alexthedev/the-blub-paradox-d43c5cb9e3e0">the blub paradox</a><br/><a class="ae kf" rel="noopener" href="/@alexthedev/things-i-wish-i-knew-as-a-beginner-programmer-96b9cbe264de">作为一个初学程序员我希望知道的事情</a> <br/> <a class="ae kf" rel="noopener" href="/@alexthedev/spring-boot-the-good-and-the-bad-20be1b409f2">春训:好与坏</a> <br/> <a class="ae kf" rel="noopener" href="/@alexthedev/why-do-we-love-coding-43d0b3cfe0b">我们为什么热爱编码？💻</a> <br/> <a class="ae kf" rel="noopener" href="/@alexthedev/stay-motivated-e6102f86c4b3">保持积极性</a> <br/> <a class="ae kf" rel="noopener" href="/@alexthedev/ai-is-bullshit-fa21e28898d0">艾是扯淡</a> <br/> <a class="ae kf" rel="noopener" href="/@alexthedev/100-followers-done-whats-next-d3c054c2d544"> 100追随者搞定。下一步是什么？</a> <br/> <a class="ae kf" rel="noopener" href="/@alexthedev/is-work-from-home-going-to-end-7f0bd202a329">在家工作就要结束了吗？</a></p></div></div>    
</body>
</html>