<html>
<head>
<title>How to Scrape HTML Tables in JavaScript [Export Table Data to a CSV]</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在JavaScript中抓取HTML表格[将表格数据导出为CSV]</h1>
<blockquote>原文：<a href="https://medium.com/codex/how-to-scrape-html-tables-in-javascript-export-table-data-to-a-csv-acd01c6ddce?source=collection_archive---------1-----------------------#2022-07-15">https://medium.com/codex/how-to-scrape-html-tables-in-javascript-export-table-data-to-a-csv-acd01c6ddce?source=collection_archive---------1-----------------------#2022-07-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/08035ab50d3233afcbcf842df0618719.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*-Rnn-VqH6f8G9Z36.jpg"/></div></div></figure><p id="50eb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最初发表于<a class="ae jo" href="https://www.scraperapi.com/blog/scrape-html-table-to-csv/" rel="noopener ugc nofollow" target="_blank"> ScraperAPI </a>。</p><p id="f9db" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">HTML表格是网络上最好的数据源。它们易于理解，并能以简单易读和易懂的格式保存大量数据。对于任何对数据科学或数据分析感兴趣的开发人员来说，能够抓取HTML表格是一项需要开发的关键技能。</p><p id="886c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在本教程中，我们将深入研究HTML表格，并构建一个简单而强大的脚本来提取表格数据并将其导出到CSV文件中。</p><h1 id="71aa" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">什么是HTML网页表格？</h1><p id="0571" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">HTML表格是一组行和列，用于直接在网页上以网格格式显示信息。它们通常用于显示表格数据，如电子表格或数据库，并且是我们项目的重要数据源。</p><p id="926a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">从体育数据到天气数据，再到书籍和作者的数据，网络上大多数大型数据集都可以通过HTML表格访问，因为它们能够以结构化且易于导航的格式显示信息。</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ks"><img src="../Images/5cee92aa986000544b39e7070c405330.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Gsg3qNEUATRUjG24.png"/></div></div></figure><p id="d649" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对我们来说，好消息是，与动态生成的内容不同，HTML表格的数据直接存在于HTML文件的table元素中，这意味着我们可以像处理web的其他元素一样抓取我们需要的所有信息——只要我们理解它们的结构。</p><h1 id="1546" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">理解HTML表格的结构</h1><p id="1c25" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">虽然您只能在前端看到列和行，但是这些表实际上是使用一些不同的HTML标记创建的:</p><ul class=""><li id="80ea" class="kx ky hi is b it iu ix iy jb kz jf la jj lb jn lc ld le lf bi translated">:它标志着HTML表格的开始</li><li id="f69f" class="kx ky hi is b it lg ix lh jb li jf lj jj lk jn lc ld le lf bi translated">:表示表格中的一行</li><li id="a211" class="kx ky hi is b it lg ix lh jb li jf lj jj lk jn lc ld le lf bi translated"><code class="du ll lm ln lo b">&lt;td&gt;</code>:定义表格中的单元格</li></ul><p id="75d2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">内容放在<code class="du ll lm ln lo b">&lt;td&gt;</code>标签中，<code class="du ll lm ln lo b">&lt;tr&gt;</code>用于创建一行。换句话说:<em class="lp">表格&gt;行&gt;单元格</em> || <em class="lp">表格&gt; tr &gt; td </em>层次结构被遵循来创建一个HTML表格。</p><p id="27aa" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">可以使用表示<em class="lp">表头</em>的<code class="du ll lm ln lo b">&lt;th&gt;</code>标签创建一个特殊的单元格。基本上，可以使用<code class="du ll lm ln lo b">&lt;th&gt;</code>标签创建第一行的第一个单元格，以指示该行是表格的标题。</p><p id="5ef2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下面是一个创建简单的两行两列HTML表格的示例:</p><figure class="kt ku kv kw fd ij"><div class="bz dy l di"><div class="lq lr l"/></div></figure><p id="3b4a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">但是在抓取HTML表格时有一个主要的区别。与网页上的其他元素不同，CSS选择器的目标是所有的单元格和行——甚至是整个表格——因为所有这些元素实际上都是<code class="du ll lm ln lo b">&lt;table&gt;</code>元素的组件。</p><p id="8cf2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们不需要为每个数据点指定一个CSS选择器，而是需要创建一个包含表中所有行的列表，并遍历这些行以从它们的单元格中获取数据。</p><p id="e3ff" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果我们理解这个逻辑，创建我们的脚本实际上是非常简单的。</p><h1 id="efd7" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">用节点将HTML表抓取到CSV。射流研究…</h1><p id="4188" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">如果这是你第一次使用Node。JS对于网络抓取，浏览一下我们之前的教程可能会有帮助:</p><ul class=""><li id="a8d9" class="kx ky hi is b it iu ix iy jb kz jf la jj lb jn lc ld le lf bi translated"><a class="ae jo" href="https://www.scraperapi.com/blog/web-scraping-javascript-tutorial/" rel="noopener ugc nofollow" target="_blank">使用JavaScript和Node.js进行网页抓取</a></li><li id="a59d" class="kx ky hi is b it lg ix lh jb li jf lj jj lk jn lc ld le lf bi translated"><a class="ae jo" href="https://www.scraperapi.com/uncategorized/how-to-build-a-linkedin-scraper/" rel="noopener ugc nofollow" target="_blank">如何免费搭建LinkedIn刮刀</a></li><li id="5e3c" class="kx ky hi is b it lg ix lh jb li jf lj jj lk jn lc ld le lf bi translated"><a class="ae jo" href="https://www.scraperapi.com/blog/how-to-scrape-football-data/" rel="noopener ugc nofollow" target="_blank">如何一步一步打造足球数据刮刀</a></li></ul><p id="7df2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然而，我们会尽可能让这个教程对初学者友好，这样你甚至可以把它作为一个起点。</p><p id="ada1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">注:</strong>为节点。JS安装说明，请参考列表上的第一条。</p><p id="bfc5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对于今天的项目，我们将使用<a class="ae jo" href="https://www.npmjs.com/package/axios" rel="noopener ugc nofollow" target="_blank"> Axios </a>和<a class="ae jo" href="https://cheerio.js.org/" rel="noopener ugc nofollow" target="_blank"> Cheerio </a>构建一个web scraper来抓取<a class="ae jo" href="https://datatables.net/examples/styling/display.html" rel="noopener ugc nofollow" target="_blank">https://datatables.net/examples/styling/display.html</a>上显示的员工数据。</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ks"><img src="../Images/67952fb293d3aaa4a0fd3f220ea8d183.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*JUwxIzNx_gMEWwcW.jpg"/></div></div></figure><p id="2220" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将提取每个雇员的姓名、职位、办公室、年龄、开始日期和工资，然后使用<a class="ae jo" href="https://www.npmjs.com/package/objects-to-csv" rel="noopener ugc nofollow" target="_blank"> ObjectsToCsv </a>包将数据发送到CSV。</p><h1 id="3190" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">1.准备好我们的文件</h1><p id="e555" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">为了启动我们的项目，让我们创建一个名为<em class="lp"> html-table-scraper </em>的新目录，在VScode(或者您偏好的代码编辑器)上打开新文件夹，并打开一个新终端。</p><p id="3b58" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在终端中，我们将运行<code class="du ll lm ln lo b">npm init -y</code>来启动一个新节点。JS项目。现在，您的文件夹中会有一个新的JSON文件。</p><p id="7d72" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">接下来，我们将使用以下命令安装依赖项:</p><ul class=""><li id="0c6f" class="kx ky hi is b it iu ix iy jb kz jf la jj lb jn lc ld le lf bi translated">阿希奥斯:<code class="du ll lm ln lo b">npm install axios</code></li><li id="43fd" class="kx ky hi is b it lg ix lh jb li jf lj jj lk jn lc ld le lf bi translated">再见:<code class="du ll lm ln lo b">npm install cheerio</code></li><li id="b555" class="kx ky hi is b it lg ix lh jb li jf lj jj lk jn lc ld le lf bi translated">ObjectsToCsv: <code class="du ll lm ln lo b">npm install objects-to-csv</code></li></ul><p id="efb8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们的一个命令安装:<code class="du ll lm ln lo b">npm i axios cheerio objects-to-csv</code>。</p><p id="824b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们可以创建一个名为<em class="lp"> tablescraper.js </em>的新文件，并在顶部导入我们的依赖项。</p><figure class="kt ku kv kw fd ij"><div class="bz dy l di"><div class="lq lr l"/></div></figure><p id="4768" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">此外，您的项目应该是这样的:</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div class="er es ls"><img src="../Images/dd1375ccb023beb073f1b1fbc21f7bce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1260/format:webp/0*TLHvjGecoqlibZip.png"/></div></figure><h1 id="d798" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">2.使用DevTools测试目标站点</h1><p id="1132" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">在编写代码之前，我们需要了解网站是如何构建的。是的，所有的表都使用基本结构，但这并不意味着所有的表都是平等创建的。</p><p id="6e0a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们需要确定的第一件事是，这实际上是否是一个HTML表。站点使用JavaScript将数据注入到它们的表中是非常常见的，尤其是当涉及到实时数据时。对于这些情况，我们必须使用完全不同的方法，比如使用无头浏览器。</p><p id="1239" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了测试数据是否在HTML文件中，我们需要做的就是复制一些数据点——比如说名称——并在页面的源代码中寻找它。</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ks"><img src="../Images/30927585d463d0d019ce7626c81e534d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*5WnCyKZuqxSwQCOe.jpg"/></div></div></figure><p id="52cc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们对其他名字和数据点也做了同样的处理，只是为了确认一下，是的，所有的数据都在我们的掌握之中。另一个有趣的惊喜是，表的所有行都在原始HTML中，尽管在前端似乎有某种分页。</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ks"><img src="../Images/1d608a70c47b420d5a1991f52357d634.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*A5F_hT6NA-69miQp.png"/></div></div></figure><p id="b3ae" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">另外，我们现在还知道总共有57行要刮。这很重要，因为我们可以知道我们是否真的获取了所有可用的数据。</p><p id="c7c3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们想在浏览器上直接测试的第二件事是我们的选择器。我们可以使用浏览器的控制台通过<code class="du ll lm ln lo b">document.querySelectorAll()</code> <code class="du ll lm ln lo b">method</code>抓取元素，而不是发送一堆不必要的请求。</p><p id="e50d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果我们到控制台键入<code class="du ll lm ln lo b">document.querySelectorAll('table')</code>，它将返回四个不同的表。</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lt"><img src="../Images/f51602b730c0d654097deac291744700.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*dAkiABbnw-Jel62o.png"/></div></div></figure><p id="81b5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">将鼠标放在表格上，我们很快意识到第一个表格(数字0)是正确的。所以让我们再做一次，但是指定类——在列表中用点表示。).</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ks"><img src="../Images/7f8c321b16f02f0d324e35d0f7be7f4c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*3DZwSqVPRM2IVPWo.jpg"/></div></div></figure><p id="06c9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">太好了，我们离数据又近了一步！</p><p id="4844" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">通过仔细观察，表的数据被包装在一个<code class="du ll lm ln lo b">&lt;tbody&gt;</code>标签中，所以让我们将它添加到我们的选择器中，以确保我们只抓取包含我们想要的数据的行。</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ks"><img src="../Images/2ecb666b09c38ec4f03a6635022d5240.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*OgcE6NEtVZLlht-s.png"/></div></div></figure><p id="1cf7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最后，我们希望获取所有的行，并验证我们的选择器是否获取了全部57行。</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lu"><img src="../Images/99bb40860192a1052e1d06a6332db661.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*V0j01m2Y6pOg0WrP.jpg"/></div></div></figure><p id="d0e8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">注意:</strong>因为我们使用控制台来选择呈现的HTML上的元素，所以我们需要将显示项目的总量设置为100。否则，控制台上的选择器将只显示10个节点项。</p><p id="eb44" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">有了这些信息，我们现在可以开始编写代码了！</p><h1 id="0b9f" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">3.发送我们的HTTP请求并解析原始HTML</h1><p id="7400" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">Axios使得在<code class="du ll lm ln lo b">Async Function</code>中发送HTTP请求变得非常容易。我们需要做的就是创建一个异步函数，并在一个名为<code class="du ll lm ln lo b">response</code>的常量中将URL传递给Axios。我们还将记录响应的状态代码(对于成功的请求应该是200)。</p><figure class="kt ku kv kw fd ij"><div class="bz dy l di"><div class="lq lr l"/></div></figure><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ks"><img src="../Images/2cc768dc75fd06788764bb6977a56efe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*HrguBmjKxPdpUGwc.png"/></div></div></figure><p id="1e92" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">注意:</strong>您可以随意命名这些变量，但要尽可能保持描述性。</p><p id="42e7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">接下来，我们将把来自响应的数据(原始html)存储到一个名为HTML的新常量中，这样我们就可以把它传递给Cheerio，用<code class="du ll lm ln lo b">cheerio.load()</code>进行解析。</p><figure class="kt ku kv kw fd ij"><div class="bz dy l di"><div class="lq lr l"/></div></figure><p id="545d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">4.遍历HTML表格行</p><p id="e66c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">使用我们之前测试过的选择器，让我们选择HTML表中的所有行。</p><figure class="kt ku kv kw fd ij"><div class="bz dy l di"><div class="lq lr l"/></div></figure><p id="967a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">出于测试的目的，让我们使用console . log()all rows的长度来验证我们确实选择了所有的目标行。</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ks"><img src="../Images/87458bd07d83c7b3806bf0c345f4c9a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*OSEGYNq9ed6nLTk7.png"/></div></div></figure><p id="977d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">57正是我们的目标！</p><p id="a057" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当然，为了遍历行列表，我们将使用<code class="du ll lm ln lo b">.each()</code>方法，但是还有一件事我们需要弄清楚:单元格的顺序。</p><p id="48be" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">与常见的HTML元素不同，单元格没有分配给它们的唯一类。所以试图用CSS类来抓取每个数据点可能会很麻烦。相反，我们将瞄准<code class="du ll lm ln lo b">&lt;td&gt;</code>在其行中的位置。</p><p id="1bd9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">换句话说，我们将告诉我们的脚本转到每一行，选择该行中的所有单元格，然后根据每个数据点在该行中的位置将其存储在一个变量中。</p><p id="67be" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">注:</strong>在节点。JS，所有列表都从0开始。所以第一个位置是[0]，第二个单元格是[1]。</p><p id="9d49" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">但是我们怎么知道哪个位置是哪个位置呢？我们回到浏览器的控制台，进行测试:</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lv"><img src="../Images/f731de22d41bbdd0a8851d94e7a728d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*K1i_jH7OyIYVPiLs.gif"/></div></div></figure><p id="1906" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们知道了每个元素相对于其他元素的位置，下面是完成的解析器:</p><figure class="kt ku kv kw fd ij"><div class="bz dy l di"><div class="lq lr l"/></div></figure><p id="a33b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">5.将抓取的数据推入一个空数组</p><p id="6346" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果我们<code class="du ll lm ln lo b">console.log()</code>抓取数据，我们会看到我们从每个单元格中抓取了文本，但结果非常杂乱——这反过来使我们更难创建CSV文件。</p><p id="c605" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因此，在我们导出数据之前，让我们通过将数据推送到一个空数组来创建一个简单的节点列表，从而给它一些顺序。</p><p id="70dd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先，在主函数外部创建一个空数组——如果在函数内部创建空数组，每次迭代都会覆盖它，这不是我们想要的。</p><figure class="kt ku kv kw fd ij"><div class="bz dy l di"><div class="lq lr l"/></div></figure><p id="eb9a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后，作为解析器的一部分，让我们使用。push()方法将数据存储在我们创建的空列表中。</p><figure class="kt ku kv kw fd ij"><div class="bz dy l di"><div class="lq lr l"/></div></figure><p id="cf81" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">像往常一样，让我们<code class="du ll lm ln lo b">console.log()</code>employee data的长度，以确保我们现在有57个条目。</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ks"><img src="../Images/e4415d3562283002d4bdd131cd455737.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*2_gT1pstmDDdzTSq.jpg"/></div></div></figure><p id="df0a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对于可视化上下文，我们还可以记录数组，看看里面存储了什么。</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div class="er es lw"><img src="../Images/3388c58d67024597ea8bef1a9a50315f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1264/format:webp/0*U9jX8KpfQ1o78b_r.jpg"/></div></figure><p id="5a3f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">正如我们所看到的，所有的数据现在都存储在节点项中，节点项包含了结构化格式的所有数据。</p><h1 id="53a8" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">6.将抓取的数据发送到CSV文件</h1><p id="1160" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">组织好数据后，我们可以将列表传递给<code class="du ll lm ln lo b">ObjectsToCsv</code>,它会为我们创建文件，不需要额外的工作:</p><figure class="kt ku kv kw fd ij"><div class="bz dy l di"><div class="lq lr l"/></div></figure><p id="08ce" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们需要做的就是创建一个新的csv对象，并将列表传递给<code class="du ll lm ln lo b">ObjectsToCsv</code>，然后告诉它将列表保存在我们提供路径的机器中。</p><h1 id="60e9" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">7.HTML表格刮刀[全部代码]</h1><p id="8d66" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">恭喜你，你已经正式创建了你的第一个HTML表格刮刀！将您的代码与本教程完成的代码库进行比较，以确保您没有遗漏任何内容:</p><figure class="kt ku kv kw fd ij"><div class="bz dy l di"><div class="lq lr l"/></div></figure><p id="20b7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">运行我们的脚本后，在我们的项目文件夹中会创建一个新的CSV文件:</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ks"><img src="../Images/ebc86f75c64b07f68bdec497065c75c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ZdoZMzVcj6zjAqQL.jpg"/></div></div></figure><p id="3491" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，您可以使用这些数据进行进一步的分析，如根据职位或开始日期进行工资比较，或者在更大的工作数据集中寻找趋势。</p><p id="95e4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当然，这个脚本可以用来处理您找到的几乎任何HTML表格，所以请对新的可能性保持开放的心态</p><h1 id="b9d7" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">避免阻塞:在一行代码中集成ScraperAPI</h1><p id="f4c5" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">在你离开之前，还有一件事我们需要做，以使我们的铲运机更有弹性，那就是处理防刮技术和系统。很多网站不喜欢被抓取，因为，可悲的是，很多抓取工具优化得很差，往往会损害他们的网站。</p><p id="319e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">出于这个原因，你需要遵循一些<a class="ae jo" href="https://www.scraperapi.com/blog/web-scraping-best-practices/" rel="noopener ugc nofollow" target="_blank">网络抓取最佳实践</a>，以确保你正确地处理你的项目，而不会给你的目标网站带来太大的压力，也不会让你的脚本和IP面临被禁或被列入黑名单的风险——使其无法再次从你的机器上访问所需的数据。</p><p id="f32a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了处理IP旋转、JavaScript渲染、<a class="ae jo" href="https://www.scraperapi.com/blog/headers-and-cookies-for-web-scraping/" rel="noopener ugc nofollow" target="_blank">查找并实现HTTP头</a>、验证码等等，我们需要做的就是通过ScraperAPI的服务器发送我们的初始请求。这个API将使用多年的统计分析和机器学习来确定头和代理的最佳组合，处理任何不成功的请求并为我们的请求计时，这样它就不会使我们的目标服务器过载。</p><p id="47bd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">将它添加到我们的脚本中就像将这个字符串添加到传递给Axios的URL中一样简单:</p><figure class="kt ku kv kw fd ij"><div class="bz dy l di"><div class="lq lr l"/></div></figure><p id="58db" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">记得用你自己的API密匙替换<code class="du ll lm ln lo b">{Your_API_Key}</code>——你可以通过创建一个<a class="ae jo" href="https://www.scraperapi.com/signup" rel="noopener ugc nofollow" target="_blank">免费的ScraperAPI账户</a>来生成。</p><p id="8356" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当ScraperAPI为您处理任何复杂问题时，您的初始请求将会花费稍长的时间，并且只会为成功的请求消耗API信用。</p><p id="6e29" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在轮到你了。网络抓取是一种实践。每个网站都是一个不同的难题，所以没有一种方法可以解决问题。相反，专注于利用基础来应对更复杂的挑战。</p><p id="ce67" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你想继续练习，我们推荐几个网站:</p><ul class=""><li id="091d" class="kx ky hi is b it iu ix iy jb kz jf la jj lb jn lc ld le lf bi translated"><a class="ae jo" href="https://quotes.toscrape.com/" rel="noopener ugc nofollow" target="_blank">https://quotes.toscrape.com/</a></li><li id="ba69" class="kx ky hi is b it lg ix lh jb li jf lj jj lk jn lc ld le lf bi translated">https://books.toscrape.com/<a class="ae jo" href="https://books.toscrape.com/" rel="noopener ugc nofollow" target="_blank"/></li><li id="0990" class="kx ky hi is b it lg ix lh jb li jf lj jj lk jn lc ld le lf bi translated">【https://datatables.net/examples/index T4】</li></ul><p id="4ae7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下次见，刮刮快乐！</p></div></div>    
</body>
</html>