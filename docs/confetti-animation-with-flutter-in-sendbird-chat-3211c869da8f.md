# Sendbird èŠå¤©ä¸­å¸¦é£˜åŠ¨çš„äº”å½©çº¸å±‘åŠ¨ç”»

> åŸæ–‡ï¼š<https://medium.com/codex/confetti-animation-with-flutter-in-sendbird-chat-3211c869da8f?source=collection_archive---------8----------------------->

![](img/beeef6d32dc054181c98ba38ae9febf9.png)

ä»™é¸Ÿ 2022

## å¦‚ä½•åœ¨ç”¨æˆ·æ”¶åˆ°ç¥è´ºæ¶ˆæ¯åæ˜¾ç¤ºä¸€é˜µäº”å½©çº¸å±‘

ç”±è°·å˜‰è¯š
è§£å†³æ–¹æ¡ˆå·¥ç¨‹å¸ˆ| [æ£®ä¼¯å¾·](https://www.sendbird.com/)

*ä½ å¯èƒ½ä¼šå‘ç°æ£€æŸ¥ä¸€ä¸‹ Flutter* [*æ ·æœ¬ app*](https://github.com/SendbirdCommunity/sendbird-confetti-flutter-sample) *å¾ˆæœ‰ç”¨ã€‚æœ‰å…³æœ¬æ•™ç¨‹ä¸­ææ–™çš„å…¶ä»–æŒ‡å¯¼ï¼Œè¯·å‚è§* [*æ–‡æ¡£*](https://sendbird.com/docs/chat/v3/flutter/quickstart/send-first-message) *ã€‚è¦æŸ¥çœ‹ä»™é¸ŸèŠå¤©çš„è¿è¡Œæƒ…å†µï¼Œè¯·æŸ¥çœ‹è¿™ä¸ª* [*æ¼”ç¤º*](https://sendbird.com/demos/in-app-chat) *ã€‚æ‚¨ä¹Ÿå¯ä»¥è®¿é—®æˆ‘ä»¬çš„* [*ç½‘ç«™*](https://sendbird.com/features/voice-and-video) *äº†è§£æ›´å¤šå…³äº Sendbird Calls å¯ä»¥æä¾›çš„æœåŠ¡ã€‚*

# ä»‹ç»

chat ä¸­ä¸€ä¸ªéå¸¸å—æ¬¢è¿çš„åŠŸèƒ½æ˜¯äº”å½©çº¸å±‘åŠ¨ç”»ï¼Œå½“èŠå¤©æ¶ˆæ¯ä¸­æ”¶åˆ°å•è¯â€œæ­å–œâ€æˆ–â€œæ­å–œâ€æ—¶ï¼Œä¼šæ˜¾ç¤ºä¸€é˜µäº”å½©çº¸å±‘ã€‚æˆ‘ä»¬ä¹‹å‰åœ¨è¿™ç¯‡ [**æ–‡ç« **](https://sendbird.com/blog/using-confetti-animation-in-sendbird-uikit) ä¸­è®°å½•äº†å¦‚ä½•ä¸º React åº”ç”¨ç¨‹åºå®ç°äº”å½©çº¸å±‘åŠ¨ç”»ã€‚åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºå¦‚ä½•ç”¨ Flutter å®ç°è¿™ä¸ªç‰¹æ€§ã€‚

æœ¬æ–‡ä¸­çš„ä»£ç æ˜¯ä¹‹å‰ä½¿ç”¨ Sendbird çš„ [**Flutter SDK**](https://github.com/sendbird/Sendbird-Flutter) å’Œç¬¬ä¸‰æ–¹èŠå¤© UI æ’ä»¶ [**DashChat**](https://pub.dev/packages/dash_chat_2) åˆ›å»ºçš„ Flutter ç¤ºä¾‹åº”ç”¨ç¨‹åºçš„è¿›å±•ã€‚å¦‚æœè¿™æ˜¯ä½ ç¬¬ä¸€æ¬¡åœ¨ä¸€ä¸ª Flutter åº”ç”¨ç¨‹åºä¸­å®ç° [**Sendbird Chat**](https://sendbird.com/features/chat-messaging) ï¼Œæˆ‘ä»¬å»ºè®®ä½ å…ˆçœ‹çœ‹è¿™ä¸ª [**æ•™ç¨‹**](https://sendbird.com/developer/tutorials/sendbird-flutter-3rd-party-ui) æ¥äº†è§£å¦‚ä½•ç”¨ Sendbird å’Œç¬¬ä¸‰æ–¹ ui æ„å»ºä¸€ä¸ª Flutter èŠå¤©åº”ç”¨ç¨‹åºã€‚

åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†é¦–å…ˆçœ‹åˆ°å¦‚ä½•åˆ›å»ºä¸€ä¸ªåŸºæœ¬çš„ç‰¹æ•ˆç±»ï¼Œç„¶åæ˜¯ä¸€ä¸ªæ˜¾ç¤ºäº”å½©çº¸å±‘çš„è‡ªå®šä¹‰å­ç±»ï¼Œæœ€åæ˜¯å¦‚ä½•æ·»åŠ ä¸€ä¸ªæ§åˆ¶å™¨æ¥ä¿å­˜å’Œè¿è¡Œæˆ‘ä»¬æ‰€æœ‰çš„ç‰¹æ•ˆå­ç±»ã€‚æœ¬æ•™ç¨‹çš„å®Œæ•´ä»£ç æ—¨åœ¨å…è®¸å¿«é€Ÿé›†æˆåˆ°ç°æœ‰é¡¹ç›®ä¸­ï¼Œå¹¶çµæ´»åœ°æ·»åŠ /åˆ é™¤æ‚¨è‡ªå·±çš„è‡ªå®šä¹‰æ•ˆæœï¼Œå¯¹ä»»ä½•ç°æœ‰ä»£ç çš„å½±å“æœ€å°ã€‚

è¯·æ³¨æ„ï¼Œå¦‚æœä½ ä»¥å‰æœ‰è¿‡ä¸€äº›ä½¿ç”¨ Flutter çš„ç»éªŒï¼Œä½ å°†ä¼šä»æœ¬æ•™ç¨‹ä¸­å—ç›ŠåŒªæµ…ã€‚

æˆ‘ä»¬å¼€å§‹å§ï¼ğŸ’»

# è¦æ±‚

*   [](https://docs.flutter.dev/get-started/install)**å®‰è£…å®Œæ¯•â‰¥2.5**
*   **[T5ã€ä»™é¸Ÿã€‘SDKåŒ…](https://pub.dev/packages/sendbird_sdk)**
*   **[**DashChat 2**](https://pub.dev/packages/dash_chat_2) æ’ä»¶**
*   **[**äº”å½©çº¸å±‘**](https://pub.dev/packages/confetti) æ’ä»¶**

# **ä½“ç³»ç»“æ„**

**ä¸ºäº†ä¿æŒæˆ‘ä»¬çš„ä»£ç ç›¸å¯¹ç®€å•ã€å¯ç§»æ¤å’Œå¯æ‰©å±•ï¼Œæˆ‘ä»¬å°†ä»å­˜å‚¨è‡ªå®šä¹‰å¯¹è±¡åˆ—è¡¨çš„ Flutter æ§åˆ¶å™¨å¯¹è±¡å¼€å§‹ã€‚è¿™ä¸ªæ§åˆ¶å™¨å¯ä»¥ç”±æ„å»ºç”¨æˆ·ç•Œé¢(UI)çš„ä»»ä½•æœ‰çŠ¶æ€æˆ–æ— çŠ¶æ€å°éƒ¨ä»¶æ¥åˆå§‹åŒ–å’Œä¿ç•™ã€‚**

**å½“èŠå¤©æ¶ˆæ¯ä¼ é€’åˆ°è¿™ä¸ªæ§åˆ¶å™¨æ—¶ï¼Œæ§åˆ¶å™¨ä¼šå°†æ¶ˆæ¯ä¼ é€’åˆ°å®ƒå­˜å‚¨çš„è‡ªå®šä¹‰å­ç±»åˆ—è¡¨ä¸­ã€‚è¿™äº›å­ç±»ä¸­çš„æ¯ä¸€ä¸ªéƒ½å°†æ£€æŸ¥ç‰¹å®šå…³é”®å­—çš„æ¶ˆæ¯ï¼Œå¦‚æœæ‰¾åˆ°ï¼Œå°±æ’­æ”¾å®ƒçš„æ•ˆæœã€‚ç„¶åï¼Œä»–ä»¬ä¼šæŒ‡å‡ºç”¨æˆ·å·²ç»çœ‹åˆ°äº†åŠ¨ç”»ï¼Œå¹¶æ›´æ–°å…¶ Sendbird æ¶ˆæ¯å…ƒæ•°æ®ï¼Œä»¥ä¾¿å½“ç”¨æˆ·é‡æ–°æ‰“å¼€èŠå¤©å±å¹•æ—¶ï¼Œä¸ä¼šå‡ºç°ç›¸åŒçš„æ•ˆæœã€‚**

**ç°åœ¨è®©æˆ‘ä»¬æ·±å…¥äº†è§£å®ç°ç»†èŠ‚ã€‚**

# **ç¬¬ä¸€éƒ¨åˆ†ã€‚åŸºç¡€ç±»**

**é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªåä¸º sendbird_sfx.dart çš„æ–‡ä»¶ï¼Œè¿™å°†æ˜¯æˆ‘ä»¬çš„åŸºæœ¬ç‰¹æ•ˆç±»ã€‚å®ƒå°†å…·æœ‰ä»¥ä¸‹åŠŸèƒ½:**

*   **è¿”å› UI å°éƒ¨ä»¶**
*   **å¼€å§‹ä¸€ä¸ªæ•ˆæœ**
*   **åœæ­¢æ•ˆæœ**
*   **å¤„ç†ä»»ä½•ä¸è¿è¡Œæ•ˆæœç›¸å…³çš„å¯¹è±¡**

**è¦æ”¯æŒè¿™äº›åŠŸèƒ½ï¼Œè¯·æ·»åŠ ä»¥ä¸‹å±æ€§:**

*   **å…ƒé”®â€”åŒºåˆ†ç‰¹æ•ˆçš„å”¯ä¸€é”®**
*   **å…³é”®è¯â€”è§¦å‘ç‰¹æ®Šæ•ˆæœçš„å…³é”®è¯åˆ—è¡¨**
*   **isCaseSensitive â€”è®¾ç½®æ˜¯å¦åº”æ£€æŸ¥ä¸Šè¿°å…³é”®å­—åˆ—è¡¨æ˜¯å¦åŒºåˆ†å¤§å°å†™ã€‚False è¡¨ç¤ºå°†å¿½ç•¥å¤§å°å†™ã€‚**
*   **expiresIn â€”ä¸€ä¸ªæŒç»­æ—¶é—´å±æ€§ï¼Œç”¨äºè®¾ç½®æ­¤æ•ˆæœåº”é€‚ç”¨å¤šé•¿æ—¶é—´çš„é˜ˆå€¼ã€‚æ¯”å¦‚ä½ æƒ³åœ¨æœ‰äººå‘â€œå‘¨å¹´å¿«ä¹ï¼â€ä½†å¦‚æœæ¶ˆæ¯æœ€åˆæ˜¯åœ¨ä¸€ä¸ªæœˆå‰å‘é€ï¼Œåˆ™æŒç»­æ—¶é—´å¯ä»¥è®¾ç½®ä¸ºä¸€ä¸ªæœˆå†…ã€‚**

**ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œä»¥ç¡®ä¿åœ¨ init æœŸé—´æä¾›æ‰€éœ€çš„å±æ€§:**

**æ·»åŠ ä»¥ä¸‹åº”è¢«æœªæ¥å­ç±»è¦†ç›–çš„å‡½æ•°:**

**ä»¥ä¸‹æ˜¯å¯ä»¥é€‰æ‹©æ€§è¦†ç›–çš„ä»£ç å—:**

**å¤åˆ¶ä»¥ä¸‹å†…éƒ¨å‡½æ•°æ¥å¤„ç†æ ·æ¿æ“ä½œå¹¶ä¸ Sendbird çš„ç³»ç»ŸåŒæ­¥:**

**å‚è§ [**Github**](https://github.com/SendbirdCommunity/sendbird-confetti-flutter-sample/blob/master/lib/sendbird_sfx.dart) è·å– sendbird_sfx.dart ç±»çš„å®Œæˆä»£ç ã€‚**

# **ç¬¬äºŒéƒ¨åˆ†ã€‚è‡ªå®šä¹‰å­ç±»**

**ç°åœ¨æˆ‘ä»¬å°†åˆ›å»º SendbirdSFX çš„ä¸€ä¸ªå­ç±»ï¼Œç”¨äºåœ¨æ£€æµ‹åˆ°å…³é”®å­—â€œæ­å–œâ€æˆ–â€œç¥è´ºâ€æ—¶æ˜¾ç¤ºäº”å½©çº¸å±‘ã€‚**

**åˆ›å»ºä¸€ä¸ªåä¸º confetti_sfx.dart çš„æ–°ç±»ï¼Œç¡®ä¿å®ƒæ‰©å±•äº†ä¸Šé¢çš„åŸºç±»ã€‚**

**ä¸ºäº†å®ç°è¿™ä¸ªæ•ˆæœï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å¼€æºçš„ [**äº”å½©çº¸å±‘åŒ…**](https://pub.dev/packages/confetti) ã€‚åœ¨æ‚¨çš„ pubspec.yaml dependencies éƒ¨åˆ†æ·»åŠ äº† confetti ä¹‹åï¼Œæ·»åŠ  import ' package:confetti/confetti . dart 'ï¼›åˆ° ConfettiSFX ç±»ã€‚**

**å°†äº”å½©çº¸å±‘åŒ…åˆå§‹åŒ–ä¸ºä¸€ä¸ªå±æ€§ä»¥ä¿ç•™å®ƒ:**

```
final ConfettiController _confettiController = ConfettiController(duration: const Duration(seconds: 10));
```

**ç„¶ååœ¨ ui()å‡½æ•°çš„è¦†ç›–ä¸­æ·»åŠ å®ƒä½œä¸ºåŒ…çš„ confetti å°éƒ¨ä»¶çš„æ§åˆ¶å™¨:**

**ç°åœ¨ï¼Œå‘ playã€stop å’Œ dispose å‡½æ•°æ·»åŠ  _confettiController è°ƒç”¨:**

**confetti_sfx.dart ç±»çš„å®Œæ•´ä»£ç å¯ä»¥åœ¨ [**Github**](https://github.com/SendbirdCommunity/sendbird-confetti-flutter-sample/blob/master/lib/confetti_sfx.dart) ä¸Šæ‰¾åˆ°ã€‚**

# **ç¬¬ä¸‰éƒ¨åˆ†ã€‚æ·»åŠ æ§åˆ¶å™¨**

**æ¥ä¸‹æ¥ï¼Œåˆ›å»ºå¦ä¸€ä¸ªåä¸º sendbird_sfx_controller.dart çš„æ–‡ä»¶ã€‚è¿™æ˜¯ä¸€ä¸ªæ–¹ä¾¿çš„ç±»ï¼Œç”¨æ¥ä¿å­˜å’Œè¿è¡Œæˆ‘ä»¬æ‰€æœ‰çš„ç‰¹æ•ˆå­ç±»ã€‚æ·»åŠ å¯¼å…¥è¯­å¥:**

```
import "sendbird_sfx.dart";
```

**è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æ·»åŠ å•ä¸ªåˆ—è¡¨å±æ€§:**

**åˆ—å‡º<sendbirdsfx>ç‰¹æ®Šæ•ˆæœï¼›</sendbirdsfx>**

**æ·»åŠ ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œä»¥ä¾¿åœ¨åˆå§‹åŒ–æ—¶é€‰æ‹©æ€§åœ°ä¼ å…¥ä¸€ä¸ªç‰¹æ•ˆå­ç±»åˆ—è¡¨:**

```
SendbirdSFXController({this.specialEffects = const []});
```

**ç°åœ¨åˆ›å»ºä»¥ä¸‹å‡½æ•°æ¥ä¼ é€’æ¶ˆæ¯å­—ç¬¦ä¸²ï¼Œå¹¶å‘å®ƒå’Œå®ƒçš„æ¯ä¸ªç‰¹æ®Šæ•ˆæœå­ç±»ä¼ é€’ dispose å‘½ä»¤:**

**sendbird_sfx_controller.dart ç±»çš„å®Œæ•´ä»£ç å¯ä»¥åœ¨ [**Github**](https://github.com/SendbirdCommunity/sendbird-confetti-flutter-sample/blob/master/lib/sendbird_sfx_controller.dart) ä¸Šæ‰¾åˆ°ã€‚**

**æœ€åï¼Œæˆ‘ä»¬å°†æŠŠè¿™äº›ç±»æ·»åŠ åˆ°å‰é¢ç¤ºä¾‹ä¸­çš„ group_channel_view.dart ç±»ä¸­ï¼Œä»¥ä¾¿ä¸é€šè¿‡ Sendbird å‘é€å’Œæ¥æ”¶çš„æ¶ˆæ¯ç»“åˆèµ·æ¥ã€‚**

**æ·»åŠ è¿™äº›å¯¼å…¥è¯­å¥:**

**ç„¶ååœ¨ _GroupChannelViewState å—ä¸­ï¼Œæ·»åŠ ä¸€ä¸ªæ–°å±æ€§æ¥ä¿ç•™æˆ‘ä»¬çš„ SendbirdSFXController:**

**æˆ‘ä»¬ä¸ä¼šä¿®æ”¹ç°æœ‰çš„ body()å—ï¼Œè€Œæ˜¯å°†å®ƒå°è£…åˆ°ä¸€ä¸ª stack å°éƒ¨ä»¶ä¸­ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨å®ƒä¸Šé¢æ·»åŠ æ‰€æœ‰çš„ç‰¹æ•ˆ UIã€‚åˆ›å»ºä¸€ä¸ª sfxStackedBody å‡½æ•°ï¼Œè¯¥å‡½æ•°ä½¿ç”¨ä»¥ä¸‹å‚æ•°è¿”å›ä¸€ä¸ªå°éƒ¨ä»¶:**

**ç„¶åæ›´æ–° build()å‡½æ•°ä»¥è°ƒç”¨æ­¤å—è€Œä¸æ˜¯åŸå§‹çš„ body å—ï¼Œä¼ å…¥ _sfxController å±æ€§ã€é¢„å…ˆå­˜åœ¨çš„ _messages å±æ€§å’Œ Sendbird ç»„é€šé“å¼•ç”¨:**

**ç°åœ¨ï¼Œå½“ç±»çš„ _messages å±æ€§è¢«æ›´æ–°å¹¶å¯åŠ¨ UI é‡å»ºæ—¶ï¼Œæ›´æ–°çš„æ¶ˆæ¯å°†ç”± _sfxController å¤„ç†ï¼Œä»¥ç¡®å®šæ˜¯å¦åº”è¯¥è§¦å‘äº”å½©çº¸å±‘æ•ˆæœã€‚å¦‚æœä¸€ä¸ªå•è¯ä¸å…³é”®å­—åˆ—è¡¨ä¸­çš„ä¸€ä¸ªåŒ¹é…ï¼Œäº”å½©çº¸å±‘æ•ˆæœå°†æ’­æ”¾è¯¥æ•ˆæœã€‚**

**æ³¨æ„:è¿™æ˜¯é›†æˆæ¶ˆæ¯æ£€æŸ¥çš„æœ€ç®€å•çš„æ–¹æ³•ï¼Œä½†ä¸æ˜¯æœ€æœ‰æ•ˆçš„ï¼Œå› ä¸ºè¿‡å»çš„æ¶ˆæ¯æ€»æ˜¯ä¼šè¢«é‡æ–°æ£€æŸ¥ã€‚å®ç° onMessageRecieved()å’Œ onMessageUpdated()å›è°ƒ(æ›´å¤šä¿¡æ¯ [**æ­¤å¤„**](https://sendbird.com/docs/chat/v3/flutter/guides/event-handler#4-list-of-group-channel-events) )å¹¶å°† SendbirdSFXController çš„ checkAndTriggerAll() all å‡½æ•°ç§»è‡³è¿™äº›å‡½æ•°ã€‚**

**æ›´æ–°åçš„ group_channel_view.dart ç±»çš„å®Œæ•´ä»£ç å¯ä»¥åœ¨ [**Github**](https://github.com/SendbirdCommunity/sendbird-confetti-flutter-sample/blob/master/lib/group_channel_view.dart) ä¸Šæ‰¾åˆ°ã€‚**

# **ç»“è®º**

**å°±æ˜¯è¿™æ ·ï¼ä½ åšåˆ°äº†ï¼ğŸš€ç°åœ¨ä½ å·²ç»çŸ¥é“å¦‚ä½•æ·»åŠ äº”å½©çº¸å±‘åˆ°ä½ çš„ Flutter åº”ç”¨ç¨‹åºï¼Œä½ å¯ä»¥åˆ¶ä½œä½ è‡ªå·±çš„èŠå¤©è§¦å‘çš„æ•ˆæœâ€”â€”å…¶ä»–åŠ¨ç”»ï¼ŒéŸ³é¢‘æ•ˆæœï¼Œç”šè‡³å…¶ä»–ä»£ç å—ï¼**

**äº«å—ä½“éªŒä½ è‡ªå·±çš„èŠå¤©è§¦å‘çš„ç‰¹æ®Šæ•ˆæœï¼å¼€å¿ƒèŠæ¥¼ï¼âœŒï¸ğŸ‘¨â€ğŸ’»**