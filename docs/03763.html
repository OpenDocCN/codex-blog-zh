<html>
<head>
<title>💪Azure Bicep: working with Parameters — Best practices</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">💪Azure Bicep:使用参数-最佳实践</h1>
<blockquote>原文：<a href="https://medium.com/codex/azure-bicep-working-with-parameters-best-practices-92454074e380?source=collection_archive---------2-----------------------#2021-09-22">https://medium.com/codex/azure-bicep-working-with-parameters-best-practices-92454074e380?source=collection_archive---------2-----------------------#2021-09-22</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="49a5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">何时以及如何在Azure Bicep模板中使用参数。</p><p id="64b0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在Azure Bicep中，新的领域特定语言(DSL)用于声明性部署<strong class="ih hj"> Azure </strong>资源，我们像在ARM模板中一样定义参数。我们应该考虑语法上的一些差异。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/665c7599da08e27232a0e48cd5c5f454.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eUO56gOV0eZFpbL-nRa5vg.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">天蓝色二头肌—参数</figcaption></figure><h1 id="47aa" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">Azure二头肌参数</h1><p id="f2de" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated">参数是我们在Bicep模板中定义的输入值。这些值可以在部署操作期间内联传递，也可以从参数文件中引用。</p><h2 id="fba6" class="kw ju hi bd jv kx ky kz jz la lb lc kd iq ld le kh iu lf lg kl iy lh li kp lj bi translated">在Azure Bicep中声明参数</h2><p id="8dd2" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated">您需要为Bicep模板中的每个参数提供一个名称和类型。下面的代码显示了如何声明参数:</p><pre class="je jf jg jh fd lk ll lm ln aw lo bi"><span id="77fd" class="kw ju hi ll b fi lp lq l lr ls">param demoString string<br/>param demoInt int<br/>param demoBool bool<br/>param demoObject object<br/>param demoArray array</span></pre><p id="e7e2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">参数不能与变量、模块或资源同名。不要过度使用参数。当我们需要传递因不同部署而异的值时，经常会用到参数。</p><p id="5610" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如，创建存储账户时，需要提供SKU和类型；你可以利用参数。</p><p id="af8e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您需要定义虚拟网络和子网，您可以利用虚拟网络和子网定义的参数对象。</p><p id="8e6f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">尽可能多地为参数提供描述。你的团队和同事会很感激的。</p><p id="ae24" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">资源管理器在开始部署操作之前解析参数值。现在让我们快速看一下支持的数据类型。</p><h2 id="c37a" class="kw ju hi bd jv kx ky kz jz la lb lc kd iq ld le kh iu lf lg kl iy lh li kp lj bi translated">Azure Bicep参数数据类型</h2><p id="2e0d" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated">Azure Bicep支持以下参数数据类型:</p><ul class=""><li id="7d4d" class="lt lu hi ih b ii ij im in iq lv iu lw iy lx jc ly lz ma mb bi translated">排列</li><li id="db2b" class="lt lu hi ih b ii mc im md iq me iu mf iy mg jc ly lz ma mb bi translated">弯曲件</li><li id="c3e5" class="lt lu hi ih b ii mc im md iq me iu mf iy mg jc ly lz ma mb bi translated">（同Internationalorganizations）国际组织</li><li id="4ec4" class="lt lu hi ih b ii mc im md iq me iu mf iy mg jc ly lz ma mb bi translated">目标</li><li id="34c5" class="lt lu hi ih b ii mc im md iq me iu mf iy mg jc ly lz ma mb bi translated">secureObject和secureString —由<em class="mh"> @secure() </em> decorator指示</li><li id="b5aa" class="lt lu hi ih b ii mc im md iq me iu mf iy mg jc ly lz ma mb bi translated">线</li></ul><p id="c419" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您想知道decorator是什么，Bicep中的decorator可以用来为参数指定约束和元数据。</p><p id="26a1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以下是Bicep中可用的装饰者列表:</p><ul class=""><li id="9c3b" class="lt lu hi ih b ii ij im in iq lv iu lw iy lx jc ly lz ma mb bi translated">允许</li><li id="9e47" class="lt lu hi ih b ii mc im md iq me iu mf iy mg jc ly lz ma mb bi translated">安全的</li><li id="aee9" class="lt lu hi ih b ii mc im md iq me iu mf iy mg jc ly lz ma mb bi translated">最小长度和最大长度</li><li id="9880" class="lt lu hi ih b ii mc im md iq me iu mf iy mg jc ly lz ma mb bi translated">最小值和最大值</li><li id="8010" class="lt lu hi ih b ii mc im md iq me iu mf iy mg jc ly lz ma mb bi translated">描述</li><li id="3423" class="lt lu hi ih b ii mc im md iq me iu mf iy mg jc ly lz ma mb bi translated">元数据</li></ul><h2 id="cf6d" class="kw ju hi bd jv kx ky kz jz la lb lc kd iq ld le kh iu lf lg kl iy lh li kp lj bi translated">什么时候应该使用装饰者？</h2><p id="9b62" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated">这里有一个例子，如果你想部署一个虚拟机，你可以使用一个带有<em class="mh"> @secure() </em> decorator的参数来传递用户名的密码。部署历史记录中不记录也不存储密码。</p><p id="8d49" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面的<a class="ae mi" href="https://blog.azinsider.net/azure-bicep-secure-secrets-in-parameters-secure-decorator-ce6317cc0c23" rel="noopener ugc nofollow" target="_blank">文章</a>解释了如何使用<em class="mh">@ secure()</em>decorator:<a class="ae mi" href="https://blog.azinsider.net/azure-bicep-secure-secrets-in-parameters-secure-decorator-ce6317cc0c23" rel="noopener ugc nofollow" target="_blank">https://blog . azin sider . net/azure-bicep-secure-secrets-in-parameters-secure-decorator-ce 6317 cc 0 c 23</a></p><p id="fa87" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面的代码展示了一些参数和<em class="mh"> @secure() </em>装饰器的例子:</p><pre class="je jf jg jh fd lk ll lm ln aw lo bi"><span id="d3d4" class="kw ju hi ll b fi lp lq l lr ls">// Username for the Virtual Machine.<br/><strong class="ll hj">param adminUsername string</strong></span><span id="aba9" class="kw ju hi ll b fi mj lq l lr ls">// Type of authentication to use on the Virtual Machine. SSH key is recommended.<br/><strong class="ll hj">param authenticationType string = 'sshPublicKey'</strong></span><span id="3795" class="kw ju hi ll b fi mj lq l lr ls">// SSH Key or password for the Virtual Machine. SSH key is recommended.<br/><a class="ae mi" href="http://twitter.com/secure" rel="noopener ugc nofollow" target="_blank"><strong class="ll hj">@secure</strong></a><strong class="ll hj">()<br/>param adminPasswordOrKey string</strong></span></pre><p id="9372" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在上面的代码中，我们用<em class="mh"> @secure() </em>装饰器为密码或密钥定义了字符串类型参数和第三个参数。</p><p id="780f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">尝试添加注释，以提供关于参数的更多上下文或信息。</p><p id="c463" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面是另一个例子，它展示了'<em class="mh"> minLength和maxLength</em>decorator的用法:</p><pre class="je jf jg jh fd lk ll lm ln aw lo bi"><span id="3834" class="kw ju hi ll b fi lp lq l lr ls">@minLength(3) <br/>@maxLength(11) <br/>param storagePrefix string</span></pre><p id="c193" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以为每个参数添加一个或多个装饰器。你可以在你的二头肌模板的任何地方定义参数；它们将被编译到ARM模板的参数部分。</p><p id="cfbc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面是另一个最佳实践:为了最大限度地减少部署期间的潜在错误，请记住为控制命名的参数(如存储帐户)指定最小和最大字符长度。</p><p id="d853" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">与ARM模板类似，您可以使用数组、对象、字符串、int和bool值:</p><pre class="je jf jg jh fd lk ll lm ln aw lo bi"><span id="518f" class="kw ju hi ll b fi lp lq l lr ls">param myArr array = [<br/>  'one'<br/>  'two'<br/>  'three'<br/>]<br/>param myObj object = {<br/>  name: 'Mike'<br/>  age: 32<br/>}<br/>param myString string = 'string'<br/>param myInt int = 100</span></pre><p id="a918" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您也可以使用参数作为形状因子来创建另一个参数:</p><pre class="je jf jg jh fd lk ll lm ln aw lo bi"><span id="6aae" class="kw ju hi ll b fi lp lq l lr ls">param storageNamePrefix string = ''<br/>param storageAccountName string = '${storageNamePrefix}storage'</span></pre><p id="2ecb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在上面的代码中，我们插入了“<em class="mh"> storageNamePrefix </em>”来创建存储帐户名称。</p><h2 id="59da" class="kw ju hi bd jv kx ky kz jz la lb lc kd iq ld le kh iu lf lg kl iy lh li kp lj bi translated">函数呢？</h2><p id="0a1d" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated">您还可以利用函数来创建参数值，就像在ARM模板中一样。下面的代码显示了如何定义资源的位置。</p><pre class="je jf jg jh fd lk ll lm ln aw lo bi"><span id="acb4" class="kw ju hi ll b fi lp lq l lr ls">// Location for all resources.<br/>param location string = resourceGroup().location</span></pre><p id="b5e5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在Bicep中，可以使用多行参数。我没用过那么多，但是你可以自己试试:</p><pre class="je jf jg jh fd lk ll lm ln aw lo bi"><span id="9225" class="kw ju hi ll b fi lp lq l lr ls">param myParam string = '''<br/>This is the first line<br/>this is the second line<br/>third line'''</span></pre><p id="0d57" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上述代码将产生以下JSON:</p><pre class="je jf jg jh fd lk ll lm ln aw lo bi"><span id="6c2c" class="kw ju hi ll b fi lp lq l lr ls">"parameters": {<br/>    "myParam": {<br/>      "type": "string",<br/>      "defaultValue": "<!-- -->This is the first line<strong class="ll hj">\n</strong>this is the second line<strong class="ll hj">\n</strong>third line"<br/>    }<br/>  },</span></pre><p id="8f82" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正如您已经注意到的，在Bicep中使用参数非常灵活和简单。</p><p id="8ba6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们已经回顾了一些关于参数的基础知识，是时候进入部署操作了。</p><p id="1b5b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本文的开头，我提到了传递参数的两个选项:<em class="mh">内联</em>和使用一个<em class="mh">参数文件</em>。</p><h1 id="4b85" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">内嵌参数</h1><p id="14fb" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated">使用这种方法，您可以在部署时定义参数。当部署期间未提供值时，将使用默认值。</p><p id="5ab0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面的代码显示了创建虚拟机的几个参数的示例。</p><pre class="je jf jg jh fd lk ll lm ln aw lo bi"><span id="0346" class="kw ju hi ll b fi lp lq l lr ls">// The name of your Virtual Machine.<br/>param vmName string = 'flowmonVm'</span><span id="4e4d" class="kw ju hi ll b fi mj lq l lr ls">// Username for the Virtual Machine.<br/>param adminUsername string</span><span id="76fc" class="kw ju hi ll b fi mj lq l lr ls">// Type of authentication to use on the Virtual Machine. SSH key is recommended.<br/>param authenticationType string = 'sshPublicKey'</span><span id="37ea" class="kw ju hi ll b fi mj lq l lr ls">// SSH Key or password for the Virtual Machine. SSH key is recommended.<br/><a class="ae mi" href="http://twitter.com/secure" rel="noopener ugc nofollow" target="_blank">@secure</a>()<br/>param adminPasswordOrKey string</span><span id="f5c8" class="kw ju hi ll b fi mj lq l lr ls">// Unique DNS Name for the Public IP used to access the Virtual Machine.<br/>param dnsLabelPrefix string = toLower('flowmon-${uniqueString(resourceGroup().id)}')</span><span id="7a53" class="kw ju hi ll b fi mj lq l lr ls">// Location for all resources.<br/><strong class="ll hj">param location string = resourceGroup().location</strong></span><span id="c30e" class="kw ju hi ll b fi mj lq l lr ls">// The size of the VM.<br/>param vmSize string = 'Standard_B4ms'</span><span id="caa1" class="kw ju hi ll b fi mj lq l lr ls">// Name of the VNET.<br/>param virtualNetworkName string = 'vNet'</span><span id="cd1c" class="kw ju hi ll b fi mj lq l lr ls">// Name of the subnet in the virtual network.<br/>param subnetName string = 'Subnet'</span><span id="f2ef" class="kw ju hi ll b fi mj lq l lr ls">// Name of the Network Security Group.<br/>param networkSecurityGroupName string = 'SecGroupNet'</span></pre><p id="c7ad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要引用参数的值，需要使用参数名。在下面的代码中，我们传递了参数“location”:</p><pre class="je jf jg jh fd lk ll lm ln aw lo bi"><span id="3d22" class="kw ju hi ll b fi lp lq l lr ls">resource nic 'Microsoft.Network/networkInterfaces@2020-06-01' = {<br/>  name: networkInterfaceName<br/>  <strong class="ll hj">location: location</strong><br/>  properties: {<br/>    ipConfigurations: [</span></pre><p id="5915" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">可以在部署操作期间传递参数，如下面的代码所示:</p><pre class="je jf jg jh fd lk ll lm ln aw lo bi"><span id="76e7" class="kw ju hi ll b fi lp lq l lr ls">New-AzResourceGroupDeployment `<br/>  -Name BicepTemplateDeployment `<br/>  -ResourceGroupName az-insider`<br/>  -TemplateFile ./main.bicep `<br/>  -storageAccountName azinsiderstgacc</span></pre><p id="5d6d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在让我们看看传递参数的第二个选项:使用参数文件。</p><h1 id="5181" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">使用参数文件部署Bicep文件</h1><p id="e799" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated">您可以创建一个包含参数值的参数文件，而不是传递参数的内联值。这个参数文件是一个带有实际参数值的JSON文件。</p><p id="5d28" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">像ARM模板一样，您可以拥有Bicep模板'<em class="mh"> main.bicep </em>'和一个名为'<em class="mh"> main.parameters.json </em>'的参数文件。</p><p id="c53f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面的代码显示了一个参数文件的示例:</p><pre class="je jf jg jh fd lk ll lm ln aw lo bi"><span id="11d3" class="kw ju hi ll b fi lp lq l lr ls">{<br/>  "$schema": "<a class="ae mi" href="https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#" rel="noopener ugc nofollow" target="_blank">https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#</a>",<br/>  "contentVersion": "1.0.0.0",<br/>  "parameters": {<br/>    "&lt;first-parameter-name&gt;": {<br/>      "value": "&lt;first-value&gt;"<br/>    },<br/>    "&lt;second-parameter-name&gt;": {<br/>      "value": "&lt;second-value&gt;"<br/>    }<br/>  }<br/>}</span></pre><p id="7440" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请注意，参数文件中的参数类型必须使用与Bicep文件相同的类型。</p><p id="e00b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，您可以使用Azure PowerShell或Azure CLI部署Bicep模板。下面的代码展示了如何使用Azure PowerShell部署带有参数文件的Bicep模板:</p><pre class="je jf jg jh fd lk ll lm ln aw lo bi"><span id="1fdf" class="kw ju hi ll b fi lp lq l lr ls">New-AzResourceGroupDeployment -Name BicepDeployment -ResourceGroupName MyResourceGroup `<br/>  -TemplateFile C:\MyTemplates\storage.bicep `<br/>  -TemplateParameterFile C:\MyTemplates\storage.parameters.json</span></pre><p id="4a71" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在上面的代码中，我们使用- <em class="mh">模板文件</em>和- <em class="mh">模板参数文件</em>来引用Bicep模板和参数文件。</p><p id="0037" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，值得一提的是，Bicep允许您为部署使用本地参数文件和内联参数。也可以引用外部文件；但是，如果使用这种方法，将无法使用本地文件或传递内联值。</p><p id="961c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我希望这能让你更好地理解Azure Bicep中的参数是如何工作的。</p><p id="d6de" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae mi" href="http://eepurl.com/gKmLdf" rel="noopener ugc nofollow" target="_blank"> <em class="mh">在此加入</em><strong class="ih hj"><em class="mh">azin sider</em></strong><em class="mh">邮箱列表。</em>T9】</a></p><p id="8ce1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="mh">-戴夫·r·</em></p></div></div>    
</body>
</html>