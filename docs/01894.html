<html>
<head>
<title>Fetch data from an API endpoint using URLSession and CoreLocation — Swift 5.4</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用URLSession和CoreLocation从API端点获取数据— Swift 5.4</h1>
<blockquote>原文：<a href="https://medium.com/codex/fetch-data-from-api-using-urlsessiontask-and-users-gps-coordinates-b8f56234f28d?source=collection_archive---------4-----------------------#2021-06-12">https://medium.com/codex/fetch-data-from-api-using-urlsessiontask-and-users-gps-coordinates-b8f56234f28d?source=collection_archive---------4-----------------------#2021-06-12</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/b2e1872b610e1489863213926063a78e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jUMexU3zpd10SkvMzt64oA.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">来源:<a class="ae iu" href="https://www.pexels.com/photo/time-lapse-photography-of-blue-lights-373543/" rel="noopener ugc nofollow" target="_blank"> Pixabay </a></figcaption></figure><p id="8e54" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我最喜欢的iOS开发功能之一是连接到API端点和使用CoreLocation，特别是用户的GPS坐标。构建一个使用用户的GPS坐标来确定他们周围数据的应用程序并没有什么了不起的。无论是寻找餐馆、公园还是著名的地标，将用户的GPS坐标融合到API端点来传递用户正在寻找的信息都非常有趣。</p><p id="201a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">长期以来，我个人一直使用AlamoFire和SwiftyJSON第三方库来查询API端点并处理接收到的JSON数据。这两个库就像豌豆和胡萝卜一样，它们被广泛使用也就不足为奇了。然而，当有本地语言的更新时，我读到的第三方库<em class="jt">破坏</em>越多，我就越确信要坚持使用本地库和它们的方法来避免这样的风险。此外，我正专注于成为一名专业的iOS开发人员，而寻求这类专业人员的公司正在寻找在原生库中的经验。为了有更好的机会成为一名iOS开发人员，我需要确保我在本地库和方法方面的知识得到很好的提升，所以我决定继续使用URLSession和JSONDecoder。我必须说，在使用URLSession和JSONDecoder之后，我发现它并没有那么糟糕。</p><p id="d748" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">也就是说，我将带您了解如何使用URLSession查询API端点，使用CoreLocation查询您自己的GPS坐标，并使用JSONDecoder处理接收到的API数据。我们将使用OpenWeatherMap API端点，所以如果你想跟进，请前往<a class="ae iu" href="https://home.openweathermap.org/users/sign_up" rel="noopener ugc nofollow" target="_blank"> OpenWeatherMap注册一个帐户</a>并获得一个API密钥。</p><p id="7da4" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">那么下面是我们需要做的事情的大纲:</strong> <br/> 1。设置LocationManager以检索用户的位置<br/> 2。获得用户的许可以获取他们的GPS位置<br/> 3。设置网络请求以连接到OpenWeatherMap的API端点<br/> 4。构建一个数据模型来匹配端点的响应<br/> 5。用JSONDecoder <br/> 6解码数据响应。重构网络请求以接受用户的GPS坐标，并确保正在查询用户位置的数据。<br/> 7。打印出一份可读的天气报表，包括星期、日期、当前温度和天气状况。</p><p id="be3f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们从访问用户的位置开始。我们需要实现各种函数和委托方法。我将使用Storyboard打开一个干净的Xcode项目。在默认的<em class="jt"> ViewController.swift </em>文件中，添加以下代码行:</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><p id="1292" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">正如您在viewDidLoad()方法中看到的，我们希望在应用程序加载后立即触发checkLocationServices()函数，以便它可以发现位置服务是否已设置。如果没有设置定位服务，它会为我们处理。在checkLocationServices()函数中添加以下代码:</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="ka jz l"/></div></figure><p id="0b4d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们要求这个函数做的是检查LocationServices是否已启用，将ViewController指定为负责人(委托人)来检查LocationServices是否已启用，并将精确度设置为最佳的。如果没有启用定位服务，我们可以提醒用户如何在iOS设置应用程序中启用定位服务。</p><p id="4a7d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">既然我们让ViewController负责设置LocationManager，那么它需要请求用户允许获取他们设备的GPS坐标。幸运的是，有一个LocationManager委托函数处理这个名为<strong class="ix hj">的location manager(diddupdatelocations:)</strong>:</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="kb jz l"/></div></figure><p id="824b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="jt">checkLocationAuthorization()</em>函数是一种确定如何处理<strong class="ix hj">类型的简洁方法。我们可能遇到的授权状态</strong>选项。让我对每个选项做一个简单的概述:<br/> <strong class="ix hj"> -。受限:</strong>此状态与iOS中的家长控制相关，用于限制儿童使用的iOS设备。可以理解的是，父母反对他们的孩子分享他们的位置，所以这种状态选项是非常合理的。如果必须使用设备的位置数据，我们会触发一个UIAlertController事件，通知用户需要他们的位置服务的重要性。我建议将用户链接到你的应用程序的隐私政策页面。<br/> <strong class="ix hj"> -。notDetermined: </strong>该状态与用户没有选择是否允许应用程序使用他们的位置有关。这种状态几乎从未使用过，因为大多数应用程序已经确定它已经访问或不访问定位服务，但这是一个很好的故障保险。如果<strong class="ix hj">。未确定的</strong>状态是活动的，我们触发<strong class="ix hj">requestwhenuinuseaauthorization()</strong>位置管理器方法来请求用户对其位置的许可。<br/> - <strong class="ix hj">。拒绝:</strong>这个状态是不言自明的。这种活跃状态明确限制了应用程序使用用户的位置数据。就像<strong class="ix hj">一样。受限</strong>状态，如果用户想要使用应用程序，并且必须使用用户的位置数据，我们可以使用UIAlertController来触发一个事件，通知用户如何允许应用程序访问他们设备的位置数据。<br/> - <strong class="ix hj">。authorizedWhenInUse: </strong>这种状态也是不言自明的，用户允许应用程序使用他们设备的位置数据。这里是我们触发函数集的地方，它继续访问和使用用户的位置数据。在这种情况下，触发获取设备的GPS坐标的功能以及在用户移动时监控位置的位置管理器委托功能。</p><p id="8515" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">既然我们已经设置了我们的函数来确定位置授权状态，我们必须配置应用程序的<strong class="ix hj"> Info.plist </strong>文件，在该文件中它向用户请求权限。如果没有此设置，应用程序将在构建时崩溃，并将抛出一个控制台错误，通知您Info.plist文件没有正确配置，无法继续向用户请求权限。</p><p id="da6c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">前往应用项目的项目导航器，选择<strong class="ix hj">信息列表</strong>。选择Info.plist后，您将看到一个预定义键的列表，以及与它们相关的类型和值。我们要再加一个键。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kc"><img src="../Images/8ae6475899f7b3ddacdef1e5634d207a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YPgCsHY-y2pST9TMdXrWzA.png"/></div></div></figure><p id="aecf" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">将鼠标悬停在最后一个列出的键上，并点击左侧所示的<strong class="ix hj"> + </strong>符号。这将允许您添加新密钥。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kd"><img src="../Images/2f82ad3ad302acf9165959bc9f1845c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rdnWDpTgBDyOv5gHCZbwag.png"/></div></div></figure><p id="e4a6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">开始输入<strong class="ix hj">隐私</strong>，使用时选择<strong class="ix hj">位置选项使用说明</strong>，找到后回车添加。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ke"><img src="../Images/7662a5fb75623a5891aa2075fb84b0bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*za1oRFfmVVNR-77LgHoh9Q.png"/></div></div></figure><p id="3ae3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">添加后，您将需要添加一个String类型的键，通知用户为什么需要使用他们的位置数据的权限。这就是当应用程序加载时触发位置管理器委托方法时，将弹出的UIAlert，让他们知道我们正在寻求他们的许可。作为值，我添加了<em class="jt"> OpenWeatherApp需要您的位置信息，以提供您所在位置的最准确的天气数据</em>。</p><p id="870e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">既然我们已经更新了Info.plist来请求用户的位置数据权限，那么让我们返回到<strong class="ix hj"> ViewController.swift </strong>文件，将我们的<strong class="ix hj">checkLocationAuthorization()</strong>函数添加到适当的委托方法中，该方法触发并确定我们是否可以获取用户的位置。为此，将<strong class="ix hj">checkLocationAuthorization()</strong>函数添加到<strong class="ix hj">locationmanagerdichangeauthorization(_ manager:)</strong>方法中。</p><p id="fb47" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在构建和运行我们的应用程序之前，我们需要配置<strong class="ix hj"> getUserCoordinates() </strong>函数，以确保我们有权访问用户的位置，并将他们的坐标打印到调试控制台。记住，该功能是在<strong class="ix hj">时触发的。授权状态</strong>为<strong class="ix hj">。授权时间使用</strong>。这很容易设置和构造，允许我们在确认我们确实有用户的GPS坐标后，触发从OpenWeatherMap端点获取天气数据的网络请求:</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="kf jz l"/></div></figure><p id="c80a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在上面的函数中，您可以发现在调用网络请求并完成从API端点下载数据之后，我们可以在主线程中的何处更新UI。</p><p id="6349" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在是关键时刻了，看看我们是否能够<strong class="ix hj"> 1) </strong>请求用户允许获取他们的GPS坐标并<strong class="ix hj"> 2) </strong>打印坐标。继续运行您的应用程序。</p><p id="f5a0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果一切按计划进行，您应该会看到类似下面的屏幕。使用App 选项时，可以选择<strong class="ix hj">允许。</strong></p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kg"><img src="../Images/82ba11faee92999d846c304991921476.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GB_w3p2bIzggI8z3WCHxXg.png"/></div></div></figure><p id="cb29" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">将会出现一个空白屏幕，这很好，因为我们没有添加任何UI元素，但是检查Xcode控制台。您应该会看到如下所示的纬度和经度坐标。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kh"><img src="../Images/218e44b13b1f74a5f74f4575408ce78d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2i_GuqO9zJDYuIAtCMI-Fg.png"/></div></div></figure><p id="72f6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果您希望查看您所在位置的坐标，您可以谷歌您所在城市的<em class="jt"> GPS十进制坐标</em>，并在位于<strong class="ix hj">功能&gt;位置&gt;自定义位置</strong>的模拟器位置配置中手动输入这些坐标，然后重新运行您的应用程序。对于更精确的GPS坐标，您可以在iOS设备上构建并运行您的应用程序。</p><p id="3322" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在我们已经获得了GPS坐标，是时候编写网络请求来查询OpenWeatherMap API端点了。然而，在我们将这些放在一起之前，我喜欢编写数据模型来容纳从端点查询的数据。我这样做只是因为数据模型需要在网络请求中实现。让我们从那个数据模型开始吧！</p><p id="b14b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">下面是来自OpenWeatherMap API端点的<strong class="ix hj">当前</strong>天气JSON层次的截图。您可以找到每分钟、每小时和每天的天气数据，但对于这个演示，我们将只关注当前的天气数据。如果您希望拥有其他3种天气数据类型，您可以随时修改数据模型以适应它们。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ki"><img src="../Images/1643f0a8a748afc5398d63a5fef2f079.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9LH8ixswJNlDS_m-hRNhxQ.png"/></div></div></figure><p id="0c5c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">对于这个演示，我只对终端的几个参数感兴趣。您可以容纳所有参数，但我重点关注的几个参数是<strong class="ix hj"><em class="jt">【dt】</em></strong><strong class="ix hj"><em class="jt">temp</em></strong>和<strong class="ix hj"> <em class="jt">描述</em> </strong>。Int类型的DT 是自1970年以来的秒数，所以我们稍后将创建一个函数来将其转换为更容易阅读的日期。Int类型的<em class="jt"> Temp </em>是温度，String类型的<em class="jt"> Description </em>是当天的天气情况。</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="kj jz l"/></div></figure><p id="26c0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在左边，您会发现为适应上述三个参数而编写的数据模型。第一个名为<strong class="ix hj"> WeatherData </strong>的结构是初始端点响应，您将在其中捕获当前数据。我已经创建了一个名为<em class="jt"> current </em>的current类型的变量。在此之下，我创建了另一个名为<strong class="ix hj"> Current </strong>的结构来关联上面的结构。在这个结构中，我添加了3个变量:Double类型的<strong class="ix hj"> <em class="jt"> dt </em> </strong>、Double类型的<strong class="ix hj"> <em class="jt"> temp </em> </strong>和【weather】类型的<strong class="ix hj"> <em class="jt"> weather </em> </strong>。如果你参考JSON层次结构，你会看到<strong class="ix hj">天气</strong>是一个带有嵌套参数的数组，这就是为什么<strong class="ix hj"> <em class="jt">天气</em> </strong>的类型是【天气】。我创建了另一个名为Weather的结构，其中有一个名为<strong class="ix hj"> description </strong>的String类型的变量，以适应前面结构中的[Weather]类型。<strong class="ix hj">请注意</strong>，变量名需要与API端点的参数名一对一匹配，否则在调用端点时会收到响应错误。</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="kk jz l"/></div></figure><p id="666a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在我们已经建立了模型，让我们处理查询OpenWeatherMap API端点的网络请求。创建一个名为<em class="jt"> NetworkRequest.swift </em>的新Swift文件。最初，该文件会默认导入<em class="jt">基础</em>库，但是我们需要导入<em class="jt">核心位置</em>。导入CoreLocation后，我要写两个typealias声明。我喜欢使用typealias，因为它使代码更具可读性。一会儿你就知道了:)</p><p id="ad0a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为了帮助在整个应用程序中全局重用网络请求功能，我将使用一个包含URLSession datatask的单例类结构:</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="kl jz l"/></div></figure><p id="d7f3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如您所见，fetchWeatherData函数接受CLLocationCoordinate2D类型的参数和两个完成处理程序结果onSuccess或onError。对于这两个结果，我们传入前面编写的typealias声明。</p><p id="ebd9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在我们已经设置了网络请求，让我们回到<strong class="ix hj"> ViewController.swift </strong>文件来实现这个单例函数。在文件中，找到getUserCoordinates()函数。在函数内部，我们将调用fetchWeatherData(location:)singleton函数，将<strong class="ix hj">坐标</strong>常量传入<strong class="ix hj">位置</strong>参数。突出显示OnApiSuccess代码位置标记，然后按enter键。将变量命名为<em class="jt">数据</em>。对于OnApiError code place mark，点击回车，将字符串命名为<em class="jt"> errorMessage </em>:</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="km jz l"/></div></figure><p id="3acd" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">将print语句添加到onSuccess块中，以打印出<strong class="ix hj">数据。这将把查询的数据从OpenWeatherMap API端点打印到控制台。如果有某种错误，向onError块添加一个print语句来打印错误消息。</strong></p><p id="c7da" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">构建并运行应用程序。您应该可以在控制台上看到当前的天气数据。请注意，控制台中的结果值会有所不同，因为天气条件可能与我的不同；只要你看到印有数值的<strong class="ix hj"> dt </strong>、<strong class="ix hj"> temp </strong>和<strong class="ix hj"> description </strong>，你就处于良好状态:</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kn"><img src="../Images/ce7f68c5befb8fcf0246eb7015d13616.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i5efvHkQJmwgqxWGBH0c5w.png"/></div></div></figure><p id="56e5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在我们已经打印了数据，让我们将三个端点参数中的每一个参数分配给我们可以轻松使用的属性:</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="ko jz l"/></div></figure><p id="fd5d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我创建了三个属性:date、temp和weatherCondition(字符串类型)。将<em class="jt"> data.current.dt </em>赋值给<strong class="ix hj"> <em class="jt"> date </em> </strong>和<em class="jt"> date.current.temp </em>赋值给<strong class="ix hj"> <em class="jt"> temp </em> </strong>。因为当涉及到天气描述时，我们正在处理数组中的嵌套数据，所以我们需要为 循环配置一个<strong class="ix hj"> <em class="jt">来访问描述参数，并将值赋给<strong class="ix hj"> weatherCondition </strong>变量。在<strong class="ix hj"> <em class="jt"> for </em> </strong>循环块后，添加以下打印语句:<strong class="ix hj"> <em class="jt"> print("天气\(日期)将有一个温度为\(temp) F的条件为\(weatherCondition！。大写))</em> </strong>。构建并运行您的应用程序。您应该会看到与以下打印语句类似的格式副本:</em></strong></p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kp"><img src="../Images/6ec7a9f839e70e031a2f14b036414699.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wUGKDqPXCjaBb9Qz7Wf96A.png"/></div></div></figure><p id="77da" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，有一点很明显，dt的值没有被正确地格式化为人类可读的日期。我们希望看到有日期的一周中的某一天。所以让我们继续努力:</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="kq jz l"/></div></figure><p id="582c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">从上面可以看到，我创建了一个名为current date from(UNIX date:Double？)接收一个类型Double值并返回一个可读的日期。然而，这个日期的问题是它太专业了。它将输出类似<strong class="ix hj"><em class="jt">2021–06–10 23:46:19+0000</em></strong>的日期和时间。我们希望能够显示星期几。这就是ViewController类之外的日期扩展的用武之地。这有助于我们定制一个更加格式化的日期和日子，在用户界面上看起来更整洁。结果将类似于<strong class="ix hj"><em class="jt">2021年6月10日星期四</em> </strong>。<strong class="ix hj"> </strong>如果你好奇还能返回什么其他日期格式，请看我一直引用的这个Stack Overflow <a class="ae iu" href="https://stackoverflow.com/a/52297497/12773302" rel="noopener ugc nofollow" target="_blank"> post </a>。</p><p id="452f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们回到getUserCoordinates()函数内部，修改声明的<strong class="ix hj"> <em class="jt">日期</em> </strong>常量。目前配置为:<br/>T5】let date = data . current . dt。<br/>让我们使用新的currentDateFrom(unixDate:) func并键入Date dayAndDate()函数。将声明修改为:<br/><em class="jt">let date = self . current date from(UNIX date:data . current . dt)？。dayAndDate()。</em>我们现在做的是将Double类型的data.current.dt的值作为参数传入<em class="jt">current date from(UNIX date:)</em>函数，它返回可读的日期和时间。不止于此…现在我们追加了日期类型<em class="jt"> dayAndDate() </em>函数，它将结果自定义为星期几和日期(月、日、年)格式。现在，修改后的NetworkRequest函数应该如下所示:</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="kf jz l"/></div></figure><p id="d5f3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">构建并运行您的应用程序，您应该会在控制台上看到以下内容:</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kr"><img src="../Images/97b96a05f2655920ae46447e0fcb7e75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Asr4jN-S85XXct99oNKzhQ.png"/></div></div></figure><p id="bca3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">注意日期是如何被很好地格式化的，并且在UILabel中可读性更好。</p><p id="48be" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，作为对您的一个挑战，在print语句下面，添加<em class="jt">dispatch queue . main . async {…}</em>代码块。在这个代码块中，你开始更新UI，这将是你的应用程序的主线程，你应该更新UI。</p><p id="8dd1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这将结束使用URLSession和JSONDecoder从API端点下载数据的演示，同时利用用户的GPS坐标。如果你遇到困难或碰壁，请随时联系我。感谢阅读！</p><p id="6ff9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">编码快乐！</p></div></div>    
</body>
</html>