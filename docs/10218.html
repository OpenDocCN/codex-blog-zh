<html>
<head>
<title>Android: Tackling Application Not Responding(ANRs)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Android:处理应用程序不响应(ANRs)</h1>
<blockquote>原文：<a href="https://medium.com/codex/android-tackling-application-not-responding-anrs-3c91360cd023?source=collection_archive---------4-----------------------#2022-12-13">https://medium.com/codex/android-tackling-application-not-responding-anrs-3c91360cd023?source=collection_archive---------4-----------------------#2022-12-13</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/fb98bca482c5b8bc9fc767c6ebbf8a5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*EcVahNG1a7VpBDzq"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">斯蒂芬·道森在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="3177" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">ANR，代表“应用程序没有响应”，是一种当Android应用程序长时间没有响应时发生的错误。如果应用程序正在主线程上执行长时间运行的操作，如复杂的计算或网络操作，并且无法及时响应用户输入或其他事件，就会发生这种情况。</p><p id="ef6c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">崩溃与ANR的不同之处在于，崩溃是一种代码异常，而ANR是一种持续的无响应状态。因此，当崩溃发生时，应用程序本身就会终止。当ANR发生时，用户无法在应用中做任何事情，被迫退出，或者Android系统向用户显示错误信息，如果问题没有解决，应用可能会被杀死。</p></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><p id="1938" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">anr是Android用户感到沮丧的一个常见原因，导致负面的应用评论和评级。此外，在这些方面表现不佳会直接影响你的排名和被发现的机会。这将使你的应用在搜索结果中的位置处于危险之中，并影响其被展示的资格。</p><p id="16a6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">一个应用程序的ANR门槛是在每天至少<strong class="ix hj"> 0.47% </strong>的时段中展示至少一个ANR。如果你想在Google Play上最大化你的标题的可见性，保持在这些阈值以下是至关重要的。此外，如果您的游戏在某个特定手机型号的任何重要核心上超过了设备不良行为阈值，Google Play可能会降低其在该手机型号上的用户可见性。阅读更多关于提高Google Play技术质量标准的信息。</p></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><h1 id="43c5" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">预防</h1><p id="4a2a" class="pw-post-body-paragraph iv iw hi ix b iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo lc jq jr js hb bi translated">根据这些信息，他们观察并检测了相当多的用例，这些用例主要是对ANRs有贡献的。为了避免ANR错误，开发人员应该始终远离这些危险的实践。</p><ul class=""><li id="2807" class="ld le hi ix b iy iz jc jd jg lf jk lg jo lh js li lj lk ll bi translated"><strong class="ix hj">在主线程上执行长时间运行的操作</strong>:如果您的应用正在主线程上执行长时间运行的操作，例如复杂的计算或网络操作，它可能会变得无响应并触发ANR错误。</li><li id="f0c1" class="ld le hi ix b iy lm jc ln jg lo jk lp jo lq js li lj lk ll bi translated"><strong class="ix hj">设计糟糕的用户界面</strong>:如果你的应用程序有一个设计糟糕的用户界面，它更有可能触发ANR错误。例如，如果你的应用程序有很多按钮或其他控件密集在一起，用户可能很难与你的应用程序交互，他们可能会意外触发ANR错误。</li><li id="3e54" class="ld le hi ix b iy lm jc ln jg lo jk lp jo lq js li lj lk ll bi translated"><strong class="ix hj">输入调度超时:</strong>如果你的应用在5秒内没有响应输入事件(如按键或触摸屏幕)。</li><li id="3117" class="ld le hi ix b iy lm jc ln jg lo jk lp jo lq js li lj lk ll bi translated"><strong class="ix hj">执行服务:</strong>如果你的app声明的某个服务无法在几秒钟内执行完<code class="du lr ls lt lu b">Service.onCreate()</code>和<code class="du lr ls lt lu b">Service.onStartCommand()</code> / <code class="du lr ls lt lu b">Service.onBind()</code>。</li><li id="3704" class="ld le hi ix b iy lm jc ln jg lo jk lp jo lq js li lj lk ll bi translated"><strong class="ix hj"> Service.startForeground()未被调用:</strong>如果你的app使用<code class="du lr ls lt lu b">Context.startForegroundService()</code>在前台启动一个新的服务，但是该服务在5秒内没有调用<code class="du lr ls lt lu b">startForeground()</code>。</li><li id="2389" class="ld le hi ix b iy lm jc ln jg lo jk lp jo lq js li lj lk ll bi translated"><strong class="ix hj">意图广播:</strong>如果a <code class="du lr ls lt lu b"><a class="ae iu" href="https://developer.android.com/reference/android/content/BroadcastReceiver" rel="noopener ugc nofollow" target="_blank">BroadcastReceiver</a></code>没有在设定的时间内完成执行。如果应用程序在前台有任何活动，超时时间为5秒。</li></ul></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><h1 id="fb8e" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">侦查</h1><p id="6ea5" class="pw-post-body-paragraph iv iw hi ix b iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo lc jq jr js hb bi translated">找到ANRs是解决它们的最大障碍。因为他们不能考虑用户遇到的所有因素，所以开发人员在测试中不能捕捉所有的anr。此外，anr不仅仅是软件故障，不可能从系统中完全消除它们。现实是，开发人员必须不断地在提高应用速度和节约系统资源之间取得平衡。此外，由于有如此多的不同设备具有不同的规格和性能，开发人员很难为每一个可能的用例重新创建它们。旧设备上的硬件限制可能会导致大量无效的UI更新速度变慢。因此，需要使用工具或库来帮助开发人员找出anr。以下是免费提供的工具，可能有助于减少ANRs事件。</p><p id="caa3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">Firebase crash lytics</strong><br/>crash lytics现在开始从Android 11+设备收集ANRs事件。如果开发人员希望深入研究Firebase Crashlytic kits收集的ANRs事件，他们可以将事件类型过滤到ANRs。从仪表板附加ANR事件的示例日志。这可能有助于开发人员寻找根本原因。</p><figure class="lw lx ly lz fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lv"><img src="../Images/ec35c51b79720bc5eaa75e841e68389b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FI6zdiR4o6HvGsOtA4FLtg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">ANR火箭发动机预演</figcaption></figure><p id="1e2d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj"> Google Play主机<br/> </strong>相比Firebase，Google Play主机更强调受影响的设备。尽管为开发者提供了堆栈跟踪行，但我确实发现firebase one在调试方面更有用。选项现在位于<strong class="ix hj">质量</strong>部分下，<strong class="ix hj"> Android生命体征</strong> &gt; <strong class="ix hj">崩溃和来自<strong class="ix hj"> Google Play控制台仪表板的ANRs </strong>。</strong></p><figure class="lw lx ly lz fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ma"><img src="../Images/1da7608a8726e9b80c4c8df43b76fda4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*frvdtDGbpBaMUMADho3SWw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">Google Play控制台预览</figcaption></figure><p id="f381" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj"> ANR看门狗<br/> </strong>这是一个来自<a class="ae iu" href="https://github.com/SalomonBrys" rel="noopener ugc nofollow" target="_blank">萨洛蒙布里斯</a>的不可思议的图书馆。请务必查看Github的这个库的实现细节以及它是如何工作的。基本上，这个库调度一个简单的thread/ runnable尽快在UI线程上运行，它带有5秒的超时间隔(因为这是ANR超时间隔)。如果runnable在这5秒内已经运行，它将重复调度一个新的runnable，否则它将引发一个错误，所有正在运行的线程都将被跟踪。开发人员可以将其与Firebase Crashlytics或其他首选分析SDK集成，以设置报告通道。</p></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><p id="f21f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">希望上述解释能为理解ANRs事件并解决它们提供更多见解，从而提高您的应用程序可用性以及提升Play Store排名和可见性。附上以下参考:</p><div class="mb mc ez fb md me"><a href="https://developer.android.com/topic/performance/vitals/anr" rel="noopener  ugc nofollow" target="_blank"><div class="mf ab dw"><div class="mg ab mh cl cj mi"><h2 class="bd hj fi z dy mj ea eb mk ed ef hh bi translated">安卓开发者</h2><div class="ml l"><h3 class="bd b fi z dy mj ea eb mk ed ef dx translated">当一个Android应用程序的UI线程被阻塞太久，就会触发“应用程序没有响应”(ANR)错误…</h3></div><div class="mm l"><p class="bd b fp z dy mj ea eb mk ed ef dx translated">developer.android.com</p></div></div><div class="mn l"><div class="mo l mp mq mr mn ms io me"/></div></div></a></div><div class="mb mc ez fb md me"><a href="https://support.google.com/googleplay/android-developer/answer/9844486" rel="noopener  ugc nofollow" target="_blank"><div class="mf ab dw"><div class="mg ab mh cl cj mi"><h2 class="bd hj fi z dy mj ea eb mk ed ef hh bi translated">使用Android vitals监控应用的技术质量</h2><div class="ml l"><h3 class="bd b fi z dy mj ea eb mk ed ef dx translated">为了让开发者了解他们的游戏给用户带来的流畅感，我们增加了一个新的Android vitals…</h3></div><div class="mm l"><p class="bd b fp z dy mj ea eb mk ed ef dx translated">support.google.com</p></div></div><div class="mn l"><div class="mt l mp mq mr mn ms io me"/></div></div></a></div><div class="mb mc ez fb md me"><a href="https://firebase.google.com/docs/crashlytics/debug-anr-errors" rel="noopener  ugc nofollow" target="_blank"><div class="mf ab dw"><div class="mg ab mh cl cj mi"><h2 class="bd hj fi z dy mj ea eb mk ed ef hh bi translated">根据Crashlytics仪表盘| Firebase Crashlytics中的ANR标签调试您的Android应用程序</h2><div class="ml l"><h3 class="bd b fi z dy mj ea eb mk ed ef dx translated">应用程序不响应(ANR)错误是在应用程序的UI线程没有响应更多…</h3></div><div class="mm l"><p class="bd b fp z dy mj ea eb mk ed ef dx translated">firebase.google.com</p></div></div></div></a></div><div class="mb mc ez fb md me"><a href="https://github.com/SalomonBrys/ANR-WatchDog" rel="noopener  ugc nofollow" target="_blank"><div class="mf ab dw"><div class="mg ab mh cl cj mi"><h2 class="bd hj fi z dy mj ea eb mk ed ef hh bi translated">GitHub-Salomon brys/ANR-WatchDog:一个简单的看门狗，检测Android ANR(应用程序不…</h2><div class="ml l"><h3 class="bd b fi z dy mj ea eb mk ed ef dx translated">一个简单的看门狗检测Android ANRs(应用程序不响应)。目前没有办法让一个机器人…</h3></div><div class="mm l"><p class="bd b fp z dy mj ea eb mk ed ef dx translated">github.com</p></div></div><div class="mn l"><div class="mu l mp mq mr mn ms io me"/></div></div></a></div></div></div>    
</body>
</html>