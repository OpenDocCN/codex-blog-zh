<html>
<head>
<title>Undo your breakfast (Meet Git #8)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">撤销你的早餐(见Git #8)</h1>
<blockquote>原文：<a href="https://medium.com/codex/undo-your-breakfast-meet-git-8-433a1c6cb1e1?source=collection_archive---------7-----------------------#2022-12-29">https://medium.com/codex/undo-your-breakfast-meet-git-8-433a1c6cb1e1?source=collection_archive---------7-----------------------#2022-12-29</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="fbf3" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">如何恢复Git中的更改</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/43de3b31f91cc74713f0228d5292bea1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*2ZXNxIyiWeoA3FfP"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">照片由<a class="ae jn" href="https://unsplash.com/@jannerboy62?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">尼克·费因斯</a>在<a class="ae jn" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</figcaption></figure><h1 id="c2e7" class="jo jp hi bd jq jr js jt ju jv jw jx jy io jz ip ka ir kb is kc iu kd iv ke kf bi translated">介绍</h1><p id="f3c3" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">你好，欢迎阅读致力于程序员Git基础知识(不仅仅是)系列的下一篇文章。</p><p id="5446" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">在您的工作流中利用Git，您可以安全有效地存储文件中所做的更改。然而，有时您可能会意识到您告诉Git跟踪一些事实上不应该记录的东西。</p><p id="74ec" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">幸运的是，Git提供了几种撤销历史更改的方法，每种方法都可以在不同的情况下使用，我将在本文中对此进行解释。</p><p id="8be4" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">我们开始吧！</p><h1 id="0b8c" class="jo jp hi bd jq jr js jt ju jv jw jx jy io jz ip ka ir kb is kc iu kd iv ke kf bi translated">撤销更改的可能情况</h1><p id="9a3a" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">有几个可能的原因和阶段让您想要恢复Git中的更改——考虑下面的例子:</p><ul class=""><li id="1722" class="lh li hi ki b kj lc km ld kp lj kt lk kx ll lb lm ln lo lp bi translated">如果变更尚未提交，则取消转移</li><li id="c09a" class="lh li hi ki b kj lq km lr kp ls kt lt kx lu lb lm ln lo lp bi translated">撤消已经提交的更改</li></ul><p id="de90" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">您应该已经熟悉了诸如<em class="lv">暂存区/索引</em>和<em class="lv">提交</em>等术语。如果没有，我鼓励您阅读本系列中我以前的文章。</p><h1 id="3ed7" class="jo jp hi bd jq jr js jt ju jv jw jx jy io jz ip ka ir kb is kc iu kd iv ke kf bi translated">如果更改未提交，则撤消更改</h1><p id="69fc" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">让我们想象一下这个场景:</p><blockquote class="lw lx ly"><p id="24c8" class="kg kh lv ki b kj lc ij kl km ld im ko lz le kr ks ma lf kv kw mb lg kz la lb hb bi translated">您对著名的皇家早餐进行了修改，将文件保存在您最喜欢的文本编辑器中，并且关闭了笔记本电脑，因为该睡觉了。<strong class="ki hj">你决定暂时不提交你的工作</strong>，因为你知道这只是你新想法的草稿。</p><p id="11b5" class="kg kh lv ki b kj lc ij kl km ld im ko lz le kr ks ma lf kv kw mb lg kz la lb hb bi translated">第二天，你带着新鲜的头脑醒来，你得出的结论是，新的想法是废话，最好不要改变任何东西，因为皇家早餐已经很完美了。</p><p id="00bc" class="kg kh lv ki b kj lc ij kl km ld im ko lz le kr ks ma lf kv kw mb lg kz la lb hb bi translated">原来，要恢复配方中的更改已经太晚了，因为文件已经被保存了，而且文本编辑器中的撤销操作很可能不起作用，因为您之前已经关闭了编辑器。</p></blockquote><p id="c0d2" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">哦，我说过太晚了吗？使用Git，根本不需要，只需使用<code class="du mc md me mf b">git reset</code>、<code class="du mc md me mf b">git checkout</code>，或者两者都使用，就可以将修改后的文件恢复到原始状态(上一次提交所代表的状态)。让我们看看在什么情况下哪个命令是相关的。</p><h2 id="77a0" class="mg jp hi bd jq mh mi mj ju mk ml mm jy kp mn mo ka kt mp mq kc kx mr ms ke mt bi translated">更改不是暂存的</h2><p id="435e" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">假设您尚未转移更改，您应该使用哪个命令来恢复文件？使用<code class="du mc md me mf b">git checkout -- &lt;file&gt;</code>，用最新提交的版本替换所选文件。</p><p id="ea79" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">比如我修改了保存在<code class="du mc md me mf b">royal_breakfast.txt</code>里的菜谱，所以想用<code class="du mc md me mf b">git checkout -- royal_breakfast.txt</code>。如果你想恢复当前目录(以及子目录)中所有的<em class="lv">跟踪的</em>文件，你也可以使用<code class="du mc md me mf b">git checkout -- .</code>。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mu"><img src="../Images/85b5b1eeaa9c07e58877689e53ee75f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cQWTVyK-eAaw_BUils2P2A.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">该历史包括四次提交</figcaption></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mv"><img src="../Images/b990f03fb5587e6fcf1d68b4322303f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JpVXsVlS_t775o5bMRhTlw.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">用番茄酱装饰盘子？嗯…</figcaption></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mu"><img src="../Images/0f62c37cc4fa1a16c96710f304f70613.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*32ycOirYAqJroGS-Qrb2iQ.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">配方已修改，但更改尚未进行</figcaption></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mu"><img src="../Images/6e8a622a9375b43353651348c0111173.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*77xdqkUFyxOdcwFJdgpgLw.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">使用“git checkout ”,您可以轻松地将工作目录与上次提交的目录对齐</figcaption></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mw"><img src="../Images/aa65e128b97e6f365180f6918ec91856.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4_RIeoBodwBFM1005m8pKQ.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">git结账后根本没有番茄酱</figcaption></figure><p id="330f" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">你可能想知道为什么我使用了<code class="du mc md me mf b">git checkout</code>而不是<code class="du mc md me mf b">git restore</code>，即使Git建议我在输入<code class="du mc md me mf b">git status</code>后使用<code class="du mc md me mf b">git restore</code>。好吧，Git的官方文档清楚地说明了这是一个实验性的特性，将来可能会改变。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mx"><img src="../Images/63646b651f58358b5956a3e5393eb526.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7WSOxy3KX4Y_Rq5URvI83g.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">Git中的一些命令是实验性的，比如“git restore”</figcaption></figure><h2 id="f820" class="mg jp hi bd jq mh mi mj ju mk ml mm jy kp mn mo ka kt mp mq kc kx mr ms ke mt bi translated">变化已经上演</h2><p id="874a" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">如果您已经用<code class="du mc md me mf b">git add</code>暂存了变更，但是还没有提交它们，那么与前面的场景相比，您只需要执行一个额外的步骤。</p><p id="98d4" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">首先，您需要通过使用<code class="du mc md me mf b">git reset -- &lt;file&gt;</code>从暂存区域中移除变更，在我的例子中，这将是<code class="du mc md me mf b">git reset -- royal_breakfast.txt</code>。然后，你需要执行与上一段所述相同的操作，即<code class="du mc md me mf b">git checkout -- royal_breakfast.txt</code>。</p><p id="bbc0" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">同样，尽管Git建议使用<code class="du mc md me mf b">git restore --staged</code>，但我将坚持使用老方法，除非<code class="du mc md me mf b">git restore</code>不再是实验性的。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mu"><img src="../Images/998723f27964a433c6df704a5e593375.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iHzjbwCmxW8qDOv1U0UkfA.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">番茄酱的变化这次上演了</figcaption></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mu"><img src="../Images/1edd0228d30bce4b7a0edc8a25c327f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Fpqw0jQeLiqtTii-iwBlGg.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">首先，将变更从临时区域移走</figcaption></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mu"><img src="../Images/87a7672eeadcd6fb7ae4561f9d36832b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qNLUmF1caFPkCuGfgQpKsg.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">然后，从最后一次提交中恢复您的工作目录</figcaption></figure><h1 id="e872" class="jo jp hi bd jq jr js jt ju jv jw jx jy io jz ip ka ir kb is kc iu kd iv ke kf bi translated">撤消已经提交的更改</h1><p id="cf76" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">然而，有时不需要的变更已经到达了存储库。尽管如此，Git还是提供了一些方法来处理它，所以让我们来看看。</p><h2 id="41cc" class="mg jp hi bd jq mh mi mj ju mk ml mm jy kp mn mo ka kt mp mq kc kx mr ms ke mt bi translated">如果您的错误提交应该留在历史中(git revert)</h2><p id="e761" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated"><code class="du mc md me mf b">git revert</code>命令非常有用并且简单易用。此外，这个命令提供了一个安全、干净的解决方案来恢复不需要的提交——只需键入<code class="du mc md me mf b">git revert &lt;commit_id&gt;</code>。</p><p id="faff" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">git revert有什么特别之处？它保留了错误的提交，这意味着您将得到包含两次提交的Git历史记录:错误的一次，以及恢复前一次提交的第二次。</p><p id="fe5a" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">首先，让我们创建两个提交。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mu"><img src="../Images/b7900b2844914d6064410a11590e7c64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pf3QCeJtP45w8nxlynxMBA.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">第一个变化包含番茄酱装饰</figcaption></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mu"><img src="../Images/cd79302eba7b963048da043f8b4c18ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zgcPtmnhvUVwa64bupXt2A.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">番茄酱装饰承诺</figcaption></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mu"><img src="../Images/2bd0e2be066dbf5f4b31bb6e3a12c5bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Mea-mf0_xE73cRD014c2QA.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">第二个变化包含朝鲜蓟</figcaption></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mu"><img src="../Images/a69e82224a7b46279b047b24923ee20f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O9fpCCapvCg0fgMXxluhWA.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">提交与朝鲜蓟创建</figcaption></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es my"><img src="../Images/5e994b3015f5210b48f63a07b5eaec5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8ctrW-HK3ssw300C11molg.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">最近两次提交的历史记录</figcaption></figure><p id="cf75" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">突然，您发现伴随第一次提交而来的更改不应该存储在存储库中，但是第二次提交很好，应该保持原样。也就是说，带有番茄酱装饰的提交<code class="du mc md me mf b">de2df73</code>是我们想要去掉的，而提交<code class="du mc md me mf b">ab6091f</code>应该保留。</p><p id="1062" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">对于这种场景，<code class="du mc md me mf b">git revert</code>是一个完美的解决方案。为了让事情恢复正常，我只需键入<code class="du mc md me mf b">git revert de2d</code>。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mz"><img src="../Images/b349c96a8300e0612946946263e7c12e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L7Oo0tdZETTrvcKOUA7GDQ.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">还原操作在历史记录之上引入了新的提交</figcaption></figure><p id="49a8" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">你可能会问一个问题:<strong class="ki hj"> <em class="lv">“我怎么知道我要摆脱的提交是否应该留在历史中？”</em> </strong></p><p id="b400" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">为了给一个重要的问题提供一个简单的答案，现在，假设在以下情况下，你应该选择<code class="du mc md me mf b">git revert</code>而不是其他方法:</p><ul class=""><li id="9e61" class="lh li hi ki b kj lc km ld kp lj kt lk kx ll lb lm ln lo lp bi translated">您想要撤消的更改不是当前<em class="lv">分支</em>中的最新提交，或者</li><li id="5663" class="lh li hi ki b kj lq km lr kp ls kt lt kx lu lb lm ln lo lp bi translated">提交已经被<em class="lv">推送到</em>一个远程存储库，并被其他人使用</li></ul><p id="df5c" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">如果您不知道推送是什么意思，请不要担心——这是在您使用远程存储库时使用的一个概念，目前我只使用本地存储库。</p><p id="3e80" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">如果你认为你不需要历史上的最后一个(或最后几个)提交，就选<code class="du mc md me mf b">git reset</code>，我会在下面解释。</p><h2 id="d648" class="mg jp hi bd jq mh mi mj ju mk ml mm jy kp mn mo ka kt mp mq kc kx mr ms ke mt bi translated">如果错误的提交可以从历史中删除</h2><p id="9e14" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">让我们假设Git历史中的最后三次提交将被删除。因为我一直在本地存储库上工作，所以我不会与任何人共享这些提交，所以我可以安全地删除它们。</p><p id="adb8" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">要从历史记录中删除三次提交，请使用<code class="du mc md me mf b">git reset --hard HEAD~3</code>。这个命令可以翻译成这样:</p><blockquote class="lw lx ly"><p id="d7a4" class="kg kh lv ki b kj lc ij kl km ld im ko lz le kr ks ma lf kv kw mb lg kz la lb hb bi translated">将<code class="du mc md me mf b">HEAD</code>指针向后移动三步，并从当前提交重新创建工作目录。</p></blockquote><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es na"><img src="../Images/85bbd5cef2d8b77cab7cda261e714f9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AfTIUWjH4MENbJmsgnNqdw.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">从现在开始，当前提交将是27a28ac</figcaption></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mz"><img src="../Images/95b9f21fa3c2adaa5caf9baab6d5a1b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sKkE-nDPLuNQ2g9RRwZNcg.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">在执行“git重置”之后，Git会告诉你当前的提交是什么</figcaption></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mz"><img src="../Images/5df1781c710b936b3fe1e3f8d4751abf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OLfMepU_r2iar0hlYRVbDQ.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">删除这三个提交是成功的</figcaption></figure><p id="2cd2" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">当我们使用Git时，我们总是使用引用来指向历史中的某个地方。</p><p id="e3f8" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">如果您向后移动<code class="du mc md me mf b">HEAD</code>，您将无法访问前面的历史，这意味着历史看起来好像从未包含我们的错误提交，即<code class="du mc md me mf b">de2d…</code>。</p><p id="b6a6" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">这个命令很有用，但是请确保您知道自己在做什么，否则您可能会丢失一部分历史记录。如果您想从历史中删除一个提交，但是作为一个安全网，您想将与该提交相关的更改保留在工作目录中，请使用<code class="du mc md me mf b">git reset HEAD~3</code>或<code class="du mc md me mf b">git reset --soft HEAD~3</code>。通过使用这两种方法中的任何一种，您仍然需要从工作目录中手动恢复更改。</p><p id="219a" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">当然，Git包括一个名为<code class="du mc md me mf b">git reflog</code>的安全按钮，允许您在使用<code class="du mc md me mf b">git reset --hard</code>后恢复提交，但这绝对是另一篇文章的主题。</p><h2 id="b248" class="mg jp hi bd jq mh mi mj ju mk ml mm jy kp mn mo ka kt mp mq kc kx mr ms ke mt bi translated">如果错误的提交只需要修改</h2><p id="065b" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">我经常使用的另一个超级有用的命令是<code class="du mc md me mf b">git commit --amend</code>。使用上面的命令，您可以对现有的提交进行额外的更改。</p><p id="f4d8" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">比方说，你决定在早餐中加入朝鲜蓟(我确实喜欢朝鲜蓟)。让我们向他们介绍配方，并创建一个提交。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nb"><img src="../Images/4cd4f83c5c740617ce332168e819852d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w6quGieHomvhcoDNHDnBGw.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">在食谱中加入朝鲜蓟</figcaption></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nb"><img src="../Images/3cbbc8a2f14d207d1fa7cd691b821cee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7ITQp0SJK2vXNXgOGxWlig.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">食谱中提到了朝鲜蓟</figcaption></figure><p id="d010" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">你读了这个食谱一次，两次，注意到关于朝鲜蓟的信息不是很准确。读者会知道你指的是腌洋蓟吗？他们会知道应该从盐水中取出朝鲜蓟吗？</p><p id="8c81" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">那么，让我们修改一下食谱，把这些细节包括进去。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nc"><img src="../Images/7f94ba8eba600fda0b6a51d6254158d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A5g9hiRmIylUDza8-dcLag.png"/></div></div></figure><p id="e5eb" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">通常，当变更被暂存时，您将创建一个出现在历史顶部的全新提交，如下所示。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nc"><img src="../Images/6d25aafe816d782a80a2ee687272f2f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ELauEjn2A0RUMwwlrqN6wA.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">通过引入另一个提交来修复上一个提交是可行的，但是我们可以做得更好</figcaption></figure><p id="4135" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">假设我们要修改的提交是历史上的最后一个提交，我们可以简单地编辑现有的提交，而不是创建新的提交。要做到这一点，只需输入<code class="du mc md me mf b">git commit --amend</code>，然后<strong class="ki hj"> Git会将您的更改从暂存区合并到现有的提交</strong>。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nc"><img src="../Images/0caddec5740592bb1c63e3e343e99e47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZX-Cjt5qOPgm-DUnr2Gg9A.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">确保进行修改的变更</figcaption></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nc"><img src="../Images/e9ac44ebc9d6221c7703d00abfdcb79e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oSwVV8Y_fbtm1kMUKL0SGw.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">提交修改成功</figcaption></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nc"><img src="../Images/ceccf7f9437bd8a0d7547ddc5100c411.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aIjpFHOgyE2fwyQqslp-MQ.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">修改后，提交的校验和从3353b7e更改为2129442</figcaption></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nc"><img src="../Images/77ed8b2640794efe139cd6de65e0df6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s0l6dxEAVLs2_u4RfeJxUw.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">从现在开始，一次提交包含所有必需的信息</figcaption></figure><p id="8b4a" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">但是，要注意可能已经提交的提交，因为修改后的提交的校验和已经改变，这可能会导致保持历史同步的严重问题(并且您的同事会不再喜欢您)。</p><h1 id="f0f3" class="jo jp hi bd jq jr js jt ju jv jw jx jy io jz ip ka ir kb is kc iu kd iv ke kf bi translated">额外收获:解决冲突</h1><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mu"><img src="../Images/b074399d0b75ef4d991c78f3540b9be2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Azxfyf_9Fv4K9QGIhsBA5Q.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">出现了一个必须解决的冲突</figcaption></figure><p id="5b6a" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">如果您正在恢复提交，并且看到类似这样的情况，不要惊慌。这条消息意味着我们得到了<em class="lv">一个必须<em class="lv">解决的</em>冲突</em>。我还没有向您解释什么是冲突，但简而言之，当单个文件中有相互重叠的更改时，就会发生冲突。</p><p id="accf" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">Git的好处是它不会让你陷入混乱——如果你不知道该做什么，简单地服从Git告诉你的，然后键入<code class="du mc md me mf b">git revert --abort</code>。这将把你带到冲突发生前的状态。</p><p id="ac24" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">在这种紧张的情况下，唯一剩下的就是一组你可以安全删除的文件。然而，在你这样做之前，浏览一下它们，看看这种冲突的原因是什么，这可能是有用的。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mu"><img src="../Images/666fde5eddab141139e1ad34a1620116.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9Qr5GFRdOFvUqCLPQnfmZg.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">如果发生冲突，你总是可以退后一步，仔细考虑</figcaption></figure><p id="99ad" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">因为我中止了与<code class="du mc md me mf b">git revert --abort</code>的冲突解决，让我们通过键入<code class="du mc md me mf b">git revert de2d</code>再次尝试恢复更改，并解决冲突。</p><p id="3573" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">当我打开冲突的文件时，我可以看到帮助我理解发生了什么的标记。</p><p id="d780" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">基本上，<code class="du mc md me mf b">&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD</code>和<code class="du mc md me mf b">=======</code>之间的文本导致了冲突，Git需要我的帮助来决定该怎么做。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mv"><img src="../Images/ce445c3089992373041e4f4c6c866bc1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*biIgEP9LQrxPKc8Eg7Lspw.png"/></div></div></figure><p id="334d" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">正如你所看到的，我已经在配料部分并排添加了番茄酱和朝鲜蓟，所以Git不确定要保留什么，去掉什么。我们想删除所有与番茄酱相关的内容，所以让我们稍微整理一下这个食谱。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mw"><img src="../Images/0e9b209ab45714fa891f3e0c1b91de54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*onVNXUnGmuYXOai8HPRxtA.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">解决冲突后的方法</figcaption></figure><p id="dc79" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">配方现在已经修正了——注意，我还删除了指向冲突点的标记。</p><p id="6e3b" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">一旦我编辑并保存了文件，我就可以继续使用Git Bash并完成恢复操作。要做到这一点:</p><ul class=""><li id="d0c4" class="lh li hi ki b kj lc km ld kp lj kt lk kx ll lb lm ln lo lp bi translated">将冲突的文件添加到索引中</li><li id="80fb" class="lh li hi ki b kj lq km lr kp ls kt lt kx lu lb lm ln lo lp bi translated">让Git通过键入<code class="du mc md me mf b">git revert --continue</code>继续恢复我们的更改</li></ul><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mz"><img src="../Images/81104c70cb373898e7af68fff3844028.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tUdgl0kcfUNuJ8fNDvjc0g.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">已解决的冲突仍然需要添加到索引中</figcaption></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mz"><img src="../Images/37180eef18e9869e21aeddfc064a907d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HGtWWH3HNEz7cTLhtr-C5w.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">已解决的冲突必须移动到索引/临时区域</figcaption></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mz"><img src="../Images/e263258d78566a1953b78d5e03185310.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LfQyLbldJQ1Hc_xSF-tNIw.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">所有冲突都已解决，让我们继续执行恢复操作</figcaption></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mz"><img src="../Images/b349c96a8300e0612946946263e7c12e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L7Oo0tdZETTrvcKOUA7GDQ.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">还原操作在历史记录之上引入了新的提交</figcaption></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mw"><img src="../Images/47f7af3f15037db759cae7fac5d88382.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YjNZEfqgdDhGL8OV6N-NQw.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">恢复操作成功—食谱中没有番茄酱</figcaption></figure><p id="c84f" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">总的来说，有很好的解决冲突的工具，但是出现的冲突非常简单，所以旧的记事本足以修复它。</p><h1 id="a5d5" class="jo jp hi bd jq jr js jt ju jv jw jx jy io jz ip ka ir kb is kc iu kd iv ke kf bi translated">参考</h1><p id="97e3" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">[1]王南钧·什皮查考斯基，<em class="lv">如何开始用Git做饭(遇见Git # 4)</em><a class="ae jn" rel="noopener" href="/codex/how-to-start-cooking-with-git-meet-git-4-a286e4e08109">https://medium . com/codex/How-to-start-cooking-with-Git-Meet-Git-4-a 286 e4e 08109</a></p></div></div>    
</body>
</html>