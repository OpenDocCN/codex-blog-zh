<html>
<head>
<title>Can You Refactor JavaScript Safely Without Test Coverage?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">没有测试覆盖能安全重构JavaScript吗？</h1>
<blockquote>原文：<a href="https://medium.com/codex/can-you-refactor-javascript-safely-without-test-coverage-d721917224b3?source=collection_archive---------7-----------------------#2021-10-24">https://medium.com/codex/can-you-refactor-javascript-safely-without-test-coverage-d721917224b3?source=collection_archive---------7-----------------------#2021-10-24</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/e18025b6596488ae44dd90f3bda8ce86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*1sRYBTKl5thJ2qhC.jpg"/></div></div></figure><p id="97ad" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">传统观点认为，在重构代码之前，你应该有良好的测试覆盖率。如果在测试过程中没有发现，在重构过程中犯错误会在软件中引入缺陷。这种回归缺陷会惹恼用户，破坏软件，甚至导致客户放弃产品。</p><p id="58e5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">JavaScript尤其需要自动化测试。在像JavaScript这样具有函数构造的动态语言中，静态地检测破损是很困难的。此外，JavaScript有<a class="ae jo" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Logical_AND_assignment#description" rel="noopener ugc nofollow" target="_blank">许多</a> <a class="ae jo" href="https://developer.mozilla.org/en-US/docs/Glossary/Falsy" rel="noopener ugc nofollow" target="_blank">语言</a> <a class="ae jo" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Operator_Precedence#table" rel="noopener ugc nofollow" target="_blank">细节</a>和<a class="ae jo" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Equality_comparisons_and_sameness#a_model_for_understanding_equality_comparisons" rel="noopener ugc nofollow" target="_blank">怪癖</a>，这些都不太为人所知或容易记忆。</p><p id="7439" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然而，在实践中，有可能<strong class="is hj">您会遇到需要在未测试或未充分测试的遗留代码中工作的情况</strong>。通常，这恰恰是那种可以从重构中获益的代码，它可以使代码更容易理解和扩展。但是为了测试它，我们需要使它可测试，这涉及到重构。</p><p id="9fa4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们如何解决这个问题？如果我们后退一步，自动化测试帮助我们回答的潜在问题是信心和风险的问题:</p><p id="33a5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">我有多大把握我的重构没有改变程序的行为？</strong></p><p id="4a3e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">测试帮助我们回答了这个问题，但是当测试覆盖中有缺口时，重构有可能引入错误。因此，这个问题的答案是一个程度的问题，即使有测试。</p><p id="e3d1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">另一种方法是采取一系列小步骤。如果我们确信每一步都是正确的，那么最终的结果就是正确的，因为没有一步会改变程序的行为。<strong class="is hj">理想情况下，采取小的、低风险的步骤与优秀的测试覆盖率相结合，从而产生高置信度。</strong></p><p id="94b5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然而，显著的变化、更复杂的编程语言(如JavaScript)和复杂的遗留代码库导致了单个步骤引入缺陷的高风险。特别是，跨越模块或服务边界的重构、大规模的重命名(不是每个符号都出现)或者大量的手动更改往往容易出错。</p><p id="9dd9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">但是<strong class="is hj">对于单个函数、类或模块，可以将自动重构的序列链接在一起，以实现更广泛的重构</strong>。然而，大多数重构工具确保重构机制被正确执行，但是它们不会告诉你对代码的影响。</p><p id="9bb4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我想要一个重构工具，它内置了许多难以记忆的JavaScript细节，可以分析相关代码来评估重构的安全性。考虑到这一点，我为Visual Studio代码 创建了<a class="ae jo" href="https://marketplace.visualstudio.com/items?itemName=p42ai.refactor" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj"> P42 JavaScript助手。如果可能的话，P42会评估重构对逻辑和代码流的影响(不包括性能)，并通知您它是否安全，或者是否需要检查特定的细节。</strong></a></p><p id="d0c6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这里有一个P42如何表明小的重构步骤的安全性的例子:</p><figure class="jq jr js jt fd ij er es paragraph-image"><div class="er es jp"><img src="../Images/504c2afb4e2db1eb06ba05803ba2d8ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OJcnAJchWxzgFFaO.gif"/></div><figcaption class="ju jv et er es jw jx bd b be z dx translated">p42 VS代码的JavaScript助手</figcaption></figure><p id="e765" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">使用像P42这样的自动重构工具，将相关源代码的静态分析与编程语言的广泛知识结合起来，可以更安全地重构代码。<strong class="is hj">结合自动化测试和类型检查工具，如</strong><a class="ae jo" href="https://www.typescriptlang.org/" rel="noopener ugc nofollow" target="_blank"><strong class="is hj">TypeScript</strong></a><strong class="is hj">，这使得即使在像JavaScript这样的动态语言中也可以进行高度可信的重构。</strong></p><p id="395b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">重构快乐！</p></div></div>    
</body>
</html>