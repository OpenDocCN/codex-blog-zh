<html>
<head>
<title>Do Paying Users Stay Longer?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">付费用户停留时间更长吗？</h1>
<blockquote>原文：<a href="https://medium.com/codex/do-paying-users-stay-longer-86737ead01b1?source=collection_archive---------11-----------------------#2021-09-16">https://medium.com/codex/do-paying-users-stay-longer-86737ead01b1?source=collection_archive---------11-----------------------#2021-09-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="e770" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">Spark中基于Logistic回归和随机森林的音乐流媒体客户流失预测</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/789a579cd1629ef2df5fb1fec510cf0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZiICFqczSVNRqSlTlIWA9A.jpeg"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">wayhomestudio创作的音乐照片—<a class="ae jn" href="http://www.freepik.com" rel="noopener ugc nofollow" target="_blank">www.freepik.com</a></figcaption></figure><p id="bf6b" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">你试过Spotify吗？甚至可能是Apple Music或者YouTube来听音乐？Statista声称，到2020年，Q1的音乐流媒体用户数量已经超过<a class="ae jn" href="https://www.statista.com/statistics/669113/number-music-streaming-subscribers/" rel="noopener ugc nofollow" target="_blank"> 4亿人</a>。虽然音乐流媒体是一个快速增长的市场，但我敢打赌，我一半以上的朋友和家人已经停止使用至少一个流行的平台。广告可能会在歌曲之间变得过于频繁，订阅费可能会从一年跳到另一年，或者只是个人情况可能会随着时间的推移而改变，以至于人们不再积极使用这些服务。</p><p id="6e38" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">从商业角度来看，尽可能多地留住有利客户至关重要。因此，对于企业来说，发现可能考虑离开其平台的用户(或专业术语称之为“流失”)并采取有效措施阻止这些用户离开至关重要。虽然探索哪些特定措施可能适用于哪个客户很令人兴奋，例如获得附加功能、价格折扣？—要说服她留下来，流媒体提供商必须超越的第一步是找到这些客户。数据驱动的it实践是流失预测，即预测特定用户是否容易流失。</p></div><div class="ab cl kk kl gp km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="hb hc hd he hf"><h1 id="9da7" class="kr ks hi bd kt ku kv kw kx ky kz la lb io lc ip ld ir le is lf iu lg iv lh li bi translated">目录</h1><ol class=""><li id="fb0e" class="lj lk hi jq b jr ll ju lm jx ln kb lo kf lp kj lq lr ls lt bi translated">项目动机</li><li id="ba73" class="lj lk hi jq b jr lu ju lv jx lw kb lx kf ly kj lq lr ls lt bi translated">项目阶段:(2.0)设置环境，(2.1)加载和清理数据集，(2.2)探索数据，(2.3)进一步讨论，(2.4)训练模型，(2.5)评估结果</li><li id="98af" class="lj lk hi jq b jr lu ju lv jx lw kb lx kf ly kj lq lr ls lt bi translated">结论</li><li id="dfcf" class="lj lk hi jq b jr lu ju lv jx lw kb lx kf ly kj lq lr ls lt bi translated">为了进一步改进</li><li id="eb18" class="lj lk hi jq b jr lu ju lv jx lw kb lx kf ly kj lq lr ls lt bi translated">一些更有用的资源</li></ol></div><div class="ab cl kk kl gp km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="hb hc hd he hf"><h1 id="022d" class="kr ks hi bd kt ku kv kw kx ky kz la lb io lc ip ld ir le is lf iu lg iv lh li bi translated">1.项目动机</h1><p id="bb39" class="pw-post-body-paragraph jo jp hi jq b jr ll ij jt ju lm im jw jx lz jz ka kb ma kd ke kf mb kh ki kj hb bi translated">由于其用于企业的客户相关操作，流失预测是机器学习技术在与客户有直接和重复接触的公司中最广泛的应用之一。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mc"><img src="../Images/bd6be409f4f0c8fe72ef7d5b8c9375d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZjkUrzVTUadoVKnUkPlwJQ.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">Udacity的课程视频片段。</figcaption></figure><p id="ad8f" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">Sparkify是一家虚拟的音乐流媒体服务提供商，提供免费和付费的音乐流媒体平台，具有添加朋友或对歌曲竖起大拇指等功能。Udacity提供了Sparkify客户活动的数据集，作为其nanodegree计划的一部分。尽管该公司并不真实，但从技术角度来看，可以在Sparkify数据上进行的客户分析仍然有效，并且可以很容易地适应现实生活中的企业。</p></div><div class="ab cl kk kl gp km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="hb hc hd he hf"><h1 id="ce40" class="kr ks hi bd kt ku kv kw kx ky kz la lb io lc ip ld ir le is lf iu lg iv lh li bi translated">2.项目阶段</h1><h2 id="f83f" class="md ks hi bd kt me mf mg kx mh mi mj lb jx mk ml ld kb mm mn lf kf mo mp lh mq bi translated">2.0.设置环境—创建Spark会话</h2><p id="6549" class="pw-post-body-paragraph jo jp hi jq b jr ll ij jt ju lm im jw jx lz jz ka kb ma kd ke kf mb kh ki kj hb bi translated">虽然所选的数据子集不需要大数据处理，但我在Spark中进行了数据辩论，以便能够在稍后对完整的12GB数据集进行分析时重用我的代码。那将需要比我的本地电脑更多的计算能力和更大的内存。所以云计算将是合乎逻辑的下一步。然而，由于时间和预算的限制，它不得不暂时留在范围之外。</p><p id="d08f" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我建立了一个SparkContext作为到我的集群的连接，并创建了一个SparkSession作为该连接的接口。这些步骤是在py Spark shell中执行的，该shell允许我在利用一些python功能的同时与Spark数据结构进行交互。</p><p id="00d3" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">为了设置SparkSession和进行进一步的分析，我导入了以下python包。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mr ms l"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">导入的库</figcaption></figure><p id="3fc6" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">正如pyspark.ml导入所显示的，我对spark数据帧使用了Spark ML库，尽管Spark MLlib也可以在rdd上使用。</p></div><div class="ab cl kk kl gp km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="hb hc hd he hf"><h2 id="26b6" class="md ks hi bd kt me mf mg kx mh mi mj lb jx mk ml ld kb mm mn lf kf mo mp lh mq bi translated">2.1.加载并清理数据集</h2><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mt"><img src="../Images/416ee22878703fb3d06f352847023d48.png" data-original-src="https://miro.medium.com/v2/resize:fit:750/format:webp/1*fbHR2BVtswux15ZL-5BZuQ.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">数据集中的要素(按printSchema)</figcaption></figure><p id="b156" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">对于当前的项目，我使用了12GB完整数据集的128MB子集。数据集包含关于用户的音乐收听事件的记录。数据集中有<strong class="jq hj"> 286，500条记录</strong>和<strong class="jq hj"> 18个不同的属性</strong>字符串、整型(‘long’)和浮点型(‘double’表示双精度浮点型)。</p><p id="188c" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">加载后，我评估了表示为Nan或Null值的<strong class="jq hj">缺失数据</strong>。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mr ms l"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">检查nan和null值的脚本</figcaption></figure><p id="d2cd" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">关于Nan和空值的调查结果:</p><ul class=""><li id="aa20" class="lj lk hi jq b jr js ju jv jx mu kb mv kf mw kj mx lr ls lt bi translated">数据集中没有Nan(缺失)值。</li><li id="e144" class="lj lk hi jq b jr lu ju lv jx lw kb lx kf ly kj mx lr ls lt bi translated">在<code class="du my mz na nb b">userId</code>和<code class="du my mz na nb b">sessionId</code>列中没有空值。</li><li id="b4ac" class="lj lk hi jq b jr lu ju lv jx lw kb lx kf ly kj mx lr ls lt bi translated">9个属性至少有8，346个空值。</li><li id="1572" class="lj lk hi jq b jr lu ju lv jx lw kb lx kf ly kj mx lr ls lt bi translated">3个属性至少有58，392个空值。</li></ul><p id="3a99" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">对记录中缺失数据模式的检查显示，数据集包含三种主要类型的记录:</p><ul class=""><li id="e8f6" class="lj lk hi jq b jr js ju jv jx mu kb mv kf mw kj mx lr ls lt bi translated">音乐收听事件—80%的记录包含<code class="du my mz na nb b">artist</code>、<code class="du my mz na nb b">length</code>和<code class="du my mz na nb b">song</code>的值。这些可能描述音乐收听事件。</li><li id="00cc" class="lj lk hi jq b jr lu ju lv jx lw kb lx kf ly kj mx lr ls lt bi translated">有些事件(20%)不包含音乐收听数据，这些事件可能是管理性质的，例如升级/降级/取消和注册。</li><li id="3cd2" class="lj lk hi jq b jr lu ju lv jx lw kb lx kf ly kj mx lr ls lt bi translated">有一些事件(占总事件量的3%)只包含<code class="du my mz na nb b">auth</code>(如取消、注销)、<code class="du my mz na nb b">itemInSession</code>、<code class="du my mz na nb b">level</code>(如免费或付费)、<code class="du my mz na nb b">method</code>(如get或put)、<code class="du my mz na nb b">page</code>(如About / Upgrade)、状态(可能是HTTP状态码)数据，超出了<code class="du my mz na nb b">userId</code>、<code class="du my mz na nb b">sessionId</code>、<code class="du my mz na nb b">ts</code>(时间戳)。这些可能是除注册之外的所有管理会话。</li></ul><p id="bb5d" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我还检查了只包含<strong class="jq hj">“空白”值</strong>的记录。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mr ms l"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">检查空白("")值的脚本</figcaption></figure><p id="062f" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">只有列<code class="du my mz na nb b">userId</code>包含空白值。检查了这些记录的分类变量的唯一值后，发现空白<code class="du my mz na nb b">userId</code>通常属于以下类型:</p><ul class=""><li id="25d8" class="lj lk hi jq b jr js ju jv jx mu kb mv kf mw kj mx lr ls lt bi translated"><code class="du my mz na nb b">auth</code>:注销，访客</li><li id="3ab3" class="lj lk hi jq b jr lu ju lv jx lw kb lx kf ly kj mx lr ls lt bi translated"><code class="du my mz na nb b">level</code>:付费和免费都出现在值中</li><li id="9a18" class="lj lk hi jq b jr lu ju lv jx lw kb lx kf ly kj mx lr ls lt bi translated"><code class="du my mz na nb b">method</code>:GET和PUT都出现在值中(后者通常使用<code class="du my mz na nb b">page</code>登录)</li><li id="8650" class="lj lk hi jq b jr lu ju lv jx lw kb lx kf ly kj mx lr ls lt bi translated"><code class="du my mz na nb b">page</code>:帮助、主页、关于、登录、提交注册、注册和错误</li></ul><p id="e5d7" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">上述值描述的事件可能与站点上的访客视图、注册和登录有关。在没有<code class="du my mz na nb b">userID</code>的情况下，这些记录不能增加对用户行为(如流失)的理解，也不能为分析提供额外的价值，因此我最终放弃了这些记录。</p><p id="3579" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我还检查了<strong class="jq hj">重复记录</strong>，但是数据集中没有重复记录(参见下面文章中的方法)。</p><div class="nc nd ez fb ne nf"><a href="https://towardsdatascience.com/distinct-vs-dropduplicates-in-spark-3e28af1f793c" rel="noopener follow" target="_blank"><div class="ng ab dw"><div class="nh ab ni cl cj nj"><h2 class="bd hj fi z dy nk ea eb nl ed ef hh bi translated">Spark中的distinct()与dropDuplicates()</h2><div class="nm l"><h3 class="bd b fi z dy nk ea eb nl ed ef dx translated">Spark中distinct()和dropDuplicates()有什么区别？</h3></div><div class="nn l"><p class="bd b fp z dy nk ea eb nl ed ef dx translated">towardsdatascience.com</p></div></div><div class="no l"><div class="np l nq nr ns no nt jh nf"/></div></div></a></div></div><div class="ab cl kk kl gp km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="hb hc hd he hf"><h2 id="78dc" class="md ks hi bd kt me mf mg kx mh mi mj lb jx mk ml ld kb mm mn lf kf mo mp lh mq bi translated">2.2.探索数据-描述性分析</h2><p id="0260" class="pw-post-body-paragraph jo jp hi jq b jr ll ij jt ju lm im jw jx lz jz ka kb ma kd ke kf mb kh ki kj hb bi translated">我将“客户流失”定义为当用户到达“取消确认”页面时的事件。</p><p id="a761" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">然后，我为在其整个生命周期中到达该特定页面的用户创建了一个流失标签(至少在该数据集中表示的部分)。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mr ms l"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">为用户分配流失标签的脚本</figcaption></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es nu"><img src="../Images/9ab0941414fef55add69ebd139c2f925.png" data-original-src="https://miro.medium.com/v2/resize:fit:686/format:webp/1*fuz257hJsacLLeJwGL8AEw.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">图表1:流失比例</figcaption></figure><p id="a6d9" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">流失的比例在数据集中约为23%。由于要准备的模型中的标签(<code class="du my mz na nb b">churnerUser</code>)是不平衡的，F1分数将作为比准确性更好的模型评估指标。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es nv"><img src="../Images/1484a670210bc70657893863d2890e4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:774/format:webp/1*3e6Hvy1dMBXDlfoGLFYfHQ.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">图表2:按性别分列的流失比例</figcaption></figure><p id="cba2" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">就性别而言，样本中男性比女性多16%,男性的流失率比女性高。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es nw"><img src="../Images/38ffed506044581a07d20342b9dbcd54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1140/format:webp/1*Gz_vs8Op8FlcBo4051-kVg.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">图表3:尝试过付费级别的客户流失比例</figcaption></figure><p id="578e" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">关于服务水平(免费或付费)，大多数用户都尝试过Sparkify的付费版本。他们的流失率(21.8%)略低于那些只尝试过免费版本的人(26.7%)。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nx"><img src="../Images/e9fe18101bf8a895ba4f6c6a7f6ba30a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nPVPHfPCPpcNVN104BwTJQ.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">图表4:按所用设备类型划分的客户流失比例</figcaption></figure><p id="a4af" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">关于设备，根据每个事件检索的用户代理信息以及在设备和用户级别汇总的信息，93%的用户在桌面上使用Sparkify(基于操作系统)。不过，在Windows或Mac OS上使用Sparkify的用户的流失率(21-22%)略低于在Linux上使用Sparkify的用户(41%)。如果样本量不那么小，人们可以得出这样的结论</p><ul class=""><li id="4d68" class="lj lk hi jq b jr js ju jv jx mu kb mv kf mw kj mx lr ls lt bi translated">要么是为Linux定制的Sparkify应用程序(假设Sparkify不仅仅是一个web应用程序)比Windows/Mac OS的应用程序更糟糕</li><li id="b752" class="lj lk hi jq b jr lu ju lv jx lw kb lx kf ly kj mx lr ls lt bi translated">或者使用Linux设备的用户有着显著不同的需求或习惯，因此他们更容易流失。</li></ul><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ny"><img src="../Images/e536d115caf5f8201a748fddd1d26718.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AGBijK3QXa9XQW-6aDZzqQ.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">图表5:按区域划分的用户，按流失行为区分颜色(前15个区域)</figcaption></figure><p id="2fe9" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">该数据集对用户的位置进行了分类，分为居住层和更聚合的层，包括美国各州和大都市地区。考虑到样本的小规模，我只应用了更多的汇总水平进行分析。可以观察到，大多数Sparkify用户位于人口最多的州/大都市地区，例如加利福尼亚州、德克萨斯州、纽约市和费城大都市地区。这些地区的用户流失比例差异很大(从0%到60%)，但这些差异可能仅仅是由于抽样，而不是来自不同地区的用户之间的潜在差异。</p></div><div class="ab cl kk kl gp km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="hb hc hd he hf"><h2 id="a0fc" class="md ks hi bd kt me mf mg kx mh mi mj lb jx mk ml ld kb mm mn lf kf mo mp lh mq bi translated">2.3.进一步争论—特征工程</h2><p id="1986" class="pw-post-body-paragraph jo jp hi jq b jr ll ij jt ju lm im jw jx lz jz ka kb ma kd ke kf mb kh ki kj hb bi translated">目标变量(“churnerUser”)指示客户是否已经离开虚构的流媒体公司“Sparkify”。它是一个虚拟的，即有两种状态:1(客户已经搅拌)和0(客户没有搅拌)。因此，流失预测问题具有二元分类的性质。</p><p id="e07b" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我应用了进一步的转换，例如从分类变量中创建虚拟变量，从每个分类值中删除一个，计算某些音乐收听事件值，计算事件和会话长度的最小值、最大值和平均值，以及计算用户访问特定页面的比例(与其所有页面访问相比)。</p><p id="0a69" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">用户级Spark数据帧由225行和63列组成。这些栏目涵盖以下领域:</p><ul class=""><li id="dcc4" class="lj lk hi jq b jr js ju jv jx mu kb mv kf mw kj mx lr ls lt bi translated">“churnerUser”:建模部分的未来标签，显示用户在可观察的时间段内是否搅拌了Sparkify</li><li id="2acc" class="lj lk hi jq b jr lu ju lv jx lw kb lx kf ly kj mx lr ls lt bi translated">“gender_F”:声明用户是否为女性的假人</li><li id="bd06" class="lj lk hi jq b jr lu ju lv jx lw kb lx kf ly kj mx lr ls lt bi translated">“tried _ paid”:一个虚拟用户，用于查看用户是否尝试过付费级别(假设有更好的应用程序功能)</li><li id="97c5" class="lj lk hi jq b jr lu ju lv jx lw kb lx kf ly kj mx lr ls lt bi translated">虚拟设备:用户是否使用过特定的设备类型(Windows、Mac或Linux、iPhone、iPad或Android)</li><li id="c0ed" class="lj lk hi jq b jr lu ju lv jx lw kb lx kf ly kj mx lr ls lt bi translated">区域假人:用户是否位于前20个区域之一(每个区域一个假人)</li><li id="1617" class="lj lk hi jq b jr lu ju lv jx lw kb lx kf ly kj mx lr ls lt bi translated">注册和最后事件的时间戳以及成员资格的天数</li><li id="78ef" class="lj lk hi jq b jr lu ju lv jx lw kb lx kf ly kj mx lr ls lt bi translated">对话计数</li><li id="ef7b" class="lj lk hi jq b jr lu ju lv jx lw kb lx kf ly kj mx lr ls lt bi translated">“visit _ frequency”:spark ify会员的单位时长会话数(以天计)</li><li id="1871" class="lj lk hi jq b jr lu ju lv jx lw kb lx kf ly kj mx lr ls lt bi translated">“最大间隔天数”:两次后续就诊日期之间的最大间隔</li><li id="e6ae" class="lj lk hi jq b jr lu ju lv jx lw kb lx kf ly kj mx lr ls lt bi translated">艺术家和歌曲计数和独特计数</li><li id="d55b" class="lj lk hi jq b jr lu ju lv jx lw kb lx kf ly kj mx lr ls lt bi translated">每次会话的音乐项目(歌曲)(最小值、最大值、平均值)</li><li id="62ca" class="lj lk hi jq b jr lu ju lv jx lw kb lx kf ly kj mx lr ls lt bi translated">音乐收听事件和会话的长度(最小、最大、平均)</li><li id="b25e" class="lj lk hi jq b jr lu ju lv jx lw kb lx kf ly kj mx lr ls lt bi translated">所有页面访问中访问特定页面的比例(每页，除了“取消确认”和“取消”)</li></ul></div><div class="ab cl kk kl gp km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="hb hc hd he hf"><h2 id="9dbc" class="md ks hi bd kt me mf mg kx mh mi mj lb jx mk ml ld kb mm mn lf kf mo mp lh mq bi translated">2.4.训练模型—预测建模</h2><p id="a126" class="pw-post-body-paragraph jo jp hi jq b jr ll ij jt ju lm im jw jx lz jz ka kb ma kd ke kf mb kh ki kj hb bi translated">虽然Scikit-learn在单机上处理小型或中型数据集时表现良好，但Spark的机器学习库(如<strong class="jq hj"> pyspark.ml </strong>模块)可以支持大型数据集所需的并行计算。尽管当前使用的128 MB数据集不需要并行计算，也没有为当前Spark上下文设置多个节点，但下面的代码也适用于大型数据集和并行计算。</p><p id="d08d" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">建模需要进一步的数据转换:</p><ul class=""><li id="fb3e" class="lj lk hi jq b jr js ju jv jx mu kb mv kf mw kj mx lr ls lt bi translated">删除不必要的ID</li><li id="8c70" class="lj lk hi jq b jr lu ju lv jx lw kb lx kf ly kj mx lr ls lt bi translated">向量化</li><li id="8344" class="lj lk hi jq b jr lu ju lv jx lw kb lx kf ly kj mx lr ls lt bi translated">规模</li><li id="5ba0" class="lj lk hi jq b jr lu ju lv jx lw kb lx kf ly kj mx lr ls lt bi translated">拆分为训练集和测试集</li></ul><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mr ms l"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">为建模而进行的数据转换</figcaption></figure><p id="f5aa" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">选定型号:</p><ul class=""><li id="4953" class="lj lk hi jq b jr js ju jv jx mu kb mv kf mw kj mx lr ls lt bi translated">逻辑回归</li><li id="6c3c" class="lj lk hi jq b jr lu ju lv jx lw kb lx kf ly kj mx lr ls lt bi translated">随机森林分类</li></ul><p id="9257" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">随机森林应用了两次。在第二次试验中，我增加了预期的最小叶子大小，以查看模型的不良性能是否仅仅是由于过度拟合。</p><p id="bad0" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">最后，我用网格搜索和交叉验证对模型进行了调优，以潜在地提高它们的性能——尽管模型改进对于如此小规模的数据集有其局限性。</p></div><div class="ab cl kk kl gp km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="hb hc hd he hf"><h2 id="cc01" class="md ks hi bd kt me mf mg kx mh mi mj lb jx mk ml ld kb mm mn lf kf mo mp lh mq bi translated">2.5.评估结果—确定最佳模型</h2><p id="f75b" class="pw-post-body-paragraph jo jp hi jq b jr ll ij jt ju lm im jw jx lz jz ka kb ma kd ke kf mb kh ki kj hb bi translated"><strong class="jq hj"> F1得分</strong>是精确度和召回率的调和平均值，因此它使我们能够同时优化模型的精确度和稳健性。而precision告诉我们被正确预测的用户比例，而chunkers回忆告诉我们成功找到真正的chunkers的比例。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es nz"><img src="../Images/5c3d2911e434ff0d769254b63a981b98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1260/format:webp/1*prl39hS9cs2HXJ_wNO6M-A.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">流失标签预测的混淆矩阵—作者图片</figcaption></figure><p id="6b43" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">尽管F1得分<strong class="jq hj"> </strong>是不平衡数据集的首选指标(请记住，只有23%的用户是翻炒者)，但我计算了模型的所有以下评估者:</p><ul class=""><li id="a0d2" class="lj lk hi jq b jr js ju jv jx mu kb mv kf mw kj mx lr ls lt bi translated">回忆(或敏感度)= <em class="oa"> TP / (TP + FN) </em></li><li id="5ee1" class="lj lk hi jq b jr lu ju lv jx lw kb lx kf ly kj mx lr ls lt bi translated">Precision = <em class="oa"> TP / (TP + FP) </em></li><li id="0d2d" class="lj lk hi jq b jr lu ju lv jx lw kb lx kf ly kj mx lr ls lt bi translated">F1得分= <em class="oa"> 2 *精度*召回/(精度+召回)</em></li><li id="d085" class="lj lk hi jq b jr lu ju lv jx lw kb lx kf ly kj mx lr ls lt bi translated">准确度= (TP + TN) /全部</li></ul><div class="nc nd ez fb ne nf"><a href="https://towardsdatascience.com/the-3-most-important-composite-classification-metrics-b1f2d886dc7b" rel="noopener follow" target="_blank"><div class="ng ab dw"><div class="nh ab ni cl cj nj"><h2 class="bd hj fi z dy nk ea eb nl ed ef hh bi translated">3个最重要的综合分类指标</h2><div class="nm l"><h3 class="bd b fi z dy nk ea eb nl ed ef dx translated">复合分类度量帮助您和其他决策者快速评估模型的质量。他们经常…</h3></div><div class="nn l"><p class="bd b fp z dy nk ea eb nl ed ef dx translated">towardsdatascience.com</p></div></div><div class="no l"><div class="ob l nq nr ns no nt jh nf"/></div></div></a></div><p id="d3ba" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">从业务角度来看，召回在客户流失预测案例中至关重要，因为企业可能希望找到尽可能多的潜在客户，即使一些假阳性结果可能最终出现在预测的客户群中。</p><p id="1a66" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">对于代码的不同运行，模型评估结果是不同的，因为我没有为训练测试分割或随机森林模型修复种子。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es oc"><img src="../Images/4b8ccc0586e7433d7a62c28cfadcac3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1310/format:webp/1*AFi7A1FrVdkHn5zFhmLtfg.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">模型性能评估(首次运行)</figcaption></figure><p id="442a" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在脚本的第一次运行时，逻辑回归和第一个随机森林模型表现得同样好，尽管这些模型都没有客观地表现得非常好(召回率为62%，F1为73%)。非常窄的测试数据集(0.2 x 225 = 4.5条记录)可能解释了完全相同的性能，而样本大小和应用的简单模型导致了较差的模型性能。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es od"><img src="../Images/a184f460387a5b3ca66b9eb683171175.png" data-original-src="https://miro.medium.com/v2/resize:fit:1290/format:webp/1*sJJuu3arPETzImw35ldlpA.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">模型性能评估(第二次运行)</figcaption></figure><p id="4a9b" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在第二次运行上面的脚本时，模型性能结果有些不同(从上面打印的结果中可以看出)。鉴于流媒体业务识别潜在客户并针对他们未来的客户流失采取行动至关重要，我建议选择基于召回指标的模型。作为一个综合指标，使用F1分数比使用准确度更合理，因为在我们的情况下标签是不平衡的(在数据集中只有23%的搅动者)。基于此，逻辑回归似乎是预测客户流失的最佳(在这种情况下最坏)模型。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es oe"><img src="../Images/cab3ac1e7c49572a36707f56052370f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J12DcSH5GbmGfUxnXEW3RQ.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">模型性能评估(第三次运行)</figcaption></figure><p id="4d53" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在第三次运行时，当我也添加超调模型时，我再次收到了三个主要模型的不同结果。如上表所总结的，超调模型的参数并没有改善逻辑回归模型在主要指标F1得分方面的性能(80%,相比之前在逻辑回归情况下达到的84%)。考虑到分割数据、训练模型和适度样本量的随机性，这些度量的差异可能在统计误差的最大容许范围内。</p><p id="00c2" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">根据上述模型，评估哪些特征在预测客户流失标签中发挥了关键作用:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es of"><img src="../Images/7cc229188a2019bdab50d82b6597483b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s-Rf2FZHSguREP53CwGecQ.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">图表6:基于随机森林模型的要素重要性—顶级要素(首次运行)</figcaption></figure><p id="c0fa" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">一些形式上最重要的功能无助于更好地理解客户行为，例如:</p><ul class=""><li id="3286" class="lj lk hi jq b jr js ju jv jx mu kb mv kf mw kj mx lr ls lt bi translated"><code class="du my mz na nb b">timestamp_registration</code></li><li id="c559" class="lj lk hi jq b jr lu ju lv jx lw kb lx kf ly kj mx lr ls lt bi translated"><code class="du my mz na nb b">timestamp_last</code>。</li></ul><p id="18a9" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">虽然更详细的分析——仅在显著更大的样本上——可以探索该平台早期和后期采用者的行为模式，但在我们的情况下，由于可用数据的范围，相关的功能重要性可能只是一种偏差(当然，非搅动者似乎在给定的时间范围内停留更长时间)。如果搅动者和非搅动者用户群在注册日期方面匹配，这可以被平衡。</p><p id="4142" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">看起来合理的最重要的特性如下:</p><ul class=""><li id="692d" class="lj lk hi jq b jr js ju jv jx mu kb mv kf mw kj mx lr ls lt bi translated"><code class="du my mz na nb b">visit_frequency</code>(用户使用Sparkify的频率)——很少使用Sparkify的人可能更容易流失。</li><li id="bbff" class="lj lk hi jq b jr lu ju lv jx lw kb lx kf ly kj mx lr ls lt bi translated"><code class="du my mz na nb b">event_length_min</code>和<code class="du my mz na nb b">session_length_max</code>(对于用户来说，一个事件的最小长度是多少)—虽然我们可以假设长时间听音乐的用户对音乐流媒体体验更满意，因此会话的最大长度可能是他们愿意继续使用Sparkify的一个指标。另一方面，事件的最小长度不太明显。例如，这可能意味着用户不满意，这是她跳到另一个屏幕的原因，但是这也可能意味着用户可以容易地在应用中导航。</li><li id="db48" class="lj lk hi jq b jr lu ju lv jx lw kb lx kf ly kj mx lr ls lt bi translated"><code class="du my mz na nb b">Save Settings</code>(进入保存设置页面占页面访问量总和的比例)——可能，那些投入时间探索应用泰勒化的人更喜欢它，也更不容易流失。</li><li id="a9da" class="lj lk hi jq b jr lu ju lv jx lw kb lx kf ly kj mx lr ls lt bi translated"><code class="du my mz na nb b">max_gap_days</code>(Sparkify的两次后续访问之间的最大天数)和<code class="du my mz na nb b">session_count</code>(用户使用Sparkify的次数)——这些属性揭示了用户使用spark ify的频率。也许，越少使用它的人越有可能流失。</li></ul><p id="30f7" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">为了更好地理解特征可能对标签结果的影响的可能方向，可以从逻辑回归模型的特征系数的评估中得到提示:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es og"><img src="../Images/f1727a37802e9c173e3fd4e76dddf68e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nbCbHwVrzavuIIXcd1ACVw.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">图表7:最高正特征系数(来自逻辑回归)</figcaption></figure><p id="57ef" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在具有正系数的特征的情况下，该特征对于用户的值越大，用户越有可能是搅动者。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es of"><img src="../Images/02337c15b0ed90a3121f9db583e54fc0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DXDPQ5OFs4lK5vyhP0mO9A.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">图表7:最高负面特征系数(来自逻辑回归)</figcaption></figure><p id="4eae" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在具有负系数的特征的情况下，特征的绝对值越大，用户是搅动者的可能性就越小。</p></div><div class="ab cl kk kl gp km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="hb hc hd he hf"><h1 id="c9c9" class="kr ks hi bd kt ku kv kw kx ky kz la lb io lc ip ld ir le is lf iu lg iv lh li bi translated">3.结论</h1><p id="7074" class="pw-post-body-paragraph jo jp hi jq b jr ll ij jt ju lm im jw jx lz jz ka kb ma kd ke kf mb kh ki kj hb bi translated">探索性数据分析揭示了一些关于谁可能更有可能流失的见解:男性，来自密歇根州和费城-卡姆登-威尔明顿和纽约-新泽西-费城的大都市地区的人，以及Linux用户。</p><blockquote class="oh oi oj"><p id="079b" class="jo jp oa jq b jr js ij jt ju jv im jw ok jy jz ka ol kc kd ke om kg kh ki kj hb bi translated">虽然探索性数据分析表明，尝试过付费版本的用户倾向于减少流失，但模型结果并没有证实这一假设。</p></blockquote><p id="b51e" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">用于预测客户流失的模型通常表现不佳。只有三分之二的搅动者被发现使用了表现最好的模型(第二次运行的逻辑回归模型的召回率为66%)。然而，所准备的pyspark代码适用于在更大的数据集中进行分析，这可以极大地改善模型结果。</p></div><div class="ab cl kk kl gp km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="hb hc hd he hf"><h1 id="b3be" class="kr ks hi bd kt ku kv kw kx ky kz la lb io lc ip ld ir le is lf iu lg iv lh li bi translated">4.为了进一步改进</h1><p id="d903" class="pw-post-body-paragraph jo jp hi jq b jr ll ij jt ju lm im jw jx lz jz ka kb ma kd ke kf mb kh ki kj hb bi translated">该项目有多个改进的角度。</p><ul class=""><li id="e8b0" class="lj lk hi jq b jr js ju jv jx mu kb mv kf mw kj mx lr ls lt bi translated">更大的数据集将能够采样更平衡的数据集，并开发更合理的模型。要设计一个大得多的数据集并在其上训练模型，需要更强大的计算机或云计算资源。</li><li id="894a" class="lj lk hi jq b jr lu ju lv jx lw kb lx kf ly kj mx lr ls lt bi translated">扩展模型阵列:例如，提升树模型<a class="ae jn" href="https://www.kdnuggets.com/2019/05/churn-prediction-machine-learning.html" rel="noopener ugc nofollow" target="_blank">往往在流失预测任务</a>中表现良好(例如GBT或XGBoost)。</li><li id="ebc3" class="lj lk hi jq b jr lu ju lv jx lw kb lx kf ly kj mx lr ls lt bi translated">只有在预测日期和预测的流失日期之间的时间窗口足够长，足以让企业采取行动并使预测的流失者改变主意并留在服务提供商处时，流失预测才与企业相关。更大的数据集将使得能够选择时间段以及搅动者和非搅动者的平衡组成，以探索时间敏感的特征，例如搅动行为的潜在季节性，或者第一周或一个月期间的流行为相对于后期行为的重要性，或者关注在搅动之前的最后一周或一个月期间发生的行为变化。</li></ul></div><div class="ab cl kk kl gp km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="hb hc hd he hf"><h1 id="6dca" class="kr ks hi bd kt ku kv kw kx ky kz la lb io lc ip ld ir le is lf iu lg iv lh li bi translated">5.一些更有用的资源可以阅读</h1><ul class=""><li id="d27b" class="lj lk hi jq b jr ll ju lm jx ln kb lo kf lp kj mx lr ls lt bi translated">火花数据类型:【https://spark.apache.org/docs/latest/sql-ref-datatypes.html T2】</li><li id="d6bb" class="lj lk hi jq b jr lu ju lv jx lw kb lx kf ly kj mx lr ls lt bi translated">Spark SQL中的窗口函数:<a class="ae jn" href="https://databricks.com/blog/2015/07/15/introducing-window-functions-in-spark-sql.html" rel="noopener ugc nofollow" target="_blank">https://databricks . com/blog/2015/07/15/introducing-window-functions-in-Spark-SQL . html</a></li><li id="6175" class="lj lk hi jq b jr lu ju lv jx lw kb lx kf ly kj mx lr ls lt bi translated">流失预测模型选择最佳实践:<a class="ae jn" href="https://journalofbigdata.springeropen.com/articles/10.1186/s40537-019-0191-6" rel="noopener ugc nofollow" target="_blank">https://journalofbigdata . springer open . com/articles/10.1186/s 40537-019-0191-6</a></li><li id="eb0b" class="lj lk hi jq b jr lu ju lv jx lw kb lx kf ly kj mx lr ls lt bi translated">指标评选推荐:<a class="ae jn" href="https://towardsdatascience.com/multi-class-metrics-made-simple-part-ii-the-f1-score-ebe8b2c2ca1" rel="noopener" target="_blank">https://towards data science . com/multi-class-metrics-made-simple-part-ii-the-f1-score-ebe 8 b 2c a1</a></li></ul></div></div>    
</body>
</html>