# 构建 SaaS 产品所需的技术—第一部分

> 原文：<https://medium.com/codex/tech-that-you-need-to-build-your-saas-product-part-i-a15b0215cfe1?source=collection_archive---------6----------------------->

![](img/08579816bd53d04e65a54bcbeaa3d339.png)

你有一个新软件产品的想法，你做了你的研究，创造了一个观众，并向每个人承诺解决这个问题。接下来，我将为您提供一份构建 SaaS 的建议清单和最佳实践。

如今我们有无数的工具来构建软件。从编程语言、框架、云平台开始到 nocode app builders。此外，市场上充斥着各种各样的 SaaS 产品，抬高了用户的期望值。

# 定义核心

因为竞争如此激烈，你无法承受不断地重新发明轮子。相反，你的主要目标应该是尽快获得核心功能。

但是核心功能到底是什么？比方说，你想创建一个新的食品配送应用程序。除非您创建一种新的独特的用户身份验证方式，否则您可能不想推出自己的用户身份验证系统，对吗？用户认证似乎是显而易见的，但其他子系统，如订单管理或交付跟踪可能需要更多的思考。您应该自己构建还是购买解决方案？

接下来，我将快速浏览一组系统和服务，它们可能不是核心的一部分，因为它们是许多 SaaS 产品所共有的，可以重复使用。让我们开始吧。

# 用户认证

正如已经提到的，我们绝对不应该重新发明认证的轮子，而只是重用现有的服务器。你的应用程序应该提供至少一个认证提供商，如谷歌或脸书。您甚至可以决定不提供电子邮件注册，这样您就不必自己创建不同的登录、注册和密码重置表单。

# 电子邮件通知

向客户发送订单确认等交易电子邮件至关重要。有很多服务提供 API 来低价发送交易邮件。但是你可能会经历一些意外。举个例子，有一次，一个著名的电子邮件服务提供商刚刚停止为我工作，因为共享的 ip 地址被大多数反垃圾邮件服务列入黑名单。支持不能做任何事情，并建议等待，希望共享的 ip 地址很快被除名。在此期间，没有电子邮件可以通过，所以我要么升级，并获得一个昂贵的专用 IP 地址(不，谢谢)或移动到另一个服务。最后，我决定快速转移到另一个电子邮件服务，因为这些服务的 API 都非常相似，只需要对代码进行微小的修改。这里的教训是尽可能减少对外部服务的依赖。

但是还有更多。如果您正在为欧洲客户服务，那么您需要了解最新的数据隐私法规，请看您的 Schrems II。审查服务提供商，从他们那里获得签署的 DPA(数据处理协议)并调整您的隐私政策。在某些情况下，你甚至需要停止使用该服务。同样，在这一点上，有尽可能少的依赖是好的。

还有一点就是多租户。如果您的客户需要从他们的域发送电子邮件，电子邮件服务必须支持不同的自定义域。仔细检查自定义域名的价格和限制。

# 多租户

就多租户而言，SaaS 产品基本上有两种类型:B2C 和 B2B。

对于 B2B 应用程序，最好为你的每个客户创建一个逻辑分区或数据库。首先，这将降低代码的复杂性，因为现在你不必担心少了一个层次。团队层级和权限管理已经是复杂的主题。此外，您还降低了客户的客户由于一些错误而混淆的风险，这些错误可能会使您陷入困境甚至停业。此外，删除客户数据只是删除一个数据库，而不是在一个巨大的数据库中搜索该客户的特定数据，然后删除它。

对于 B2C 应用程序，使用单一的逻辑数据库可能更容易。特别是如果你想创建一个具有社交媒体特征的应用程序，或者类似于约会应用程序的东西，让客户相互交流，那么你可能会从客户数据更加紧密中受益。但是，如果您的客户事务很少，而对象却很多，那么在单个逻辑数据库中管理角色和权限就变得太单调乏味了。

# 批准

基于角色的授权通常用于定义权限和团队层级。角色通常直接与身份验证上下文相关联。我不太喜欢这种方法，因为为了设置角色，您需要完全控制身份验证服务。最好将授权规则直接存储在您可以控制的客户数据库中。这也很好地分离了关注点。

# 支付

支付必须完全外包。如果您有许多不同的产品和订阅计划，最好在您这边创建发票，并将提供商用作纯粹的支付处理者。这将降低将您的所有产品与您的支付处理器系统集成的复杂性，因为发票是外部系统的唯一接口。这也允许您在将来添加其他支付处理器，例如 POS 终端，或者由于较低的费用而切换支付处理器。再次，过多的外部依赖会让你慢下来。

# 托管后端 API

托管后端 API 有很多选择。从裸机到托管应用服务。我相信，作为一家 SaaS 公司，你不会因为建造了最华丽的 kubernetes 基础设施而获奖。最佳的基础架构应该经济高效、易于更换且易于扩展。这可以通过无服务器技术实现，如 [Google Cloud Run](https://cloud.google.com/run) 。只需部署 docker 容器，就大功告成了。一个缺点是，第一次请求时很可能会有几秒钟的“预热”时间。但是当你的流量上升时，这个问题就完全消失了。Google Cloud Run 是目前为止我发现的唯一一个真正按请求时间而不是实例时间收费的服务。检查这个[插图](https://cloud.google.com/run/docs/images/billable-time.svg)关于请求时间是如何收费的。这是一个巨大的成本节约。

# 数据库技术

我曾经是 SQL 数据库的忠实粉丝，直到我意识到 RDBMS 只是过去的应用程序框架。你知道，古希腊人会把他们的代码写在靠近数据的存储过程中。稍后，他们会将前端代码转储到表中，并从中生成视图。在某一点上，面向对象的语言变得非常流行，不知何故，我们最终将对象强行放入表中，并将这种痛苦称为“阻抗不匹配”。

谢天谢地，我们不用再处理这个问题了(除非我们真的必须这么做，因为我们的 CTO 在强迫我们)。MongoDB 或 RavenDB 等面向文档的 NoSql 数据库正在崛起，它们运行良好，易于使用，我们可以直接处理对象，不用担心 orm。

将数据视为转储对象对我们的整体设计非常有益。我们倾向于更多地关注系统行为的建模。数据模型成为行为的结果。文档数据库总是必须有一些非规范化数据的观点已经过时了。今天，我们可以创建高度规范化的关系模型，并在数据库级别轻松地对文档执行连接。面向文档的数据库非常有利于提高工作效率，并允许我们更快地构建应用程序的核心。

# 托管数据库

与无状态后端 API 不同，您的数据库需要持久存储。许多数据库提供商提供他们的数据库引擎的云托管。这些服务还包括备份管理和维护。

不过，价格相当高。我们可以使用免费层计划作为起点，但它们的资源往往非常有限。

另一种方法是租用一个小型虚拟机，自己托管一个社区许可的实例，这可以为最初的几百个用户提供足够的电力。我不推荐大型云提供商租赁虚拟机，因为他们在这方面太贵了。自托管当然需要更多的设置工作，但可能会让我们获得足够的利润，从而转向无服务器数据库解决方案。

# 后台处理

我们希望在后台同步处理多种类型的工作负载:

*   不需要立即得到结果并且可以放在后台的数据处理任务。
*   处理外部事件，如来自我们支付服务提供商的支付状态更新或来自其他集成系统的更新
*   处理内部事件

无服务器功能结合消息服务总线为数据处理和内部事件处理提供了一个很好的解决方案。另一方面，外部事件大多是触发系统中 http 端点的 webhook 调用。在这种情况下，最好构建一个 Google Cloud Run 实例，在后台处理传入的 webhook 调用。Azure、Aws 和 GCP 为消息总线和无服务器功能提供了很好的解决方案。在写这篇文章的时候，我正在基于 GCP 构建一个更加统一的解决方案，所以请继续关注！

# 第一部分结束

在这篇文章变得太长之前，让我们用一个简单的清单总结一下我们到目前为止学到的东西:

*   确定你的应用程序的核心商业理念
*   了解你的应用类型是 B2B、B2C 还是两者兼有
*   添加身份验证提供程序
*   为您的交易电子邮件找到合适的电子邮件服务提供商
*   使用发票作为数据接口集成在线支付提供商
*   使用无服务器技术为您的无状态后端 API 服务
*   使用面向文档的数据库，如 RavenDB 或 MongoDB
*   在小型虚拟机上托管您的数据库，或者在刚开始时选择一个收费计划，稍后切换到基于云的托管
*   在您选择的云提供商处:创建一个消息总线并附加无服务器功能来处理内部事件

在第二部分，我将写关于 UI 框架、代码设计、安全性、DevOps 和其他 SaaS 相关的主题。与此同时，请点击这里加入我们新的 Meetup 群组[，与社区分享您的想法。](https://meetu.ps/e/Kh0Tx/TdyVx/d)