<html>
<head>
<title>Confetti animation with Flutter in Sendbird Chat</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Sendbird聊天中带飘动的五彩纸屑动画</h1>
<blockquote>原文：<a href="https://medium.com/codex/confetti-animation-with-flutter-in-sendbird-chat-3211c869da8f?source=collection_archive---------8-----------------------#2022-08-30">https://medium.com/codex/confetti-animation-with-flutter-in-sendbird-chat-3211c869da8f?source=collection_archive---------8-----------------------#2022-08-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/beeef6d32dc054181c98ba38ae9febf9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*TzbQmZV75vJ0jtxX.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">仙鸟2022</figcaption></figure><div class=""/><div class=""><h2 id="532c" class="pw-subtitle-paragraph iu hw hx bd b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl dx translated">如何在用户收到祝贺消息后显示一阵五彩纸屑</h2></div><p id="bd99" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">由谷嘉诚<br/>解决方案工程师| <a class="ae ki" href="https://www.sendbird.com/" rel="noopener ugc nofollow" target="_blank">森伯德</a></p><p id="6171" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated"><em class="kj">你可能会发现检查一下Flutter </em> <a class="ae ki" href="https://github.com/SendbirdCommunity/sendbird-confetti-flutter-sample" rel="noopener ugc nofollow" target="_blank"> <em class="kj">样本app </em> </a> <em class="kj">很有用。有关本教程中材料的其他指导，请参见</em> <a class="ae ki" href="https://sendbird.com/docs/chat/v3/flutter/quickstart/send-first-message" rel="noopener ugc nofollow" target="_blank"> <em class="kj">文档</em> </a> <em class="kj">。要查看仙鸟聊天的运行情况，请查看这个</em> <a class="ae ki" href="https://sendbird.com/demos/in-app-chat" rel="noopener ugc nofollow" target="_blank"> <em class="kj">演示</em> </a> <em class="kj">。您也可以访问我们的</em> <a class="ae ki" href="https://sendbird.com/features/voice-and-video" rel="noopener ugc nofollow" target="_blank"> <em class="kj">网站</em> </a> <em class="kj">了解更多关于Sendbird Calls可以提供的服务。</em></p><h1 id="a9ff" class="kk kl hx bd km kn ko kp kq kr ks kt ku jd kv je kw jg kx jh ky jj kz jk la lb bi translated">介绍</h1><p id="8fbe" class="pw-post-body-paragraph jm jn hx jo b jp lc iy jr js ld jb ju jv le jx jy jz lf kb kc kd lg kf kg kh hb bi translated">chat中一个非常受欢迎的功能是五彩纸屑动画，当聊天消息中收到单词“恭喜”或“恭喜”时，会显示一阵五彩纸屑。我们之前在这篇<a class="ae ki" href="https://sendbird.com/blog/using-confetti-animation-in-sendbird-uikit" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy">文章</strong> </a>中记录了如何为React应用程序实现五彩纸屑动画。在本教程中，我们将讨论如何用Flutter实现这个特性。</p><p id="4b33" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">本文中的代码是之前使用Sendbird的<a class="ae ki" href="https://github.com/sendbird/Sendbird-Flutter" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy"> Flutter SDK </strong> </a>和第三方聊天UI插件<a class="ae ki" href="https://pub.dev/packages/dash_chat_2" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy"> DashChat </strong> </a>创建的Flutter示例应用程序的进展。如果这是你第一次在一个Flutter应用程序中实现<a class="ae ki" href="https://sendbird.com/features/chat-messaging" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy"> Sendbird Chat </strong> </a>，我们建议你先看看这个<a class="ae ki" href="https://sendbird.com/developer/tutorials/sendbird-flutter-3rd-party-ui" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy">教程</strong> </a>来了解如何用Sendbird和第三方ui构建一个Flutter聊天应用程序。</p><p id="d4bd" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">在本教程中，我们将首先看到如何创建一个基本的特效类，然后是一个显示五彩纸屑的自定义子类，最后是如何添加一个控制器来保存和运行我们所有的特效子类。本教程的完整代码旨在允许快速集成到现有项目中，并灵活地添加/删除您自己的自定义效果，对任何现有代码的影响最小。</p><p id="349f" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">请注意，如果你以前有过一些使用Flutter的经验，你将会从本教程中受益匪浅。</p><p id="654b" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">我们开始吧！💻</p><h1 id="7ca6" class="kk kl hx bd km kn ko kp kq kr ks kt ku jd kv je kw jg kx jh ky jj kz jk la lb bi translated">要求</h1><ul class=""><li id="4135" class="lh li hx jo b jp lc js ld jv lj jz lk kd ll kh lm ln lo lp bi translated"><a class="ae ki" href="https://docs.flutter.dev/get-started/install" rel="noopener ugc nofollow" target="_blank"><strong class="jo hy"/></a>安装完毕≥2.5</li><li id="e837" class="lh li hx jo b jp lq js lr jv ls jz lt kd lu kh lm ln lo lp bi translated"><a class="ae ki" href="https://pub.dev/packages/sendbird_sdk" rel="noopener ugc nofollow" target="_blank">T5【仙鸟】SDKT7】包</a></li><li id="7c4b" class="lh li hx jo b jp lq js lr jv ls jz lt kd lu kh lm ln lo lp bi translated"><a class="ae ki" href="https://pub.dev/packages/dash_chat_2" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy"> DashChat 2 </strong> </a>插件</li><li id="55b8" class="lh li hx jo b jp lq js lr jv ls jz lt kd lu kh lm ln lo lp bi translated"><a class="ae ki" href="https://pub.dev/packages/confetti" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy">五彩纸屑</strong> </a>插件</li></ul><h1 id="c301" class="kk kl hx bd km kn ko kp kq kr ks kt ku jd kv je kw jg kx jh ky jj kz jk la lb bi translated">体系结构</h1><p id="a003" class="pw-post-body-paragraph jm jn hx jo b jp lc iy jr js ld jb ju jv le jx jy jz lf kb kc kd lg kf kg kh hb bi translated">为了保持我们的代码相对简单、可移植和可扩展，我们将从存储自定义对象列表的Flutter控制器对象开始。这个控制器可以由构建用户界面(UI)的任何有状态或无状态小部件来初始化和保留。</p><p id="0d4a" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">当聊天消息传递到这个控制器时，控制器会将消息传递到它存储的自定义子类列表中。这些子类中的每一个都将检查特定关键字的消息，如果找到，就播放它的效果。然后，他们会指出用户已经看到了动画，并更新其Sendbird消息元数据，以便当用户重新打开聊天屏幕时，不会出现相同的效果。</p><p id="2344" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">现在让我们深入了解实现细节。</p><h1 id="f873" class="kk kl hx bd km kn ko kp kq kr ks kt ku jd kv je kw jg kx jh ky jj kz jk la lb bi translated">第一部分。基础类</h1><p id="431e" class="pw-post-body-paragraph jm jn hx jo b jp lc iy jr js ld jb ju jv le jx jy jz lf kb kc kd lg kf kg kh hb bi translated">首先，创建一个名为sendbird_sfx.dart的文件，这将是我们的基本特效类。它将具有以下功能:</p><ul class=""><li id="2304" class="lh li hx jo b jp jq js jt jv lv jz lw kd lx kh lm ln lo lp bi translated">返回UI小部件</li><li id="2d47" class="lh li hx jo b jp lq js lr jv ls jz lt kd lu kh lm ln lo lp bi translated">开始一个效果</li><li id="194f" class="lh li hx jo b jp lq js lr jv ls jz lt kd lu kh lm ln lo lp bi translated">停止效果</li><li id="15b6" class="lh li hx jo b jp lq js lr jv ls jz lt kd lu kh lm ln lo lp bi translated">处理任何与运行效果相关的对象</li></ul><p id="6a4e" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">要支持这些功能，请添加以下属性:</p><ul class=""><li id="3d12" class="lh li hx jo b jp jq js jt jv lv jz lw kd lx kh lm ln lo lp bi translated">元键—区分特效的唯一键</li><li id="6665" class="lh li hx jo b jp lq js lr jv ls jz lt kd lu kh lm ln lo lp bi translated">关键词—触发特殊效果的关键词列表</li><li id="7fb3" class="lh li hx jo b jp lq js lr jv ls jz lt kd lu kh lm ln lo lp bi translated">isCaseSensitive —设置是否应检查上述关键字列表是否区分大小写。False表示将忽略大小写。</li><li id="b568" class="lh li hx jo b jp lq js lr jv ls jz lt kd lu kh lm ln lo lp bi translated">expiresIn —一个持续时间属性，用于设置此效果应适用多长时间的阈值。比如你想在有人发“周年快乐！”但如果消息最初是在一个月前发送，则持续时间可以设置为一个月内。</li></ul><p id="b18e" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">现在，让我们添加一个构造函数，以确保在init期间提供所需的属性:</p><figure class="ly lz ma mb fd hk"><div class="bz dy l di"><div class="mc md l"/></div></figure><p id="2a73" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">添加以下应被未来子类覆盖的函数:</p><figure class="ly lz ma mb fd hk"><div class="bz dy l di"><div class="mc md l"/></div></figure><p id="1623" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">以下是可以选择性覆盖的代码块:</p><figure class="ly lz ma mb fd hk"><div class="bz dy l di"><div class="mc md l"/></div></figure><p id="1fa1" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">复制以下内部函数来处理样板操作并与Sendbird的系统同步:</p><figure class="ly lz ma mb fd hk"><div class="bz dy l di"><div class="mc md l"/></div></figure><p id="85e0" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">参见<a class="ae ki" href="https://github.com/SendbirdCommunity/sendbird-confetti-flutter-sample/blob/master/lib/sendbird_sfx.dart" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy"> Github </strong> </a>获取sendbird_sfx.dart类的完成代码。</p><h1 id="3771" class="kk kl hx bd km kn ko kp kq kr ks kt ku jd kv je kw jg kx jh ky jj kz jk la lb bi translated">第二部分。自定义子类</h1><p id="e701" class="pw-post-body-paragraph jm jn hx jo b jp lc iy jr js ld jb ju jv le jx jy jz lf kb kc kd lg kf kg kh hb bi translated">现在我们将创建SendbirdSFX的一个子类，用于在检测到关键字“恭喜”或“祝贺”时显示五彩纸屑。</p><p id="6754" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">创建一个名为confetti_sfx.dart的新类，确保它扩展了上面的基类。</p><figure class="ly lz ma mb fd hk"><div class="bz dy l di"><div class="mc md l"/></div></figure><p id="db7b" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">为了实现这个效果，我们将使用开源的<a class="ae ki" href="https://pub.dev/packages/confetti" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy">五彩纸屑包</strong> </a>。在您的pubspec.yaml dependencies部分添加了confetti之后，添加import ' package:confetti/confetti . dart '；到ConfettiSFX类。</p><p id="74eb" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">将五彩纸屑包初始化为一个属性以保留它:</p><pre class="ly lz ma mb fd me mf mg mh aw mi bi"><span id="58f4" class="mj kl hx mf b fi mk ml l mm mn">final ConfettiController _confettiController = ConfettiController(duration: const Duration(seconds: 10));</span></pre><p id="d26b" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">然后在ui()函数的覆盖中添加它作为包的confetti小部件的控制器:</p><figure class="ly lz ma mb fd hk"><div class="bz dy l di"><div class="mc md l"/></div></figure><p id="b3b5" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">现在，向play、stop和dispose函数添加_confettiController调用:</p><figure class="ly lz ma mb fd hk"><div class="bz dy l di"><div class="mc md l"/></div></figure><p id="9dec" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">confetti_sfx.dart类的完整代码可以在<a class="ae ki" href="https://github.com/SendbirdCommunity/sendbird-confetti-flutter-sample/blob/master/lib/confetti_sfx.dart" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy"> Github </strong> </a>上找到。</p><h1 id="5460" class="kk kl hx bd km kn ko kp kq kr ks kt ku jd kv je kw jg kx jh ky jj kz jk la lb bi translated">第三部分。添加控制器</h1><p id="7eaa" class="pw-post-body-paragraph jm jn hx jo b jp lc iy jr js ld jb ju jv le jx jy jz lf kb kc kd lg kf kg kh hb bi translated">接下来，创建另一个名为sendbird_sfx_controller.dart的文件。这是一个方便的类，用来保存和运行我们所有的特效子类。添加导入语句:</p><pre class="ly lz ma mb fd me mf mg mh aw mi bi"><span id="1585" class="mj kl hx mf b fi mk ml l mm mn">import "sendbird_sfx.dart";</span></pre><p id="2798" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">这样我们就可以添加单个列表属性:</p><p id="bfd6" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">列出<sendbirdsfx>特殊效果；</sendbirdsfx></p><p id="866b" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">添加一个构造函数，以便在初始化时选择性地传入一个特效子类列表:</p><pre class="ly lz ma mb fd me mf mg mh aw mi bi"><span id="8af0" class="mj kl hx mf b fi mk ml l mm mn">SendbirdSFXController({this.specialEffects = const []});</span></pre><p id="dd1d" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">现在创建以下函数来传递消息字符串，并向它和它的每个特殊效果子类传递dispose命令:</p><figure class="ly lz ma mb fd hk"><div class="bz dy l di"><div class="mc md l"/></div></figure><p id="e085" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">sendbird_sfx_controller.dart类的完整代码可以在<a class="ae ki" href="https://github.com/SendbirdCommunity/sendbird-confetti-flutter-sample/blob/master/lib/sendbird_sfx_controller.dart" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy"> Github </strong> </a>上找到。</p><p id="4525" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">最后，我们将把这些类添加到前面示例中的group_channel_view.dart类中，以便与通过Sendbird发送和接收的消息结合起来。</p><p id="c62e" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">添加这些导入语句:</p><figure class="ly lz ma mb fd hk"><div class="bz dy l di"><div class="mc md l"/></div></figure><p id="4146" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">然后在_GroupChannelViewState块中，添加一个新属性来保留我们的SendbirdSFXController:</p><figure class="ly lz ma mb fd hk"><div class="bz dy l di"><div class="mc md l"/></div></figure><p id="644a" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">我们不会修改现有的body()块，而是将它封装到一个stack小部件中，这样我们就可以在它上面添加所有的特效UI。创建一个sfxStackedBody函数，该函数使用以下参数返回一个小部件:</p><figure class="ly lz ma mb fd hk"><div class="bz dy l di"><div class="mc md l"/></div></figure><p id="1d0a" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">然后更新build()函数以调用此块而不是原始的body块，传入_sfxController属性、预先存在的_messages属性和Sendbird组通道引用:</p><figure class="ly lz ma mb fd hk"><div class="bz dy l di"><div class="mc md l"/></div></figure><p id="a46e" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">现在，当类的_messages属性被更新并启动UI重建时，更新的消息将由_sfxController处理，以确定是否应该触发五彩纸屑效果。如果一个单词与关键字列表中的一个匹配，五彩纸屑效果将播放该效果。</p><p id="6966" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">注意:这是集成消息检查的最简单的方法，但不是最有效的，因为过去的消息总是会被重新检查。实现onMessageRecieved()和onMessageUpdated()回调(更多信息<a class="ae ki" href="https://sendbird.com/docs/chat/v3/flutter/guides/event-handler#4-list-of-group-channel-events" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy">此处</strong> </a>)并将SendbirdSFXController的checkAndTriggerAll() all函数移至这些函数。</p><p id="6dc6" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">更新后的group_channel_view.dart类的完整代码可以在<a class="ae ki" href="https://github.com/SendbirdCommunity/sendbird-confetti-flutter-sample/blob/master/lib/group_channel_view.dart" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy"> Github </strong> </a>上找到。</p><h1 id="83a9" class="kk kl hx bd km kn ko kp kq kr ks kt ku jd kv je kw jg kx jh ky jj kz jk la lb bi translated">结论</h1><p id="67a7" class="pw-post-body-paragraph jm jn hx jo b jp lc iy jr js ld jb ju jv le jx jy jz lf kb kc kd lg kf kg kh hb bi translated">就是这样！你做到了！🚀现在你已经知道如何添加五彩纸屑到你的Flutter应用程序，你可以制作你自己的聊天触发的效果——其他动画，音频效果，甚至其他代码块！</p><p id="f0c4" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">享受体验你自己的聊天触发的特殊效果！开心聊楼！✌️👨‍💻</p></div></div>    
</body>
</html>