<html>
<head>
<title>How does Fordeal Data Platform Scheduler migrate from Azkaban to Apache DolphinScheduler smoothly?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Fordeal数据平台调度器如何从Azkaban顺利迁移到Apache DolphinScheduler？</h1>
<blockquote>原文：<a href="https://medium.com/codex/how-does-fordeal-data-platform-scheduler-migrate-from-azkaban-to-apache-dolphinscheduler-smoothly-b00bbd7ac586?source=collection_archive---------24-----------------------#2022-06-22">https://medium.com/codex/how-does-fordeal-data-platform-scheduler-migrate-from-azkaban-to-apache-dolphinscheduler-smoothly-b00bbd7ac586?source=collection_archive---------24-----------------------#2022-06-22</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/b7cb742748d83c0f1bca0d773bab00f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_No1vNsKB9noevMoq_JMcA.png"/></div></div></figure><blockquote class="iq ir is"><p id="a055" class="it iu iv iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">Fordeal的数据平台调度器之前是在Azkaban上搭建的，用于二次开发，但是无论是用户层面还是技术层面都很难使用。例如，它缺乏必要的功能，如任务可视化编辑界面和补充号码，这使得用户很难开始使用。在技术层面，架构已经过时，很难迭代。在这种情况下，经过对产品的对比研究，新版本的Fordeal数据平台决定对基于Apache DolphinScheduler的系统进行升级和迁移。</p><p id="1995" class="it iu iv iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">开发人员如何顺利过渡到新系统，在整个迁移过程中做了哪些努力？</p><p id="f2ab" class="it iu iv iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在5月的Apache dolphin scheduler online meetup上，来自Fordeal的大数据开发人员鲁东分享了他在平台迁移方面的实践经验。</p></blockquote><h1 id="18b9" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">演讲者介绍</h1><figure class="kq kr ks kt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/e39fcad4e8e432e092a4e8c9baea641c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p7_9htNZ_ROwt3c95bppqg.png"/></div></div><figcaption class="ku kv et er es kw kx bd b be z dx translated">鲁东|来自Fordeal的大数据开发人员</figcaption></figure><p id="40a6" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je ky jg jh ji kz jk jl jm la jo jp jq jr hb bi translated">5年数据开发工作经验，目前就职于Fordeal，主要从事数据技术包括数据湖和仓库集成、MPP数据库、数据可视化等。</p><p id="8ee4" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je ky jg jh ji kz jk jl jm la jo jp jq jr hb bi translated">本演示包括四个部分。</p><ul class=""><li id="bc5f" class="lb lc hi iw b ix iy jb jc ky ld kz le la lf jr lg lh li lj bi translated">福迪尔数据平台调度器的需求分析</li><li id="5afe" class="lb lc hi iw b ix lk jb ll ky lm kz ln la lo jr lg lh li lj bi translated">如何适应向Apache DolphinScheduler的迁移</li><li id="c250" class="lb lc hi iw b ix lk jb ll ky lm kz ln la lo jr lg lh li lj bi translated">如何增强改编后的功能</li><li id="facc" class="lb lc hi iw b ix lk jb ll ky lm kz ln la lo jr lg lh li lj bi translated">未来规划</li></ul><h1 id="d901" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">01需求分析</h1><h2 id="31eb" class="lp jt hi bd ju lq lr ls jy lt lu lv kc ky lw lx kg kz ly lz kk la ma mb ko mc bi translated">背景</h2><figure class="kq kr ks kt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es md"><img src="../Images/173dc164128f96880b5ecef19d26b7e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Nj1NvOrUfi0eSoTaajLG_g.png"/></div></div></figure><p id="64c4" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je ky jg jh ji kz jk jl jm la jo jp jq jr hb bi translated">Fordeal数据平台调度程序最初是基于阿兹卡班开发的。虽然它几乎不能充分支持机器分组、SHELL动态参数和依赖性检测，但它很难处理日常使用中的以下三个问题，分别是用户级、技术级和O&amp;M级。</p><p id="a011" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je ky jg jh ji kz jk jl jm la jo jp jq jr hb bi translated">首先，在用户层面，缺乏可视化编辑、补号等必要功能。它只适用于技术人员，而非非技术人员。阿兹卡班的错误报告模式也只允许开发者进行有针对性的修改。</p><p id="d738" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je ky jg jh ji kz jk jl jm la jo jp jq jr hb bi translated">其次，在技术层面，Fordeal数据平台调度器的技术架构已经过时，前后端没有分离，所以增加一个特性或者重新开发都非常困难。</p><p id="cb1e" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je ky jg jh ji kz jk jl jm la jo jp jq jr hb bi translated">第三，操作和维护是最大的绊脚石。有时，系统会卡在流执行中。要处理这个问题，需要登录数据库，删除执行流中的id，重启worker和API服务，非常繁琐。</p><h2 id="aae3" class="lp jt hi bd ju lq lr ls jy lt lu lv kc ky lw lx kg kz ly lz kk la ma mb ko mc bi translated">02研究</h2><p id="dcfb" class="pw-post-body-paragraph it iu hi iw b ix me iz ja jb mf jd je ky mg jh ji kz mh jl jm la mi jp jq jr hb bi translated">因此，当2019年Apache DolphinScheduler开源时，我们及时对它产生了兴趣，并开始了解是否有可能迁移到它上面。当时，我们基于我们的五个主要需求，对Apache Dolphin Scheduler、Azkaban和Airflow进行了比较。</p><ul class=""><li id="4b37" class="lb lc hi iw b ix iy jb jc ky ld kz le la lf jr lg lh li lj bi translated">基于JVM的语言是首选。这是因为基于JVM的语言在线程和文档开发方面更加成熟。气流是基于Python的，不适合我们非技术人员。</li><li id="4d86" class="lb lc hi iw b ix lk jb ll ky lm kz ln la lo jr lg lh li lj bi translated">分布式架构，支持高可用性。Azkaban的工作不是分布式的，web和master服务是耦合的，所以是单个节点。</li><li id="3c60" class="lb lc hi iw b ix lk jb ll ky lm kz ln la lo jr lg lh li lj bi translated">工作流必须支持DSL和可视化编辑。这确保了技术人员可以用DSL编写，而用户可以在可视化环境中编写。</li><li id="d7d4" class="lb lc hi iw b ix lk jb ll ky lm kz ln la lo jr lg lh li lj bi translated">前端和后端分离，采用主流架构。所以前端和后端可以分开开发，分离时耦合度降低。</li><li id="5762" class="lb lc hi iw b ix lk jb ll ky lm kz ln la lo jr lg lh li lj bi translated">社区活动。这是最后一个但并非最不重要的需求，因为留下来修复旧的bug会大大降低开发效率。</li></ul><h2 id="4b1c" class="lp jt hi bd ju lq lr ls jy lt lu lv kc ky lw lx kg kz ly lz kk la ma mb ko mc bi translated">03重构架构</h2><figure class="kq kr ks kt fd ij er es paragraph-image"><div class="er es mj"><img src="../Images/324eabe108943db986a0c2a06e648c83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1202/format:webp/1*6a1n2N-k5HKNhzfiyeg-SA.png"/></div><figcaption class="ku kv et er es kw kx bd b be z dx translated">带*的项目代表重新开发</figcaption></figure><p id="bd27" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je ky jg jh ji kz jk jl jm la jo jp jq jr hb bi translated">我们今天的数据架构如上所示，Apache Dolphin调度程序接管了从HDFS和S3收割到K8S计算的整个生命周期，然后是基于Spark和Flink的开发。左右两边的DolphinScheduler和Zookeeper都是作为基础架构使用的。我们的调度信息如下:Master x2，Worker x6，API x1(承载接口等。)，目前处理日均3.5k工作流实例，日均15k+任务实例。(下图显示了1.2.0版本的架构)</p><figure class="kq kr ks kt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mk"><img src="../Images/a46534e82b10a93b42141cdc229368ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*OmG-slQYVqLHUF7v.png"/></div></div></figure><h1 id="7457" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">02适应和迁移</h1><h2 id="0a5f" class="lp jt hi bd ju lq lr ls jy lt lu lv kc ky lw lx kg kz ly lz kk la ma mb ko mc bi translated">01内部系统接口</h2><p id="5cfe" class="pw-post-body-paragraph it iu hi iw b ix me iz ja jb mf jd je ky mg jh ji kz mh jl jm la mi jp jq jr hb bi translated">Fordeal的内部系统需要联机以向用户提供访问，并且必须连接几个内部服务以减少用户的启动成本和维护工作。其中包括以下三个系统。</p><ul class=""><li id="1e99" class="lb lc hi iw b ix iy jb jc ky ld kz le la lf jr lg lh li lj bi translated">单点登录系统。</li></ul><p id="a122" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je ky jg jh ji kz jk jl jm la jo jp jq jr hb bi translated">基于JWT实现的单点登录系统，一次登录授权所有人。</p><figure class="kq kr ks kt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ml"><img src="../Images/e151a7250bae9865144be9f4d4b4ccbc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TV0MATjmT9hgjLuBlhegww.png"/></div></div></figure><ul class=""><li id="4e2f" class="lb lc hi iw b ix iy jb jc ky ld kz le la lf jr lg lh li lj bi translated">工单系统。</li></ul><p id="de55" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je ky jg jh ji kz jk jl jm la jo jp jq jr hb bi translated">DS授权访问项目的工作订单，以避免人工操作和维护(访问所有授权操作以自动化流程)</p><ul class=""><li id="2236" class="lb lc hi iw b ix iy jb jc ky ld kz le la lf jr lg lh li lj bi translated">警报平台。</li></ul><p id="2f7a" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je ky jg jh ji kz jk jl jm la jo jp jq jr hb bi translated">扩展DS报警模式，将所有报警信息发送到内部报警平台，用户可以配置电话、WeCom等报警模式。</p><h2 id="e879" class="lp jt hi bd ju lq lr ls jy lt lu lv kc ky lw lx kg kz ly lz kk la ma mb ko mc bi translated">02阿兹卡班的兼容性</h2><p id="d34b" class="pw-post-body-paragraph it iu hi iw b ix me iz ja jb mf jd je ky mg jh ji kz mh jl jm la mi jp jq jr hb bi translated">Azkaban的流量管理基于定制的DSL配置，每个流量配置包含多达800+或少至1个节点。它以三种方式升级。</p><p id="1e33" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je ky jg jh ji kz jk jl jm la jo jp jq jr hb bi translated">1，用户本地保存，压缩，每次修改后上传，用户自己维护信息流。</p><p id="63b2" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je ky jg jh ji kz jk jl jm la jo jp jq jr hb bi translated">2，所有的流配置和资源都托管在git上，绑定Azkaban项目设置中的git地址。Git是我们自己开发的，点击刷新按钮后在页面提交。</p><p id="932c" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je ky jg jh ji kz jk jl jm la jo jp jq jr hb bi translated">3，所有流量托管在配置中心，对接阿兹卡班的上传接口覆盖之前的调度信息。</p><figure class="kq kr ks kt fd ij er es paragraph-image"><div class="er es mm"><img src="../Images/c550d81b0cb13700f66f1e4019d4e91d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1130/format:webp/1*aQ6Vj9ITcQf-qEyNiWiZOw.png"/></div><figcaption class="ku kv et er es kw kx bd b be z dx translated">数据仓库项目的流配置文件</figcaption></figure><p id="e74e" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je ky jg jh ji kz jk jl jm la jo jp jq jr hb bi translated">上图显示了一些数据仓库项目的<strong class="iw hj">流配置文件的一部分。为了将Azkaban迁移到Apache DolphinScheduler，我们一共列出了十个要求。</strong></p><ul class=""><li id="d5e0" class="lb lc hi iw b ix iy jb jc ky ld kz le la lf jr lg lh li lj bi translated"><strong class="iw hj"> DS上传接口需要支持解析流程配置文件，生成工作流</strong>。(应该支持嵌套流。)流配置文件等于一个Azkaban DAG文件，这意味着我们必须编写代码来解析配置文件，如果它不匹配，就将流转换为JSON。</li><li id="d477" class="lb lc hi iw b ix lk jb ll ky lm kz ln la lo jr lg lh li lj bi translated">DS资源中心应该支持文件夹(托管阿兹卡班项目下的所有资源)。版本1.2.0中没有文件夹功能，而我们的数据仓库中有许多文件夹，所以我们必须支持文件夹。</li><li id="86c4" class="lb lc hi iw b ix lk jb ll ky lm kz ln la lo jr lg lh li lj bi translated">DS应该为客户端包提供基本的数据结构类和工具类，以便于API调用和为工作流生成配置。</li><li id="01df" class="lb lc hi iw b ix lk jb ll ky lm kz ln la lo jr lg lh li lj bi translated">DS应该支持工作流的并发控制(并行或跳过)。</li><li id="74ad" class="lb lc hi iw b ix lk jb ll ky lm kz ln la lo jr lg lh li lj bi translated">DS时间参数需要支持配置的时区(例如dt=$[ZID_CTT yyyy-MM=dd=1])。尽管我们配置的大多数时区都在海外，但大多数用户更愿意使用北京时区。</li><li id="f4fd" class="lb lc hi iw b ix lk jb ll ky lm kz ln la lo jr lg lh li lj bi translated">DS运行和部署接口应该支持全局变量覆盖。像complement这样的一些功能在旧版本中是不可用的，用户需要为运行的工作流设置变量。</li><li id="04fb" class="lb lc hi iw b ix lk jb ll ky lm kz ln la lo jr lg lh li lj bi translated">DS DAG图应该支持任务多选操作。</li><li id="b723" class="lb lc hi iw b ix lk jb ll ky lm kz ln la lo jr lg lh li lj bi translated">DS任务日志要输出最终的执行内容，方便用户查看和调试。</li><li id="dc8f" class="lb lc hi iw b ix lk jb ll ky lm kz ln la lo jr lg lh li lj bi translated">DS应该支持在运行时手动重试失败的任务。通常，一次运行仓库需要几个小时，在此期间，任务可能会由于代码问题而报告错误。我们希望能够在不中断任务流的情况下手动重试任务，并在逐个修改错误的节点后重试，以确保最终状态是成功的。</li><li id="048d" class="lb lc hi iw b ix lk jb ll ky lm kz ln la lo jr lg lh li lj bi translated">仓库项目需要支持一键迁移，以跟上用户的工作习惯(Jenkins对接ds)。</li></ul><p id="0e39" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je ky jg jh ji kz jk jl jm la jo jp jq jr hb bi translated">经过与五个以上工作组的不断沟通和修改，我们使这十项要求最终得到满足。</p><h2 id="640f" class="lp jt hi bd ju lq lr ls jy lt lu lv kc ky lw lx kg kz ly lz kk la ma mb ko mc bi translated">03功能优化总结</h2><p id="6ba1" class="pw-post-body-paragraph it iu hi iw b ix me iz ja jb mf jd je ky mg jh ji kz mh jl jm la mi jp jq jr hb bi translated">从阿兹卡班迁移到Apache DolphinScheduler大约花了一年时间。考虑到API用户、git用户和各种函数用户的需求，我们已经提交了140+次优化提交。</p><h1 id="9105" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">03功能增强</h1><h2 id="c24b" class="lp jt hi bd ju lq lr ls jy lt lu lv kc ky lw lx kg kz ly lz kk la ma mb ko mc bi translated">01前端重构</h2><p id="8b08" class="pw-post-body-paragraph it iu hi iw b ix me iz ja jb mf jd je ky mg jh ji kz mh jl jm la mi jp jq jr hb bi translated">我们的痛点是什么？为什么要重构平台？我们回答这些问题有6个原因。</p><p id="d2b9" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je ky jg jh ji kz jk jl jm la jo jp jq jr hb bi translated">首先，阿兹卡班操作起来很麻烦。当用户想要找到工作流定义时，他们首先必须打开项目，在项目主页上找到工作流列表，然后找到定义；用户看一眼就找不到想要的定义。</p><p id="9c47" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je ky jg jh ji kz jk jl jm la jo jp jq jr hb bi translated">其次，我不能通过名称、分组或其他标准来检索工作流定义和实例。</p><p id="0682" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je ky jg jh ji kz jk jl jm la jo jp jq jr hb bi translated">第三，不能通过URL共享工作流定义和实例细节。</p><p id="f5c9" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je ky jg jh ji kz jk jl jm la jo jp jq jr hb bi translated">第四，数据库表和API设计不完善，查询卡死，经常出现长事务告警。</p><p id="1d9e" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je ky jg jh ji kz jk jl jm la jo jp jq jr hb bi translated">第五，界面的一些部分是用死布局写的，比如设置的宽度导致增加的栏目不能很好的适应电脑和手机。</p><p id="ee01" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je ky jg jh ji kz jk jl jm la jo jp jq jr hb bi translated">第六，工作流定义和实例不能批量操作。错误在程序中是不可避免的，但是它让用户困惑于如何批量重试任务。</p><p id="b52f" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je ky jg jh ji kz jk jl jm la jo jp jq jr hb bi translated"><strong class="iw hj"> <em class="iv">重构解决方案</em> </strong></p><ul class=""><li id="46af" class="lb lc hi iw b ix iy jb jc ky ld kz le la lf jr lg lh li lj bi translated">基于AntDesign库开发一套新的前端接口。</li><li id="3da8" class="lb lc hi iw b ix lk jb ll ky lm kz ln la lo jr lg lh li lj bi translated">削弱了项目的概念，使用户忘记了项目，项目只是作为一个工作流或实例标签。目前电脑版只有四个入口，首页、工作流列表、执行列表、资源中心列表，手机版只有两个入口，工作流列表、执行列表。</li><li id="a097" class="lb lc hi iw b ix lk jb ll ky lm kz ln la lo jr lg lh li lj bi translated">将工作流列表和执行列表放在第一入口，简化操作步骤。</li><li id="a109" class="lb lc hi iw b ix lk jb ll ky lm kz ln la lo jr lg lh li lj bi translated">优化查询条件和索引，增加批量操作接口等。添加了联邦索引。</li><li id="eb99" class="lb lc hi iw b ix lk jb ll ky lm kz ln la lo jr lg lh li lj bi translated">完全适配电脑和手机(除了编辑dag，其他功能都一样)</li></ul><h2 id="dbd8" class="lp jt hi bd ju lq lr ls jy lt lu lv kc ky lw lx kg kz ly lz kk la ma mb ko mc bi translated">02相关性计划</h2><p id="232c" class="pw-post-body-paragraph it iu hi iw b ix me iz ja jb mf jd je ky mg jh ji kz mh jl jm la mi jp jq jr hb bi translated"><strong class="iw hj">什么是依赖调度？</strong>表示成功的工作流实例或任务实例主动触发下游的工作流或任务运行(执行状态依赖于执行)。<strong class="iw hj">设想以下场景:</strong>下游工作流需要根据上游工作流的调度时间来设置自己的定时；当上游运行失败时，下游计时也会出错；上游只能通知下游所有商家补数。难以调整上下游仓库的定时间隔，计算集群的资源利用率没有最大化(K8S)。这是因为用户没有持续提交。</p><p id="fcd7" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je ky jg jh ji kz jk jl jm la jo jp jq jr hb bi translated"><strong class="iw hj"> <em class="iv">依赖调度规则</em> </strong></p><ul class=""><li id="0a6a" class="lb lc hi iw b ix iy jb jc ky ld kz le la lf jr lg lh li lj bi translated">工作流支持时间安排和/或依赖关系的组合。</li><li id="fb1c" class="lb lc hi iw b ix lk jb ll ky lm kz ln la lo jr lg lh li lj bi translated">工作流中的任务支持相关性计划(不考虑时间)。</li><li id="b563" class="lb lc hi iw b ix lk jb ll ky lm kz ln la lo jr lg lh li lj bi translated">依赖关系计划需要设置一个依赖期，只有在此期间内满足所有依赖关系时，才会触发依赖期。</li><li id="f003" class="lb lc hi iw b ix lk jb ll ky lm kz ln la lo jr lg lh li lj bi translated">依赖调度的最小设置单位是任务，任务支持对多个工作流或任务的依赖。</li><li id="8ca7" class="lb lc hi iw b ix lk jb ll ky lm kz ln la lo jr lg lh li lj bi translated">工作流只是执行树中的一个组概念，这意味着它不限制任务。</li></ul><figure class="kq kr ks kt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mn"><img src="../Images/f8dc1d0cf7f4b2e53c981e89a19890f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ptmYPyoStSyuR4fDPj5b8w.png"/></div></div><figcaption class="ku kv et er es kw kx bd b be z dx translated">移动设备上的工作流依赖关系详细信息</figcaption></figure><h2 id="fe42" class="lp jt hi bd ju lq lr ls jy lt lu lv kc ky lw lx kg kz ly lz kk la ma mb ko mc bi translated">03任务扩展</h2><p id="e095" class="pw-post-body-paragraph it iu hi iw b ix me iz ja jb mf jd je ky mg jh ji kz mh jl jm la mi jp jq jr hb bi translated">扩展更多任务类型，抽象常用功能，提供编辑界面，降低使用成本。我们扩展了以下任务。</p><ul class=""><li id="2824" class="lb lc hi iw b ix iy jb jc ky ld kz le la lf jr lg lh li lj bi translated"><strong class="iw hj">数据开放平台(DOP)。</strong></li></ul><p id="3eae" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je ky jg jh ji kz jk jl jm la jo jp jq jr hb bi translated">主要提供数据导入导出功能(支持Hive、Hbase、Mysql、ES、Postgre、Redis、S3)</p><ul class=""><li id="df24" class="lb lc hi iw b ix iy jb jc ky ld kz le la lf jr lg lh li lj bi translated"><strong class="iw hj">数据质量:</strong>基于Deequ开发的数据验证。</li></ul><p id="63df" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je ky jg jh ji kz jk jl jm la jo jp jq jr hb bi translated">用户使用的数据抽象。</p><ul class=""><li id="9b4e" class="lb lc hi iw b ix iy jb jc ky ld kz le la lf jr lg lh li lj bi translated"><strong class="iw hj"> SQL-Prest数据源:</strong> SQL模块支持Presto数据源</li><li id="d61f" class="lb lc hi iw b ix lk jb ll ky lm kz ln la lo jr lg lh li lj bi translated"><strong class="iw hj">数据沿袭集合</strong>:内置于所有任务中，任务公开沿袭所需的所有数据。</li></ul><h2 id="1442" class="lp jt hi bd ju lq lr ls jy lt lu lv kc ky lw lx kg kz ly lz kk la ma mb ko mc bi translated">04监控警报</h2><p id="7677" class="pw-post-body-paragraph it iu hi iw b ix me iz ja jb mf jd je ky mg jh ji kz mh jl jm la mi jp jq jr hb bi translated">服务监控在Java + Spring架构下，一组通用的Grafana监控板可以显示细节，监控数据存储在Prometheus中。我们的原则是在不监控内部服务的情况下公开数据，避免重新发明轮子。转换列表如下所示。</p><ul class=""><li id="f0b4" class="lb lc hi iw b ix iy jb jc ky ld kz le la lf jr lg lh li lj bi translated">API、Master和Worker服务访问micrometer-registry-Prometheus，收集公共数据，并公开Prometheus收集接口。</li><li id="a3c7" class="lb lc hi iw b ix lk jb ll ky lm kz ln la lo jr lg lh li lj bi translated">收集主线程池和工作线程池的状态数据，例如主线程池和工作线程池正在运行的工作流实例、数据库等。，用于后续的监控优化和报警。</li><li id="8277" class="lb lc hi iw b ix lk jb ll ky lm kz ln la lo jr lg lh li lj bi translated">Prometheus端配置了服务状态异常告警，如工作流实例运行少于n(阻塞)一段时间，服务内存&amp; CPU告警等。</li></ul><figure class="kq kr ks kt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/b17cd28f4c69be4a7baabffa7158f088.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fQRPmnluGf8iqgTFCLs-dg.png"/></div></div></figure><h1 id="db36" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">04计划</h1><h2 id="55bb" class="lp jt hi bd ju lq lr ls jy lt lu lv kc ky lw lx kg kz ly lz kk la ma mb ko mc bi translated">01保持社区特色</h2><p id="61ca" class="pw-post-body-paragraph it iu hi iw b ix me iz ja jb mf jd je ky mg jh ji kz mh jl jm la mi jp jq jr hb bi translated">Fordeal大数据平台是基于第一个Apache版本的社区(1.2.0)二次开发运行的，我们通过监测发现了几个问题。</p><ul class=""><li id="9530" class="lb lc hi iw b ix iy jb jc ky ld kz le la lf jr lg lh li lj bi translated">高数据库压力和高网络IO成本</li><li id="5601" class="lb lc hi iw b ix lk jb ll ky lm kz ln la lo jr lg lh li lj bi translated">Zookeeper充当队列，导致磁盘IOPS不时出现峰值，带来潜在风险</li><li id="87d4" class="lb lc hi iw b ix lk jb ll ky lm kz ln la lo jr lg lh li lj bi translated">命令消耗和任务分配模型相对简单，导致机器负载不均衡</li><li id="6378" class="lb lc hi iw b ix lk jb ll ky lm kz ln la lo jr lg lh li lj bi translated">这种调度模型使用了大量的轮询逻辑(Thread.sleep)，使得调度消耗、分发、检测等。无能的</li></ul><p id="0492" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je ky jg jh ji kz jk jl jm la jo jp jq jr hb bi translated">社区发展很快，用现在合理易用的架构解决了很多问题。我们最近比较关注Master直接给Worker分配任务，减轻Zookeeper这种方便后续扩展的任务类型插件的压力。主配置或定制分配逻辑的优化，以使机器的复杂性合理化。更完善的容错机制和运维工具(优雅的上线或下线)。目前，工作人员无法优雅地上线或下线，这需要切断流量，等到线程池归零，然后更安全地上线或下线。</p><h2 id="cd90" class="lp jt hi bd ju lq lr ls jy lt lu lv kc ky lw lx kg kz ly lz kk la ma mb ko mc bi translated">02优化数据同步</h2><figure class="kq kr ks kt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mo"><img src="../Images/e250d3b3db75c039bcb2d980dd598f87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y89lA_y_GV7JpCMsODuP2w.png"/></div></div></figure><p id="6b6d" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je ky jg jh ji kz jk jl jm la jo jp jq jr hb bi translated">目前只提供了相对粗粒度的工作流实例的执行统计。随后，需要支持更精细的统计，比如依赖于<strong class="iw hj">任务过滤的统计分析、执行树、最耗时的执行路径</strong>等。</p><p id="c54c" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je ky jg jh ji kz jk jl jm la jo jp jq jr hb bi translated">除此之外，还应该增加更多的数据同步功能，比如增加执行统计的同步、链阈值告警等。，基于工作流警报。</p><h2 id="716d" class="lp jt hi bd ju lq lr ls jy lt lu lv kc ky lw lx kg kz ly lz kk la ma mb ko mc bi translated">03连接到其他系统</h2><figure class="kq kr ks kt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mo"><img src="../Images/abace280013a6a408bdc3e98bd396506.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZaRa3FVQxvdmEirm5bue2g.png"/></div></div></figure><p id="25da" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je ky jg jh ji kz jk jl jm la jo jp jq jr hb bi translated">当调度迭代稳定后，将逐渐作为基础组件，提供更便捷的接口和可嵌入的窗口(iframe)以允许更多上层数据应用(如BI系统、预警系统)等。以对接并提供基本的调度功能。</p><p id="7433" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je ky jg jh ji kz jk jl jm la jo jp jq jr hb bi translated">以上就是我要分享的，感谢阅读！</p><h1 id="efb1" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">加入社区</h1><p id="e3e3" class="pw-post-body-paragraph it iu hi iw b ix me iz ja jb mf jd je ky mg jh ji kz mh jl jm la mi jp jq jr hb bi translated">参与DolphinScheduler社区并为其做出贡献的方式有很多，包括:</p><p id="69fd" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je ky jg jh ji kz jk jl jm la jo jp jq jr hb bi translated">文档、翻译、问答、测试、代码、文章、主题演讲等。</p><p id="f112" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je ky jg jh ji kz jk jl jm la jo jp jq jr hb bi translated">我们假设第一个PR(文档、代码)是简单的，应该用来熟悉提交过程和社区协作风格。</p><p id="b629" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je ky jg jh ji kz jk jl jm la jo jp jq jr hb bi translated">所以社区整理了以下适合新手的问题列表:【https://github.com/apache/dolphinscheduler/issues/5689T2】</p><p id="17ff" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je ky jg jh ji kz jk jl jm la jo jp jq jr hb bi translated">非新手问题列表:【https://github.com/apache/dolphinscheduler/issues? T4】q = is % 3A open+is % 3A issue+label % 3A % 22 volunteer+wanted % 22</p><p id="b250" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je ky jg jh ji kz jk jl jm la jo jp jq jr hb bi translated">如何参与投稿:<a class="ae mp" href="https://dolphinscheduler.apache.org/en-us/community/development/contribute.html" rel="noopener ugc nofollow" target="_blank">https://dolphin scheduler . Apache . org/en-us/community/development/contribute . html</a></p><p id="b951" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je ky jg jh ji kz jk jl jm la jo jp jq jr hb bi translated">GitHub代码库:<a class="ae mp" href="https://github.com/apache/dolphinscheduler" rel="noopener ugc nofollow" target="_blank">https://github.com/apache/dolphinscheduler</a></p><p id="ead5" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je ky jg jh ji kz jk jl jm la jo jp jq jr hb bi translated">官方网站:<a class="ae mp" href="https://dolphinscheduler.apache.org/" rel="noopener ugc nofollow" target="_blank">https://dolphinscheduler.apache.org/</a></p><p id="8d18" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je ky jg jh ji kz jk jl jm la jo jp jq jr hb bi translated">邮件列表:戴夫@<a class="ae mp" href="mailto:dolphinscheduler@apache.org" rel="noopener ugc nofollow" target="_blank">dolphinscheduler@apache.org</a></p><p id="4688" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je ky jg jh ji kz jk jl jm la jo jp jq jr hb bi translated">推特:<a class="ae mp" href="https://dev.to/dolphinschedule" rel="noopener ugc nofollow" target="_blank">@海豚时间表</a></p><p id="ba09" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je ky jg jh ji kz jk jl jm la jo jp jq jr hb bi translated">YouTube:<a class="ae mp" href="https://www.youtube.com/channel/UCmrPmeE7dVqo8DYhSLHa0vA" rel="noopener ugc nofollow" target="_blank">https://www.youtube.com/channel/UCmrPmeE7dVqo8DYhSLHa0vA</a></p><p id="9d49" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je ky jg jh ji kz jk jl jm la jo jp jq jr hb bi translated">松弛:<a class="ae mp" href="https://s.apache.org/dolphinscheduler-slack" rel="noopener ugc nofollow" target="_blank">https://s.apache.org/dolphinscheduler-slack</a></p><p id="6c56" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je ky jg jh ji kz jk jl jm la jo jp jq jr hb bi translated">投稿指南:<a class="ae mp" href="https://dolphinscheduler.apache.org/en-us/community/index.html" rel="noopener ugc nofollow" target="_blank">https://dolphin scheduler . Apache . org/en-us/community/index . html</a></p><p id="6cf2" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je ky jg jh ji kz jk jl jm la jo jp jq jr hb bi translated">你的项目之星很重要，不要犹豫，点亮阿帕奇海豚调度❤️之星</p></div></div>    
</body>
</html>