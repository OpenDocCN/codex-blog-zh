<html>
<head>
<title>Algorithmic Trading with Bollinger Bands in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python中的布林线算法交易</h1>
<blockquote>原文：<a href="https://medium.com/codex/algorithmic-trading-with-bollinger-bands-in-python-1b0a00c9ef99?source=collection_archive---------0-----------------------#2021-04-18">https://medium.com/codex/algorithmic-trading-with-bollinger-bands-in-python-1b0a00c9ef99?source=collection_archive---------0-----------------------#2021-04-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/3729ad16a6bdac4a8e9dd50a3562e722.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9jMU87OI5QT40sJMDjKcLg.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated"><a class="ae hv" href="https://www.behance.net/gallery/99803753/Stock-Works-Montage-20?tracking_source=search_projects_recommended%7Cstock" rel="noopener ugc nofollow" target="_blank">图像来源</a></figcaption></figure><div class=""/><div class=""><h2 id="26de" class="pw-subtitle-paragraph iv hx hy bd b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm dx translated">Python中使用布林线进行股票交易的自动化方法</h2></div><p id="869f" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated"><strong class="jp hz">免责声明:</strong>本文仅用于教育目的，不应作为投资建议。</p><p id="6bfe" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">这是我算法交易系列的第二篇文章(<a class="ae hv" rel="noopener" href="/codex/algorithmic-trading-with-sma-in-python-7d66008d37b1">查看第一篇</a>)。在第一篇文章中，我们讨论了什么是算法交易，学习了一个股票技术指标简单移动平均线(SMA)，以及如何在python中应用它来交易股票。在本文中，我们将学习一个新的技术指标布林线，以及如何用python来创建交易策略。扣好安全带，享受一次美妙的旅程！</p><p id="f1fe" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">在此之前，先说明一下什么是算法交易。算法交易是使计算机能够在一定条件或规则下交易股票的过程。当给定的条件得到满足时，交易将由计算机自动执行。此外，这些条件只不过是人类交易员给计算机的交易策略。</p><p id="5082" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">在继续之前，如果你想在没有任何代码的情况下回溯测试你的交易策略，有一个解决方案。是<a class="ae hv" href="https://www.backtestzone.com/" rel="noopener ugc nofollow" target="_blank">回测区</a>。这是一个平台，可以免费对不同类型的可交易资产的任意数量的交易策略进行回溯测试，无需编码。点击这里的链接，你可以马上使用这个工具:<a class="ae hv" href="https://www.backtestzone.com/" rel="noopener ugc nofollow" target="_blank">https://www.backtestzone.com/</a></p><h1 id="9191" class="kj kk hy bd kl km kn ko kp kq kr ks kt je ku jf kv jh kw ji kx jk ky jl kz la bi translated">布林线</h1><p id="0c2b" class="pw-post-body-paragraph jn jo hy jp b jq lb iz js jt lc jc jv jw ld jy jz ka le kc kd ke lf kg kh ki hb bi translated">在开始探索布林线之前，有必要知道什么是简单移动平均线。简单移动平均线只不过是给定一段时间内股票的平均价格。现在，布林线是在特定的标准差水平上，在给定股票的SMA上下绘制的趋势线。为了更好地理解布林线，请看下面的图表，它代表了用SMA 20计算的特斯拉股票的布林线</p><figure class="lh li lj lk fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lg"><img src="../Images/ab69d117eac26719dbbe3876041f988a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FoRg8-TSL0VUCqhB4vPLWQ.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">作者图片</figcaption></figure><p id="3d71" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">布林线是观察一段时间内给定股票波动的好方法。当上下波段之间的空间或距离越小时，股票的波动性越低。同样，当上下波段之间的空间或距离越大，股票的波动水平越高。在观察图表时，你可以观察到一条名为“中间BB 20”的趋势线，它就是特斯拉股票的SMA 20。计算股票上限和下限的公式如下:</p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="e67a" class="lq kk hy lm b fi lr ls l lt lu"><strong class="lm hz">UPPER_BB = STOCK SMA + SMA STANDARD DEVIATION * 2<br/>LOWER_BB = STOCK SMA - SMA STANDARD DEVIATION * 2</strong></span></pre><p id="4808" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">现在，我们已经了解了什么是布林线，所以让我们获得一些直觉的交易策略，我们将建立使用布林线。</p><p id="61d0" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated"><strong class="jp hz">关于交易策略:</strong>我们将使用布林线指标实施一项基本交易策略，如果前一天的股价高于前一天的下限，而当前股价低于当天的下限，该指标将发出买入信号。同样，如果前一天的股价小于前一天的上波段，而当前股价大于当天的上波段，该策略将显示卖出信号。我们的布林线交易策略可以表示如下:</p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="a85d" class="lq kk hy lm b fi lr ls l lt lu"><strong class="lm hz">IF PREV_STOCK &gt; PREV_LOWERBB &amp; CUR_STOCK &lt; CUR_LOWER_BB =&gt; BUY<br/>IF PREV_STOCK &lt; PREV_UPPERBB &amp; CUR_STOCK &gt; CUR_UPPER_BB =&gt; SELL</strong></span></pre><p id="bde1" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">现在我们已经了解了我们的布林线交易策略。所以，让我们继续用python来构建和实现它。</p><h1 id="8f62" class="kj kk hy bd kl km kn ko kp kq kr ks kt je ku jf kv jh kw ji kx jk ky jl kz la bi translated">用Python实现</h1><p id="af2e" class="pw-post-body-paragraph jn jo hy jp b jq lb iz js jt lc jc jv jw ld jy jz ka le kc kd ke lf kg kh ki hb bi translated">我们将实现之前在python中讨论过的交易策略，看看它在现实世界中的效果如何。</p><h2 id="20ec" class="lq kk hy bd kl lv lw lx kp ly lz ma kt jw mb mc kv ka md me kx ke mf mg kz mh bi translated">导入包</h2><p id="3deb" class="pw-post-body-paragraph jn jo hy jp b jq lb iz js jt lc jc jv jw ld jy jz ka le kc kd ke lf kg kh ki hb bi translated">在编码我们的交易策略之前，将所需的包导入到我们的python环境中是非常重要的。主要的包是用于数据操作的Pandas，用于绘图目的的Matplotlib和用于计算的NumPy。额外的包将是数学函数的Math，从API提取股票数据的请求，以及字体定制的Termcolor。</p><p id="a693" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated"><strong class="jp hz"> Python实现:</strong></p><figure class="lh li lj lk fd hk"><div class="bz dy l di"><div class="mi mj l"/></div></figure><p id="05fe" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">我们已经将所有需要的包导入到我们的python环境中。现在让我们从IEX云中提取特斯拉(TSLA)的历史数据。在继续之前，如果你不知道什么是IEX云，以及如何从中提取数据，我强烈推荐你查看我关于它的文章(<a class="ae hv" rel="noopener" href="/codex/pulling-stock-data-from-iex-cloud-with-python-d44f63bb82e0">点击此处查看文章</a>)。来拉点数据吧！</p><h2 id="a890" class="lq kk hy bd kl lv lw lx kp ly lz ma kt jw mb mc kv ka md me kx ke mf mg kz mh bi translated">从IEX云中提取数据</h2><p id="4a02" class="pw-post-body-paragraph jn jo hy jp b jq lb iz js jt lc jc jv jw ld jy jz ka le kc kd ke lf kg kh ki hb bi translated">在这一步中，我们将使用IEX云提供的API提取Tesla的历史数据。</p><p id="eb03" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated"><strong class="jp hz"> Python实现:</strong></p><figure class="lh li lj lk fd hk"><div class="bz dy l di"><div class="mi mj l"/></div></figure><p id="91da" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated"><strong class="jp hz">输出:</strong></p><figure class="lh li lj lk fd hk er es paragraph-image"><div class="er es mk"><img src="../Images/8486369299b85079ef254a4142e5fd23.png" data-original-src="https://miro.medium.com/v2/resize:fit:1354/format:webp/1*wWlP6UtQqwY6v1Qet2A1TA.png"/></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">作者图片</figcaption></figure><p id="d083" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated"><strong class="jp hz">代码解释:</strong>首先，我们定义一个名为“get _ historic _ data”的函数，它将股票的代码(‘symbol’)作为参数。在函数内部，我们将API键和URL存储到它们各自的变量中，然后使用请求包提供的“GET”方法，以JSON格式提取数据。接下来，我们将执行一些数据操作任务来清理数据并使其可用。最后，我们返回数据帧。定义完函数后，我们调用它并将数据存储到‘tsla’变量中。现在，让我们从提取的数据中计算出布林线的值。</p><h2 id="76fc" class="lq kk hy bd kl lv lw lx kp ly lz ma kt jw mb mc kv ka md me kx ke mf mg kz mh bi translated">布林线计算</h2><p id="d698" class="pw-post-body-paragraph jn jo hy jp b jq lb iz js jt lc jc jv jw ld jy jz ka le kc kd ke lf kg kh ki hb bi translated">这一步进一步分为两个部分。第一部分是计算SMA值，第二部分是计算布林线。</p><p id="1833" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated"><strong class="jp hz">计算SMA值:</strong>在这一部分，我们将计算周期数为20的特斯拉的SMA值。</p><p id="87ee" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">Python实现:</p><figure class="lh li lj lk fd hk"><div class="bz dy l di"><div class="mi mj l"/></div></figure><p id="c1c4" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">输出:</p><figure class="lh li lj lk fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ml"><img src="../Images/c77bb7814e112d1925e60a86220cfda1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mZ_SZDdzsyW2V5Y8dZWiQQ.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">作者图片</figcaption></figure><p id="5ffc" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">代码解释:首先，我们定义一个名为“sma”的函数，它将股票价格(“数据”)和周期数(“窗口”)作为参数。在函数内部，我们使用Pandas包提供的“滚动”函数来计算给定周期数的SMA。我们将计算出的值存储到“sma”变量中并返回它。接下来，我们调用函数并计算周期数为20的SMA值。现在，让我们来计算布林线。</p><p id="6c6c" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated"><strong class="jp hz">计算布林线:</strong>在这一部分，我们将使用之前创建的SMA值来计算Tesla的布林线值。</p><p id="1035" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">Python实现:</p><figure class="lh li lj lk fd hk"><div class="bz dy l di"><div class="mi mj l"/></div></figure><p id="d457" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">输出:</p><figure class="lh li lj lk fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mm"><img src="../Images/ceb215bf191547908880b93128a3b150.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*erjoXjTncgA_uDQJqGEalQ.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">作者图片</figcaption></figure><p id="d77d" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">代码解释:首先，我们定义一个名为“bb”的函数，它将股票价格(“数据”)、sma值(“SMA”)和周期数作为参数(“窗口”)。在函数内部，我们使用“滚动”和“标准”函数来计算给定股票数据的标准偏差，并将计算出的标准偏差值存储到“标准”变量中。接下来，我们使用各自的公式计算布林线值，最后，我们返回计算值。我们使用创建的“bb”函数将布林线值存储到我们的“tsla”数据框架中。</p><h2 id="a3b1" class="lq kk hy bd kl lv lw lx kp ly lz ma kt jw mb mc kv ka md me kx ke mf mg kz mh bi translated">绘制布林线值</h2><p id="5b87" class="pw-post-body-paragraph jn jo hy jp b jq lb iz js jt lc jc jv jw ld jy jz ka le kc kd ke lf kg kh ki hb bi translated">在这一步中，我们将绘制计算出的布林线值，以使它们更有意义。</p><p id="6eae" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated"><strong class="jp hz"> Python实现:</strong></p><figure class="lh li lj lk fd hk"><div class="bz dy l di"><div class="mi mj l"/></div></figure><p id="4665" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated"><strong class="jp hz">输出:</strong></p><figure class="lh li lj lk fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lg"><img src="../Images/309f4aad4e669c191a889ad20fe2a411.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F_-INBr3Qz1CbNGKAV75Vw.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">作者图片</figcaption></figure><p id="202a" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated"><strong class="jp hz">代码解释:</strong>使用Matplotlib包提供的“plot”函数，我们绘制了布林值以及特斯拉的“收盘”价格。现在我们来观察这个图表。浅蓝色线代表特斯拉的“接近”价格，黑色虚线代表较低和较高的波段。类似地，灰色虚线代表特斯拉的中间带或SMA 20值。我们还可以观察到，上下波段之间的空间在不同的时间变窄或变宽，代表股票的波动性(<code class="du mn mo mp lm b">wider == high volatility</code>，反之亦然)。</p><h2 id="b37b" class="lq kk hy bd kl lv lw lx kp ly lz ma kt jw mb mc kv ka md me kx ke mf mg kz mh bi translated">创建交易策略</h2><p id="e131" class="pw-post-body-paragraph jn jo hy jp b jq lb iz js jt lc jc jv jw ld jy jz ka le kc kd ke lf kg kh ki hb bi translated">在这一步，我们将在python中实现讨论过的布林线交易策略。</p><p id="85f9" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated"><strong class="jp hz"> Python实现:</strong></p><figure class="lh li lj lk fd hk"><div class="bz dy l di"><div class="mi mj l"/></div></figure><p id="759b" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated"><strong class="jp hz">代码解释:</strong>首先，我们定义一个名为‘implement _ bb _ strategy’的函数，它将股票价格(‘data’)、较低波段值(‘lower _ bb’)和较高波段值(‘upper _ bb’)作为参数。</p><p id="5513" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">在该函数中，我们创建了三个空列表(buy_price、sell_price和bb_signal ),在创建交易策略时，将在这些列表中追加值。</p><p id="3a87" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">之后，我们通过for循环实施交易策略。在for循环内部，我们传递某些条件，如果条件得到满足，相应的值将被追加到空列表中。如果购买股票的条件得到满足，买入价将被追加到“buy_price”列表中，信号值将被追加为1，表示购买股票。类似地，如果卖出股票的条件得到满足，卖价将被追加到“sell_price”列表中，信号值将被追加为-1，表示卖出股票。</p><p id="fd68" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">最后，我们返回附加了值的列表。然后，我们调用创建的函数并将值存储到各自的变量中。除非我们画出这些值，否则这个列表没有任何意义。所以，让我们画出创建的交易列表的值。</p><h2 id="96f6" class="lq kk hy bd kl lv lw lx kp ly lz ma kt jw mb mc kv ka md me kx ke mf mg kz mh bi translated">绘制交易清单</h2><p id="6be0" class="pw-post-body-paragraph jn jo hy jp b jq lb iz js jt lc jc jv jw ld jy jz ka le kc kd ke lf kg kh ki hb bi translated">在这一步，我们将绘制已创建的交易列表，以使它们有意义。</p><p id="fd9b" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated"><strong class="jp hz"> Python实现:</strong></p><figure class="lh li lj lk fd hk"><div class="bz dy l di"><div class="mi mj l"/></div></figure><p id="dc23" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated"><strong class="jp hz">输出:</strong></p><figure class="lh li lj lk fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lg"><img src="../Images/e3b173f0832d17d97a1cd2dfd3808737.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*prvwODl0S2Oh5SLCgwLGIA.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">作者图片</figcaption></figure><p id="41ba" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated"><strong class="jp hz">代码解释:</strong>我们正在绘制布林线值以及交易策略产生的买入和卖出信号。我们可以观察到，每当股票的收盘价(浅蓝色线)低于较低波段(较低的黑色虚线)时，买入信号用绿色绘制，类似地，每当股票的收盘价越过较高波段(较高的黑色虚线)时，卖出信号用红色绘制。</p><p id="333a" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">现在，使用交易信号，让我们建立我们的股票头寸。</p><h2 id="ac98" class="lq kk hy bd kl lv lw lx kp ly lz ma kt jw mb mc kv ka md me kx ke mf mg kz mh bi translated">创建我们的位置</h2><p id="569f" class="pw-post-body-paragraph jn jo hy jp b jq lb iz js jt lc jc jv jw ld jy jz ka le kc kd ke lf kg kh ki hb bi translated">在这一步中，我们将创建一个列表，如果我们持有股票，该列表将指示1；如果我们不拥有或持有股票，该列表将指示0。</p><p id="a110" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated"><strong class="jp hz"> Python实现:</strong></p><figure class="lh li lj lk fd hk"><div class="bz dy l di"><div class="mi mj l"/></div></figure><p id="aae5" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated"><strong class="jp hz">输出:</strong></p><figure class="lh li lj lk fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mq"><img src="../Images/0b16d3306b2af18f34b478f66991ecab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HSJHHGOb3f7jQn7MN8agsw.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">作者图片</figcaption></figure><p id="ebd4" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated"><strong class="jp hz">代码解释:</strong>首先，我们创建一个名为‘position’的空列表。我们传递两个for循环，一个是为“位置”列表生成值，以匹配“信号”列表的长度。另一个for循环是我们用来生成实际位置值的循环。在第二个for循环中，我们对“signal”列表的值进行迭代，而“position”列表的值被附加到满足哪个条件上。如果我们持有股票，头寸的价值仍为1；如果我们卖出或不持有股票，头寸的价值仍为0。最后，我们正在进行一些数据操作，将所有创建的列表合并到一个数据帧中。</p><p id="8fdb" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">从显示的输出中，我们可以看到，从第318–320行，我们在股票中的头寸保持为1(因为布林带信号没有任何变化)，但当布林带交易信号代表卖出信号(-1)时，我们的头寸突然变为0。</p><p id="a091" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">现在是时候实现一些回溯测试过程了！</p><h2 id="0726" class="lq kk hy bd kl lv lw lx kp ly lz ma kt jw mb mc kv ka md me kx ke mf mg kz mh bi translated">回溯测试</h2><p id="20e7" class="pw-post-body-paragraph jn jo hy jp b jq lb iz js jt lc jc jv jw ld jy jz ka le kc kd ke lf kg kh ki hb bi translated">在继续之前，有必要知道什么是回溯测试。回溯测试是查看我们的交易策略在给定股票数据上表现如何的过程。在我们的案例中，我们将对特斯拉股票数据的布林线交易策略实施回溯测试流程。</p><p id="2866" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated"><strong class="jp hz"> Python实现:</strong></p><figure class="lh li lj lk fd hk"><div class="bz dy l di"><div class="mi mj l"/></div></figure><p id="f2fc" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated"><strong class="jp hz">输出:</strong></p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="97f4" class="lq kk hy lm b fi lr ls l lt lu"><strong class="lm hz">Profit gained from the BB strategy by investing $100k in TSLA : 18426.42</strong><br/><strong class="lm hz">Profit percentage of the BB strategy : 18%</strong></span></pre><p id="e600" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated"><strong class="jp hz">代码解释:</strong>首先，我们使用NumPy包提供的‘diff’函数计算Tesla股票的回报，并将其作为数据帧存储到‘tsla _ ret’变量中。接下来，我们将传递一个for循环来迭代' tsla_ret '变量的值，以计算我们从布林线交易策略中获得的回报，这些回报值将被追加到' bb_strategy_ret '列表中。接下来，我们将“bb_strategy_ret”列表转换为数据帧，并将其存储到“bb_strategy_ret_df”变量中。</p><p id="0e6f" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">接下来是回溯测试过程。我们将通过投资10万美元到我们的交易策略中来回测我们的策略。首先，我们将投资金额存储到“投资值”变量中。之后，我们正在计算使用投资金额可以购买的特斯拉股票数量。你可以注意到，我使用了Math package提供的“floor”函数，因为当投资金额除以特斯拉股票的收盘价时，它会输出一个十进制数。股票数量应该是整数，而不是小数。使用“底数”函数，我们可以去掉小数。请记住,“floor”函数比“round”函数要复杂得多。然后，我们传递一个for循环来寻找投资回报，随后是一些数据操作任务。</p><p id="f5fe" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">最后，我们打印了我们通过投资10万到我们的交易策略中得到的总回报，并且显示我们在一年中获得了大约18500美元的利润。那还不错！现在，让我们将我们的回报与SPY ETF(一种旨在跟踪标准普尔500股票市场指数的ETF)的回报进行比较。</p><h2 id="9d81" class="lq kk hy bd kl lv lw lx kp ly lz ma kt jw mb mc kv ka md me kx ke mf mg kz mh bi translated">SPY ETF对比</h2><p id="5ae4" class="pw-post-body-paragraph jn jo hy jp b jq lb iz js jt lc jc jv jw ld jy jz ka le kc kd ke lf kg kh ki hb bi translated">这一步是可选的，但强烈推荐，因为我们可以了解我们的交易策略相对于基准(间谍ETF)的表现如何。在这一步中，我们将使用我们创建的“get _ historic _ data”函数提取SPY ETF的数据，并将我们从SPY ETF获得的回报与我们在Tesla上的Bollinger Bands策略回报进行比较。</p><p id="fac4" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated"><strong class="jp hz"> Python实现:</strong></p><figure class="lh li lj lk fd hk"><div class="bz dy l di"><div class="mi mj l"/></div></figure><p id="2c8c" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated"><strong class="jp hz">输出:</strong></p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="76f9" class="lq kk hy lm b fi lr ls l lt lu"><strong class="lm hz">Benchmark profit by investing $100k : 13270.5</strong><br/><strong class="lm hz">Benchmark Profit percentage : 13%</strong><br/><strong class="lm hz">BB Strategy profit is 5% higher than the Benchmark Profit</strong></span></pre><p id="1ec0" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated"><strong class="jp hz">代码解释:</strong>此步骤中使用的代码几乎与前一回测步骤中使用的代码相似，但我们不是投资特斯拉，而是通过不实施任何交易策略来投资SPY ETF。从输出可以看出，我们的布林带交易策略已经跑赢了SPY ETF 5%。太好了！</p><h1 id="036f" class="kj kk hy bd kl km kn ko kp kq kr ks kt je ku jf kv jh kw ji kx jk ky jl kz la bi translated">结论</h1><p id="c747" class="pw-post-body-paragraph jn jo hy jp b jq lb iz js jt lc jc jv jw ld jy jz ka le kc kd ke lf kg kh ki hb bi translated">在本文中，我们学习了一个新的股票技术指标，即布林线，以及用python实现和回溯测试布林线交易策略的方法。我们在这篇文章中实施的交易策略是一个基本的，但也有很多基于布林线的交易策略可以应用。人们认为布林线不适合算法交易，但如果交易策略正确，它们会很有效。还有几种方法可以改进这篇文章，它们是:</p><ul class=""><li id="125c" class="mr ms hy jp b jq jr jt ju jw mt ka mu ke mv ki mw mx my mz bi translated"><strong class="jp hz">选股:</strong>在本文中，我们随机选择了特斯拉，但这在现实世界中并不是一个明智的决定。相反，可以应用机器学习算法来挑选正确的可交易股票。这一步是现实世界中算法交易的一个非常重要的部分，如果股票是随机选择的，结果将是灾难性的。</li><li id="7f59" class="mr ms hy jp b jq na jt nb jw nc ka nd ke ne ki mw mx my mz bi translated"><strong class="jp hz">策略改进:</strong>正如我之前所说，我们在这篇文章中使用的交易策略是初级策略，在现实世界中不会有特别的表现。所以，强烈建议发现更多的布林线策略，并用python实现它们。</li></ul><p id="f007" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">就是这样！如果您忘记了遵循任何编码部分，不要担心！我在最后提供了本文的完整源代码。希望你从这篇文章中对布林线有所了解。</p><p id="917f" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated"><strong class="jp hz">完整代码:</strong></p><figure class="lh li lj lk fd hk"><div class="bz dy l di"><div class="mi mj l"/></div></figure></div></div>    
</body>
</html>