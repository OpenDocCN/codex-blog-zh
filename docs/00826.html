<html>
<head>
<title>Algorithmic Trading with SMA in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python中使用SMA的算法交易</h1>
<blockquote>原文：<a href="https://medium.com/codex/algorithmic-trading-with-sma-in-python-7d66008d37b1?source=collection_archive---------1-----------------------#2021-03-21">https://medium.com/codex/algorithmic-trading-with-sma-in-python-7d66008d37b1?source=collection_archive---------1-----------------------#2021-03-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><h2 id="72aa" class="hg hh hi bd b fp hj hk hl hm hn ho dx hp translated" aria-label="kicker paragraph"><a class="ae ge" href="http://medium.com/codex" rel="noopener">法典</a></h2><div class=""/><div class=""><h2 id="5522" class="pw-subtitle-paragraph io hr hi bd b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf dx translated">用python创建和回溯测试SMA交易策略</h2></div><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es jg"><img src="../Images/8912266bcad1a55ce06f46e91dc3b9ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*btvUZDVM_8XqbtrK"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx translated">由<a class="ae jw" href="https://unsplash.com/@markusspiske?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">马库斯·斯皮斯克</a>在<a class="ae jw" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="bffa" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated"><strong class="jz hs">免责声明:</strong>本文严格用于教育目的，不应作为投资提示。</p><h1 id="3988" class="kt ku hi bd kv kw kx ky kz la lb lc ld ix le iy lf ja lg jb lh jd li je lj lk bi translated">介绍</h1><p id="6100" class="pw-post-body-paragraph jx jy hi jz b ka ll is kc kd lm iv kf kg ln ki kj kk lo km kn ko lp kq kr ks hb bi translated">随着越来越多的技术创新，许多行业摒弃了传统的方法，并希望进入最新的技术，以保持自己的更新。金融业也是如此！在过去的几年里，金融行业发生了很多事情。大量的金融技术解决方案被发明和增强。在这篇文章中，我们将看到金融领域一项引人注目的技术创新，它是股票交易领域的一次巨大飞跃，那就是算法交易！让我们更深入地探讨这个话题。</p><h1 id="d8c8" class="kt ku hi bd kv kw kx ky kz la lb lc ld ix le iy lf ja lg jb lh jd li je lj lk bi translated">算法交易</h1><p id="9978" class="pw-post-body-paragraph jx jy hi jz b ka ll is kc kd lm iv kf kg ln ki kj kk lo km kn ko lp kq kr ks hb bi translated">在大多数情况下，股票交易会受到人类情绪或非理性思维的影响(有时)。因此，它反映了该交易员所做的大多数交易的糟糕结果。人们在思考一种交易方法，在这种方法中，他们可以把自己的情绪放在一边，算法交易的概念就是在这个时候被发明的。算法交易是使计算机能够在一定条件或规则下交易股票的过程。当给定的条件得到满足时，交易将由计算机自动执行。同样，这些条件是由人类交易员提供给计算机的。交易策略的条件是由人类交易者定义的。</p><p id="5032" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">在本文中，我们将使用简单移动平均线(SMA)技术指标来创建交易策略。在继续之前，如果你想在没有任何代码的情况下回溯测试你的交易策略，有一个解决方案。是<a class="ae jw" href="https://www.backtestzone.com/" rel="noopener ugc nofollow" target="_blank">回测区</a>。这是一个平台，可以免费对不同类型的可交易资产的任意数量的交易策略进行回溯测试，无需编码。点击这里的链接，你可以马上使用这个工具:<a class="ae jw" href="https://www.backtestzone.com/" rel="noopener ugc nofollow" target="_blank">https://www.backtestzone.com/</a></p><h1 id="a362" class="kt ku hi bd kv kw kx ky kz la lb lc ld ix le iy lf ja lg jb lh jd li je lj lk bi translated">简单移动平均线</h1><p id="3006" class="pw-post-body-paragraph jx jy hi jz b ka ll is kc kd lm iv kf kg ln ki kj kk lo km kn ko lp kq kr ks hb bi translated">简单移动平均线(SMA)无非是特定时间段的平均价格。它是一个技术指标，广泛用于创建交易策略。通常计算两个SMA来构建交易策略，一个周期短，另一个周期比第一个长。现在，让我们对本文中的交易策略有一个直觉。</p><p id="e313" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated"><strong class="jz hs">关于交易策略:</strong>我们的交易策略将是一个简单的交叉策略，当用较短周期计算的SMA在用较长周期计算的SMA上方交叉时，计算机进行交易。同样，当用较长周期计算的SMA超过用较短周期计算的SMA时，计算机卖出股票。这就是我们交易策略的条件:</p><pre class="jh ji jj jk fd lq lr ls lt aw lu bi"><span id="c64d" class="lv ku hi lr b fi lw lx l ly lz"><strong class="lr hs">IF SMA(SHORT PERIOD) &gt; SMA(LONG PERIOD) =&gt; BUY<br/>IF SMA(LONG PERIOD) &gt; SMA(SHORT PERIOD) =&gt; SELL</strong></span></pre><p id="7eca" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">至此，我们完成了理论部分。现在让我们用python实现交易策略，并看看它的实际效果。</p><h1 id="a119" class="kt ku hi bd kv kw kx ky kz la lb lc ld ix le iy lf ja lg jb lh jd li je lj lk bi translated">用Python实现</h1><p id="8797" class="pw-post-body-paragraph jx jy hi jz b ka ll is kc kd lm iv kf kg ln ki kj kk lo km kn ko lp kq kr ks hb bi translated">现在，我们要用python编写我们的交易策略，看看效果如何。</p><h2 id="6ec6" class="lv ku hi bd kv ma mb mc kz md me mf ld kg mg mh lf kk mi mj lh ko mk ml lj ho bi translated">导入包</h2><p id="4d52" class="pw-post-body-paragraph jx jy hi jz b ka ll is kc kd lm iv kf kg ln ki kj kk lo km kn ko lp kq kr ks hb bi translated">在这一步中，我们将把所需的包导入到我们的python环境中。主要的包将是处理数据帧的Pandas，创建绘图的Matplotlib，进行API调用的请求，处理数组的NumPy。附加的包是Math，用于执行数学计算，以及Termcolor，用于在python中自定义字体。</p><p id="a94d" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated"><strong class="jz hs"> Python实现:</strong></p><figure class="jh ji jj jk fd jl"><div class="bz dy l di"><div class="mm mn l"/></div></figure><p id="3be9" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">我们已经将所有需要的包导入到我们的python环境中。现在让我们从IEX云中提取微软(MSFT)的历史数据。在继续之前，如果你不知道什么是IEX云，以及如何从中提取数据，我强烈推荐你查看我关于它的文章(<a class="ae jw" rel="noopener" href="/codex/pulling-stock-data-from-iex-cloud-with-python-d44f63bb82e0">点击此处查看文章</a>)。来拉点数据吧！</p><h2 id="7065" class="lv ku hi bd kv ma mb mc kz md me mf ld kg mg mh lf kk mi mj lh ko mk ml lj ho bi translated">从IEX云中提取数据</h2><p id="9069" class="pw-post-body-paragraph jx jy hi jz b ka ll is kc kd lm iv kf kg ln ki kj kk lo km kn ko lp kq kr ks hb bi translated">在这一步中，我们将使用IEX云提供的API提取微软的历史数据。</p><p id="0109" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated"><strong class="jz hs"> Python实现:</strong></p><figure class="jh ji jj jk fd jl"><div class="bz dy l di"><div class="mm mn l"/></div></figure><p id="3ac5" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated"><strong class="jz hs">输出:</strong></p><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es mo"><img src="../Images/b91dc84952048d49a857840f8b65929d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m3B3YE3lsGtsYsBwWNDVZw.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx translated">作者图片</figcaption></figure><p id="0282" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated"><strong class="jz hs">代码解释:</strong>首先，我们定义一个名为“get _ historic _ data”的函数，它将股票代码作为参数。在函数内部，我们将API键和URL存储到它们各自的变量中，然后使用请求包提供的“GET”方法，以JSON格式提取数据。接下来，我们将执行一些数据操作任务来清理数据并使其可用。最后，我们返回数据帧。定义完函数后，我们调用它并将数据存储到' msft '变量中。让我们从提取的数据中计算出SMA值。</p><h2 id="b2b0" class="lv ku hi bd kv ma mb mc kz md me mf ld kg mg mh lf kk mi mj lh ko mk ml lj ho bi translated">SMA计算</h2><p id="2489" class="pw-post-body-paragraph jx jy hi jz b ka ll is kc kd lm iv kf kg ln ki kj kk lo km kn ko lp kq kr ks hb bi translated">在这一步中，我们将计算两个SMA值(SMA 20，50)并将这些值附加到我们的数据帧中。</p><p id="b259" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated"><strong class="jz hs"> Python实现:</strong></p><figure class="jh ji jj jk fd jl"><div class="bz dy l di"><div class="mm mn l"/></div></figure><p id="f45f" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated"><strong class="jz hs">输出:</strong></p><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es mp"><img src="../Images/12fe951b8f0e65e9d1d767662dc31ee6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0L2xjCKWHQNsSuyDPvfgow.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx translated">作者图片</figcaption></figure><p id="b391" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated"><strong class="jz hs">代码解释:</strong>首先，我们定义一个名为‘SMA’的函数，它以数据和周期数为参数。在函数内部，我们使用Pandas包提供的“滚动”函数来计算给定周期数的SMA。我们将计算出的值存储到“sma”变量中并返回它。接下来，我们调用函数并计算两个SMA值，较短的一个值为周期数20，较长的一个值为周期数50。现在，让我们用计算出的SMA值做一个图。</p><h2 id="2074" class="lv ku hi bd kv ma mb mc kz md me mf ld kg mg mh lf kk mi mj lh ko mk ml lj ho bi translated">绘制SMA值</h2><p id="cadc" class="pw-post-body-paragraph jx jy hi jz b ka ll is kc kd lm iv kf kg ln ki kj kk lo km kn ko lp kq kr ks hb bi translated">在这一步，我们将绘制计算出的SMA值，以使它们更有意义。</p><p id="1d96" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated"><strong class="jz hs"> Python实现:</strong></p><figure class="jh ji jj jk fd jl"><div class="bz dy l di"><div class="mm mn l"/></div></figure><p id="f743" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated"><strong class="jz hs">输出:</strong></p><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es mq"><img src="../Images/ec1b14fe77d106e7fb34e65b9f0378a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kxJQlu3TmtErXfyqFtBCRA.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx translated">作者图片</figcaption></figure><p id="27d9" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated"><strong class="jz hs">代码解释:</strong>使用Matplotlib包提供的“plot”函数，我们绘制了SMA值以及微软的“收盘”价格。现在我们来观察这个图表。浅蓝色线代表微软的“接近”价格，红色和金色线分别代表SMA 20 &amp; SMA 50。据观察，金线(SMA 50)比红线(SMA 20)平滑得多，因为金线值的指定时间段比红线值高得多。</p><p id="b095" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">现在我们有了SMA值。所以让我们继续创建交易策略。</p><h2 id="e230" class="lv ku hi bd kv ma mb mc kz md me mf ld kg mg mh lf kk mi mj lh ko mk ml lj ho bi translated">创建交易策略</h2><p id="c0f4" class="pw-post-body-paragraph jx jy hi jz b ka ll is kc kd lm iv kf kg ln ki kj kk lo km kn ko lp kq kr ks hb bi translated">在这一步中，我们将使用python实现所讨论的交易策略。</p><p id="2116" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated"><strong class="jz hs"> Python实现:</strong></p><figure class="jh ji jj jk fd jl"><div class="bz dy l di"><div class="mm mn l"/></div></figure><p id="effb" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated"><strong class="jz hs">代码解释:</strong>首先，我们定义一个名为‘implement _ sma _ strategy’的函数，它以数据和长短SMA的时间段作为参数。</p><p id="2cde" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">在函数内部，我们首先将指定的时间段存储到“sma1”和“sma2”变量中。接下来，我们将存储三个空列表，在创建交易策略时会将值追加到这些列表中。</p><p id="8f8e" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">之后，我们通过for循环实施交易策略。在for循环内部，我们传递某些条件，如果条件得到满足，相应的值将被追加到空列表中。如果购买股票的条件得到满足，买入价将被追加到“buy_price”列表中，信号值将被追加为1，表示购买股票。类似地，如果卖出股票的条件得到满足，卖价将被追加到“sell_price”列表中，信号值将被追加为-1，表示卖出股票。</p><p id="8cc9" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">最后，我们返回附加了值的列表。然后，我们调用创建的函数并将值存储到各自的变量中。除非我们画出这些值，否则这个列表没有任何意义。所以，让我们画出创建的交易列表的值。</p><h2 id="c286" class="lv ku hi bd kv ma mb mc kz md me mf ld kg mg mh lf kk mi mj lh ko mk ml lj ho bi translated">绘制交易清单</h2><p id="ec30" class="pw-post-body-paragraph jx jy hi jz b ka ll is kc kd lm iv kf kg ln ki kj kk lo km kn ko lp kq kr ks hb bi translated">在这一步，我们将绘制已创建的交易列表，以使它们有意义。</p><p id="4674" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated"><strong class="jz hs"> Python实现:</strong></p><figure class="jh ji jj jk fd jl"><div class="bz dy l di"><div class="mm mn l"/></div></figure><p id="e61c" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated"><strong class="jz hs">输出:</strong></p><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es mq"><img src="../Images/f090af968e639324746244152b73dd40.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uiRoHhS7M5sB1KKbHs573w.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx translated">作者图片</figcaption></figure><p id="895f" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated"><strong class="jz hs">代码解释:</strong>我们在绘制SMA值以及交易策略产生的买入和卖出信号。我们可以观察到，每当红线(SMA 20)越过金线(SMA 50)时，买入信号用蓝色绘制，类似地，每当金线越过红线时，卖出信号用红色绘制。</p><p id="326c" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">现在，使用交易信号，让我们建立我们的股票头寸。</p><h2 id="fc95" class="lv ku hi bd kv ma mb mc kz md me mf ld kg mg mh lf kk mi mj lh ko mk ml lj ho bi translated">创建我们的位置</h2><p id="1df4" class="pw-post-body-paragraph jx jy hi jz b ka ll is kc kd lm iv kf kg ln ki kj kk lo km kn ko lp kq kr ks hb bi translated">在这一步中，我们将创建一个列表，如果我们持有股票，该列表将指示1；如果我们不拥有或持有股票，该列表将指示0。</p><p id="1689" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated"><strong class="jz hs"> Python实现:</strong></p><figure class="jh ji jj jk fd jl"><div class="bz dy l di"><div class="mm mn l"/></div></figure><p id="3269" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated"><strong class="jz hs">输出:</strong></p><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es mr"><img src="../Images/674b3335e267e08d3a7bf90f997a8107.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6IqxgjuiXpP7i8B27hRR3Q.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx translated">作者图片</figcaption></figure><p id="cdd3" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated"><strong class="jz hs">代码解释:</strong>首先，我们创建一个名为‘position’的空列表。我们传递两个for循环，一个是为“位置”列表生成值，以匹配“信号”列表的长度。另一个for循环是我们用来生成实际位置值的循环。在第二个for循环中，我们对“signal”列表的值进行迭代，而“position”列表的值被附加到满足哪个条件上。如果我们持有股票，头寸的价值仍为1；如果我们卖出或不持有股票，头寸的价值仍为0。最后，我们正在进行一些数据操作，将所有创建的列表合并到一个数据帧中。</p><p id="b96f" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">从显示的输出中，我们可以看到，从第181–185行，我们在股票中的头寸保持为1(因为SMA信号没有任何变化)，但是当SMA交易信号代表卖出信号(-1)时，我们的头寸突然变为0。</p><p id="7318" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">现在是时候实现一些回溯测试过程了！</p><h2 id="fa87" class="lv ku hi bd kv ma mb mc kz md me mf ld kg mg mh lf kk mi mj lh ko mk ml lj ho bi translated">回溯测试</h2><p id="7354" class="pw-post-body-paragraph jx jy hi jz b ka ll is kc kd lm iv kf kg ln ki kj kk lo km kn ko lp kq kr ks hb bi translated">在继续之前，有必要知道什么是回溯测试。回溯测试是查看我们的交易策略在给定股票数据上表现如何的过程。在我们的例子中，我们将对微软股票数据实现SMA交叉策略的回溯测试过程。</p><p id="cdb2" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated"><strong class="jz hs"> Python实现:</strong></p><figure class="jh ji jj jk fd jl"><div class="bz dy l di"><div class="mm mn l"/></div></figure><p id="ecfe" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated"><strong class="jz hs">输出:</strong></p><pre class="jh ji jj jk fd lq lr ls lt aw lu bi"><span id="6d46" class="lv ku hi lr b fi lw lx l ly lz"><strong class="lr hs">Profit gained from the strategy by investing $100K in MSFT : $19971.23 in 1 Year</strong></span></pre><p id="441c" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated"><strong class="jz hs">代码解释:</strong>首先，我们使用NumPy包提供的“diff”函数计算微软股票的回报率，并将其作为数据帧存储到“msft_ret”变量中。接下来，我们传递一个for循环来迭代' msft_ret '变量的值，以计算我们从SMA交易策略中获得的回报，这些回报值被附加到' sma_strategy_ret '列表中。接下来，我们将“sma_strategy_ret”列表转换为数据帧，并将其存储到“sma_strategy_ret_df”变量中。</p><p id="c938" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">接下来是回溯测试过程。我们将通过投资10万美元到我们的交易策略中来回测我们的策略。首先，我们将投资金额存储到“投资值”变量中。之后，我们正在计算使用投资金额可以购买的微软股票数量。你可以注意到，我使用了Math软件包提供的“下限”函数，因为当投资金额除以微软股票的收盘价时，它会输出一个十进制数。股票数量应该是整数，而不是小数。使用“底数”函数，我们可以去掉小数。请记住,“floor”函数比“round”函数要复杂得多。然后，我们传递一个for循环来寻找投资回报，随后是一些数据操作任务。</p><p id="e4e5" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">最后，我们打印了我们通过投资10万美元到我们的交易策略中得到的总回报，并且显示我们在一年中获得了大约2万美元的利润。那还不错！</p><h1 id="4e1a" class="kt ku hi bd kv kw kx ky kz la lb lc ld ix le iy lf ja lg jb lh jd li je lj lk bi translated">最后的想法！</h1><p id="dd3c" class="pw-post-body-paragraph jx jy hi jz b ka ll is kc kd lm iv kf kg ln ki kj kk lo km kn ko lp kq kr ks hb bi translated">从探索什么是算法交易和SMA，到用python实现和回溯测试我们的交易策略，我们走过了漫长的道路。我们的代码还有很多改进的空间，可以获得更好的结果。一些方法是使用机器学习找到最佳股票来执行交易策略，调整和改进交易策略等。也有很多软件包可以用来对股票进行技术分析，但在本文中，我们只使用了初步的软件包，这样我们就可以直观地了解我们到底要构建什么。就是这样！如果您忘记了遵循任何编码部分，不要担心。我已经提供了本文中使用的完整源代码。希望你能从这篇文章中学到一些有用的东西。</p><p id="f711" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated"><strong class="jz hs">完整代码:</strong></p><figure class="jh ji jj jk fd jl"><div class="bz dy l di"><div class="mm mn l"/></div></figure></div></div>    
</body>
</html>