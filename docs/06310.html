<html>
<head>
<title>ARIMA models for Time Series Analysis and Forecasting</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">时间序列分析和预测的ARIMA模型</h1>
<blockquote>原文：<a href="https://medium.com/codex/arima-models-for-time-series-analysis-and-forecasting-508c4a060f85?source=collection_archive---------7-----------------------#2022-04-18">https://medium.com/codex/arima-models-for-time-series-analysis-and-forecasting-508c4a060f85?source=collection_archive---------7-----------------------#2022-04-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/1b8d808aed5242ef9c91a2092a797cc0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A-u4P6rXs4uKKzBUJVksvQ.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">萨姆·穆格迪钦在<a class="ae iu" href="https://unsplash.com/s/photos/pocket-watch?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><h1 id="3e30" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">摘要</h1><p id="243a" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">ARIMA模型是经济和金融中常用的预测未来的时间序列模型。在这里，我大致介绍了一下ARIMA模型，并展示了一个使用Python中的ARIMA来预测美国未来人口增长的例子。</p><p id="98a2" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">我进行以下分析的Jupyter笔记本可以在我的GitHub <a class="ae iu" href="https://github.com/cbarger233/ARIMA-Population-Analysis" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><h1 id="16cc" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">ARIMA到底是什么？</h1><p id="7ef9" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">ARIMA是一个首字母缩写词，描述了一种结合统计技术来建模和预测时间序列数据的方法。首字母缩写代表自回归综合移动平均。它在一个广义模型中结合了自回归和移动平均中使用的技术。</p><ul class=""><li id="5492" class="kw kx hi jv b jw kr ka ks ke ky ki kz km la kq lb lc ld le bi translated"><strong class="jv hj">自回归</strong>是一个利用一个与其自身相关的序列的过程。简而言之，对于时间序列数据，我们通常有一个变量，而在线性回归中，我们建立两个变量之间的关系。自回归使用序列的过去值来预测未来值。我们使用的过去值的数量表示为<em class="lf"> p </em>。</li><li id="f9ba" class="kw kx hi jv b jw lg ka lh ke li ki lj km lk kq lb lc ld le bi translated"><strong class="jv hj">综合</strong>是指对数据进行差分，使时间序列<em class="lf">平稳</em>的技术。为了对数据求差，我们找到当前值和之前值之间的差。我们需要对数据集进行差分以使其稳定的次数表示为<em class="lf"> d </em>。</li><li id="ebe4" class="kw kx hi jv b jw lg ka lh ke li ki lj km lk kq lb lc ld le bi translated"><strong class="jv hj">移动平均</strong>是一种模型，它考虑了数据集的平均值以及当前和过去的误差项来预测未来。我们在MA模型中使用的过去误差项的数量表示为<em class="lf"> q </em>。</li></ul><p id="7904" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">这三种方法结合起来形成了我们的ARIMA(p，d，q)模型。我发现学习的最好方法是通过例子(然后做)，所以让我们来看一个例子。</p><p id="de7c" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">我们正在看的数据来自美国人口普查局在T21发现的数据。将数据加载到pandas数据帧中，并将日期设置为索引，如下所示:</p><figure class="lm ln lo lp fd ij er es paragraph-image"><div class="er es ll"><img src="../Images/a9931cab85f02bf8364899d1b8a92c28.png" data-original-src="https://miro.medium.com/v2/resize:fit:404/0*1-SE7q9P_gfUruoj.PNG"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">人口数据集的前五行。</figcaption></figure><p id="570d" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">老实说，从Kaggle上的描述来看，这些数字是什么意思还不太清楚。我怀疑这些数字要么代表了几个月来美国的移民人数，要么只是总的人口增长/出生人数。无论哪种方式，人口数据很容易成为时间序列模型。这些数字从1952年1月开始，到2019年12月结束，我们总共可以处理816行数据。这些值按月递增。数据随时间变化的图表如下所示。</p><figure class="lm ln lo lp fd ij er es paragraph-image"><div class="er es lq"><img src="../Images/7f2c70afc7b4f59f6824f8d30910d633.png" data-original-src="https://miro.medium.com/v2/resize:fit:1152/format:webp/0*40O_UG7FbHms8l_L.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">人口数据随时间变化的图表。</figcaption></figure><h1 id="0be7" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">平稳性</h1><p id="0dbd" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">从图中可以看出，随着时间的推移，有明显的上升趋势。然而，对于ARIMA模型，我们需要我们的数据具有所谓的<em class="lf">平稳性</em>，这是上面提到的。为了使数据集被认为是稳定的，它需要在一段时间内具有恒定的均值和标准差。从上面的图表中，我们的数据显然不满足这个条件，因为它只是随着时间的推移而增加。</p><p id="80cc" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">为了使数据变得稳定，需要对数据进行变换。通常这是通过对数据求差来完成的。为了区别数据，我们只需要找到当前时间段的值和前一时间段的值之间的差异。这个概念可以推广到求第二差、第三差等。将差分方法应用于人口数据，我们发现我们的数据现在看起来像这样:</p><figure class="lm ln lo lp fd ij er es paragraph-image"><div class="er es lr"><img src="../Images/426f23a5b421a04719329589a7afc422.png" data-original-src="https://miro.medium.com/v2/resize:fit:864/format:webp/0*RdQDeCHOERqRHbXc.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">人口数据的第一个差异。</figcaption></figure><p id="3231" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">有人可能会说，这个数据比我们以前得到的数据更加稳定。有一个更明显的平均值，很可能在200左右，尽管它不是常数。标准偏差似乎也小于非差异数据的标准偏差。但是我们怎么知道我们的数据是否足够不同，可以用在ARIMA模型中呢？一种方法是使用扩展的迪基-富勒测验，该测验于1979年以统计学家大卫·迪基和韦恩·富勒的名字命名。简单地说，扩展的Dickey-Fuller检验(ADF)有一个零假设，即我们检验的数据是非平稳的。这意味着如果我们可以拒绝零假设，我们的数据就有必要的平稳性。</p><p id="33af" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">Python statsmodels库有一个内置的ADF，我在非差异和差异数据上使用它。对非差异数据执行ADF测试会产生-0.665的测试统计值和0.855的p值。在95%的置信度下，我们需要p值小于0.05才能拒绝零假设。因此，我们得到了预期的结果，即原始的、未修改的数据是不稳定的。</p><p id="3810" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">对差异数据执行ADF测试得到的测试统计值为-2.01，p值为0.282。p值仍然不够低，不足以让我们拒绝零假设，尽管它明显低于非差异数据。这表明数据具有某种平稳性。让我们再次对数据进行差分，希望我们有一个更稳定的数据集来处理。第二次求差导致我们的数据看起来像:</p><figure class="lm ln lo lp fd ij er es paragraph-image"><div class="er es lr"><img src="../Images/301f656e2a2dcef1c489094d3fc140b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:864/format:webp/0*efaWOZKRwynjZM6y.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">人口数据的第二个差异。</figcaption></figure><p id="2cf0" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">上图更能说明一个稳定的数据集。它有一个明显的平均值0，没有任何明显的趋势，除了一些向上和向下的尖峰。这表明它始终保持不变。此外，对转换后的数据进行ADF测试会产生一个接近于零的p值(2.11e-10)。由于我们的p值小于0.05，我们有足够的统计证据表明我们的数据现在是稳定的。基于这一发现，我们可以考虑在我们的ARIMA(p，d，q)模型中使用d=2的值，因为我们对数据进行两次差分以使其稳定。为了找到p和q的值，我们需要查看ACF和PACF图。</p><h1 id="66e8" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">ACF和PACF图</h1><p id="b8a1" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">ARIMA(p，d，q)模型中的“p”项告诉我们，我们将在时间序列数据中使用多少时间段的滞后。为了找到p，我们看一下自相关函数(ACF)的曲线图。ACF图告诉我们时间序列中的值之间的相关程度。在y轴上我们绘制了相关系数，在x轴上我们绘制了时间周期滞后量。我们的数据中有每个月的人口测量，因此一个滞后值等于过去的一个月。</p><h1 id="001a" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">ACF图</h1><p id="d769" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">让我们看看一阶和二阶差分人口数据的ACF图。Python中的statsmodels包有一个内置函数来完成这项工作:</p><figure class="lm ln lo lp fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ls"><img src="../Images/33cdceb463783fd6bf29b61b9b6df212.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*n9aSCINLmQX_41U0.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">一阶和二阶差分数据的ACF图。</figcaption></figure><p id="64c6" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">为了澄清，在任何ACF图上，0的滞后将总是具有1的相关性，因为数据点将总是与它们自身完全相关。</p><p id="4077" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">查看一阶差分ACF图，我们可以发现人口时间序列中的一些季节性。该图类似于正弦图，在每12个滞后周期后有另一个峰值。该图表明，任何p值高达25都可以很好地工作，因为对于不同的滞后期，数据与自身相关。尽管我们需要更多的信息来精确地缩小p值的范围。</p><p id="2c65" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">对于二阶差分ACF图，看着它让我想到我们的数据是<em class="lf">过度差分</em>。我这样说是因为对于1滞后的时间周期，我们立即得到负的ACF值。在这种情况下，ACF图上的负值意味着如果我们的人口在某个时间点增加，很可能在下一段时间我们的人口会减少。了解我们数据集的性质，这是没有意义的，因为我们的人口一直在增长。因此，查看这些ACF图，建议使用d=1的值，而不是我们之前确定的d=2。</p><p id="6065" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">就第一个和第二个不同点而言，我们被困在了中间地带。虽然第一次差异不够，也显示了一些季节性，第二次差异的数据是过度差异。在尝试进行预测时，我们更倾向于使用差异稍小的数据，而不是差异过大的数据。</p><h1 id="4d0a" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">PACF地块</h1><p id="b5df" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">偏相关函数(PACF)图显示在控制了其他滞后变量的影响后，变量与其滞后值之间的相关性。它捕捉到了一个序列与其滞后值之间的相关性，而这些相关性是之前绘制的其他滞后变量所没有捕捉到的。</p><p id="3eb8" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">这可能有助于我们缩小在我们的模型中使用的p值，因为我们得出结论，许多值可以从一阶差分ACF图中工作。</p><figure class="lm ln lo lp fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ls"><img src="../Images/68c7271184b44b4a53a68b847d345fbe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*mLi7t-FMU7tMbt1T.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">一阶和二阶差分数据的PACF图。</figcaption></figure><p id="c811" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">从上述一阶差分数据的PACF图中，我们可以说，只有序列中的第一个滞后值具有显著的相关性。这意味着上个月的人口对预测本月的人口具有最显著的影响。由于其他值具有低得多的相关值，这表明ACF图中的高值可以简单地解释为仅仅是第一个滞后值。因此，我们可以为我们的ARIMA(p，d，q)模型尝试一个p=1的值。</p><h1 id="1cb7" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">查找“q”</h1><p id="3579" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">寻找q的最佳值包括查看ACF和PACF图上最先超出有效范围的点。基于一阶差分数据的PACF图，我们应该尝试q=1的值，因为这似乎是最后一个显著相关的滞后值。然而，建立模型非常简单，我们不妨同时尝试q=1和q=2。</p><h1 id="26f3" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">构建模型</h1><p id="cb3e" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">我们的发现建议我们尝试以下模型:</p><p id="3c79" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">我将在第一个差异数据集上训练模型，因此在训练中，我将设置d=0，因为当我将数据馈送到statsmodels API时，数据已经是差异的。下图显示了模型如何拟合一阶差分数据。</p><figure class="lm ln lo lp fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ls"><img src="../Images/9442bdf38c006c3f28d8656acda1efe6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*a8ht-l6FbfInme17.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">ARIMA(1，1，1)和ARIMA(1，1，2)模型的拟合。</figcaption></figure><p id="48d7" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">要比较这两种方法，我们可以看看它们的误差密度:</p><figure class="lm ln lo lp fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ls"><img src="../Images/99343c6d1bb5c104ad07a1c0f62b54c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*bH4Guy1NWwhek0df.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">模型的误差密度。</figcaption></figure><p id="8104" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">误差的密度图非常相似。不过，看起来ARIMA(1，1，2)模型可能更倾向于0，因为ARIMA(1，1，1)模型看起来有偏差，预测值略高于其应有值。虽然我不认为这有什么关系。我将任意使用ARIMA(1，1，1)模型来进行未来预测。</p><h1 id="fdf7" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">做预测</h1><p id="12a7" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">我将前80%的数据分成一个新的ARIMA(1，1，1)模型的训练集，后20%的数据将用于进行预测和测试。结果可以在下图中看到。</p><figure class="lm ln lo lp fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lt"><img src="../Images/a1682ba23049b804923fca4964b8b327.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*IUF3_i9yqrSYmQdU.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">人口数据的未来预测。</figcaption></figure><p id="45c6" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">黑色虚线是预测的人口值，而蓝色线代表实际的人口值。灰色区域是模型预测的95%置信区间。经检验，该模型的性能一点也不差。它捕捉到了总的趋势，并且实际人口完全在预测的置信区间内。</p></div><div class="ab cl lu lv gp lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="hb hc hd he hf"><p id="99a9" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated"><em class="lf">原载于2022年4月18日</em><a class="ae iu" href="https://cbarger.com/projects/arima_modeling/" rel="noopener ugc nofollow" target="_blank"><em class="lf">【https://cbarger.com】</em></a><em class="lf">。</em></p></div></div>    
</body>
</html>