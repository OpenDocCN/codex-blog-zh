<html>
<head>
<title>Creating the Network Module with Hilt</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Hilt创建网络模块</h1>
<blockquote>原文：<a href="https://medium.com/codex/creating-the-network-module-with-hilt-3eefc54b72?source=collection_archive---------3-----------------------#2021-07-09">https://medium.com/codex/creating-the-network-module-with-hilt-3eefc54b72?source=collection_archive---------3-----------------------#2021-07-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="1b50" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在前一篇博客中，我们了解了应用程序模块，以及如何使用Hilt注入应用程序实例。在这篇博文中，我们将了解如何使用Hilt设置网络模块，然后使用MVVM架构通过网络模块进行API调用。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/c26f41d9c78dd120ecf5523acb33b064.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Arut6h5G5V3DDiT2"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">蒙罗工作室在<a class="ae jt" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</figcaption></figure></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><p id="6691" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可以从这里跳到这个系列的任何部分</p><div class="kb kc ez fb kd ke"><a rel="noopener follow" target="_blank" href="/@priyansh-kedia/using-hilt-in-the-network-module-6ff8c50027d6"><div class="kf ab dw"><div class="kg ab kh cl cj ki"><h2 class="bd hj fi z dy kj ea eb kk ed ef hh bi translated">中等</h2><div class="kl l"><h3 class="bd b fi z dy kj ea eb kk ed ef dx translated">网络模块中的句柄</h3></div></div></div></a></div><div class="kb kc ez fb kd ke"><a rel="noopener follow" target="_blank" href="/@priyansh-kedia/creating-viewmodel-dependencies-using-hilt-ff8005488910"><div class="kf ab dw"><div class="kg ab kh cl cj ki"><h2 class="bd hj fi z dy kj ea eb kk ed ef hh bi translated">中等</h2><div class="kl l"><h3 class="bd b fi z dy kj ea eb kk ed ef dx translated">创建视图模型依赖项</h3></div></div></div></a></div></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><p id="bf1a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">网络模块👑</strong></p><p id="b2d8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们首先创建一个简单的Kotlin类，并将其命名为<strong class="ih hj"> NetworkModule </strong>。</p><p id="b281" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们使用<strong class="ih hj"> @Module和@InstallIn注释这个类。你可以在这里阅读这些注解。我们首先创建一个帮助注入Gson的方法。我们将使用Gson对JSON对象进行序列化和反序列化。</strong></p><pre class="je jf jg jh fd km kn ko kp aw kq bi"><span id="8612" class="kr ks hi kn b fi kt ku l kv kw">@Provides<br/>@Singleton<br/>fun getGson(): Gson {<br/>    return GsonBuilder().serializeNulls().setLenient().create()<br/>}</span></pre><p id="31c2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们使用@Provides和@Singleton来注释上面的方法。这些注释在之前的博客中有简要的解释。</p><p id="585a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> serializeNulls() </strong>用于指定即使是空值也将被序列化。<em class="kx">默认情况下，Gson省略空字段。</em></p><p id="ce06" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">set letterance()</strong>使Gson解析器在接受什么方面更加自由<em class="kx">。默认情况下，它是严格的，只接受JSON。</em></p><h2 id="8f5a" class="kr ks hi bd ky kz la lb lc ld le lf lg iq lh li lj iu lk ll lm iy ln lo lp lq bi translated">但是为什么我们首先创造了这种方法呢？</h2><p id="024a" class="pw-post-body-paragraph if ig hi ih b ii lr ik il im ls io ip iq lt is it iu lu iw ix iy lv ja jb jc hb bi translated">这是因为Gson依赖于我们将在NetworkModule中创建的其他方法之一。</p><p id="f313" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，我们将为网络拦截器创建方法。</p></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><h2 id="e7f5" class="kr ks hi bd ky kz la lb lc ld le lf lg iq lh li lj iu lk ll lm iy ln lo lp lq bi translated">拦截器方法</h2><pre class="je jf jg jh fd km kn ko kp aw kq bi"><span id="7325" class="kr ks hi kn b fi kt ku l kv kw">@Provides<br/>@Singleton<br/>fun getInterceptor(): Interceptor {<br/>    return Interceptor <strong class="kn hj">{<br/>        </strong>val request = <strong class="kn hj">it</strong>.request().newBuilder()<br/>        val actualRequest = request.build()<br/>        <strong class="kn hj">it</strong>.proceed(actualRequest)<br/>    <strong class="kn hj">}<br/></strong>}</span></pre><p id="bd2a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上面的方法用于在我们即将创建的改进实例中注入拦截器。您还可以为所有请求添加标题。你可以这样做，</p><pre class="je jf jg jh fd km kn ko kp aw kq bi"><span id="08cf" class="kr ks hi kn b fi kt ku l kv kw">@Provides<br/>@Singleton<br/>fun getInterceptor(): Interceptor {<br/>    return Interceptor <strong class="kn hj">{<br/>        </strong>val request = <strong class="kn hj">it</strong>.request().newBuilder()<br/>        request.addHeader("Authorization", "&lt;Your token here&gt;")<br/>        val actualRequest = request.build()<br/>        <strong class="kn hj">it</strong>.proceed(actualRequest)<br/>    <strong class="kn hj">}<br/></strong>}</span></pre><p id="ccbe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，我们将为OkHttpClient创建方法。</p></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><h2 id="155c" class="kr ks hi bd ky kz la lb lc ld le lf lg iq lh li lj iu lk ll lm iy ln lo lp lq bi translated">OkHttpClient方法</h2><pre class="je jf jg jh fd km kn ko kp aw kq bi"><span id="0669" class="kr ks hi kn b fi kt ku l kv kw">@Provides<br/>    @Singleton<br/>    fun getOkHttpClient(<br/>        interceptor: Interceptor<br/>    ): OkHttpClient {<br/>        val httpBuilder = OkHttpClient.Builder()<br/>            .addInterceptor(interceptor)<br/>            .connectTimeout(30, TimeUnit.<em class="kx">SECONDS</em>)<br/>            .readTimeout(30, TimeUnit.<em class="kx">SECONDS</em>)<br/>            .writeTimeout(50, TimeUnit.<em class="kx">SECONDS</em>)<br/><br/>        return httpBuilder<br/>            .protocols(<em class="kx">mutableListOf</em>(Protocol.<em class="kx">HTTP_1_1</em>))<br/>            .build()<br/>    }</span></pre><p id="f9ef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">OkHttpClient的所有这些设置都指定了读取、写入和连接超时。你也可以添加一个类似<a class="ae jt" href="http://facebook.github.io/stetho/" rel="noopener ugc nofollow" target="_blank"> Stetho </a>的网络拦截器。这可以这样做，</p><pre class="je jf jg jh fd km kn ko kp aw kq bi"><span id="b06f" class="kr ks hi kn b fi kt ku l kv kw">@Provides<br/>    @Singleton<br/>    fun getOkHttpClient(<br/>        interceptor: Interceptor<br/>    ): OkHttpClient {<br/>        val httpBuilder = OkHttpClient.Builder()<br/>            .addInterceptor(interceptor)<br/><strong class="kn hj">            .addNetworkInterceptor(StethoInterceptor())<br/></strong>            .connectTimeout(30, TimeUnit.<em class="kx">SECONDS</em>)<br/>            .readTimeout(30, TimeUnit.<em class="kx">SECONDS</em>)<br/>            .writeTimeout(50, TimeUnit.<em class="kx">SECONDS</em>)<br/><br/>        return httpBuilder<br/>            .protocols(<em class="kx">mutableListOf</em>(Protocol.<em class="kx">HTTP_1_1</em>))<br/>            .build()<br/>    }</span></pre><p id="a042" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以看到拦截器是对<strong class="ih hj"> getOkHttpClient </strong>方法的依赖。使用Dagger注入，我们不需要单独创建这些依赖项。</p><p id="6a00" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们现在创建用于翻新的方法，该方法用于建立与服务器的网络连接。</p></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><h2 id="7d1c" class="kr ks hi bd ky kz la lb lc ld le lf lg iq lh li lj iu lk ll lm iy ln lo lp lq bi translated">改造方法</h2><pre class="je jf jg jh fd km kn ko kp aw kq bi"><span id="1634" class="kr ks hi kn b fi kt ku l kv kw">@Provides<br/>@Singleton<br/>fun getRetrofit(<br/>    client: OkHttpClient,<br/>    gson: Gson<br/>): Retrofit {<br/>    return Retrofit.Builder()<br/>        .baseUrl(BuildConfig.<em class="kx">BASE_URL</em>)<br/>        .addConverterFactory(GsonConverterFactory.create(gson))<br/>        .client(client)<br/>        .build()<br/>}</span></pre><p id="7cde" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将转换器工厂添加到改造中，添加基本URL和OkHttpClient。可以看到Gson和OkHttpClient是这个函数的依赖项。</p><p id="66ee" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，我们将创建一个方法，帮助我们连接API端点的接口方法。</p><p id="4ca8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">API client方法</strong></p><pre class="je jf jg jh fd km kn ko kp aw kq bi"><span id="a9af" class="kr ks hi kn b fi kt ku l kv kw">@Provides<br/>@Singleton<br/>fun getApiClient(retrofit: Retrofit): ApiClient {<br/>    return retrofit.create(ApiClient::class.<em class="kx">java</em>)<br/>}</span></pre><p id="ed67" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个方法简单地创建了一个ApiClient实例，方法是将retrofit连接到它。</p><p id="d035" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将看到如何创建ApiClient接口，以及如何创建视图模型的依赖关系。</p></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><p id="cc96" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从<a class="ae jt" rel="noopener" href="/@priyansh-kedia/creating-viewmodel-dependencies-using-hilt-ff8005488910">这里</a>跳到下一篇博客。</p></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><p id="f321" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">参考文献</strong></p><div class="kb kc ez fb kd ke"><a href="https://square.github.io/retrofit/" rel="noopener  ugc nofollow" target="_blank"><div class="kf ab dw"><div class="kg ab kh cl cj ki"><h2 class="bd hj fi z dy kj ea eb kk ed ef hh bi translated">加装</h2><div class="kl l"><h3 class="bd b fi z dy kj ea eb kk ed ef dx translated">接口方法及其参数上的注释表明了如何处理请求。请求方法每隔…</h3></div><div class="lw l"><p class="bd b fp z dy kj ea eb kk ed ef dx translated">square.github.io</p></div></div></div></a></div></div></div>    
</body>
</html>