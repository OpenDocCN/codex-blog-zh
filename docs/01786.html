<html>
<head>
<title>Which Kubernetes Distribution you Should Install on Raspberry Pi</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">您应该在Raspberry Pi上安装哪个Kubernetes发行版</h1>
<blockquote>原文：<a href="https://medium.com/codex/which-kubernetes-distribution-you-should-install-on-raspberry-pi-27fa9fe1e658?source=collection_archive---------2-----------------------#2021-05-31">https://medium.com/codex/which-kubernetes-distribution-you-should-install-on-raspberry-pi-27fa9fe1e658?source=collection_archive---------2-----------------------#2021-05-31</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/fd795d62f3cd983bd2c5e2954bb83fa0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*nrTbewt3mgysoqnX"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">由<a class="ae iu" href="https://unsplash.com/@vishnumaiea?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Vishnu Mohan</a>在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="29f4" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">运行Azure/AWS/GCP管理的k8s集群可能会很昂贵，如果你只是为了开发/测试目的而使用它的话。但是，如果你碰巧有一个树莓Pi，你可以在它上面运行一个k8s集群。</p><p id="2c0c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果你在谷歌上搜索“在raspberry pi上运行k8s”，有许多可用的Kubernetes发行版，在这篇文章中，我将简要地尝试一些流行的发行版，即MicroK8s/k3s/kind/k3d/k0s，并提供我的两美分，哪一个最适合你的Raspberry Pi。</p><p id="413c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这篇文章中，我使用的是单个Raspberry Pi型号4B 4G Ram型号，带有32GB存储卡，运行Raspberry Pi操作系统，又名Raspbian。让我们开始吧。</p><h1 id="40bb" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">TL；DR；</h1><blockquote class="kr ks kt"><p id="0b8a" class="iv iw ku ix b iy iz ja jb jc jd je jf kv jh ji jj kw jl jm jn kx jp jq jr js hb bi translated">从易用性的角度来说，如果你更喜欢docker就挑k3d，否则就用k0s。</p></blockquote><h1 id="8d0c" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">MicroK8s</h1><p id="dd3a" class="pw-post-body-paragraph iv iw hi ix b iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo lc jq jr js hb bi translated"><a class="ae iu" href="https://microk8s.io/" rel="noopener ugc nofollow" target="_blank"> MicroK8s </a>是一款低运营成本、最小生产量的Kubernetes，适用于开发人员、云、集群、工作站、Edge和物联网。它只支持单个节点，但最近他们增加了集群。</p><p id="ab5a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">安装MicroK8s很容易，只需<code class="du ld le lf lg b">sudo snap install microk8s — classic</code>假设你已经安装了<code class="du ld le lf lg b">snap</code>。</p><p id="956b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然而，在我的Raspberry Pi上，上面的命令给出了这个错误:</p><pre class="lh li lj lk fd ll lg lm ln aw lo bi"><span id="23e2" class="lp ju hi lg b fi lq lr l ls lt">error: snap "microk8s" is not available on stable for this architecture (armhf) but exists on other architectures (amd64, arm64, ppc64el)</span></pre><p id="ca31" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这表明armhf(又名arm32)架构不支持MicroK8s。你也许可以把它安装在其他64位的操作系统上，但是这对我来说是一个很大的困难，所以我不再花太多时间在这上面了。</p><h1 id="af99" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">k3s</h1><p id="535d" class="pw-post-body-paragraph iv iw hi ix b iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo lc jq jr js hb bi translated"><a class="ae iu" href="https://k3s.io/" rel="noopener ugc nofollow" target="_blank"> K3s </a>是经过认证的Kubernetes发行版，专为物联网&amp;边缘计算而打造。它非常轻便，并针对ARM进行了优化，包括arm64和armv7。</p><p id="f4b3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">注意k3s取代了传统K8s集群使用的一些组件。特别是，<code class="du ld le lf lg b">etcd</code>被替换为用于状态管理等的sqlite3。不过这不会影响我们的日常使用。</p><p id="c6c3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">安装K3s也相当容易，只是<code class="du ld le lf lg b">curl -sfL https://get.k3s.io | sh -</code>甚至不需要<code class="du ld le lf lg b">snap</code>。</p><p id="6adb" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然而也是第一次失败。</p><pre class="lh li lj lk fd ll lg lm ln aw lo bi"><span id="5cbc" class="lp ju hi lg b fi lq lr l ls lt">Job for k3s.service failed because the control process exited with error code.<br/>See "systemctl status k3s.service" and "journalctl -xe" for details.</span><span id="da59" class="lp ju hi lg b fi lu lr l ls lt">$ journalctl -xe</span><span id="9ece" class="lp ju hi lg b fi lu lr l ls lt">msg="failed to find memory cgroup, you may need to add \"cgroup_memory=1 cgroup_enable=memory\" to your linux cmdline (/boot/cmdline.txt on a Raspberry Pi)"</span></pre><p id="fc64" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这看起来很难解决。在cmdline.txt的末尾加上<code class="du ld le lf lg b">cgroup_memory=1 cgroup_enable=memory</code>即可，注意cmdline.txt只是一个单行的文件，不要另起一行追加这个值。重启后，安装成功。</p><p id="5094" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在您可以执行任何kubectl命令之前，您必须给Kubernetes配置文件:<code class="du ld le lf lg b">sudo chmod 644 /etc/rancher/k3s/k3s.yaml</code>权限，并享受您的集群！</p><pre class="lh li lj lk fd ll lg lm ln aw lo bi"><span id="f920" class="lp ju hi lg b fi lq lr l ls lt">pi@raspberrypi:~ $ kubectl get node<br/>NAME          STATUS   ROLES                  AGE   VERSION<br/>raspberrypi   Ready    control-plane,master   78m   v1.20.7+k3s1</span></pre><p id="2aae" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">安装后，它只是一个普通的集群，没有任何简单的入口，甚至没有仪表板，你需要自己定制它。</p><h1 id="0eef" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">种类</h1><p id="90fe" class="pw-post-body-paragraph iv iw hi ix b iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo lc jq jr js hb bi translated"><a class="ae iu" href="https://kind.sigs.k8s.io/" rel="noopener ugc nofollow" target="_blank"> Kind </a>是一个使用Docker容器“节点”运行本地Kubernetes集群的工具。Kind主要是为测试Kubernetes本身而设计的，但也可以用于本地开发或CI。</p><p id="99c5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Kind与k3s相比更加轻量级，因为它运行在一个容器中，这允许你在几分钟内创建一个集群并摧毁它，没有任何剩余。</p><p id="07f1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然而，在检查了路线图和类似的已知问题后，它在我的Raspberry Pi设备上不能很好地工作，原因如下:</p><ul class=""><li id="126f" class="lv lw hi ix b iy iz jc jd jg lx jk ly jo lz js ma mb mc md bi translated">KIND甚至还没有进入测试阶段，这意味着它还不稳定，还缺少一些关键功能。</li><li id="cce7" class="lv lw hi ix b iy me jc mf jg mg jk mh jo mi js ma mb mc md bi translated">KIND目前不支持开箱即用的非AMD64架构，这是一个硬屏蔽。</li><li id="da3b" class="lv lw hi ix b iy me jc mf jg mg jk mh jo mi js ma mb mc md bi translated">与其他解决方案相比，KIND安装对用户不太友好。</li></ul><p id="c1dd" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">所以，告别的那种。</p><h1 id="5e91" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">k3d</h1><p id="98cf" class="pw-post-body-paragraph iv iw hi ix b iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo lc jq jr js hb bi translated">k3d 是在docker中运行<a class="ae iu" href="https://github.com/rancher/k3s" rel="noopener ugc nofollow" target="_blank"> k3s </a>的轻量级包装器。k3d使得在docker中创建单节点和多节点的k3s集群变得非常容易，例如在Kubernetes上进行本地开发。</p><p id="a58f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">到目前为止，k3s是唯一成功安装在Raspberry Pi上的Kubernetes发行版。所以，我们来试试docker版本的k3s，k3d。</p><p id="d524" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">安装k3d需要。如果您没有docker，请参见附录部分了解docker的安装。</p><pre class="lh li lj lk fd ll lg lm ln aw lo bi"><span id="e6ed" class="lp ju hi lg b fi lq lr l ls lt"># install the k3d CLI<br/>curl -s https://raw.githubusercontent.com/rancher/k3d/main/install.sh | bash</span><span id="7b64" class="lp ju hi lg b fi lu lr l ls lt"># create your cluster<br/>k3d cluster create mycluster</span></pre><p id="759d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">安装出奇的容易和简单。注意不包括类似<code class="du ld le lf lg b">kubectl</code>的k8s工具安装。要安装<code class="du ld le lf lg b">kubectl</code>，请参见<code class="du ld le lf lg b">kubectl</code>安装的附录部分。</p><pre class="lh li lj lk fd ll lg lm ln aw lo bi"><span id="0cc6" class="lp ju hi lg b fi lq lr l ls lt">kubectl get nodes</span><span id="c78c" class="lp ju hi lg b fi lu lr l ls lt">NAME                     STATUS   ROLES                  AGE   <br/>k3d-mycluster-server-0   Ready    control-plane,master   21m   </span></pre><p id="1ef1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">删除集群也很容易，只需使用<code class="du ld le lf lg b">k3d cluster delete mycluster</code>。</p><h1 id="1719" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">k0s</h1><p id="5d7f" class="pw-post-body-paragraph iv iw hi ix b iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo lc jq jr js hb bi translated">最后让我们试试<a class="ae iu" href="https://k0sproject.io/" rel="noopener ugc nofollow" target="_blank"> k03 </a>。这是一个包罗万象的Kubernetes发行版，预配置了所有必需的功能，只需将可执行文件复制到每台主机上并运行即可构建Kubernetes集群。</p><p id="865e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">k0s不需要在设备上安装docker。相反，k0s只是在<code class="du ld le lf lg b">/usr/bin/k0s</code>中的一个可执行文件，它作为一个系统服务安装在本地主机上。</p><pre class="lh li lj lk fd ll lg lm ln aw lo bi"><span id="43d1" class="lp ju hi lg b fi lq lr l ls lt"># download executable<br/>curl -sSLf https://get.k0s.sh | sudo sh</span><span id="8ed2" class="lp ju hi lg b fi lu lr l ls lt"># install as system service<br/>sudo k0s install controller --single</span><span id="8c95" class="lp ju hi lg b fi lu lr l ls lt"># start the service<br/># this takes 1-2 minutes to make cluster ready<br/>sudo systemctl start k0scontroller</span><span id="2b66" class="lp ju hi lg b fi lu lr l ls lt"># enable the k0s service to be started always after the node restart, optional<br/>sudo systemctl enable k0scontroller</span></pre><p id="cc0f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">注意k0s安装包括<code class="du ld le lf lg b">kubectl</code>，但是你必须为所有命令加上<code class="du ld le lf lg b">sudo k0s</code>前缀。不过这没什么大不了的，您可以使用alias来制作<code class="du ld le lf lg b">kubectl=sudo k0s kubectl</code>。</p><pre class="lh li lj lk fd ll lg lm ln aw lo bi"><span id="8a16" class="lp ju hi lg b fi lq lr l ls lt">sudo k0s kubectl get node<br/>NAME          STATUS   ROLES    AGE     VERSION<br/>raspberrypi   Ready    &lt;none&gt;   3m25s   v1.21.1-k0s1</span></pre><p id="a865" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">另一个注意，k3d的API服务似乎运行在端口6443，而不是默认的8080。</p><h1 id="2828" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">结论</h1><p id="e329" class="pw-post-body-paragraph iv iw hi ix b iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo lc jq jr js hb bi translated">这篇文章的目的是让你知道在众多k8s发行版中，哪些不能在你的Raspberry Pi设备上运行，哪些是最简单的本地k8s集群。这样一来，这个检讨就很浮出水面了。它不包括每个发行版提供的任何高级特性。</p><p id="57ec" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">我的外卖:MicroK8s/KIND和你的树莓Pi不搭配我更喜欢k3d ≥ k0s &gt; k3s。</strong></p><h1 id="46f6" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">附录</h1><h2 id="325f" class="lp ju hi bd jv mj mk ml jz mm mn mo kd jg mp mq kh jk mr ms kl jo mt mu kp mv bi translated">安装Docker</h2><pre class="lh li lj lk fd ll lg lm ln aw lo bi"><span id="14ed" class="lp ju hi lg b fi lq lr l ls lt"># make sure you install the latest version<br/># this may take more than 10 minutes <br/>sudo apt-get update &amp;&amp; sudo apt-get upgrade</span><span id="5c51" class="lp ju hi lg b fi lu lr l ls lt">curl -fsSL https://get.docker.com -o get-docker.sh<br/>sudo sh get-docker.sh</span></pre><h2 id="5206" class="lp ju hi bd jv mj mk ml jz mm mn mo kd jg mp mq kh jk mr ms kl jo mt mu kp mv bi translated">安装<code class="du ld le lf lg b">kubectl</code></h2><pre class="lh li lj lk fd ll lg lm ln aw lo bi"><span id="8837" class="lp ju hi lg b fi lq lr l ls lt"># Note only arm version works, amd64/arm64 won't work.<br/>curl -LO "<a class="ae iu" href="https://dl.k8s.io/release/$(curl" rel="noopener ugc nofollow" target="_blank">https://dl.k8s.io/release/$(curl</a> -L -s <a class="ae iu" href="https://dl.k8s.io/release/stable.txt)/bin/linux/arm/kubectl" rel="noopener ugc nofollow" target="_blank">https://dl.k8s.io/release/stable.txt)/bin/linux/arm/kubectl</a>"</span><span id="84b2" class="lp ju hi lg b fi lu lr l ls lt">sudo install -o root -g root -m 0755 kubectl /usr/local/bin/kubectl</span><span id="482b" class="lp ju hi lg b fi lu lr l ls lt"># Verify installation<br/>kubectl version --client</span></pre></div></div>    
</body>
</html>