<html>
<head>
<title>Oracle: How to Mask Sensitive Data with the Views — Quickly and Free</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Oracle:如何快速免费地用视图屏蔽敏感数据</h1>
<blockquote>原文：<a href="https://medium.com/codex/oracle-how-to-mask-sensitive-data-with-the-views-quickly-and-free-aff9175146b0?source=collection_archive---------4-----------------------#2022-02-14">https://medium.com/codex/oracle-how-to-mask-sensitive-data-with-the-views-quickly-and-free-aff9175146b0?source=collection_archive---------4-----------------------#2022-02-14</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/bd2d41bc07b0a6100fa73c64f0c52f2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qlLUYGyqltwd_gPfN5KB4g.jpeg"/></div></div></figure><p id="85b0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">有时，您可能会突然发现一些数据，这些数据必须对系统中的每个人紧急隐藏起来，而系统是由各种组件、服务和进程组成并运行的。</p><p id="d784" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">例如，您发现系统可以在一个或多个应用程序中访问客户的电子邮件，包括移动、桌面、web应用程序和reporting services。现在，开发团队面临的任务是:紧急禁用查看这些数据的权限。您知道访问这些数据的应用程序构成了一个未知的集合。一些应用程序/服务直接使用表，而其他应用程序/服务通过过程/批处理与表交互。</p><p id="0e1f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如何快速解决任务而不破坏任何东西？当然，有一些优秀的Oracle产品(数据编辑、虚拟专用数据库)可以以全面可靠的方式解决这一任务，并提供各种其他好处。然而，这些都是付费选项，你需要特定的技能来实现它们。我的建议是采取简单的方法快速免费解决这个问题。</p><p id="fe28" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">解决方案的要点是创建与表同名的视图，我们需要保护表的数据。同时，我们将重命名源表，这样就没有人可以再引用它了。</p><p id="eefb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">许多人被</strong>绊倒的困难是，即使视图足够容易地解决数据采样任务，只要我们试图通过视图插入或修改数据，我们就会得到<em class="jo"> ORA-01733:此处不允许虚拟列错误</em>。这意味着视图中有我们修改的字段。这个问题很容易通过触发器绕过。我将用下面的例子来说明如何去做。</p><p id="141f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这个实验中，让我们使用免费的Oracle自治数据库。方便做实验。</p><p id="cd23" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">数据屏蔽步骤:</p><ol class=""><li id="c17e" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated">创建一个测试表并用数据填充它</li><li id="7c5c" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">创建带有数据屏蔽的视图</li><li id="76da" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">通过视图启用数据插入和更新</li><li id="22b0" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">重命名表和视图</li></ol></div><div class="ab cl kd ke gp kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="hb hc hd he hf"><h1 id="8d6f" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">第一步。创建表并用数据填充它</h1><p id="672e" class="pw-post-body-paragraph iq ir hi is b it li iv iw ix lj iz ja jb lk jd je jf ll jh ji jj lm jl jm jn hb bi translated">创建一个名为Cards的简单表，该表包含两列——标识符和存储信用卡PAN的varchar列。</p><figure class="ln lo lp lq fd ij"><div class="bz dy l di"><div class="lr ls l"/></div></figure><p id="d866" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">插入几行:</p><figure class="ln lo lp lq fd ij"><div class="bz dy l di"><div class="lr ls l"/></div></figure><p id="d713" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">检查数据是否可访问:</p><figure class="ln lo lp lq fd ij"><div class="bz dy l di"><div class="lr ls l"/></div></figure><figure class="ln lo lp lq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lt"><img src="../Images/32be51df834a534af95ec4a4f387a366.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*c8qRyR6Up40aPaPZ"/></div></div></figure><p id="93b5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">很好，我们可以清楚地看到我们刚刚插入的内容。</p></div><div class="ab cl kd ke gp kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="hb hc hd he hf"><h1 id="e3bc" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">第二步。创建带有数据屏蔽的视图</h1><p id="b94b" class="pw-post-body-paragraph iq ir hi is b it li iv iw ix lj iz ja jb lk jd je jf ll jh ji jj lm jl jm jn hb bi translated">现在让我们创建一个视图，该视图使用REGEXP_REPLACE正则表达式函数查询带有数据屏蔽的表:</p><figure class="ln lo lp lq fd ij"><div class="bz dy l di"><div class="lr ls l"/></div></figure><p id="50bf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">检查返回的输出是否是我们期望的:</p><figure class="ln lo lp lq fd ij"><div class="bz dy l di"><div class="lr ls l"/></div></figure><figure class="ln lo lp lq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lu"><img src="../Images/b58c94bd472333f8875e86e940fb7393.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*m2FrfUBp1Dm0ssBZ"/></div></div></figure><p id="2ea8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，这就是我们需要的——数据被屏蔽了。</p></div><div class="ab cl kd ke gp kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="hb hc hd he hf"><h1 id="8eaa" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">第三步。通过视图启用数据插入和更新</h1><p id="e45c" class="pw-post-body-paragraph iq ir hi is b it li iv iw ix lj iz ja jb lk jd je jf ll jh ji jj lm jl jm jn hb bi translated">到目前为止，视图不允许插入新数据。看一看:</p><figure class="ln lo lp lq fd ij"><div class="bz dy l di"><div class="lr ls l"/></div></figure><p id="219c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们得到错误<em class="jo"> ORA-01733:这里不允许虚拟列</em></p><p id="8b0d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这是因为当我们创建视图时，字段发生了变化。</p><p id="36f8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们可以通过检查USER_UPDATABLE_COLUMNS来确定这一点:</p><figure class="ln lo lp lq fd ij"><div class="bz dy l di"><div class="lr ls l"/></div></figure><figure class="ln lo lp lq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lv"><img src="../Images/2dfa6c7ad430df025bd03763eecaa358.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*4-qXoSIPUZfe4c11"/></div></div></figure><p id="d40c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这实际上不是问题，因为我们可以通过简单的触发机制绕过这个限制。</p><p id="2de4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们创建一个触发器，当试图在视图中插入时，将执行这个触发器。在触发器本身中，我们将直接对源表进行操作:</p><figure class="ln lo lp lq fd ij"><div class="bz dy l di"><div class="lr ls l"/></div></figure><p id="d3a2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在让我们尝试在视图中插入值:</p><figure class="ln lo lp lq fd ij"><div class="bz dy l di"><div class="lr ls l"/></div></figure><p id="9f44" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">没有错误。让我们检查该行是否已被添加。</p><figure class="ln lo lp lq fd ij"><div class="bz dy l di"><div class="lr ls l"/></div></figure><figure class="ln lo lp lq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lw"><img src="../Images/4d12dfc66f5992c3d8e6c87d20fc3cb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ve1fY2l0stXAPUpf"/></div></div></figure><p id="c4b4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这里，卡id = 6</p><p id="d94d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在让我们检查源表是否也有数据，并且它们没有被屏蔽:</p><figure class="ln lo lp lq fd ij"><div class="bz dy l di"><div class="lr ls l"/></div></figure><figure class="ln lo lp lq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lx"><img src="../Images/623453ce1cf9546715e3e93c1e6c40bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*M1Unjw0A3INSlb8Y"/></div></div></figure><p id="826f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">太好了！</p><p id="1686" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们通过视图用数据更新来重复这个魔术。</p><p id="532e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果不创建触发器，racle会用同样的错误威胁我们:</p><figure class="ln lo lp lq fd ij"><div class="bz dy l di"><div class="lr ls l"/></div></figure><p id="e918" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">是的，在这里:</p><p id="8a5f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="jo"> ORA-01733:此处不允许虚拟列</em></p><p id="a1ed" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">但我们已经知道该做什么，只需创建触发器:</p><figure class="ln lo lp lq fd ij"><div class="bz dy l di"><div class="lr ls l"/></div></figure><p id="843d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们再次尝试更新数据:</p><figure class="ln lo lp lq fd ij"><div class="bz dy l di"><div class="lr ls l"/></div></figure><p id="936b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">没有错误。让我们检查数据是否已更新:</p><figure class="ln lo lp lq fd ij"><div class="bz dy l di"><div class="lr ls l"/></div></figure><figure class="ln lo lp lq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ly"><img src="../Images/f38d1f39ef3efc4bb56a23e63efaa92f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*MG_bN4sRmK3GkkuS"/></div></div></figure><p id="d121" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，我们已经确保既可以从视图中读取数据，也可以获取屏蔽的数据，还可以通过视图插入和更新数据。</p></div><div class="ab cl kd ke gp kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="hb hc hd he hf"><h1 id="5668" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">第四步。重命名表和视图</h1><p id="099c" class="pw-post-body-paragraph iq ir hi is b it li iv iw ix lj iz ja jb lk jd je jf ll jh ji jj lm jl jm jn hb bi translated">现在我们要做的是重命名视图，使其名称与源表的名称相同，并为表指定任何其他名称。我们还必须重新创建触发器，最后，重新编译失效的对象。当我们重命名该表时，对它的所有引用(外键)都将保留。</p><p id="d984" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">删除触发器，然后使用对表的正确引用再次创建它们:</p><figure class="ln lo lp lq fd ij"><div class="bz dy l di"><div class="lr ls l"/></div></figure><p id="97ac" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">将表格名称从cards更改为cards_tbl:</p><figure class="ln lo lp lq fd ij"><div class="bz dy l di"><div class="lr ls l"/></div></figure><p id="8160" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">使用此表的对象已经无效。我们需要重新创建视图，以便所有对象都有效。</p><p id="9e1a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">将视图名称从cards_v更改为cards:</p><figure class="ln lo lp lq fd ij"><div class="bz dy l di"><div class="lr ls l"/></div></figure><p id="5e07" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">重新创建触发器:</p><figure class="ln lo lp lq fd ij"><div class="bz dy l di"><div class="lr ls l"/></div></figure><p id="01ac" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们可以重新编译无效的对象:</p><figure class="ln lo lp lq fd ij"><div class="bz dy l di"><div class="lr ls l"/></div></figure><p id="be55" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们检查一下是否一切正常:</p><figure class="ln lo lp lq fd ij"><div class="bz dy l di"><div class="lr ls l"/></div></figure><figure class="ln lo lp lq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lz"><img src="../Images/d4408f68e8519a3fb53fcd19d7d9b999.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*sLKPGIuR85RuaIu8"/></div></div></figure><figure class="ln lo lp lq fd ij"><div class="bz dy l di"><div class="lr ls l"/></div></figure><figure class="ln lo lp lq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ma"><img src="../Images/913215dc2e5c66130697a40ff91f0fa1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*g2yaWQ-Z3AmL0XRF"/></div></div></figure><figure class="ln lo lp lq fd ij"><div class="bz dy l di"><div class="lr ls l"/></div></figure><figure class="ln lo lp lq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mb"><img src="../Images/3bef58db46a66a584d3279cc764099d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xiZf9bul_JnwAspO"/></div></div></figure><p id="d604" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">代码按预期运行。</p></div><div class="ab cl kd ke gp kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="hb hc hd he hf"><h1 id="f700" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">结论</h1><p id="a86f" class="pw-post-body-paragraph iq ir hi is b it li iv iw ix lj iz ja jb lk jd je jf ll jh ji jj lm jl jm jn hb bi translated">在本文中，我们已经处理了如何用视图添加数据屏蔽来替换表。我们还学习了如何通过视图绕过Oracle对数据修改的限制。当我们需要屏蔽敏感数据而不进行重大修复时，这个技巧很有用。</p><p id="3666" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我很想在评论中听到你对上述问题的看法，并随时通过<a class="ae mc" href="https://www.linkedin.com/in/yevgeniysamoilenko/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>与我联系。</p></div></div>    
</body>
</html>