<html>
<head>
<title>Deploying React through Django’s Static Files: Part 1 — Dev Setup</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过Django的静态文件部署React:第1部分—开发设置</h1>
<blockquote>原文：<a href="https://medium.com/codex/deploying-react-through-djangos-static-files-part-1-dev-setup-8a3a7b93c809?source=collection_archive---------0-----------------------#2020-12-30">https://medium.com/codex/deploying-react-through-djangos-static-files-part-1-dev-setup-8a3a7b93c809?source=collection_archive---------0-----------------------#2020-12-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/aaef5cb1fccdabfbd164eb5377c8bfe8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pNz6L9LH-OB6dmeKQBlLxA.jpeg"/></div></div></figure><div class=""/><p id="fa7c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我最近想为我的个人网站部署一个Django后端React。我还想以每月7美元的价格在Heroku Hobby Dyno上运营网站。因此，在这个系列中，我将介绍让Django进行反应，然后部署到Heroku的过程。</p><p id="fa2f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我将在本文中讨论的是如何在开发中使用Django serving React。</p><p id="6f5f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你可以在这里找到代码<a class="ae jo" href="https://github.com/kieronjmckenna/react-in-django-static-files.git" rel="noopener ugc nofollow" target="_blank">。</a></p><h1 id="01e4" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">设置React和Django</h1><p id="d1ff" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">我假设您已经设置了Python、pip和Node。我还将使用pipenv来管理我的包；如果你不熟悉的话，看看这里的<a class="ae jo" href="https://pypi.org/project/pipenv/" rel="noopener ugc nofollow" target="_blank">文档</a>。</p><p id="0e75" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我在macOS上工作，所以确保你调整任何命令到你的OS上。</p><p id="efa5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">另外，全局安装Django，这样就可以使用Django-admin。</p><p id="3da3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在项目的根目录下运行这个程序</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="0170" class="lb jq ht kx b fi lc ld l le lf">django-admin startproject backend &amp;&amp; npx create-react-app frontend</span></pre><p id="f8aa" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这将建立Django和React项目。</p><h1 id="1c56" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated"><strong class="ak">配置Django和静态文件</strong></h1><p id="7743" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">安装依赖项并启动您的环境。我还将在生产中用白噪声处理静态文件。</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="ac0e" class="lb jq ht kx b fi lc ld l le lf">cd backend &amp;&amp; pipenv install django whitenoise &amp;&amp; pipenv shell</span></pre><p id="f5e7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">以下是您需要对Django设置文件进行的所有更改。</p><p id="61a9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在我们处理React的生产版本之前，有些变化可能没有意义，但我们很快就会实现。</p><figure class="ks kt ku kv fd hk"><div class="bz dy l di"><div class="lg lh l"/></div></figure><h1 id="2502" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">建立React和生产模型</h1><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="5442" class="lb jq ht kx b fi lc ld l le lf">cd .. &amp;&amp; cd frontend</span></pre><p id="0af6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">转到/frontend/package.json，我们将创建一个新脚本。</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="b96c" class="lb jq ht kx b fi lc ld l le lf">{</span><span id="890e" class="lb jq ht kx b fi li ld l le lf">...</span><span id="e03c" class="lb jq ht kx b fi li ld l le lf">"scripts": {</span><span id="c970" class="lb jq ht kx b fi li ld l le lf">...</span><span id="b4a1" class="lb jq ht kx b fi li ld l le lf">"relocate": "react-scripts build &amp;&amp; rm -rf ../backend/build &amp;&amp; mv -f build ../backend",</span><span id="6c85" class="lb jq ht kx b fi li ld l le lf">...</span><span id="d334" class="lb jq ht kx b fi li ld l le lf">},<br/>...</span><span id="c7c9" class="lb jq ht kx b fi li ld l le lf">}</span></pre><p id="5af4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您不熟悉将react投入生产，当我们运行“react-scripts build”时，React会压缩项目并在名为build的文件夹中输出生产就绪版本。因此，我们对这个新脚本所做的是让React创建生产版本。一旦完成，我们想把它转移到Django项目中。所以我们用rm删除旧的生产文件夹(-rf这里的意思是；r:删除文件夹中的所有内容，f:不要提示，如果当前没有生产版本，这对我们很有用。否则，该命令将停止)。从那里，我们将文件夹转移到Django项目。</p><p id="f2f6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您回头看看Django的设置文件，您会注意到我们告诉Django在基本目录的“build”文件夹中查找模板和静态文件(查看变量TEMPLATES)。React使用构建文件夹中的文件index.html将自己插入DOM。</p><p id="c8b6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当React创建其生产构建时，它将所有需要运行的CSS、JS和其他静态文件保存在build/static文件夹中。你还会注意到，在我们的Django设置文件中，我们告诉Django在build/static(变量:STATICFILES_DIRS)中查找静态文件。</p><p id="578a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">不要忘记运行脚本</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="1622" class="lb jq ht kx b fi lc ld l le lf">yarn relocate</span></pre><p id="b9d2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">或者</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="96d1" class="lb jq ht kx b fi lc ld l le lf">npm run relocate</span></pre><h1 id="ccb9" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">Django路由</h1><p id="384c" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">现在Django可以访问React index.html文件和静态文件；我们需要添加网址。</p><figure class="ks kt ku kv fd hk"><div class="bz dy l di"><div class="lg lh l"/></div></figure><p id="027c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">通常你会把render_react函数放在一些views.py文件中，但是为了简单起见，我把它放在urls.py中，因为我还没有给这个项目添加一个应用程序。</p><p id="9743" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因此，我们正在创建一个函数来渲染出反应index.html文件。记住，我们在/back end/back end/settings dir/base . py中将构建文件夹添加到模板中，这样Django就知道index.html在哪里了。</p><p id="6827" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你会注意到re_paths服务React他们充当一个包罗万象。换句话说，与/admin不匹配的任何其他请求都将被定向作出反应。如果您希望使用React Router(或另一个包)来创建单页面应用程序，这将非常有用。</p><p id="b71d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果我们现在跑</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="47a9" class="lb jq ht kx b fi lc ld l le lf">python manage.py runserver</span></pre><p id="6c72" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们应该看看</p><figure class="ks kt ku kv fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lj"><img src="../Images/c19b29ba88124eb57636a4ef852033e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QuL_q5d7o2IngYWajo_3cQ.png"/></div></div></figure><p id="a727" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在港口8000。</p><p id="2904" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">太好了！现在我们需要检查我们是否可以对静态文件使用Whitenoise来运行它。需要记住的一个关键点是，Django的开发服务器(manage.py runserver)会为您处理静态文件。为了在生产中提供文件，还需要更多的配置。</p><p id="fe5e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">将此文件添加到/back end/back end/settings dir/base . py</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="f515" class="lb jq ht kx b fi lc ld l le lf">STATIC_ROOT = os.path.join(BASE_DIR, "staticfiles")</span></pre><p id="501b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">并在Django项目的根目录(/backend)中创建文件夹静态文件。</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="4f0f" class="lb jq ht kx b fi lc ld l le lf">mkdir staticfiles</span></pre><p id="0e8a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">设置STATIC_ROOT用于告诉Django(和Whitenoise)在哪里存储所有静态文件。当您在生产环境中使用类似Gunicorn的东西运行Django时，您想要使用的任何静态文件都需要位于STATIC_ROOT指定的文件夹中。</p><p id="385a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要将文件添加到由STATIC_ROOT指定的目录中，请将文件位置添加到STATICFILES_DIRS，并使用manage.py collectstatic命令。如果这没有意义，请查看静态文件<a class="ae jo" href="https://docs.djangoproject.com/en/3.1/ref/settings/#id17" rel="noopener ugc nofollow" target="_blank">中的Django文档。</a></p><p id="6644" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">接下来，我们需要运行</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="1515" class="lb jq ht kx b fi lc ld l le lf">python manage.py collectstatic</span></pre><p id="41ee" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这将从STATICFILES_DIRS中指定的位置收集所有文件。</p><p id="e8d9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果我们接着跑</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="bc65" class="lb jq ht kx b fi lc ld l le lf">python manage.py runserver --nostatic</span></pre><p id="174f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们应该在localhost:8000上看到相同的React默认屏幕，只是这一次，Whitenoise提供文件服务。</p><p id="f04f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这就是我在这篇文章中要说的；这涵盖了通过Django的静态文件运行React的基本思想。</p><p id="5b7c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一个小提示，如果你试图通过在同一个域下服务React来使用Django的会话认证，不要使用这种方法进行开发！每次你做一个改变，你都会把你的头撞在创建产品的墙上。查看这篇关于在开发中使用反向代理来获得Django并在同一个域下做出反应的文章。</p><div class="hh hi ez fb hj lk"><a rel="noopener follow" target="_blank" href="/swlh/django-rest-framework-and-spa-session-authentication-with-docker-and-nginx-aa64871f29cd"><div class="ll ab dw"><div class="lm ab ln cl cj lo"><h2 class="bd hu fi z dy lp ea eb lq ed ef hs bi translated">Django Rest框架和SPA-会话认证(使用Docker和Nginx)</h2><div class="lr l"><h3 class="bd b fi z dy lp ea eb lq ed ef dx translated">在本文中，我假设您熟悉Django、Django Rest框架、React以及一点点Docker和…</h3></div><div class="ls l"><p class="bd b fp z dy lp ea eb lq ed ef dx translated">medium.com</p></div></div><div class="lt l"><div class="lu l lv lw lx lt ly hp lk"/></div></div></a></div><p id="7645" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在下一篇文章中，我将介绍如何使用Heroku将它制作成产品。</p><p id="5579" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我目前正致力于这个系列的下一部分；当我完成的时候我会把它链接到这里。</p></div></div>    
</body>
</html>