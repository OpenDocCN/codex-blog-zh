<html>
<head>
<title>Data Visualization | 61 Lines of Code That Took Me Entire Day</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">数据可视化|花了我一整天的61行代码</h1>
<blockquote>原文：<a href="https://medium.com/codex/61-lines-of-code-that-took-me-entire-day-8b256605789a?source=collection_archive---------19-----------------------#2022-06-18">https://medium.com/codex/61-lines-of-code-that-took-me-entire-day-8b256605789a?source=collection_archive---------19-----------------------#2022-06-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="6250" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你好。这是我第一个使用Matplotlib用Python制作可视化的项目。这个可视化是基于<a class="ae jd" href="https://github.com/gilbertfontana/DataVisualization/tree/main/Wealth" rel="noopener ugc nofollow" target="_blank"> Gilbert Fontana的美国财富分布可视化</a>。在这个项目中，我主要是尽可能地模仿他的视觉化。</p></div><div class="ab cl je jf gp jg" role="separator"><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj"/></div><div class="hb hc hd he hf"><p id="a092" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最终输出:</p><figure class="jm jn jo jp fd jq er es paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="er es jl"><img src="../Images/ab86ba1b157d3dc51be3d416950e54c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vssC-ogUs7p__cqGGKkAWA.png"/></div></div><figcaption class="jx jy et er es jz ka bd b be z dx translated">美国家庭财富分配</figcaption></figure></div><div class="ab cl je jf gp jg" role="separator"><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj"/></div><div class="hb hc hd he hf"><h1 id="4481" class="kb kc hi bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">导入库</h1><p id="f4a8" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">首先，导入所需的库:用于数据操作的Pandas、用于处理日期的datetime和用于绘制图表的Matploblib。</p><pre class="jm jn jo jp fd le lf lg lh aw li bi"><span id="423b" class="lj kc hi lf b fi lk ll l lm ln">import pandas as pd<br/>import datetime<br/>import matplotlib.pyplot as plt<br/>import matplotlib.dates as mdates<br/>%matplotlib inline</span></pre></div><div class="ab cl je jf gp jg" role="separator"><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj"/></div><div class="hb hc hd he hf"><h1 id="347b" class="kb kc hi bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">数据操作</h1><p id="371c" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">阅读csv文件。</p><pre class="jm jn jo jp fd le lf lg lh aw li bi"><span id="6c15" class="lj kc hi lf b fi lk ll l lm ln">df = pd.read_csv('dfa-networth-shares.csv')<br/>df.head()</span></pre><figure class="jm jn jo jp fd jq er es paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="er es lo"><img src="../Images/8b515ceb808910e502a2c6733d8e03a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TL363Xz2qe_Ws1BC1JLREQ.png"/></div></div><figcaption class="jx jy et er es jz ka bd b be z dx translated">dfa-networth-shares.csv</figcaption></figure><p id="ef29" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将Date转换为datetime，并分配给新列Datex。</p><pre class="jm jn jo jp fd le lf lg lh aw li bi"><span id="d8b5" class="lj kc hi lf b fi lk ll l lm ln">df['Datex'] = pd.to_datetime(df['Date'].str.replace(':', '-'))<br/>df.head()</span></pre><figure class="jm jn jo jp fd jq er es paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="er es lo"><img src="../Images/810682db0ff0a7438bb413251b2a4d9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wJyeR91GBFttox3ePPnSqg.png"/></div></div><figcaption class="jx jy et er es jz ka bd b be z dx translated">将日期转换为日期时间</figcaption></figure><p id="4855" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">按类别和日期对数据进行分组，并将净值转换为百分比。</p><pre class="jm jn jo jp fd le lf lg lh aw li bi"><span id="a5fd" class="lj kc hi lf b fi lk ll l lm ln">df = df[['Net worth', 'Category', 'Datex']].groupby(['Datex', 'Category']).sum().unstack()<br/>df = df.apply(lambda x: x/x.sum() * 100, axis=1)<br/>df.head()</span></pre><figure class="jm jn jo jp fd jq er es paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="er es lp"><img src="../Images/0c1b59763cd9dc3aaea6ecf208404c74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ELTF0RNO-00vtwitLqmx5w.png"/></div></div><figcaption class="jx jy et er es jz ka bd b be z dx translated">将数据分组</figcaption></figure><p id="3bdd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">计算每个季度的前10%和后90%。</p><pre class="jm jn jo jp fd le lf lg lh aw li bi"><span id="821c" class="lj kc hi lf b fi lk ll l lm ln">df.loc[:, ('Net worth', 'Top10')] = df['Net worth']['Top1'] + df['Net worth']['Next9']<br/>df.loc[:, ('Net worth', 'Bottom90')] = df['Net worth']['Next40'] + df['Net worth']['Bottom50']<br/>df.head()</span></pre><figure class="jm jn jo jp fd jq er es paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="er es lq"><img src="../Images/3c7d374f988cdf7dc1e19b5243d94c9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T1DCYn5O1cxpmGy1fKvsXA.png"/></div></div><figcaption class="jx jy et er es jz ka bd b be z dx translated">计算前10名和后90名的数据</figcaption></figure><p id="76fd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">堆叠数据帧并重置索引。</p><pre class="jm jn jo jp fd le lf lg lh aw li bi"><span id="715f" class="lj kc hi lf b fi lk ll l lm ln">df = df.stack()<br/>df = df.reset_index()<br/>df.head()</span></pre><figure class="jm jn jo jp fd jq er es paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="er es lr"><img src="../Images/1f75b65fef50eb7365b72333e8a1a420.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v7E3GRIpq3un17v4JCPZ3Q.png"/></div></div></figure><p id="211e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，只提取Top10和Bottom90类别，因为我们只需要这两个类别。</p><pre class="jm jn jo jp fd le lf lg lh aw li bi"><span id="e6e2" class="lj kc hi lf b fi lk ll l lm ln">plt_df = df[(df['Category'] == 'Top10') | (df['Category'] == 'Bottom90')]<br/>plt_df.head()</span></pre><figure class="jm jn jo jp fd jq er es paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="er es lr"><img src="../Images/2507037e75b81c24ff258513242d65f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LZUzWyKuZQQw9wkQnInqHA.png"/></div></div></figure></div><div class="ab cl je jf gp jg" role="separator"><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj"/></div><div class="hb hc hd he hf"><h1 id="9a76" class="kb kc hi bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">形象化</h1><p id="8e91" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">首先，将绘图的字体设置为Serif，使用<code class="du ls lt lu lf b">.subplots()</code>创建一个绘图，并定义线条的颜色。</p><pre class="jm jn jo jp fd le lf lg lh aw li bi"><span id="1545" class="lj kc hi lf b fi lk ll l lm ln">plt.rcParams["font.family"] = "serif"</span><span id="e74a" class="lj kc hi lf b fi lv ll l lm ln">fig, ax = plt.subplots(figsize=(10, 10), facecolor='white', dpi=300)</span><span id="75df" class="lj kc hi lf b fi lv ll l lm ln">COLORS = {<br/>    'Top10': '#912d00', <br/>    'Bottom90': '#006595'<br/>}</span></pre><p id="c4d1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，删除轴的刻度，设置轴的范围，设置刻度标签。</p><pre class="jm jn jo jp fd le lf lg lh aw li bi"><span id="3dc5" class="lj kc hi lf b fi lk ll l lm ln">ax.tick_params(axis='y', left=False)<br/>plt.ylim(0, 100)<br/>plt.yticks([25, 50, 75, 100], fontsize=14)<br/>plt.ylabel('Share of total wealth (%)', fontsize=14)</span><span id="71e2" class="lj kc hi lf b fi lv ll l lm ln">ax.tick_params(axis='x', bottom=False)<br/>plt.xlim(datetime.date(1990,1,1), datetime.date(2022,1,1))<br/>plt.xticks([datetime.date(i,1,1) for i in range(1990, 2021, 10)], fontsize=14)<br/>date_form = mdates.DateFormatter('%Y')<br/>ax.xaxis.set_major_formatter(date_form)</span></pre><p id="aa6d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">并关闭绘图的顶部和右边框。</p><pre class="jm jn jo jp fd le lf lg lh aw li bi"><span id="2b3f" class="lj kc hi lf b fi lk ll l lm ln">ax.spines['top'].set_visible(False)<br/>ax.spines['right'].set_visible(False)</span></pre><p id="3c81" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，绘制图表！<code class="du ls lt lu lf b">ax.plot(year, worth, c=v)</code>用定义的颜色绘制线条。<code class="du ls lt lu lf b">ax.plot(year.iloc[-1], worth.iloc[-1], 'o', c=v</code>在线的末端画点。并且<code class="du ls lt lu lf b">ax.annotate</code>在行尾添加文本。</p><pre class="jm jn jo jp fd le lf lg lh aw li bi"><span id="f67c" class="lj kc hi lf b fi lk ll l lm ln">for k, v in COLORS.items():<br/>    year = plt_df.loc[(plt_df['Category'] == k), 'Datex']<br/>    worth = plt_df.loc[(plt_df['Category'] == k), 'Net worth']<br/>    ax.plot(year, worth, c=v)<br/>    ax.plot(year.iloc[-1], worth.iloc[-1], 'o', c=v)<br/>    ax.annotate(k + ' percent', <br/>                xy=(year.iloc[-1], worth.iloc[-1]),<br/>                xytext=(10, -3), <br/>                textcoords='offset points',<br/>                c=v, <br/>                fontsize=12)</span></pre><p id="b2a8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">添加标题和引用数据源也很重要！</p><pre class="jm jn jo jp fd le lf lg lh aw li bi"><span id="7465" class="lj kc hi lf b fi lk ll l lm ln">plt.title('The U.S. Household Wealth Distribution', <br/>             fontsize=28, <br/>             loc='left', <br/>             x=-0.08, y=1.14)</span><span id="6d25" class="lj kc hi lf b fi lv ll l lm ln">ax.text(s='The 10 percent wealthiest households possess almost \n70 percent of the total household wealth', <br/>        x=-.08, y=1.06, <br/>        fontsize=18, <br/>        transform=ax.transAxes)</span><span id="b7cb" class="lj kc hi lf b fi lv ll l lm ln">ax.text(s='H | Data: The Federal Reserve', <br/>        x=0.5, y=-0.1,<br/>        horizontalalignment='center',<br/>        fontsize=14, <br/>        transform=ax.transAxes)</span></pre><p id="d1ad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">并且，保存图表！</p><pre class="jm jn jo jp fd le lf lg lh aw li bi"><span id="39c0" class="lj kc hi lf b fi lk ll l lm ln">fig.savefig('wealth', bbox_inches='tight')</span></pre><p id="286a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" href="https://github.com/hckkiu/data-viz/tree/main/wealth" rel="noopener ugc nofollow" target="_blank">源代码</a></p></div></div>    
</body>
</html>