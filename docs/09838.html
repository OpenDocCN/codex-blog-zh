<html>
<head>
<title>How I use localStorage in React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我如何在React中使用本地存储</h1>
<blockquote>原文：<a href="https://medium.com/codex/how-i-use-localstorage-in-react-b4109f1e7a3?source=collection_archive---------5-----------------------#2022-11-13">https://medium.com/codex/how-i-use-localstorage-in-react-b4109f1e7a3?source=collection_archive---------5-----------------------#2022-11-13</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="75bf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在web开发中使用<code class="du jd je jf jg b">localStorage</code>是一个非常强大的工具。主题信息甚至产品数据都可以轻松保存在用户的浏览器存储中；在本文中，我将讨论如何在React应用程序中使用它。</p><figure class="ji jj jk jl fd jm er es paragraph-image"><div role="button" tabindex="0" class="jn jo di jp bf jq"><div class="er es jh"><img src="../Images/f18c6ba89e4810104fd136ae78c2c36d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-7yK7q6W8oN1MR6JanJNtw.png"/></div></div></figure><p id="6724" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对象的功能使用起来相当简单。可以用<code class="du jd je jf jg b">key: string</code>访问数据，或者用<code class="du jd je jf jg b">key: string</code>和<code class="du jd je jf jg b">value: string</code>设置数据</p><pre class="ji jj jk jl fd jt jg ju jv aw jw bi"><span id="4108" class="jx jy hi jg b fi jz ka l kb kc">🧑‍💻 <strong class="jg hj">USING localStorage IN REACT IS SIMPLE</strong></span><span id="2c0f" class="jx jy hi jg b fi kd ka l kb kc">type Theme = 'dark' | 'light'</span><span id="0a19" class="jx jy hi jg b fi kd ka l kb kc">const [theme, setTheme] = useState&lt;Theme&gt;(<strong class="jg hj">localStorage.getItem('theme')</strong> as Theme || 'light')</span><span id="ad07" class="jx jy hi jg b fi kd ka l kb kc">useEffect(() =&gt; {<br/>  <strong class="jg hj">localStorage.setItem('theme', theme)</strong><br/>}, [theme])</span></pre><p id="cc69" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">甚至对象或数组也可以用<code class="du jd je jf jg b">JSON.stringify()</code>存储为一个值</p><pre class="ji jj jk jl fd jt jg ju jv aw jw bi"><span id="1b2d" class="jx jy hi jg b fi jz ka l kb kc">👏 <strong class="jg hj">OBJECTS AND ARRAYS SHOULD BE STORED WHEN DATA IS COMPLEX</strong></span><span id="737f" class="jx jy hi jg b fi kd ka l kb kc">useEffect(() =&gt; {<br/>  const colors = ['#02D4F6', '#02D4B8', '🐴']<br/>  const theme = {<br/>    preferred: 'light',<br/>    actual: 'dark',<br/>    horse: '🐴'<br/>  }<br/>  <strong class="jg hj">localStorage.setItem('list', JSON.stringify(colors))</strong><br/>  <strong class="jg hj">localStorage.setItem('list', JSON.stringify(theme))</strong><br/>}, [])</span></pre><p id="8a2c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因为我们只能保存<code class="du jd je jf jg b">string</code>类型的数据，所以对象和数组必须总是在<code class="du jd je jf jg b">setItem()</code>上<code class="du jd je jf jg b">JSON.stringify()</code> ed，在<code class="du jd je jf jg b">getItem()</code>上<code class="du jd je jf jg b">JSON.parse()</code> d。这最终会变得多余，所以让我们创建一个实用程序来为我们完成这项工作</p><pre class="ji jj jk jl fd jt jg ju jv aw jw bi"><span id="2c6e" class="jx jy hi jg b fi jz ka l kb kc">👔 <strong class="jg hj">CREATE storage.ts IN src/utils</strong></span><span id="a5cc" class="jx jy hi jg b fi kd ka l kb kc">const storage = {<br/><strong class="jg hj">  get: (key: string): string | null =&gt; {<br/>    const result = localStorage.getItem(key)<br/>    if (!result) return null<br/>    try {<br/>      return JSON.parse(result)<br/>    } catch {<br/>      return result<br/>    }<br/>  }</strong><br/>}</span><span id="2805" class="jx jy hi jg b fi kd ka l kb kc">export default storage</span></pre><p id="9770" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们自己的<code class="du jd je jf jg b">storage</code>对象是使用<code class="du jd je jf jg b">get</code>函数属性创建的。它的职责是使用一个<code class="du jd je jf jg b">key</code>参数从<code class="du jd je jf jg b">localStorage</code>获取一个项目，并尝试解析结果。如果结果是一个<code class="du jd je jf jg b">string</code>，它将返回它而不进行解析。如果值是对象或数组，它可以解析并返回它。</p><p id="2edc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们可以用<code class="du jd je jf jg b">set</code>扩展我们的效用</p><pre class="ji jj jk jl fd jt jg ju jv aw jw bi"><span id="652b" class="jx jy hi jg b fi jz ka l kb kc">📈 <strong class="jg hj">EXTEND UTILITY WITH set()</strong></span><span id="d9e7" class="jx jy hi jg b fi kd ka l kb kc">const storage = {<br/>  get: (key: string): string | null =&gt; {<br/>    const result = localStorage.getItem(key)<br/>    if (!result) return null<br/>    try {<br/>      return JSON.parse(result)<br/>    } catch {<br/>      return result<br/>    }<br/>  },<br/>  <strong class="jg hj">set: (key: string, value: string | {} | []): void =&gt; {<br/>    localStorage.setItem(<br/>      key,<br/>      typeof value === 'string' ? value : JSON.stringify(value)<br/>    )<br/>  }</strong><br/>}</span><span id="7596" class="jx jy hi jg b fi kd ka l kb kc">export default storage</span></pre><p id="c15f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">除了一个<code class="du jd je jf jg b">key</code>，<code class="du jd je jf jg b">set</code>还有一个<code class="du jd je jf jg b">value</code>参数，可以是字符串，对象，或者数组。该函数的作用是将<code class="du jd je jf jg b">localStorage</code>中<code class="du jd je jf jg b">key</code>下的<code class="du jd je jf jg b">value</code>保存，如果<code class="du jd je jf jg b">value</code>的类型不是<code class="du jd je jf jg b">string</code>，保存前必须<code class="du jd je jf jg b">JSON.stringify()</code>该<code class="du jd je jf jg b">value</code>。</p><p id="5b11" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当然，按照这种模式，您可以使用额外的<code class="du jd je jf jg b">localStorage</code>功能来扩展这个实用程序的功能，比如<code class="du jd je jf jg b">clear()</code></p><pre class="ji jj jk jl fd jt jg ju jv aw jw bi"><span id="2489" class="jx jy hi jg b fi jz ka l kb kc">🚀 <strong class="jg hj">ADD MORE FIELDS</strong></span><span id="e9bc" class="jx jy hi jg b fi kd ka l kb kc">const storage = {<br/>  get: (key: string): string | null =&gt; {<br/>    const result = localStorage.getItem(key)<br/>    if (!result) return null<br/>    try {<br/>      return JSON.parse(result)<br/>    } catch {<br/>      return result<br/>    }<br/>  },<br/>  set: (key: string, value: string | {} | []): void =&gt; {<br/>    localStorage.setItem(<br/>      key,<br/>      typeof value === 'string' ? value : JSON.stringify(value)<br/>    )<br/>  },<br/><strong class="jg hj">  clear: (): void =&gt; {<br/>    localStorage.clear()<br/>  }</strong><br/>}</span><span id="da30" class="jx jy hi jg b fi kd ka l kb kc">export default storage</span></pre><p id="4346" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在使用非常简单；存储对象只需导入到页面或组件中，并使用适当的参数执行。</p><p id="c507" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你对这个实现有什么感觉？这对你有意义吗？会让你的生活更轻松吗？请在评论区分享你的想法。</p></div><div class="ab cl ke kf gp kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="hb hc hd he hf"><p id="4240" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">👋我希望这在你寻找新的学习材料时对你有用。感谢您花时间阅读这篇文章！如果你想在未来读到更多这样的故事，请订阅我的电子邮件列表。</p></div></div>    
</body>
</html>