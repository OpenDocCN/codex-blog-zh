<html>
<head>
<title>One-and-Done with The Singleton Pattern (in JavaScript)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">单一模式的一步到位(在JavaScript中)</h1>
<blockquote>原文：<a href="https://medium.com/codex/one-and-done-with-the-singleton-pattern-in-javascript-d3075ee4631e?source=collection_archive---------17-----------------------#2022-04-08">https://medium.com/codex/one-and-done-with-the-singleton-pattern-in-javascript-d3075ee4631e?source=collection_archive---------17-----------------------#2022-04-08</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/326d20bac7d1414247c58c5ae487a3a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Rp1ICZh2BNaUFF6toABj4Q.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">一个卫星天线可以接收多个信号，然后这些信号依靠卫星天线返回信息(图片来自<a class="ae iu" href="https://www.gtreview.com/a-satellite-dish-in-twilight-scene/" rel="noopener ugc nofollow" target="_blank"> <strong class="bd iv">《全球贸易评论》</strong> </a>)</figcaption></figure><p id="fca1" class="pw-post-body-paragraph iw ix hi iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hb bi translated">正如我在上一篇文章中提到的，在<a class="ae iu" rel="noopener" href="/@alexdel/efficient-object-creation-with-the-factory-design-pattern-in-javascript-e99e86b89d9f">工厂模式</a>中，设计模式是开发软件的可靠方法，可以在解决问题时重用，以改进代码结构。因此，当作为开发人员面临大量问题时，最好知道不止一个问题——那么，还有什么比单例模式更好的方式来继续这个系列呢！现在，你要么在读完这篇文章后退缩了，要么在想为什么有人会在想到单胞胎时退缩——好吧，不管怎样，我希望我能提供一些关于它的用法的信息，所以让我们从一个例子开始。</p><p id="68ff" class="pw-post-body-paragraph iw ix hi iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hb bi translated"><em class="ju">为什么用碟形卫星天线作为文章照片？一颗卫星支撑在一户人家的身上，它是一个单独的部件，为房子里的其他电视提供它们需要/请求的信号。这使得多台电视无需各自的接入点就可以获取信号。<br/>虽然这很好，但肯定有一些负面影响，比如如果天线发生故障，服务中断，电视只会说“<em class="ju">没有信号</em>”，没有任何信息或解决问题的能力。</em></p></div><div class="ab cl jv jw gp jx" role="separator"><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka"/></div><div class="hb hc hd he hf"><h2 id="49b5" class="kc kd hi bd iv ke kf kg kh ki kj kk kl jh km kn ko jl kp kq kr jp ks kt ku kv bi translated">什么是单例模式，它是如何工作的？</h2><figure class="kx ky kz la fd ij er es paragraph-image"><div class="er es kw"><img src="../Images/ce643be564dc9325f49da787ccdfc697.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*XZEVANMxAx6ttqqCS6FHdg.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">单例类是代码中使用的唯一实例(图via<a class="ae iu" href="https://refactoring.guru/design-patterns/singleton" rel="noopener ugc nofollow" target="_blank"><strong class="bd iv">refactoring . guru</strong></a><strong class="bd iv"/>在他们的<a class="ae iu" href="https://refactoring.guru/design-patterns/book" rel="noopener ugc nofollow" target="_blank"> <strong class="bd iv">深入研究设计模式</strong> </a> <strong class="bd iv"> </strong>一书中)</figcaption></figure><p id="2a02" class="pw-post-body-paragraph iw ix hi iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hb bi translated">简单地说，Singleton是一个只有一个带有全局访问点的实例的类。它通过将类的实例化限制到单个对象来实现这一点。该单个对象通常为该类的单个实例创建并存储一个属性，如果该实例属性已经存在，则返回该现有实例。</p></div><div class="ab cl jv jw gp jx" role="separator"><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka"/></div><div class="hb hc hd he hf"><h2 id="3378" class="kc kd hi bd iv ke kf kg kh ki kj kk kl jh km kn ko jl kp kq kr jp ks kt ku kv bi translated">为什么会有争议？</h2><p id="cf04" class="pw-post-body-paragraph iw ix hi iy b iz lb jb jc jd lc jf jg jh ld jj jk jl le jn jo jp lf jr js jt hb bi translated">虽然单例模式被认为是一种设计模式，但是其他人认为它可以是一种反模式。一个主要原因是因为它是一个可以“全局”访问的单个实例，类似于全局范围。这带来了很多问题的可能性:</p><ul class=""><li id="9135" class="lg lh hi iy b iz ja jd je jh li jl lj jp lk jt ll lm ln lo bi translated"><strong class="iy hj">如果单例实例</strong>出现任何错误或问题，那些依赖它的实例将没有任何信息，如果某些东西失败了，它们的状态将被蒙在鼓里</li><li id="dd3c" class="lg lh hi iy b iz lp jd lq jh lr jl ls jp lt jt ll lm ln lo bi translated">由于对单例对象有一种<strong class="iy hj">全局范围的感觉</strong>，如果代码中的一个区域对单例实例做了任何更改，如果其他区域依赖于更改的信息，它们可能会受到影响</li><li id="7fc5" class="lg lh hi iy b iz lp jd lq jh lr jl ls jp lt jt ll lm ln lo bi translated"><strong class="iy hj">为单例代码编写测试</strong>很困难，因为它通常与单例实例紧密耦合</li></ul><p id="dc8b" class="pw-post-body-paragraph iw ix hi iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hb bi translated">考虑到这些因素，您应该确保单例模式确实适合您的场景。</p></div><div class="ab cl jv jw gp jx" role="separator"><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka"/></div><div class="hb hc hd he hf"><h2 id="6379" class="kc kd hi bd iv ke kf kg kh ki kj kk kl jh km kn ko jl kp kq kr jp ks kt ku kv bi translated">JavaScript中单例模式的基本实现</h2><p id="0fca" class="pw-post-body-paragraph iw ix hi iy b iz lb jb jc jd lc jf jg jh ld jj jk jl le jn jo jp lf jr js jt hb bi translated">使用简介部分的示例——家用卫星天线——编写一些代码的时间到了:</p><p id="7735" class="pw-post-body-paragraph iw ix hi iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hb bi translated"><strong class="iy hj"> 1st </strong> — <strong class="iy hj">问题:</strong>一个家庭中有两台电视，需要一个卫星天线来获取信号，以检索它们请求的频道。每台电视不能有独一无二的卫星，否则就需要额外的卫星电视合同(<em class="ju">)，谁想处理更多这样的合同？</em>)</p><p id="3884" class="pw-post-body-paragraph iw ix hi iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hb bi translated"><strong class="iy hj">第二个</strong> — <strong class="iy hj">对象:</strong>对象所需要的是将使用从<strong class="iy hj">卫星</strong>发出的信号的电视，卫星被导入并利用电视changeChannel方法中的<strong class="iy hj"> getChannel方法来更新电视的currentChannel属性</strong>。</p><p id="93e8" class="pw-post-body-paragraph iw ix hi iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hb bi translated">*( <em class="ju">注意:注意我们是如何导入satelliteDish类的，但是不需要调用"</em><strong class="iy hj"><em class="ju">new</em></strong><em class="ju">"</em><strong class="iy hj"><em class="ju"/></strong><em class="ju">——这在下一步</em>中会有意义)</p><p id="e871" class="pw-post-body-paragraph iw ix hi iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hb bi translated">**( <em class="ju">还有</em><strong class="iy hj">television two</strong>—<strong class="iy hj"/><em class="ju">与televisionOne代码相同但登录为“TV #2”而非</em>)</p><figure class="kx ky kz la fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lu"><img src="../Images/b5b7c376fcf8e7f6508bf72367829f42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2aEKGSwEpMLsO3Wi49jtEg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">televisionOne.js/televisionTwo.js</figcaption></figure><p id="4678" class="pw-post-body-paragraph iw ix hi iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hb bi translated"><strong class="iy hj">第三个</strong> — <strong class="iy hj">单例类:</strong>现在我们到达这个设计模式中的主要组件。如前所述，<strong class="iy hj">这个类应该返回一个实例</strong>供代码的其他部分使用(在本例中，是TVs)。为了确保这种行为，所有的动作都发生在构造函数中的<strong class="iy hj">和导出</strong>之前。</p><figure class="kx ky kz la fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lv"><img src="../Images/2818025b3bc9ad86dbfa0100291cddb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IyCZ0kGYtn0S0YystgJv8w.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">satelliteDish.js —实例化自身并导出该类的唯一实例化的单例类</figcaption></figure><p id="98b3" class="pw-post-body-paragraph iw ix hi iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hb bi translated">在进入单例类本身之前，先看看它是如何导出的。有一个SatelliteDish类的实例被创建并设置为homeSatellite，然后被导出供使用。</p><p id="f924" class="pw-post-body-paragraph iw ix hi iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hb bi translated">现在，注意赋予SatelliteDish类本身的<strong class="iy hj">实例属性</strong>,以及它在构造函数中是如何处理的。在第一次调用构造函数的<strong class="iy hj">时，实例属性将为<em class="ju">null</em>T5】(因为它还不作为属性存在)。知道这是对构造函数的第一次调用，它会将初始属性:<strong class="iy hj">一个名为“instance”的类属性设置为<em class="ju"> this </em> </strong>和<strong class="iy hj">this上的“signalCount”设置为0 </strong>。<em class="ju">然后</em>在初始调用之后，每次调用构造函数都会检查该类的实例属性，看它是否为空并返回现有的satellite dish . instance .<br/>(<em class="ju">肯定是</em> <a class="ae iu" href="https://www.youtube.com/watch?v=YOlr79NaAtQ" rel="noopener ugc nofollow" target="_blank"> <strong class="iy hj"> <em class="ju">温习一下“this”</em></strong></a><em class="ju">如果对实例属性的设置不清楚的话)</em></strong></p><p id="db29" class="pw-post-body-paragraph iw ix hi iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hb bi translated"><em class="ju">*提示:如果您希望您的单例提供信息，并取消代码对其进行更改的能力—在您创建实例之后和导出之前(就在上面的第27行之后)—添加</em><a class="ae iu" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/freeze" rel="noopener ugc nofollow" target="_blank"><strong class="iy hj"><em class="ju">object . freeze(singletonObj)</em></strong></a></p><p id="8c08" class="pw-post-body-paragraph iw ix hi iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hb bi translated">(<em class="ju">下面是一种使用相同的实例属性逻辑而不使用类语法来创建单例的方法——如果你喜欢</em>)</p><figure class="kx ky kz la fd ij er es paragraph-image"><div class="er es lw"><img src="../Images/09fe78219251b29b575e2153819b4253.png" data-original-src="https://miro.medium.com/v2/resize:fit:962/format:webp/1*Qyp5SyZtJzIjpJU8zgySqg.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">没有使用类语法创建的单例</figcaption></figure><p id="91c3" class="pw-post-body-paragraph iw ix hi iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hb bi translated"><strong class="iy hj">第四个</strong> — <strong class="iy hj">使用Singleton实例:</strong>记住，从第二步开始，当调用changeChannel方法时，TV对象导入并使用/调用卫星Singleton的getChannel方法。因此，在index.js文件中，我们将用起始频道号实例化两个电视对象，打开它们，并开始切换频道。</p><figure class="kx ky kz la fd ij er es paragraph-image"><div class="er es lx"><img src="../Images/50ac21d54320ada8056ab46f785147c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:874/format:webp/1*eAZzuDac26qpEYqRW7PdNA.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">索引. js</figcaption></figure><p id="e9fe" class="pw-post-body-paragraph iw ix hi iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hb bi translated">我们的产出是:</p><figure class="kx ky kz la fd ij er es paragraph-image"><div class="er es ly"><img src="../Images/7bef63900aec89ede2a4da243ad2597f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1294/format:webp/1*-pA7311BNzIgRltxHzkXYg.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">运行index.js的控制台输出</figcaption></figure><p id="c26a" class="pw-post-body-paragraph iw ix hi iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hb bi translated">“Signal #”(在singleton类中称为signalCount)保持跟踪，并在每次任何电视对象从卫星singleton请求信号并返回所请求的频道时递增。因此，我们的singleton像预期的那样工作，并使用同一个实例服务于代码的每一部分！</p><p id="fdd0" class="pw-post-body-paragraph iw ix hi iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hb bi translated"><em class="ju">(你可以在我的Github </em> <a class="ae iu" href="https://github.com/AlexDeL8/singleton-pattern-example" rel="noopener ugc nofollow" target="_blank"> <strong class="iy hj"> <em class="ju">这里找到示例代码的链接</em> </strong> </a> <em class="ju"> ) </em></p></div><div class="ab cl jv jw gp jx" role="separator"><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka"/></div><div class="hb hc hd he hf"><h2 id="1039" class="kc kd hi bd iv ke kf kg kh ki kj kk kl jh km kn ko jl kp kq kr jp ks kt ku kv bi translated">抛开争议——单例模式什么时候有用？</h2><p id="1d40" class="pw-post-body-paragraph iw ix hi iy b iz lb jb jc jd lc jf jg jh ld jj jk jl le jn jo jp lf jr js jt hb bi translated">单一模式在很多情况下都不是一个可接受的解决方案，但是有几个常见的例子:</p><ul class=""><li id="244c" class="lg lh hi iy b iz ja jd je jh li jl lj jp lk jt ll lm ln lo bi translated">读取只应在启动时读取的配置/设置文件</li><li id="d055" class="lg lh hi iy b iz lp jd lq jh lr jl ls jp lt jt ll lm ln lo bi translated">记录器是用于单例模式的经典例子，因为它不仅可以在代码中的任何地方被访问，而且如果记录器被禁用或关闭，也不会影响主代码的执行</li><li id="cda1" class="lg lh hi iy b iz lp jd lq jh lr jl ls jp lt jt ll lm ln lo bi translated">我个人有一个开发聊天机器人的单例用例。chatbot客户端应该只有一个实例连接到聊天室，监听请求，并发回响应/消息。</li></ul></div><div class="ab cl jv jw gp jx" role="separator"><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka"/></div><div class="hb hc hd he hf"><h2 id="3e94" class="kc kd hi bd iv ke kf kg kh ki kj kk kl jh km kn ko jl kp kq kr jp ks kt ku kv bi translated">总结和资源</h2><p id="7aeb" class="pw-post-body-paragraph iw ix hi iy b iz lb jb jc jd lc jf jg jh ld jj jk jl le jn jo jp lf jr js jt hb bi translated">在我看来，单例模式可以是一个有用的设计模式<em class="ju">，如果</em>它被用在一个合适的场景中，并且考虑到它的全局范围感觉而小心处理。否则，它会很快变得一团糟，并且您可能会发现自己处于那些认为它更像是反模式的人的圈子中。</p><p id="d51c" class="pw-post-body-paragraph iw ix hi iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hb bi translated"><em class="ju">如果你想继续尝试单例模式，你可以参考以下资源:</em> <br/>📖本文受到了《学习JavaScript设计模式的<a class="ae iu" href="https://www.patterns.dev/posts/classic-design-patterns/" rel="noopener ugc nofollow" target="_blank"/><strong class="iy hj"/>书<strong class="iy hj">的影响，由</strong><a class="ae iu" href="https://addyosmani.com/" rel="noopener ugc nofollow" target="_blank"><strong class="iy hj">Addy Osmani</strong></a><strong class="iy hj"/>(以及<a class="ae iu" href="https://www.lydiahallie.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="iy hj"> Lydia Hallie </strong> </a>)。你可以在这里 找到单例模式部分<a class="ae iu" href="https://www.patterns.dev/posts/singleton-pattern/" rel="noopener ugc nofollow" target="_blank"> <strong class="iy hj">。<strong class="iy hj"> </strong> <em class="ju">我强烈建议先去参观这个！<br/> </em>🎥<em class="ju"> </em> <a class="ae iu" href="https://www.youtube.com/watch?v=hUE_j6q0LTQ" rel="noopener ugc nofollow" target="_blank"> <strong class="iy hj">视频由克里斯托弗·奥克拉维</strong> </a>(一个更长的深潜模式)<em class="ju"> <br/> </em>🎥<a class="ae iu" href="https://www.youtube.com/watch?v=sJ-c3BA-Ypo" rel="noopener ugc nofollow" target="_blank"> <strong class="iy hj">视频由Web Dev简化</strong> </a>(一个较短的编码视频)</strong></a></p></div></div>    
</body>
</html>