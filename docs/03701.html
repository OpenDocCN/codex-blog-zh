<html>
<head>
<title>💪Azure Bicep: How to migrate from ARM templates to Bicep templates.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">💪Azure Bicep:如何从ARM模板迁移到Bicep模板？</h1>
<blockquote>原文：<a href="https://medium.com/codex/azure-bicep-how-to-migrate-from-arm-templates-to-bicep-a9639ac316d8?source=collection_archive---------3-----------------------#2021-09-17">https://medium.com/codex/azure-bicep-how-to-migrate-from-arm-templates-to-bicep-a9639ac316d8?source=collection_archive---------3-----------------------#2021-09-17</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="c224" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">过渡到Azure Bicep模板的最佳实践和优势</p><p id="e7e5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">本文将分享从ARM模板迁移到Bicep模板的好处以及执行迁移的最佳实践。</p><p id="97e9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在之前的<a class="ae jd" rel="noopener" href="/codex/azure-bicep-playground-transitioning-from-arm-templates-into-bicep-5c10c864c863">文章</a>中，我们分享了如何轻松<a class="ae jd" rel="noopener" href="/codex/azure-bicep-playground-transitioning-from-arm-templates-into-bicep-5c10c864c863">将手臂模板转换成二头肌模板</a>。</p><p id="1ab0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有时，在将ARM模板反编译成Bicep模板后，我们需要验证输出文件，因为在反编译过程中我们可能会出现一些错误或警告。</p><p id="3b1f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Bicep的目标之一是改善基础设施作为Azure部署代码的创作体验，并消除在代码中使用JSON定义的复杂性。</p><p id="b982" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你会发现Bicep简化了语法，去掉了处理JSON的痛苦。Bicep的另一个好处是模块化。你会发现在Bicep中使用模块比在ARM模板中更容易。</p><h1 id="fffc" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">从ARM模板迁移到Bicep</h1><p id="5070" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">根据Azure环境的不同，将ARM模板迁移到Bicep模板可能会有点困难。</p><p id="08e9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">微软推荐从ARM模板迁移到Bicep模板的5个阶段:</p><ul class=""><li id="9104" class="kh ki hi ih b ii ij im in iq kj iu kk iy kl jc km kn ko kp bi translated">第一阶段。<em class="kq">转换</em></li><li id="b316" class="kh ki hi ih b ii kr im ks iq kt iu ku iy kv jc km kn ko kp bi translated">第二阶段。<em class="kq">迁移</em></li><li id="4f17" class="kh ki hi ih b ii kr im ks iq kt iu ku iy kv jc km kn ko kp bi translated">第三阶段。<em class="kq">重构</em></li><li id="4aa2" class="kh ki hi ih b ii kr im ks iq kt iu ku iy kv jc km kn ko kp bi translated">第四阶段。<em class="kq">测试</em></li><li id="a9a7" class="kh ki hi ih b ii kr im ks iq kt iu ku iy kv jc km kn ko kp bi translated">第五阶段。<em class="kq">展开</em></li></ul><h1 id="5724" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">第一阶段。皈依者</h1><p id="a6a3" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">在这个阶段，目标是从你的Azure资源中获得一个JSON表示。假设您在Azure中有一个现有的环境。在这种情况下，您可以使用<a class="ae jd" href="https://docs.microsoft.com/en-us/azure/azure-resource-manager/templates/export-template-portal#use-resource-explorer" rel="noopener ugc nofollow" target="_blank"> Azure Portal </a>、<a class="ae jd" href="https://docs.microsoft.com/en-us/azure/azure-resource-manager/templates/export-template-cli" rel="noopener ugc nofollow" target="_blank"> Azure CLI </a>、<a class="ae jd" href="https://docs.microsoft.com/en-us/azure/azure-resource-manager/templates/export-template-powershell" rel="noopener ugc nofollow" target="_blank"> Azure Powershell </a>或<a class="ae jd" href="https://docs.microsoft.com/en-us/rest/api/resources/resourcegroups/exporttemplate" rel="noopener ugc nofollow" target="_blank"> REST API </a>来导出ARM-JSON模板，从而导出您环境中的资源定义。</p><p id="7cd1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们有两个导出ARM模板的选项:</p><ul class=""><li id="46b1" class="kh ki hi ih b ii ij im in iq kj iu kk iy kl jc km kn ko kp bi translated">您可以从资源组或特定资源中导出它。您将拍摄资源组当前状态的快照。当您需要捕获环境中资源的最新更改或更新时，或者在初始部署后创建资源时，请使用此选项。</li><li id="235c" class="kh ki hi ih b ii kr im ks iq kt iu ku iy kv jc km kn ko kp bi translated">您可以从部署历史记录中保存ARM模板。这样，您可以获得用于部署的ARM模板的精确副本。当初始部署后不需要包含对资源的最新更改或更新时，请使用此选项。</li></ul><p id="f907" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要使用Azure门户导出模板，请转到要导出的资源组或特定资源。然后选择“导出模板”选项，下载ARM模板。</p><p id="bbad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下图显示了如何使用Azure门户导出ARM模板。</p><figure class="kx ky kz la fd lb er es paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="er es kw"><img src="../Images/f8328bf9d19984dddc7719db33454a93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Pqrh_BeBbQk3Q7ISwEQGkw.png"/></div></div><figcaption class="li lj et er es lk ll bd b be z dx translated">Azure二头肌-导出手臂模板</figcaption></figure><p id="0130" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦从您的环境中获得了JSON表示，我们就可以进入第2阶段:迁移。</p><h1 id="2b9f" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">第二阶段。移动</h1><p id="24ec" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">这个阶段的主要目标是创建我们的工作二头肌模板的初稿。虽然建议从头开始创建一个干净的Bicep模板，但是您也可以将ARM模板中包含的每个资源反编译成一个Bicep资源定义。</p><p id="2920" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要将你的手臂模板反编译成二头肌模板，你可以利用<a class="ae jd" href="https://docs.microsoft.com/en-us/azure/azure-resource-manager/bicep/decompile?tabs=azure-cli" rel="noopener ugc nofollow" target="_blank">二头肌命令行界面</a>或<a class="ae jd" href="https://bicepdemo.z22.web.core.windows.net/" rel="noopener ugc nofollow" target="_blank">二头肌操场</a>。</p><p id="906d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">二头肌操场是一个在线工具，你可以利用反编译你的手臂模板。但是，我建议使用Bicep CLI。我们在下面的文章中详细讨论二头肌游乐场:<a class="ae jd" rel="noopener" href="/codex/azure-bicep-playground-transitioning-from-arm-templates-into-bicep-5c10c864c863">https://medium . com/azure-Bicep-Playground-transitioning-from-arm-templates-into-Bicep-5c 10 c 864 c 863</a></p><p id="c3cd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下图显示了二头肌操场:</p><figure class="kx ky kz la fd lb er es paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="er es lm"><img src="../Images/036d1b31839466b58ee9fcb2a50ef7bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cS3GWBZheRVsPae3CKdL0w.png"/></div></div><figcaption class="li lj et er es lk ll bd b be z dx translated">蔚蓝二头肌游乐场</figcaption></figure><p id="f414" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这个阶段，如果在反编译过程中出现任何警告，您还应该确定是否有任何资源丢失，或者为现有资源创建一个新的定义。</p><p id="c1a0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">*重要:不能保证从手臂模板到二头肌模板的映射。</p><p id="ee07" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦你有了二头肌模板的草稿，是时候改进你的二头肌代码了。</p><h1 id="2046" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">第三阶段。重构</h1><p id="0f98" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">在这个阶段，我们将重点打磨你的二头肌模板。这个阶段包括修改资源API版本，修改参数、变量和符号名。</p><p id="742d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如，如果您使用数据库密码或虚拟机用户名密码之类的秘密，请确保使用“<a class="ae jd" href="https://blog.azinsider.net/azure-bicep-secure-secrets-in-parameters-secure-decorator-ce6317cc0c23" rel="noopener ugc nofollow" target="_blank"> <em class="kq"> @secure() </em> </a>”装饰器。您可以在这里 查看更多关于保护您的参数<a class="ae jd" href="https://blog.azinsider.net/azure-bicep-secure-secrets-in-parameters-secure-decorator-ce6317cc0c23" rel="noopener ugc nofollow" target="_blank"> <em class="kq">的信息。</em></a></p><p id="0f89" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">根据你的Azure环境的复杂程度，你可以把它分成不同的更小的Bicep模板，并利用Bicep的<a class="ae jd" href="https://docs.microsoft.com/en-us/azure/azure-resource-manager/bicep/modules" rel="noopener ugc nofollow" target="_blank">模块化</a>特性。</p><p id="862e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦你有了一个完美的工作二头肌模板，就该在实际部署之前进行一些测试了。</p><h1 id="7fd0" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">第四阶段。试验</h1><p id="95c8" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">您可以利用同样适用于ARM模板的假设操作来验证您的二头肌模板。这将简化测试过程，并且您可以检查对您的Azure环境的影响。</p><p id="d486" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在进行部署之前，假设分析将向您展示环境中的变化的预览。它会将您在Azure中环境的当前状态与您在Bicep模板中定义的期望状态进行比较。</p><p id="e66c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下图显示了在部署中使用假设分析的示例。</p><figure class="kx ky kz la fd lb er es paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="er es ln"><img src="../Images/32202c4e26aee800617c9dae64e56004.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jZTd9WLjGAnTPc3qp6j1YQ.png"/></div></div><figcaption class="li lj et er es lk ll bd b be z dx translated">Azure Bicep —部署预览</figcaption></figure><p id="4dac" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦您验证了您的二头肌模板，我们将进入最后阶段:部署。</p><h1 id="c365" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">第五阶段。部署</h1><p id="a3d0" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">二头肌模板的配置过程非常简单。虽然您可以执行手动部署，但还有其他选项可以使用GitHub Actions、Azure DevOps等工具来自动化部署过程。</p><p id="7333" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在部署之前，准备一个回滚计划，以便从任何潜在的失败部署中恢复。</p><p id="c1ab" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您更喜欢执行手动部署，您可以使用相同的what-if和flag -c选项，并确认在一切顺利的情况下执行部署。</p><h1 id="8b44" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">下一步。</h1><p id="95b2" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">检查Microsoft Lean模块以迁移Azure资源。</p><div class="lo lp ez fb lq lr"><a href="https://docs.microsoft.com/en-us/learn/modules/migrate-azure-resources-bicep/" rel="noopener  ugc nofollow" target="_blank"><div class="ls ab dw"><div class="lt ab lu cl cj lv"><h2 class="bd hj fi z dy lw ea eb lx ed ef hh bi translated">迁移Azure资源和JSON ARM模板以使用Bicep - Learn</h2><div class="ly l"><h3 class="bd b fi z dy lw ea eb lx ed ef dx translated">将您的Azure资源导出并转换为Bicep文件，并将您的JSON ARM模板迁移到Bicep。重构您的…</h3></div><div class="lz l"><p class="bd b fp z dy lw ea eb lx ed ef dx translated">docs.microsoft.com</p></div></div><div class="ma l"><div class="mb l mc md me ma mf lg lr"/></div></div></a></div><p id="693f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">查看二头肌游乐场:</p><p id="4e60" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">👉【https://aka.ms/bicepdemo T2】号</p><p id="ba68" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" href="http://eepurl.com/gKmLdf" rel="noopener ugc nofollow" target="_blank"> <em class="kq">在此加入</em><strong class="ih hj"><em class="kq">azin sider</em></strong><em class="kq">邮箱列表。</em>T13】</a></p><p id="bc5e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="kq">-戴夫·r</em></p></div></div>    
</body>
</html>