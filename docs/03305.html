<html>
<head>
<title>Setting up Airbyte ETL: Minimum Viable Data Stack Part II</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">设置Airbyte ETL:最小可行数据栈第二部分</h1>
<blockquote>原文：<a href="https://medium.com/codex/setting-up-airbyte-etl-minimum-viable-data-stack-part-ii-c5f8bbfb406d?source=collection_archive---------10-----------------------#2021-08-27">https://medium.com/codex/setting-up-airbyte-etl-minimum-viable-data-stack-part-ii-c5f8bbfb406d?source=collection_archive---------10-----------------------#2021-08-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/b9ab2ce486f0623f9ddb9e82db20d973.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*qcxlQZHi7BVHaWnU.jpeg"/></div></div></figure><p id="3f42" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在最小可行数据堆栈系列的第一篇文章中，我们设置了一个使用SQL分析CSV数据的进程来启动T2。我们在Mac个人电脑上设置了一个Postgres数据库实例，上传了一个CSV文件，并编写了一个查询来分析CSV文件中的数据。</p><p id="e8b4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">这是一个好的开始！</strong>您可以按照这种模式对不适合Excel或Google工作表的CSV文件进行一些有趣的分析。但是这种模式很慢，并且需要您在新数据可用时不断上传新数据。</p><p id="cbc2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这篇文章将展示如何直接连接到数据源，这样你就可以在数据可用时自动加载数据。</p><p id="3861" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这个过程被称为ETL，是提取、转换、加载的缩写。简单地说，ETL仅仅意味着，<em class="jp">“连接到一个数据源，以一种可以存储在数据库表中的方式组织数据，并将其加载到那些表中。”如果你真的想深入了解的话，还有更多的东西，但就我们的目的而言，你现在只需要知道这些。</em></p><p id="8d0e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对于教程的这一部分，<strong class="is hj">我们将使用一个名为Airbyte的开源ETL工具来连接Hubspot，并将一些联系人数据加载到我们之前设置的同一个Postgres数据库中。</strong>然后我们将运行几个分析查询来吊起你的胃口！</p><h2 id="ab70" class="jq jr hi bd js jt ju jv jw jx jy jz ka jb kb kc kd jf ke kf kg jj kh ki kj kk bi translated"><strong class="ak">设置ETL工具(Airbyte) </strong></h2><p id="f240" class="pw-post-body-paragraph iq ir hi is b it kl iv iw ix km iz ja jb kn jd je jf ko jh ji jj kp jl jm jn hb bi translated">我为这个演示选择了<a class="ae jo" href="https://airbyte.io/" rel="noopener ugc nofollow" target="_blank"> Airbyte </a>,因为它是开源的，这意味着只要你有一台运行它的计算机或服务器，它就可以免费使用。它很大程度上基于另一个ETL工具的开源工作，这个工具叫做<a class="ae jo" href="https://www.stitchdata.com/" rel="noopener ugc nofollow" target="_blank"> Stitch </a>在被Talend收购之前一直在推广。那个项目叫<a class="ae jo" href="https://www.singer.io/" rel="noopener ugc nofollow" target="_blank">歌手</a>。</p><p id="60c7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对于我们最小可行的数据堆栈来说，Airbyte最好的一点是，它们使运行开源代码变得如此容易，因为它被打包在另一个名为<a class="ae jo" href="https://www.docker.com/" rel="noopener ugc nofollow" target="_blank"> Docker </a>的软件框架中。是的，如果你在家做记录，这意味着我们正在使用一个开源框架，它被打包在另一个开源框架中，又被打包在另一个开源框架中。哦，开源的美妙之处！</p><p id="f4bd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了使本教程易于管理，我将完全“手动”Docker设置。幸运的是，这很容易做到。由于本教程是针对Mac的，<strong class="is hj">遵循</strong> <a class="ae jo" href="https://docs.docker.com/desktop/mac/install/" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj"> Docker针对Mac的安装说明</strong> </a> <strong class="is hj">。</strong></p><p id="c21b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="jp">🎵安装Docker时会播放插曲音乐🎵</em></p><p id="62a0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">一旦你安装了Docker </strong>，你就可以运行Docker应用程序，这将允许你运行名为“容器”的应用程序把容器想象成<em class="jp">“一个应用程序需要的所有代码和依赖项，打包后你只需点击“开始”</em>(而不是一个接一个地加载所有独立的依赖项！)</p><figure class="kq kr ks kt fd ij er es paragraph-image"><div class="ab fe cl ku"><img src="../Images/c61759da1ea08bf193e8a2d5ad1c5da9.png" data-original-src="https://miro.medium.com/v2/0*NZ5O4YohgU7vHVhe"/></div></figure><p id="f7af" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将只在Docker上下载和运行一个应用程序:Airbyte！</p><p id="361b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">注意:</strong>如果你在接下来的几个步骤中需要帮助，<a class="ae jo" href="https://airbyte.io/community" rel="noopener ugc nofollow" target="_blank"> Airbyte有一个Slack社区</a>真的很有帮助。</p><p id="c003" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下载Airbyte的指令很简单。打开你的终端就行了(使用Mac的spotlight搜索[cmd+space]输入“终端”就能找到这个)。在终端中只需粘贴以下三个命令:</p><pre class="kq kr ks kt fd kv kw kx ky aw kz bi"><span id="e3a2" class="jq jr hi kw b fi la lb l lc ld">git clone https://github.com/airbytehq/airbyte.git<br/>cd airbyte<br/>docker-compose up</span></pre><p id="3836" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">这些命令告诉你的电脑</strong>将Github存储库中的所有代码复制到你的电脑中一个名为“airbyte”的文件夹，然后将“cd”也就是“changing the directory”复制到“airbyte”目录，然后告诉Docker运行Airbyte应用程序容器。</p><p id="57b5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">它的美妙之处在于，一旦你第一次从命令行运行它，你就可以通过点击“play”按钮从Docker UI启动Airbyte。</p><figure class="kq kr ks kt fd ij er es paragraph-image"><div class="ab fe cl ku"><img src="../Images/84fd0610aafed5edfed6491faf369ddb.png" data-original-src="https://miro.medium.com/v2/0*jq9MCQnFp1UHXt6E"/></div></figure><p id="a08a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Airbyte将做一些设置，然后您的终端将显示上面显示的文本。此时，Airbyte正在你的电脑上运行，要使用它，你所要做的就是打开浏览器，进入<a class="ae jo" href="http://localhost:8000" rel="noopener ugc nofollow" target="_blank"> http://localhost:8000 </a>。</p><p id="64be" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">如果你想知道这是如何工作的</strong>，Airbyte正在运行一个web服务器来提供一个web接口，与完成所有繁重的ETL工作的代码进行交互。如果这是一个普通的ETL工具，如<a class="ae jo" href="https://www.stitchdata.com/" rel="noopener ugc nofollow" target="_blank"> Stitch </a>或<a class="ae jo" href="https://fivetran.com/" rel="noopener ugc nofollow" target="_blank"> Fivetran </a>，网络服务器和ETL进程将运行在一个真实的服务器上，而不是你的个人电脑上。</p><p id="1244" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果一切都按计划进行，你可以访问<a class="ae jo" href="http://localhost:8000" rel="noopener ugc nofollow" target="_blank"> http://localhost:8000 </a>并看到Airbyte应用程序UI正在运行并准备开始ETL-ing！</p><figure class="kq kr ks kt fd ij er es paragraph-image"><div class="ab fe cl ku"><img src="../Images/34523c197ad84d24698c10df5a135dda.png" data-original-src="https://miro.medium.com/v2/0*l7K4rC9_wR-eDUuv"/></div></figure><h2 id="17ec" class="jq jr hi bd js jt ju jv jw jx jy jz ka jb kb kc kd jf ke kf kg jj kh ki kj kk bi translated"><strong class="ak">设置您的第一个ETL作业(Hubspot到Postgres) </strong></h2><p id="c8ec" class="pw-post-body-paragraph iq ir hi is b it kl iv iw ix km iz ja jb kn jd je jf ko jh ji jj kp jl jm jn hb bi translated">我承认，最后一部分有点可怕，但不要担心，从这里开始会变得更容易(只要一切按计划进行……)</p><p id="748f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">从这里开始，我们必须将数据库和数据源都连接到Airbyte，这样它就可以访问源数据并获得写入数据库的权限。</p><p id="9fc4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我选择从Hubspot加载数据，因为它真的很容易连接，因为它显示了ETL的起伏……当然，我们仍在使用Postgres。</p><h2 id="71d1" class="jq jr hi bd js jt ju jv jw jx jy jz ka jb kb kc kd jf ke kf kg jj kh ki kj kk bi translated"><strong class="ak">创建Postgres目的地</strong></h2><p id="fc93" class="pw-post-body-paragraph iq ir hi is b it kl iv iw ix km iz ja jb kn jd je jf ko jh ji jj kp jl jm jn hb bi translated">你所要做的就是从Postgres.app中粘贴你的数据库凭证。</p><p id="9e34" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这些是我们在上一篇文章中用来连接Postico的相同ODBC凭证。您可以通过点击您的数据库名称在Postico主页屏幕上找到它们。注意</p><figure class="kq kr ks kt fd ij er es paragraph-image"><div class="ab fe cl ku"><img src="../Images/ced2d651b5248c633e9eef508ec2009a.png" data-original-src="https://miro.medium.com/v2/0*tnbFjV88m9Zol0jJ"/></div></figure><p id="6f44" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在我的例子中，这些是设置:</p><ul class=""><li id="e272" class="le lf hi is b it iu ix iy jb lg jf lh jj li jn lj lk ll lm bi translated">我称它为“Postgres.app ”,但它可以是你想要的任何东西</li><li id="42ec" class="le lf hi is b it ln ix lo jb lp jf lq jj lr jn lj lk ll lm bi translated"><strong class="is hj">主机:</strong>使用<strong class="is hj">Host . docker . internal</strong>(localhost不支持Docker。参见上面的说明)</li><li id="db54" class="le lf hi is b it ln ix lo jb lp jf lq jj lr jn lj lk ll lm bi translated"><strong class="is hj">端口:</strong> 5432</li><li id="ca8c" class="le lf hi is b it ln ix lo jb lp jf lq jj lr jn lj lk ll lm bi translated"><strong class="is hj">数据库名称:</strong>我的是“trevorfox”这是我默认的Postgres.app数据库的名称</li><li id="7cea" class="le lf hi is b it ln ix lo jb lp jf lq jj lr jn lj lk ll lm bi translated"><strong class="is hj">模式:</strong>我将其保留为“public”你可能希望<a class="ae jo" href="https://docs.airbyte.io/understanding-airbyte/namespaces" rel="noopener ugc nofollow" target="_blank">将模式用于组织目的</a>。模式是“名称空间”,您可以将它们视为表的文件夹。</li><li id="fb91" class="le lf hi is b it ln ix lo jb lp jf lq jj lr jn lj lk ll lm bi translated">用户:同样，我的名字是“trevorfox ”,因为这是我设置Postgres.app时的默认设置</li><li id="dddd" class="le lf hi is b it ln ix lo jb lp jf lq jj lr jn lj lk ll lm bi translated"><strong class="is hj">密码:</strong>除非您在Postgres.app中设置了密码，否则可以留空</li></ul><p id="79d7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">从那里，您可以测试您的连接，您应该会看到一条消息说，“所有连接测试通过！”</p><h2 id="f11a" class="jq jr hi bd js jt ju jv jw jx jy jz ka jb kb kc kd jf ke kf kg jj kh ki kj kk bi translated"><strong class="ak">创建轮毂点源</strong></h2><p id="421d" class="pw-post-body-paragraph iq ir hi is b it kl iv iw ix km iz ja jb kn jd je jf ko jh ji jj kp jl jm jn hb bi translated">您首先需要<a class="ae jo" href="https://knowledge.hubspot.com/integrations/how-do-i-get-my-hubspot-api-key" rel="noopener ugc nofollow" target="_blank">检索您的API密钥</a>。一旦你得到了它，你可以在Airbyte中创建一个新的Hubspot源。</p><p id="9f34" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我使用了这些设置:</p><ul class=""><li id="bdaa" class="le lf hi is b it iu ix iy jb lg jf lh jj li jn lj lk ll lm bi translated"><strong class="is hj">名称:</strong>轮毂点</li><li id="a1a8" class="le lf hi is b it ln ix lo jb lp jf lq jj lr jn lj lk ll lm bi translated"><strong class="is hj">源类型:</strong>轮毂点</li><li id="39d1" class="le lf hi is b it ln ix lo jb lp jf lq jj lr jn lj lk ll lm bi translated"><strong class="is hj"> API密钥:</strong>我的Hubspot API密钥</li><li id="81e7" class="le lf hi is b it ln ix lo jb lp jf lq jj lr jn lj lk ll lm bi translated"><strong class="is hj"> start_date: </strong>我用的是<strong class="is hj">2017–01–25t 00:00:00Z</strong>2017年1月1日的机器可读时间戳</li></ul><figure class="kq kr ks kt fd ij er es paragraph-image"><div class="ab fe cl ku"><img src="../Images/bc71a0799d12060895cff6a76a41f510.png" data-original-src="https://miro.medium.com/v2/0*faZrnf2rFtFJnFf6"/></div></figure><p id="2bfd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="jp">这里有一张可爱的图片来庆祝走了这么远！</em></p><figure class="kq kr ks kt fd ij er es paragraph-image"><div class="ab fe cl ku"><img src="../Images/f934d7317f550f8f1101424d34b78a8e.png" data-original-src="https://miro.medium.com/v2/0*3DcATtnkVGAC0ky-"/></div></figure><h2 id="1d9e" class="jq jr hi bd js jt ju jv jw jx jy jz ka jb kb kc kd jf ke kf kg jj kh ki kj kk bi translated"><strong class="ak">创建ETL连接</strong></h2><p id="e441" class="pw-post-body-paragraph iq ir hi is b it kl iv iw ix km iz ja jb kn jd je jf ko jh ji jj kp jl jm jn hb bi translated">既然我们已经创建了一个目的地和一个源，我们所要做的就是告诉Airbyte我们想从源中提取数据并将数据加载到目的地。</p><p id="0555" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">返回目的地屏幕，打开Postgres.app来源，点击“添加来源”，然后选择您的来源。对我来说，这是我创造的名为“中枢点”的来源</p><p id="3c98" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后，Airbyte将去测试源和目的地。一旦两个测试都成功，您就可以设置您的同步。</p><figure class="kq kr ks kt fd ij er es paragraph-image"><div class="ab fe cl ku"><img src="../Images/03bd5c8b8c84f4f68f48abc54a042e0b.png" data-original-src="https://miro.medium.com/v2/0*EZdc1I2lPvL3SToH"/></div></figure><p id="142c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">设置很多！幸运的是，你可以让它们保持原样，直到你想更具体地了解如何存储和组织你的数据。</strong></p><p id="d52b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，将<strong class="is hj">同步频率</strong>设置为“手动”，取消选中除联系人之外的所有Hubspot对象。</p><p id="6fa6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">将来，您可以选择加载更多的对象来进行更复杂的分析，但是从联系人开始比较好，因为完成第一次加载会快很多，而且分析仍然会很有趣。</p><p id="ce30" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">单击屏幕底部的“设置连接”按钮。</p><figure class="kq kr ks kt fd ij er es paragraph-image"><div class="ab fe cl ku"><img src="../Images/4513785e590cb33fdda668b65999c9f1.png" data-original-src="https://miro.medium.com/v2/0*xuHtvSPgJWhWROO2"/></div></figure><p id="cbdf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">您已经创建了您的第一个连接！</strong>点击“立即同步”,启动ETL作业！</p><p id="3777" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">同步运行时，您会看到大量日志。如果你仔细看，你会看到一些写着“…记录读取:3000”等。这将让您了解同步的进度。</p><figure class="kq kr ks kt fd ij er es paragraph-image"><div class="ab fe cl ku"><img src="../Images/ab95be50aa5f84c7c33820c8c9186093.png" data-original-src="https://miro.medium.com/v2/0*xNWthIn-daWZX0Nq"/></div></figure><p id="dcab" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">现在Postgres在发生什么？</strong></p><p id="e5f1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Airbyte正在创建临时表并将所有数据加载到这些表中。然后，它会将该数据复制到最终状态表中。这些表将以一种更容易分析的方式进行组织。这是ETL过程中更多的<strong class="is hj"> T </strong>和<strong class="is hj"> L </strong>！</p><p id="c44d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当同步运行时，您可以返回Postico并刷新表列表(cmd+R ),以查看生成的新表。</p><h2 id="68bb" class="jq jr hi bd js jt ju jv jw jx jy jz ka jb kb kc kd jf ke kf kg jj kh ki kj kk bi translated"><strong class="ak">我们来看数据！</strong></h2><p id="6e8c" class="pw-post-body-paragraph iq ir hi is b it kl iv iw ix km iz ja jb kn jd je jf ko jh ji jj kp jl jm jn hb bi translated">当作业完成时，您会注意到Airbyte已经在数据库中创建了许多表。有一个“contacts”表，但是还有很多其他表以“contacts_”为前缀。</p><h2 id="3d4d" class="jq jr hi bd js jt ju jv jw jx jy jz ka jb kb kc kd jf ke kf kg jj kh ki kj kk bi translated">为什么这么多桌子？</h2><p id="57a2" class="pw-post-body-paragraph iq ir hi is b it kl iv iw ix km iz ja jb kn jd je jf ko jh ji jj kp jl jm jn hb bi translated">这些都是从一个<a class="ae jo" href="https://en.wikipedia.org/wiki/JSON" rel="noopener ugc nofollow" target="_blank"> JSON </a> <a class="ae jo" href="https://trevorfox.com/2016/08/what-is-an-api/" rel="noopener ugc nofollow" target="_blank"> REST API </a>中获取数据并将其全部转换成表格的残余。JSON是一种非常灵活的组织数据的方式。桌子不是。因此，为了让所有嵌套的JSON数据很好地适应表格，您最终会用很多表格来表示所有的嵌套。仅Contacts API资源就生成了124个“contacts_”表。自己看:</p><pre class="kq kr ks kt fd kv kw kx ky aw kz bi"><span id="cd48" class="jq jr hi kw b fi la lb l lc ld">​​select count(tablename)<br/>from pg_tables t<br/>where t.tablename like 'contacts_%'</span></pre><p id="fee5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">该查询查询名为pg_tables的Postgres系统表，正如您可能猜到的那样，该表包含每个表的一行和一些元数据。通过对匹配前缀“contacts_”的表进行计数，您将看到所有来自contacts资源的表。</p><h2 id="48d9" class="jq jr hi bd js jt ju jv jw jx jy jz ka jb kb kc kd jf ke kf kg jj kh ki kj kk bi translated"><strong class="ak">你为什么关注数据建模和英语教学</strong></h2><p id="3126" class="pw-post-body-paragraph iq ir hi is b it kl iv iw ix km iz ja jb kn jd je jf ko jh ji jj kp jl jm jn hb bi translated">为了以更适合分析的方式组织这些数据，您必须将表连接在一起，并选择想要保留的列。这个清理过程加上其他业务逻辑和过滤被称为<a class="ae jo" href="https://panoply.io/analytics-stack-guide/data-modeling-examples-for-analytics/" rel="noopener ugc nofollow" target="_blank">数据建模</a>。</p><p id="dc90" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最近越来越普遍的做法是，一旦数据进入数据库，就用SQL对其建模(而不是在数据被提取之后、加载到数据库之前)。这就产生了术语E <em class="jp"> L </em> T，用来说明大多数转换都是在数据进入数据库之后发生的。这里有很多要讨论的。在某个时候，我可能不得不原路返回…</p><figure class="kq kr ks kt fd ij er es paragraph-image"><div class="ab fe cl ku"><img src="../Images/c1344770bdb2ee3c163058b243abd443.png" data-original-src="https://miro.medium.com/v2/0*jZNt8wH7QzmURe7p"/></div></figure><p id="5319" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">幸运的是，我们可以忽略这些表格中的大部分。我们将重点关注“联系人”表。</p><h2 id="53c0" class="jq jr hi bd js jt ju jv jw jx jy jz ka jb kb kc kd jf ke kf kg jj kh ki kj kk bi translated"><strong class="ak">分析数据</strong></h2><p id="cb78" class="pw-post-body-paragraph iq ir hi is b it kl iv iw ix km iz ja jb kn jd je jf ko jh ji jj kp jl jm jn hb bi translated">让我们首先检查数据，感受一下它的样子。最好从健全检查开始，确保你所有的联系人都在里面。这个查询将告诉您有多少联系人进入了数据库。这应该与你在Hubspot应用程序中看到的一致。</p><pre class="kq kr ks kt fd kv kw kx ky aw kz bi"><span id="b856" class="jq jr hi kw b fi la lb l lc ld">select count(*)<br/>from contacts</span></pre><p id="997a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你可能会问的第一个问题是<strong class="is hj">随着时间的推移，我的联系人是如何增长的？这是一个很好的查询，可以展示一些东西:ETL工具将数据写入表格的不完美方式，数据建模的重要性，以及ELT的实际应用。</strong></p><p id="9f16" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在上面的截图中，您会注意到“contacts”表有一堆列，但其中一列充满了大量数据。“属性”列表示<a class="ae jo" href="https://legacydocs.hubspot.com/docs/methods/contacts/contacts-overview#:~:text=Contacts%20will%20return%20the%20following%20data%2C" rel="noopener ugc nofollow" target="_blank"> Hubspot联系人API响应</a>中的嵌套对象。该对象包含联系人的所有有趣属性，如创建时间、来自哪个国家，以及企业可能存储在Hubspot中的其他联系人数据。</p><p id="336b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">默认情况下，Airbyte将整个对象作为JSON字段转储到Postgres中。这意味着为了将数据分解成列，你必须变得狡猾。以下是如何获得联系人的id，即创建它的数据。(随着时间的推移，这将是联系计数的第一步)</p><pre class="kq kr ks kt fd kv kw kx ky aw kz bi"><span id="bcaf" class="jq jr hi kw b fi la lb l lc ld">select c.properties-&gt;&gt;'hs_object_id' id, <br/>	c.createdat::date<br/>from contacts c<br/>limit 10;</span></pre><p id="a8cf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">请注意字段“c . properties--&gt; &gt;‘hs _ object _ id’。”“--&gt; &gt;”是从JSON类型的字段中获取JSON对象字段的方式。</p><p id="3cca" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要按月统计新联系人，我们可以在上面的查询中添加一点聚合。</p><pre class="kq kr ks kt fd kv kw kx ky aw kz bi"><span id="3dd6" class="jq jr hi kw b fi la lb l lc ld">select date_trunc('week', c.createdat::date) created_month,<br/>	count(distinct c.properties-&gt;&gt;'hs_object_id')  contact_count<br/>from contacts c<br/>group by created_month<br/>order by created_month desc;</span></pre><p id="b5d3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">就是它了！</strong>这就是使用适当的分析堆栈进行分析的美妙之处。明天、第二天以及未来的每一天，您都可以运行Hubspot sync并在此报告中查看最新指标！</p><p id="3d85" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您将了解到，您运行的查询越多，您就越厌倦清理和格式化数据。我的朋友们，这就是为什么数据建模和ELT！</p><figure class="kq kr ks kt fd ij er es paragraph-image"><div class="ab fe cl ku"><img src="../Images/4a30cb7c7bd38acf82a28c43e23af6c1.png" data-original-src="https://miro.medium.com/v2/0*zM85cO2I1HrJIMGM"/></div></figure><p id="af7d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">自从上一篇帖子之后，我就换成了黑暗模式:]</p><h2 id="8785" class="jq jr hi bd js jt ju jv jw jx jy jz ka jb kb kc kd jf ke kf kg jj kh ki kj kk bi translated"><strong class="ak">期待</strong></h2><p id="88cd" class="pw-post-body-paragraph iq ir hi is b it kl iv iw ix km iz ja jb kn jd je jf ko jh ji jj kp jl jm jn hb bi translated">在这一点上，堆栈是非常可行的。我们有一个Postgres数据库(我们的数据仓库)，一个将我们的数据与源系统中的数据保持同步的ETL过程(Airbyte)，以及用于分析这些数据的工具(SQL和Postico)。现在，你可以以任何你喜欢的频率回答任何关于你的Hubspot数据的问题——而且你永远也不需要接触电子表格！</p><p id="5c27" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">基础已经奠定，但前方仍有更多灵感。从这里开始，自然要深入分析和可视化。</p><p id="f4ad" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在下一篇文章中，我们将设置<a class="ae jo" href="https://www.metabase.com/" rel="noopener ugc nofollow" target="_blank">元数据库</a>来可视化Hubspot数据，并基于一些SQL查询创建一个简单的仪表板。从那里，我想象我们将走向<a class="ae jo" href="https://blog.getcensus.com/what-is-reverse-etl/" rel="noopener ugc nofollow" target="_blank">反向ETL </a>并将分析推回到Hubspot。=]</p><p id="fc04" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你有足够的勇气跟随，我希望这至少是有趣的和有帮助的。请在评论中告诉我你是否被挂住了，或者是否有我应该添加的说明。</p></div></div>    
</body>
</html>