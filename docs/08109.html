<html>
<head>
<title>How to build an API with TypeScript and use it in React (PART 2)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用TypeScript构建API并在React中使用它(第2部分)</h1>
<blockquote>原文：<a href="https://medium.com/codex/how-to-build-an-api-with-typescript-and-use-it-in-react-part-2-2c789fa38a0?source=collection_archive---------7-----------------------#2022-07-17">https://medium.com/codex/how-to-build-an-api-with-typescript-and-use-it-in-react-part-2-2c789fa38a0?source=collection_archive---------7-----------------------#2022-07-17</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="4443" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">API的使用在编程中是必不可少的。从数据解释的角度来看，这些是两个应用程序之间最关键的层。本文解释了如何创建一个并在React应用程序中使用它。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/769b008725fd3857c0db02c467f5f919.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rDAjomK78Q8rsiRFqAFsSQ.png"/></div></div></figure><p id="3fad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">好吧，我们说到哪了？</p><p id="44e1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们有一个运行在<code class="du jp jq jr js b">localhost:3000</code>上的完美的API，如果我们进行调用，它会发送一个对象:</p><pre class="je jf jg jh fd jt js ju jv aw jw bi"><span id="a20e" class="jx jy hi js b fi jz ka l kb kc">{<br/>  message: 'Awesome!'<br/>}</span></pre><p id="88e8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">记住，因为用<code class="du jp jq jr js b">nodemon</code>运行我们的API，我们完全有能力在任何时候到达它，直到我们停止它。我们不仅可以手动调用，还可以从另一个应用程序调用，所以让我们创建一个新的React TypeScript项目。您可以从这里开始在前端应用程序中使用来自API的数据！</p><pre class="je jf jg jh fd jt js ju jv aw jw bi"><span id="de23" class="jx jy hi js b fi jz ka l kb kc">😎 <strong class="js hj">CREATE A NEW REACT APPLICATION FROM YOUR TERMINAL</strong><br/>npx create-react-app awesome-app --template typescript</span></pre><p id="a985" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我们开始新的前端应用程序之前，请想一想这里会发生什么。我们有一个API运行在<code class="du jp jq jr js b">localhost</code>，端口<code class="du jp jq jr js b">3000</code>。现在我们将启动我们的React应用程序，它最初也会尝试在<code class="du jp jq jr js b">localhost</code>端口<code class="du jp jq jr js b">3000</code>上启动！</p><p id="4da9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了与React应用程序并行运行API，我们需要更改API的端口</p><pre class="je jf jg jh fd jt js ju jv aw jw bi"><span id="160c" class="jx jy hi js b fi jz ka l kb kc">❗️ <strong class="js hj">CHANGE THE PORT NUMBER OF THE API BEFORE STARTING REACT APP</strong><br/>...<br/><strong class="js hj">const port = 3001</strong><br/>app.listen(port, () =&gt; {<br/>  console.log('App is listening on port', port)<br/>})<br/>...</span></pre><p id="c19b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了支持React应用程序的调用，另一件要做的事情是向服务器添加一个CORS头。</p><pre class="je jf jg jh fd jt js ju jv aw jw bi"><span id="4237" class="jx jy hi js b fi jz ka l kb kc">💡 <em class="kd">CORS = Cross-Origin Resource Sharing</em></span></pre><p id="4ff4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，将<code class="du jp jq jr js b">cors</code>库添加到API中</p><pre class="je jf jg jh fd jt js ju jv aw jw bi"><span id="efc7" class="jx jy hi js b fi jz ka l kb kc">➕ <strong class="js hj">ADD CORS LIBRARY TO YOUR API</strong><br/>cd ../my-first-api<br/>npm i cors</span></pre><p id="42df" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了让API实际使用它，我们必须定义它并允许服务器文件中的<code class="du jp jq jr js b">localhost:3000</code>请求</p><pre class="je jf jg jh fd jt js ju jv aw jw bi"><span id="da40" class="jx jy hi js b fi jz ka l kb kc">🍏 <strong class="js hj">DEFINE CORS</strong><br/>...<br/>const cors = require('cors')<br/>...<br/>app.use(cors({<br/>  origin: '<a class="ae ke" href="http://localhost:3000'" rel="noopener ugc nofollow" target="_blank">http://localhost:3000'</a><br/>}))<br/>...</span></pre><p id="491d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果想不起来或者根本不知道，可以再读一遍第1部分的API代码:</p><div class="kf kg ez fb kh ki"><a rel="noopener follow" target="_blank" href="/codex/how-to-build-an-api-with-typescript-and-use-it-in-react-part-1-2dab843d12be"><div class="kj ab dw"><div class="kk ab kl cl cj km"><h2 class="bd hj fi z dy kn ea eb ko ed ef hh bi translated">如何用TypeScript构建API并在React中使用它(第1部分)</h2><div class="kp l"><h3 class="bd b fi z dy kn ea eb ko ed ef dx translated">API的使用在编程中是必不可少的。从数据解读的角度来看，这些是最关键的…</h3></div><div class="kq l"><p class="bd b fp z dy kn ea eb ko ed ef dx translated">medium.com</p></div></div><div class="kr l"><div class="ks l kt ku kv kr kw jn ki"/></div></div></a></div><p id="092b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，您应该打开React应用程序文件夹(在我们的示例中，文件夹名称是您的应用程序的名称<code class="du jp jq jr js b">awesome-app</code>)并开始处理您的项目</p><pre class="je jf jg jh fd jt js ju jv aw jw bi"><span id="a9a6" class="jx jy hi js b fi jz ka l kb kc">🔌 STEP INTO YOUR REACT APP FOLDER AND START IT<br/>cd ../awesome-app<br/>npm start</span></pre><p id="cd83" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">干得好！如果一切按计划进行，您应该会看到一个旋转的React徽标和一些文本。现在继续删除<code class="du jp jq jr js b">App.tsx</code>中的所有内容，并在<code class="du jp jq jr js b">return</code>键后留下一个空白<code class="du jp jq jr js b">&lt;div&gt;&lt;/div&gt;</code>。</p><pre class="je jf jg jh fd jt js ju jv aw jw bi"><span id="699a" class="jx jy hi js b fi jz ka l kb kc">🦴 <strong class="js hj">LEAVE JUST A BLANK PAGE IN App.tsx FOR NOW</strong><br/>function App() {<br/>  return (<br/>    &lt;div&gt;<br/>    &lt;/div&gt;<br/>  )<br/>}<br/>export default App</span></pre><p id="26dc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们必须以某种方式将数据从正在运行的API中获取到前端应用程序中。我们可以用<code class="du jp jq jr js b">fetch</code>来实现。首先，我们需要创建一个名为<code class="du jp jq jr js b">data</code>的新的简单<code class="du jp jq jr js b">state</code></p><pre class="je jf jg jh fd jt js ju jv aw jw bi"><span id="2e16" class="jx jy hi js b fi jz ka l kb kc">💾  <strong class="js hj">CREATE A NEW STATE</strong><br/>function App() {<br/>  <strong class="js hj">const [data, setData] = useState&lt;{ message: string } | null&gt;(null)</strong><br/>  return (<br/>    &lt;div&gt;<br/>    &lt;/div&gt;<br/>  )<br/>}<br/>export default App</span></pre><p id="e9e0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你必须意识到</p><pre class="je jf jg jh fd jt js ju jv aw jw bi"><span id="9685" class="jx jy hi js b fi jz ka l kb kc">💡 <em class="kd">You must type your new state to prevent type errors since we are using TypeScript yet again</em></span></pre><p id="150f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后一步是以某种方式将来自API的数据设置为前端的<code class="du jp jq jr js b">data</code>状态。为此，我们将利用<code class="du jp jq jr js b">useEffect</code>钩子中的<code class="du jp jq jr js b">fetch</code>函数。</p><pre class="je jf jg jh fd jt js ju jv aw jw bi"><span id="6681" class="jx jy hi js b fi jz ka l kb kc">🦄 <strong class="js hj">SET THE DATA FROM THE API TO THE FRONTEND'S STATE</strong><br/>import {useEffect, useState} from "react";<br/>function App() {<br/>  const [data, setData] = useState&lt;{ message: string } | null&gt;(null)<br/>  <strong class="js hj">useEffect(() =&gt; {<br/>    fetch('</strong><a class="ae ke" href="http://localhost:3001/'" rel="noopener ugc nofollow" target="_blank"><strong class="js hj">http://localhost:3001/'</strong></a><strong class="js hj">, {<br/>      method: "GET",<br/>      headers: {<br/>        'Accept': 'application/json',<br/>        'Content-Type': 'application/json',<br/>        'Access-Control-Allow-Origin': '*'<br/>      },<br/>    })<br/>      .then(res =&gt; res.json())<br/>      .then(_data =&gt; setData(_data))<br/>  }, [])</strong><br/>  return (<br/>    &lt;div&gt;<br/>    &lt;/div&gt;<br/>  )<br/>}<br/>export default App;</span></pre><p id="6010" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如你所见，我们将一些重要的参数传递给这里的<code class="du jp jq jr js b">fetch</code>。首先我们设置地址，地址是<code class="du jp jq jr js b"><a class="ae ke" href="http://localhost:3001/`" rel="noopener ugc nofollow" target="_blank">http://localhost:3001/</a></code>。然后我们开始添加额外的参数，比如<code class="du jp jq jr js b">method</code>。还记得我们在API中使用了<code class="du jp jq jr js b">app.get</code>吗？这个<code class="du jp jq jr js b">get</code>(或<code class="du jp jq jr js b">GET</code>)也是在前端app中定义的！在一些请求头设置和<code class="du jp jq jr js b">JSON</code>格式化之后，瞧，我们可以用来自API的对象设置<code class="du jp jq jr js b">data</code>状态了！最后要做的是在组件中将其显示为<code class="du jp jq jr js b">{data.message}</code></p><pre class="je jf jg jh fd jt js ju jv aw jw bi"><span id="4ae8" class="jx jy hi js b fi jz ka l kb kc">⭐️ SHOW THE MESSAGE<br/>import {useEffect, useState} from "react";<br/>function App() {<br/>  const [data, setData] = useState&lt;{ message: string } | null&gt;(null)<br/>  useEffect(() =&gt; {<br/>    fetch('<a class="ae ke" href="http://localhost:3001/'" rel="noopener ugc nofollow" target="_blank">http://localhost:3001/'</a>, {<br/>      method: "GET",<br/>      headers: {<br/>        'Accept': 'application/json',<br/>        'Content-Type': 'application/json',<br/>        'Access-Control-Allow-Origin': '*'<br/>      },<br/>    })<br/>      .then(res =&gt; res.json())<br/>      .then(_data =&gt; setData(_data))<br/>  }, [])<br/>  return (<br/>    &lt;div&gt;<br/><strong class="js hj">      &lt;div&gt;Message from the API:&lt;/div&gt;<br/>      &lt;div&gt;{data?.message &amp;&amp; data.message}&lt;/div&gt;</strong><br/>    &lt;/div&gt;<br/>  )<br/>}<br/>export default App;</span></pre><p id="4f9a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">恭喜你！您已经创建了一个正常工作的API，并使用定制的前端React应用程序从中检索数据。这是一个重要的时刻！</p></div><div class="ab cl kx ky gp kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="hb hc hd he hf"><p id="463a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">👋我希望这在你寻找新的学习材料时对你有用。感谢您花时间阅读本文！</p><p id="465d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你从我的文章中更好地理解了一些东西，<strong class="ih hj">你可以请我喝杯咖啡来支持我</strong>:<a class="ae ke" href="https://www.buymeacoffee.com/daanworks" rel="noopener ugc nofollow" target="_blank">https://www.buymeacoffee.com/daanworks</a></p><p id="27f6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">📯<strong class="ih hj">订阅我的电子邮件列表</strong>，如果你想在未来读到更多这样的故事，请在这里或在<a class="ae ke" href="https://twitter.com/daanwords" rel="noopener ugc nofollow" target="_blank"> Twitter </a> <strong class="ih hj">上关注我！</strong></p></div></div>    
</body>
</html>