<html>
<head>
<title>A Modern Data Warehousing Tool: dbt &amp; Introduction to Analytics Engineering</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">现代数据仓库工具:dbt &amp;分析工程导论</h1>
<blockquote>原文：<a href="https://medium.com/codex/a-modern-data-warehousing-tool-dbt-introduction-to-analytics-engineering-d4245d868e3c?source=collection_archive---------1-----------------------#2022-03-28">https://medium.com/codex/a-modern-data-warehousing-tool-dbt-introduction-to-analytics-engineering-d4245d868e3c?source=collection_archive---------1-----------------------#2022-03-28</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="cf6e" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">利用Docker创建自己的实验室模拟英语教学。什么是分析工程。dbt简介。ETL和ELT有什么区别？</h2></div><h1 id="89fd" class="ix iy hi bd iz ja jb jc jd je jf jg jh io ji ip jj ir jk is jl iu jm iv jn jo bi translated">介绍</h1><p id="46a8" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">我已经用新工具开会三个星期了。在以新的工作范围开始新的工作后，我需要学习新的技术。我已经知道了一些工具，但在这段时间里，我对它们更加熟悉了。例如，我在开始工作之前就知道Docker，但在此之前我并没有怎么使用它。然后，我习惯了Docker，并开始用它做所有的事情😋</p><p id="6fb1" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">在这个故事中，我们将基于Docker创建自己的实验实验室来模拟ELT过程。我将使用dbt 的<a class="ae kq" href="https://courses.getdbt.com/courses/fundamentals" rel="noopener ugc nofollow" target="_blank">官方培训项目中使用的相同数据。但是会有区别，我会用PostgreSQL代替红移，雪花等。因为我不想花太多时间解释它们是什么，以及我们如何创建帐户等。其实我们的实验室会简单一点。我们将从源AWS S3读取数据，然后将数据加载到我们的PostgreSQL数据仓库中，该数据仓库是我们在实验室中使用Docker创建的。因此，我们将能够在本地数据仓库中使用DBT。此外，我开始准备回购收集我的dbt笔记。您可以通过下面的链接访问它。我相信我会加强回购，但我不知道我是否会为我学习的每个dbt模块写一篇论文。</a></p><div class="kr ks ez fb kt ku"><a href="https://github.com/mebaysan/DBT-Training" rel="noopener  ugc nofollow" target="_blank"><div class="kv ab dw"><div class="kw ab kx cl cj ky"><h2 class="bd hj fi z dy kz ea eb la ed ef hh bi translated">GitHub - mebaysan/DBT-Training:我创建了这个repo来遵循DBT的官方培训路径</h2><div class="lb l"><h3 class="bd b fi z dy kz ea eb la ed ef dx translated">我创建了这个回购遵循DBT dbt基础1-dbt-基础文件夹的官方培训路径是为…</h3></div><div class="lc l"><p class="bd b fp z dy kz ea eb la ed ef dx translated">github.com</p></div></div><div class="ld l"><div class="le l lf lg lh ld li lj ku"/></div></div></a></div><p id="69da" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">好的，首先让我们谈谈核心术语。我会把自己通过阅读理解的观点写出来。所以请不要评价我，如果你不同意我的观点，请记住；我不是说我知道最好的或者我的观点是不可讨论的等等。😇</p><figure class="ll lm ln lo fd lp er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es lk"><img src="../Images/51f8cdb941ef6256bdb3e5f764412ca9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9bPL_PdiSxfn1VexE9It_w.png"/></div></div><figcaption class="lv lw et er es lx ly bd b be z dx translated"><a class="ae kq" href="https://blog.getdbt.com/" rel="noopener ugc nofollow" target="_blank">图片来自DBT </a></figcaption></figure><h1 id="2094" class="ix iy hi bd iz ja jb jc jd je jf jg jh io ji ip jj ir jk is jl iu jm iv jn jo bi translated">什么是ELT，ELT和ETL有什么区别？</h1><p id="a922" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">首先，让我们从解释什么是ETL开始。ETL是提取、转换和加载数据的过程。它从从数据源提取数据开始，继续将数据加载到另一个数据源进行转换，然后转换加载的数据。ELT与ETL只是略有不同。ELT的意思是提取、加载、转换。我们首先将数据从源数据库加载到我们的数据仓库，然后对其进行转换以供最终使用。我知道ETL是一个传统的过程，ELT比ETL更现代一点，现在应用得更多。</p><p id="67f4" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">ELT通过转换数据仓库中加载的数据来减少我们的暂存步骤，而不是ETL。</p><h1 id="2688" class="ix iy hi bd iz ja jb jc jd je jf jg jh io ji ip jj ir jk is jl iu jm iv jn jo bi translated">什么是分析工程？</h1><p id="6fdb" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">我想我可以把分析工程描述为数据工程师和数据分析师之间的桥梁。基本上，他们在数据仓库中对数据集建模，为数据分析师等最终用户提供干净的数据集。在小型团队中，分析工程师的职责由数据分析师和数据工程师共同承担。如今，现代数据团队雇佣分析工程师。</p><figure class="ll lm ln lo fd lp er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es lz"><img src="../Images/8e7fdb02b0b4cd3ed840c57caf71d3ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lobLqrSTb_PTZgtmh5uuMQ.png"/></div></div><figcaption class="lv lw et er es lx ly bd b be z dx translated"><a class="ae kq" href="https://www.getdbt.com/what-is-analytics-engineering/" rel="noopener ugc nofollow" target="_blank">图片来自dbt </a></figcaption></figure><p id="14be" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">如果你想深入了解分析工程，你应该查看下面的链接。</p><div class="kr ks ez fb kt ku"><a href="https://www.getdbt.com/what-is-analytics-engineering/" rel="noopener  ugc nofollow" target="_blank"><div class="kv ab dw"><div class="kw ab kx cl cj ky"><h2 class="bd hj fi z dy kz ea eb la ed ef hh bi translated">什么是分析工程？</h2><div class="lb l"><h3 class="bd b fi z dy kz ea eb la ed ef dx translated">分析工程师向最终用户提供干净的数据集，以一种让最终用户能够回答以下问题的方式对数据进行建模…</h3></div><div class="lc l"><p class="bd b fp z dy kz ea eb la ed ef dx translated">www.getdbt.com</p></div></div><div class="ld l"><div class="ma l lf lg lh ld li lj ku"/></div></div></a></div><h1 id="27b7" class="ix iy hi bd iz ja jb jc jd je jf jg jh io ji ip jj ir jk is jl iu jm iv jn jo bi translated">现代数据仓库工具:dbt</h1><p id="35cd" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">dbt让我们有机会将软件工程最佳实践应用到我们的数据建模过程中。我们可以对数据转换过程进行版本控制。</p><div class="kr ks ez fb kt ku"><a href="https://www.getdbt.com/" rel="noopener  ugc nofollow" target="_blank"><div class="kv ab dw"><div class="kw ab kx cl cj ky"><h2 class="bd hj fi z dy kz ea eb la ed ef hh bi translated">dbt -转换仓库中的数据</h2><div class="lb l"><h3 class="bd b fi z dy kz ea eb la ed ef dx translated">dbt是一个数据转换工具，使数据分析师和工程师能够转换，测试和记录数据在…</h3></div><div class="lc l"><p class="bd b fp z dy kz ea eb la ed ef dx translated">www.getdbt.com</p></div></div><div class="ld l"><div class="mb l lf lg lh ld li lj ku"/></div></div></a></div><p id="a7a8" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">我们可以通过<code class="du mc md me mf b">select</code>语句转换数据仓库中的数据。</p><blockquote class="mg mh mi"><p id="edad" class="jp jq mj jr b js kl ij ju jv km im jx mk kn ka kb ml ko ke kf mm kp ki kj kk hb bi translated"><a class="ae kq" href="https://docs.getdbt.com/docs/introduction" rel="noopener ugc nofollow" target="_blank"> dbt执行</a> <code class="du mc md me mf b"><a class="ae kq" href="https://docs.getdbt.com/docs/introduction" rel="noopener ugc nofollow" target="_blank">ELT</a></code> <a class="ae kq" href="https://docs.getdbt.com/docs/introduction" rel="noopener ugc nofollow" target="_blank">中的</a> <code class="du mc md me mf b"><a class="ae kq" href="https://docs.getdbt.com/docs/introduction" rel="noopener ugc nofollow" target="_blank">T</a></code> <a class="ae kq" href="https://docs.getdbt.com/docs/introduction" rel="noopener ugc nofollow" target="_blank">(提取、加载、转换)过程——它不提取或加载数据，但它非常擅长转换已经加载到您的仓库中的数据。</a></p><p id="2374" class="jp jq mj jr b js kl ij ju jv km im jx mk kn ka kb ml ko ke kf mm kp ki kj kk hb bi translated">-官方dbt文件</p></blockquote><p id="42de" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">开始尝试dbt吧！</p><h1 id="179b" class="ix iy hi bd iz ja jb jc jd je jf jg jh io ji ip jj ir jk is jl iu jm iv jn jo bi translated">创建实验码头实验室</h1><p id="e3e1" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">实际上，我不会一步一步地解释这一部分。您可以使用下面的链接访问实验室资源。我更愿意解释实验室的主要逻辑和这个项目的主要组成部分。</p><div class="kr ks ez fb kt ku"><a href="https://github.com/mebaysan/DBT-Training/tree/main/1-dbt-Fundamentals" rel="noopener  ugc nofollow" target="_blank"><div class="kv ab dw"><div class="kw ab kx cl cj ky"><h2 class="bd hj fi z dy kz ea eb la ed ef hh bi translated">DBT-培训/1-dbt-main mebaysan/DBT基础-培训</h2><div class="lb l"><h3 class="bd b fi z dy kz ea eb la ed ef dx translated">在学习本课程时，我使用了dbt CLI而不是dbt Cloud。我选择PostgreSQL作为仓库，而不是…</h3></div><div class="lc l"><p class="bd b fp z dy kz ea eb la ed ef dx translated">github.com</p></div></div><div class="ld l"><div class="mn l lf lg lh ld li lj ku"/></div></div></a></div><p id="ffeb" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">本实验室有4个核心文件:<code class="du mc md me mf b">loader_script.py</code>、<code class="du mc md me mf b">requirements.txt</code>、<code class="du mc md me mf b">Dockerfile</code>和<code class="du mc md me mf b">docker-compose.yml</code>。</p><p id="5ba6" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">文件正在为我们的实验室执行EL、提取和加载过程。基本上，它从CSV文件中读取数据，然后将数据加载到我们已经在<code class="du mc md me mf b">docker-compose.yml</code>文件中创建的数据仓库中。</p><div class="kr ks ez fb kt ku"><a href="https://github.com/mebaysan/DBT-Training/blob/main/1-dbt-Fundamentals/lab/loader_script.py" rel="noopener  ugc nofollow" target="_blank"><div class="kv ab dw"><div class="kw ab kx cl cj ky"><h2 class="bd hj fi z dy kz ea eb la ed ef hh bi translated">DBT-培训/loader_script.py在梅贝桑/DBT-培训</h2><div class="lb l"><h3 class="bd b fi z dy kz ea eb la ed ef dx translated">此文件包含双向Unicode文本，其解释或编译可能与下面显示的不同…</h3></div><div class="lc l"><p class="bd b fp z dy kz ea eb la ed ef dx translated">github.com</p></div></div><div class="ld l"><div class="mo l lf lg lh ld li lj ku"/></div></div></a></div><p id="6aea" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">在<code class="du mc md me mf b">docker-compose.yml</code>文件中，我们准备了实验室。Docker首先创建一个名为<code class="du mc md me mf b">WarehouseDB</code>的PostgreSQL数据库。然后启动<code class="du mc md me mf b">loader</code>服务，将数据加载到<code class="du mc md me mf b">WarehouseDB</code>中。</p><div class="kr ks ez fb kt ku"><a href="https://github.com/mebaysan/DBT-Training/blob/main/1-dbt-Fundamentals/lab/docker-compose.yml" rel="noopener  ugc nofollow" target="_blank"><div class="kv ab dw"><div class="kw ab kx cl cj ky"><h2 class="bd hj fi z dy kz ea eb la ed ef hh bi translated">DBT-Training/docker-compose . yml at main mebaysan/DBT-培训</h2><div class="lb l"><h3 class="bd b fi z dy kz ea eb la ed ef dx translated">此文件包含双向Unicode文本，其解释或编译可能与下面显示的不同…</h3></div><div class="lc l"><p class="bd b fp z dy kz ea eb la ed ef dx translated">github.com</p></div></div><div class="ld l"><div class="mp l lf lg lh ld li lj ku"/></div></div></a></div><p id="a7ca" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated"><code class="du mc md me mf b">loader</code>服务从<code class="du mc md me mf b">Dockerfile</code>开始构建。首先，它安装需求，然后启动到<code class="du mc md me mf b">WarehouseDB</code>的加载过程。最后，它创建了3个模式；<code class="du mc md me mf b">transformed</code>、<code class="du mc md me mf b">jaffle_shop</code>和<code class="du mc md me mf b">stripe</code>。然后，将数据加载到<code class="du mc md me mf b">jaffle_shop</code>和<code class="du mc md me mf b">stripe</code>中。</p><div class="kr ks ez fb kt ku"><a href="https://github.com/mebaysan/DBT-Training/blob/main/1-dbt-Fundamentals/lab/Dockerfile" rel="noopener  ugc nofollow" target="_blank"><div class="kv ab dw"><div class="kw ab kx cl cj ky"><h2 class="bd hj fi z dy kz ea eb la ed ef hh bi translated">DBT ----在梅因梅拜桑/DBT的培训/档案----培训</h2><div class="lb l"><h3 class="bd b fi z dy kz ea eb la ed ef dx translated">此文件包含双向Unicode文本，其解释或编译可能与下面显示的不同…</h3></div><div class="lc l"><p class="bd b fp z dy kz ea eb la ed ef dx translated">github.com</p></div></div><div class="ld l"><div class="mq l lf lg lh ld li lj ku"/></div></div></a></div><p id="23a1" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">我们可以通过使用Docker创建的实验室来模拟我们的ELT程序。为此，我在<code class="du mc md me mf b">lab</code>文件夹中定位我的终端。</p><figure class="ll lm ln lo fd lp er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es mr"><img src="../Images/7065c466cb3b9b2d46701d97bc61a7d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cnNhGJy1vyFTZszRpQkKuA.png"/></div></div><figcaption class="lv lw et er es lx ly bd b be z dx translated">作者图片</figcaption></figure><p id="ffaa" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">我可以执行下面的代码来运行实验室。</p><pre class="ll lm ln lo fd ms mf mt mu aw mv bi"><span id="cd92" class="mw iy hi mf b fi mx my l mz na">docker-compose up -d</span></pre><figure class="ll lm ln lo fd lp er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es nb"><img src="../Images/1df0a24f1ecc0f3f06ebd4bf031802eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fswhFYBwQzXZQ0Y-Ewkwtg.png"/></div></div><figcaption class="lv lw et er es lx ly bd b be z dx translated">作者图片</figcaption></figure><p id="e67d" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">现在，如果我连接到<code class="du mc md me mf b">WarehouseDB</code>数据库，我可以看到我们的加载器服务创建的模式。</p><figure class="ll lm ln lo fd lp er es paragraph-image"><div class="er es nc"><img src="../Images/2f614a669be4201efe833c5182734a99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/format:webp/1*4W7kYt3Do-Mxei4EDhaoig.png"/></div><figcaption class="lv lw et er es lx ly bd b be z dx translated">作者图片</figcaption></figure><p id="2285" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">现在，让我们开始与dbt会面。</p><h1 id="4de1" class="ix iy hi bd iz ja jb jc jd je jf jg jh io ji ip jj ir jk is jl iu jm iv jn jo bi translated">dbt的第一步</h1><p id="0944" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">有几种<a class="ae kq" href="https://docs.getdbt.com/dbt-cli/install/overview" rel="noopener ugc nofollow" target="_blank">安装dbt的方法</a>。我选择使用pip来安装它。然后，我可以使用dbt CLI创建一个空的dbt项目。</p><pre class="ll lm ln lo fd ms mf mt mu aw mv bi"><span id="9641" class="mw iy hi mf b fi mx my l mz na">dbt init</span></pre><figure class="ll lm ln lo fd lp er es paragraph-image"><div class="er es nd"><img src="../Images/1d11e15e8ca4026c528a90f6a041ac1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*7CITm3lbY0WJq8_ojZC0pw.png"/></div><figcaption class="lv lw et er es lx ly bd b be z dx translated">作者图片</figcaption></figure><p id="1f9c" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">我们在下图中看到由<code class="du mc md me mf b">dbt init</code>命令创建的默认文件。</p><figure class="ll lm ln lo fd lp er es paragraph-image"><div class="er es ne"><img src="../Images/19b73764890eabeea0a6714a506e52be.png" data-original-src="https://miro.medium.com/v2/resize:fit:402/format:webp/1*OKpu3yffHSPyGU1cDZE9Vg.png"/></div><figcaption class="lv lw et er es lx ly bd b be z dx translated">作者图片</figcaption></figure><h2 id="fc97" class="mw iy hi bd iz nf ng nh jd ni nj nk jh jy nl nm jj kc nn no jl kg np nq jn nr bi translated">核心dbt组件</h2><p id="6284" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated"><code class="du mc md me mf b">dbt_project.yml</code>文件保存了我们的dbt项目的核心设置。</p><figure class="ll lm ln lo fd lp er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es ns"><img src="../Images/74a48810eee24b3132e51d53a1aff549.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Eg_7Frf5wLs3D7etKhQB3w.png"/></div></div><figcaption class="lv lw et er es lx ly bd b be z dx translated">作者图片</figcaption></figure><p id="c7e9" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">文件夹存放着我们的模型。在这个文件夹中，我们用<code class="du mc md me mf b">SELECT</code>语句编写SQL模型。然后dbt在这个文件夹下查找，并将数据转换到数据仓库中。在本教程中，我们将只使用<code class="du mc md me mf b">models</code>。</p><p id="7a32" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">我们还有另一个非常重要的文件，它保存了dbt的数据库凭证。该文件位于<code class="du mc md me mf b">~/.dbt/profiles.yml</code>中。在这个文件中，我们必须设置我们的数据库凭证，并且我们可以很容易地在生产和开发环境之间进行转换。</p><figure class="ll lm ln lo fd lp er es paragraph-image"><div class="er es nt"><img src="../Images/81c0103c90a41246e9ea6c2f0cb8b3da.png" data-original-src="https://miro.medium.com/v2/resize:fit:814/format:webp/1*ZjLEtwurgaJQ1twMG-EO7A.png"/></div><figcaption class="lv lw et er es lx ly bd b be z dx translated">作者图片</figcaption></figure><p id="7ab2" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">现在，我要为我们的<code class="du mc md me mf b">WarehouseDB</code>更改这个文件。</p><figure class="ll lm ln lo fd lp er es paragraph-image"><div class="er es nu"><img src="../Images/e48f4746d6972874ca50831000affd82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1186/format:webp/1*Ubb3cF2OyXgTOp5qdiApaQ.png"/></div><figcaption class="lv lw et er es lx ly bd b be z dx translated">作者图片</figcaption></figure><p id="fdda" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">dbt自动将转换后的数据加载到我们在该文件中设置的模式中。</p><h2 id="5129" class="mw iy hi bd iz nf ng nh jd ni nj nk jh jy nl nm jj kc nn no jl kg np nq jn nr bi translated">创建我们的第一个dbt模型</h2><p id="7639" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">我将在<code class="du mc md me mf b">models</code>文件夹下创建一个基本的<code class="du mc md me mf b">sql</code> SQL文件:<code class="du mc md me mf b">first_model.sql</code>。我们将创建一个模型来运行下面的纯SQL查询。</p><pre class="ll lm ln lo fd ms mf mt mu aw mv bi"><span id="a644" class="mw iy hi mf b fi mx my l mz na">select <br/>o."STATUS" as "ORDERSTATUS", p."PAYMENTMETHOD", p."STATUS" as "PAYMENTSTATUS", count(o."ID") as "ORDERCOUNT"<br/>from jaffle_shop.orders o <br/>left join stripe.payments p on o."ID" = p."ORDERID" <br/>group by o."STATUS",  p."PAYMENTMETHOD", p."STATUS"</span></pre><p id="3831" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">该查询返回以下结果。</p><figure class="ll lm ln lo fd lp er es paragraph-image"><div class="er es nv"><img src="../Images/fdc4339be79462de304e1f15ae31eacd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1286/format:webp/1*CPRJJ3PV2VmvpEh2i1DPxQ.png"/></div><figcaption class="lv lw et er es lx ly bd b be z dx translated">作者图片</figcaption></figure><p id="3093" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">在dbt模型中，我们使用通过使用<code class="du mc md me mf b">WITH</code>子句创建的临时表。我们在下面看到了对我们的<code class="du mc md me mf b">first_model.sql</code>模型的查询。</p><pre class="ll lm ln lo fd ms mf mt mu aw mv bi"><span id="8b21" class="mw iy hi mf b fi mx my l mz na">with orders as (</span><span id="537d" class="mw iy hi mf b fi nw my l mz na">select * from jaffle_shop."orders"</span><span id="f7f2" class="mw iy hi mf b fi nw my l mz na">),</span><span id="e1cc" class="mw iy hi mf b fi nw my l mz na">payments as (</span><span id="e6a3" class="mw iy hi mf b fi nw my l mz na">select * from stripe."payments"</span><span id="334d" class="mw iy hi mf b fi nw my l mz na">),</span><span id="e9d4" class="mw iy hi mf b fi nw my l mz na">final as (</span><span id="1b59" class="mw iy hi mf b fi nw my l mz na">select</span><span id="e19d" class="mw iy hi mf b fi nw my l mz na">o."STATUS" as "ORDERSTATUS", p."PAYMENTMETHOD", p."STATUS" as "PAYMENTSTATUS", count(o."ID") as "ORDERCOUNT"</span><span id="8345" class="mw iy hi mf b fi nw my l mz na">from orders o</span><span id="e354" class="mw iy hi mf b fi nw my l mz na">left join payments p on o."ID" = p."ORDERID"</span><span id="34a0" class="mw iy hi mf b fi nw my l mz na">group by o."STATUS",  p."PAYMENTMETHOD", p."STATUS"</span><span id="2056" class="mw iy hi mf b fi nw my l mz na">)</span><span id="2322" class="mw iy hi mf b fi nw my l mz na">select * from final</span></pre><p id="f488" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">然后我们运行<code class="du mc md me mf b">dbt run</code>来运行所有的转换模型。</p><figure class="ll lm ln lo fd lp er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es nx"><img src="../Images/f832c7783c4a4e5b82774e032dcc0915.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CfyDEeoztKgQgRxTlYbPYw.png"/></div></div><figcaption class="lv lw et er es lx ly bd b be z dx translated">作者图片</figcaption></figure><p id="ac75" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">dbt将所有模型转换成视图。我们可以在我们的<code class="du mc md me mf b">WarehouseDB</code>数据库中的<code class="du mc md me mf b">first_model</code>视图下看到我们的转换模型。</p><figure class="ll lm ln lo fd lp er es paragraph-image"><div class="er es ny"><img src="../Images/e1273b52211fc6e9e4a6ba0c483379d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1348/format:webp/1*4Au09jBbhN23_tZ2b0QTeg.png"/></div><figcaption class="lv lw et er es lx ly bd b be z dx translated">作者图片</figcaption></figure><h2 id="1abd" class="mw iy hi bd iz nf ng nh jd ni nj nk jh jy nl nm jj kc nn no jl kg np nq jn nr bi translated">更改dbt型号的配置</h2><p id="d969" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">如果我们想将我们的模型加载到一个表中，我们需要在模型文件的顶部使用<code class="du mc md me mf b">config</code>。</p><pre class="ll lm ln lo fd ms mf mt mu aw mv bi"><span id="0304" class="mw iy hi mf b fi mx my l mz na">{{<br/>config(<br/>materialized = "table"<br/>)<br/>}}</span><span id="3706" class="mw iy hi mf b fi nw my l mz na">...</span></pre><p id="9423" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">现在，我在执行了<code class="du mc md me mf b">dbt run</code>之后查看数据库。</p><figure class="ll lm ln lo fd lp er es paragraph-image"><div class="er es nz"><img src="../Images/73ac4afbe6516311fc6b015394a0f93b.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*t2B_P3xqSJeMg6Zlz3eCSw.png"/></div><figcaption class="lv lw et er es lx ly bd b be z dx translated">作者图片</figcaption></figure><p id="9bf2" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">可以查看<a class="ae kq" href="https://docs.getdbt.com/reference/model-configs" rel="noopener ugc nofollow" target="_blank">这里</a>了解dbt车型上的其他配置。</p><h2 id="b09f" class="mw iy hi bd iz nf ng nh jd ni nj nk jh jy nl nm jj kc nn no jl kg np nq jn nr bi translated">参考dbt模型</h2><p id="7a7d" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">我们可以通过使用<code class="du mc md me mf b">{{ref('model')}}</code>在不同的dbt模型中使用dbt模型。我要改进我的模型。</p><figure class="ll lm ln lo fd lp er es paragraph-image"><div class="er es oa"><img src="../Images/950339754b7338445107694817af49f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:416/format:webp/1*LJIQYyvynTcvo5mfC17zvg.png"/></div><figcaption class="lv lw et er es lx ly bd b be z dx translated">作者图片</figcaption></figure><p id="382c" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">在<code class="du mc md me mf b">orders.sql</code>中，我从<code class="du mc md me mf b">orders</code>表中提取一些列来创建我的最终模型。</p><pre class="ll lm ln lo fd ms mf mt mu aw mv bi"><span id="2e5d" class="mw iy hi mf b fi mx my l mz na">select</span><span id="142b" class="mw iy hi mf b fi nw my l mz na">o."ID", o."STATUS" as "ORDERSTATUS"</span><span id="5fc4" class="mw iy hi mf b fi nw my l mz na">from jaffle_shop."orders" o</span></pre><p id="c492" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">在<code class="du mc md me mf b">payments.sql</code>中，我从<code class="du mc md me mf b">payments</code>表中提取所需的列来创建我的最终模型。</p><pre class="ll lm ln lo fd ms mf mt mu aw mv bi"><span id="eb6d" class="mw iy hi mf b fi mx my l mz na">select</span><span id="f83b" class="mw iy hi mf b fi nw my l mz na">p."PAYMENTMETHOD", p."STATUS" as "PAYMENTSTATUS", p."ORDERID"</span><span id="388b" class="mw iy hi mf b fi nw my l mz na">from stripe."payments" p</span></pre><p id="a9f8" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">然后，我创建了<code class="du mc md me mf b">final_model.sql</code>。在这个文件中，我使用了上面创建的模型。</p><pre class="ll lm ln lo fd ms mf mt mu aw mv bi"><span id="0cd7" class="mw iy hi mf b fi mx my l mz na">with orders as (</span><span id="edc7" class="mw iy hi mf b fi nw my l mz na">select * from {{ref('orders')}}</span><span id="a852" class="mw iy hi mf b fi nw my l mz na">),</span><span id="2675" class="mw iy hi mf b fi nw my l mz na">payments as (</span><span id="371c" class="mw iy hi mf b fi nw my l mz na">select * from {{ref('payments')}}</span><span id="28b1" class="mw iy hi mf b fi nw my l mz na">),<br/></span><span id="a80c" class="mw iy hi mf b fi nw my l mz na">final as (</span><span id="6982" class="mw iy hi mf b fi nw my l mz na">select</span><span id="fbf2" class="mw iy hi mf b fi nw my l mz na">o."ORDERSTATUS", p."PAYMENTMETHOD", p."PAYMENTSTATUS", count(o."ID") as "ORDERCOUNT"</span><span id="d566" class="mw iy hi mf b fi nw my l mz na">from orders o</span><span id="14e5" class="mw iy hi mf b fi nw my l mz na">left join payments p on o."ID" = p."ORDERID"</span><span id="36d6" class="mw iy hi mf b fi nw my l mz na">group by o."ORDERSTATUS",  p."PAYMENTMETHOD", p."PAYMENTSTATUS"</span><span id="9604" class="mw iy hi mf b fi nw my l mz na">)</span><span id="650a" class="mw iy hi mf b fi nw my l mz na">select * from final</span></pre><p id="fc75" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">我们看到数据通过使用我们创建并加载到仓库中的模型进行了转换。</p><figure class="ll lm ln lo fd lp er es paragraph-image"><div class="er es ob"><img src="../Images/6449cbb917f9c50f7f46265bcace227a.png" data-original-src="https://miro.medium.com/v2/resize:fit:664/format:webp/1*xx8MmWJ2RfL27JLMgspQgw.png"/></div><figcaption class="lv lw et er es lx ly bd b be z dx translated">作者图片</figcaption></figure><h1 id="e9c0" class="ix iy hi bd iz ja jb jc jd je jf jg jh io ji ip jj ir jk is jl iu jm iv jn jo bi translated">最后</h1><p id="e82f" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">希望你喜欢。我很喜欢写作。学习新事物对我来说是如此的愉快。尤其是，如果我可以用它们来赚钱🙃我对dbt很陌生。我会继续学习dbt。我还将扩展我创建的回购，以遵循官方的<a class="ae kq" href="https://courses.getdbt.com/collections" rel="noopener ugc nofollow" target="_blank"> dbt培训计划</a>。您可以使用下面的链接访问回购。</p><div class="kr ks ez fb kt ku"><a href="https://github.com/mebaysan/DBT-Training" rel="noopener  ugc nofollow" target="_blank"><div class="kv ab dw"><div class="kw ab kx cl cj ky"><h2 class="bd hj fi z dy kz ea eb la ed ef hh bi translated">GitHub - mebaysan/DBT-Training:我创建了这个repo来遵循DBT的官方培训路径</h2><div class="lb l"><h3 class="bd b fi z dy kz ea eb la ed ef dx translated">我创建了这个回购遵循DBT dbt基础1-dbt-基础文件夹的官方培训路径是为…</h3></div><div class="lc l"><p class="bd b fp z dy kz ea eb la ed ef dx translated">github.com</p></div></div><div class="ld l"><div class="le l lf lg lh ld li lj ku"/></div></div></a></div><p id="bca1" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">问候</p></div></div>    
</body>
</html>