<html>
<head>
<title>Writing a simple “busy” spinner Directive in Angular-Material</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Angular-Material编写一个简单的“忙碌”微调指令</h1>
<blockquote>原文：<a href="https://medium.com/codex/writing-a-simple-busy-spinner-directive-in-angular-material-5b1462b525f8?source=collection_archive---------3-----------------------#2021-08-16">https://medium.com/codex/writing-a-simple-busy-spinner-directive-in-angular-material-5b1462b525f8?source=collection_archive---------3-----------------------#2021-08-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/87ccc284e046afbb31aa0a960cb90f8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:500/format:webp/1*nbJ41jD1-r2Oe6FsLjKaOg.png"/></div></figure><p id="e95e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">作为异步服务调用领域的前端开发人员，向用户提供反馈是非常重要的。然而，通过大量的<code class="du jk jl jm jn b">*ngIf</code>和基于某种布尔标志的切换来逐个案例地做这件事是很痛苦的。让我们写一个<a class="ae jo" href="https://angular.io/guide/structural-directives" rel="noopener ugc nofollow" target="_blank">结构指令</a>来用尽可能少的工作为我们处理这个问题。</p><p id="2ea1" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们将要写的结构指令将接受一个布尔表达式，并交换它所附加的元素的内容。当表达式为真时，它将换入一个<code class="du jk jl jm jn b">MatProgressSpinner</code>组件，当表达式为假时，我们将显示用户在组件中编码的内容。</p><p id="2772" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这里有一个演示:</p><div class="jp jq ez fb jr js"><a href="https://stackblitz.com/edit/app-spin-on?file=src/app/app.component.ts" rel="noopener  ugc nofollow" target="_blank"><div class="jt ab dw"><div class="ju ab jv cl cj jw"><h2 class="bd hj fi z dy jx ea eb jy ed ef hh bi translated">*appSpinOn - StackBlitz</h2><div class="jz l"><h3 class="bd b fi z dy jx ea eb jy ed ef dx translated">*appSpinOn指令的示例。</h3></div><div class="ka l"><p class="bd b fp z dy jx ea eb jy ed ef dx translated">stackblitz.com</p></div></div><div class="kb l"><div class="kc l kd ke kf kb kg ik js"/></div></div></a></div></div><div class="ab cl kh ki gp kj" role="separator"><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km"/></div><div class="hb hc hd he hf"><h1 id="6d2d" class="ko kp hi bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">保持干燥</h1><p id="2959" class="pw-post-body-paragraph im in hi io b ip lm ir is it ln iv iw ix lo iz ja jb lp jd je jf lq jh ji jj hb bi translated">这一点的重要性不仅仅在于找到一种为用户提供可视反馈的方法，还在于以一种一致的方式做到这一点，这种方式符合DRY原则，我们不会到处使用复制/粘贴来重复代码。</p><blockquote class="lr"><p id="3372" class="ls lt hi bd lu lv lw lx ly lz ma jj dx translated">干:不要重复自己</p></blockquote><p id="3325" class="pw-post-body-paragraph im in hi io b ip mb ir is it mc iv iw ix md iz ja jb me jd je jf mf jh ji jj hb bi translated">一种不遵循DRY实现等效的方法很简单:</p><pre class="mg mh mi mj fd mk jn ml mm aw mn bi"><span id="00c2" class="mo kp hi jn b fi mp mq l mr ms">&lt;div *ngIf="isLoading"&gt;&lt;mat-spinner [diameter]="18"&gt;&lt;/mat-spinner&gt;&lt;/div&gt;<br/>&lt;div *ngIf="!isLoading"&gt;<br/>  &lt;entity-details&gt;&lt;/entity-details&gt;<br/>&lt;/div&gt;</span></pre><p id="491f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">然而，为了重用它，你必须复制/粘贴旋转器代码。即使把它简化成它自己的组件，我们也只会稍微减少对两个对立的<code class="du jk jl jm jn b">*ngIf</code>语句的复制/粘贴。然而，如果我们在一个结构化的指令中这样做，我们可以使用编写一个单独的<code class="du jk jl jm jn b">*ngIf</code>语句来实现相同的目标。</p></div><div class="ab cl kh ki gp kj" role="separator"><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km"/></div><div class="hb hc hd he hf"><h1 id="e4a8" class="ko kp hi bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">那么，它是如何工作的？</h1><p id="cbff" class="pw-post-body-paragraph im in hi io b ip lm ir is it ln iv iw ix lo iz ja jb lp jd je jf lq jh ji jj hb bi translated">您可以从上面的<code class="du jk jl jm jn b">spin-on-directive.ts</code>中的StackBlitz获得完整的源代码，在<code class="du jk jl jm jn b">styles.scss</code>中有一个小的样式花絮，但是指令代码的重要部分看起来像这样:</p><pre class="mg mh mi mj fd mk jn ml mm aw mn bi"><span id="fb4c" class="mo kp hi jn b fi mp mq l mr ms">@Input() set appSpinOn(condition: boolean) {<br/>    if (!!condition !== this.#isSpinning) {<br/>      this.#spinner = null;<br/>      this.viewContainer.clear();<br/>      this.#isSpinning = condition;<br/>      if (!condition) {<br/>        // Render the template<br/>        this.viewContainer.createEmbeddedView(this.templateRef);<br/>      } else if (condition) {<br/>        this.addSpinner();<br/>      }<br/>    }<br/>  }</span><span id="db85" class="mo kp hi jn b fi mt mq l mr ms">private addSpinner() {<br/>    const componentFactory = this.componentFactoryResolver.resolveComponentFactory(MatProgressSpinner);<br/>    const { instance } = this.viewContainer.createComponent&lt;MatProgressSpinner&gt;(componentFactory);<br/>    instance.diameter = this.#diameter;<br/>    instance.color = this.#color;<br/>    instance.mode = 'indeterminate';<br/>    instance._elementRef.nativeElement.classList.add('spin-on-instance');<br/>    this.#spinner = instance;<br/>  }<br/>}</span></pre><p id="d942" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><code class="du jk jl jm jn b">appSpinOn</code>输入值的设置器将表达式计算为布尔值。如果表达式之前已经计算了相同的结果，它不会做任何事情，所以它只保留dom中的内容。如果它还没有求值，或者值不同，它将决定条件是真还是假。这里我们使用<code class="du jk jl jm jn b">this.viewContainer.createEmbeddedView(this.templateRef);</code>来写如果条件是<code class="du jk jl jm jn b">false</code>的话，指令附加到的templateRef。</p><p id="e58d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">然而，如果条件是<code class="du jk jl jm jn b">true</code>的话，事情就变得有点复杂了。我们使用<a class="ae jo" href="https://angular.io/guide/dynamic-component-loader" rel="noopener ugc nofollow" target="_blank">动态组件创建</a>来创建<code class="du jk jl jm jn b">ViewContainerRef</code>中的<code class="du jk jl jm jn b">MatProgressSpinner</code>，Angular将它注入到指令中，然后配置它进行样式化，然后</p><p id="9079" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们还需要添加一些样式，否则我们将无法使用它来替代图标之类的东西。我在root styles.scss文件中放置了以下内容，它允许适当的对齐和边距来代替图标:</p><pre class="mg mh mi mj fd mk jn ml mm aw mn bi"><span id="81d3" class="mo kp hi jn b fi mp mq l mr ms">.mat-progress-spinner.spin-on-instance {<br/>  vertical-align: middle;<br/>  display: inline-block;<br/>  margin: 3px;<br/>}</span></pre><p id="0f52" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">从那以后，使用它就像添加任何使用它的模块的导入并在代码中使用它一样简单。</p><p id="5bfb" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">使用它的一种方法是细分内容。例如:</p><pre class="mg mh mi mj fd mk jn ml mm aw mn bi"><span id="b64a" class="mo kp hi jn b fi mp mq l mr ms">&lt;div&gt;<br/>  &lt;entity-details <strong class="jn hj">*appSpinOn="isLoading"</strong>&gt;&lt;/entity-details&gt;<br/>&lt;/div&gt;</span></pre><p id="8495" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">缺省值对于替换图标很有用。例如，该演示在“保存”按钮上使用了以下内容:</p><pre class="mg mh mi mj fd mk jn ml mm aw mn bi"><span id="b163" class="mo kp hi jn b fi mp mq l mr ms">&lt;button mat-raised-button [disabled]="isSaving || isLoading" (click)="save()"&gt;<br/>  &lt;mat-icon <strong class="jn hj">*appSpinOn="isSaving"</strong>&gt;save&lt;/mat-icon&gt;  Save<br/>&lt;/button&gt;</span></pre><figure class="mg mh mi mj fd ij er es paragraph-image"><div class="er es mu"><img src="../Images/9db9e4250643c6ed631e59ba6783db0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:212/format:webp/1*9aStn3Rd-TzrNcm6GIoc9A.png"/></div></figure><figure class="mg mh mi mj fd ij er es paragraph-image"><div class="er es mv"><img src="../Images/e083fc8bcbc747abd3acf6bba29c274b.png" data-original-src="https://miro.medium.com/v2/resize:fit:202/1*-6Y6TcQSy6a53mi0tWY8JA.gif"/></div></figure><p id="06b2" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">保存之前，图像有一个“保存”图标。该指令仅用微调器替换图标。</p><p id="3baf" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们还可以使用变量<code class="du jk jl jm jn b">color</code>来改变指令使用的大小:<code class="du jk jl jm jn b">*appSpinOn="isLoading; <strong class="io hj">color: 'primary': diameter: 40</strong>"</code>，该变量接受一个角度材质<code class="du jk jl jm jn b">ThemePalette</code>字符串和一个数字<code class="du jk jl jm jn b">diameter</code>。</p></div><div class="ab cl kh ki gp kj" role="separator"><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km"/></div><div class="hb hc hd he hf"><p id="d54a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们在这里所做的是一个有用的指示，当一些事情在幕后发生时，它给用户反馈。它减少了我们必须编写的代码量，而且灵活、可配置。</p></div></div>    
</body>
</html>