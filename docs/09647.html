<html>
<head>
<title>Set up a PostgreSQL database and connect to NestJS with TypeORM</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">设置一个PostgreSQL数据库并用TypeORM连接到NestJS</h1>
<blockquote>原文：<a href="https://medium.com/codex/set-up-a-postgresql-database-and-connect-to-nestjs-with-typeorm-4a2a2f67339b?source=collection_archive---------1-----------------------#2022-10-31">https://medium.com/codex/set-up-a-postgresql-database-and-connect-to-nestjs-with-typeorm-4a2a2f67339b?source=collection_archive---------1-----------------------#2022-10-31</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/273aaff3ba05947593bbcbbc76a74ff1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*uDIR7xkoQ71a-Vuh.png"/></div></div></figure><h1 id="f138" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">介绍</h1><p id="35ce" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">学习后端开发最重要的是如何存储数据。在本文中，我们将研究如何使用<strong class="jq hj"> PostgreSQL </strong>创建一个数据库，并将其连接到<strong class="jq hj"> NestJS </strong>。为了更容易地管理数据库，我们将使用一个名为<strong class="jq hj"> TypeORM的<strong class="jq hj">对象关系映射</strong> (ORM)工具。</strong></p><h1 id="f619" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">创建数据库</h1><p id="ca56" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">PostgreSQL ，通常简称为“Postgres”，是一个对象关系数据库管理系统。为了快速创建PostgreSQL数据库，我们将使用<strong class="jq hj"> Docker </strong>(确保您安装了Docker)</p><p id="20e9" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">首先，我们用这些配置创建了<code class="du kr ks kt ku b">docker-compose.yml</code>文件</p><figure class="kw kx ky kz fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kv"><img src="../Images/6d42e08f072773b5d3ac928e2e3bba18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DyMa7809rLKJXnl-KNlHPg.png"/></div></div></figure><p id="f541" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">然后我们创建<code class="du kr ks kt ku b">docker.env</code>文件来存储环境变量:</p><figure class="kw kx ky kz fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kv"><img src="../Images/75557062f896b9e1ce5384f57f79190e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8t9zfANSVV02KQMWA5dAog.png"/></div></div></figure><p id="8c1d" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">好了，现在我们有了Docker和PostgreSQL，接下来我们要做的是用NestJS连接数据库</p><h1 id="82e1" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">连接数据库</h1><p id="8286" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">在将NestJS应用程序与数据库连接之前，我们需要安装一些依赖项:</p><ul class=""><li id="b27f" class="la lb hi jq b jr km jv kn jz lc kd ld kh le kl lf lg lh li bi translated"><code class="du kr ks kt ku b">@nestjs/typeorm typeorm</code>:关于TypeORM的2个库</li><li id="9f64" class="la lb hi jq b jr lj jv lk jz ll kd lm kh ln kl lf lg lh li bi translated"><code class="du kr ks kt ku b">pg</code> : PostgreSQL客户端</li><li id="3168" class="la lb hi jq b jr lj jv lk jz ll kd lm kh ln kl lf lg lh li bi translated"><code class="du kr ks kt ku b">@hapi/joi @types/hapi__joi</code>:模式验证</li></ul><p id="50bd" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">然后，我们需要创建包含更多数据库变量的<code class="du kr ks kt ku b">.env</code>文件和<code class="du kr ks kt ku b">database.module.ts</code>来获取所有的env和config类型表单:</p><figure class="kw kx ky kz fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kv"><img src="../Images/4ce84436e94b0383611a97f449b46d49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qCCLU3w4A1_TDEeFWEA6rg.png"/></div></div></figure><figure class="kw kx ky kz fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lo"><img src="../Images/ddb77fed4fc9c770dc31e8ba2d3ea4ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vSFonFcpscxgcLs2R2EKug.png"/></div></div></figure><figure class="kw kx ky kz fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lo"><img src="../Images/02f65494f0b1379f101a8a323bcd1540.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jv2Q2mdULxtaPr_8NVkrPQ.png"/></div></div></figure><p id="f46f" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">在<code class="du kr ks kt ku b">MessageModule</code>旁边，你可以看到我用Joi和数据库的模块配置了模式验证，并将它们全部导入到我们的根模块(app)</p><h1 id="4081" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">实体</h1><p id="0711" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">如果你了解数据库，你可能会了解表，在TypeORM中，关于它最重要的概念是<strong class="jq hj">实体</strong>，它映射到数据库表:</p><figure class="kw kx ky kz fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lp"><img src="../Images/ca633bac3db1e732ee0e3ae4a873231a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tLHepD9zBpV49mJf7pdZ3g.png"/></div></div></figure><p id="0aa6" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">我创建了一个名为<code class="du kr ks kt ku b">Message</code>的简单实体，你可以把它想象成一个<code class="du kr ks kt ku b">message</code>表，ID是它的主键，另一列是<code class="du kr ks kt ku b">content</code></p><h1 id="3ed4" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">让我们写一些API</h1><p id="65d8" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">设置完毕后，我们将NestJS与数据库连接起来并创建一个表。接下来我们要做的是创建控制器和服务</p><figure class="kw kx ky kz fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lq"><img src="../Images/2c0a21d5b39edac02cdbaaceeed2aee1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XcISMuKgeltdkd1sHxlxvg.png"/></div></div></figure><figure class="kw kx ky kz fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lq"><img src="../Images/a0513e90e96d37178cbb0fe14cfe5b28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-AXS0fVQkIi-U4ARroYIdA.png"/></div></div></figure><figure class="kw kx ky kz fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lr"><img src="../Images/d5087dcbf84742260b44294b97e4c14c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UhR51tY0BWzp-5Ac-RDCQA.png"/></div></div></figure><p id="d523" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">使用TypeORM的存储库，我用简单的方法创建了一些RESTful APIs:</p><ul class=""><li id="00c7" class="la lb hi jq b jr km jv kn jz lc kd ld kh le kl lf lg lh li bi translated"><strong class="jq hj"> getAllMessages </strong>:我使用了<code class="du kr ks kt ku b">find</code>方法，你可以传递很多选项给它，如果没有，它会得到表中的所有记录</li><li id="0958" class="la lb hi jq b jr lj jv lk jz ll kd lm kh ln kl lf lg lh li bi translated"><strong class="jq hj"> getMessageById </strong>:我们可以使用上面的<code class="du kr ks kt ku b">find</code>方法，但是我建议使用<code class="du kr ks kt ku b">findOne</code>方法，它只返回符合我们标准的第一条记录</li><li id="e9de" class="la lb hi jq b jr lj jv lk jz ll kd lm kh ln kl lf lg lh li bi translated"><strong class="jq hj"> createMessage: </strong>一个简单的创建新消息的方法</li></ul><h1 id="0459" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">测试</h1><p id="123b" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">首先，我们需要用<code class="du kr ks kt ku b">docker-compose up</code>启动Docker</p><p id="5341" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">然后，我们用<code class="du kr ks kt ku b">yarn start:dev</code>启动我们的NestJS服务器</p><figure class="kw kx ky kz fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ls"><img src="../Images/5eed7355c585a3ec59afee51905b4a00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YGJQ_3qRJcsfwGJ-VYrNrg.png"/></div></div></figure><p id="a335" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">我用邮递员来创建新的信息，它工作得很好</p><h1 id="f60c" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">结论</h1><p id="c594" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">在本文中，我们介绍了将NestJS应用程序与PostgreSQL数据库连接起来的基础知识，并使用TypeORM轻松管理查询。</p><p id="ea9c" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">如果文章不清楚，你可以在这里找到<a class="ae lt" href="https://github.com/leduc1901/nestjs-websocket" rel="noopener ugc nofollow" target="_blank">的源代码</a></p><h1 id="4cae" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">遗言</h1><p id="9417" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">虽然我的内容对每个人都是免费的，但是如果你觉得这篇文章有帮助，<a class="ae lt" href="https://www.buymeacoffee.com/kylele19" rel="noopener ugc nofollow" target="_blank">你可以在这里给我买杯咖啡</a></p></div></div>    
</body>
</html>