# 如何将 varbinary 记录字段从 MS SQL Server 导出到文件

> 原文：<https://medium.com/codex/how-to-export-varbinary-record-fields-from-ms-sql-server-to-file-ed1e6414b810?source=collection_archive---------6----------------------->

示例 SQL 脚本和注意事项。

下面嵌入的 T-SQL，由 yours truly 编写，[通过 GitHub](https://gist.github.com/aev-mambro2/ca8fb742b3544c1cef33bfbb8f70fbb3) 分享:

我们使用的应用程序中没有一个是由第三方构建的。我们可以访问数据存储，但不应该改变它的结构或过程。它的众多功能之一是存储文档和一些元数据。我们需要导出这些文档，以便在其他地方查看。上面的 T-SQL 过程允许。它可以在数据库版本 12 (2014)的 Microsoft SQL Server 上运行。

> 主要问题是写入映射驱动器。

procedure runner 是 SQL Server 计算机上的本地服务帐户或网络服务帐户，这意味着它确实会看到与您登录的帐户相同的映射驱动器。因此，将文档导出到的驱动器必须连接到计算机。

> 它们必须显示在计算机的磁盘管理中(在计算机管理面板内)。

否则，您必须想办法提前为过程运行器映射驱动器。

# 其他问题:

*   因为我们调用的是 OLE 对象，所以很难看到处理过程和错误。这导致了偏执的错误处理，并在退出之前对可能发生的错误数量进行了限制。没有上限，我们就耗尽了内存，并迫使 SQL Management Studio 暂停并重新启动。
*   检索错误信息时应该小心，将它捕获到变量中，然后显示出来。相反，如果我们让错误检索立即写入控制台/屏幕，我们就会耗尽内存。
*   尽管有 print 语句，但在过程执行完毕之前，打印不会发生。这导致服务器上的内存使用增加，但也延迟了对可能发生的任何错误的可见性。在错误计数达到阈值时停止循环增加了可见性，但是最好是立即输出不会导致内存问题的结果。

让软件变得更好！

# 关于作者

Veltstra 作为软件架构师和开发人员已经专业工作了 20 多年。Veltstra 在大学里学习了 ETL 和 SQL，对优化运行持续时间、错误可见性、可测试性和各种数据存储中的数据锁定问题产生了浓厚的兴趣，包括 SQLServer 和 Oracle 数据库。总会有办法的——有时这种办法很难。