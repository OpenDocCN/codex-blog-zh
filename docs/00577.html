<html>
<head>
<title>PostgreSQL and Their Dumps in Windows 10</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Windows 10中的PostgreSQL及其转储</h1>
<blockquote>原文：<a href="https://medium.com/codex/postgresql-and-their-dumps-in-windows-10-fdff4c960ea3?source=collection_archive---------2-----------------------#2021-02-28">https://medium.com/codex/postgresql-and-their-dumps-in-windows-10-fdff4c960ea3?source=collection_archive---------2-----------------------#2021-02-28</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><h2 id="57ef" class="hg hh hi bd b fp hj hk hl hm hn ho dx hp translated" aria-label="kicker paragraph"><a class="ae ge" href="http://medium.com/codex" rel="noopener">法典</a></h2><div class=""/><figure class="ev ex ip iq ir is er es paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="er es io"><img src="../Images/d5078e4678c8e003a3c0b1fc3edc86ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Mb7pbq61-TMHsZqHhETxbg.jpeg"/></div></div><figcaption class="iz ja et er es jb jc bd b be z dx translated">和平的</figcaption></figure><p id="adef" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">大约一周前，我决定用SQL做更多的事情，而不是我在工作中使用的。我在Packt出版社看到了一本名为<em class="kb">的应用SQL数据分析研讨会</em>的书，于是我决定购买。它似乎拥有我在教程中想要的一切。</p><p id="c0f0" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">在工作中，我们使用微软的SQL Server和SQL Server Management Studio，在我看来这并没有什么不妥。然而，这本书利用了PostgreSQL和pgAdmin4，所以在开始时有一点学习曲线。</p><p id="1b0e" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><strong class="jf hs">接受挑战！</strong></p><p id="e1c0" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">原来PostgreSQL和我习惯的没那么大区别。随着我对这本书的深入研究，很明显我需要创建这本书用来教授课程的数据库。我发现，我需要从转储文件中恢复数据库。<strong class="jf hs">嗯？！</strong></p><h1 id="3790" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">什么是转储文件</h1><p id="830c" class="pw-post-body-paragraph jd je hi jf b jg la ji jj jk lb jm jn jo lc jq jr js ld ju jv jw le jy jz ka hb bi translated">实际上，我从未查询过转储文件的定义是什么。我一直认为它是一个以文本形式保存大量信息的文件。今天我查了一下什么是转储文件。事实证明我并没有差那么远。</p><p id="597a" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">它们被称为转储文件，因为程序实际上是将原始数据转储到一个几乎没有任何格式的文件中。还有其他形式的转储文件，但是我将处理文本转储文件</p><h1 id="f602" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">分两步在PostgreSQL中创建转储文件</h1><p id="3315" class="pw-post-body-paragraph jd je hi jf b jg la ji jj jk lb jm jn jo lc jq jr js ld ju jv jw le jy jz ka hb bi translated">为了创建这个转储文件，我假设您已经有了一个PostgreSQL数据库。我将使用我在本教程中创建的那个。它名为sqlda2，包含以下表格。你可以把这个数据库想象成一个只卖电动滑板车和电动汽车的车辆经销店。现在是一个很好的时机来提一下，这都是编造的数据。这些表和其中包含的所有数据将被转储到一个文本文件中。</p><figure class="lg lh li lj fd is er es paragraph-image"><div class="er es lf"><img src="../Images/7e969d8940be67040ab57a4733b15e61.png" data-original-src="https://miro.medium.com/v2/resize:fit:506/format:webp/1*Y3R-1uMAdx28jl87bdb_7Q.png"/></div><figcaption class="iz ja et er es jb jc bd b be z dx translated">数据库表树</figcaption></figure><p id="ebe6" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">现在来创建一个转储文件。以下是方法:</p><p id="26a3" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">第一步:</p><p id="a467" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">打开命令提示符并导航到您正在使用的PostgreSQL版本的bin文件夹。我使用的是版本13，所以这是我的样子:</p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="67f7" class="lp kd hi ll b fi lq lr l ls lt">C:\Users\username&gt;cd C:\Program Files\PostgreSQL\13\bin<br/>C:\Program Files\PostgreSQL\13\bin&gt;</span></pre><p id="01a4" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">第二步:</p><p id="b08e" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">运行以下命令，将<em class="kb">用户名</em>替换为您的用户名，将<em class="kb">数据库名</em>替换为您想要转储的数据库，将<em class="kb">备份文件名和路径</em>替换为您想要的位置和名称。</p><p id="26b1" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><em class="kb">pg _ dump . exe-U USERNAME-d DBNAME-f BACKUP _ FILE _ NAME _ AND _ PATH</em></p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="a3d2" class="lp kd hi ll b fi lq lr l ls lt">C:\Program Files\PostgreSQL\13\bin&gt;pg_dump.exe -U postgres -d sqlda2 -f c:\users\username\desktop\test.dump<br/>Password:</span></pre><p id="75de" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">按下enter键后，系统会提示您输入密码。输入密码并按回车键。恭喜您，您刚刚创建了一个转储文件并备份了您的数据库！</p><h1 id="8e58" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">通过4个步骤从转储文件恢复PostgreSQL数据库</h1><p id="eed7" class="pw-post-body-paragraph jd je hi jf b jg la ji jj jk lb jm jn jo lc jq jr js ld ju jv jw le jy jz ka hb bi translated">因此，您的数据库发生了一些问题，您需要恢复它。不久前，您为它创建了一个备份转储文件，这真是一个奇迹。遵循这三个步骤，您将很快恢复正常运行。</p><p id="c51c" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">第一步:</p><p id="605a" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">打开pgAdmin4，单击servers下拉列表，然后单击PostgreSQL <version>下拉列表，并右键单击databases。将鼠标悬停在创建上，然后单击数据库。</version></p><figure class="lg lh li lj fd is er es paragraph-image"><div class="er es lu"><img src="../Images/70ac24b15dd21427ea1e88942cdd3e97.png" data-original-src="https://miro.medium.com/v2/resize:fit:950/format:webp/1*v-w8OAEySqSzO0s-jIFq5A.png"/></div><figcaption class="iz ja et er es jb jc bd b be z dx translated">在PostgreSQL中创建数据库</figcaption></figure><p id="f5c7" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">第二步:</p><p id="f30b" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">为数据库命名并确保所有者正确，然后单击save。</p><figure class="lg lh li lj fd is er es paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="er es lv"><img src="../Images/df27e40354f524c88a77dde83079bcf0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hX3ziORVp3mMPlJsF1V-cg.png"/></div></div><figcaption class="iz ja et er es jb jc bd b be z dx translated">命名数据库</figcaption></figure><p id="2b45" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">第三步:</p><p id="b541" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">打开命令提示符并导航到您正在使用的PostgreSQL版本的bin文件夹。我用的是第13版，所以这是我的样子。</p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="75bb" class="lp kd hi ll b fi lq lr l ls lt">C:\Users\username&gt;cd C:\Program Files\PostgreSQL\13\bin <br/>C:\Program Files\PostgreSQL\13\bin&gt;</span></pre><p id="c313" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">第四步:</p><p id="c850" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">运行以下命令，将<em class="kb">用户名</em>替换为您的用户名，将<em class="kb">数据库名</em>替换为您要恢复的数据库，将<em class="kb">备份文件名和路径</em>替换为它存储的位置和名称。</p><p id="c58a" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><em class="kb">psql.exe-U用户名-d数据库名-f备份_文件名和_路径</em></p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="0f49" class="lp kd hi ll b fi lq lr l ls lt">C:\Program Files\PostgreSQL\13\bin&gt;psql.exe -U postgres -d test -f c:\users\username\desktop\test.dump<br/>Password:</span></pre><p id="6d19" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">按下enter键后，系统会提示您输入密码。输入密码并按回车键。当它运行时，您将得到与此类似的内容。</p><figure class="lg lh li lj fd is er es paragraph-image"><div class="er es lw"><img src="../Images/e46421cecaeea6c6af4baef0e25f5016.png" data-original-src="https://miro.medium.com/v2/resize:fit:686/format:webp/1*Ue3are01HAuqoYzWboyjMw.png"/></div></figure><h1 id="5c31" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">验证数据库的恢复</h1><p id="6d45" class="pw-post-body-paragraph jd je hi jf b jg la ji jj jk lb jm jn jo lc jq jr js ld ju jv jw le jy jz ka hb bi translated">现在恢复已经运行，您应该能够打开pgAdmin 4并找到您恢复的数据库。我能够验证恢复是否成功。</p><figure class="lg lh li lj fd is er es paragraph-image"><div class="er es lx"><img src="../Images/cdc9b6b4c7dc1946c99baf7175c8c9a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:646/format:webp/1*mQ5OORA34lSzgZN1EIxI6w.png"/></div></figure><p id="0531" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">您可以运行一些快速的SQL代码来查看它确实成功了。</p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="4639" class="lp kd hi ll b fi lq lr l ls lt">select *<br/>from customers <br/>where title is not null<br/>    and phone is not null<br/>order by last_name<br/>limit 10;</span><span id="e4fb" class="lp kd hi ll b fi ly lr l ls lt">select c.customer_id  <br/>    , c.first_name  <br/>    , c.last_name  <br/>    , p.product_id  <br/>    , p.model  <br/>    , p.year  <br/>    , p.product_type  <br/>    , s.sales_amount  <br/>    , s.sales_transaction_date <br/>from sales s <br/>left outer join customers c on s.customer_id = c.customer_id <br/>left outer join products p on s.product_id = p.product_id <br/>order by s.sales_transaction_date desc;</span><span id="ca38" class="lp kd hi ll b fi ly lr l ls lt">select c.customer_id<br/>	, c.first_name<br/>	, c.last_name<br/>	, p.product_id<br/>	, p.model<br/>	, p.year<br/>	, p.product_type<br/>	, s.sales_amount<br/>	, s.sales_transaction_date<br/>from sales s<br/>left outer join customers c on s.customer_id = c.customer_id<br/>left outer join products p on s.product_id = p.product_id<br/>order by s.sales_transaction_date desc</span></pre><p id="1d2d" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">感谢您的阅读，我希望你喜欢！</p></div></div>    
</body>
</html>