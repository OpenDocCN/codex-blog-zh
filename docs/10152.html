<html>
<head>
<title>Build a Stock Analysis tool in under 100 lines of code.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用不到100行代码构建一个股票分析工具。</h1>
<blockquote>原文：<a href="https://medium.com/codex/build-a-stock-analysis-tool-in-under-100-lines-of-code-1f5dc6e1473a?source=collection_archive---------2-----------------------#2022-12-08">https://medium.com/codex/build-a-stock-analysis-tool-in-under-100-lines-of-code-1f5dc6e1473a?source=collection_archive---------2-----------------------#2022-12-08</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="7c93" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">使用Streamlit——Python的开源应用框架。</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/3b7928292d5e7f0ae227e8bbe55d2db3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t_ms7p3Ut5v4zxbOTKazjw.png"/></div></div></figure><p id="52ef" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">由于目前可用的web框架数不胜数，构建数据驱动的web应用程序一直令我望而生畏。因为<strong class="jl hj"> Python </strong>因其简单而成为我大多数任务的首选编程语言，我决定用它来构建一个股票分析工具，以抑制我对网络开发的恐惧。</p><p id="75f3" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated"><strong class="jl hj"> Streamlit </strong>是Python中的一个开源应用框架，可以在几分钟内将数据脚本转化为可共享的web应用。这个框架允许您主要用Python构建web应用程序。如果你像我一样，不想在前端的设计和原型开发上花费时间，streamlit是适合你的框架。</p><p id="f609" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">这个工具使用<strong class="jl hj"> Yahoo Finance API </strong>来获取股票数据。这是我第一次用<strong class="jl hj"> Streamlit </strong>做实验，我找不到任何有趣的免费API。</p><h1 id="f806" class="kf kg hi bd kh ki kj kk kl km kn ko kp io kq ip kr ir ks is kt iu ku iv kv kw bi translated">该应用程序的功能</h1><ol class=""><li id="25a9" class="kx ky hi jl b jm kz jp la js lb jw lc ka ld ke le lf lg lh bi translated">使用股票代码搜索股票。</li><li id="f827" class="kx ky hi jl b jm li jp lj js lk jw ll ka lm ke le lf lg lh bi translated">显示库存详情和绩效指标。</li><li id="4b4b" class="kx ky hi jl b jm li jp lj js lk jw ll ka lm ke le lf lg lh bi translated">查看股票的历史表现(图表)。</li><li id="7756" class="kx ky hi jl b jm li jp lj js lk jw ll ka lm ke le lf lg lh bi translated">下载PDF格式的股票详情。</li></ol></div><div class="ab cl ln lo gp lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="hb hc hd he hf"><h1 id="545b" class="kf kg hi bd kh ki lu kk kl km lv ko kp io lw ip kr ir lx is kt iu ly iv kv kw bi translated">内容</h1><ol class=""><li id="befa" class="kx ky hi jl b jm kz jp la js lb jw lc ka ld ke le lf lg lh bi translated">装置</li><li id="0d38" class="kx ky hi jl b jm li jp lj js lk jw ll ka lm ke le lf lg lh bi translated">项目结构</li><li id="d24c" class="kx ky hi jl b jm li jp lj js lk jw ll ka lm ke le lf lg lh bi translated">发展</li><li id="a743" class="kx ky hi jl b jm li jp lj js lk jw ll ka lm ke le lf lg lh bi translated">部署</li></ol><h2 id="998d" class="lz kg hi bd kh ma mb mc kl md me mf kp js mg mh kr jw mi mj kt ka mk ml kv mm bi translated">装置</h2><p id="3cad" class="pw-post-body-paragraph jj jk hi jl b jm kz ij jo jp la im jr js mn ju jv jw mo jy jz ka mp kc kd ke hb bi translated">打开命令提示符或终端，键入<code class="du mq mr ms mt b">pip install streamlit</code>安装库。要测试是否成功安装了streamlit，请键入命令<code class="du mq mr ms mt b">streamlit hello</code>。</p><h2 id="5f37" class="lz kg hi bd kh ma mb mc kl md me mf kp js mg mh kr jw mi mj kt ka mk ml kv mm bi translated">项目结构</h2><ol class=""><li id="63fc" class="kx ky hi jl b jm kz jp la js lb jw lc ka ld ke le lf lg lh bi translated">web.py(主应用程序)</li><li id="1046" class="kx ky hi jl b jm li jp lj js lk jw ll ka lm ke le lf lg lh bi translated">requirements.txt</li><li id="52cf" class="kx ky hi jl b jm li jp lj js lk jw ll ka lm ke le lf lg lh bi translated">package.txt</li><li id="9e9b" class="kx ky hi jl b jm li jp lj js lk jw ll ka lm ke le lf lg lh bi translated">template.html</li></ol><p id="c91b" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated"><em class="mu"> requirements.txt </em>和<em class="mu"> package.txt </em>是必需的，因为我们将免费在<strong class="jl hj"> Streamlit Cloud </strong>上部署该应用。这是热爱Streamlit的又一个理由。</p><p id="d169" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated"><em class="mu">将要求template.html</em>将库存详情导出为pdf格式。</p><h2 id="21c7" class="lz kg hi bd kh ma mb mc kl md me mf kp js mg mh kr jw mi mj kt ka mk ml kv mm bi translated">发展</h2><p id="28c9" class="pw-post-body-paragraph jj jk hi jl b jm kz ij jo jp la im jr js mn ju jv jw mo jy jz ka mp kc kd ke hb bi translated"><strong class="jl hj">定义需求和包。</strong></p><p id="dcf4" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated"><em class="mu"> requirements.txt </em></p><pre class="iy iz ja jb fd mv mt mw bn mx my bi"><span id="51ec" class="mz kg hi mt b be na nb l nc nd">yfinance<br/>streamlit<br/>pandas<br/>pdfkit<br/>plotly</span></pre><p id="d75e" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated"><em class="mu">packages . txt</em>(pdf kit使用)</p><pre class="iy iz ja jb fd mv mt mw bn mx my bi"><span id="6e79" class="mz kg hi mt b be na nb l nc nd">wkhtmltopdf</span></pre><p id="ff1e" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated"><strong class="jl hj">导入库</strong></p><pre class="iy iz ja jb fd mv mt mw bn mx my bi"><span id="a215" class="mz kg hi mt b be na nb l nc nd">import yfinance as yf<br/>import pandas as pd<br/>import streamlit as st<br/>import plotly.express as px<br/>import pdfkit as pdf<br/>from jinja2 import Environment, select_autoescape, FileSystemLoader</span></pre><p id="f034" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated"><strong class="jl hj">设置页面标题和图标</strong></p><pre class="iy iz ja jb fd mv mt mw bn mx my bi"><span id="5155" class="mz kg hi mt b be na nb l nc nd">st.set_page_config(<br/>   page_title="ticktick.boom",<br/>   page_icon="💣",<br/>)</span></pre><p id="8f07" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated"><strong class="jl hj">定义功能</strong></p><pre class="iy iz ja jb fd mv mt mw bn mx my bi"><span id="d3db" class="mz kg hi mt b be na nb l nc nd">@st.experimental_memo<br/>## FETCHING HISTORIC DATA<br/>def historic_data(stock):<br/>    ticker = yf.Ticker(stock)<br/>    hist = ticker.history(period="max")<br/>    return hist<br/><br/>@st.experimental_memo<br/>## FETCHING COMPANY INFO<br/>def price_info(stock):<br/>    ticker = yf.Ticker(stock)<br/>    return ticker.info</span></pre><p id="b657" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated"><code class="du mq mr ms mt b">@st.experiment_memo</code>是一个函数装饰器，用于<strong class="jl hj">记忆</strong>函数的执行。内存化数据以pickled形式存储，这意味着内存化函数的返回值必须是可拾取的。<strong class="jl hj">pickle</strong>是将python中的对象转换成简单的二进制表示的过程，可用于将该对象写入可存储的文本文件中。这种存储Python对象的方法也被称为<strong class="jl hj">序列化</strong>。内存化函数的调用者得到缓存数据的副本。这有助于改善应用程序的响应时间。</p><p id="6bdc" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated"><strong class="jl hj">添加输入栏和按钮</strong></p><pre class="iy iz ja jb fd mv mt mw bn mx my bi"><span id="2f2b" class="mz kg hi mt b be na nb l nc nd">## MAIN APP<br/>st.title("ticktick.boom") # Title of app<br/>c1 = st.container() # Main container<br/>s = c1.text_input("Enter Stock Ticker", placeholder="Eg. AAPL") # Ticker Input<br/>btn = c1.button("Enter") # Submit button</span></pre><p id="2e7b" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated"><strong class="jl hj">插入指标</strong></p><pre class="iy iz ja jb fd mv mt mw bn mx my bi"><span id="a5c3" class="mz kg hi mt b be na nb l nc nd"># Creating 3 columns (Details)<br/>col1, col2, col3 = c1.columns(3)<br/><br/># Adding metric components to each column <br/>with col1:<br/>    st.metric(<br/>        label=info["shortName"],<br/>        value="%.2f" % info["currentPrice"],<br/>        delta="%.2f" % (info["currentPrice"] - info["previousClose"]),<br/>    )<br/>with col2:<br/>    st.metric(label="Today's High", value="%.2f" % info["dayHigh"])<br/>with col3:<br/>    st.metric(label="Today's Low", value="%.2f" % info["dayLow"])<br/><br/># Lower columns (Performance Indicators)<br/>col6, col7, col8 = c1.columns(3)<br/><br/># Adding metric components to each column <br/>with col6:<br/>    st.metric(<br/>        label="Revenue Growth (yoy)",<br/>        value="%.2f" % (info["revenueGrowth"]*100)+"%"<br/>    )<br/>with col7:<br/>    st.metric(label="PE Ratio", value="%.2f" % info["trailingPE"])<br/>with col8:<br/>    st.metric(label="PB Ratio", value="%.2f" % info["priceToBook"])</span></pre><p id="76e8" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated"><strong class="jl hj">显示图表和公司信息</strong></p><pre class="iy iz ja jb fd mv mt mw bn mx my bi"><span id="d1e9" class="mz kg hi mt b be na nb l nc nd"># Generating Chart<br/>close_px = df["Close"]<br/>mavg = close_px.rolling(window=100).mean() # Calculating Moving Average of Stock Close<br/>df["Mavg"] = mavg<br/>df["datetime"] = pd.to_datetime(df.index)<br/><br/>fig = px.line(df, x="datetime",y=["Close","Mavg"]) # Using Plotly Express to create line chart<br/>c1.plotly_chart(fig,use_container_width=True)<br/><br/># Adding Company Business Details<br/>c1.markdown("### Company Info")<br/>c1.write(info["longBusinessSummary"])</span></pre><p id="44e7" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated"><strong class="jl hj">创建PDF模板</strong></p><p id="f6cb" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">我使用<strong class="jl hj">概念</strong>创建了一个PDF模板。您可以将概念文档导出为<strong class="jl hj"> HTML </strong>并将其添加到您的项目中。每个变量都应该用花括号括起来(例如{{variable}})。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ne"><img src="../Images/b0fbd4c1f1b67c12fbd17ed1e9157641.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gjWRDpd_6Qo20idbFqWPOQ.png"/></div></div><figcaption class="nf ng et er es nh ni bd b be z dx translated">概念模板</figcaption></figure><p id="c35b" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">一旦您成功定制了PDF模板并将其导出，就该生成PDF了。</p><p id="241b" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated"><strong class="jl hj">生成PDF </strong></p><pre class="iy iz ja jb fd mv mt mw bn mx my bi"><span id="bad8" class="mz kg hi mt b be na nb l nc nd">## SETTING THE FILE PATH FOR PDF TEMPLATE<br/>env = Environment(loader=FileSystemLoader("."), autoescape=select_autoescape())<br/>template = env.get_template("template.html")<br/><br/># Generating PDF using the template<br/>html = template.render(<br/>    shortName=info["shortName"],<br/>    currentPrice=info["currentPrice"],<br/>    dayHigh=info["dayHigh"],<br/>    dayLow=info["dayLow"],<br/>    revenueGrowth=info["revenueGrowth"]*100,<br/>    trailingPE=info["trailingPE"],<br/>    priceToBook=info["priceToBook"],<br/>    longBusinessSummary=info["longBusinessSummary"],<br/>)<br/>pdf = pdf.from_string(html, False)<br/>c1.download_button(label="Download",data=pdf,file_name="stock.pdf", mime="application/octet-stream")</span></pre><p id="4a04" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">使用<code class="du mq mr ms mt b">render()</code>函数，我们将股票详细信息作为参数传递，并自动执行PDF生成过程。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nj"><img src="../Images/20415ce85725351963ce5e1ad5e83c24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mZSWe64kJQODyZHHZUk0Ig.png"/></div></div><figcaption class="nf ng et er es nh ni bd b be z dx translated">PDF已生成</figcaption></figure><blockquote class="nk nl nm"><p id="6d4e" class="jj jk mu jl b jm jn ij jo jp jq im jr nn jt ju jv no jx jy jz np kb kc kd ke hb bi translated">即使尝试了多种方法，我也无法将Plotly图表导出为PDF。如果我将来能够做到这一点，我将对代码进行必要的更新，这将反映在我的Github repo中。Streamlit Cloud在使用Kaleido(将图表转换为图像所需的库)时遇到问题。</p></blockquote><h2 id="f155" class="lz kg hi bd kh ma mb mc kl md me mf kp js mg mh kr jw mi mj kt ka mk ml kv mm bi translated">部署</h2><ol class=""><li id="39cd" class="kx ky hi jl b jm kz jp la js lb jw lc ka ld ke le lf lg lh bi translated">创建一个<a class="ae nq" href="https://streamlit.io/cloud" rel="noopener ugc nofollow" target="_blank"> Streamlit云</a>账户。</li><li id="4e95" class="kx ky hi jl b jm li jp lj js lk jw ll ka lm ke le lf lg lh bi translated">将您的项目部署到GitHub存储库中。</li><li id="fe82" class="kx ky hi jl b jm li jp lj js lk jw ll ka lm ke le lf lg lh bi translated">从云仪表板中选择存储库。</li><li id="7162" class="kx ky hi jl b jm li jp lj js lk jw ll ka lm ke le lf lg lh bi translated">将您的应用部署到<a class="ae nq" href="https://streamlit.io/cloud" rel="noopener ugc nofollow" target="_blank"> Streamlit Cloud </a>。</li></ol><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nr"><img src="../Images/95bdb3d42b6fffa007ff627091219fe6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RBt4_erTDrZzcKykChI1Ew.png"/></div></div><figcaption class="nf ng et er es nh ni bd b be z dx translated">Streamlit本身支持黑暗和光明模式以及更多的主题定制。</figcaption></figure><h2 id="cc6b" class="lz kg hi bd kh ma mb mc kl md me mf kp js mg mh kr jw mi mj kt ka mk ml kv mm bi translated">链接</h2><ol class=""><li id="ef24" class="kx ky hi jl b jm kz jp la js lb jw lc ka ld ke le lf lg lh bi translated"><a class="ae nq" href="https://github.com/Om-Kamath/stock-analysis" rel="noopener ugc nofollow" target="_blank"> GitHub </a></li><li id="1bd1" class="kx ky hi jl b jm li jp lj js lk jw ll ka lm ke le lf lg lh bi translated"><a class="ae nq" href="https://om-kamath-stock-analysis-web-bjjxp3.streamlit.app" rel="noopener ugc nofollow" target="_blank"> App </a></li><li id="0b3e" class="kx ky hi jl b jm li jp lj js lk jw ll ka lm ke le lf lg lh bi translated"><a class="ae nq" href="https://docs.streamlit.io" rel="noopener ugc nofollow" target="_blank">简化文档</a></li></ol></div><div class="ab cl ln lo gp lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="hb hc hd he hf"><p id="30a2" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">我希望这个简单的项目能让您对Streamlit框架有一个大致的了解，并了解它有多强大。它可能不是最好的web开发框架，但对于创建可以轻松共享、管理和部署的数据驱动的应用程序和仪表板来说，它是一个非常好的框架。</p><p id="2fcd" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">如果你喜欢我的博客，你可以请我喝杯咖啡。</p><blockquote class="nk nl nm"><p id="94d3" class="jj jk mu jl b jm jn ij jo jp jq im jr nn jt ju jv no jx jy jz np kb kc kd ke hb bi translated"><strong class="jl hj"> <em class="hi">感谢阅读。</em> </strong></p></blockquote></div></div>    
</body>
</html>