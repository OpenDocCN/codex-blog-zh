<html>
<head>
<title>Reliable Kubernetes on a Raspberry Pi Cluster: Introduction</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">树莓Pi集群上的可靠Kubernetes:简介</h1>
<blockquote>原文：<a href="https://medium.com/codex/reliable-kubernetes-on-a-raspberry-pi-cluster-introduction-cbdca4e759fb?source=collection_archive---------4-----------------------#2021-01-12">https://medium.com/codex/reliable-kubernetes-on-a-raspberry-pi-cluster-introduction-cbdca4e759fb?source=collection_archive---------4-----------------------#2021-01-12</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><h2 id="df66" class="hg hh hi bd b fp hj hk hl hm hn ho dx hp translated" aria-label="kicker paragraph"><a class="ae ge" href="http://medium.com/codex" rel="noopener">法典</a></h2><div class=""/><figure class="ev ex ip iq ir is er es paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="er es io"><img src="../Images/39b9332eeec1577b4f1b0cff2b58deb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*c5z5Kjup3eq4YD0R"/></div></div><figcaption class="iz ja et er es jb jc bd b be z dx translated">照片由<a class="ae jd" href="https://unsplash.com/@harrisonbroadbent?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">哈里森·布罗德本特</a>在<a class="ae jd" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="5ee3" class="pw-post-body-paragraph je jf hi jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hb bi translated">我喜欢把自己想象成一个修补匠。我愿意成为我自己的系统管理员，非常乐意学习并花时间真正理解事物是如何协同工作的。我已经在一个小型RPi集群上运行了几年了，并且这个设置一直在不断发展。现在，我终于找到了一个位置，一切似乎都在自我管理，有一定程度的自我修复。今天我要和大家分享核心组件。</p><p id="cd2e" class="pw-post-body-paragraph je jf hi jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hb bi translated">我将写一系列的文章来描述如何设置每个组件，以及如何最大限度地利用它。我还会分享我的设置的所有相关部分，这样你就可以按照你的意愿自己镜像它。</p><p id="4828" class="pw-post-body-paragraph je jf hi jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hb bi translated">第1部分:简介<br/> <a class="ae jd" href="https://scott-jones4k.medium.com/reliable-kubernetes-on-a-raspberry-pi-cluster-the-foundations-d9c792c27b75" rel="noopener">第2部分:基础</a> <br/> <a class="ae jd" href="https://scott-jones4k.medium.com/reliable-kubernetes-on-a-raspberry-pi-cluster-storage-ff2848d331df" rel="noopener">第3部分:存储</a> <br/> <a class="ae jd" href="https://scott-jones4k.medium.com/reliable-kubernetes-on-a-raspberry-pi-cluster-monitoring-a771b497d4d3" rel="noopener">第4部分:监控</a> <br/> <a class="ae jd" href="https://scott-jones4k.medium.com/reliable-kubernetes-on-a-raspberry-pi-cluster-security-ef62cca74d78" rel="noopener">第5部分:安全</a></p></div><div class="ab cl kd ke gp kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="hb hc hd he hf"><h1 id="925b" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">库伯内特斯(k3s)</h1><p id="1808" class="pw-post-body-paragraph je jf hi jg b jh li jj jk jl lj jn jo jp lk jr js jt ll jv jw jx lm jz ka kb hb bi translated">我整个集群的支柱是牧场主的<a class="ae jd" href="https://rancher.com/docs/k3s/latest/en/" rel="noopener ugc nofollow" target="_blank"> k3s。这是一个轻量级发行版，在较低规格的硬件上运行得相对较好，比如RPi。直到最近，我有一个仅运行RPi 3B的2节点集群，它(通常)处理得很好。我开始推动我在这些设备上运行的极限，所以我现在有了一个新的RPi 4 8GB，现在我有了几天的计算能力！</a></p><h1 id="c43c" class="kk kl hi bd km kn ln kp kq kr lo kt ku kv lp kx ky kz lq lb lc ld lr lf lg lh bi translated">特拉菲克</h1><p id="ae83" class="pw-post-body-paragraph je jf hi jg b jh li jj jk jl lj jn jo jp lk jr js jt ll jv jw jx lm jz ka kb hb bi translated">我的集群入口控制器是<a class="ae jd" href="https://traefik.io/traefik/" rel="noopener ugc nofollow" target="_blank"> Traefik </a>。我喜欢它的一点是，它可以从反向代理和入口控制器中完成您需要的一切。在Kubernetes之前，我用它来代理一堆docker容器。它使用LetsEncypt处理我的所有SSL，使用Cloudflare集成DNS挑战，这意味着我可以获得安全的SSL证书，而无需将我的服务暴露在互联网上。它有一个令人惊叹的用户界面，向我准确地显示了设置的内容及其状态。它还得到了强大的中间件支持，允许我添加一个默认的头集来提高安全性，还可以在我的任何运行系统中添加oAuth之类的东西。它的配置非常简单！</p><h1 id="d07b" class="kk kl hi bd km kn ln kp kq kr lo kt ku kv lp kx ky kz lq lb lc ld lr lf lg lh bi translated">金属LB</h1><p id="4390" class="pw-post-body-paragraph je jf hi jg b jh li jj jk jl lj jn jo jp lk jr js jt ll jv jw jx lm jz ka kb hb bi translated"><a class="ae jd" href="https://metallb.universe.tf/" rel="noopener ugc nofollow" target="_blank"> MetalLB </a>是我的集群中相对较新的成员。我用它来创建面向外部的负载平衡器服务，作为我的集群的入口点。它使用ARP协议开箱即用，基本上意味着无论哪个节点被指定为服务的活动入口点，都会将其mac广告为可以服务IP的节点。如果该节点出现故障，下一个节点会继续ARP发布，并且可以无缝工作。这意味着无论我的服务在哪里运行，我的DNS和http(s)流量都可以有一个静态IP。</p><h1 id="1051" class="kk kl hi bd km kn ln kp kq kr lo kt ku kv lp kx ky kz lq lb lc ld lr lf lg lh bi translated">节点导出器</h1><p id="6ea0" class="pw-post-body-paragraph je jf hi jg b jh li jj jk jl lj jn jo jp lk jr js jt ll jv jw jx lm jz ka kb hb bi translated">我需要能够跟踪的一件事是我的集群中每个节点的运行情况。为了使这些统计数据在集群中可用，我让<a class="ae jd" href="https://github.com/prometheus/node_exporter" rel="noopener ugc nofollow" target="_blank">节点导出器</a>在每个RPi上运行(在Kubernetes之外)。这为Prometheus提供了一个端点，让我可以实时访问系统指标以进行健康监控</p><h1 id="30bc" class="kk kl hi bd km kn ln kp kq kr lo kt ku kv lp kx ky kz lq lb lc ld lr lf lg lh bi translated">普罗米修斯-格拉法纳公司</h1><p id="e43b" class="pw-post-body-paragraph je jf hi jg b jh li jj jk jl lj jn jo jp lk jr js jt ll jv jw jx lm jz ka kb hb bi translated">最后组成我核心集群的物品是<a class="ae jd" href="https://prometheus.io/" rel="noopener ugc nofollow" target="_blank">普罗米修斯</a>和<a class="ae jd" href="https://grafana.com/" rel="noopener ugc nofollow" target="_blank">格拉夫纳</a>。我收集了整个集群的大量统计数据——节点健康状况、针孔统计数据、我的家庭助理状态。这种设置使我能够非常容易地将这些可视化，并在必要时进行深入研究，以诊断集群中的潜在故障。您还可以通过这些设置一系列警报，但我还没有利用这一点。</p></div></div>    
</body>
</html>