<html>
<head>
<title>How to create an iOS app that takes secret photos while the iPhone screen seems to be turned off</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何创建一个在iPhone屏幕似乎关闭时拍摄秘密照片的iOS应用程序</h1>
<blockquote>原文：<a href="https://medium.com/codex/how-to-create-an-ios-app-that-takes-secret-photos-while-the-iphone-screen-seems-to-be-turned-off-7081d110309e?source=collection_archive---------5-----------------------#2022-11-08">https://medium.com/codex/how-to-create-an-ios-app-that-takes-secret-photos-while-the-iphone-screen-seems-to-be-turned-off-7081d110309e?source=collection_archive---------5-----------------------#2022-11-08</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/6270a41aa4a4c9d7ede8a09601b09318.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ojXrS4mD1pwW18JkD9dUMA.jpeg"/></div></div></figure><p id="db21" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">问题</strong></p><p id="6808" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">假设你想重复拍摄某人的秘密照片，而不被抓到。最好的iPhone应用程序是什么？内置相机应用程序就足够了吗？</p><p id="1a86" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">有许多事情要考虑。首先，如果有人越过你的肩膀，注意到你的屏幕正在显示摄像机画面，你可能会被抓住。所以，你需要确保拍摄时没有人在你身后。此外，拍照所需的轻击手势与其他常见手势(滚动、发短信)有所不同。一个人只要看你的手和肢体语言就能猜到你在拍照。</p><p id="c083" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">另一个需要考虑的是绿色的相机使用指示器。当iOS应用程序要拍摄照片时，它必须首先显示类似于以下内容的提示:</p><figure class="jp jq jr js fd ij er es paragraph-image"><div class="er es jo"><img src="../Images/92cf00505c0cecbc26fae9a9d04cfaae.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*_xRQh_Xas5bIqZQ5A_yvxg.jpeg"/></div></figure><p id="672b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一旦用户确认，应用程序可以在任何给定的时刻拍照，而不必提供任何正在拍照的可见指示。由于偷偷给用户拍照在道德上是错误的(我们不希望Gmail或Instagram偷拍我们的照片)，所以从iOS 14开始增加了一个绿色的相机使用中指示器:</p><figure class="jp jq jr js fd ij er es paragraph-image"><div class="er es jt"><img src="../Images/fb66d7f77f7ed764f58193627a663d49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1132/format:webp/1*22i7lta6x92W9_oCfDRJ2A.png"/></div></figure><p id="b7af" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一旦相机被激活，绿色指示灯就会变成绿色，即使照片没有被保存或传输到任何地方。因此，即使我们有一个程序，它只是拍摄一张照片，而不在屏幕上显示任何特定的内容，绿色指示器也会显示相机处于活动状态的事实。</p><p id="b6a2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最后，iOS有一个特殊的声音效果，让每个人都知道拍了一张照片:</p><figure class="jp jq jr js fd ij"><div class="bz dy l di"><div class="ju jv l"/></div></figure><p id="bbe8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要想拍出没有这种声音的照片，唯一的方法就是在拍摄时将音量完全静音。</p></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><p id="bf08" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">解决方案</strong></p><p id="8802" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我一直在研究这个问题，并最终创建了一个小程序来解决上述所有问题，并使用户能够更自信地拍摄秘密照片。</p><ol class=""><li id="786e" class="kd ke hi is b it iu ix iy jb kf jf kg jj kh jn ki kj kk kl bi translated">程序显示黑屏(没有摄像头进给)。</li><li id="7030" class="kd ke hi is b it km ix kn jb ko jf kp jj kq jn ki kj kk kl bi translated">该程序以一秒钟的时间间隔重复拍摄照片(不需要用户手势)。</li><li id="55bb" class="kd ke hi is b it km ix kn jb ko jf kp jj kq jn ki kj kk kl bi translated">由于程序控制屏幕的亮度并将其降低到最小可能的值，使用中的相机指示灯几乎<strong class="is hj">不可见</strong>，即使它是绿色的，并且整体上，屏幕似乎是关闭的。</li><li id="737e" class="kd ke hi is b it km ix kn jb ko jf kp jj kq jn ki kj kk kl bi translated">无需将设备静音:即使当设备设置为高音量时，相机拍摄声音也会被编程静音。</li><li id="8839" class="kd ke hi is b it km ix kn jb ko jf kp jj kq jn ki kj kk kl bi translated">为了快速逃离，触摸屏幕会立即导致程序退出回到iPhone的主屏幕。</li></ol><figure class="jp jq jr js fd ij er es paragraph-image"><div class="er es kr"><img src="../Images/e1f26b93f3149c2d5440e109fb72a0f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:420/format:webp/1*H5GpvLHFTDQh9NXxehesUQ.jpeg"/></div></figure><p id="432a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">需要注意的是，我不鼓励任何人实际使用这个程序。毕竟是<strong class="is hj">恶</strong>。这个项目的目的只是为了展示创建这样一个程序是多么容易。此外，代码只使用众所周知的系统API，而不访问任何私有系统方法，因此理论上，它可以通过AppStore审查(如果作为秘密模块嵌入到具有其他一些有价值内容的更大的应用程序中)。</p><p id="d6f3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">该程序的代码可在GitHub上公开获得，地址如下:</p><p id="adb1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">https://github.com/arixegal/BlackEye/tree/MediumTutorial<a class="ae ks" href="https://github.com/arixegal/BlackEye/tree/MediumTutorial" rel="noopener ugc nofollow" target="_blank"/></p><p id="86aa" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然而，在本文中，我将一步一步地演示如何创建这个程序。需要具备Swift编程语言的基础知识。</p></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><p id="0f4e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">通用设置</strong></p><p id="e306" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们需要创建一个xCode项目和一个空白的单页应用程序。</p><ol class=""><li id="9808" class="kd ke hi is b it iu ix iy jb kf jf kg jj kh jn ki kj kk kl bi translated">打开一个现代版的Xcode。</li><li id="d84b" class="kd ke hi is b it km ix kn jb ko jf kp jj kq jn ki kj kk kl bi translated">选取“创建新的Xcode项目”。</li><li id="277a" class="kd ke hi is b it km ix kn jb ko jf kp jj kq jn ki kj kk kl bi translated">在“可用模板”窗口中，选择“iOS -&gt; App”模板</li></ol><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kt"><img src="../Images/9973b7b9d7cdea48b8a68fc91561c80f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8iqS5TSVffceZc7KZ2hJdA.png"/></div></div></figure><p id="33a4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">4.输入项目名称、团队和组织标识符。语言应该是<strong class="is hj"> Swift </strong>界面应该是<strong class="is hj">故事板</strong>。</p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ku"><img src="../Images/837feb297bf5aed3a1e120fbb07b599e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NtIPEREW603iPnap7kD9aw.png"/></div></div></figure><p id="5b8a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这将创建一个显示空白屏幕的应用程序。离游戏结束又近了一步。为了测试它，键入Command+R或选择Product-&gt;Run。</p><p id="7969" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">如何显示黑屏</strong></p><p id="583c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">由于我们的应用程序的界面是基于故事板的，并且我们已经有了管理主屏幕显示的视图控制器，为了显示黑屏，我们所要做的就是将这个屏幕的背景改为黑色。这可以直接从界面构建器中完成。</p><ol class=""><li id="26cf" class="kd ke hi is b it iu ix iy jb kf jf kg jj kh jn ki kj kk kl bi translated">在项目导航器中，选择文件Main.storyboard</li><li id="fb2d" class="kd ke hi is b it km ix kn jb ko jf kp jj kq jn ki kj kk kl bi translated">在故事板的文档轮廓中，选择<strong class="is hj">视图</strong>元素(在“视图控制器场景”- &gt;“视图控制器”下)</li><li id="30d6" class="kd ke hi is b it km ix kn jb ko jf kp jj kq jn ki kj kk kl bi translated">在视图的属性检查器中，将背景更改为黑色。</li></ol><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kv"><img src="../Images/b9e4011063757c8cdb2d6dddbaf63a1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cIatWyfH6T4ZuoGVpzJ7Mg.png"/></div></div></figure><p id="7f01" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这将创建一个显示黑屏的应用程序。为了测试它，键入Command+R或选择Product-&gt;Run。选择颜色<strong class="is hj">黑色</strong>很重要，这与其他看起来是黑色的颜色相反，例如<em class="kw">标签颜色</em>。选择<em class="kw">标签颜色</em>而不是<em class="kw">黑色</em>作为背景颜色，将导致黑色或白色屏幕，这取决于iPhone的黑暗模式设置。选择<strong class="is hj">黑色</strong>总是会导致黑屏，不管iPhone的暗模式还是亮模式。</p><p id="1334" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">如何隐藏状态栏</strong></p><p id="6c2f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果我们现在运行应用程序，我们可能会看到一个完全黑屏。然而，如果我们运行应用程序的模拟器或设备设置为黑暗模式，屏幕不会完全黑下来。黑暗模式是通过选择设置-&gt;显示和亮度-&gt;外观下的“黑暗”来实现的。</p><figure class="jp jq jr js fd ij er es paragraph-image"><div class="er es kx"><img src="../Images/0a633f6c1ab188bdfff277eadcf86cb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:496/format:webp/1*vw0SWL015gUVOBv4wJc1VQ.png"/></div></figure><p id="b8f8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当我们现在运行我们的应用程序时，虽然设备处于黑暗模式，但顶部状态栏会显示各种元素，如时间、电量和WiFi指示器。在亮模式下，状态栏元素都是黑色的，所以我们看不到它们，但是现在因为我们在暗模式下，它们是亮的，可见的。</p><figure class="jp jq jr js fd ij er es paragraph-image"><div class="er es ky"><img src="../Images/c176255b176e2c828c402a9f00d9337a.png" data-original-src="https://miro.medium.com/v2/resize:fit:560/format:webp/1*z1NDiD5lMTjVyk6FElHtPA.png"/></div></figure><p id="94da" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们希望屏幕看起来好像是关闭的。这意味着我们必须隐藏状态栏。这可以通过向目标属性添加两个新的键值对来实现。</p><ol class=""><li id="178d" class="kd ke hi is b it iu ix iy jb kf jf kg jj kh jn ki kj kk kl bi translated">在项目导航器中，选择最顶层的元素，即项目本身。</li><li id="ff71" class="kd ke hi is b it km ix kn jb ko jf kp jj kq jn ki kj kk kl bi translated">选中项目后，在<strong class="is hj">目标</strong>下，选择主目标并导航到<strong class="is hj">信息</strong>选项卡。</li><li id="0ecb" class="kd ke hi is b it km ix kn jb ko jf kp jj kq jn ki kj kk kl bi translated">点击鼠标悬停在列表项上时可见的<strong class="is hj">加</strong>按钮，并添加以下键:<strong class="is hj">UIViewControllerBasedStatusBarAppearance</strong></li><li id="1b7e" class="kd ke hi is b it km ix kn jb ko jf kp jj kq jn ki kj kk kl bi translated">将新添加键的值设置为<strong class="is hj">否</strong></li><li id="a916" class="kd ke hi is b it km ix kn jb ko jf kp jj kq jn ki kj kk kl bi translated">添加另一个键:<strong class="is hj"> UIStatusBarHidden </strong></li><li id="fd99" class="kd ke hi is b it km ix kn jb ko jf kp jj kq jn ki kj kk kl bi translated">将上述新增键的值设置为<strong class="is hj">是</strong></li></ol><p id="683f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你会注意到一旦添加并显示了按键，名称<strong class="is hj"> UIStatusBarHidden </strong>显示为<em class="kw">“状态栏初始隐藏”</em>，名称<strong class="is hj">UIViewControllerBasedStatusBarAppearance</strong>显示为<em class="kw">“查看基于控制器的状态栏外观”</em>。这是可以的。</p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kz"><img src="../Images/a8fd23947e2b545dad1b7737c0547a69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RaWcfXe0ouLG7uoenXVaTQ.png"/></div></div></figure><p id="798a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在运行app的时候，你会看到屏幕完全黑了，状态栏元素全部不见了，不管iPhone是暗模式还是亮模式。这正是我们想要的。</p><p id="a9e3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">如何响应点击事件</strong></p><p id="b18f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当点击屏幕时，我们希望应用程序完全退出。为此，我们需要听录音。有许多方法可以做到这一点。在这个项目中，我们将添加一个黑色按钮。</p><ol class=""><li id="571b" class="kd ke hi is b it iu ix iy jb kf jf kg jj kh jn ki kj kk kl bi translated">在项目导航器中，选择<strong class="is hj"> ViewConroller.swift </strong></li><li id="a799" class="kd ke hi is b it km ix kn jb ko jf kp jj kq jn ki kj kk kl bi translated">在类声明下添加以下代码:</li></ol><pre class="jp jq jr js fd la lb lc ld aw le bi"><span id="6f47" class="lf lg hi lb b fi lh li l lj lk"><strong class="lb hj">private</strong> <strong class="lb hj">lazy</strong> <strong class="lb hj">var</strong> curtainView: UIView = {<br/>    <strong class="lb hj">let</strong> size = UIScreen.main.bounds.size<br/>    <strong class="lb hj">let</strong> btn = UIButton(<br/>        frame: CGRect(<br/>            x: 0,<br/>            y: 0,<br/>            width: <strong class="lb hj">size</strong>.width,<br/>            height: size.height<br/>         )<br/>    )</span><span id="e8c5" class="lf lg hi lb b fi ll li l lj lk">    btn.backgroundColor = UIColor.black <br/>    btn.addTarget(<strong class="lb hj">self</strong>, action: <strong class="lb hj">#selector</strong>(quit), for: .touchDown)     <br/>    <br/>    <strong class="lb hj">return</strong> btn<br/>}()</span></pre><p id="ad4b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">3.添加<strong class="is hj">退出</strong>的方法</p><pre class="jp jq jr js fd la lb lc ld aw le bi"><span id="88d6" class="lf lg hi lb b fi lh li l lj lk">/// Will quit the application with animation</span><span id="48aa" class="lf lg hi lb b fi ll li l lj lk"><strong class="lb hj">@objc private</strong> <strong class="lb hj">func</strong> quit() {<br/>    UIApplication.shared.perform(<strong class="lb hj">#selector</strong>(NSXPCConnection.suspend))<br/>    /// Sleep for a while to let the app goes in background<br/>    sleep(2)<br/>    exit(0)<br/>}</span></pre><p id="649f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">4.将按钮添加到视图中</p><pre class="jp jq jr js fd la lb lc ld aw le bi"><span id="e96f" class="lf lg hi lb b fi lh li l lj lk"><strong class="lb hj">override</strong> <strong class="lb hj">func</strong> viewDidLoad() {<br/>    <strong class="lb hj">super</strong>.viewDidLoad()<br/>    view.addSubview(curtainView)<br/>}</span></pre><p id="ef5d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">上面的<strong class="is hj">退出</strong>方法，是从下面讨论中的一个答案复制过来的:</p><div class="lm ln ez fb lo lp"><a href="https://stackoverflow.com/questions/355168/proper-way-to-exit-iphone-application" rel="noopener  ugc nofollow" target="_blank"><div class="lq ab dw"><div class="lr ab ls cl cj lt"><h2 class="bd hj fi z dy lu ea eb lv ed ef hh bi translated">退出iPhone应用程序的正确方法？</h2><div class="lw l"><h3 class="bd b fi z dy lu ea eb lv ed ef dx translated">我们不能使用exit(0)，abort()函数退出应用程序，因为Apple强烈反对使用这些函数。虽然…</h3></div><div class="lx l"><p class="bd b fp z dy lu ea eb lv ed ef dx translated">stackoverflow.com</p></div></div><div class="ly l"><div class="lz l ma mb mc ly md io lp"/></div></div></a></div><p id="41b6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">尝试运行该应用程序，并测试点击屏幕时的行为。如果一切正常，轻点屏幕会导致应用程序退出。</p><p id="1eab" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">如何拍照</strong></p><p id="0db7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">有很多在线教程和例子可以教你如何编程操作iPhone相机。对于我们的目的来说，它们中的大多数都有太多的代码，因为操作摄像机的传统方式涉及到在屏幕上显示摄像机馈送，这在我们的例子中是不需要的。</p><ol class=""><li id="09e1" class="kd ke hi is b it iu ix iy jb kf jf kg jj kh jn ki kj kk kl bi translated">在ViewController.swift中，在文件<strong class="is hj">的顶部添加一行<strong class="is hj"> import AVFoundation </strong>。</strong></li><li id="91dd" class="kd ke hi is b it km ix kn jb ko jf kp jj kq jn ki kj kk kl bi translated">在类声明下添加以下两个实例:</li></ol><pre class="jp jq jr js fd la lb lc ld aw le bi"><span id="f80b" class="lf lg hi lb b fi lh li l lj lk"><strong class="lb hj">private</strong> <strong class="lb hj">let</strong> photoOutput = AVCapturePhotoOutput()</span><span id="5eab" class="lf lg hi lb b fi ll li l lj lk"><strong class="lb hj">private</strong> <strong class="lb hj">let</strong> session = AVCaptureSession()</span></pre><p id="d9e7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">3.添加以下两种方法:</p><pre class="jp jq jr js fd la lb lc ld aw le bi"><span id="9886" class="lf lg hi lb b fi lh li l lj lk"><strong class="lb hj">private</strong> <strong class="lb hj">func</strong> setupCaptureSession() -&gt; AVCaptureSession? {<br/>    session.sessionPreset = .photo</span><span id="7387" class="lf lg hi lb b fi ll li l lj lk"><strong class="lb hj">    guard</strong> <strong class="lb hj">let</strong> cameraDevice = AVCaptureDevice.default(for: .video) <strong class="lb hj">else</strong> {           <br/>        print("Unable to fetch default camera")<br/>        <strong class="lb hj">return</strong> <strong class="lb hj">nil<br/>    </strong>}</span><span id="3237" class="lf lg hi lb b fi ll li l lj lk"><strong class="lb hj">    guard</strong> <strong class="lb hj">let</strong> videoInput = <strong class="lb hj">try</strong>? AVCaptureDeviceInput(device: cameraDevice) <strong class="lb hj">else</strong> {<br/>        print("Unable to establish video input")<br/>        <strong class="lb hj">return</strong> <strong class="lb hj">nil<br/>    </strong>}</span><span id="926f" class="lf lg hi lb b fi ll li l lj lk">    session.beginConfiguration()<br/>        session.sessionPreset = AVCaptureSession.Preset.photo <br/>        <strong class="lb hj">guard</strong> session.canAddInput(videoInput) <strong class="lb hj">else</strong> {<br/>            print("Unable to add videoInput to captureSession")<br/>            <strong class="lb hj">return</strong> <strong class="lb hj">nil<br/>        </strong>}<br/>    <br/>        session.addInput(videoInput)<br/>  <br/>        <strong class="lb hj">guard</strong> session.canAddOutput(photoOutput) <strong class="lb hj">else</strong> {<br/>            print("Unable to add videoOutput to captureSession")<br/>            <strong class="lb hj">return</strong> <strong class="lb hj">nil<br/>        </strong>}<br/>  <br/>        session.addOutput(photoOutput)<br/>        photoOutput.isHighResolutionCaptureEnabled = <strong class="lb hj">true<br/>     </strong>session.commitConfiguration()</span><span id="0060" class="lf lg hi lb b fi ll li l lj lk">     DispatchQueue.global(qos: .background).async { [<strong class="lb hj">weak</strong> <strong class="lb hj">self</strong>] <strong class="lb hj">in<br/>         self</strong>?.session.startRunning()<br/>     }<br/>     <strong class="lb hj">return</strong> session<br/>}</span><span id="1f30" class="lf lg hi lb b fi ll li l lj lk"><strong class="lb hj">private</strong> <strong class="lb hj">func</strong> takePhoto() {<br/>    photoOutput.capturePhoto(with: AVCapturePhotoSettings(), delegate: <strong class="lb hj">self</strong>)</span><span id="a011" class="lf lg hi lb b fi ll li l lj lk">    DispatchQueue.main.asyncAfter(deadline: DispatchTime.now() + .seconds(1)) {[<strong class="lb hj">weak</strong> <strong class="lb hj">self</strong>] <strong class="lb hj">in<br/>        self</strong>?.takePhoto()<br/>    }<br/>}</span></pre><p id="2c3d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">添加方法后，您会注意到项目无法编译。问题是我们将<em class="kw"> self </em>作为委托传递给了<em class="kw"> capturePhoto </em>方法，但是<em class="kw"> self </em>，在本例中是<em class="kw"> UIViewController </em>实例，不支持<em class="kw">avcapturephocapturedelegate</em>协议。为了保存照片和静音，我们以后需要这种支持。记住这一点，为了解决编译错误，我们将添加以下存根:</p><pre class="jp jq jr js fd la lb lc ld aw le bi"><span id="de70" class="lf lg hi lb b fi lh li l lj lk"><strong class="lb hj">extension</strong> ViewController: AVCapturePhotoCaptureDelegate {<br/>    <strong class="lb hj">func</strong> photoOutput(_ output: AVCapturePhotoOutput, didFinishProcessingPhoto photo: AVCapturePhoto, error: Error?) {}</span><span id="a5f6" class="lf lg hi lb b fi ll li l lj lk"><strong class="lb hj">    func</strong> photoOutput(_ output: AVCapturePhotoOutput, willCapturePhotoFor resolvedSettings: AVCaptureResolvedPhotoSettings) {}<br/>}</span></pre><p id="9e98" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">那么我们目前有什么发现？两种方法，一种用于配置相机会话，另一种用于拍照(以一秒钟的间隔重复进行)。但是我们仍然需要连接它们，所以最后一步是添加第一个调用:</p><pre class="jp jq jr js fd la lb lc ld aw le bi"><span id="a1ad" class="lf lg hi lb b fi lh li l lj lk"><strong class="lb hj">override</strong> <strong class="lb hj">func</strong> viewDidAppear(_ animated: Bool) {<br/>    <strong class="lb hj">super</strong>.viewDidAppear(animated) <br/>    <strong class="lb hj">if</strong> UIImagePickerController.isSourceTypeAvailable(.camera) { <br/>        <strong class="lb hj">if</strong> <strong class="lb hj">let</strong> _ = setupCaptureSession() {<br/>            takePhoto()<br/>        } <strong class="lb hj">else</strong> {<br/>            print("Failed to establish capture session")<br/>        }<br/>    } <strong class="lb hj">else</strong> {<br/>        print("Camera not available") // Would be true in Simulator<br/>    }<br/>}</span></pre><p id="6cb5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在运行项目时，构建应该会成功。然而，在添加第一个调用后，我们有一个运行时崩溃。此应用程序已崩溃，因为它试图在没有使用说明的情况下访问隐私敏感数据。 为了解决这个问题，我们需要向目标添加更多的键值对。在这里，我们将添加一个访问相机的用法描述和另一个将照片保存到相册的用法描述(稍后将实现)。</p><ol class=""><li id="4188" class="kd ke hi is b it iu ix iy jb kf jf kg jj kh jn ki kj kk kl bi translated">在项目导航器中，选择最顶层的元素，即项目本身。</li><li id="09d9" class="kd ke hi is b it km ix kn jb ko jf kp jj kq jn ki kj kk kl bi translated">选中项目后，在<strong class="is hj">目标</strong>下，选择主目标并导航到<strong class="is hj">信息</strong>选项卡。</li><li id="63cd" class="kd ke hi is b it km ix kn jb ko jf kp jj kq jn ki kj kk kl bi translated">点击<strong class="is hj">加</strong>按钮，当鼠标悬停在列表项上时，该按钮变为可见，并添加以下(字符串)键:<strong class="is hj">NSCameraUsageDescription</strong></li><li id="1dbe" class="kd ke hi is b it km ix kn jb ko jf kp jj kq jn ki kj kk kl bi translated">将新添加的键的值设置为“<em class="kw">，以便拍摄秘密照片</em>”。</li><li id="52ce" class="kd ke hi is b it km ix kn jb ko jf kp jj kq jn ki kj kk kl bi translated">添加另一个(字符串)键:<strong class="is hj">NSPhotoLibraryAddUsageDescription</strong></li><li id="f8f3" class="kd ke hi is b it km ix kn jb ko jf kp jj kq jn ki kj kk kl bi translated">将上述新添加的键的值设置为“<em class="kw">以存储秘密照片</em><strong class="is hj">”</strong></li></ol><p id="3328" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在运行应用程序时，您应该可以看到摄像头访问权限对话框。一旦授权，您将能够听到相机拍摄音效，并看到绿色的相机在使用中的指示被激活。</p><figure class="jp jq jr js fd ij er es paragraph-image"><div class="er es kr"><img src="../Images/e1f26b93f3149c2d5440e109fb72a0f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:420/format:webp/1*H5GpvLHFTDQh9NXxehesUQ.jpeg"/></div></figure><p id="ae39" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">如何储存照片</strong></p><p id="873e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这个程序中，我们将把每张照片存储到最近的相册中。如果我们愿意，我们也可以将它们存储在远程服务器上，但这需要配置后端，超出了本演示的目的。</p><p id="fde0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">存储照片是通过调用系统方法<em class="kw">UIImageWriteToSavedPhotosAlbum实现的。</em></p><ol class=""><li id="cd46" class="kd ke hi is b it iu ix iy jb kf jf kg jj kh jn ki kj kk kl bi translated">找到之前添加的空委托方法<em class="kw">did finished processing photo</em><em class="kw">，</em>，插入下面的主体:</li></ol><pre class="jp jq jr js fd la lb lc ld aw le bi"><span id="3cd1" class="lf lg hi lb b fi lh li l lj lk"><strong class="lb hj">func</strong> photoOutput(_ output: AVCapturePhotoOutput, didFinishProcessingPhoto photo: AVCapturePhoto, error: Error?) {<br/>    <strong class="lb hj">guard</strong> <strong class="lb hj">let</strong> data = photo.fileDataRepresentation() <strong class="lb hj">else</strong> {<br/>        print("Processing did finish with no data")<br/>        <strong class="lb hj">return<br/>    </strong>}</span><span id="16c4" class="lf lg hi lb b fi ll li l lj lk"><strong class="lb hj">    guard</strong> <strong class="lb hj">let</strong> image = UIImage(data: data) <strong class="lb hj">else</strong> {<br/>        print("Processing did finish with invalid image data")<br/>        <strong class="lb hj">return<br/>    </strong>}</span><span id="eaea" class="lf lg hi lb b fi ll li l lj lk">    UIImageWriteToSavedPhotosAlbum(<br/>        image, <br/>        <strong class="lb hj">self</strong>,  <br/>        <strong class="lb hj">#selector</strong>(image(_:didFinishSavingWithError:contextInfo:)),           <br/>  <strong class="lb hj">      nil</strong>)<br/>    <br/>    print("Photo taken") <br/>}</span></pre><p id="04aa" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">2.添加以下方法来获取成功/失败状态:</p><pre class="jp jq jr js fd la lb lc ld aw le bi"><span id="fe15" class="lf lg hi lb b fi lh li l lj lk"><strong class="lb hj">@objc</strong> <strong class="lb hj">func</strong> image(_ image: UIImage, didFinishSavingWithError error: NSError?, contextInfo: UnsafeRawPointer) {<br/>    <strong class="lb hj">if</strong> <strong class="lb hj">let</strong> error = error {<br/>        print("Save error: \(error.localizedDescription)")<br/>    } <strong class="lb hj">else</strong> {<br/>        print("Saved!")<br/>    }<br/>}</span></pre><p id="76a0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在运行应用程序时，您应该能够看到图库访问权限对话框。获得授权后，您将能够在“照片”应用程序中看到新照片。尝试运行应用程序几秒钟，看看照片是否已添加。</p><p id="aded" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">如何隐藏相机使用中指示器</strong></p><p id="305c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">iOS应用可以控制屏幕亮度。当应用程序运行时，将屏幕亮度设置为最小可能值会导致正在使用的相机指示灯几乎不可见。</p><p id="f8bf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将添加一个专用于控制屏幕亮度的单独类:</p><pre class="jp jq jr js fd la lb lc ld aw le bi"><span id="ee3e" class="lf lg hi lb b fi lh li l lj lk"><strong class="lb hj">final</strong> <strong class="lb hj">class</strong> DimUnDim {<br/>    <strong class="lb hj">static</strong> <strong class="lb hj">let</strong> shared = DimUnDim()<br/>    <strong class="lb hj">private</strong> <strong class="lb hj">var</strong> originalBrightness = UIScreen.main.brightness</span><span id="be43" class="lf lg hi lb b fi ll li l lj lk"><strong class="lb hj">    func</strong> dim() {<br/>        print("dim")<br/>        UIScreen.main.wantsSoftwareDimming = <strong class="lb hj">true<br/>        </strong>UIScreen.main.brightness = 0.0<br/>    }</span><span id="21c0" class="lf lg hi lb b fi ll li l lj lk"><strong class="lb hj">    func</strong> unDim() {<br/>        print("unDim")<br/>        UIScreen.main.brightness = originalBrightness<br/>    }<br/>}</span></pre><p id="a8ea" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将在应用程序激活时调用Dim，在应用程序不激活时调用UnDim。编辑文件SceneDelegate.swift并添加以下内容:</p><pre class="jp jq jr js fd la lb lc ld aw le bi"><span id="25cb" class="lf lg hi lb b fi lh li l lj lk"><strong class="lb hj">func</strong> sceneDidBecomeActive(_ scene: UIScene) {<br/>    DimUnDim.shared.dim()<br/>}</span><span id="cc8f" class="lf lg hi lb b fi ll li l lj lk"><strong class="lb hj">func</strong> sceneWillResignActive(_ scene: UIScene) {     <br/>    DimUnDim.shared.unDim()<br/>}</span></pre><p id="c4da" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这是好的，只要应用程序正在运行。如果它处于活动状态，屏幕会变暗，但如果用户切换到主屏幕或另一个应用程序，屏幕亮度会保留原始值。</p><p id="cba6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">但是，如果用户通过触摸屏幕手动终止应用程序，屏幕将保持黑暗，因为没有调用<em class="kw"> sceneWillResignActive </em>。这是inpolite。我们将通过在退出前添加另一个对UnDim的调用来解决这个问题。</p><p id="4894" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">找到之前添加的<em class="kw">退出</em>方法，添加调用:</p><pre class="jp jq jr js fd la lb lc ld aw le bi"><span id="0976" class="lf lg hi lb b fi lh li l lj lk">/// Will quit the application with animation</span><span id="4ab5" class="lf lg hi lb b fi ll li l lj lk"><strong class="lb hj">@objc private</strong> <strong class="lb hj">func</strong> quit() {<br/><strong class="lb hj">    DimUnDim.shared.unDim() // Restore normal screen brightness<br/></strong>    UIApplication.shared.perform(<strong class="lb hj">#selector</strong>(NSXPCConnection.suspend))<br/>    /// Sleep for a while to let the app go in background<br/>    sleep(2)<br/>    exit(0)<br/>}</span></pre><p id="1253" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在运行该项目时，屏幕亮度应该完全按照我们需要的方式运行。</p><p id="c332" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">如何禁用射手音</strong></p><ol class=""><li id="392d" class="kd ke hi is b it iu ix iy jb kf jf kg jj kh jn ki kj kk kl bi translated">找到之前添加的空委托方法<em class="kw"> willCapturePhotoFor </em>，并插入以下主体:</li></ol><pre class="jp jq jr js fd la lb lc ld aw le bi"><span id="cd98" class="lf lg hi lb b fi lh li l lj lk"><strong class="lb hj">func</strong> photoOutput(_ output: AVCapturePhotoOutput, willCapturePhotoFor resolvedSettings: AVCaptureResolvedPhotoSettings) {<br/>    // dispose system shutter sound<br/>    AudioServicesDisposeSystemSoundID(1108)<br/>}</span></pre><p id="2e3e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">上面的方法是从下面讨论中的一个答案复制过来的:</p><div class="lm ln ez fb lo lp"><a href="https://stackoverflow.com/questions/4401232/avfoundation-how-to-turn-off-the-shutter-sound-when-capturestillimageasynchrono" rel="noopener  ugc nofollow" target="_blank"><div class="lq ab dw"><div class="lr ab ls cl cj lt"><h2 class="bd hj fi z dy lu ea eb lv ed ef hh bi translated">AVFoundation，如何在捕捉stillimageasynchronouslyfromconnection时关闭快门声音？</h2><div class="lw l"><h3 class="bd b fi z dy lu ea eb lv ed ef dx translated">我正试图通过AVFoundation从相机中捕捉一个实时预览图像…</h3></div><div class="lx l"><p class="bd b fp z dy lu ea eb lv ed ef dx translated">stackoverflow.com</p></div></div><div class="ly l"><div class="me l ma mb mc ly md io lp"/></div></div></a></div><p id="e5e8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这就是了。</p></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><p id="99b4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">最后注释</strong></p><p id="2ddf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这个项目中展示的拍摄秘密照片的能力违背了当前保护用户隐私的趋势。如前所述，通过控制屏幕亮度，可以将绿色摄像机使用中指示器控制为不可见。苹果可以在未来的iOS版本中阻止这一点。当相机处于活动状态时，崩溃一个试图降低屏幕亮度的应用程序应该没有任何问题(就像我们看到当我们无法产生相机使用描述时，应用程序崩溃一样)。</p><p id="0cda" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">有没有可能创建一个类似的程序来录制视频而不是拍摄静态照片？我不知道，但值得一试。</p></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><p id="030c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">邀请您阅读我的其他帖子:</p><p id="255d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Xcode和CocoaPods:在不同pod的分支之间干净无误的切换</p><p id="396e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae ks" rel="noopener" href="/codex/a-simple-swift-background-timer-bebd36589203">一个简单快捷的后台定时器</a></p></div></div>    
</body>
</html>