<html>
<head>
<title>Flutter Skill Of ThemeExtensions And Material3</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">主题扩展和材料的颤振技巧3</h1>
<blockquote>原文：<a href="https://medium.com/codex/flutter-skill-of-themeextensions-and-material3-3e3e95bf591d?source=collection_archive---------2-----------------------#2022-06-08">https://medium.com/codex/flutter-skill-of-themeextensions-and-material3-3e3e95bf591d?source=collection_archive---------2-----------------------#2022-06-08</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="df66" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du jd je jf jg b"><strong class="ih hj">ThemeExtensions </strong></code><strong class="ih hj"/><code class="du jd je jf jg b"><strong class="ih hj">Material3</strong></code>，它们都是旋舞3的重要组件，我想你可能听说过，但还没用过。</p><h1 id="34dd" class="jh ji hi bd jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke bi translated">主题扩展</h1><p id="f60f" class="pw-post-body-paragraph if ig hi ih b ii kf ik il im kg io ip iq kh is it iu ki iw ix iy kj ja jb jc hb bi translated">相信大家在Flutter中都用过<code class="du jd je jf jg b">Theme</code>。比如可以通过修改全局<code class="du jd je jf jg b">ThemeData</code>来调整一些样式，比如全局去除<code class="du jd je jf jg b">InkWell</code>和<code class="du jd je jf jg b">TextButton</code>的点击效果。</p><pre class="kk kl km kn fd ko jg kp kq aw kr bi"><span id="51d2" class="ks ji hi jg b fi kt ku l kv kw">theme: ThemeData(<br/>   primarySwatch: Colors.blue,<br/>   // remove InkWell  splash  click<br/>   splashFactory: NoSplash.splashFactory,<br/>   // remove InkWell click highlight<br/>   highlightColor: Colors.transparent,<br/>   textButtonTheme: TextButtonThemeData(<br/>     // remove TextButton splash click<br/>     style: ButtonStyle(splashFactory: NoSplash.splashFactory),<br/>   ),<br/>),</span></pre><p id="6ec7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当然，开发者也可以使用<code class="du jd je jf jg b">Theme.of(context)</code>来读取<code class="du jd je jf jg b">ThemeData</code>的一些全局样式，从而使你的Widget配置更加灵活。</p><p id="4900" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是如果<code class="du jd je jf jg b">ThemeData</code>中没有参数，那你需要什么，或者你希望这个参数只被特定的小工具使用？</p><p id="21ba" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">颤振3为我们提供了一个解决方案:</strong> <code class="du jd je jf jg b"><strong class="ih hj">ThemeExtensions</strong></code> <strong class="ih hj">。</strong></p><p id="4533" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">开发人员可以通过继承<code class="du jd je jf jg b">ThemeExtension</code>并覆盖<code class="du jd je jf jg b">copyWith</code>和<code class="du jd je jf jg b">lerp</code>方法来定义扩展的<code class="du jd je jf jg b">ThemeData</code>参数，例如:</p><pre class="kk kl km kn fd ko jg kp kq aw kr bi"><span id="9fa0" class="ks ji hi jg b fi kt ku l kv kw">@immutable<br/>class StatusColors extends ThemeExtension&lt;StatusColors&gt; {</span><span id="4ba3" class="ks ji hi jg b fi kx ku l kv kw">  static const light = StatusColors(open: Colors.green, closed: Colors.red);</span><span id="88fa" class="ks ji hi jg b fi kx ku l kv kw">  static const dark = StatusColors(open: Colors.white, closed: Colors.brown);<br/><br/>  const StatusColors({required this.open, required this.closed});<br/><br/>  final Color? open;<br/>  final Color? closed;<br/><br/>  @override<br/>  StatusColors copyWith({<br/>    Color? success,<br/>    Color? info,<br/>  }) {<br/>    return StatusColors(<br/>      open: success ?? this.open,<br/>      closed: info ?? this.closed,<br/>    );<br/>  }<br/><br/>  @override<br/>  StatusColors lerp(ThemeExtension&lt;StatusColors&gt;? other, double t) {<br/>    if (other is! StatusColors) {<br/>      return this;<br/>    }<br/>    return StatusColors(<br/>      open: Color.lerp(open, other.open, t),<br/>      closed: Color.lerp(closed, other.closed, t),<br/>    );<br/>  }<br/><br/>  @override<br/>  String toString() =&gt; 'StatusColors('<br/>      'open: $open, closed: $closed'<br/>      ')';<br/>}</span></pre><p id="1264" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">之后，您可以将上面的<code class="du jd je jf jg b">StatusColors</code>配置到<code class="du jd je jf jg b">Theme</code>的<code class="du jd je jf jg b">extensions</code>，然后使用<code class="du jd je jf jg b">Theme.of(context).extension&lt;StatusColors&gt;()</code>读取配置的参数。</p><pre class="kk kl km kn fd ko jg kp kq aw kr bi"><span id="0919" class="ks ji hi jg b fi kt ku l kv kw">theme: ThemeData(<br/>  primarySwatch: Colors.blue,<br/>  extensions: &lt;ThemeExtension&lt;dynamic&gt;&gt;[<br/>    StatusColors.light,<br/>  ],<br/>),<br/><br/>·····<br/>  <br/>@override<br/>Widget build(BuildContext context) {<br/><br/>  /// get status color from ThemeExtensions <br/>  final statusColors = Theme.of(context).extension&lt;StatusColors&gt;();<br/>  <br/>  return Scaffold(<br/>    extendBody: true,<br/>    body: Container(<br/>      alignment: Alignment.center,<br/>      child: new ElevatedButton(<br/>          style: TextButton.styleFrom(<br/>            backgroundColor: statusColors?.open,<br/>          ),<br/>          onPressed: () {},<br/>          child: new Text("Button")),<br/>    ),<br/>  );<br/>}</span></pre><p id="8b9d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">很简单，对吧？</p><p id="3de9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过<strong class="ih hj"> </strong> <code class="du jd je jf jg b">ThemeExtensions</code>，第三方包在编写Widget时也可以提供相应的<code class="du jd je jf jg b">ThemeExtensions</code>对象，从而实现更加灵活的样式配置支持。</p><h1 id="707f" class="jh ji hi bd jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke bi translated">材料3</h1><p id="942c" class="pw-post-body-paragraph if ig hi ih b ii kf ik il im kg io ip iq kh is it iu ki iw ix iy kj ja jb jc hb bi translated">Material3是Google在Android 12中提出的新UI设计规范。现在在Flutter 3中，可以通过<code class="du jd je jf jg b">useMaterial3: true</code>打开配置支持。</p><pre class="kk kl km kn fd ko jg kp kq aw kr bi"><span id="ebe5" class="ks ji hi jg b fi kt ku l kv kw">theme: ThemeData(<br/>  primarySwatch: Colors.blue,<br/>  useMaterial3: true,<br/>),</span></pre><p id="4c1a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当然，在你开始<strong class="ih hj"> </strong> Material3之前，你需要对它有一定的了解，因为它对UI风格还是有很大影响的。</p><p id="b153" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如下图所示，在<code class="du jd je jf jg b">primarySwatch: Colors.blue</code>中，<code class="du jd je jf jg b">AppBar</code>、<code class="du jd je jf jg b">Card</code>、<code class="du jd je jf jg b">TextButton</code>和<code class="du jd je jf jg b">ElevatedButton</code>的默认样式不同:</p><figure class="kk kl km kn fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es ky"><img src="../Images/5dd30b945e1a0137436897b7c49a2d3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c6TYC4fWfaxKU8tPjdUNTA.png"/></div></div></figure><p id="7bb0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以看到圆角和默认颜色已经更改。例如:</p><ul class=""><li id="ae0d" class="lg lh hi ih b ii ij im in iq li iu lj iy lk jc ll lm ln lo bi translated">点击效果和默认的<code class="du jd je jf jg b">Dialog</code>样式已经改变</li><li id="e446" class="lg lh hi ih b ii lp im lq iq lr iu ls iy lt jc ll lm ln lo bi translated">Android上默认的列表滚动效果也改变了</li></ul><figure class="kk kl km kn fd kz er es paragraph-image"><div class="er es lu"><img src="../Images/ffde5221537a0bd6ff1eb1ff3d4def2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*1NEniddOAVw7z_W2_jk2xQ.gif"/></div></figure><figure class="kk kl km kn fd kz er es paragraph-image"><div class="er es lu"><img src="../Images/b034f52cfce5b442a81a351042d5c70b.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*zxtz7pFvplVvYmQbJ-f3gQ.gif"/></div></figure><p id="aff0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">目前来看，以下小部件主要受《颤振3》中<code class="du jd je jf jg b">useMaterial3</code>的影响。可以看出，大部分具有交互效果的微件主要受影响:</p><ul class=""><li id="21f3" class="lg lh hi ih b ii ij im in iq li iu lj iy lk jc ll lm ln lo bi translated">[警报对话框]</li><li id="ed29" class="lg lh hi ih b ii lp im lq iq lr iu ls iy lt jc ll lm ln lo bi translated">[应用程序栏]</li><li id="5594" class="lg lh hi ih b ii lp im lq iq lr iu ls iy lt jc ll lm ln lo bi translated">[卡片]</li><li id="cd76" class="lg lh hi ih b ii lp im lq iq lr iu ls iy lt jc ll lm ln lo bi translated">[对话]</li><li id="aab6" class="lg lh hi ih b ii lp im lq iq lr iu ls iy lt jc ll lm ln lo bi translated">[升高按钮]</li><li id="291c" class="lg lh hi ih b ii lp im lq iq lr iu ls iy lt jc ll lm ln lo bi translated">[浮动操作按钮]</li><li id="9d0e" class="lg lh hi ih b ii lp im lq iq lr iu ls iy lt jc ll lm ln lo bi translated">[材料]</li><li id="41c5" class="lg lh hi ih b ii lp im lq iq lr iu ls iy lt jc ll lm ln lo bi translated">[导航栏]</li><li id="2337" class="lg lh hi ih b ii lp im lq iq lr iu ls iy lt jc ll lm ln lo bi translated">[导航轨道]</li><li id="8c29" class="lg lh hi ih b ii lp im lq iq lr iu ls iy lt jc ll lm ln lo bi translated">[大纲按钮]</li><li id="a950" class="lg lh hi ih b ii lp im lq iq lr iu ls iy lt jc ll lm ln lo bi translated">[拉伸光标]</li><li id="5238" class="lg lh hi ih b ii lp im lq iq lr iu ls iy lt jc ll lm ln lo bi translated">[GlowingOverscrollIndicator]</li><li id="6278" class="lg lh hi ih b ii lp im lq iq lr iu ls iy lt jc ll lm ln lo bi translated">[文本按钮]</li></ul><p id="8c5c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">但是Material3和Material2有什么区别呢？</strong></p><p id="8431" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以<code class="du jd je jf jg b">AppBar</code>为例，我们可以看到M2和M3的背景色采集方法是不同的。</p><p id="a4d8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在M3，没有<code class="du jd je jf jg b">Brightness.dark</code>的判定，是否意味着m3不支持暗黑模式？</p><figure class="kk kl km kn fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es lv"><img src="../Images/9364e41d2055eec68fb411c28f695c14.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ARxK2kYvMawYAt5pFLjHFw.png"/></div></div></figure><p id="c0a9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在回答这个问题之前，我们先来看看<code class="du jd je jf jg b">_TokeDefaultsM3</code>有什么特别之处？</p><p id="8d40" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从源代码可以看到，<code class="du jd je jf jg b">_TokeDefaultsM3</code>是脚本自动生成的，当前版本号是<code class="du jd je jf jg b">v0_92</code>，所以m3和M2最大的区别之一就是它的样式代码现在是自动生成的。</p><figure class="kk kl km kn fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es ky"><img src="../Images/d1cac01842816272673e954bc509ce2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mHufG_H8itSd3oQqJwB3Vg.png"/></div></div></figure><p id="3489" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从<a class="ae lw" href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Ftree%2Fca2d60e8e2344d8c0ed938869f7c974cb745e841%2Fdev%2Ftools%2Fgen_defaults%2Flib" rel="noopener ugc nofollow" target="_blank"> gen_defaults </a>可以看出，基本上涉及到的M3都是使用模板从数据下的数据中自动生成的。比如<code class="du jd je jf jg b">Appbar</code>的<code class="du jd je jf jg b">backgroundColor</code>指向<code class="du jd je jf jg b">surface</code>。</p><figure class="kk kl km kn fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es lx"><img src="../Images/14455280d70bac433fb28de6e76d2899.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0wCffZqL5e-x2qDU3e7aEg.png"/></div></div></figure><p id="2f6d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">M3的默认风格之所以不再需要<strong class="ih hj"> </strong> <code class="du jd je jf jg b">Brightness.dark </code>判断，是在M3使用的<strong class="ih hj"> </strong> <code class="du jd je jf jg b">ColorScheme</code>中做出的。</p><figure class="kk kl km kn fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es ly"><img src="../Images/5663a00dd291bd224b3e478a2db44f21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SfKDc4ukZwszcWLWdNDV_w.png"/></div></div></figure><p id="9a05" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">其实</strong> <code class="du jd je jf jg b"><strong class="ih hj">colorScheme</strong></code> <strong class="ih hj">才是旋舞3.0中主题颜色的核心，以后</strong><code class="du jd je jf jg b"><strong class="ih hj">primaryColorBrightness</strong></code><strong class="ih hj"/><code class="du jd je jf jg b"><strong class="ih hj">primarySwatch</strong></code><strong class="ih hj">等参数都会被丢弃。</strong></p><p id="4c89" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，如果你还在使用<code class="du jd je jf jg b">primarySwatch</code>，你将在<code class="du jd je jf jg b">ColorScheme.fromSwatch</code>中使用方法把<code class="du jd je jf jg b">primarySwatch </code>转换成<code class="du jd je jf jg b">ColorScheme</code>。</p><pre class="kk kl km kn fd ko jg kp kq aw kr bi"><span id="b2ca" class="ks ji hi jg b fi kt ku l kv kw">ColorScheme.fromSwatch(<br/>  primarySwatch: primarySwatch,<br/>  primaryColorDark: primaryColorDark,<br/>  accentColor: accentColor,<br/>  cardColor: cardColor,<br/>  backgroundColor: backgroundColor,<br/>  errorColor: errorColor,<br/>  brightness: effectiveBrightness,<br/>);</span></pre><p id="6a7f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此外，还可以使用<code class="du jd je jf jg b">ColorScheme.fromSeed</code>或<code class="du jd je jf jg b">colorSchemeSeed</code>直接在<code class="du jd je jf jg b">ThemeData</code>中配置<code class="du jd je jf jg b">ColorScheme</code>。</p><p id="2b41" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">但是，什么是</strong> <code class="du jd je jf jg b"><strong class="ih hj">ColorScheme</strong></code> <strong class="ih hj">？</strong></p><pre class="kk kl km kn fd ko jg kp kq aw kr bi"><span id="4afa" class="ks ji hi jg b fi kt ku l kv kw">theme: ThemeData(<br/>  colorScheme: ColorScheme.fromSeed(seedColor: Color(0xFF4285F4)),<br/>  useMaterial3: true,<br/>),</span></pre><p id="0ba2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这其实涉及到一个很有意思的知识点:Material3下的HCT颜色包:<a class="ae lw" href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fmaterial-foundation%2Fmaterial-color-utilities" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj">material-color-utilities</strong></a>。</p><p id="05ae" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在Material3中，颜色不是完全按照RGB计算的，而是通过<a class="ae lw" href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fmaterial-foundation%2Fmaterial-color-utilities" rel="noopener ugc nofollow" target="_blank">material-color-utilities</a>进行转换。</p><p id="52ac" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过内部的<code class="du jd je jf jg b">CorePalette</code>对象，RGB将被转换成HCT相关值进行计算和显示。</p><figure class="kk kl km kn fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es ky"><img src="../Images/ab130698c828946f5e887e12fb0de2d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uoa4YswuKQfb4-EkJ2j1nQ.png"/></div></div></figure><p id="f7b4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">HCT实际上是色调、色度和色调的缩写。HCT色彩空间可以通过谷歌的开源<a class="ae lw" href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fmaterial-foundation%2Fmaterial-color-utilities" rel="noopener ugc nofollow" target="_blank">材质-颜色-工具</a>插件轻松访问。</p><p id="5f56" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">目前这个repo支持dart、Java、typescript等语言。此外，c/c++和Object-C也将很快得到支持。</p><figure class="kk kl km kn fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es lz"><img src="../Images/570364fb877a02d0735a39ac64ff400f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y5ujF6GRjKReMxOFPz87_w.png"/></div></div></figure><p id="c6c2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">受益于HCT，<code class="du jd je jf jg b">ColorScheme.fromSeed(seedColor: Color(0xFF4285F4)) </code>可以通过一个seedcolor直接生成一系列主题色，这也是material3可以有更多主题色的原因。</p><figure class="kk kl km kn fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es ly"><img src="../Images/68da61fb6839b8fc9f4ba734899676d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jbFuouj417iRc5Hsxg227w.png"/></div></div></figure><blockquote class="ma mb mc"><p id="392a" class="if ig md ih b ii ij ik il im in io ip me ir is it mf iv iw ix mg iz ja jb jc hb bi translated"><a class="ae lw" href="https://material.io/blog/science-of-color-design" rel="noopener ugc nofollow" target="_blank">https://material.io/blog/science-of-color-design</a></p></blockquote><p id="9a30" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">好了，现在你可以问你的设计师:你知道HCT是什么吗？</p></div></div>    
</body>
</html>