<html>
<head>
<title>Securing Your Linux Server Part II</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">保护您的Linux服务器第二部分</h1>
<blockquote>原文：<a href="https://medium.com/codex/securing-your-linux-server-part-ii-48e45c581931?source=collection_archive---------1-----------------------#2022-02-25">https://medium.com/codex/securing-your-linux-server-part-ii-48e45c581931?source=collection_archive---------1-----------------------#2022-02-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/7c4c107f5cb9c1ae1d15b61f8b4bddaa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*FVO5B1FXDpRptnBD"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">加布里埃尔·海因策在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="d875" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们已经阅读了不同类型的对策，我们可以采取，以保护我们的服务器。我们可以采取一些不同的对策，我们将在博客中讨论这些对策。所以，这是保护您的Linux服务器系列的第二部分。如果你还没有看完第一部，你可以在这里看一下<a class="ae iu" rel="noopener" href="/codex/securing-your-linux-server-with-these-best-practices-50b30e026bd">。</a></p><p id="455f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这一部分更倾向于保护您的敏感文件、加密、放弃传统的密码机制，并揭示日志文件及其服务的目的。我们来讨论那些有很大解释的。</p><p id="5140" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">加密敏感文件</strong></p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jt"><img src="../Images/d014a0eee98d507db58a8612616e93c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3LUDEIK5T4EzGU0SslcLUg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated"><a class="ae iu" href="https://cheapsslsecurity.com/blog/what-is-asymmetric-encryption-understand-with-simple-examples/" rel="noopener ugc nofollow" target="_blank">来源</a></figcaption></figure><p id="fd2a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">什么被归类为敏感文件？它是包含重要信息的任何文件。它可能是你的密码，数字钱包的种子短语，你的雇员的个人身份信息，SSH密钥，等等。以及任何其他需要保护的信息。</p><p id="eb4a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果有人能够绕过安全控制，攻击者要做的下一件事就是保持持久性，他应该通过创建帐户或寻找密码、破解SSH密钥来做到这一点。这样做是为了确保即使他的连接中断或您的服务器关闭，他也可以再次访问，而不必侵入。他要做的下一件事是寻找敏感文件，并把它们泄露出去。</p><p id="1df1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这就是你加密敏感文件的原因。关于加密的基础，你可以在这里查看我们的博客文章<a class="ae iu" rel="noopener" href="/codex/learning-about-encryption-encoding-and-hashing-966f992899e3"/>。对于这篇博文，我们将执行对称加密。对称加密只需要一个用于加密和解密的密钥。</p><p id="da5f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们将使用<strong class="ix hj"> GNU Privacy Guard (GPG) </strong>，它被广泛用于通过使用不对称和对称系统来加密和解密电子邮件。</p><ol class=""><li id="acc4" class="jy jz hi ix b iy iz jc jd jg ka jk kb jo kc js kd ke kf kg bi translated">假设您有一个想要加密的名为sensitive.txt的文件。</li></ol><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kh"><img src="../Images/4f24e97c5fb0d0287436f88b5d3c4376.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wsjXRzVOgQLf4viQknNu7A.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">sensitive.txt文件的内容</figcaption></figure><p id="d693" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">2.我们将从生成密钥开始。</p><pre class="ju jv jw jx fd ki kj kk kl aw km bi"><span id="b7a8" class="kn ko hi kj b fi kp kq l kr ks">gpg --gen-key</span></pre><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kt"><img src="../Images/04620c0400c8111d5c7304e92d468033.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YLuseEAOhfqMWczLJRkW-w.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">生成密钥</figcaption></figure><p id="b325" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">3.输入真实姓名和电子邮件地址。记住真实的名字，因为你需要它来加密文件。(我用过<strong class="ix hj">实名1 </strong>)</p><p id="83c0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">4.您将被进一步要求输入密码短语；通行短语可以被视为密码。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es ku"><img src="../Images/1747f051c239239b9cf47d88eab535da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1356/format:webp/1*RBMbBMHPtjlqcjtu-OD1sg.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">输入密码短语</figcaption></figure><p id="cc52" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">5.要检查您生成的密钥，您可以通过以下方式进行检查</p><pre class="ju jv jw jx fd ki kj kk kl aw km bi"><span id="cb74" class="kn ko hi kj b fi kp kq l kr ks">gpg --list-keys</span></pre><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kv"><img src="../Images/d7d3b57c7ed74ede370c04fd08002a42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t3duMObr_DJTrSqxtgw0Iw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">列表键</figcaption></figure><p id="915d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">6.要加密文件，您需要输入用户名。<em class="kw">正如你所记得的，我们使用了Realname1 </em></p><pre class="ju jv jw jx fd ki kj kk kl aw km bi"><span id="de32" class="kn ko hi kj b fi kp kq l kr ks">gpg -e -r Realname1 sensitive.txt</span></pre><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kh"><img src="../Images/f64b856c06bb3d81692f7a8e1d0ec615.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2eszmTpDZbajFDxOcLIvZA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">加密文件</figcaption></figure><p id="8597" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">7.此参数生成一个带有。gpg已附加。原始文件不会被删除，因此您可能需要删除它。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kh"><img src="../Images/df7b8410339b7def415a0f192a107ea0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cucLc_NccMIWLK8Xpvya1Q.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">加密文件已创建</figcaption></figure><p id="69f1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">8.现在，如果攻击者破坏了系统，他将只能看到sensitive.txt.gpg文件，这是一个加密文件。如果他想检查内容，他只会看到一些随机的文本</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kx"><img src="../Images/fa561cd90581ac08fb5866f4e280dabe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VhiHpwvVHUG-Lnv4X6sQfA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">加密文件的内容。</figcaption></figure><p id="05e2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">9.如果你想解密文件，你可以这样做</p><pre class="ju jv jw jx fd ki kj kk kl aw km bi"><span id="ec8b" class="kn ko hi kj b fi kp kq l kr ks">gpg -d -o unencrypted.txt sensitive.txt.gpg</span></pre><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ky"><img src="../Images/a96e054dd07a41f62cad27442fe2d93f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y6GUSQAsNhYdBdz-xG1L0A.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">解密文件</figcaption></figure><p id="934d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">10.输入您在设置gpg密钥时使用的密码</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kz"><img src="../Images/1a5213d691284ea27114c4f0eef838c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tfgnYR6CKbiaxQ5WzVFO7A.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">输入密码短语</figcaption></figure><p id="6099" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">11.你可以访问未加密的. txt文件</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kz"><img src="../Images/f121107a7678252a7762cbc3bc960894.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vPoyXVoXW0DLDgxCD-Thzw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">解密文件</figcaption></figure><p id="7dfd" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">禁用SSH用户名和密码登录</strong></p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es la"><img src="../Images/6ce9bd0de67198acd7bfe0419e10cb4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*exwGbo1XczgAKM3JoYxfjw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated"><a class="ae iu" href="https://avocado89.medium.com/remote-login-with-ssh-dbb804f82ebf" rel="noopener">来源</a></figcaption></figure><p id="dc1c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果你在云上或者公司网络上设置了一个Linux服务器，那么你可能会意识到你也可以通过密码SSH进入服务器。许多不同的组织不会改变这种行为，而是使用密码登录到系统，这样他们就可以修改设置。如果这种配置容易受到暴力攻击，这可能是非常有害的，如果使用弱密码，它很容易被暴力破解，攻击者将获得系统的访问权限。</p><p id="1023" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">相反，尝试使用SSH密钥登录系统。</p><p id="2f37" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">要生成SSH密钥对，可以输入</p><pre class="ju jv jw jx fd ki kj kk kl aw km bi"><span id="6f68" class="kn ko hi kj b fi kp kq l kr ks">ssh-keygen</span></pre><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lb"><img src="../Images/0456583e1428a842ea8300171118c415.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JTa9sh00IHyBzxC1sYZPRw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">生成密钥对</figcaption></figure><p id="d9bb" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您可能需要输入密码。因此，下一次使用SSH时，您也必须输入一个密码。身份验证将使用密码短语执行，它作为密码工作，但由于它是一个长字符串，它不能轻易被暴力破解</p><p id="5153" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">默认情况下，SSH密钥存储在。ssh文件夹。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lc"><img src="../Images/b7bfc265cf82047700f640728187d4da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uyvZEjbPEmi3wc6Xb8l2Bg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">SSH密钥存储在。ssh目录</figcaption></figure><p id="596f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，你要做的就是将id_rsa.pub文件复制到authroized_keys文件夹中。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lc"><img src="../Images/caf99468886d7ca63cffc172088092e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uxyxPTtjmUYwIr53b-U3dg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">复制id_rsa.pub到authorized_keys</figcaption></figure><p id="b1a1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在最后一步中，将id_rsa复制到您的本地机器，现在您可以使用它SSH到机器中。</p><p id="64ce" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">完成后，您可以禁用密码登录。</p><p id="90af" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为此，请打开/etc/ssh/sshd_config文件</p><pre class="ju jv jw jx fd ki kj kk kl aw km bi"><span id="3ddc" class="kn ko hi kj b fi kp kq l kr ks">nano /etc/ssh/sshd_config</span></pre><p id="fce0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">向下滚动到显示<strong class="ix hj">密码验证是</strong>的部分，并将其更改为<strong class="ix hj">密码验证号</strong>。此后，密码身份验证将被禁用，任何人都无法使用密码登录系统。</p><p id="2ca2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">日志记录和审计</strong></p><p id="b83f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">一旦你的机器暴露在公共互联网上，对手就会盯上它，尤其是当它托管一个应用程序或网站时。因此，启用日志记录并关注日志文件非常重要。它们很繁琐，但可以给你很多有价值的信息，如网站上可能发生的攻击，如果有人试图进行端口扫描，如果有人试图爬网站，它会记录一切。</p><p id="981f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">默认的日志目录是/var/log，基于应用程序、web服务器、反向代理等。它会在这个目录中创建自己的文件夹。要查看Apache日志文件，可以查看/var/log/apache2/access.log文件。</p><pre class="ju jv jw jx fd ki kj kk kl aw km bi"><span id="70ab" class="kn ko hi kj b fi kp kq l kr ks">nano /var/log/apache2/access.log</span></pre><p id="5c16" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">同样，您安装的其他应用程序也会有日志文件。</p><p id="826b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">结论</strong></p><p id="c73c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">从初学者的角度来看，这些是可以用来加强Linux服务器安全性的一些方法。如果是高级用户，也可以尝试使用iptables和ufw来创建防火墙规则。<strong class="ix hj"> ufw </strong>代表简单防火墙。您可以使用它来阻止端口、应用规则以及只接受来自您信任的IP地址的流量。这只是冰山的一角。借助iptables和ufw可以完成很多事情。您还可以在Linux中部署IDS、IPS和其他安全控制，因为Linux是开源的，您可以做很多事情。</p><p id="b1d3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">可以安装类似Fail2Ban的服务来专门防止对系统的暴力攻击。Fail2Ban可以配置和设置为与任何服务一起运行，它会根据其规则自动阻止暴力攻击。</p></div></div>    
</body>
</html>