<html>
<head>
<title>How to implement read receipts in Sendbird Chat</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Sendbird聊天中实现阅读回执</h1>
<blockquote>原文：<a href="https://medium.com/codex/how-to-implement-read-receipts-in-sendbird-chat-300eb1e53ad6?source=collection_archive---------14-----------------------#2022-04-05">https://medium.com/codex/how-to-implement-read-receipts-in-sendbird-chat-300eb1e53ad6?source=collection_archive---------14-----------------------#2022-04-05</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/ac0622587d8a44bf01ebe9898413289d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*QZTZAZw4OTDHh_Jy.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">仙鸟2022</figcaption></figure><div class=""/><div class=""><h2 id="c2ee" class="pw-subtitle-paragraph iu hw hx bd b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl dx translated">关于如何在聊天应用程序中实现阅读回执的分步指南</h2></div><p id="a494" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">杰森·奥尔肖恩<br/>解决方案工程师| <a class="ae ki" href="https://www.sendbird.com" rel="noopener ugc nofollow" target="_blank">森伯德</a></p><p id="1903" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated"><em class="kj">关于本教程的其他指导，请参考</em> <a class="ae ki" href="https://sendbird.com/docs/chat/v3/javascript/guides/group-channel-advanced#2-mark-messages-as-read" rel="noopener ugc nofollow" target="_blank"> <em class="kj">文档</em> </a> <em class="kj">。不要忘记查看我们的应用内聊天的</em> <a class="ae ki" href="https://sendbird.com/demos/in-app-chat" rel="noopener ugc nofollow" target="_blank"> <em class="kj">演示</em> </a> <em class="kj">，以获得完全构建的</em> <a class="ae ki" href="https://sendbird.com/features/chat-messaging" rel="noopener ugc nofollow" target="_blank"> <em class="kj">仙鸟聊天</em> </a> <em class="kj">的示例。</em></p><blockquote class="kk kl km"><p id="abce" class="jm jn kj jo b jp jq iy jr js jt jb ju kn jw jx jy ko ka kb kc kp ke kf kg kh hb bi translated"><em class="hx">成为第一个了解新教程、开发者相关聊天/电话发布以及其他重要更新的人，</em> <a class="ae ki" href="https://get.sendbird.com/dev-newsletter-subscription.html" rel="noopener ugc nofollow" target="_blank"> <em class="hx">注册</em> </a> <em class="hx">订阅我们的开发者简讯。</em></p></blockquote><h1 id="a185" class="kq kr hx bd ks kt ku kv kw kx ky kz la jd lb je lc jg ld jh le jj lf jk lg lh bi translated">介绍</h1><p id="f151" class="pw-post-body-paragraph jm jn hx jo b jp li iy jr js lj jb ju jv lk jx jy jz ll kb kc kd lm kf kg kh hb bi translated">在本教程中，您将学习如何实现Sendbird Chat的一项高级功能——实现阅读回执。在深入实现细节之前，我们将首先理解已读回执的技术概念，并探索相关的用例。</p><p id="e16f" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">本教程结束时，您将:</p><ol class=""><li id="d77d" class="ln lo hx jo b jp jq js jt jv lp jz lq kd lr kh ls lt lu lv bi translated">了解什么是已读回执以及它们在Sendbird中如何工作</li><li id="f975" class="ln lo hx jo b jp lw js lx jv ly jz lz kd ma kh ls lt lu lv bi translated">在聊天应用程序中实现已读回执</li></ol><p id="e011" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">请注意，本教程假设您事先了解如何通过Sendbird的SDK发送和接收消息。为了从本教程中获得最大收益，您还应该熟悉基本的JavaScript。</p><p id="9f0e" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">我们开始吧！💻</p><h1 id="8169" class="kq kr hx bd ks kt ku kv kw kx ky kz la jd lb je lc jg ld jh le jj lf jk lg lh bi translated">Sendbird中的已读回执是什么？</h1><p id="4e56" class="pw-post-body-paragraph jm jn hx jo b jp li iy jr js lj jb ju jv lk jx jy jz ll kb kc kd lm kf kg kh hb bi translated">简而言之，已读回执让用户知道另一个用户何时跟上了对话。</p><p id="72a7" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated"><strong class="jo hy">阅读回执</strong>被定义为每个用户最后一次阅读群组信道(即一对一或群组对话)中的任何消息的时间戳。已读回执通常显示在邮件列表视图中的单个邮件旁边。</p><figure class="mc md me mf fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mb"><img src="../Images/5aa03a0a0d6800f5ccf9a6e86c659b75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*v6TopEpBiI1Qy2ZD.png"/></div></div></figure><p id="e9a6" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">已读回执的时间戳来自为单个通道成员调用<code class="du mg mh mi mj b">GroupChannel.markAsRead()</code>时的最后一条消息<code class="du mg mh mi mj b">created_at’ </code>时间戳。调用<code class="du mg mh mi mj b">GroupChannel.markAsRead()</code>有一个事件处理程序，当消息被读取时，所有通道成员都可以实时知道。</p><h1 id="b8e1" class="kq kr hx bd ks kt ku kv kw kx ky kz la jd lb je lc jg ld jh le jj lf jk lg lh bi translated">Sendbird中的未读邮件是什么？</h1><p id="429e" class="pw-post-body-paragraph jm jn hx jo b jp li iy jr js lj jb ju jv lk jx jy jz ll kb kc kd lm kf kg kh hb bi translated">在<code class="du mg mh mi mj b">GroupChannel.markAsRead()</code>通话之间的频道中存在的所有消息被定义为未读消息。未读消息计数的正确实现可以让用户轻松导航到自上次交互以来错过的消息。</p><h1 id="5b6e" class="kq kr hx bd ks kt ku kv kw kx ky kz la jd lb je lc jg ld jh le jj lf jk lg lh bi translated">Sendbird中的已读消息是什么？</h1><p id="02c5" class="pw-post-body-paragraph jm jn hx jo b jp li iy jr js lj jb ju jv lk jx jy jz ll kb kc kd lm kf kg kh hb bi translated">当调用<code class="du mg mh mi mj b">markAsRead()</code>方法时，消息被标记为已读。通常，每当一个成员通过从频道列表中进入频道或者将打开的频道的消息视图带到前台来阅读消息时，应用程序就调用<code class="du mg mh mi mj b">markAsRead()</code>。使用消息创建时间和调用<code class="du mg mh mi mj b">markAsRead()</code>的时间计算正在读取的消息。</p><p id="4fe3" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">请注意，单封邮件不会保留阅读时间的信息。</p><h1 id="263b" class="kq kr hx bd ks kt ku kv kw kx ky kz la jd lb je lc jg ld jh le jj lf jk lg lh bi translated">已读回执的使用案例</h1><p id="9cf3" class="pw-post-body-paragraph jm jn hx jo b jp li iy jr js lj jb ju jv lk jx jy jz ll kb kc kd lm kf kg kh hb bi translated">已读回执对于渠道成员数量较少的案例具有特殊价值。例如:</p><ul class=""><li id="7320" class="ln lo hx jo b jp jq js jt jv lp jz lq kd lr kh mk lt lu lv bi translated">具有用户对用户消息传递功能的应用，如游戏应用</li><li id="2700" class="ln lo hx jo b jp lw js lx jv ly jz lz kd ma kh mk lt lu lv bi translated">通过专家或顾问直接与用户沟通的企业，如保健服务人员、财务顾问、客户支持代理、顾问或其他专家</li><li id="fc15" class="ln lo hx jo b jp lw js lx jv ly jz lz kd ma kh mk lt lu lv bi translated">按需服务或任何需要及时交付服务或商品的应用程序</li><li id="f0d0" class="ln lo hx jo b jp lw js lx jv ly jz lz kd ma kh mk lt lu lv bi translated">同行市场，在这里交流是买卖的必要条件</li></ul><p id="509b" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">既然我们已经理解了阅读回执的基础，让我们继续讨论实现细节。</p><h1 id="24f3" class="kq kr hx bd ks kt ku kv kw kx ky kz la jd lb je lc jg ld jh le jj lf jk lg lh bi translated">实施:读取状态</h1><p id="09a1" class="pw-post-body-paragraph jm jn hx jo b jp li iy jr js lj jb ju jv lk jx jy jz ll kb kc kd lm kf kg kh hb bi translated">单个消息的已读状态是一个标记，它可以指示有多少群信道成员没有读过单个消息。</p><p id="5b77" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">示例:</p><p id="f00e" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">下图中的红色数字1表示至少有一个频道成员没有阅读当前用户的消息。</p><figure class="mc md me mf fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mb"><img src="../Images/103c15bd94103d5c154cf986a5c04e8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*xn7-tnzSjj496U2U.png"/></div></div></figure><h2 id="a694" class="ml kr hx bd ks mm mn mo kw mp mq mr la jv ms mt lc jz mu mv le kd mw mx lg my bi translated">步骤1:何时将邮件标记为已读</h2><p id="b1bb" class="pw-post-body-paragraph jm jn hx jo b jp li iy jr js lj jb ju jv lk jx jy jz ll kb kc kd lm kf kg kh hb bi translated">假设用户a向用户b发送了一条消息。在这里，我们将遍历UserB，将UserA的消息标记为已读。</p><ul class=""><li id="5fc2" class="ln lo hx jo b jp jq js jt jv lp jz lq kd lr kh mk lt lu lv bi translated">当用户b打开或刷新单个频道时，调用<code class="du mg mh mi mj b">markAsRead()</code>。</li></ul><p id="c9dc" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">注意:这并不能保证UserB真的看到了所有的消息，就像大多数消息应用的惯例一样。</p><p id="bf79" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated"><a class="ae ki" href="https://sendbird.com/docs/chat/v3/javascript/guides/group-channel#2-retrieve-a-channel-by-url" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy">抓取通道</strong> </a></p><figure class="mc md me mf fd hk"><div class="bz dy l di"><div class="mz na l"/></div></figure><p id="16c5" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated"><a class="ae ki" href="https://sendbird.com/docs/chat/v3/javascript/guides/group-channel#2-refresh-all-data-related-to-a-channel" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy">刷新频道</strong> </a> —即从后台返回频道视图。</p><figure class="mc md me mf fd hk"><div class="bz dy l di"><div class="mz na l"/></div></figure><ul class=""><li id="5239" class="ln lo hx jo b jp jq js jt jv lp jz lq kd lr kh mk lt lu lv bi translated"><code class="du mg mh mi mj b">Call markAsRead()</code>当用户返回到消息视图的底部时。</li><li id="a77c" class="ln lo hx jo b jp lw js lx jv ly jz lz kd ma kh mk lt lu lv bi translated"><code class="du mg mh mi mj b">Call markAsRead()</code>当新消息到达且以下两个条件为真时:</li></ul><ol class=""><li id="6b8a" class="ln lo hx jo b jp jq js jt jv lp jz lq kd lr kh ls lt lu lv bi translated">用户在消息视图中</li><li id="31c5" class="ln lo hx jo b jp lw js lx jv ly jz lz kd ma kh ls lt lu lv bi translated">用户靠近消息视图的底部，并且/或者当收到新消息时，您将它们显示为弹出消息</li></ol><p id="aea5" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated"><code class="du mg mh mi mj b"><a class="ae ki" href="https://sendbird.com/docs/chat/v3/javascript/guides/event-handler#4-list-of-group-channel-events" rel="noopener ugc nofollow" target="_blank"><strong class="jo hy">onMessageReceived()</strong></a></code>事件处理器。</p><figure class="mc md me mf fd hk"><div class="bz dy l di"><div class="mz na l"/></div></figure><ul class=""><li id="2ff9" class="ln lo hx jo b jp jq js jt jv lp jz lq kd lr kh mk lt lu lv bi translated">用户发消息时调用<code class="du mg mh mi mj b">markAsRead()</code>。</li></ul><p id="dd9e" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated"><a class="ae ki" href="https://sendbird.com/docs/chat/v3/javascript/guides/group-channel#2-send-a-message" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy">发送消息</strong> </a></p><figure class="mc md me mf fd hk"><div class="bz dy l di"><div class="mz na l"/></div></figure><p id="4859" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">注意:在消息视图中向上滚动时，不要调用<code class="du mg mh mi mj b">markAsRead()</code>。这是一个常见的错误，会导致速率限制。单封邮件不需要标记为已读。相反，Sendbird会自动将以前的邮件标记为已读。</p><h2 id="c544" class="ml kr hx bd ks mm mn mo kw mp mq mr la jv ms mt lc jz mu mv le kd mw mx lg my bi translated">步骤2:接收消息已被阅读的websocket事件:UserB</h2><p id="d73d" class="pw-post-body-paragraph jm jn hx jo b jp li iy jr js lj jb ju jv lk jx jy jz ll kb kc kd lm kf kg kh hb bi translated">Sendbird提供了一个通道事件监听器，它为除了调用<code class="du mg mh mi mj b">markAsRead()</code>的用户之外的所有通道成员触发。这个事件就是<code class="du mg mh mi mj b">onReadReceiptUpdated()</code>。UserB可以侦听该事件，然后确定有多少通道成员读取了该消息。<code class="du mg mh mi mj b">onReadReceiptUpdated()</code>处理程序传递一个通道参数，而不是一条消息。</p><p id="b0e1" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">将消息传递到<code class="du mg mh mi mj b"><a class="ae ki" href="https://sendbird.com/docs/chat/v3/javascript/guides/group-channel-advanced#2-retrieve-members-who-have-read-a-message" rel="noopener ugc nofollow" target="_blank"><strong class="jo hy">getReadMembers()</strong></a></code>中，让其他通道成员阅读该消息。</p><figure class="mc md me mf fd hk"><div class="bz dy l di"><div class="mz na l"/></div></figure><p id="fe84" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">对于传递给<code class="du mg mh mi mj b">getReadMembers()</code>的每条消息，都会创建一个用户对象数组，其中包含所有阅读过该消息的通道成员。</p><figure class="mc md me mf fd hk"><div class="bz dy l di"><div class="mz na l"/></div></figure><p id="660b" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">阅读消息的成员列表可用后，考虑在消息视图中更新消息对象UI。常见的例子包括:</p><ul class=""><li id="56ec" class="ln lo hx jo b jp jq js jt jv lp jz lq kd lr kh mk lt lu lv bi translated">显示递减数字(总通道成员数减去读取成员数)→卡考</li><li id="657c" class="ln lo hx jo b jp lw js lx jv ly jz lz kd ma kh mk lt lu lv bi translated">将灰色勾号转换为蓝色勾号→ WhatsApp</li><li id="0bd1" class="ln lo hx jo b jp lw js lx jv ly jz lz kd ma kh mk lt lu lv bi translated">添加带有“查看者”详细信息的小用户图标→脸书信使</li></ul><h2 id="611b" class="ml kr hx bd ks mm mn mo kw mp mq mr la jv ms mt lc jz mu mv le kd mw mx lg my bi translated">步骤3:当用户b返回到消息视图时，检查消息是否已被阅读</h2><p id="a0f5" class="pw-post-body-paragraph jm jn hx jo b jp li iy jr js lj jb ju jv lk jx jy jz ll kb kc kd lm kf kg kh hb bi translated">简而言之，将消息提取到视图中，然后通过<code class="du mg mh mi mj b">groupChannel.getReadMembers(MESSAGE)</code>迭代它们。</p><p id="d274" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated"><a class="ae ki" href="https://sendbird.com/docs/chat/v3/javascript/guides/group-channel#2-load-previous-messages" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy">加载以前的消息</strong> </a> —获取新消息时:</p><figure class="mc md me mf fd hk"><div class="bz dy l di"><div class="mz na l"/></div></figure><h1 id="2763" class="kq kr hx bd ks kt ku kv kw kx ky kz la jd lb je lc jg ld jh le jj lf jk lg lh bi translated">结论</h1><p id="c5f3" class="pw-post-body-paragraph jm jn hx jo b jp li iy jr js lj jb ju jv lk jx jy jz ll kb kc kd lm kf kg kh hb bi translated">在本教程中，我们探讨了阅读回执及其用途。我们已经看到了如何在聊天应用程序中实现阅读回执，以及相关的代码示例。</p><p id="8ede" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">要深入了解这个话题，请查看我们的博客。你可以阅读<a class="ae ki" href="https://sendbird.com/docs/chat/v3/javascript/guides/group-channel-advanced#2-mark-messages-as-read" rel="noopener ugc nofollow" target="_blank"> JavaScript </a>、<a class="ae ki" href="https://sendbird.com/docs/chat/v3/android/guides/group-channel-advanced#2-mark-messages-as-read" rel="noopener ugc nofollow" target="_blank"> Android </a>、<a class="ae ki" href="https://sendbird.com/docs/chat/v3/ios/guides/group-channel-advanced#2-mark-messages-as-read" rel="noopener ugc nofollow" target="_blank"> iOS </a>的进一步实现细节。</p><p id="fd04" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">您现在是在聊天应用程序中实现已读回执的专家了！恭喜恭喜，聊楼愉快！✌</p></div></div>    
</body>
</html>