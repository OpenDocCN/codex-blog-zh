<html>
<head>
<title>Modern data stack for startups</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">面向初创企业的现代数据堆栈</h1>
<blockquote>原文：<a href="https://medium.com/codex/modern-data-stack-for-startups-f4ca4693b2db?source=collection_archive---------0-----------------------#2022-04-21">https://medium.com/codex/modern-data-stack-for-startups-f4ca4693b2db?source=collection_archive---------0-----------------------#2022-04-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="f84c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如今，对高绩效公司来说，轻松获取数据是重中之重。</p><p id="bd84" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然而，轻松访问并不是免费的:它需要投资和仔细选择工具。对于我们这样的年轻公司，问题是多少？你什么时候进行投资？</p><p id="585b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">发展到10个人，其中几个没有工程背景，但有强烈的数据需求，我们决定2022年就是那个时候。</p><p id="fa0e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">经过两周的实验和几次公司研讨会后，我们对自己的成果非常满意。如果您是一家有类似需求的公司，并且关心所有人的数据访问，请遵循本指南，我们保证您会获得很好的结果。</p><ul class=""><li id="96e1" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">架构概述</li><li id="4c46" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">提取:Fivetran和Stitch</li><li id="f205" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">为什么是两个工具？</li><li id="fd24" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">转换:dbt</li><li id="28e6" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">我应该使用什么数据？</li><li id="bbee" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">维度(dim)和事实(fct)表</li><li id="9a09" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">临时(stg)表</li><li id="97ce" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">使用dbt</li><li id="aef5" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">可视化:元数据库</li><li id="9deb" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">将dbt模式同步到元数据库</li><li id="8074" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">入职和推广</li><li id="b05e" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">离别的思绪</li></ul><h1 id="2873" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">架构概述</h1><p id="889f" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">随着数据仓库解决方案(<a class="ae ku" href="https://cloud.google.com/bigquery" rel="noopener ugc nofollow" target="_blank"> BigQuery </a>、<a class="ae ku" href="https://www.snowflake.com/" rel="noopener ugc nofollow" target="_blank">雪花</a>、<a class="ae ku" href="https://aws.amazon.com/redshift/" rel="noopener ugc nofollow" target="_blank">红移</a>)成为主流，现代数据堆栈变得越来越乏味——如果你是从零开始，这是个好消息！</p><p id="cf65" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一般来说，您需要:</p><ul class=""><li id="b815" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">从各种工具(您的CRM、会计平台等)中提取数据到数据仓库中</li><li id="fdf6" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">对源数据集执行数据清理和转换</li><li id="c8a2" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">找到一个可以利用仓库进行探索和洞察的可视化工具</li></ul><p id="aa0e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">找到互补的工具是困难的，我们与几家公司的数据工程师进行了交谈，以找出哪些工具适合他们(哪些不适合)。我们到达了下面的堆栈:</p><figure class="kw kx ky kz fd la er es paragraph-image"><div class="er es kv"><img src="../Images/c485c814301d684b358fabf02ee85a63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/0*xOPSvqVmzNgne-Zp.png"/></div></figure><p id="4533" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在左边，你会看到数据源(只是一个例子，我们有更多的数据)，我们生成和处理数据的工具。其中一个是Product，Postgres数据库支持<a class="ae ku" href="https://incident.io/" rel="noopener ugc nofollow" target="_blank"> incident.io </a>，而<a class="ae ku" href="https://www.intercom.com/" rel="noopener ugc nofollow" target="_blank"> Intercom </a>和<a class="ae ku" href="https://close.com/" rel="noopener ugc nofollow" target="_blank"> Close </a>是我们用来运营业务的SaaS。</p><p id="4b8e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae ku" href="https://fivetran.com/" rel="noopener ugc nofollow" target="_blank"> Fivetran </a>和<a class="ae ku" href="https://www.stitchdata.com/" rel="noopener ugc nofollow" target="_blank"> Stitch </a>都是ETL工具，用于将数据从各种来源传输到目的地。我们使用这两者将数据加载到我们的数据仓库BigQuery中。</p><p id="e46e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在BigQuery中，我们使用一个叫做<a class="ae ku" href="https://www.getdbt.com/" rel="noopener ugc nofollow" target="_blank"> dbt </a>的工具清理和转换数据。这使我们能够将原始源数据转换成理想的“数据仓库原生”格式，以便于分析。</p><p id="2c33" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，<a class="ae ku" href="https://www.metabase.com/" rel="noopener ugc nofollow" target="_blank"> Metabase </a>提供了一个可视化和分析层，针对BigQuery运行查询。</p><p id="0b52" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">就是这样，整个数据堆栈。我们认为这些工具是我们将incident.io发展成为一个更大的公司所需要的，并且给出了我们的一个目标(总是，为了一切！)很简单，我们很高兴列表很小。</p><p id="3d86" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们更详细地看看这是如何工作的。</p><h1 id="dd36" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">提取:Fivetran和Stitch</h1><p id="2ffa" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">现代公司通过越来越多的工具产生大量数据。</p><p id="cc41" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">虽然每个工具都提供了其数据的自定义视图，但我坚信组合数据集比其各部分的总和释放出更多的价值。我们通过将数据整合到一个仓库中来实现这一点，这意味着我们可以跨所有工具进行查询，并构建以有趣的方式组合数据的洞察力。</p><p id="f9a1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">过去，公司会编写他们自己的hacky脚本来执行这种提取——我在过去遇到过ETL数据库触发器引起的可怕事件，甚至<a class="ae ku" href="https://github.com/lawrencejones/pgsink" rel="noopener ugc nofollow" target="_blank">自己也构建了一些</a>通用ETL工具。</p><p id="cee8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从经验来看，相信我，当我说你不想建立这些。谢天谢地，ETL产品如<a class="ae ku" href="https://fivetran.com/" rel="noopener ugc nofollow" target="_blank"> Fivetran </a>和<a class="ae ku" href="https://www.stitchdata.com/" rel="noopener ugc nofollow" target="_blank"> Stitch </a>为您运行和维护这些提取过程。</p><p id="5252" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在Fivetran和Stitch中，过程是相同的:</p><ul class=""><li id="720f" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">选择连接器以访问源数据(您的Postgres数据库或CRM)</li><li id="daf3" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">使用身份验证对其进行配置，并选择要同步的数据</li><li id="f357" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">将数据推入仓库，通常在特定于源的数据集下</li></ul><p id="31f3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是我们在Fivetran中配置的连接器的视图:</p><figure class="kw kx ky kz fd la er es paragraph-image"><div class="er es kv"><img src="../Images/5d6f3050ae1d1953f6304f4e519ce743.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/0*_vb9HUsmaUqFUyTK.png"/></div></figure><p id="ffc5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">值得注意的是来源的多样性。如果您正在构建一个SaaS产品，最重要的数据源之一将是为您的产品提供支持的数据库。<a class="ae ku" href="http://incident.io/" rel="noopener ugc nofollow" target="_blank"> incident.io </a>有一个由Postgres支持的单片应用程序，我们在其中存储如下表格:</p><ul class=""><li id="05cd" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated"><code class="du ld le lf lg b">organisations</code>，使用产品的每个组织占一行</li><li id="f284" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated"><code class="du ld le lf lg b">users</code>，一个组织的每个用户</li><li id="60b1" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated"><code class="du ld le lf lg b">incidents</code>，管理产品中的每一个事件</li></ul><p id="a137" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这些数据实际上是我们的产品，而你的同类产品可能是你仓库中价值最高的数据资产。</p><p id="b98b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你的数据库将限制你如何复制这些数据，但是Fivetran提供了覆盖大多数情况的连接器——例如，我们的<a class="ae ku" href="https://fivetran.com/docs/databases/postgresql#logicalreplication" rel="noopener ugc nofollow" target="_blank"> Heroku Postgres缺乏逻辑复制支持</a>，所以Fivetran退回到<a class="ae ku" href="https://fivetran.com/docs/databases/postgresql#xminsystemcolumn" rel="noopener ugc nofollow" target="_blank">定期扫描表并使用xmin作为光标</a>，而不是读取WAL。</p><p id="d35a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Fivetran将代表您自动管理仓库模式，在目标数据集中为源中的每个表创建表。例如，下面是我们生产数据库中BigQuery数据集的视图:</p><figure class="kw kx ky kz fd la er es paragraph-image"><div class="er es kv"><img src="../Images/6c495d94eadb45678d6797078992fe25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/0*Rgezjw_gKa9Vh9yb.png"/></div></figure><p id="dee6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">像CRM这样的其他数据源将由API访问该工具来提供支持。对于这些连接器，Fivetran将使用每次运行时设置的游标对API资源进行分页，获取这些响应并将它们推送到目的地。</p><p id="af48" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果不做一些额外的工作，这些数据的质量会很低，或者很难使用。将API资源转换成数据仓库格式需要一些人力，这就是我们的转换步骤。</p><h1 id="be2b" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">为什么是两个工具？</h1><p id="871c" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">到目前为止，您可能想知道为什么我们有两个ETL工具。Fivetran看起来很棒，我们就不能用那个吗？</p><p id="218f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">答案是我们愿意，因为Fivetran在我们能够使用它的地方非常出色，价格也非常惊人——我认为我们的所有这些连接器的账单大约是每月100美元，对于我们从中获得的价值来说，这是一笔划算的交易。</p><p id="59c4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然而，我们受到连接器可用性的限制。Stitch是一个类似于Fivetran的产品，但是它是建立在开源的Singer项目上的，这是一个巨大的数据抽头(源)和目标(目的)的集合。</p><p id="9b8a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以Singer为基础技术，Stitch拥有比Fivetran更全面的连接器产品。在这两个工具中，只有Stitch支持<a class="ae ku" href="https://close.com/" rel="noopener ugc nofollow" target="_blank"> Close </a>(我们的CRM)，这意味着我们不得不同时运行这两个产品，即使只是针对一个连接器。</p><p id="8646" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">抛开不便不谈，我认为这是一个不错的策略。ETL工具的目标是将您的数据放入仓库，如果这是以可靠的方式发生的，那么它是如何到达那里的就不太重要了。</p><p id="446a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">出于这个原因，我们的政策是“优先选择Fivetran，否则选择Stitch”。这对我们有用！</p><h1 id="9754" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">转换:dbt</h1><p id="1160" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">现在我们在仓库中有了数据，我们需要将它转换成适当的形式以便查询和分析。这意味着将原始的源数据转化为可识别的业务概念，同时整理ETL过程的工件(删除删除的行等)。</p><p id="2817" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现阶段有一个明显正确的工装选择，就是<a class="ae ku" href="https://www.getdbt.com/" rel="noopener ugc nofollow" target="_blank"> dbt </a>。dbt已经建立了一个庞大的avid数据工程师社区，是处理数据仓库的解决方案，应该与行业的其他部分保持一致。</p><p id="f0f7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">虽然工具选择是显而易见的，但如何使用dbt将是一个更有争议的问题。关于dbt最佳实践，有很多<a class="ae ku" href="https://docs.getdbt.com/docs/guides/best-practices" rel="noopener ugc nofollow" target="_blank">很棒的</a> <a class="ae ku" href="https://github.com/dbt-labs/corp/blob/master/dbt_style_guide.md" rel="noopener ugc nofollow" target="_blank">资源</a>，但是正如你可以从我的<a class="ae ku" href="https://getdbt.slack.com/archives/CBSQTAPLG/p1641890699324300" rel="noopener ugc nofollow" target="_blank">松弛问题</a>中看到的，有足够的模糊性来束缚你。</p><p id="cd99" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们已经实现了一种结构，它最大限度地减少了dbt模型(及其模式文件，这是真正的维护负担)的数量，并根据质量和预期用途对表进行分类。</p><p id="8ece" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以下内容摘自我们的“数据简介”教程:</p><h1 id="1f6b" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">我应该使用什么数据？</h1><p id="a061" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">并非所有的数据都是相同的，了解可以从元数据库查询的不同类型的模型是很有用的，这样您就可以充分利用它。</p><p id="7f6e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，我们希望人们查询的数据是我们从dbt中产生的。dbt生成的所有表都位于元数据库的<code class="du ld le lf lg b">All (dbt)</code>数据集中。</p><p id="39ab" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该数据集包含许多表，每个表将是:</p><ul class=""><li id="26fd" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">Dim尺寸表</li><li id="13d3" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">Fct事实表</li><li id="042b" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">Stg暂存表</li></ul><p id="1c98" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一般来说，更喜欢使用(按此顺序):</p><h1 id="194e" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">维度(dim)和事实(fct)表</h1><p id="682d" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">这些表通常被描述为“集市”，代表关键的业务数据，并且在查询时易于使用。</p><p id="9719" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">尺寸表的一个例子是<code class="du ld le lf lg b">dim_organisations</code>。一般来说，维度表为它们描述的每个实体(例如，一个组织)提供了一个单独的行，并且有大量的列可以用来过滤和分组这些实体。</p><p id="a5ef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们的<code class="du ld le lf lg b">dim_organisations</code>表有如下几列:</p><ul class=""><li id="2fea" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated"><code class="du ld le lf lg b">id</code>和<code class="du ld le lf lg b">name</code>，识别组织</li><li id="041e" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated"><code class="du ld le lf lg b">in_setup_flow</code>，是否已完成设置</li><li id="28eb" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated"><code class="du ld le lf lg b">is_paying</code>，如果存在有效的条带订阅</li><li id="ff9b" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated"><code class="du ld le lf lg b">lead_id</code>，关闭的潜在客户的ID(CRM)</li></ul><p id="504b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请注意，用来自其他来源(如Close)的数据充实组织的大部分艰苦工作已经完成，这使得过滤任何可用维度变得容易，而无需复杂的连接。</p><p id="1d83" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">事实表是维度表的补充，可以看作是发生的事情的列表(也称为“事件流”)。在维度表中每个实体有一行的情况下，您会发现事实表中每个实体都有许多行(事件),并且您需要连接相关的维度表来执行过滤。</p><p id="bdfa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如，我们有一个<code class="du ld le lf lg b">fct_organisation_statistics</code>表。这包含一个组织存在的每一天的一行，以及一些度量，如总空闲用户、事件数、创建事件的用户数等。</p><p id="0529" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这些是我们提供的最高质量的数据表，当它们存在时，您应该更喜欢使用它们。</p><h1 id="4866" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">临时(stg)表</h1><p id="5535" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">Fivetran和Stitch生成的源数据是不稳定的，通常难以使用。</p><p id="db66" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如，源关闭数据没有机会的概念，因为这些机会存在于主数据模型中，并且没有被建模为一级对象。</p><p id="d17a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们没有让人们查询笨拙的源表，而是选择从源数据构建临时表，这些表:</p><ul class=""><li id="96e4" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">将列重命名为一致的(所有真/假列都以<code class="du ld le lf lg b">is_</code>或<code class="du ld le lf lg b">has_</code>开头)</li><li id="760a" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">将列转换为正确的类型(时间戳字符串被解析为时间戳)</li><li id="f458" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">将深度嵌套的数据提取为合适的形式(自定义字段成为列)</li></ul><p id="c98e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以及将源数据转换成查询的“理想”数据所需的任何其他东西。</p><p id="794c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">回到我们最近的例子，我们有以下表格:</p><ul class=""><li id="aa18" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated"><code class="du ld le lf lg b">stg_close__leads</code>清理源销售线索数据，使定制字段易于使用</li><li id="1a36" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated"><code class="du ld le lf lg b">stg_close__opportunities</code>它完全由销售线索来源中的嵌套业务机会数据构建而成，在您想要查询时显示</li></ul><p id="a3c8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当没有可以更好地服务于您的用例的维度或事实表时，退回到暂存数据。</p><h1 id="7146" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">使用dbt</h1><p id="5277" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">最后几节来自我们的数据教程，也是我们如何教授选择正确的数据表。</p><p id="1b09" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这反映了我们构建dbt存储库的方式，这很正常:</p><pre class="kw kx ky kz fd li lg lj lk aw ll bi"><span id="d9fd" class="lm js hi lg b fi ln lo l lp lq">dbt/models<br/>├── marts<br/>│   └── core<br/>│       ├── core.yml<br/>│       ├── dim_incidents.sql<br/>│       ├── dim_organisations.sql<br/>│       ├── dim_users.sql<br/>│       ├── fct_organisation_statistics.sql<br/>│       └── fct_user_incident_graph.sql<br/>└── staging<br/>    ├── close<br/>    │   ├── README.md<br/>    │   ├── src_close.yml<br/>    │   ├── stg_close.yml<br/>    │   ├── stg_close__activities.sql<br/>    │   ├── stg_close__leads.sql<br/>    │   └── stg_close__opportunities.sql<br/>    └── product<br/>        ├── README.md<br/>        ├── src_product.yml<br/>        ├── stg_product.yml<br/>        ├── stg_product__actions.sql<br/>        ├── stg_product__announcement_rules.sql<br/>        ├── ...<br/>        └── stg_product__workflows.sql</span></pre><p id="0250" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当我在快速运行dbt教程时，我很想看看这个结构，给我们朝着正确的方向前进提供一些信心。</p><p id="1c4e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我只是一个业余dbt'ist，有必要注意一下这个结构中的一些决定:</p><ul class=""><li id="686c" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">您将在dbt文献中看到提到的<a class="ae ku" href="https://discourse.getdbt.com/t/how-we-structure-our-dbt-projects/355#but-what-about-base-models-3" rel="noopener ugc nofollow" target="_blank">“基础”表</a>，被描述为源之后的第一次转换，出现在登台之前。我们选择不创建这些，而是直接使用staging表——这避免了维护另一层dbt模式，而且我们的许多数据(尤其是产品)在源代码中接近staging格式。</li><li id="fdc7" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">除非我们跨模式连接它们(就像维度表一样)或者对它们执行复杂的转换(事实表)，否则我们不会从阶段模型中产生集市。同样，这是为了减少dbt模式的数量。</li><li id="72b0" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">我们现在只有核心市场。在我们添加更多的集市之前，实施更复杂的结构(例如将集市归入业务部门)是没有意义的，这样可以更好地适应我们的发展。</li></ul><p id="837f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在针对dbt开发方面，每个工程师都有一个单独的BigQuery数据集(即。他们的目标是在本地开发进行测试。运行一个完整的构建(<code class="du ld le lf lg b">dbt build</code>)现在很快，使得本地开发变得愉快。</p><p id="cd5f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">虽然这种设置使折衷适合于incident.io的上下文，但我认为任何设置数据堆栈的人都可以毫无问题地采用这种设置，而且一旦您更熟悉该工具，就很容易进行调整。</p><h1 id="2188" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">可视化:元数据库</h1><p id="e246" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">现在，我们的数据已经被清理、转换并成形为用于分析的理想格式，是时候选择一个可视化工具了。</p><p id="b21f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这一选择至关重要，因为无论我们选择什么，人们都将如何与我们的数据互动。我们这个堆栈的关键目标之一是让非技术培训人员受益，过去使用Looker等工具的经验表明，只有在BI团队的大力帮助下才有可能实现这一点，这是我们希望避免的。</p><p id="05a1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们选择了<a class="ae ku" href="https://www.metabase.com/" rel="noopener ugc nofollow" target="_blank">元数据库</a>作为最直观的选项，其可视化无需任何SQL知识即可构建。</p><p id="542e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一个工具是否直观是主观的，但Metabase对我来说肯定是这样的。例如，让我们尝试绘制每月创建的事件时间线项目的数量，并看看该流程是什么样的:</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es lr"><img src="../Images/348c48305aa2dfd13a7c84ef8989b23c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*nqk6N6IURsFvac4G.gif"/></div></div></figure><p id="ce54" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意事项:</p><ul class=""><li id="c22c" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">不需要SQL，即使我们从头开始构建可视化(不是从现有的问题)。</li><li id="618c" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">将Stg Product Timeline Items表与Stg Product Organisations连接起来非常容易，部分原因是Metabase可以自动确定连接键(稍后将详细介绍)。</li><li id="600b" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">界面非常干净，比传统的数据工具链更接近向导或现有的电子表格工具。</li></ul><p id="e9f3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所有这些都对入职有很大帮助，特别是对于非技术人员。</p><h1 id="b81a" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">将dbt模式同步到元数据库</h1><p id="217f" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">元数据库确实有助于降低访问数据的障碍，但是它受限于对模式的了解程度。</p><p id="aeca" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在前面的屏幕记录中可以看到一个例子，其中将Stg产品时间表项目与Stg产品组织连接时，会预填充连接键(组织ID)。如果元数据库知道Stg产品时间表项目上的组织ID是Stg产品组织的外键，以及它引用哪个字段，元数据库只能默认此项。</p><p id="c529" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">碰巧的是，我们的dbt模式已经通过列测试知道了这些信息。以下是Stg产品时间表项目的<code class="du ld le lf lg b">organisation_id</code>字段的模式:</p><pre class="kw kx ky kz fd li lg lj lk aw ll bi"><span id="efd9" class="lm js hi lg b fi ln lo l lp lq">---<br/>models:<br/>  - name: stg_product__timeline_items<br/>    columns:<br/>      - name: organisation_id<br/>        description: "Organisation ID"<br/>        tests:<br/>          - not_null<br/>          - relationships:<br/>              to: ref('dim_organisations')<br/>              field: organisation_id</span></pre><p id="f2f8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">每当我们有一个指定关系测试的列时，我们就可以根据父表推断出一个外键关系。</p><p id="8751" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">那么我们如何将它放入元数据库呢？有一个叫做<a class="ae ku" href="https://github.com/gouline/dbt-metabase" rel="noopener ugc nofollow" target="_blank"> dbt-metabase </a>的工具，它可以从dbt模式中推断元数据库语义类型信息，并将其推送到元数据库中——每当完成dbt构建时，我们都会运行这个工具，帮助将元数据库与我们可能添加的任何新字段同步。</p><p id="0173" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">不过，推断外键只是该工具的一种用途——您也可以手动指定列类型。</p><p id="bf87" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">作为有用例子，将列注释为“名称”允许元数据库通过名称值为实体主键提供类型头，例如在客户ID过滤器中使用客户名称。</p><p id="f0bd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面是一个设置类型的示例:</p><pre class="kw kx ky kz fd li lg lj lk aw ll bi"><span id="f52e" class="lm js hi lg b fi ln lo l lp lq">columns:<br/>  - name: name<br/>    decription: "Name of the organisation"<br/>    meta:<br/>      metabase.semantic_type: type/Name<br/>  - name: archived_at<br/>    decription: "When the resource was archived"<br/>    meta:<br/>      metabase.semantic_type: type/DeletionTimestamp<br/>  - name: opportunity_annual_value<br/>    meta:<br/>      metabase.semantic_type: type/Currency<br/>    description: "If an opportunity event, annual value in in normal currency denomination"</span></pre><h1 id="c30a" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">入职和推广</h1><p id="64c9" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">覆盖了整个堆栈。综合报道:</p><ul class=""><li id="3ff7" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated"><a class="ae ku" href="https://fivetran.com/" rel="noopener ugc nofollow" target="_blank"> Fivetran </a>和<a class="ae ku" href="https://www.stitchdata.com/" rel="noopener ugc nofollow" target="_blank"> Stitch </a>将数据提取到<a class="ae ku" href="https://cloud.google.com/bigquery" rel="noopener ugc nofollow" target="_blank"> BigQuery </a>仓库中</li><li id="ec07" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated"><a class="ae ku" href="https://www.getdbt.com/" rel="noopener ugc nofollow" target="_blank"> dbt </a>执行清理和转换以帮助分析</li><li id="9d37" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated"><a class="ae ku" href="https://www.metabase.com/" rel="noopener ugc nofollow" target="_blank">用于可视化的元数据库</a>，带有用于同步模式的[dbt-元数据库][工具/dbt-元数据库]</li></ul><p id="85db" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">花了大约两周的时间才弄清楚这一切，并使用dbt公开了我们的大部分数据源，并在元数据库中公开。那是一个以前从未使用过dbt的工程师，他不得不匆忙做出许多这样的决定。我希望有人按照这个指南可以做得更快。</p><p id="6b3e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦我们建立并运行了堆栈，我们就针对不同的受众举办了两次研讨会:</p><ul class=""><li id="6638" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">dbt简介，面向将构建dbt模型的工程师。</li><li id="c4a0" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">我们还不能雇佣一个全职的BI团队，我们认为我们可以让工程师通过在dbt中定义它们来将更复杂的数据特性呈现给元数据库。这个会议讨论了我们的dbt设置，我们集中讨论了向dbt模型添加一个特性，手动将模式同步到元数据库中。</li><li id="7621" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">面向整个公司的数据介绍。</li><li id="b162" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">每个人都应该在工作中使用数据，所以每个人都需要熟悉元数据库。本次会议包括一个堆栈的纲要，然后作为一个小组工作，以可视化一些关键的业务指标。</li><li id="31ca" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">最后，我们拿出一份我们渴望回答的问题清单，并在我们之间进行分配，让人们两人一组回答这些问题。</li></ul><p id="58e1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">两个研讨会都很棒，但整个公司会议是我最喜欢的。在像我们这样的公司里，两周是漫长的，我的大部分决定都有明确的目标，但经验很少。</p><p id="180c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是一个重要的时刻，当一个没有SQL经验的人向我展示我们产品教程的转换漏斗时，这是完全正确的:</p><h1 id="6813" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">离别的思绪</h1><p id="44f0" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">在大多数公司中，数据是一种货币，每个人都能平等地访问数据是非常重要的。很容易——尤其是当公司以高度技术化的团队开始时——以少数知道所有答案的人结束，破坏了那些团队之外的人的所有权和自主权。</p><p id="b61a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我真的很满意我们目前的设置，主要是因为它提供了我以前从未见过的平等访问。</p><p id="ab83" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，值得重申一点，这一点很容易被忽视:这一堆栈可以轻松地将来自不同来源的数据整合到一个仓库中，这意味着您可以将它组合起来，以释放比数据单独提供时更多的价值。</p><p id="53fb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">连接这些数据意味着您的产品活动可以与您的销售工具相结合，并且您的客户成功报告可以考虑客户通过对讲机联系的频率，或者他们是否拖欠Stripe的款项。</p><p id="5d62" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这篇文章所描述的是利用这一全行业变化的基础。如果你是一家小公司，想要超越自己的能力，不抓住这个机会就是疯了。</p></div></div>    
</body>
</html>