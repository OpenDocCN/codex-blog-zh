<html>
<head>
<title>Building a Cloud Data Warehouse</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建云数据仓库</h1>
<blockquote>原文：<a href="https://medium.com/codex/building-a-cloud-data-warehouse-fd2d7899fdfa?source=collection_archive---------3-----------------------#2021-09-06">https://medium.com/codex/building-a-cloud-data-warehouse-fd2d7899fdfa?source=collection_archive---------3-----------------------#2021-09-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/7bc0260d60fb31a4152c6b21f9435313.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QuClkTOgAO5PN9nV0Qbkqg.png"/></div></div></figure><p id="ac9c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对于数据工程师来说，构建数据仓库是我们所有项目中的常见做法。不幸的是，并不是所有的东西都是独角兽和彩虹，因为在构建几个数据层、ETL过程、再处理方法和一天结束时的业务需求中涉及到大量的工作。</p><p id="87c5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在本文中，我将借助作为创建数据仓库基础的几个数据层来介绍我过去在构建数据仓库方面的一些经验。尽管如此，我还是会尝试一下<strong class="is hj">云</strong>来跟上潮流。</p><h1 id="78ba" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated"><strong class="ak">为什么要利用公共云？</strong></h1><p id="dced" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">云数据仓库使用云提供商分配的空间和计算能力来集成和存储用于分析目的(查询和报告)的数据。</p><ul class=""><li id="68e4" class="kr ks hi is b it iu ix iy jb kt jf ku jj kv jn kw kx ky kz bi translated"><strong class="is hj">可扩展性:</strong>即时放大或缩小。</li><li id="bed5" class="kr ks hi is b it la ix lb jb lc jf ld jj le jn kw kx ky kz bi translated"><strong class="is hj">可用性:</strong>领先云提供商(亚马逊、微软、谷歌)高达99.99%的正常运行时间。</li><li id="62a1" class="kr ks hi is b it la ix lb jb lc jf ld jj le jn kw kx ky kz bi translated"><strong class="is hj">安全性:</strong>云提供商确保基础设施和数据安全。</li><li id="204b" class="kr ks hi is b it la ix lb jb lc jf ld jj le jn kw kx ky kz bi translated"><strong class="is hj">性能:</strong>服务于多个地理位置，表现出出色的查询性能(以秒计)。</li><li id="dba2" class="kr ks hi is b it la ix lb jb lc jf ld jj le jn kw kx ky kz bi translated"><strong class="is hj">性价比:</strong>无硬件相关成本。可能只为使用的存储和计算资源付费(尽管对于企业级应用程序，我不推荐这种按需付费的方法)；</li></ul><h1 id="ce51" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">不同的数据层</h1><p id="a192" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">在我们讨论数据仓库本身之前，我们需要讨论一下基础。也就是说，支持创建数据仓库的层。</p><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lf"><img src="../Images/29a3e7ecebd8b49f81b4781517a1bf3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*htUuI9U5B08D4bGlVLUK6g.png"/></div></div></figure><h1 id="ef3e" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated"><strong class="ak">数据湖和数据质量层</strong></h1><p id="2a29" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">借助现有的技术，我们几乎可以接收所有数据类型(结构化、半结构化、非结构化)。利用公共云存储之一(AWS的S3、Azure的blob存储等)。)我们可以很容易地将这些信息带入我们的“数据湖”。</p><p id="9245" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这个数据湖可以由几层组成，我定义了两层:<strong class="is hj">原始区域</strong>和<strong class="is hj">精选区域</strong>。</p><p id="5ed6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我的建议是将这些层分成文件夹和子文件夹，按照来源、年、月、日、小时等将数据分开。</p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="cb12" class="lp jp hi ll b fi lq lr l ls lt">├── raw_zone<br/>│├── source1<br/>│  ├── 2021<br/>│     ├── 01<br/>│        ├── 01<br/>│           ├── 08<br/>│              ├── tableA_20210101080000.csv<br/>│           └── 09<br/>│              ├── tableA_2021010109.csv<br/>│              ├── tableB_2021010109.csv</span></pre><p id="d92f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">接收原始数据的不利之处在于，它可能具有混乱的格式，包含错误的信息，或者只是不同的数据类型。这就是为什么我们需要在这些原始数据中执行一些概要分析、清理和ETL，这样我们就可以创建一个管理区，利用它来存储所有摄取的数据，这些数据具有正确的质量，并且能够交叉或连接多个数据源，而不会出现不匹配或错误。最后，在相同的存储下(如果我们想的话),它看起来会像这样:</p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="5201" class="lp jp hi ll b fi lq lr l ls lt">├── raw_zone<br/>│├── source1<br/>│  ├── 2021<br/>│     ├── 01<br/>│        ├── 01<br/>│           ├── 08<br/>│              ├── tableA_20210101080000.csv<br/>│           └── 09<br/>│              ├── tableA_2021010109.csv<br/>│              ├── tableB_2021010109.csv<br/>├── curated_zone<br/>│├── source1<br/>│  ├── 2021<br/>│     ├── 01<br/>│        ├── 01<br/>│           ├── 08<br/>│              ├── tableA_cur_20210101080000.csv<br/>│           └── 09<br/>│              ├── tableA_cur_2021010109.csv<br/>│              ├── tableB_cur_2021010109.csv</span></pre><p id="1fd3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">注意:这些文件夹应该由我们的摄取过程创建。它可以是ETL，也可以是PySpark或其他语言。</strong></p><p id="d8b2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">同时，在进行这种清理的同时，我们可以创建数据质量层，这些层可以为仪表板提供信息，从而有效地支持我们的处理和数据纠正流程。</p><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lu"><img src="../Images/86ce6b8d39b4066d4e249f3f535cdbc4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FhffjlBVUnoR4ZdWtCLMJw.png"/></div></div><figcaption class="lv lw et er es lx ly bd b be z dx translated">数据管道的数据质量仪表板示例</figcaption></figure><h1 id="dfdd" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">数据模型和数据仓库</h1><p id="9435" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">为了构建我们的数据仓库，我们需要一个可操作的数据模型作为基础。通常，我们管理的区域有来自一个系统的多种数据——通常可以连接或链接——但是为了简单起见，让我们假设只有一个数据源。</p><figure class="lg lh li lj fd ij er es paragraph-image"><div class="er es lz"><img src="../Images/72ea0afa8e70213d02993fd3042ad28a.png" data-original-src="https://miro.medium.com/v2/resize:fit:986/format:webp/1*gbDMi3OOuWzEFw3oQ1lwSQ.png"/></div><figcaption class="lv lw et er es lx ly bd b be z dx translated">简单操作数据模型</figcaption></figure><p id="eae6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了维护历史数据或跟踪变更，我们可以利用CDC(变更数据捕获)或完整快照。</p><p id="9211" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这意味着我们将只接收更新的或插入的记录，如果不可能，我们需要接收整个表。第一种方法也适用于事件驱动的架构，这意味着每个事件都将是我们的数据模型中的一个新行/有效负载，该数据模型可以分成几个记录并分布在几个表中(如果我们决定从半结构化迁移到关系型)。</p><p id="be3e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">重新处理信息也是可能的，因为我们将把我们的信息捆绑成“日期快照”。在重新处理一天或几天后，我们将使用更新的信息覆盖特定的加载/参考日期，允许完全替换未处理的数据或纠正未被很好地摄取/导出的数据。</p><p id="0f29" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在快速见效的方法中，我们可以利用该模型来提供报告功能，并构建若干运营报告或许多简单指标(例如，账户数量、每个账户的平均交易量、活跃客户数量等)。)但我们的主要目标是实现一个更加非规范化的模型，这将有助于收集见解，并将为业务用户提供访问该模型和进行简单查询的机会(使用自助BI工具)。</p><h2 id="9b12" class="lp jp hi bd jq ma mb mc ju md me mf jy jb mg mh kc jf mi mj kg jj mk ml kk mm bi translated">进入非规范化模型</h2><p id="771a" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">当我们对模型进行反规范化时，它会变得更简单，连接也会变得更灵活，为此我们需要将不同表中的几个列“捆绑”到一个或多个表中，并使信息在几个数据域中保持一致。此外，在我们的列上使用通用术语将有助于交叉过程。</p><p id="7969" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在构建这些术语时，需要记住一些规则:</p><ul class=""><li id="ea0e" class="kr ks hi is b it iu ix iy jb kt jf ku jj kv jn kw kx ky kz bi translated">所有日期列都以DT开头，所有标识符列都以ID开头，等等。</li><li id="ffa8" class="kr ks hi is b it la ix lb jb lc jf ld jj le jn kw kx ky kz bi translated">跨联接列保持相同的名称:</li></ul><figure class="lg lh li lj fd ij er es paragraph-image"><div class="er es mn"><img src="../Images/ccc395fe6da56a75b38bc17a46fceedd.png" data-original-src="https://miro.medium.com/v2/resize:fit:616/format:webp/1*AEb648QDODB--nOB2qPKhA.png"/></div><figcaption class="lv lw et er es lx ly bd b be z dx translated">表之间共享的帐户标识符</figcaption></figure><ul class=""><li id="f8d8" class="kr ks hi is b it iu ix iy jb kt jf ku jj kv jn kw kx ky kz bi translated">我们需要跟踪所有的历史变更吗，还是只需要最新的版本？</li><li id="ba89" class="kr ks hi is b it la ix lb jb lc jf ld jj le jn kw kx ky kz bi translated">隔离大多数更新的列或属性，并将其排除在我们的维度之外。</li><li id="4ebe" class="kr ks hi is b it la ix lb jb lc jf ld jj le jn kw kx ky kz bi translated">不要在我们的表格中过多地放置不需要使用的列。</li></ul><p id="6b4c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在我们最终的数据仓库模型中，我们将有一些看起来更加简洁的东西，这将允许我们探索信息和一些预定义的指标:</p><figure class="lg lh li lj fd ij er es paragraph-image"><div class="er es mo"><img src="../Images/b923c5a262cf6917a67c05c37b6b729c.png" data-original-src="https://miro.medium.com/v2/resize:fit:810/format:webp/1*5qf8GoFY3s-_rRqHaS2s-g.png"/></div><figcaption class="lv lw et er es lx ly bd b be z dx translated">非规范化模型的示例</figcaption></figure><p id="a4ca" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">构建这种模型的主要目标是加速数据的查询和一致性。减少错误数量，使我们能够以更简洁的方式获得数据，并提取一些预先确定的指标或见解，而不会使我们的BI工具在数据处理方面过载。</p><p id="5553" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这在本地数据库上是可行的，但要获得适当的性能，我们需要设置分区、索引，并考虑到编写的每一段代码或过程。有了公共云，我们可以利用它的处理能力:执行数据移动、数据分析、表连接、数据清理等。</p><figure class="lg lh li lj fd ij er es paragraph-image"><div class="er es mp"><img src="../Images/7eca59043da3555f5eeb8d3ffc9fa5e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:610/format:webp/1*F6c3-o1KyWRBE6_szOzB4A.png"/></div><figcaption class="lv lw et er es lx ly bd b be z dx translated">使用云查询引擎的数据流(云数据仓库)</figcaption></figure><p id="cf74" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在我的另一篇<strong class="is hj"> </strong> <a class="ae mq" rel="noopener" href="/codex/architecture-for-iot-and-real-time-data-processing-f0a8c7e63c35"> <strong class="is hj">文章</strong> s </a>中，我提到了几种可以契合云查询引擎目的的技术。</p><figure class="lg lh li lj fd ij er es paragraph-image"><div class="er es mr"><img src="../Images/d7df9da0ae9ef7a92ab202139c051bbc.png" data-original-src="https://miro.medium.com/v2/resize:fit:718/format:webp/1*sKeY-wLkMW94tem0-KS1lQ.png"/></div><figcaption class="lv lw et er es lx ly bd b be z dx translated">查询引擎和数据仓库的例子</figcaption></figure><p id="2db4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">尽管如此，在代码开发和查询性能方面保持良好的实践是强制性的，但在处理大量数据时限制较少。</strong></p><p id="ce91" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">通过这种方式的数据建模，我们将构建一些星型模式或雪花模型，但也可以使用其他方法，如data vault、data lake或lakehouse，用于更敏捷或快速变化的模型。</p><p id="59db" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我不会详细介绍如何构建这样的模型，但我会为那些更好奇的人留下一些链接:</p><ul class=""><li id="377b" class="kr ks hi is b it iu ix iy jb kt jf ku jj kv jn kw kx ky kz bi translated"><a class="ae mq" href="https://towardsdatascience.com/guide-to-data-warehousing-6fdcf30b6fbe#5461" rel="noopener" target="_blank">金博尔方法论</a></li><li id="07a6" class="kr ks hi is b it la ix lb jb lc jf ld jj le jn kw kx ky kz bi translated"><a class="ae mq" href="https://towardsdatascience.com/guide-to-data-warehousing-6fdcf30b6fbe#7e71" rel="noopener" target="_blank">英蒙方法论</a></li><li id="c238" class="kr ks hi is b it la ix lb jb lc jf ld jj le jn kw kx ky kz bi translated"><a class="ae mq" href="https://towardsdatascience.com/guide-to-data-warehousing-6fdcf30b6fbe#9b1c" rel="noopener" target="_blank">数据保险库</a></li><li id="d4f9" class="kr ks hi is b it la ix lb jb lc jf ld jj le jn kw kx ky kz bi translated"><a class="ae mq" href="https://towardsdatascience.com/guide-to-data-warehousing-6fdcf30b6fbe#92fb" rel="noopener" target="_blank">数据湖</a></li><li id="0ad4" class="kr ks hi is b it la ix lb jb lc jf ld jj le jn kw kx ky kz bi translated"><a class="ae mq" href="https://towardsdatascience.com/guide-to-data-warehousing-6fdcf30b6fbe#016b" rel="noopener" target="_blank">湖畔小屋</a></li></ul><p id="6fca" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="ms">免责声明:这篇文章反映了我的观点、经历和建筑观点。因此，应该相应地对待，我知道这是一个可以产生多种讨论的主题。</em></p></div></div>    
</body>
</html>