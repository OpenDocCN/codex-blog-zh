<html>
<head>
<title>How to build a chat app using React Native and Hooks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用React Native和Hooks构建聊天应用</h1>
<blockquote>原文：<a href="https://medium.com/codex/build-a-chat-app-using-react-native-and-hooks-bfc565f8166a?source=collection_archive---------0-----------------------#2021-10-28">https://medium.com/codex/build-a-chat-app-using-react-native-and-hooks-bfc565f8166a?source=collection_archive---------0-----------------------#2021-10-28</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/649b64fe74d7e8a4fc82ed6fd85a5ceb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*gqracC5Vyfz_nJQV.png"/></div></div></figure><div class=""/><p id="cf91" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">作者Walter Rodriguez <br/>解决方案工程师| Sendbird</p><p id="804c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="jo">如果你正在寻找关于Swift、Kotlin、React、Flutter等更多的教程，请查看我们的</em> <a class="ae jp" href="https://sendbird.com/developer/tutorials" rel="noopener ugc nofollow" target="_blank"> <em class="jo">开发者门户</em> </a> <strong class="is hu"> <em class="jo">。</em> </strong></p><ul class=""><li id="a1e3" class="jq jr ht is b it iu ix iy jb js jf jt jj ju jn jv jw jx jy bi translated">在GitHub上下载React Native Hook <a class="ae jp" href="https://github.com/sendbird/sendbird-javascript-samples/tree/master/react-native/react-native-hook" rel="noopener ugc nofollow" target="_blank">示例</a></li><li id="e25d" class="jq jr ht is b it jz ix ka jb kb jf kc jj kd jn jv jw jx jy bi translated">查看JavaScript <a class="ae jp" href="https://sendbird.com/docs/chat/v3/javascript/quickstart/send-first-message#2-get-started" rel="noopener ugc nofollow" target="_blank">文档</a></li><li id="02d4" class="jq jr ht is b it jz ix ka jb kb jf kc jj kd jn jv jw jx jy bi translated">查看Sendbrid聊天<a class="ae jp" href="https://sendbird.com/demos/in-app-chat" rel="noopener ugc nofollow" target="_blank">演示</a></li></ul><h1 id="7dab" class="ke kf ht bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">介绍</h1><p id="53ca" class="pw-post-body-paragraph iq ir ht is b it lc iv iw ix ld iz ja jb le jd je jf lf jh ji jj lg jl jm jn hb bi translated">本教程将向您展示如何使用React Native构建一个消息应用程序。首先，我们将通过理解为什么首先应该使用React Native来为本教程做准备。然后我们将解释React Native Hooks函数，然后深入讨论如何用Sendbird和React Native构建聊天应用程序的实现细节。</p><p id="85df" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">请注意，本教程假设您对React Native有基本的了解。</p><p id="bfcf" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">有关其他有用的资源，请参见我们的<a class="ae jp" href="https://github.com/sendbird/SendBird-JavaScript/tree/master/react-native-hook-sample" rel="noopener ugc nofollow" target="_blank"> React本地聊天示例</a>、<a class="ae jp" href="https://sendbird.com/docs/chat/v3/javascript/quickstart/send-first-message#2-get-started" rel="noopener ugc nofollow" target="_blank"> Javascript Sendbird文档</a>和<a class="ae jp" href="https://sendbird.com/demos/in-app-chat" rel="noopener ugc nofollow" target="_blank"> Sendbird聊天演示</a>。</p><p id="5010" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们开始吧！</p><h1 id="3832" class="ke kf ht bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">为什么反应原生？</h1><p id="8e4f" class="pw-post-body-paragraph iq ir ht is b it lc iv iw ix ld iz ja jb le jd je jf lf jh ji jj lg jl jm jn hb bi translated">如今，大多数应用程序都是本地构建的，但也有使用Webviews开发的混合应用程序。然而，与它们的本地对应物相比，Webviews的属性和特征引入了对应用的限制。使用Webviews的应用程序也比本地应用程序相对较慢。React Native允许应用程序访问本机功能和属性，从而弥补了这一缺陷。</p><p id="9380" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">React Native通过将JavaScript代码和本机代码分离到不同的线程中来实现这一点。它还支持两者之间的异步通信，从而提升应用程序的整体性能。此外，由于React Native使用JavaScript，不熟悉本机应用程序的开发人员可以利用他们现有的知识和经验来减少编码时间。</p><h1 id="8179" class="ke kf ht bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">谁在使用React Native？</h1><p id="c0e0" class="pw-post-body-paragraph iq ir ht is b it lc iv iw ix ld iz ja jb le jd je jf lf jh ji jj lg jl jm jn hb bi translated">由于React Native在代码可重用性、可靠性、健壮性以及有用社区的存在等方面的优势，许多公司，从老牌的财富500强公司到高速发展的初创公司，都使用React Native开发应用程序。一些使用React Native的知名组织包括Instagram、Shopify、Tableau、Tesla、UberEats和Skype。</p><p id="ac1e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们已经理解了基础知识，让我们继续反应本地钩子函数。</p><h1 id="2481" class="ke kf ht bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">什么是React原生钩子函数？</h1><p id="3adb" class="pw-post-body-paragraph iq ir ht is b it lc iv iw ix ld iz ja jb le jd je jf lf jh ji jj lg jl jm jn hb bi translated">挂钩是让您从功能组件“挂钩”到反应状态和生命周期特性的功能。钩子在类内部不起作用——它们让你在没有类的情况下使用React。(我们不建议一夜之间重写现有的组件，但是如果你愿意，你可以在新的组件中使用钩子。)</p><p id="f524" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">React提供了一些内置的钩子，比如<strong class="is hu"> useState </strong>。您还可以创建自己的挂钩，以便在不同组件之间重用有状态行为。我们先来看看内置挂钩。</p><p id="8483" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">更多关于钩子的信息，请查看<a class="ae jp" href="https://reactjs.org/docs/hooks-overview.html" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu"> react站点</strong> </a>。</p><p id="5cbb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在让我们来了解一下如何在您的聊天应用程序中使用Sendbird和Hooks。本教程由另外九个部分组成:</p><ol class=""><li id="1140" class="jq jr ht is b it iu ix iy jb js jf jt jj ju jn lh jw jx jy bi translated">安装React Native</li><li id="3a2f" class="jq jr ht is b it jz ix ka jb kb jf kc jj kd jn lh jw jx jy bi translated">下载Sendbird示例</li><li id="7699" class="jq jr ht is b it jz ix ka jb kb jf kc jj kd jn lh jw jx jy bi translated">排除故障</li><li id="6f06" class="jq jr ht is b it jz ix ka jb kb jf kc jj kd jn lh jw jx jy bi translated">了解文件夹结构</li><li id="c385" class="jq jr ht is b it jz ix ka jb kb jf kc jj kd jn lh jw jx jy bi translated">构建登录组件</li><li id="8077" class="jq jr ht is b it jz ix ka jb kb jf kc jj kd jn lh jw jx jy bi translated">构建频道列表组件</li><li id="135b" class="jq jr ht is b it jz ix ka jb kb jf kc jj kd jn lh jw jx jy bi translated">构建消息组件</li><li id="3288" class="jq jr ht is b it jz ix ka jb kb jf kc jj kd jn lh jw jx jy bi translated">发送和接收消息</li><li id="feac" class="jq jr ht is b it jz ix ka jb kb jf kc jj kd jn lh jw jx jy bi translated">Sendbird的其他功能</li></ol><h1 id="c86b" class="ke kf ht bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">第一步。安装React Native以构建聊天</h1><p id="4f85" class="pw-post-body-paragraph iq ir ht is b it lc iv iw ix ld iz ja jb le jd je jf lf jh ji jj lg jl jm jn hb bi translated">您需要让<strong class="is hu"> React Native CLI </strong>来处理这个例子。请全局安装:</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="6836" class="lr kf ht ln b fi ls lt l lu lv">npm install -g react-native-cli</span></pre><p id="f0a7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">通过显示版本号，您可以快速检查安装是否正确完成:</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="1769" class="lr kf ht ln b fi ls lt l lu lv">react-native --version</span></pre><h1 id="f2eb" class="ke kf ht bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">第二步。下载Sendbird示例</h1><p id="9940" class="pw-post-body-paragraph iq ir ht is b it lc iv iw ix ld iz ja jb le jd je jf lf jh ji jj lg jl jm jn hb bi translated">一旦安装了<strong class="is hu"> React Native CLI </strong>，就可以下载示例代码了。首先克隆存储库:</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="b6b0" class="lr kf ht ln b fi ls lt l lu lv">git clone <a class="ae jp" href="https://github.com/sendbird/SendBird-JavaScript.git" rel="noopener ugc nofollow" target="_blank">https://github.com/sendbird/SendBird-JavaScript.git</a></span></pre><p id="ee6e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后，使用您喜欢的IDE打开以下文件夹:</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="0255" class="lr kf ht ln b fi ls lt l lu lv">./SendBird-JavaScript/react-native-hook-sample/Sendbird</span></pre><p id="68f8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下一步，让我们安装所有的依赖项。运行以下命令:(下载所有包需要一些时间)</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="6878" class="lr kf ht ln b fi ls lt l lu lv">npm i</span></pre><p id="f047" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你可以在Android或者iOS上运行这个。打开package.json文件，检查我们为您准备的脚本:</p><figure class="li lj lk ll fd hk er es paragraph-image"><div class="er es lw"><img src="../Images/89f011a74703a31b01d7166a441d4c17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1304/format:webp/0*WsfmEHYDChC1l7VN.png"/></div><figcaption class="lx ly et er es lz ma bd b be z dx translated">图1:运行Android和iOS版本的脚本</figcaption></figure><p id="eb75" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要运行Android，只需输入:</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="0278" class="lr kf ht ln b fi ls lt l lu lv">npm run android</span></pre><h2 id="59ba" class="lr kf ht bd kg mb mc md kk me mf mg ko jb mh mi ks jf mj mk kw jj ml mm la mn bi translated">Android故障排除</h2><p id="e52f" class="pw-post-body-paragraph iq ir ht is b it lc iv iw ix ld iz ja jb le jd je jf lf jh ji jj lg jl jm jn hb bi translated">如果您在运行Android版本时遇到问题，可以尝试以下方法:</p><ul class=""><li id="642e" class="jq jr ht is b it iu ix iy jb js jf jt jj ju jn jv jw jx jy bi translated">如果你在一个真实的设备上运行，检查是否安装了所有的东西——尤其是Android studio。</li><li id="879e" class="jq jr ht is b it jz ix ka jb kb jf kc jj kd jn jv jw jx jy bi translated">检查adb设备是否可以看到您的设备；有时，它可能不工作或有滞后。在这种情况下，调用adb kill-server，然后调用adb start-server。</li><li id="128d" class="jq jr ht is b it jz ix ka jb kb jf kc jj kd jn jv jw jx jy bi translated">您可能希望使用react-native run-android构建项目。如果失败，您可能需要使用Android studio运行它。</li><li id="0760" class="jq jr ht is b it jz ix ka jb kb jf kc jj kd jn jv jw jx jy bi translated">确保您的ANDROID_HOME在路径中。类似于:</li></ul><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="ad16" class="lr kf ht ln b fi ls lt l lu lv">export ANDROID_HOME=/Users/[your user]/Library/Android/sdk</span></pre><p id="3c7a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对于iOS，您需要安装一次Pods:</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="1962" class="lr kf ht ln b fi ls lt l lu lv">cd ios<br/>pod install<br/>pod update</span></pre><p id="e3a9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这将安装所有库来运行iOS版本。</p><h2 id="867f" class="lr kf ht bd kg mb mc md kk me mf mg ko jb mh mi ks jf mj mk kw jj ml mm la mn bi translated">iOS故障排除</h2><p id="16f2" class="pw-post-body-paragraph iq ir ht is b it lc iv iw ix ld iz ja jb le jd je jf lf jh ji jj lg jl jm jn hb bi translated">如果您在运行iOS版本时遇到问题，可以尝试以下方法:</p><ul class=""><li id="da6d" class="jq jr ht is b it iu ix iy jb js jf jt jj ju jn jv jw jx jy bi translated">进行pod更新，然后从<strong class="is hu"> ios/文件夹</strong>中进行pod安装。</li><li id="ab8c" class="jq jr ht is b it jz ix ka jb kb jf kc jj kd jn jv jw jx jy bi translated">删除<strong class="is hu"> ios/build文件夹。</strong></li><li id="1799" class="jq jr ht is b it jz ix ka jb kb jf kc jj kd jn jv jw jx jy bi translated">最好不要更改XCode中的任何构建阶段、规则或设置，因为这可能会导致进一步的问题。</li><li id="124c" class="jq jr ht is b it jz ix ka jb kb jf kc jj kd jn jv jw jx jy bi translated">最好不要更新<strong class="is hu"> package.json </strong>文件中列出的包或者<strong class="is hu"> ios/Pods </strong>里面的包。这是因为这些是我们测试中使用的版本。</li></ul><h2 id="d1be" class="lr kf ht bd kg mb mc md kk me mf mg ko jb mh mi ks jf mj mk kw jj ml mm la mn bi translated">两个平台的故障排除</h2><ul class=""><li id="dd81" class="jq jr ht is b it lc ix ld jb mo jf mp jj mq jn jv jw jx jy bi translated">确保您没有运行任何VPN。有时这会产生问题。</li><li id="9801" class="jq jr ht is b it jz ix ka jb kb jf kc jj kd jn jv jw jx jy bi translated">如果您正在运行React本机终端窗口，请尝试关闭它，然后再次运行上面的命令。</li><li id="baf7" class="jq jr ht is b it jz ix ka jb kb jf kc jj kd jn jv jw jx jy bi translated">您可以从根目录运行npm run clean。这将清理旧版本。</li><li id="3eb7" class="jq jr ht is b it jz ix ka jb kb jf kc jj kd jn jv jw jx jy bi translated">您可以删除文件<strong class="is hu"> package-lock.json </strong>，并尝试再次运行npm i，但是由于兼容性问题，我们不建议这样做。</li></ul><p id="5e37" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">运行此示例之前，请检查先决条件列表。你可以在这里找到它们<a class="ae jp" href="https://facebook.github.io/react-native/docs/getting-started" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu">。</strong>T13】</a></p><h1 id="6dc1" class="ke kf ht bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">第三步。调试React本地聊天应用程序</h1><p id="e621" class="pw-post-body-paragraph iq ir ht is b it lc iv iw ix ld iz ja jb le jd je jf lf jh ji jj lg jl jm jn hb bi translated">从你的iOS模拟器，你可以调试应用程序，并看到控制台输出到Chrome。按下<strong class="is hu"> Command + D </strong>可以看到如下画面:</p><figure class="li lj lk ll fd hk er es paragraph-image"><div class="er es mr"><img src="../Images/e4051b908e5d087d86af50156e813685.png" data-original-src="https://miro.medium.com/v2/resize:fit:1288/format:webp/0*ZnMW2QyEaIZuAokM.png"/></div><figcaption class="lx ly et er es lz ma bd b be z dx translated">图2:从iOS调试</figcaption></figure><p id="407a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当你点击Chrome中的Debug时，一个Chrome窗口将会打开。使用Chrome开发工具来监控由<strong class="is hu"> console.log() </strong>编写的输出。</p><h1 id="30d6" class="ke kf ht bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">第四步。了解文件夹结构</h1><p id="0916" class="pw-post-body-paragraph iq ir ht is b it lc iv iw ix ld iz ja jb le jd je jf lf jh ji jj lg jl jm jn hb bi translated">以下是对该示例应用程序中最重要的文件和文件夹的描述。</p><h2 id="06e8" class="lr kf ht bd kg mb mc md kk me mf mg ko jb mh mi ks jf mj mk kw jj ml mm la mn bi translated">package.json</h2><p id="bf58" class="pw-post-body-paragraph iq ir ht is b it lc iv iw ix ld iz ja jb le jd je jf lf jh ji jj lg jl jm jn hb bi translated">该文件包含该项目将使用的所有包。由于兼容性问题，我们建议不要更改这些软件包的版本。</p><figure class="li lj lk ll fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ms"><img src="../Images/9c7a30639b92ca55c4323f9fe860c9e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*dDfh7V52tajiDgPn.png"/></div></div><figcaption class="lx ly et er es lz ma bd b be z dx translated">图3:这个示例应用程序的依赖关系</figcaption></figure><p id="29ec" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">该文件还包含您可以运行的脚本:</p><figure class="li lj lk ll fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mt"><img src="../Images/885da7ae5dc32c8188c2f3321a63b4f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*vzKWySGBfdyLqDHt.png"/></div></div><figcaption class="lx ly et er es lz ma bd b be z dx translated">图4:您可以运行的脚本</figcaption></figure><p id="bb0b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">运行npm运行android启动Android版本。</p><p id="469b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">运行npm运行ios以启动iOS版本。</p><p id="e786" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">运行npm run clean以清除任何以前的生成。</p><h2 id="5b5d" class="lr kf ht bd kg mb mc md kk me mf mg ko jb mh mi ks jf mj mk kw jj ml mm la mn bi translated">节点_模块</h2><p id="499e" class="pw-post-body-paragraph iq ir ht is b it lc iv iw ix ld iz ja jb le jd je jf lf jh ji jj lg jl jm jn hb bi translated">此文件夹包含此项目将使用的所有下载的库。每次运行npm i时都会创建该文件夹。</p><h2 id="f7fe" class="lr kf ht bd kg mb mc md kk me mf mg ko jb mh mi ks jf mj mk kw jj ml mm la mn bi translated">机器人</h2><p id="4b43" class="pw-post-body-paragraph iq ir ht is b it lc iv iw ix ld iz ja jb le jd je jf lf jh ji jj lg jl jm jn hb bi translated">这个文件夹包含一个Android项目的所有文件。您可以使用Visual Studio打开并运行该项目。</p><h2 id="c16a" class="lr kf ht bd kg mb mc md kk me mf mg ko jb mh mi ks jf mj mk kw jj ml mm la mn bi translated">ios</h2><p id="3d8a" class="pw-post-body-paragraph iq ir ht is b it lc iv iw ix ld iz ja jb le jd je jf lf jh ji jj lg jl jm jn hb bi translated">该文件夹包含iOS项目的所有文件。可以用Xcode打开。</p><h2 id="e9fe" class="lr kf ht bd kg mb mc md kk me mf mg ko jb mh mi ks jf mj mk kw jj ml mm la mn bi translated">科学研究委员会</h2><p id="e2a1" class="pw-post-body-paragraph iq ir ht is b it lc iv iw ix ld iz ja jb le jd je jf lf jh ji jj lg jl jm jn hb bi translated">该文件夹包含我们的演示应用程序的所有Javascript文件。</p><h2 id="bb86" class="lr kf ht bd kg mb mc md kk me mf mg ko jb mh mi ks jf mj mk kw jj ml mm la mn bi translated">索引. js</h2><p id="f7e9" class="pw-post-body-paragraph iq ir ht is b it lc iv iw ix ld iz ja jb le jd je jf lf jh ji jj lg jl jm jn hb bi translated">这是React Native执行的第一个文件。</p><figure class="li lj lk ll fd hk"><div class="bz dy l di"><div class="mu mv l"/></div></figure><p id="e351" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对于Android设备，我们定义当我们收到推送消息时哪个函数将处理信息。在这个例子中，函数<strong class="is hu"> onRemoteMessage </strong>将完成这项工作。它就在<strong class="is hu">里面。/src/utils utils.js </strong>文件。</p><h2 id="546e" class="lr kf ht bd kg mb mc md kk me mf mg ko jb mh mi ks jf mj mk kw jj ml mm la mn bi translated">App.js</h2><p id="ff7f" class="pw-post-body-paragraph iq ir ht is b it lc iv iw ix ld iz ja jb le jd je jf lf jh ji jj lg jl jm jn hb bi translated">这个文件是从文件<strong class="is hu"> index.js. </strong>中调用的，它显示了用户运行我们的应用程序时看到的第一个屏幕。</p><p id="71cf" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您将看到您的Sendbird应用程序ID(您可以从您的<a class="ae jp" href="https://dashboard.sendbird.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu"> Sendbird仪表板</strong> </a>)的定义位置:</p><figure class="li lj lk ll fd hk"><div class="bz dy l di"><div class="mu mv l"/></div></figure><p id="f685" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们现在准备初始化Sendbird SDK。在这一点上，我们没有联系。</p><figure class="li lj lk ll fd hk"><div class="bz dy l di"><div class="mu mv l"/></div></figure><p id="8b93" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将使用第一个钩子来请求接收通知的许可。</p><p id="7ee4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果我们已经有了一个来自Firebase的令牌，我们使用Sendbird函数<strong class="is hu">registerAPNSPushtokenForCurrentUser</strong>为一个<strong class="is hu"> iOS </strong>设备注册它，为一个<strong class="is hu"> Android </strong>设备注册<strong class="is hu">registergmpushtokenforcurrentuser</strong>。</p><figure class="li lj lk ll fd hk"><div class="bz dy l di"><div class="mu mv l"/></div></figure><p id="34ea" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">关于React Native实现Firebase的详细教程可以在<a class="ae jp" href="https://sendbird.com/docs/chat/v3/javascript/guides/push-notifications#1-push-notifications" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu">这里</strong> </a>获得。</p><p id="99cb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下一步是定义堆栈导航器。堆栈导航器为您的应用程序提供了一种在屏幕之间切换的方式。每个新屏幕都可以放在堆栈的顶部。</p><p id="347a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">默认情况下，堆栈导航器提供了熟悉的iOS和Android外观。在iOS上，新的屏幕从右边滑入，在Android上使用默认的操作系统动画。您可以自定义动画来满足您的需求。</p><figure class="li lj lk ll fd hk"><div class="bz dy l di"><div class="mu mv l"/></div></figure><h1 id="43c0" class="ke kf ht bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">第五步。为React本地聊天应用程序构建登录组件</h1><figure class="li lj lk ll fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mw"><img src="../Images/0dcbe7018bf1ebb9f5523152c03c078f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*SQWBGk9xQiUZGr0l.png"/></div></div><figcaption class="lx ly et er es lz ma bd b be z dx translated">图5:登录窗口</figcaption></figure><p id="1cbb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">堆栈导航器将首先对<strong class="is hu">进行游说。这个文件在<strong class="is hu">里。/src/page/lobby.js </strong>。</strong></p><p id="1245" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这里应用了很多钩子，主角是<strong class="is hu"> currentUser </strong>。因为这取决于用户先前的登录，我们将显示一个登录屏幕或<a class="ae jp" href="https://sendbird.com/docs/chat/v3/javascript/guides/channel-types" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu">聊天频道列表</strong> </a>。</p><p id="c0eb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">该示例使用<strong class="is hu"> AsyncStorage </strong>来读取(并保存)之前签名的用户的值。如果有一个值，我们读取它并定义用户为已初始化。</p><figure class="li lj lk ll fd hk"><div class="bz dy l di"><div class="mu mv l"/></div></figure><p id="5302" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们相应地构建屏幕。如果我们有一个注册用户，我们显示<strong class="is hu">通道</strong>组件。否则，我们显示<strong class="is hu">登录</strong>屏幕。</p><figure class="li lj lk ll fd hk"><div class="bz dy l di"><div class="mu mv l"/></div></figure><p id="f119" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一旦<strong class="is hu">登录</strong>组件做出响应，登录功能就会执行。我们将这个值保存在<strong class="is hu"> AsyncStorage </strong>中，并运行iOS和/或Android的令牌注册来接收<a class="ae jp" href="https://sendbird.com/docs/chat/v3/javascript/guides/push-notifications#1-push-notifications" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu">推送通知</strong> </a>。</p><figure class="li lj lk ll fd hk"><div class="bz dy l di"><div class="mu mv l"/></div></figure><p id="6303" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">登录屏幕将描绘我们上面看到的屏幕，并等待用户点击<strong class="is hu">连接</strong>按钮。</p><p id="3e1a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">点击后，按钮调用<strong class="is hu">连接</strong>功能。</p><figure class="li lj lk ll fd hk"><div class="bz dy l di"><div class="mu mv l"/></div></figure><h2 id="49db" class="lr kf ht bd kg mb mc md kk me mf mg ko jb mh mi ks jf mj mk kw jj ml mm la mn bi translated">正在连接到Sendbird</h2><p id="1911" class="pw-post-body-paragraph iq ir ht is b it lc iv iw ix ld iz ja jb le jd je jf lf jh ji jj lg jl jm jn hb bi translated">如您所见，sendbird.connect(…)函数调用通过Websockets将设备与sendbird服务器连接起来。如果您在这里看到任何错误，这是因为所选的用户id无效，您的Sendbird应用程序ID不正确，函数未定义，或者因为您没有连接到互联网。</p><p id="5ce6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们建议您检查任何错误代码并通知您的用户。</p><h2 id="911d" class="lr kf ht bd kg mb mc md kk me mf mg ko jb mh mi ks jf mj mk kw jj ml mm la mn bi translated">前景和背景</h2><p id="6997" class="pw-post-body-paragraph iq ir ht is b it lc iv iw ix ld iz ja jb le jd je jf lf jh ji jj lg jl jm jn hb bi translated">您必须检查您的应用程序是否转到后台，用于以下屏幕(频道、消息等。).如果发生这种情况，您应该调用setBackgroundState。对于其他用户，您将显示为断开连接。一旦应用程序返回到前端，就调用setForegroundState。这将使Websockets再次连接，登录的用户再次在线。</p><figure class="li lj lk ll fd hk"><div class="bz dy l di"><div class="mu mv l"/></div></figure><p id="3ae2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">成功连接后，我们存储该用户的昵称(来自输入屏幕)并将其返回给<strong class="is hu">大厅</strong>组件。一旦用户设置完毕，将出现<strong class="is hu">频道</strong>屏幕。</p><h1 id="2f44" class="ke kf ht bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">第六步。构建频道列表组件</h1><figure class="li lj lk ll fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mw"><img src="../Images/ce7f345bba0d10cac59e5a04e6d7002f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*iIR4GOXPBen68pnH.png"/></div></div><figcaption class="lx ly et er es lz ma bd b be z dx translated">图6:频道列表</figcaption></figure><p id="676b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Sendbird使用公共<strong class="is hu">开放频道</strong>和<strong class="is hu">群组频道</strong>。你不需要邀请，任何用户都可以输入消息，为<strong class="is hu">打开渠道</strong>。<strong class="is hu">组通道</strong>则相反。您需要邀请才能加入频道并发送消息。</p><p id="bea6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要了解更多有关频道类型的信息，请参见本页 或本<a class="ae jp" href="https://sendbird.com/developer/tutorials/understanding-channels" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu">教程</strong> </a>。</p><p id="ab6f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，打开<strong class="is hu">。/src/page/channels.js </strong>文件，并查看所有应该在那里的必要部分。</p><ul class=""><li id="b391" class="jq jr ht is b it iu ix iy jb js jf jt jj ju jn jv jw jx jy bi translated">添加一个<strong class="is hu">连接处理器</strong>来接收Websocket断开连接通知。</li></ul><p id="4d8d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">客户必须知道SDK何时未连接，因为在建立连接之前，您的应用程序应该停止所有请求。否则，您的用户会认为您的应用程序没有工作。</p><ul class=""><li id="84c7" class="jq jr ht is b it iu ix iy jb js jf jt jj ju jn jv jw jx jy bi translated">添加一个<strong class="is hu">通道处理程序</strong>来接收来自Sendbird的关于任何事件的更新。您将能够对频道修改、新消息、频道中添加或删除的用户等做出反应。</li></ul><p id="23b4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">通道处理程序帮助您的应用程序进行可视化更新，并通知客户其他用户所做的任何更改。</p><figure class="li lj lk ll fd hk"><div class="bz dy l di"><div class="mu mv l"/></div></figure><p id="f44b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这里阅读更多关于连接和通道处理程序<a class="ae jp" href="https://sendbird.com/docs/chat/v3/javascript/guides/event-handler#1-event-handler" rel="noopener ugc nofollow" target="_blank"><strong class="is hu"/></a>。</p><h2 id="fd76" class="lr kf ht bd kg mb mc md kk me mf mg ko jb mh mi ks jf mj mk kw jj ml mm la mn bi translated">列出您的频道</h2><p id="5f2c" class="pw-post-body-paragraph iq ir ht is b it lc iv iw ix ld iz ja jb le jd je jf lf jh ji jj lg jl jm jn hb bi translated">列出频道时，您可以从服务器接收的最大记录数是100。如果需要更多，您必须使用<strong class="is hu"> next(…) </strong>再次调用服务器:</p><figure class="li lj lk ll fd hk"><div class="bz dy l di"><div class="mu mv l"/></div></figure><p id="50df" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一旦用户选择了一个频道，我们的应用程序将导航到聊天，传递选择的频道和当前注册的用户。</p><figure class="li lj lk ll fd hk"><div class="bz dy l di"><div class="mu mv l"/></div></figure><p id="3f33" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这将引导我们进入消息屏幕。</p><h1 id="5d6d" class="ke kf ht bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">第七步。构建消息组件</h1><p id="2e51" class="pw-post-body-paragraph iq ir ht is b it lc iv iw ix ld iz ja jb le jd je jf lf jh ji jj lg jl jm jn hb bi translated">选择频道后，应用程序将只显示该频道的消息列表:</p><figure class="li lj lk ll fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mw"><img src="../Images/79956aaaf6e7b4b64b6aaf52372a7f16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*gQ3BrZqvBpj5yM7_.png"/></div></div><figcaption class="lx ly et er es lz ma bd b be z dx translated">图7:消息</figcaption></figure><p id="8b5f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这个屏幕的代码在<strong class="is hu">里。/src/page/chat.js </strong>。</p><p id="fe00" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">自然，消息列表是这个屏幕最重要的部分。但是，让我们看看必须包括的其他部分:</p><ul class=""><li id="1bcd" class="jq jr ht is b it iu ix iy jb js jf jt jj ju jn jv jw jx jy bi translated">一个<strong class="is hu">连接处理程序</strong>，用于管理连接断开并阻止客户发送消息。</li><li id="aeb8" class="jq jr ht is b it jz ix ka jb kb jf kc jj kd jn jv jw jx jy bi translated">一个<strong class="is hu">通道处理器</strong>，用于接收与通道相关的任何变化(包括消息的添加、删除等)。)，通过Websockets。</li></ul><figure class="li lj lk ll fd hk"><div class="bz dy l di"><div class="mu mv l"/></div></figure><p id="7c0e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当该视图对用户不再有效时，您需要删除这些处理程序。</p><figure class="li lj lk ll fd hk"><div class="bz dy l di"><div class="mu mv l"/></div></figure><p id="5f9c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这个示例应用程序中，我们将对以下事件采取行动:</p><p id="6d42" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hu"> onMessageReceived </strong>:通过Websocket接收到一条新消息。仅当事件通知的频道URL与您在此视图中激活的频道相同时，才将此新消息添加到消息列表中。</p><p id="dcf7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hu"> onMessageUpdated </strong>:消息已更新。如果此通知消息属于此活动频道，您必须从列表中更新其内容。</p><p id="621d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hu">on messaged deleted</strong>:消息已被删除。如果此通知消息属于此活动频道，您必须将其从列表中删除。</p><p id="b752" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您还可以接收关于该用户和频道的事件。例如:</p><p id="dd65" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hu"> onUserLeft </strong>:如果用户离开了频道，你应该检查签名的用户ID是否与通知的用户ID匹配。如果两者相同，则意味着您决定从另一台设备退出该频道。您的操作应该类似于返回到主频道列表(channels.js)。</p><p id="6e81" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hu"> onChannelDeleted </strong>:另一个关键的检查是包含你正在显示的消息的频道是否存在。如果该频道因任何原因丢失，您还应返回主屏幕，显示剩余频道列表(channels.js)。</p><h2 id="8b07" class="lr kf ht bd kg mb mc md kk me mf mg ko jb mh mi ks jf mj mk kw jj ml mm la mn bi translated">将频道标记为已读</h2><p id="de63" class="pw-post-body-paragraph iq ir ht is b it lc iv iw ix ld iz ja jb le jd je jf lf jh ji jj lg jl jm jn hb bi translated">当您进入查看频道中的消息时，您应该将所有消息标记为已读。</p><figure class="li lj lk ll fd hk"><div class="bz dy l di"><div class="mu mv l"/></div></figure><h2 id="cdf0" class="lr kf ht bd kg mb mc md kk me mf mg ko jb mh mi ks jf mj mk kw jj ml mm la mn bi translated">列出您的邮件</h2><p id="f21b" class="pw-post-body-paragraph iq ir ht is b it lc iv iw ix ld iz ja jb le jd je jf lf jh ji jj lg jl jm jn hb bi translated">我们将向Sendbird请求这个活动通道中的消息列表。为此，我们使用<strong class="is hu">createPreviousMessageListQuery</strong>。</p><figure class="li lj lk ll fd hk"><div class="bz dy l di"><div class="mu mv l"/></div></figure><p id="faa9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">查看更多信息，请参见<a class="ae jp" href="https://sendbird.com/docs/chat/v3/javascript/guides/group-channel#2-load-previous-messages" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu">本页</strong> </a>。你也可以看看这篇关于消息对象的<a class="ae jp" href="https://sendbird.com/developer/tutorials/designing-message-objects" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu">教程</strong> </a>。</p><p id="551d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对于这个例子，我们列出了最后50条消息。如果有更多的消息可以显示，您应该调用<strong class="is hu"> next() </strong>来获得更多的数据。</p><figure class="li lj lk ll fd hk"><div class="bz dy l di"><div class="mu mv l"/></div></figure><h2 id="5869" class="lr kf ht bd kg mb mc md kk me mf mg ko jb mh mi ks jf mj mk kw jj ml mm la mn bi translated">根据时间戳获取消息</h2><p id="04c4" class="pw-post-body-paragraph iq ir ht is b it lc iv iw ix ld iz ja jb le jd je jf lf jh ji jj lg jl jm jn hb bi translated">您还可以根据特定的时间戳请求消息列表。使用类似于<strong class="is hu"> new </strong> <strong class="is hu"> Date()的东西。getTime() </strong>并定义您想要显示多少条以前的消息。</p><p id="2a74" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果用户向上滚动以获得很长的消息历史，这种技术将帮助您加载以前的消息。您只需要不断发送消息的时间戳，并要求显示以前的记录，直到您到达发送到通道的第一条消息。</p><figure class="li lj lk ll fd hk"><div class="bz dy l di"><div class="mu mv l"/></div></figure><p id="7163" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要了解更多信息，请查看我们的<a class="ae jp" href="https://sendbird.com/docs/chat/v3/javascript/guides/group-channel#2-list-messages-along-with-their-replies-3-by-timestamp" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu">文档</strong> </a>。</p><h1 id="d8ae" class="ke kf ht bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">第八步。发送和接收消息</h1><figure class="li lj lk ll fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mw"><img src="../Images/97d2239b125f116c6704cf934678d02e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*zaT_nBFdATRMO9IJ.png"/></div></div><figcaption class="lx ly et er es lz ma bd b be z dx translated">图8:发送消息</figcaption></figure><p id="fe4f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">使用Sendbird，您可以发送文本或文件消息。</p><p id="4a8f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">注意，Sendbird的消息不仅仅是文本或文件；我们还有其他的属性来将机密信息发送到您的服务器或其他连接的用户。</p><h2 id="c2dd" class="lr kf ht bd kg mb mc md kk me mf mg ko jb mh mi ks jf mj mk kw jj ml mm la mn bi translated">自定义类型</h2><p id="69aa" class="pw-post-body-paragraph iq ir ht is b it lc iv iw ix ld iz ja jb le jd je jf lf jh ji jj lg jl jm jn hb bi translated">该属性是消息对象的一部分，它为消息分组指定一个自定义消息类型。长度限制为128个字符。</p><p id="dd94" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Sendbird <a class="ae jp" href="https://sendbird.com/docs/chat/v3/platform-api/guides/advanced-analytics" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu">高级分析</strong> </a>也使用自定义类型来划分指标。它们支持数据视图的子分类。</p><h2 id="a7a0" class="lr kf ht bd kg mb mc md kk me mf mg ko jb mh mi ks jf mj mk kw jj ml mm la mn bi translated">数据</h2><p id="d097" class="pw-post-body-paragraph iq ir ht is b it lc iv iw ix ld iz ja jb le jd je jf lf jh ji jj lg jl jm jn hb bi translated">数据是可以用于内部逻辑的另一个属性。它指定了额外的消息信息，比如定制的字体大小、字体类型，或者您想要用一个<strong class="is hu"> JSON </strong>格式的字符串处理的任何数据。</p><p id="87ff" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要查找消息的属性列表，请单击此处的<a class="ae jp" href="https://sendbird.com/docs/chat/v3/platform-api/guides/messages#4-list-of-properties-for-text-message" rel="noopener ugc nofollow" target="_blank"><strong class="is hu"/></a>。</p><p id="47ea" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要了解更多关于通过SDK和Javascript发送消息的信息，请参见<a class="ae jp" href="https://sendbird.com/docs/chat/v3/javascript/guides/group-channel#2-send-a-message" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu">本页</strong> </a>。</p><p id="0ddb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下面是发送消息的代码。</p><figure class="li lj lk ll fd hk"><div class="bz dy l di"><div class="mu mv l"/></div></figure><h2 id="d9dd" class="lr kf ht bd kg mb mc md kk me mf mg ko jb mh mi ks jf mj mk kw jj ml mm la mn bi translated">文件消息</h2><p id="05ac" class="pw-post-body-paragraph iq ir ht is b it lc iv iw ix ld iz ja jb le jd je jf lf jh ji jj lg jl jm jn hb bi translated">使用Sendbird，您还可以发送文件消息。在这个应用程序中，我们允许用户从设备中选择文件，然后发送它。</p><figure class="li lj lk ll fd hk"><div class="bz dy l di"><div class="mu mv l"/></div></figure><p id="0ee9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">记得请求许可。</p><p id="ec6e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当使用Android和iOS时，您必须在使用文件选择器之前请求用户的许可。</p><figure class="li lj lk ll fd hk"><div class="bz dy l di"><div class="mu mv l"/></div></figure><p id="3da4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hu">重要</strong> : Sendbird需要一个Javascript <strong class="is hu"> File </strong>对象作为上传的文件。如果尝试发送另一种格式，您可能会收到错误或上传失败。有时，从公共存储库中使用的定制文件选择器不能提供正确的对象类型。</p><p id="ba2d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">请记住，发送文件消息时，不能同时发送文本。但是，您可以使用其他消息对象属性来发送文本并将其显示在聊天列表中。查看文件消息的可用属性列表:</p><figure class="li lj lk ll fd hk"><div class="bz dy l di"><div class="mu mv l"/></div></figure><p id="a3ec" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">更多信息在<a class="ae jp" href="https://sendbird.com/docs/chat/v3/javascript/guides/group-channel#2-send-a-message" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu">文档</strong> </a>中。</p><h2 id="f603" class="lr kf ht bd kg mb mc md kk me mf mg ko jb mh mi ks jf mj mk kw jj ml mm la mn bi translated">图像文件的缩略图</h2><p id="91d1" class="pw-post-body-paragraph iq ir ht is b it lc iv iw ix ld iz ja jb le jd je jf lf jh ji jj lg jl jm jn hb bi translated">上传图像文件时，可以让Sendbird自动生成缩略图。从您的<a class="ae jp" href="https://dashboard.sendbird.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu">仪表盘</strong> </a>中启用此功能:</p><figure class="li lj lk ll fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mx"><img src="../Images/af566181a56f10bb2d1cc6c7cbd31a91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*VM6ANniMTJSqLULO.png"/></div></div><figcaption class="lx ly et er es lz ma bd b be z dx translated">图9:启用自动缩略图生成器</figcaption></figure><h2 id="ed5d" class="lr kf ht bd kg mb mc md kk me mf mg ko jb mh mi ks jf mj mk kw jj ml mm la mn bi translated"><strong class="ak">语音信息</strong></h2><p id="a612" class="pw-post-body-paragraph iq ir ht is b it lc iv iw ix ld iz ja jb le jd je jf lf jh ji jj lg jl jm jn hb bi translated">您可以通过文件消息发送语音消息。您的前端应用程序应该实现一个语音记录功能，并将结果保存为一个文件。然后，您只需上传该文件，以及我们为消息对象提供的任何自定义属性，表明这是一个语音消息文件。在通道中绘制此消息时，分析信息并正确显示。</p><figure class="li lj lk ll fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es my"><img src="../Images/14fb008dc414ec5e03e0c38022f236af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*oRuRiAfPsouWT9L1.png"/></div></div><figcaption class="lx ly et er es lz ma bd b be z dx translated">图10:将文件消息格式化为语音消息</figcaption></figure><h2 id="546d" class="lr kf ht bd kg mb mc md kk me mf mg ko jb mh mi ks jf mj mk kw jj ml mm la mn bi translated"><strong class="ak">回复消息</strong></h2><p id="1f40" class="pw-post-body-paragraph iq ir ht is b it lc iv iw ix ld iz ja jb le jd je jf lf jh ji jj lg jl jm jn hb bi translated">Sendbird支持消息线程，因此您可以回复消息。</p><p id="4452" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为此，您必须在发送响应时指明父消息ID。</p><p id="c0e1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您可以回复一条短信:</p><figure class="li lj lk ll fd hk"><div class="bz dy l di"><div class="mu mv l"/></div></figure><p id="f4c0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">或者使用文件消息:</p><figure class="li lj lk ll fd hk"><div class="bz dy l di"><div class="mu mv l"/></div></figure><p id="70f8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要了解关于<a class="ae jp" href="https://sendbird.com/docs/chat/v3/javascript/guides/group-channel#2-reply-to-a-message" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu">消息</strong> </a>的更多信息，请查看文档和本<a class="ae jp" href="https://sendbird.com/developer/tutorials/designing-message-objects" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu">教程</strong> </a>。</p><h1 id="6c0e" class="ke kf ht bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">第九步。Sendbird的其他功能</h1><p id="1e6f" class="pw-post-body-paragraph iq ir ht is b it lc iv iw ix ld iz ja jb le jd je jf lf jh ji jj lg jl jm jn hb bi translated">Sendbird为您的聊天体验提供了多种功能。</p><h2 id="fe6c" class="lr kf ht bd kg mb mc md kk me mf mg ko jb mh mi ks jf mj mk kw jj ml mm la mn bi translated">打字指示器</h2><p id="c28a" class="pw-post-body-paragraph iq ir ht is b it lc iv iw ix ld iz ja jb le jd je jf lf jh ji jj lg jl jm jn hb bi translated">在这个示例中，您可以看到使用startTyping()和endTyping()向通道中的所有成员发送事件。</p><figure class="li lj lk ll fd hk"><div class="bz dy l di"><div class="mu mv l"/></div></figure><p id="6987" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">该事件触发<a class="ae jp" href="https://sendbird.com/docs/chat/v3/javascript/guides/event-handler#4-list-of-open-channel-events" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu">通道处理程序</strong> </a>的onTypingStatusUpdated函数。</p><p id="3cfd" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">剩下的就是显示一个标签，说用户XXX正在输入消息。</p><h2 id="ea0b" class="lr kf ht bd kg mb mc md kk me mf mg ko jb mh mi ks jf mj mk kw jj ml mm la mn bi translated">适度</h2><p id="9c24" class="pw-post-body-paragraph iq ir ht is b it lc iv iw ix ld iz ja jb le jd je jf lf jh ji jj lg jl jm jn hb bi translated">Sendbird提供了强大的调节工具。您可以使用Sendbird <a class="ae jp" href="https://dashboard.sendbird.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu">仪表盘</strong> </a>来调节消息和用户。您也可以<a class="ae jp" href="https://sendbird.com/docs/chat/v3/javascript/guides/group-channel#2-register-operators" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu">注册</strong> </a>或<a class="ae jp" href="https://sendbird.com/docs/chat/v3/javascript/guides/group-channel#2-cancel-the-registration-of-operators" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu">注销</strong> </a>通道成员为<a class="ae jp" href="https://sendbird.com/docs/chat/v3/javascript/guides/user-types#2-operator" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu">操作员</strong> </a>，这样他们就可以<a class="ae jp" href="https://sendbird.com/docs/chat/v3/javascript/guides/group-channel#2-freeze-and-unfreeze-a-channel" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu">冻结</strong> </a>通道、<a class="ae jp" href="https://sendbird.com/docs/chat/v3/javascript/guides/group-channel#2-ban-and-unban-a-user" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu">阻塞、</strong> </a>或<a class="ae jp" href="https://sendbird.com/docs/chat/v3/javascript/guides/group-channel#2-mute-and-unmute-a-user" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu">静音</strong> </a>用户。</p><p id="f2fb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要查看Sendbird提供的所有功能，请查看我们的JavaScript <a class="ae jp" href="https://sendbird.com/docs/chat/v3/javascript/quickstart/send-first-message" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu">文档</strong> </a>和这篇关于<a class="ae jp" href="https://sendbird.com/developer/tutorials/reporting-api-best-practice" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu">适度最佳实践</strong> </a>的教程。</p><h1 id="0a2e" class="ke kf ht bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">结论</h1><p id="3374" class="pw-post-body-paragraph iq ir ht is b it lc iv iw ix ld iz ja jb le jd je jf lf jh ji jj lg jl jm jn hb bi translated">所以这是一个总结！JavaScript SDK中还有更多的特性，所以一定要查看文档 中的<a class="ae jp" href="https://sendbird.gitbooks.io/sendbird-javascript-sdk/content/" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu">来构建一个更高级的消息应用程序。</strong></a></p><p id="d97d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">本教程让您体验了使用<a class="ae jp" href="https://sendbird.com/docs/chat/v3/javascript/quickstart/send-first-message" rel="noopener ugc nofollow" target="_blank"><strong class="is hu">send bird JavaScript SDK</strong></a>构建React原生聊天应用的过程。要了解React Native的更多信息，请参考<a class="ae jp" href="http://facebook.github.io/react-native/docs/getting-started.html" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu">官方文档。</strong>T19】</a></p><p id="fda0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您对本教程或使用Sendbird有任何疑问，请在我们的社区页面<a class="ae jp" href="https://community.sendbird.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu">这里</strong> </a>给我们留言。</p><p id="ccaf" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">感谢和快乐反应本地聊天建设！💻</p></div></div>    
</body>
</html>