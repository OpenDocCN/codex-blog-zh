<html>
<head>
<title>Get 10x Performance by combining Stored Procedures &amp; Entity Framework</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过结合存储过程和实体框架获得10倍的性能</h1>
<blockquote>原文：<a href="https://medium.com/codex/get-10x-performance-by-combining-stored-procedures-entity-framework-8a7af3678e26?source=collection_archive---------3-----------------------#2022-02-23">https://medium.com/codex/get-10x-performance-by-combining-stored-procedures-entity-framework-8a7af3678e26?source=collection_archive---------3-----------------------#2022-02-23</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div class="er es hg"><img src="../Images/0467718dd895fb75bf3dbba1a806ca4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/format:webp/1*xwiVW2Z-W8oMN89Thmd-8A.png"/></div><figcaption class="hn ho et er es hp hq bd b be z dx translated">使用实体框架执行存储过程</figcaption></figure><div class=""/><p id="c6a5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在实体框架中使用存储过程听起来可能与直觉相反，因为实体框架的全部目的是避免编写SQL，而存储过程只是一堆SQL语句。</p><p id="f045" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">存储过程有自己的优势。有些任务只能通过存储过程来完成。</p><h1 id="a132" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">复杂和批量操作</h1><p id="ee91" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">让我们假设我们有一个CRM软件，允许客户管理销售线索、支持票证、发送电子邮件等。为了给我们的客户开账单，我们每个月都要进行大量的计算。这需要确定创建的销售线索数量、提出的支持请求数量、发送的电子邮件数量等。这必须为每个客户独立完成。显然，这需要对多个数据库表进行大量查询。</p><h1 id="9d79" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">实体框架和批量操作</h1><p id="dbe4" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">如果你试图做一个复杂的操作，就像上面所说的那样，由于显而易见的原因，它将花费大量的时间。由于实体框架代码在您的应用程序中运行，每个查询(读/写)都有网络IO开销。应用程序和SQL server之间的通信是通过TCP/IP协议进行的。一种解决方案是将您的操作分成更小的批次，每次几个客户，然后运行多个这样的批次。</p><p id="58fb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">但是，为了处理这种批量操作，建议创建一个存储过程，并将所有逻辑打包在一起。由于存储过程在数据库中运行，因此我们大大减少了网络IO开销，从而节省了大量资源。</p><h1 id="c265" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">两全其美</h1><p id="3d66" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">让我们继续上面的例子。假设我们的存储过程的名字是<code class="du kr ks kt ku b"><strong class="is hu">ComputeBilling</strong></code></p><p id="f566" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下面是使用实体框架执行存储过程的方法:</p><figure class="kw kx ky kz fd hk er es paragraph-image"><div class="er es kv"><img src="../Images/e38427f9883f79290881046d14317c3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1018/format:webp/1*vj0Z1Y8ErOVOUfOuYc93NQ.png"/></div><figcaption class="hn ho et er es hp hq bd b be z dx translated">使用实体框架执行存储过程</figcaption></figure><p id="e2cb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，我们只是不想执行这个过程，但是在操作完成之后，我们也需要知道摘要。也许我们需要知道向多少客户开了账单，以及总账单金额是多少(所有客户的总和)。</p><h1 id="d407" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated"><strong class="ak"> SQL参数</strong></h1><p id="fb7b" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">当您需要向存储过程传递一个值时(例如，<strong class="is hu">月</strong>，需要对其进行计费)，或者当您希望从存储过程获得一些输出时，您需要传递所谓的SQL参数。参数可以有两种类型-输入和输出。输入参数将值传递给存储过程，输出参数从存储过程返回值。继续我们的示例，我们需要传递一个输入参数来指示存储过程运行截止到2022年2月28日的月份的账单，并期望返回两个值——已开账单的客户数量(生成的发票)和总账单金额。下面是如何做到这一点:</p><figure class="kw kx ky kz fd hk er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es la"><img src="../Images/8ceae23fa2ef78e5b97a50d9d95e1188.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*17s7FrGn0sSjkV1tYEbRfg.png"/></div></div><figcaption class="hn ho et er es hp hq bd b be z dx translated">执行带参数的存储过程</figcaption></figure><p id="7bca" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">以下是执行完成后读取值的方法:</p><figure class="kw kx ky kz fd hk er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es lf"><img src="../Images/41d4ae78d9a235b04dc3cf0a3b5b4bd0.png" data-original-src="https://miro.medium.com/v2/resize:fit:864/format:webp/1*uq76DNvJtggCbVFR5kMmFw.png"/></div></div><figcaption class="hn ho et er es hp hq bd b be z dx translated">读取SQL参数值</figcaption></figure><p id="33be" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这样，您就可以结合存储过程的能力来执行实体框架中的复杂任务。您还可以让存储过程像select查询一样返回表行，并在EF中使用它进行进一步的操作。这可能是另一篇文章的主题:)</p></div><div class="ab cl lg lh gp li" role="separator"><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll"/></div><div class="hb hc hd he hf"><p id="9c41" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你可能也喜欢阅读:<br/> 1。<a class="ae ln" rel="noopener" href="/codex/best-practices-with-entity-framework-567ac9d5493a">实体框架的最佳实践</a>，以及<br/> 2。<a class="ae ln" rel="noopener" href="/codex/fast-and-memory-efficient-querying-in-entity-framework-ebf906d9e6cb">快速&amp;实体框架内存高效查询</a></p></div><div class="ab cl lg lh gp li" role="separator"><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll"/></div><div class="hb hc hd he hf"><p id="4217" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要阅读我所有的故事，以及媒体上成千上万的其他作家，考虑成为媒体成员<a class="ae ln" href="https://prashantio.medium.com/membership" rel="noopener">在这里</a>。</p></div></div>    
</body>
</html>