<html>
<head>
<title>Azure Bicep: Secure secrets in parameters — @secure() decorator</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Azure Bicep:参数中的安全秘密— @secure() decorator</h1>
<blockquote>原文：<a href="https://medium.com/codex/azure-bicep-secure-secrets-in-parameters-secure-decorator-ce6317cc0c23?source=collection_archive---------1-----------------------#2021-09-15">https://medium.com/codex/azure-bicep-secure-secrets-in-parameters-secure-decorator-ce6317cc0c23?source=collection_archive---------1-----------------------#2021-09-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="37a4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">确保保护二头肌代码中参数引用的秘密</em></p><p id="2cfc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">本文将介绍Bicep中参数的使用，以及我们如何使用<em class="jd"> @secure() </em>装饰器来保护它们。</p><p id="23af" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您正在阅读这篇文章，我敢打赌您曾经遇到过这样的情况:您需要部署一个虚拟机、一个数据库或一个需要您传递密码之类的秘密的资源。</p><p id="5403" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这些秘密可以作为Bicep模板中的参数传递，最好使用特定的类型来保护这些值。默认情况下，参数不受保护，那么在Bicep中我们有什么选项可以传递秘密值呢？</p><h1 id="f2d2" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">使用参数中的秘密</h1><p id="094e" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">ARM模板提供了两种数据类型来传递参数中的秘密值:“secureString”和“secureObject”。这些数据类型在Bicep中不可用，但是您可以利用一个<em class="jd"/><a class="ae kh" href="http://twitter.com/secure" rel="noopener ugc nofollow" target="_blank"><em class="jd">@ secure</em></a><em class="jd">()decorator</em>。</p><p id="c14a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Bicep中的Decorators提供了一种将约束和元数据附加到参数上的方法。这些装饰器在参数声明之上定义，并使用“<em class="jd">@表达式</em>”。这个表达式基本上是一个函数调用。</p><p id="256f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面的代码展示了一个如何使用decorators声明的例子:</p><pre class="ki kj kk kl fd km kn ko kp aw kq bi"><span id="085c" class="kr jf hi kn b fi ks kt l ku kv">@expression<br/>param myParam string</span></pre><p id="b98c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在上面的代码中，我们在下一行定义了装饰器和参数字符串类型。我们可以使用decorators来保护Bicep中的参数。</p><h1 id="c3f5" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">Bicep中的安全参数</h1><p id="b50c" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">如前所述，数据类型'<em class="jd"> secureString </em>'和'<em class="jd"> secureObject </em>'在Bicep中不可用；因此，我们将利用如下所示的<em class="jd"> @secure() </em>装饰器:</p><pre class="ki kj kk kl fd km kn ko kp aw kq bi"><span id="7661" class="kr jf hi kn b fi ks kt l ku kv">@secure()<br/>param myPassword string</span><span id="b376" class="kr jf hi kn b fi kw kt l ku kv">@secure()<br/>param mySuperSecretObject object</span></pre><p id="6402" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该定义将转换为众所周知的'<em class="jd">安全字符串</em>和'<em class="jd">安全对象</em>'，如下所示:</p><figure class="ki kj kk kl fd ky er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es kx"><img src="../Images/bcb0d2e1fb05615c812dc9544d99a66a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Dcq8BLPrP53lUsQ2o1J7jQ.png"/></div></div><figcaption class="lf lg et er es lh li bd b be z dx translated">蓝色二头肌——安全参数</figcaption></figure><p id="766f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您还有其他选择来利用<em class="jd"> @secure() </em>装饰器:</p><pre class="ki kj kk kl fd km kn ko kp aw kq bi"><span id="73c6" class="kr jf hi kn b fi ks kt l ku kv"><a class="ae kh" href="http://twitter.com/secure" rel="noopener ugc nofollow" target="_blank">@secure</a>()<br/>param adminPassword string</span></pre></div><div class="ab cl lj lk gp ll" role="separator"><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo"/></div><div class="hb hc hd he hf"><pre class="km kn ko kp aw kq bi"><span id="1f42" class="kr jf hi kn b fi lq lr ls lt lu kt l ku kv"><a class="ae kh" href="http://twitter.com/secure" rel="noopener ugc nofollow" target="_blank">@secure</a>()<br/>param adminPassword string = ''</span></pre></div><div class="ab cl lj lk gp ll" role="separator"><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo"/></div><div class="hb hc hd he hf"><pre class="km kn ko kp aw kq bi"><span id="c478" class="kr jf hi kn b fi lq lr ls lt lu kt l ku kv"><a class="ae kh" href="http://twitter.com/secure" rel="noopener ugc nofollow" target="_blank">@secure</a>()<br/>param adminPassword string = newGuid()</span></pre><p id="0292" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">建议不要在Bicep模板中硬编码安全参数的默认值，除非它是空的，或者使用包含调用<em class="jd"> newGuid() </em>的表达式，如上面的代码所示。</p><p id="c075" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在让我们回顾一下下面的例子，我们将在其中部署一个SQL数据库。下面的例子将帮助您更好地理解<em class="jd"> @secure() </em>装饰器是如何工作的。</p><h1 id="a799" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">举例。部署SQL数据库</h1><p id="7d73" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">下面的Bicep模板创建了一个SQL数据库，并使用了<em class="jd"> @secure() </em>装饰器。</p><pre class="ki kj kk kl fd km kn ko kp aw kq bi"><span id="ca8f" class="kr jf hi kn b fi ks kt l ku kv">param serverName string = uniqueString('sql', resourceGroup().id)<br/>param sqlDBName string = 'AzInsiderDb'<br/>param location string = resourceGroup().location<br/>param administratorLogin string</span><span id="33a6" class="kr jf hi kn b fi kw kt l ku kv"><a class="ae kh" href="http://twitter.com/secure" rel="noopener ugc nofollow" target="_blank"><strong class="kn hj">@secure</strong></a><strong class="kn hj">()<br/>param administratorLoginPassword string</strong></span><span id="b3b7" class="kr jf hi kn b fi kw kt l ku kv">resource server 'Microsoft.Sql/servers@2019-06-01-preview' = {<br/>  name: serverName<br/>  location: location<br/>  properties: {<br/>    administratorLogin: administratorLogin<br/>    administratorLoginPassword: administratorLoginPassword<br/>  }<br/>}</span><span id="93d9" class="kr jf hi kn b fi kw kt l ku kv">resource sqlDB 'Microsoft.Sql/servers/databases@2020-08-01-preview' = {<br/>  name: '${server.name}/${sqlDBName}'<br/>  location: location<br/>  sku: {<br/>    name: 'Standard'<br/>    tier: 'Standard'<br/>  }<br/>}</span></pre><p id="b6cd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在上面的代码中，我们为服务器名、SQL数据库名、位置和管理员登录定义了几个参数。然后我们使用<em class="jd"> @secure() </em>装饰器作为管理员密码。</p><p id="d59d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，我们将Bicep模板部署到之前使用下面的命令创建的资源组中:</p><pre class="ki kj kk kl fd km kn ko kp aw kq bi"><span id="13f1" class="kr jf hi kn b fi ks kt l ku kv">New-AzResourceGroupDeployment -Name $deploymentName -ResourceGroupName sql-database -TemplateFile .\main.bicep</span></pre><p id="28b9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在部署期间，我们将提供管理员登录名和密码，如下图所示:</p><figure class="ki kj kk kl fd ky er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es lv"><img src="../Images/e63fe5bd95dff60cbca42119f042c4f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O83_Lbeehlyaxmp69gt4nw.png"/></div></div><figcaption class="lf lg et er es lh li bd b be z dx translated">Azure Bicep —部署SQL数据库</figcaption></figure><p id="f63e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">类似于ARM模板，秘密的实际值永远不会暴露。建议对您的密码和机密使用这种类型的参数。</p><p id="6ad9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">作为安全参数传递的敏感数据在资源部署后无法读取，也不会被记录。</p><p id="cca8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下图显示了SQL数据库部署的输出:</p><figure class="ki kj kk kl fd ky er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es lw"><img src="../Images/2f06221f05bb88ac349638123f9d8d10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2Lhy0k_O9ib8wvqi7ZngIw.png"/></div></div><figcaption class="lf lg et er es lh li bd b be z dx translated">Azure Bicep — SQL数据库部署输出</figcaption></figure><p id="9a40" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">另一个常见的用例是虚拟机的部署。在下面的例子中，我们将使用Bicep和<em class="jd"> @secure() </em>装饰器部署一个基于Windows的虚拟机。</p><h1 id="f5cd" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">举例。使用@secure() decorator部署基于Windows的虚拟机</h1><p id="a31f" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">在下面的代码中，我们将使用一些参数:</p><pre class="ki kj kk kl fd km kn ko kp aw kq bi"><span id="435e" class="kr jf hi kn b fi ks kt l ku kv">param adminUserName string<br/>param dnsLabelPrefix string<br/>param windowsOSVersion string = '2019-Datacenter'<br/>param vmSize string = 'Standard_D2_v3'<br/>param location string = resourceGroup().location</span></pre><p id="60d5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，我们将为虚拟机的密码定义参数:</p><pre class="ki kj kk kl fd km kn ko kp aw kq bi"><span id="52c3" class="kr jf hi kn b fi ks kt l ku kv"><a class="ae kh" href="http://twitter.com/secure" rel="noopener ugc nofollow" target="_blank">@secure</a>()<br/>param adminPassword string</span></pre><p id="532c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请注意，我们没有对密码进行硬编码。下一步是定义一些与网络组件、虚拟机名称和存储帐户相关的变量。</p><pre class="ki kj kk kl fd km kn ko kp aw kq bi"><span id="ad37" class="kr jf hi kn b fi ks kt l ku kv">var storageAccountName = 'drendonwinvmsa'<br/>var nicName = 'myVMNic'<br/>var addressPrefix = '10.0.0.0/16'<br/>var subnetName = 'Subnet'<br/>var subnetPrefix = '10.0.0.0/24'<br/>var publicIPAddressName = 'myPublicIP'<br/>var vmName = 'winVm'<br/>var virtualNetworkName = 'MyVNET'<br/>var subnetRef = '${vn.id}/subnets/${subnetName}'<br/>var networkSecurityGroupName = 'default-NSG'</span></pre><p id="a756" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，我们将定义部署基于Windows的虚拟机所需的资源:</p><pre class="ki kj kk kl fd km kn ko kp aw kq bi"><span id="7b1b" class="kr jf hi kn b fi ks kt l ku kv">resource stg 'Microsoft.Storage/storageAccounts@2019-06-01' = {<br/>  name: storageAccountName<br/>  location: location<br/>  sku: {<br/>    name: 'Standard_LRS'<br/>  }<br/>  kind: 'Storage'<br/>}</span><span id="7ce7" class="kr jf hi kn b fi kw kt l ku kv">resource pip 'Microsoft.Network/publicIPAddresses@2020-06-01' = {<br/>  name: publicIPAddressName<br/>  location: location<br/>  properties: {<br/>    publicIPAllocationMethod: 'Dynamic'<br/>    dnsSettings: {<br/>      domainNameLabel: dnsLabelPrefix<br/>    }<br/>  }<br/>}</span><span id="eaca" class="kr jf hi kn b fi kw kt l ku kv">resource sg 'Microsoft.Network/networkSecurityGroups@2020-06-01' = {<br/>  name: networkSecurityGroupName<br/>  location: location<br/>  properties: {<br/>    securityRules: [<br/>      {<br/>        name: 'default-allow-3389'<br/>        'properties': {<br/>          priority: 1000<br/>          access: 'Allow'<br/>          direction: 'Inbound'<br/>          destinationPortRange: '3389'<br/>          protocol: 'Tcp'<br/>          sourcePortRange: '*'<br/>          sourceAddressPrefix: '*'<br/>          destinationAddressPrefix: '*'<br/>        }<br/>      }<br/>    ]<br/>  }<br/>}</span><span id="0c23" class="kr jf hi kn b fi kw kt l ku kv">resource vn 'Microsoft.Network/virtualNetworks@2020-06-01' = {<br/>  name: virtualNetworkName<br/>  location: location<br/>  properties: {<br/>    addressSpace: {<br/>      addressPrefixes: [<br/>        addressPrefix<br/>      ]<br/>    }<br/>    subnets: [<br/>      {<br/>        name: subnetName<br/>        properties: {<br/>          addressPrefix: subnetPrefix<br/>          networkSecurityGroup: {<br/>            id: sg.id<br/>          }<br/>        }<br/>      }<br/>    ]<br/>  }<br/>}</span><span id="ab6d" class="kr jf hi kn b fi kw kt l ku kv">resource nInter 'Microsoft.Network/networkInterfaces@2020-06-01' = {<br/>  name: nicName<br/>  location: location</span><span id="edab" class="kr jf hi kn b fi kw kt l ku kv">properties: {<br/>    ipConfigurations: [<br/>      {<br/>        name: 'ipconfig1'<br/>        properties: {<br/>          privateIPAllocationMethod: 'Dynamic'<br/>          publicIPAddress: {<br/>            id: pip.id<br/>          }<br/>          subnet: {<br/>            id: subnetRef<br/>          }<br/>        }<br/>      }<br/>    ]<br/>  }<br/>}</span><span id="c5ab" class="kr jf hi kn b fi kw kt l ku kv">resource VM 'Microsoft.Compute/virtualMachines@2020-06-01' = {<br/>  name: vmName<br/>  location: location<br/>  properties: {<br/>    hardwareProfile: {<br/>      vmSize: vmSize<br/>    }<br/>    osProfile: {<br/>      computerName: vmName<br/>      adminUsername: adminUserName<br/>      adminPassword: adminPassword<br/>    }<br/>    storageProfile: {<br/>      imageReference: {<br/>        publisher: 'MicrosoftWindowsServer'<br/>        offer: 'WindowsServer'<br/>        sku: windowsOSVersion<br/>        version: 'latest'<br/>      }<br/>      osDisk: {<br/>        createOption: 'FromImage'<br/>      }<br/>      dataDisks: [<br/>        {<br/>          diskSizeGB: 1023<br/>          lun: 0<br/>          createOption: 'Empty'<br/>        }<br/>      ]<br/>    }<br/>    networkProfile: {<br/>      networkInterfaces: [<br/>        {<br/>          id: nInter.id<br/>        }<br/>      ]<br/>    }<br/>    diagnosticsProfile: {<br/>      bootDiagnostics: {<br/>        enabled: true<br/>        storageUri: stg.properties.primaryEndpoints.blob<br/>      }<br/>    }<br/>  }<br/>}</span></pre><p id="ebcb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，我们将包括一个显示虚拟机主机名的输出:</p><pre class="ki kj kk kl fd km kn ko kp aw kq bi"><span id="9f19" class="kr jf hi kn b fi ks kt l ku kv">output hostname string = pip.properties.dnsSettings.fqdn</span></pre><p id="f7a2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我们执行实际部署之前，我们可以使用带有以下命令的标志-C来预览部署:</p><pre class="ki kj kk kl fd km kn ko kp aw kq bi"><span id="fb9c" class="kr jf hi kn b fi ks kt l ku kv">New-AzResourceGroupDeployment -Name $deploymentName -ResourceGroupName winvm -TemplateFile .\main.bicep -c</span></pre><p id="650a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下图显示了部署预览:</p><figure class="ki kj kk kl fd ky er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es lx"><img src="../Images/fc0fc3e52482692e3f1603a3abe00fd5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uuZlbQz0GZGtoyYb0h05UQ.png"/></div></div><figcaption class="lf lg et er es lh li bd b be z dx translated">Azure Bicep —部署预览</figcaption></figure><p id="ecf8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦二头肌模板看起来不错，我们就可以确认部署。下图显示了此部署的输出:</p><figure class="ki kj kk kl fd ky er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es ly"><img src="../Images/aebf241ee1cc819bb43bcabfd99e8dff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rQZMaM-lux7Cynj7gv50-Q.png"/></div></div><figcaption class="lf lg et er es lh li bd b be z dx translated">Azure部署输出</figcaption></figure><p id="b985" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以下是完整的二头肌模板:</p><pre class="ki kj kk kl fd km kn ko kp aw kq bi"><span id="0d44" class="kr jf hi kn b fi ks kt l ku kv">param adminUserName string<br/>param dnsLabelPrefix string<br/>param windowsOSVersion string = '2019-Datacenter'<br/>param vmSize string = 'Standard_D2_v3'<br/>param location string = resourceGroup().location</span><span id="957a" class="kr jf hi kn b fi kw kt l ku kv"><a class="ae kh" href="http://twitter.com/secure" rel="noopener ugc nofollow" target="_blank">@secure</a>()<br/>param adminPassword string</span><span id="daee" class="kr jf hi kn b fi kw kt l ku kv">var storageAccountName = 'drendonwinvmsa'<br/>var nicName = 'myVMNic'<br/>var addressPrefix = '10.0.0.0/16'<br/>var subnetName = 'Subnet'<br/>var subnetPrefix = '10.0.0.0/24'<br/>var publicIPAddressName = 'myPublicIP'<br/>var vmName = 'winVm'<br/>var virtualNetworkName = 'MyVNET'<br/>var subnetRef = '${vn.id}/subnets/${subnetName}'<br/>var networkSecurityGroupName = 'default-NSG'</span><span id="4b2f" class="kr jf hi kn b fi kw kt l ku kv">resource stg 'Microsoft.Storage/storageAccounts@2019-06-01' = {<br/>  name: storageAccountName<br/>  location: location<br/>  sku: {<br/>    name: 'Standard_LRS'<br/>  }<br/>  kind: 'Storage'<br/>}</span><span id="aeb4" class="kr jf hi kn b fi kw kt l ku kv">resource pip 'Microsoft.Network/publicIPAddresses@2020-06-01' = {<br/>  name: publicIPAddressName<br/>  location: location<br/>  properties: {<br/>    publicIPAllocationMethod: 'Dynamic'<br/>    dnsSettings: {<br/>      domainNameLabel: dnsLabelPrefix<br/>    }<br/>  }<br/>}</span><span id="877a" class="kr jf hi kn b fi kw kt l ku kv">resource sg 'Microsoft.Network/networkSecurityGroups@2020-06-01' = {<br/>  name: networkSecurityGroupName<br/>  location: location<br/>  properties: {<br/>    securityRules: [<br/>      {<br/>        name: 'default-allow-3389'<br/>        'properties': {<br/>          priority: 1000<br/>          access: 'Allow'<br/>          direction: 'Inbound'<br/>          destinationPortRange: '3389'<br/>          protocol: 'Tcp'<br/>          sourcePortRange: '*'<br/>          sourceAddressPrefix: '*'<br/>          destinationAddressPrefix: '*'<br/>        }<br/>      }<br/>    ]<br/>  }<br/>}</span><span id="f55e" class="kr jf hi kn b fi kw kt l ku kv">resource vn 'Microsoft.Network/virtualNetworks@2020-06-01' = {<br/>  name: virtualNetworkName<br/>  location: location<br/>  properties: {<br/>    addressSpace: {<br/>      addressPrefixes: [<br/>        addressPrefix<br/>      ]<br/>    }<br/>    subnets: [<br/>      {<br/>        name: subnetName<br/>        properties: {<br/>          addressPrefix: subnetPrefix<br/>          networkSecurityGroup: {<br/>            id: sg.id<br/>          }<br/>        }<br/>      }<br/>    ]<br/>  }<br/>}</span><span id="cd0d" class="kr jf hi kn b fi kw kt l ku kv">resource nInter 'Microsoft.Network/networkInterfaces@2020-06-01' = {<br/>  name: nicName<br/>  location: location</span><span id="be13" class="kr jf hi kn b fi kw kt l ku kv">properties: {<br/>    ipConfigurations: [<br/>      {<br/>        name: 'ipconfig1'<br/>        properties: {<br/>          privateIPAllocationMethod: 'Dynamic'<br/>          publicIPAddress: {<br/>            id: pip.id<br/>          }<br/>          subnet: {<br/>            id: subnetRef<br/>          }<br/>        }<br/>      }<br/>    ]<br/>  }<br/>}</span><span id="d69e" class="kr jf hi kn b fi kw kt l ku kv">resource VM 'Microsoft.Compute/virtualMachines@2020-06-01' = {<br/>  name: vmName<br/>  location: location<br/>  properties: {<br/>    hardwareProfile: {<br/>      vmSize: vmSize<br/>    }<br/>    osProfile: {<br/>      computerName: vmName<br/>      adminUsername: adminUserName<br/>      adminPassword: adminPassword<br/>    }<br/>    storageProfile: {<br/>      imageReference: {<br/>        publisher: 'MicrosoftWindowsServer'<br/>        offer: 'WindowsServer'<br/>        sku: windowsOSVersion<br/>        version: 'latest'<br/>      }<br/>      osDisk: {<br/>        createOption: 'FromImage'<br/>      }<br/>      dataDisks: [<br/>        {<br/>          diskSizeGB: 1023<br/>          lun: 0<br/>          createOption: 'Empty'<br/>        }<br/>      ]<br/>    }<br/>    networkProfile: {<br/>      networkInterfaces: [<br/>        {<br/>          id: nInter.id<br/>        }<br/>      ]<br/>    }<br/>    diagnosticsProfile: {<br/>      bootDiagnostics: {<br/>        enabled: true<br/>        storageUri: stg.properties.primaryEndpoints.blob<br/>      }<br/>    }<br/>  }<br/>}</span><span id="07c8" class="kr jf hi kn b fi kw kt l ku kv">output hostname string = pip.properties.dnsSettings.fqdn</span></pre><p id="7da6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">希望通过这些例子，您可以更好地理解如何利用Bicep功能来保护参数中的敏感数据。</p><p id="9202" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae kh" href="http://eepurl.com/gKmLdf" rel="noopener ugc nofollow" target="_blank"> <em class="jd">在此加入</em><strong class="ih hj"><em class="jd">azin sider</em></strong><em class="jd">邮箱列表。</em>T11】</a></p><p id="ead7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">-戴夫·r</em></p></div></div>    
</body>
</html>