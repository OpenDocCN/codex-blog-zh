<html>
<head>
<title>Python For Everyday Automation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用于日常自动化的Python</h1>
<blockquote>原文：<a href="https://medium.com/codex/python-for-everyday-automation-2e54cbf5c5e1?source=collection_archive---------0-----------------------#2022-11-01">https://medium.com/codex/python-for-everyday-automation-2e54cbf5c5e1?source=collection_archive---------0-----------------------#2022-11-01</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/41749f597ada0f02bd5b1b123ca59ec2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1144/format:webp/0*BBzdTrKK4e_FNK8O.png"/></div><figcaption class="im in et er es io ip bd b be z dx translated">图片来自<a class="ae iq" href="https://res.cloudinary.com/" rel="noopener ugc nofollow" target="_blank">https://res.cloudinary.com</a></figcaption></figure><p id="ce50" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">我是一名模型风险分析师&amp;我的日常工作包括处理大量模型库存数据的治理，为此我最终使用excel表&amp; word文档来处理几乎任何事情。今天，我将谈谈我在Python中用来自动化大部分excel任务的几个函数。我们开始吧！</p><ol class=""><li id="2dff" class="jp jq hi it b iu iv iy iz jc jr jg js jk jt jo ju jv jw jx bi translated"><strong class="it hj">用Glob Library整合文件和文件夹</strong></li></ol><p id="6ca5" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">Python的os、shutil &amp; glob模块是文件处理活动的有效方式。以下是管理您正在使用的目录的一些基本方法:</p><pre class="jy jz ka kb fd kc kd ke bn kf kg bi"><span id="3827" class="kh ki hi kd b be kj kk l kl km">import os <br/>import shutil<br/>import glob<br/><br/>#return current working directory(cwd)<br/>cwd = os.getcwd()<br/>#change cwd location<br/>os.chdir('/Users/sammitiyadav/Desktop')<br/>#add a folder in the cwd <br/>os.mkdir('new folder')<br/>#delete folder from the cwd<br/>os.rmdir('new folder')<br/>#create paths without having to use slashes <br/>os.path.join(cwd, 'new folder')<br/>#check if the directory exists <br/>os.path.isdir(cwd) #returns true if it does and false otherwise<br/>#change paths(location) of a file <br/>#os.rename(old path, new path)<br/>os.rename('test.xlsx', os.path.join(cwd, 'new folder', 'test.xlsx'))<br/>shutil.move('test.xlsx', os.path.join(cwd, 'new folder', 'test.xlsx')) #performing same function with shutil module<br/>this is the path the file is moved to ---&gt; '/Users/sammitiyadav/Desktop/new folder/test.xlsx'<br/>#copy files from one location to another<br/>shutil.copy('test.xlsx', os.path.join(cwd, 'new folder', 'test.xlsx'))<br/>#copy folder from one location to another <br/>shutil.copytree('new folder', 'old folder')<br/>#change paths(location) of the folder<br/>#os.renames(old path, new path)<br/>os.renames('new folder', 'new test folder')<br/>#returns list of all the files in a cwd<br/>files = glob.glob('*')</span></pre><p id="3994" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">让我们使用上述所有函数来编写一个代码，将文件移动到相应的文件夹中&amp;如果文件夹不存在，就创建一个文件夹</p><pre class="jy jz ka kb fd kc kd ke bn kf kg bi"><span id="baa2" class="kh ki hi kd b be kj kk l kl km">import os <br/>import shutil<br/>import glob<br/>class MoveFiles:<br/>  <br/>    def move_files(self):<br/>        os.chdir('/Users/sammitiyadav/Desktop/Project')<br/>        cwd = os.getcwd()<br/>        print(cwd)<br/>        files = glob.glob('*.xlsx')<br/>        print(files)<br/>        for file in files:<br/>            name = name = file.split('.')[-2]<br/>            if (os.path.isdir(name)) == False:<br/>                os.mkdir(name)<br/>            shutil.move(file, os.path.join(cwd, name, file))<br/>        <br/>if __name__ == '__main__': <br/>        <br/>        move_obj = MoveFiles()<br/>        move_obj.move_files()</span></pre><p id="aecd" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">2.<strong class="it hj">从数据帧</strong>读取&amp;写入文件到&amp;</p><p id="1024" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">为了读取excel和CSV文件，pandas模块中有一些方法可以解析它们并将其存储在pandas数据框中。数据帧结构存储允许我们对存储在文件中的数据执行许多功能。</p><pre class="jy jz ka kb fd kc kd ke bn kf kg bi"><span id="bee7" class="kh ki hi kd b be kj kk l kl km">import pandas as pd<br/>df = pd.read_csv(filename.csv)<br/>df = pd.read_excel(filename.xlsx) #both methods parses files &amp; store them as dataframe. See fig. of the df below<br/>df.head() #viewing first 5 coulmns of the dataset<br/>df.to_csv(filepath.csv) <br/>df.to_excel(filepath.xlsx) #saving a df as filepath</span></pre><figure class="jy jz ka kb fd ij er es paragraph-image"><div class="er es kn"><img src="../Images/be61f7b42b165cff06157866269d492e.png" data-original-src="https://miro.medium.com/v2/resize:fit:588/format:webp/1*uDoH4CdCOXdjoc6cuc1LVA.png"/></div><figcaption class="im in et er es io ip bd b be z dx translated">数据帧</figcaption></figure><p id="f92d" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated"><strong class="it hj"> 3。切片/编辑excel表格</strong></p><p id="a790" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">在我们将excel转换成数据框之后。我们可以在上面执行许多功能。下面是其中的几个例子:</p><pre class="jy jz ka kb fd kc kd ke bn kf kg bi"><span id="1087" class="kh ki hi kd b be kj kk l kl km">#df showing only the rows which has profit value &gt;30<br/>df_profit30 = df[df['profit']&gt;30]<br/>df_profit30.head()<br/>#adding a boolen column which tells profit is greater than 30<br/>df['profit &gt;30?'] = df['profit'].apply(lambda x: x&gt;30)<br/>df.head()</span></pre><figure class="jy jz ka kb fd ij er es paragraph-image"><div class="er es kn"><img src="../Images/b61fbcafb6263e20e267c7df1fabfb04.png" data-original-src="https://miro.medium.com/v2/resize:fit:588/format:webp/1*HgAvbXur7cONb7kogCxwog.png"/></div><figcaption class="im in et er es io ip bd b be z dx translated">显示利润值&gt; 30的数据框架</figcaption></figure><figure class="jy jz ka kb fd ij er es paragraph-image"><div class="er es ko"><img src="../Images/0cf6800de6e5fbd261a2eeb12b574ab9.png" data-original-src="https://miro.medium.com/v2/resize:fit:724/format:webp/1*qbOkgdNGVtbid4HxfM1ElQ.png"/></div><figcaption class="im in et er es io ip bd b be z dx translated">带有布尔列的数据框架，表明利润是否大于30</figcaption></figure><p id="338f" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated"><strong class="it hj"> 4。写入从</strong> <strong class="it hj"> word文档中提取的&amp;。</strong></p><p id="5fb8" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">Docx模块中的文档类允许我们读写word文档。一些单调的任务，如将数据从excel转换到word文档。或者从中提取可以使用这个模块自动完成。</p><p id="482b" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">一旦你创建了一个类文档的对象，你就可以访问所有的段落和它们的属性来处理一个文档。下面提到了开始学习本模块的一些基本方法:</p><pre class="jy jz ka kb fd kc kd ke bn kf kg bi"><span id="e0df" class="kh ki hi kd b be kj kk l kl km">from docx import document <br/>doc = Document("document path.docx") #creating an object<br/><br/>all_para = doc.paragraphs #fetching all paragraghs <br/>tables = doc.tables<br/>for para in doc.paragraphs:<br/>    print(para.text) #iteratively printing all paragrahs<br/>specific_para = doc.paragraphs[3]<br/>print(specific_para.text) accessing specific paragraph <br/>doc.add_paragraphs("Add this para")<br/>doc.add_table(#rows, #cols)<br/>doc.add_headings("This is the heading" , 0)<br/>doc.save("document path.docx)<br/>#runs is the stack of text in the paragragh having similar properties like font size, shape &amp; styles. Runs can be added in the documents to edit similar lines to text or sequesnce of words, tables etc.<br/>for para in doc.paragraphs:<br/>    para.add_run() <br/>    run = para[0].runs[0]<br/>    run.font.bold = True <br/>    run.font.size = Pt(8)</span></pre><p id="fca2" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">现在，让我们使用上述所有函数编写一个小代码来分割数据帧，并将其作为表格添加到word doc中。并从中提取</p><pre class="jy jz ka kb fd kc kd ke bn kf kg bi"><span id="042b" class="kh ki hi kd b be kj kk l kl km">import os<br/>from docx import Document<br/>import pandas as pd<br/>from dataclasses import dataclass <br/>from docx.shared import Pt, Inches<br/>@dataclass<br/>class InputFiles:<br/>    <br/>    file_name: str<br/>    file_path: str<br/>        <br/>    def read_files(self):<br/>          if self.file_name.endswith('.xlsx') == True:<br/>            self.df_file = pd.read_excel(f"{self.file_path}/{self.file_name}")<br/>            return self.df_file<br/>          else:<br/>            self.df_file = pd.csv(f"{self.file_path}/{self.file_name}")<br/>            return self.df_file<br/>class WriteToWord(InputFiles):<br/>    <br/>    def add_tables(self, doc, df):<br/>            <br/>        para = doc.add_paragraph("Table") <br/>        para.add_run()     <br/>        run = para.runs[0]<br/>        run.font.bold = True <br/>        run.font.size = Pt(20)  <br/>  <br/>        tab = doc.add_table(df.shape[0] +1, df.shape[1])<br/>        #tab.style = 'TableGrid'<br/>        tab.autofit = False<br/>        <br/>        #adding the headers in the table<br/>        for j in range(df.shape[-1]):<br/>                tab.cell(0,j).text = df.columns[j]<br/>                run = tab.cell(0,j).paragraphs[0].runs[0]<br/>                run.font.bold = True<br/>                run.font.size = Pt(10)<br/>     <br/>       #adding the rest of the data to the table<br/>        for i in range(df.shape[0]):<br/>               for j in range(df.shape[-1]):<br/>                    tab.cell(i+1,j).text = str(df.values[i,j])<br/>                    run = tab.cell(i+1,j).paragraphs[0].runs[0]<br/>                    run.font.bold = True<br/>                    run.font.size = Pt(10)         <br/>                    <br/>    def extract(self, path, doc):<br/>        <br/>            df1 = pd.DataFrame() <br/>            #accessing tables from document<br/>            table_count = len(doc.tables)<br/>            for i in range(table_count):<br/>                tb = doc.tables<br/>                rows = tb[i].rows<br/>                for j, row in enumerate(rows):<br/>                    if (j &gt; 0):<br/>                        row_text = [c.text for c in row.cells]<br/>                        df1 = df1.append([row_text], ignore_index = True)<br/>                        <br/>            df1.to_excel(os.path.join(path,"test1.xlsx"))<br/>if __name__ == "__main__":                           <br/>    dataset = WriteToWord(file_name = 'test.xlsx', file_path = '/Users/sammitiyadav/Desktop') <br/>    input_df = dataset.read_files() <br/>    doc = Document('/Users/sammitiyadav/Desktop/Test_Doc.docx')<br/>    dataset.add_tables(doc, input_df)<br/>    doc.save('/Users/sammitiyadav/Desktop/Test_Doc.docx')<br/>    dataset.extract('/Users/sammitiyadav/Desktop', doc)<br/>    doc.save('/Users/sammitiyadav/Desktop/Test_Doc.docx')</span></pre><figure class="jy jz ka kb fd ij er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es kp"><img src="../Images/dcf8356c3cb3a7772704f83bb3d36560.png" data-original-src="https://miro.medium.com/v2/resize:fit:828/format:webp/1*zcjTVayzseWoYg0UmzRy7w.png"/></div></div><figcaption class="im in et er es io ip bd b be z dx translated">test.xlsx</figcaption></figure><figure class="jy jz ka kb fd ij er es paragraph-image"><div class="er es ku"><img src="../Images/6b2c0c8674ee85178231a9d465cae337.png" data-original-src="https://miro.medium.com/v2/resize:fit:808/format:webp/1*m_FBRyqwlhaT7M5_DdaGHg.png"/></div><figcaption class="im in et er es io ip bd b be z dx translated">Test_Doc.docx</figcaption></figure><p id="187a" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated"><strong class="it hj"> 5。执行Excel功能</strong></p><p id="d746" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">很多日常使用的excel函数都可以用python转换成可重用的函数。下面是一些例子:</p><p id="0f53" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">一. Vlookup</p><p id="8772" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">python中的Vlookup可以通过对数据帧的合并方法来实现</p><pre class="jy jz ka kb fd kc kd ke bn kf kg bi"><span id="8cac" class="kh ki hi kd b be kj kk l kl km">temp = data.merge(data2, how ='left', left_on = 'cust_ID', right_on = 'cust_ID')<br/>temp #merge dataframe with all the values from left dataframe on customer id.</span></pre><figure class="jy jz ka kb fd ij er es paragraph-image"><div class="er es kv"><img src="../Images/73c3df4076cda10bd90fe7dfa5060c82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1088/format:webp/1*T30MlOUsfzybN65I3t9l-Q.png"/></div><figcaption class="im in et er es io ip bd b be z dx translated">数据帧1 /数据帧2</figcaption></figure><figure class="jy jz ka kb fd ij er es paragraph-image"><div class="er es kw"><img src="../Images/50a079c26104aae5b953cc082583a43b.png" data-original-src="https://miro.medium.com/v2/resize:fit:826/format:webp/1*ofIOHm46tLY7umbL6dRa9w.png"/></div><figcaption class="im in et er es io ip bd b be z dx translated">合并数据集</figcaption></figure><p id="7612" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">在合并的数据集中，您将看不到cust_ID = 1008，它位于右侧数据框中，因为我们的合并位于左侧</p><p id="11e2" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">二。数据透视表</p><p id="5c3d" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">pandas中有一个数据透视表方法，可以让您像在excel中一样实现数据透视表。该方法采用、行、列、值和被查看值的聚合函数。请看下面的方法:</p><pre class="jy jz ka kb fd kc kd ke bn kf kg bi"><span id="7ed0" class="kh ki hi kd b be kj kk l kl km">import numpy as np<br/>pd.pivot_table(temp, values= 'profit', <br/>               index= ['cust_seg'],<br/>               aggfunc = np.sum)</span></pre><figure class="jy jz ka kb fd ij er es paragraph-image"><div class="er es kx"><img src="../Images/67cfd48abf17d2c99a38d3aabf22b7eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:350/format:webp/1*SLP8BPbkBSONkgt1Mlh52g.png"/></div><figcaption class="im in et er es io ip bd b be z dx translated">数据透视表</figcaption></figure><p id="5068" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">我们使用上述临时数据框架来查看各细分市场的利润总额。</p><p id="d777" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">三。COUNTIF的SUMIF</p><p id="9e3a" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">考虑来自Vlookup的合并数据帧&amp;参见下面这些函数的python等效方法</p><figure class="jy jz ka kb fd ij er es paragraph-image"><div class="er es kw"><img src="../Images/50a079c26104aae5b953cc082583a43b.png" data-original-src="https://miro.medium.com/v2/resize:fit:826/format:webp/1*ofIOHm46tLY7umbL6dRa9w.png"/></div><figcaption class="im in et er es io ip bd b be z dx translated">合并数据集</figcaption></figure><pre class="jy jz ka kb fd kc kd ke bn kf kg bi"><span id="c5d3" class="kh ki hi kd b be kj kk l kl km">#COUNTIF<br/>len(temp[temp['profit'] &gt;30]) #counting the rows for profit &gt;30<br/>----&gt; 5<br/>#SUMIF<br/>np.sum(temp[(temp['profit'] &gt;30) &amp; (temp['cust_seg'] == 'Tech')])['profit']  #sum of profit for profit &gt; 30 &amp; cust_seg is Tech<br/>----&gt; 170</span></pre><p id="bcf5" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated"><strong class="it hj"> 6。设置每周循环</strong></p><p id="6b81" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">可以在python中使用调度模块定期运行作业(python函数或任何其他可调用函数)。例如，我们在开始时运行的用于传输文件的代码可以使用该调度模块被调度为每周运行一次。参见模块的语法和一些基本方法:</p><pre class="jy jz ka kb fd kc kd ke bn kf kg bi"><span id="b302" class="kh ki hi kd b be kj kk l kl km">import schedule<br/>import time<br/><br/>def job():<br/>    print("I'm writing...")<br/><br/>schedule.every(10).seconds.do(job)<br/>schedule.every(10).minute.do(job)<br/>schedule.every().hour.do(job)<br/>schedule.every().monday.do(job)<br/>schedule.every().wednesday.at("13:15").do(job)<br/><br/>while True:<br/>    schedule.run_pending()<br/>    time.sleep(1)</span></pre><p id="fb21" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">在这里阅读更多关于这个模块的内容—→【https://schedule.readthedocs.io/en/stable/ T2】</p><p id="29aa" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">现在让我们安排我们的“将文件移动到各自的文件夹”代码在每周三上午11:00运行。参见下面的代码:</p><pre class="jy jz ka kb fd kc kd ke bn kf kg bi"><span id="7440" class="kh ki hi kd b be kj kk l kl km">import os <br/>import shutil<br/>import glob<br/>class MoveFiles:<br/>  <br/>    def move_files(self):<br/>        os.chdir('/Users/sammitiyadav/Desktop/Project')<br/>        cwd = os.getcwd()<br/>        print(cwd)<br/>        files = glob.glob('*.xlsx')<br/>        print(files)<br/>        for file in files:<br/>            name = name = file.split('.')[-2]<br/>            if (os.path.isdir(name)) == False:<br/>                os.mkdir(name)<br/>            shutil.move(file, os.path.join(cwd, name, file))<br/>        <br/>if __name__ == '__main__': <br/>        <br/>        move_obj = MoveFiles()<br/>        move_obj.move_file()<br/>          schedule.every().wednesday.at('11:00').do(move_obj.move_files)<br/>        while True:<br/>            schedule.run_pending()<br/>            time.sleep(1)</span></pre><p id="c53a" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">我从https://www.geeksforgeeks.org/的<a class="ae iq" href="https://www.geeksforgeeks.org/" rel="noopener ugc nofollow" target="_blank">学了很多基础知识</a></p><p id="c883" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">如果你有更多的建议来自动化我的日常工作。请放在评论区。</p><p id="eb85" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">感谢阅读:-)希望这篇文章对你有所帮助！</p></div></div>    
</body>
</html>