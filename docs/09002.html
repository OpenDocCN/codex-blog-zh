<html>
<head>
<title>Tips to run Cron Jobs reliably using Spring Boot on Kubernetes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Kubernetes上使用Spring Boot可靠地运行Cron作业的技巧</h1>
<blockquote>原文：<a href="https://medium.com/codex/tips-to-run-cron-jobs-reliably-using-spring-boot-on-kubernetes-bb28052e8972?source=collection_archive---------1-----------------------#2022-09-18">https://medium.com/codex/tips-to-run-cron-jobs-reliably-using-spring-boot-on-kubernetes-bb28052e8972?source=collection_archive---------1-----------------------#2022-09-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/4b69d209250b5bef7348fbec3fa7a6f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*zddCGpTi-bjmSW8N"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">詹姆斯·哈里逊在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="1f7d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Spring Boot提供了一种非常简单的方法，使用<a class="ae iu" href="https://www.baeldung.com/spring-scheduled-tasks" rel="noopener ugc nofollow" target="_blank"> Spring Scheduler </a>在应用程序中设置Cron作业。它可以很容易地打包到一个容器中，并部署在Kubernetes上，它的工作非常有魅力。</p><p id="b868" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们所有的生产应用程序都使用Spring Scheduler来运行cron作业。一个警告是，应用程序可以在单个pod上运行，因为它缺乏在多个实例上同步调度的能力，这有效地降低了cron作业的弹性和可靠性。</p><h1 id="726f" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">我们如何解决这个问题？</h1><h2 id="58a7" class="kr ju hi bd jv ks kt ku jz kv kw kx kd jg ky kz kh jk la lb kl jo lc ld kp le bi translated"><strong class="ak">运行多个pod副本</strong></h2><p id="7e69" class="pw-post-body-paragraph iv iw hi ix b iy lf ja jb jc lg je jf jg lh ji jj jk li jm jn jo lj jq jr js hb bi translated">Shedlock非常方便，因为它提供了一种在多个实例上同步作业的方法，确保我们计划的作业在同一时间只运行一次。</p><p id="e7d6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我发现这篇由Baeldung撰写的<a class="ae iu" href="https://www.baeldung.com/shedlock-spring" rel="noopener ugc nofollow" target="_blank">文章</a>对于在您的Spring Boot项目中快速启动Shedlock非常有用。</p><p id="f967" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">还不完美……</strong></p><p id="cfc7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在我们能够在K8s上运行多个pod副本。一切看起来不错。唉，在一个晴朗的日子，我们注意到一个问题，当集群中有一个计划的Kubernetes升级时，管理员以翻转的方式清空节点，不幸的是，我们的两个cron服务pods都被安排在同一个节点上，因此它们在同一时间关闭，因此计划的作业没有运行。</p><h2 id="7855" class="kr ju hi bd jv ks kt ku jz kv kw kx kd jg ky kz kh jk la lb kl jo lc ld kp le bi translated"><strong class="ak">使用PDB </strong></h2><p id="08ab" class="pw-post-body-paragraph iv iw hi ix b iy lf ja jb jc lg je jf jg lh ji jj jk li jm jn jo lj jq jr js hb bi translated">为了减轻这种情况，我们在Kubernetes中尝试了一个名为<a class="ae iu" href="https://kubernetes.io/docs/tasks/run-application/configure-pdb/" rel="noopener ugc nofollow" target="_blank"> Pod中断预算</a> (PDB)的功能，它可以防止这种自愿的管理操作被暂停，并确保我们在任何给定的时间都有最小数量的Pod在运行。</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div class="er es lk"><img src="../Images/0a363a6445a02232bd0133bf8d257224.png" data-original-src="https://miro.medium.com/v2/resize:fit:1312/format:webp/1*0yawtcM18s5vpruTOqGMeA.png"/></div></figure><p id="dda4" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">拥有上述PDB可以确保我们在任何给定的时间点总是有一个有保证的pod在K8S集群中运行。</p><p id="bd02" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">生产环境中的所有生产作业现在都在以可恢复的方式运行:)</p><blockquote class="lp lq lr"><p id="052b" class="iv iw ls ix b iy iz ja jb jc jd je jf lt jh ji jj lu jl jm jn lv jp jq jr js hb bi translated">如果你喜欢这篇文章，请花点时间为我鼓掌👏(可以多次鼓掌)，关注我，甚至请我喝咖啡<a class="ae iu" href="https://www.buymeacoffee.com/abhiandy" rel="noopener ugc nofollow" target="_blank">https://www.buymeacoffee.com/abhiandy</a></p></blockquote></div></div>    
</body>
</html>