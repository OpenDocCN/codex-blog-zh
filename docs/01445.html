<html>
<head>
<title>Log4J2 | Create custom log levels and how to use them</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Log4J2 |创建自定义日志级别以及如何使用它们</h1>
<blockquote>原文：<a href="https://medium.com/codex/log4j2-create-custom-log-levels-and-how-to-use-them-48685e133fd1?source=collection_archive---------0-----------------------#2021-04-30">https://medium.com/codex/log4j2-create-custom-log-levels-and-how-to-use-them-48685e133fd1?source=collection_archive---------0-----------------------#2021-04-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/065d1530e7e0543721f3bb0fb74e2d98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*yqlJz_BZS-YFCMR1"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">照片由<a class="ae iu" href="https://unsplash.com/@usefulcollective?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">稍微有用的</a>在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></figcaption></figure><p id="fd68" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">昨天我遇到了问题，我需要用不同的日志风格(不同的颜色，其他的信息顺序)记录我的应用程序的一些事件。我仍然想使用同一个记录器，不想为每种风格创建一个新的。怎么做呢？具有自定义日志级别。</p><h1 id="1c06" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">什么是日志级别？</h1><p id="1042" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated"><a class="ae iu" href="https://logging.apache.org/log4j/2.x/manual/customloglevels.html" rel="noopener ugc nofollow" target="_blank">日志级别</a>用于根据重要性区分不同的日志。log4J已经预定义了一些非常有用的日志级别。</p><figure class="kx ky kz la fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kw"><img src="../Images/1017d605cc1a29260b44a94d39772fd5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qEEJPYoKBehbmXEVax0ppw.png"/></div></div></figure><p id="5191" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如您所见，数字越大，记录的信息就越多。如果为null，则无论使用什么日志级别来记录，都不会记录任何内容。这些日志的重要性也基于intLevel。日志级别越高越重要。例如，致命性非常重要，很少被记录。</p><h1 id="acfa" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">创建自定义日志级别</h1><p id="0ce1" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">首先，我们需要在build.gradle文件中添加Log4J2作为依赖项。</p><figure class="kx ky kz la fd ij"><div class="bz dy l di"><div class="lb lc l"/></div></figure><p id="2dab" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们需要log4J的核心和api，我们可以从配置log4j2.xml文件开始。</p><p id="0a54" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Log4J会在你的项目中寻找不同的文件。我们可以配置不同类型的文件，但是在我们的例子中，我们将坚持使用log4j2.xml文件。它用于配置记录器和日志级别。</p><figure class="kx ky kz la fd ij"><div class="bz dy l di"><div class="lb lc l"/></div></figure><p id="be18" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">就在文件的顶部，我们创建了一个新的自定义级别，名为SUCCESS，intLevel为350。如果您将这个intLevel与上面的表进行比较，您可以看到，每当至少info级别处于活动状态时，都会记录这个日志级别。</p><p id="5d51" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">第二部分是我们的appender的定义。在这种情况下，我们只使用普通的SYSTEM_OUT作为控制台。模式布局也很重要，并且易于使用。在这种配置中，只有消息以高亮颜色打印出来。这些颜色是为每个日志级别定义的。例如，错误被打印为红色。</p><p id="8958" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">最后一部分是配置记录器本身。记录器将具有它在其中被实例化的类的名称。您可以设置默认日志级别和<a class="ae iu" href="https://logging.apache.org/log4j/2.x/manual/configuration.html#Additivity" rel="noopener ugc nofollow" target="_blank">相加性</a>。这通常被设置为false，因为如果它被设置为true，您将从根日志记录器和您定义的日志记录器接收两次每个日志事件。Appender Ref定义了日志应该放在哪里。在我们的例子中，只是命令行。</p><h1 id="19d7" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">使用日志级别</h1><p id="fff8" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">为了使用我们上面定义的<a class="ae iu" href="https://logging.apache.org/log4j/2.x/manual/customloglevels.html#Defining%20Custom%20Log%20Levels%20in%20Code" rel="noopener ugc nofollow" target="_blank">自定义日志级别</a>，我们必须为日志记录器创建一个扩展函数。这是成功等级的样子:</p><figure class="kx ky kz la fd ij"><div class="bz dy l di"><div class="lb lc l"/></div></figure><h2 id="b708" class="ld ju hi bd jv le lf lg jz lh li lj kd jg lk ll kh jk lm ln kl jo lo lp kp lq bi translated">创建记录器的实例</h2><p id="78df" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">使用日志记录器最简单的方法是用LogManager创建一个新的日志记录器，并从那里调用日志级别。</p><figure class="kx ky kz la fd ij"><div class="bz dy l di"><div class="lb lc l"/></div></figure><p id="4b9e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这种方式经常被使用，因为它真的很容易使用，第一次眨眼就能理解。现在我将向你展示另一种方法。</p><h2 id="e5f1" class="ld ju hi bd jv le lf lg jz lh li lj kd jg lk ll kh jk lm ln kl jo lo lp kp lq bi translated">使用Kotlin代理</h2><p id="2134" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">因为我们使用的是Kotlin，所以我们有机会使用Kotlin Delegate，这在本例中非常有用。如果你不知道Kolin Delegate是什么或者它做什么，请阅读<a class="ae iu" rel="noopener" href="/yellowme/delegation-pattern-in-kotlin-a0ce5c5bb89f">这篇关于它的</a>文章。它帮助我很好地理解它。</p><figure class="kx ky kz la fd ij"><div class="bz dy l di"><div class="lb lc l"/></div></figure><p id="9cf9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">请注意带有的部分</p><pre class="kx ky kz la fd lr ls lt lu aw lv bi"><span id="dfa2" class="ld ju hi ls b fi lw lx l ly lz">Logger by LogManager.getLogger()</span></pre><p id="9fce" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这将LogManager.getLogger()委托给我自己的类，使它能够立即使用信息或成功日志记录，而不必实际创建对象。委托也不依赖于基类。</p><p id="5b58" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这些日志的输出可能如下所示。这取决于log4j2.xml文件中的配置。</p><figure class="kx ky kz la fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ma"><img src="../Images/58c93e1724d2881e13eb447c6d61e25f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Dl2pglyduv5LvvCx.png"/></div></div></figure><h1 id="112d" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">反射</h1><h2 id="ad42" class="ld ju hi bd jv le lf lg jz lh li lj kd jg lk ll kh jk lm ln kl jo lo lp kp lq bi translated">什么进展顺利</h2><p id="5a92" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">log4j2本身的使用非常简单快捷。此外，配置的可能性几乎是无限的。配置这些日志的输出也有很多可能性，但是我选择了log4j2.xml文件，因为它对我来说是最容易理解的。</p><h2 id="9d8d" class="ld ju hi bd jv le lf lg jz lh li lj kd jg lk ll kh jk lm ln kl jo lo lp kp lq bi translated">什么需要改进</h2><p id="6c6c" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">开始时，我在使用正确的日志级别来注销我的自定义日志级别时遇到了一些麻烦。我遇到的另一个问题是使用Kotlin委托。最后，并没有那么复杂，我只是忘记了实现中的一个小细节，正因为如此，它总是失败。</p><p id="e165" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我希望这篇文章对你有用😃</p></div></div>    
</body>
</html>