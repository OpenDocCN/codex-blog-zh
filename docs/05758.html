<html>
<head>
<title>Spring Boot Logging</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Spring Boot伐木公司</h1>
<blockquote>原文：<a href="https://medium.com/codex/spring-boot-logging-da61911ce8e6?source=collection_archive---------4-----------------------#2022-03-27">https://medium.com/codex/spring-boot-logging-da61911ce8e6?source=collection_archive---------4-----------------------#2022-03-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div class="er es hg"><img src="../Images/af6512536be076ef07efc9ab93261fbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1386/format:webp/1*C_G9-06JZRsZxUiU-7w2pw.jpeg"/></div><figcaption class="hn ho et er es hp hq bd b be z dx translated">日志中包含的详细信息</figcaption></figure><div class=""/><p id="6686" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Spring Boot使用<a class="ae jo" href="https://commons.apache.org/proper/commons-logging/index.html" rel="noopener ugc nofollow" target="_blank"> Apache Commons logging </a>进行所有内部日志记录，但是底层日志实现是灵活的。您可以使用<strong class="is hu"> Util Logging </strong>、<a class="ae jo" href="https://logging.apache.org/log4j/2.x/" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu"> Log4j2 </strong> </a>和<a class="ae jo" href="https://logback.qos.ch/" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu"> Logback </strong> </a>，并且对于每一个都预先配置为使用控制台输出，也可以使用可选的文件输出。在Spring Boot，默认情况下，如果你使用启动器，你将得到<strong class="is hu"> Logback </strong>实现。</p><figure class="jp jq jr js fd hk er es paragraph-image"><div class="er es hg"><img src="../Images/d412b949477932331997f601c42bb7fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1386/format:webp/1*VWtZovJh0duTdncRr_wGag.png"/></div></figure><p id="705a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">另一方面，对于公共API，Spring Boot使用SLF4J(Java的简单日志接口),它允许程序员选择不同的日志框架。</p><h1 id="03a0" class="jt ju ht bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">日志记录级别</h1><p id="2c7e" class="pw-post-body-paragraph iq ir ht is b it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn hb bi translated">日志记录级别有助于控制不同环境中的日志输出。基于这些级别，您可以根据需要记录适当的信息。</p><figure class="jp jq jr js fd hk er es paragraph-image"><div class="er es hg"><img src="../Images/33e07f9f18c888cbb6f7453be5b19f6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1386/format:webp/1*BE8zmsGuwhtOCN9g8O2uaw.png"/></div><figcaption class="hn ho et er es hp hq bd b be z dx translated">包括日志级别和详细信息</figcaption></figure><p id="bb41" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在上表中，您可以看到每个日志记录级别将包括输出中的详细信息和日志类型。TRACE包含所有类型的日志，ERROR只包含错误日志。所有受支持的日志系统都可以在Spring环境中设置日志级别。</p><h2 id="18ae" class="kw ju ht bd jv kx ky kz jz la lb lc kd jb ld le kh jf lf lg kl jj lh li kp lj bi translated"><strong class="ak">命令行虚拟机选项</strong></h2><p id="a256" class="pw-post-body-paragraph iq ir ht is b it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn hb bi translated">使用以下格式的属性，您可以根据您对命令行VM选项的要求，为root或任何其他记录器(包名)设置记录器级别:</p><pre class="jp jq jr js fd lk ll lm ln aw lo bi"><span id="7dd1" class="kw ju ht ll b fi lp lq l lr ls">java -jar <strong class="ll hu">-Dlogging.level.&lt;logger-name&gt;=&lt;level&gt;</strong> application.jar</span></pre><p id="5d26" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这个命令中<code class="du lt lu lv ll b">&lt;level&gt;</code>是跟踪、调试、信息、警告、错误、致命或关闭中的一个。此外，可以使用logging.level.root配置根日志记录器。</p><pre class="jp jq jr js fd lk ll lm ln aw lo bi"><span id="8dc6" class="kw ju ht ll b fi lp lq l lr ls">java -jar <strong class="ll hu">-Dlogging.level.root=DEBUG </strong>application.jar<br/>java -jar <strong class="ll hu">-Dlogging.level.org.springframework=TRACE </strong>application.jar</span></pre><h2 id="3264" class="kw ju ht bd jv kx ky kz jz la lb lc kd jb ld le kh jf lf lg kl jj lh li kp lj bi translated"><strong class="ak">属性文件</strong></h2><p id="2a0a" class="pw-post-body-paragraph iq ir ht is b it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn hb bi translated">属性文件和YAML配置文件中的相同属性名称可用于设置日志记录级别配置。</p><p id="d29c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hu">应用属性文件示例:</strong></p><pre class="jp jq jr js fd lk ll lm ln aw lo bi"><span id="4b00" class="kw ju ht ll b fi lp lq l lr ls"><strong class="ll hu">logging.level.root=DEBUG<br/>logging.level.org.springframework=TRACE</strong></span></pre><p id="e165" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hu"> YAML文件示例:</strong></p><pre class="jp jq jr js fd lk ll lm ln aw lo bi"><span id="c5ac" class="kw ju ht ll b fi lp lq l lr ls">logging:<br/>   level:<br/><strong class="ll hu">     root: "DEBUG"<br/>     org.springframework: "TRACE"</strong></span></pre><h2 id="cc06" class="kw ju ht bd jv kx ky kz jz la lb lc kd jb ld le kh jf lf lg kl jj lh li kp lj bi translated"><strong class="ak">操作系统环境变量</strong></h2><p id="1e1d" class="pw-post-body-paragraph iq ir ht is b it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn hb bi translated">还可以使用环境变量来设置日志记录级别。(如<code class="du lt lu lv ll b">LOGGING_LEVEL_ORG_SPRINGFRAMEWORK=TRACE</code>会将<code class="du lt lu lv ll b">org.springframework</code>设置为<code class="du lt lu lv ll b">DEBUG</code>)。所有可能的配置和映射的环境变量的列表可以在<a class="ae jo" href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#features.logging.custom-log-configuration" rel="noopener ugc nofollow" target="_blank"> Spring Boot参考</a>页面上找到。</p><h1 id="e8ff" class="jt ju ht bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">记录器启动</h1><p id="bdea" class="pw-post-body-paragraph iq ir ht is b it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn hb bi translated">使用Logger Factory，我们可以创建一个Logger实例，我们将使用它在应用程序中记录日志。对于每个日志级别，您可以找到正确的调用方法，如下所示:</p><pre class="jp jq jr js fd lk ll lm ln aw lo bi"><span id="e755" class="kw ju ht ll b fi lp lq l lr ls">@Component<br/><strong class="ll hu">public class </strong>LoggingTest {<br/>    Logger <strong class="ll hu">logger </strong>= LoggerFactory.<em class="lw">getLogger</em>(LoggingTest.<strong class="ll hu">class</strong>);<br/>    <strong class="ll hu">public void </strong>test(){<br/>        <strong class="ll hu">logger</strong>.trace(<strong class="ll hu">"trace"</strong>);<br/>        <strong class="ll hu">logger</strong>.info(<strong class="ll hu">"info"</strong>);<br/>    }<br/>}</span></pre><p id="2687" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">另一种方法是使用来自<a class="ae jo" href="https://projectlombok.org/" rel="noopener ugc nofollow" target="_blank"> Lombok </a>库的<code class="du lt lu lv ll b">@Slf4j</code>注释，它将处理记录器的初始化。</p><pre class="jp jq jr js fd lk ll lm ln aw lo bi"><span id="b544" class="kw ju ht ll b fi lp lq l lr ls"><strong class="ll hu">@Slf4j</strong><br/>@Component<br/><strong class="ll hu">public class </strong>LoggingTest {<br/>    <strong class="ll hu">public void </strong>test(){<br/>        <strong class="ll hu">log</strong>.trace(<strong class="ll hu">"trace"</strong>);<br/>        <strong class="ll hu">log</strong>.info(<strong class="ll hu">"info"</strong>);<br/>    }<br/>}</span></pre><h2 id="a4ac" class="kw ju ht bd jv kx ky kz jz la lb lc kd jb ld le kh jf lf lg kl jj lh li kp lj bi translated">日志输出</h2><p id="f556" class="pw-post-body-paragraph iq ir ht is b it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn hb bi translated"><strong class="is hu">控制台输出:</strong>默认情况下，Spring Boot只记录到控制台，不写日志文件，您可以在IDE控制台或运行实例中看到它。命令行中有一些选项可以帮助您将控制台的输出写入文件，但它们只是不同的工具。</p><p id="dcba" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hu">文件输出:</strong>为了在文件中写入日志，你需要设置一个<code class="du lt lu lv ll b">logging.file.name</code>或<code class="du lt lu lv ll b">logging.file.path</code>属性(例如，在你的<code class="du lt lu lv ll b">application.properties</code>中)。</p><pre class="jp jq jr js fd lk ll lm ln aw lo bi"><span id="96d2" class="kw ju ht ll b fi lp lq l lr ls"><strong class="ll hu">logging.file.name=app-log-file.log<br/>logging.file.path=/var/log</strong></span></pre><p id="3023" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这些配置将把日志输出写到这个目录<code class="du lt lu lv ll b">/var/log.</code>的文件名<code class="du lt lu lv ll b">app-log-file.log</code>中</p><h2 id="0311" class="kw ju ht bd jv kx ky kz jz la lb lc kd jb ld le kh jf lf lg kl jj lh li kp lj bi translated">日志格式</h2><p id="f01a" class="pw-post-body-paragraph iq ir ht is b it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn hb bi translated">基本上，在Spring Boot，日志的每个记录都遵循一个默认的模式，这个模式是可以定制的。这种定制可以通过在Spring Boot运行环境中设置相关属性或者运行日志实现的配置来完成。</p><p id="610f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这是spring-boot 1.5.8.RELEASE上的默认模式:</p><pre class="jp jq jr js fd lk ll lm ln aw lo bi"><span id="a2ea" class="kw ju ht ll b fi lp lq l lr ls">%clr(%d{yyyy-MM-dd HH:mm:ss.SSS}){faint} %clr(${LOG_LEVEL_PATTERN:-%5p}) %clr(${PID:- }){magenta} %clr(---){faint} %clr([%15.15t]){faint} %clr(%-40.40logger{39}){cyan} %clr(:){faint} %m%n${LOG_EXCEPTION_CONVERSION_WORD:-%wEx}</span></pre><p id="813d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您可以使用<code class="du lt lu lv ll b">application.properties</code>文件和<code class="du lt lu lv ll b">application.yaml</code>中的以下属性在控制台输出中更改它</p><pre class="jp jq jr js fd lk ll lm ln aw lo bi"><span id="2d13" class="kw ju ht ll b fi lp lq l lr ls"><strong class="ll hu">logging.pattern.console</strong>=&lt;Customized pattern&gt;</span></pre><p id="1f06" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">关于Logback布局模式格式的更多信息，可以参考<a class="ae jo" href="https://logback.qos.ch/manual/layouts.html" rel="noopener ugc nofollow" target="_blank">Logback手册</a>。</p><h1 id="b8e4" class="jt ju ht bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">自定义日志配置</h1><p id="896f" class="pw-post-body-paragraph iq ir ht is b it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn hb bi translated">根据您使用的实现，将加载以下文件:</p><p id="672b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hu">回退:</strong> <code class="du lt lu lv ll b">logback-spring.xml</code>、<code class="du lt lu lv ll b">logback-spring.groovy</code>、<code class="du lt lu lv ll b">logback.xml</code>或<code class="du lt lu lv ll b">logback.groovy</code></p><p id="a358" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hu"> Log4j2: </strong> <code class="du lt lu lv ll b">log4j2-spring.xml</code>或<code class="du lt lu lv ll b">log4j2.xml</code></p><p id="dee8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hu"> JDK (Java Util日志):</strong> <code class="du lt lu lv ll b">logging.properties</code></p><h2 id="335f" class="kw ju ht bd jv kx ky kz jz la lb lc kd jb ld le kh jf lf lg kl jj lh li kp lj bi translated">回溯配置</h2><p id="d163" class="pw-post-body-paragraph iq ir ht is b it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn hb bi translated">虽然默认配置已经有了，可以满足一些项目的需求，但是对于我们的日常需求还是不够的。在application.properties文件中，一些用于回退的设置也可以作为属性使用。但是在XML基本配置文件格式上进行回退配置更灵活。Spring boot将自动加载类路径中具有以下名称之一的文件，并覆盖默认配置:</p><ul class=""><li id="e672" class="lx ly ht is b it iu ix iy jb lz jf ma jj mb jn mc md me mf bi translated"><em class="lw"> logback.xml </em></li><li id="98a1" class="lx ly ht is b it mg ix mh jb mi jf mj jj mk jn mc md me mf bi translated"><em class="lw"> logback-spring.xml </em></li><li id="a9be" class="lx ly ht is b it mg ix mh jb mi jf mj jj mk jn mc md me mf bi translated"><em class="lw"> logback-spring.groovy </em></li><li id="0eda" class="lx ly ht is b it mg ix mh jb mi jf mj jj mk jn mc md me mf bi translated"><em class="lw"> logback.groovy </em></li></ul><p id="1fbb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在<a class="ae jo" href="https://logback.qos.ch/manual/configuration.html" rel="noopener ugc nofollow" target="_blank">日志返回网站</a>上的日志返回配置文件格式的文档可以让你全面了解它是如何工作的。</p><p id="3ada" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hu">文件旋转</strong></p><p id="0b31" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">默认情况下，日志文件在达到10 MB时会进行循环，但是如果您正在使用回退，您可以使用额外的高级选项来增强文件循环配置。一些轮换政策如下:</p><p id="3dab" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du lt lu lv ll b">logging.logback.rollingpolicy.file-name-pattern</code>:文件名模式用于创建日志档案。</p><p id="f74c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du lt lu lv ll b">logging.logback.rollingpolicy.clean-history-on-start</code>:是否在应用程序启动时进行日志归档清理。</p><p id="d84e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du lt lu lv ll b">logging.logback.rollingpolicy.max-file-size</code>:日志文件存档前的最大大小。</p><p id="31af" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du lt lu lv ll b">logging.logback.rollingpolicy.total-size-cap</code>:日志归档在被删除之前可以占用的最大大小。</p><p id="0a19" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du lt lu lv ll b">logging.logback.rollingpolicy.max-history</code>:保留的归档日志文件的最大数量(默认为7)。</p><p id="3d74" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hu">回溯扩展</strong></p><p id="bd8c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您使用<code class="du lt lu lv ll b">logback-spring.xml</code>配置文件，那么在Spring Boot有一些额外的扩展可以让您受益。</p><blockquote class="ml mm mn"><p id="abce" class="iq ir lw is b it iu iv iw ix iy iz ja mo jc jd je mp jg jh ji mq jk jl jm jn hb bi translated">注意:因为标准的<code class="du lt lu lv ll b">logback.xml</code>配置文件加载得太早，所以不能在其中使用扩展。您需要使用<code class="du lt lu lv ll b">logback-spring.xml</code>或者定义一个<code class="du lt lu lv ll b">logging.config</code>属性。</p></blockquote><p id="f5d5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">其中一个有用的扩展是特定于概要文件的扩展，它帮助您为您的应用程序定义概要文件的基本配置。一个示例如下所示:</p><pre class="jp jq jr js fd lk ll lm ln aw lo bi"><span id="fcfb" class="kw ju ht ll b fi lp lq l lr ls">&lt;springProfile name="!production"&gt;     <br/>   &lt;!-- configuration to be enabled when the "production" profile is not active --&gt; <br/>&lt;/springProfile&gt;</span></pre><h1 id="c26b" class="jt ju ht bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">结论</h1><p id="c0af" class="pw-post-body-paragraph iq ir ht is b it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn hb bi translated">在本文中，我们试图介绍一些关于Spring Boot日志功能的基本信息。当然，您可以通过参考每个实现的官方文档来了解更多的细节。</p></div><div class="ab cl mr ms gp mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="hb hc hd he hf"><p id="ad12" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">希望这篇文章对你有所帮助，请支持我，为这个故事鼓掌。如果你不知道事情是这样的:</p><figure class="jp jq jr js fd hk er es paragraph-image"><div class="er es my"><img src="../Images/a776cb694958e0b942aa724139f06e43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*gr6IGS9LSLBXde48.gif"/></div></figure><p id="6606" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">或者在这里给我买杯咖啡！</p></div></div>    
</body>
</html>