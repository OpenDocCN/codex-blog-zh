<html>
<head>
<title>Outlier Study and Linear Regression Diagnosis using Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python进行异常研究和线性回归诊断</h1>
<blockquote>原文：<a href="https://medium.com/codex/outlier-study-and-linear-regression-diagnosis-using-python-d148223859c0?source=collection_archive---------0-----------------------#2021-06-15">https://medium.com/codex/outlier-study-and-linear-regression-diagnosis-using-python-d148223859c0?source=collection_archive---------0-----------------------#2021-06-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="3027" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">作为研究建筑物中暖通空调(HVAC)系统的传感器数据的数据科学家，我们通常应用异常检测统计技术或机器学习方法来检测和识别故障，如设备故障或操作错误。处理真实世界的传感器数据有其自身的挑战。</p><p id="9480" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一个这样的用例是检测用于促进冷冻水流动以冷却建筑物的故障泵。当冷冻水泵功率的增加或减少分别与管道冷冻水流速的增加或减少不一致时，就会出现这种情况。</p><p id="8f48" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们的方法是训练一个回归模型。新数据的后续预测与某个阈值的任何偏差都意味着检测到异常。为了确保训练数据代表泵的最佳状态，我们需要仔细研究并去除异常值。</p><p id="dde3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在很长一段时间里，我会通过标记偏离四分位数范围(IQR)的点来识别数据中的异常值或不规则性。<strong class="ih hj"> </strong>四分位数间距(IQR)定义为第三个四分位数和第一个四分位数之差(IQR = Q3 -Q1)。在这种情况下，异常值被定义为低于(Q1 1.5倍IQR)或高于(Q3+1.5倍IQR)的观测值。然而，我们很快意识到我们删除了太多对回归很重要的数据点。幸运的是，我们想出了一个更系统的方法来识别异常值，从我们面临的异常值的性质开始。我们意识到，我们面临的异常值可以总结为三个主要特征:</p><p id="d16d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">(a)杠杆作用:一个点是否远离x空间中的主要集群。(b)一致性:就(x，y)空间中的拟合而言，一个点是否是一致的。(c)影响:一个点是否高度影响模型的拟合。</p><p id="61ef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们如何识别这些异常值？我们使用学生化的删除残差作为一致性的度量。这种影响通过库克的距离来衡量。有趣的是，对于杠杆的测量，我们利用了臭名昭著的OLS hat矩阵的对角线:H = X * (transpose(X)*X)^(-1) *转置(x)。hat值h(i)被用作第I个数据点的杠杆测量。</p><p id="2a9a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面是python中的实现，使用了statsmodels的一个名为OLSInfluence的库。首先，拟合回归模型。然后，拟合的回归对象用于分别导出学生化残差、杠杆和库克距离。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="ji jj l"/></div></figure><p id="cf81" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下图是杠杆与学生化残差图。y轴是学生化残差，表示是否存在基于alpha值的异常值(显著性水平)。它显示右下角的点是高杠杆数据点。一般来说，除了点583和1758之外，这种回归拟合没有任何问题。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es jk"><img src="../Images/b32249c2cd7b74133ba05907753ad564.png" data-original-src="https://miro.medium.com/v2/resize:fit:1342/format:webp/1*lCddABhtGT2YgpS-INpTsw.png"/></div></figure><p id="6625" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">非正式的评估通常通过目测学生化删除残差的Q-Q图、杠杆h(i)和cook的距离d(i)来帮助我们评估异常值并识别点的指数，以便我们可以删除或保留它们用于我们的训练。Q-Q图的更详细的解释可以在下面的部分中阅读。学生化残差的Q-Q图显示数据点583确实是异常值。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es jn"><img src="../Images/c1e749a75a1dcfa1a52e38c24ab75468.png" data-original-src="https://miro.medium.com/v2/resize:fit:1348/format:webp/1*KJtVtKwxK2VQFxM2EyYUCg.png"/></div><figcaption class="jo jp et er es jq jr bd b be z dx translated">Q-Q概率图是重尾的，并且显示了存在异常值的非正态分布。</figcaption></figure><p id="1553" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面是检索上述Q-Q图的代码。类似的图可以用于分析库克的距离和杠杆。在这里，我们使用scipy.stats中的probplot()来生成值。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="ji jj l"/></div></figure><p id="cc0d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然而，可以使用的更正式和具体的评估是在我们的回归中引入虚拟变量u。对于第I个单元(即我们通过非正式评估认为异常的数据点)，虚拟变量将取值1，否则取值0。该系数u在线性预测值中的显著性表明并确认第I个点确实是异常值。</p><p id="1a0a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">除非异常值非常有影响力，否则不需要从模型拟合中排除。但是需要调查来找出这个有影响的数据点的可能性。</p><p id="5076" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">使用Python的模型诊断</strong></p><p id="b53f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">建模的一个重要方面是确保正确诊断您的模型。无论模型有多复杂，模型都可能经历系统差异，从而严重损害预测的性能。</p><p id="d66e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">幸运的是，线性回归通常表现良好，因为r平方值为0.985。然而，让我们继续使用这个数据集和问题作为用例来评估我们的数据是否打破了任何正态假设。我们首先拟合数据，生成回归函数及其组件(如对象本身)以及汇总表。在这种情况下，我们只有一个预测变量，即泵功率。响应变量是流速。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="ji jj l"/></div></figure><div class="jd je jf jg fd ab cb"><figure class="js jh jt ju jv jw jx paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><img src="../Images/6d52012a23e0441da95e850905fe292c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1054/format:webp/1*HMVmaqvhrQCf19m9wdeQFg.png"/></div></figure><figure class="js jh kc ju jv jw jx paragraph-image"><img src="../Images/a0ed3939d9ac29827adda12d0f2df8d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:892/format:webp/1*5xsxqCldQeU1OuGSIcTdpA.png"/><figcaption class="jo jp et er es jq jr bd b be z dx kd di ke kf translated">左边的图显示了回归函数，右边的表是拟合回归函数的结果汇总。</figcaption></figure></div><p id="1e0a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们详细检查当线性回归的假设被打破时所面临的常见差异。</p><p id="7603" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">回归函数不是线性的。(b)误差项不具有恒定的方差。误差项不是独立的。(d)误差项不是正态分布的。(e)模型中忽略了一些重要的预测因素。</p><p id="337a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们如何识别哪些是模型的正确错误诊断？一把瑞士军刀是通过绘制残差图来检查非线性、恒定方差。如果没有差异，残差将看起来像均值为零的随机误差，即零模式。在任何残差图中，点将均匀分布在零周围的水平带内。如果模式存在，模型是失败的，因为它不适合回归函数，并且我们知道是否存在非线性或非恒定方差。创建拟合值的残差图以及预测变量的残差图将有助于找出这一点。</p><p id="e622" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">seaborn软件包使我们能够通过一行代码方便地绘制剩余图以及更平滑的Lowess函数。在下面的代码中，我构建了学生化残差与杠杆的关系图。响应变量是学生化残差，这里的x轴是杠杆，通过OLS帽矩阵的对角线确定。在这种情况下，在Lowess平滑器中似乎有一个向上，然后向下的趋势，表明异方差的迹象。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="ji jj l"/></div></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es kg"><img src="../Images/fec45c76099a80277f907e2d4ab1b79b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1304/format:webp/1*QApXzs9swzFZjCTWR7xboA.png"/></div><figcaption class="jo jp et er es jq jr bd b be z dx translated">剩余价值与杠杆价值显示出异方差的迹象。</figcaption></figure><p id="a1e7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们还要检查残差中是否存在与拟合值相关的结构。这个情节相对容易创作。这里的计划是从拟合模型中提取残差和拟合值，计算通过这些点的Lowess平滑线，然后绘制出来。在这种情况下，残差中可能存在轻微的非线性结构。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="ji jj l"/></div></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es kh"><img src="../Images/61358bc4349fe34cbe040b3d88b0564b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/format:webp/1*RsKmpTdZQ6kpJfACNg1ipw.png"/></div><figcaption class="jo jp et er es jq jr bd b be z dx translated">残差与拟合图显示非线性迹象，违反零模式。</figcaption></figure><p id="386a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">另一把瑞士军刀是Q-Q图或正态概率图，我们在上一节已经谈到了。Q-Q图帮助我们识别预测值或误差项的正态条件。Q-Q图的零模式是这些点应该单独落在一条直线上。如果它是一条凸曲线，则分布是非对称和偏斜的，通过伽马分布可以更好地解释。对称但重尾的分布也违反了Q-Q图的零模式，这意味着数据的分布不是正态分布，最好在拟合回归模型之前进行一些转换。关于不同类型的Q-Q情节的更多细节和精彩解释可以在我找到的这篇博文中找到:<a class="ae ki" href="https://towardsdatascience.com/q-q-plots-explained-5aa8495426c0" rel="noopener" target="_blank">https://towardsdatascience . com/Q-Q-plots-explained-5aa 8495426 c0</a></p><p id="3c4c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">总之，对于模型诊断，首先，检查非线性。有几个残差图可以用来检查这种情况。首先，绘制拟合值的残差图，然后绘制每个预测变量的残差图。此外，当有多个预测变量时，响应与预测变量的散点图有助于确定与响应变量的关系。</p><p id="4cde" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">其次，当检查同质性时，拟合值的残差图和预测变量的残差图就足够了。我们需要看到残差的方差是一个常数，即这些点看起来是随机的。这使我们确信误差项是独立分布的。</p><p id="2958" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，但肯定不是最不重要的，检查常态。Q-Q图在识别响应变量分布的任何偏斜方面非常有效，可以帮助我们决定是否需要x，y变量的转换。正态性是成功拟合模型的一个重要假设。</p><p id="1fa1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我希望这是对忙于拟合线性回归模型，但无法识别和补救真实世界数据集中的异常的数据科学家有用的总结。请注意，当使用Sklearn库进行线性回归时，很难提供这样的诊断。因此，对于python中的线性回归类型的问题，我强烈推荐使用statsmodels或scipy.stats。</p><p id="091d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">希望你喜欢我的帖子！随时学习和分享这些发现，随时在LinkedIn上加我:<a class="ae ki" href="https://www.linkedin.com/in/esther-dawes-9b462343/" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/esther-dawes-9b462343/</a>并在github上关注我的一些工作，我会尽力不时地发布一些有趣的项目:【https://github.com/technologic27】T2。</p></div></div>    
</body>
</html>