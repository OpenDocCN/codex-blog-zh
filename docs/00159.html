<html>
<head>
<title>How to build REST API and GraphQL in Django with MySQL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用MySQL在Django中构建REST API和GraphQL</h1>
<blockquote>原文：<a href="https://medium.com/codex/django-create-rest-api-and-graphql-with-mysql-e1b8a900daea?source=collection_archive---------0-----------------------#2020-12-14">https://medium.com/codex/django-create-rest-api-and-graphql-with-mysql-e1b8a900daea?source=collection_archive---------0-----------------------#2020-12-14</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="c69c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本教程中，我们将使用Django作为我们的后端应用程序，并用MySQL为数据库创建REST API和GraphQL。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/57afefd05d43065a3358236e84a6f490.png" data-original-src="https://miro.medium.com/v2/resize:fit:1124/format:webp/1*A6VXoQ6hHQDiKerfDOFZ4w.jpeg"/></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">django rest api graphql</figcaption></figure><h1 id="a809" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">介绍</h1><p id="9e41" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">Django是一个Python框架，它是开源的，遵循模型-模板-视图架构模式。如果你以前使用过遵循模型-模板-视图的框架，学习Django会容易得多。</p><p id="5e10" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要遵循本教程，请确保您已经安装了这些软件:</p><ol class=""><li id="aa88" class="ks kt hi ih b ii ij im in iq ku iu kv iy kw jc kx ky kz la bi translated"><a class="ae lb" href="https://www.python.org/downloads/" rel="noopener ugc nofollow" target="_blank"> Python </a></li><li id="8f95" class="ks kt hi ih b ii lc im ld iq le iu lf iy lg jc kx ky kz la bi translated">MySQL (我用的是更容易安装的XAMPP)</li></ol><p id="6f3b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">事不宜迟，我们开始吧。</p><h1 id="a3b3" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">Django REST API</h1><p id="5616" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">首先，让我们为我们的项目创建一个文件夹，然后让我们为我们的项目创建虚拟环境。打开命令提示符并运行。我将使用Anaconda，但如果你安装了Python也没关系。</p><pre class="je jf jg jh fd lh li lj lk aw ll bi"><span id="c731" class="lm jq hi li b fi ln lo l lp lq">mkdir django<br/>cd django<br/>python -m venv venv<br/>venv\Scripts\activate</span></pre><p id="afc3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">至此，您已经激活了您的虚拟环境。现在，让我们安装Django并创建我们的Django应用程序。</p><pre class="je jf jg jh fd lh li lj lk aw ll bi"><span id="27eb" class="lm jq hi li b fi ln lo l lp lq">pip install django // or you can use python -m pip install Django<br/>django-admin startproject rasyue<br/>cd rasyue<br/>python manage.py runserver</span></pre><p id="fcd7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可以用任何你喜欢的名字替换<code class="du lr ls lt li b">rasyue</code>。现在你应该可以去<code class="du lr ls lt li b">localhost:8000</code>并看到你默认的Django应用。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="er es lu"><img src="../Images/f5c17928cf63030f97393fe2dde2357a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VJ9c3JtLqrAs3WsqQFYuog.jpeg"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">django默认登录页面</figcaption></figure><p id="5d3e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是如果您阅读命令提示符，您应该会看到类似这样的内容。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="er es lz"><img src="../Images/c4520aec1d0c4397edb0d841c8729f9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xe34KAEjd7L43gsRVaCMdQ.jpeg"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">命令提示符</figcaption></figure><p id="5ac2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Django回复了一个通知，告诉我们关于未申请的迁移。现在来说说迁移。</p><h1 id="b992" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">Django的移民</h1><p id="a11f" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">首先，打开你在<code class="du lr ls lt li b">your_project_name/settings.py</code>下的<code class="du lr ls lt li b">settings.py</code>文件。我的将是<code class="du lr ls lt li b">rasyue/settings.py</code>。</p><p id="3e9c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您应该会看到类似这样的内容。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="er es ma"><img src="../Images/2518fa6608bc59868b8a531b18a1209e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fc2kFW6OVgw7cH68GcCG8w.jpeg"/></div></div></figure><p id="459b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">查看数据库对象/字典。默认情况下，Django将使用Django包附带的<code class="du lr ls lt li b">sqlite</code>。</p><p id="6daa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将改为使用MySQL。现在启动你的xampp mysql。</p><p id="a721" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">用下面的内容替换您的数据库对象/字典。</p><pre class="je jf jg jh fd lh li lj lk aw ll bi"><span id="008c" class="lm jq hi li b fi ln lo l lp lq">DATABASES = {<br/>    'default': {<br/>        'ENGINE': 'django.db.backends.mysql', <br/>        'NAME': 'rasyuedjango',<br/>        'USER': 'root',<br/>        'PASSWORD': '',<br/>        'HOST': 'localhost',   # Or an IP Address that your DB is hosted on<br/>        'PORT': '3306',<br/>    }<br/>}</span></pre><p id="dae5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">记得在MySQL中为你的Django应用程序创建一个数据库。我的是<code class="du lr ls lt li b">rasyuedjango</code>。</p><p id="ccb0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们需要运行迁移。在命令提示符下运行以下代码。</p><pre class="je jf jg jh fd lh li lj lk aw ll bi"><span id="5c2c" class="lm jq hi li b fi ln lo l lp lq">python manage.py migrate<br/><br/>python manage.py runserver</span></pre><p id="0455" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">查看一下您的数据库，您应该看到已经创建了几个表。</p><h1 id="7ac9" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">Django API应用程序</h1><p id="abbe" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">在这一点上，如果你是初学者，不知道什么是REST API，REST API是向另一方/应用程序提供数据的标准方式。</p><p id="5091" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如，假设您有一个需要显示用户数据的前端应用程序，您可以使用后端REST API来获取这些数据。</p><p id="301e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要在Django中创建REST API，首先我们需要运行下面的代码。</p><pre class="je jf jg jh fd lh li lj lk aw ll bi"><span id="96a1" class="lm jq hi li b fi ln lo l lp lq">pip install djangorestframework</span></pre><p id="20f6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这将安装DRF(django rest框架)，这将使我们的工作更容易。</p><h1 id="67db" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">REST API数据</h1><p id="45af" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">典型的REST API应该提供某种数据，因为我们没有任何数据可以提供，所以让我们创建一些。</p><p id="2031" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们假设我们想要提供关于<strong class="ih hj">书籍</strong>的数据。</p><p id="70f6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们需要做的步骤如下:</p><ol class=""><li id="2ab3" class="ks kt hi ih b ii ij im in iq ku iu kv iy kw jc kx ky kz la bi translated">为我们的django应用程序创建一个超级用户来访问管理页面</li><li id="9348" class="ks kt hi ih b ii lc im ld iq le iu lf iy lg jc kx ky kz la bi translated">其次，在我们的django应用程序中创建另一个应用程序来处理我们的REST API。</li><li id="dfe0" class="ks kt hi ih b ii lc im ld iq le iu lf iy lg jc kx ky kz la bi translated">第三，创建应用模型。</li><li id="a9d3" class="ks kt hi ih b ii lc im ld iq le iu lf iy lg jc kx ky kz la bi translated">接下来，创建一个序列化程序。</li><li id="92ae" class="ks kt hi ih b ii lc im ld iq le iu lf iy lg jc kx ky kz la bi translated">然后，创建视图和URL。</li><li id="f480" class="ks kt hi ih b ii lc im ld iq le iu lf iy lg jc kx ky kz la bi translated">之后，为我们的books数据创建一些数据。</li><li id="3bbb" class="ks kt hi ih b ii lc im ld iq le iu lf iy lg jc kx ky kz la bi translated">最后，我们需要测试我们的REST API。</li></ol><p id="8098" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">列出所有步骤后，让我们开始工作。</p><h1 id="e3e2" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">创建超级用户</h1><p id="ba07" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">要创建一个超级用户，首先我们需要启动我们的应用程序并运行以下命令。</p><pre class="je jf jg jh fd lh li lj lk aw ll bi"><span id="7600" class="lm jq hi li b fi ln lo l lp lq">python manage.py createsuperuser</span></pre><p id="6d6f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该命令将要求用户名，电子邮件和密码。输入后转到<code class="du lr ls lt li b">localhost:8000/admin</code>。将出现一个登录框，使用您之前输入的用户名和密码登录。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="er es mb"><img src="../Images/9118f9d6c21def363e3ef059e444e10a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hPENwtSf9d8ZaPaUxP5oFQ.jpeg"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">django管理员登录</figcaption></figure><p id="816f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">成功登录后，您将看到此页面。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="er es mc"><img src="../Images/c9ab22c264ff44c6dfa94f59369f2e77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Mcckb7xQ2bvD1At5Od4hNg.jpeg"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">django管理</figcaption></figure><p id="f965" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们可以登录到管理页面。我们需要在Django项目中创建另一个应用程序。</p><h1 id="0131" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">图书应用程序</h1><p id="3365" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">首先运行以下命令。</p><pre class="je jf jg jh fd lh li lj lk aw ll bi"><span id="fa70" class="lm jq hi li b fi ln lo l lp lq">python manage.py startapp books</span></pre><p id="be0c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该命令将在Django项目中创建另一个应用程序。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="er es md"><img src="../Images/4371d27a419b0fac12b37a7d49a00673.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wNhI2IjFAM2YcDm1X9Z5ew.jpeg"/></div></div></figure><p id="d9cd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意，在我们的项目目录中，已经创建了另一个名为<code class="du lr ls lt li b">Books</code>的文件夹，它由几个类似<code class="du lr ls lt li b">models.py, admin.py, views.py and so on</code>的文件组成。</p><h1 id="b672" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">Django中的应用</h1><p id="9ed2" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">在我们继续之前，您需要了解几件事情:</p><ol class=""><li id="5761" class="ks kt hi ih b ii ij im in iq ku iu kv iy kw jc kx ky kz la bi translated">尽管命令<code class="du lr ls lt li b">python manage.py startapp books</code>在我们的Django项目中创建了另一个应用程序，但它不是一个单独的Django应用程序。在Django中，你可以创建几个独立的应用程序，每个都有独特的功能。如果你以前用过Angular或者React，你可以把app当成一个组件。</li><li id="bae2" class="ks kt hi ih b ii lc im ld iq le iu lf iy lg jc kx ky kz la bi translated">默认情况下，你创建的每个应用程序都没有链接到核心项目，你必须告诉Django你创建的应用程序，我将在稍后展示。</li></ol><h1 id="5718" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">注册创建的应用程序(书籍)</h1><p id="2efa" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">打开你的<code class="du lr ls lt li b">settings.py</code>，粘贴以下内容。</p><pre class="je jf jg jh fd lh li lj lk aw ll bi"><span id="d4e2" class="lm jq hi li b fi ln lo l lp lq">INSTALLED_APPS = [<br/>    'django.contrib.admin',<br/>    'django.contrib.auth',<br/>    'django.contrib.contenttypes',<br/>    'django.contrib.sessions',<br/>    'django.contrib.messages',<br/>    'django.contrib.staticfiles',<br/>    'books',<br/>]</span></pre><p id="4931" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">应该是这样的。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="er es me"><img src="../Images/7bf133287412abc75682562e58a42ffe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EeeNziV1RroEIOLH3kNKmA.jpeg"/></div></div></figure><p id="7e5d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">至此，我们已经成功注册了我们的<code class="du lr ls lt li b">books</code>应用程序。</p><h1 id="8db6" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">创建模型</h1><p id="c137" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">在<code class="du lr ls lt li b">books/models.py</code>中，粘贴以下内容。</p><pre class="je jf jg jh fd lh li lj lk aw ll bi"><span id="b453" class="lm jq hi li b fi ln lo l lp lq">class Book(models.Model):<br/>    title       = models.TextField()<br/>    description = models.TextField()<br/>    price       = models.TextField()<br/>     def __str__(self):<br/>        return self.title<br/><br/>    class Meta:<br/>        ordering = ('title',)</span></pre><p id="6cba" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">打开你的<code class="du lr ls lt li b">books/admin.py</code>，粘贴以下内容。</p><pre class="je jf jg jh fd lh li lj lk aw ll bi"><span id="e716" class="lm jq hi li b fi ln lo l lp lq">from django.contrib import admin<br/>from .models import Book<br/><br/># Register your models here.<br/><br/>admin.site.register(Book)</span></pre><p id="cd1f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在运行命令。</p><pre class="je jf jg jh fd lh li lj lk aw ll bi"><span id="5733" class="lm jq hi li b fi ln lo l lp lq">python manage.py makemigrations<br/>python manage.py migrate<br/><br/>start you server and go to admin page<br/>python manage.py runserver</span></pre><p id="32e2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这样，当你进入管理页面。您应该会看到类似这样的内容。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="er es mf"><img src="../Images/6f5feb91a853d28cef6db46ca9c7316b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*44YHHQ9qHzQCd-HRbOxCOA.jpeg"/></div></div></figure><p id="04c0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您点击<code class="du lr ls lt li b">Books</code>，您可以创建一个新的book记录，所以继续创建您喜欢的数量，因为这些数据稍后将在REST API中使用。</p><h1 id="0cc8" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">创建序列化程序</h1><p id="5da5" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">在book文件夹中创建一个新文件并命名为<code class="du lr ls lt li b">serializers.py</code>。应该是<code class="du lr ls lt li b">books/serializers.py</code>。在文件中，粘贴以下内容。</p><pre class="je jf jg jh fd lh li lj lk aw ll bi"><span id="118c" class="lm jq hi li b fi ln lo l lp lq">from rest_framework import serializers<br/><br/>from .models import Book<br/><br/>class BookSerializer(serializers.HyperlinkedModelSerializer):<br/>    class Meta:<br/>        model = Book<br/>        fields = ('title', 'description')</span></pre><p id="0b89" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，创建另一个文件并将其命名为<code class="du lr ls lt li b">urls.py</code>，粘贴以下内容。</p><pre class="je jf jg jh fd lh li lj lk aw ll bi"><span id="7ecb" class="lm jq hi li b fi ln lo l lp lq">from django.urls import path<br/>from django.conf.urls import include<br/>from rest_framework import routers<br/>from . import views<br/><br/>router = routers.DefaultRouter()<br/>router.register(r'books', views.BookView)<br/><br/># Wire up our API using automatic URL routing.<br/># Additionally, we include login URLs for the browsable API.<br/>urlpatterns = [<br/>    path('', include(router.urls)),<br/>    path('api-auth/', include('rest_framework.urls', namespace='rest_framework'))<br/>]</span></pre><p id="f457" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">打开你的<code class="du lr ls lt li b">views.py</code>，粘贴以下内容。</p><pre class="je jf jg jh fd lh li lj lk aw ll bi"><span id="b3db" class="lm jq hi li b fi ln lo l lp lq">from django.shortcuts import render<br/><br/># Create your views here.<br/># views.py<br/>from rest_framework import viewsets<br/><br/>from .serializers import BookSerializer<br/>from .models import Book<br/><br/><br/>class BookView(viewsets.ModelViewSet):<br/>    queryset = Book.objects.all()<br/>    serializer_class = Book</span></pre><p id="af4f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，打开你的项目根目录<code class="du lr ls lt li b">urls.py</code>或<code class="du lr ls lt li b">rasyue/urls.py</code>，粘贴以下内容。我们需要在我们的根url中注册<code class="du lr ls lt li b">books/urls.py</code>。</p><pre class="je jf jg jh fd lh li lj lk aw ll bi"><span id="1d99" class="lm jq hi li b fi ln lo l lp lq">"""mysite URL Configuration<br/><br/>The `urlpatterns` list routes URLs to views. For more information please see:<br/>    https://docs.djangoproject.com/en/3.1/topics/http/urls/<br/>Examples:<br/>Function views<br/>    1. Add an import:  from my_app import views<br/>    2. Add a URL to urlpatterns:  path('', views.home, name='home')<br/>Class-based views<br/>    1. Add an import:  from other_app.views import Home<br/>    2. Add a URL to urlpatterns:  path('', Home.as_view(), name='home')<br/>Including another URLconf<br/>    1. Import the include() function: from django.urls import include, path<br/>    2. Add a URL to urlpatterns:  path('blog/', include('blog.urls'))<br/>"""<br/>from django.contrib import admin<br/>from django.urls import path<br/>from books import views<br/>from django.conf.urls import include<br/><br/>urlpatterns = [    <br/>    path('admin/', admin.site.urls),<br/>    path('books-api', include('books.urls')),<br/>]</span></pre><p id="53f5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">还有，在你的<code class="du lr ls lt li b">settings.py</code>里，包括<code class="du lr ls lt li b">rest_framework.</code></p><pre class="je jf jg jh fd lh li lj lk aw ll bi"><span id="8ead" class="lm jq hi li b fi ln lo l lp lq">INSTALLED_APPS = [<br/>    'django.contrib.admin',<br/>    'django.contrib.auth',<br/>    'django.contrib.contenttypes',<br/>    'django.contrib.sessions',<br/>    'django.contrib.messages',<br/>    'django.contrib.staticfiles',<br/>    'books',<br/>    'rest_framework',<br/>]</span></pre><p id="6821" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，启动你的应用程序，进入<code class="du lr ls lt li b">localhost:8000/books-api</code></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="er es mg"><img src="../Images/e521048a881a1e7b278c692ddab0d5ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*smwqD_4QFsWtowN2gFt83g.jpeg"/></div></div></figure><p id="3d68" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">摆弄一下REST API，多理解一下。我们将继续创建GraphQL。</p><h1 id="f807" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">Django API GraphQL</h1><p id="b3ce" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">现在，让我们通过首先运行下面的命令来创建我们的GraphQL。</p><pre class="je jf jg jh fd lh li lj lk aw ll bi"><span id="9b52" class="lm jq hi li b fi ln lo l lp lq">pip install django-graphene</span></pre><p id="9105" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，在上面的REST API中，我们需要创建序列化程序，但是对于graphql，我们必须创建模式。</p><p id="97e3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">继续创建两个文件名<code class="du lr ls lt li b">schema.py</code>，一个用于<code class="du lr ls lt li b">books/</code>，另一个用于<code class="du lr ls lt li b">rasyue/</code>。</p><p id="f1a2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">应该是这样的。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mh"><img src="../Images/0e9b7fd360f67e49207f245767742592.png" data-original-src="https://miro.medium.com/v2/resize:fit:880/format:webp/1*qm_s42IdTtVA4zpLpTUG7Q.jpeg"/></div></figure><p id="efd3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">打开<code class="du lr ls lt li b">books/schema.py</code>并粘贴以下内容。</p><pre class="je jf jg jh fd lh li lj lk aw ll bi"><span id="c6cd" class="lm jq hi li b fi ln lo l lp lq">import graphene<br/>from graphene_django.types import DjangoObjectType, ObjectType<br/>from .models import Book</span><span id="38cc" class="lm jq hi li b fi mi lo l lp lq">class BookType(DjangoObjectType):<br/>    class Meta:<br/>        model = Book</span><span id="9162" class="lm jq hi li b fi mi lo l lp lq">class Query(ObjectType):<br/>    book = graphene.Field(BookType, id=graphene.Int())<br/>    books = graphene.List(BookType)</span><span id="8b8d" class="lm jq hi li b fi mi lo l lp lq">def resolve_book(self, info, **kwargs):<br/>        id = kwargs.get('id')</span><span id="7f06" class="lm jq hi li b fi mi lo l lp lq">if id is not None:<br/>            return Book.objects.get(pk=id)</span><span id="229b" class="lm jq hi li b fi mi lo l lp lq">return None</span><span id="5252" class="lm jq hi li b fi mi lo l lp lq">def resolve_books(self, info, **kwargs):<br/>        return Book.objects.all()</span><span id="2725" class="lm jq hi li b fi mi lo l lp lq">class BookInput(graphene.InputObjectType):<br/>    id = graphene.ID()<br/>    title = graphene.String()<br/>    description = graphene.String()<br/>    price = graphene.String()</span><span id="3518" class="lm jq hi li b fi mi lo l lp lq">class CreateBook(graphene.Mutation):<br/>    class Arguments:<br/>        input = BookInput(required=True)</span><span id="3111" class="lm jq hi li b fi mi lo l lp lq">ok = graphene.Boolean()<br/>    book = graphene.Field(BookType)</span><span id="9d08" class="lm jq hi li b fi mi lo l lp lq"><a class="ae lb" href="http://twitter.com/staticmethod" rel="noopener ugc nofollow" target="_blank">@staticmethod</a><br/>    def mutate(root, info, input=None):<br/>        ok = True<br/>        book_ins = Book(title=input.title)<br/>        book_ins.save()<br/>        return CreateBook(ok=ok, book=book_ins)</span><span id="8a19" class="lm jq hi li b fi mi lo l lp lq">class UpdateBook(graphene.Mutation):<br/>    class Arguments:<br/>        id = graphene.Int(required=True)<br/>        input = BookInput(required=True)</span><span id="03bf" class="lm jq hi li b fi mi lo l lp lq">ok = graphene.Boolean()<br/>    book = graphene.Field(BookType)</span><span id="a1e6" class="lm jq hi li b fi mi lo l lp lq"><a class="ae lb" href="http://twitter.com/staticmethod" rel="noopener ugc nofollow" target="_blank">@staticmethod</a><br/>    def mutate(root, info, id, input=None):<br/>        ok = False<br/>        book_ins = Book.objects.get(pk=id)<br/>        if book_ins:<br/>            ok = True<br/>            book_ins.title = input.title<br/>            book_ins.save()<br/>            return UpdateBook(ok=ok, book=book_ins)<br/>        return UpdateBook(ok=ok, book=None)</span><span id="2d07" class="lm jq hi li b fi mi lo l lp lq">class Mutation(graphene.ObjectType):<br/>    create_book = CreateBook.Field()<br/>    update_book = UpdateBook.Field()</span><span id="6f4f" class="lm jq hi li b fi mi lo l lp lq">schema = graphene.Schema(query=Query, mutation=Mutation)</span></pre><p id="f794" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了解释上面的代码，在GraphQL中我们有两个基本操作，即查询和变异。查询用于获取数据，而变异用于更新或创建。</p><p id="b13a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们创建了用于查询操作的<code class="du lr ls lt li b">BookType</code>,这很容易理解。</p><p id="94e7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们还创建了<code class="du lr ls lt li b">BookInput</code>，它用来告诉GraphQL应该在<code class="du lr ls lt li b">UpdateBook</code>和<code class="du lr ls lt li b">CreateBook</code>中使用的数据类型。</p><p id="2a76" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在打开你的<code class="du lr ls lt li b">rasyue/schema.py</code>，粘贴以下内容。</p><pre class="je jf jg jh fd lh li lj lk aw ll bi"><span id="d6da" class="lm jq hi li b fi ln lo l lp lq">import graphene<br/>import books.schema</span><span id="297b" class="lm jq hi li b fi mi lo l lp lq">class Query(books.schema.Query, graphene.ObjectType):<br/>    pass</span><span id="94ec" class="lm jq hi li b fi mi lo l lp lq">class Mutation(books.schema.Mutation, graphene.ObjectType):<br/>    pass</span><span id="d585" class="lm jq hi li b fi mi lo l lp lq">schema = graphene.Schema(query=Query, mutation=Mutation)</span></pre><p id="a848" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，打开你的<code class="du lr ls lt li b">rasyue/urls.py</code>，粘贴以下内容。</p><pre class="je jf jg jh fd lh li lj lk aw ll bi"><span id="d52a" class="lm jq hi li b fi ln lo l lp lq">"""mysite URL Configuration<br/><br/>The `urlpatterns` list routes URLs to views. For more information please see:<br/>    https://docs.djangoproject.com/en/3.1/topics/http/urls/<br/>Examples:<br/>Function views<br/>    1. Add an import:  from my_app import views<br/>    2. Add a URL to urlpatterns:  path('', views.home, name='home')<br/>Class-based views<br/>    1. Add an import:  from other_app.views import Home<br/>    2. Add a URL to urlpatterns:  path('', Home.as_view(), name='home')<br/>Including another URLconf<br/>    1. Import the include() function: from django.urls import include, path<br/>    2. Add a URL to urlpatterns:  path('blog/', include('blog.urls'))<br/>"""<br/>from django.contrib import admin<br/>from django.urls import path<br/>from books import views<br/>from django.conf.urls import include<br/>from graphene_django.views import GraphQLView<br/>from .schema import schema<br/><br/>urlpatterns = [    <br/>    path('admin/', admin.site.urls),<br/>    path('books-api/', include('books.urls')),<br/>    path('graphql/', GraphQLView.as_view(graphiql=True)),<br/>]</span></pre><p id="2d27" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，打开你的<code class="du lr ls lt li b">rasyue/settings.py</code>，修改成这样。</p><pre class="je jf jg jh fd lh li lj lk aw ll bi"><span id="e660" class="lm jq hi li b fi ln lo l lp lq">INSTALLED_APPS = [<br/>    'graphene_django',<br/>    'django.contrib.admin',<br/>    'django.contrib.auth',<br/>    'django.contrib.contenttypes',<br/>    'django.contrib.sessions',<br/>    'django.contrib.messages',<br/>    'django.contrib.staticfiles',<br/>    'books',<br/>    'rest_framework',<br/>]<br/><br/>GRAPHENE = {<br/>    'SCHEMA': 'rasyue.schema.schema'<br/>}</span></pre><p id="571c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你的<code class="du lr ls lt li b">settings.py</code>应该是这样的。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="er es mj"><img src="../Images/f04a3fca2d4515ad3447fc6b55e0fd2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FQUtYrruyC_e4UEBXXy9JQ.jpeg"/></div></div></figure><p id="fd14" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">仅此而已。运行你的<strong class="ih hj"> django </strong>项目，然后进入<code class="du lr ls lt li b">localhost:8000/graphql</code></p><h1 id="730b" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">结束了..</h1><p id="b84e" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">至此，本教程到此结束。希望对你有所帮助。谢谢大家，敬请期待。</p></div></div>    
</body>
</html>