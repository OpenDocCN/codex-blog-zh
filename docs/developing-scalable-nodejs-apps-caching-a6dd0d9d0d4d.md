# 开发可伸缩的 NodeJS 应用程序:缓存

> 原文：<https://medium.com/codex/developing-scalable-nodejs-apps-caching-a6dd0d9d0d4d?source=collection_archive---------11----------------------->

假设您为一个访问量不大的客户创建了一个博客，流程将会非常简单——想要查看一个故事的用户只需点击一个链接，向服务器发送请求，然后服务器将从数据库中获取该特定帖子的查询，然后将其发送回用户。*瞧！*

如果博客突然爆料了一个名人故事(或《T4》的内幕消息)并且突然获得了比平常高得多的流量，而服务器无法处理如此大的请求量，你的博客会如何处理这种情况？

![](img/270c9336b44f7429ac60d6de33c2554b.png)

*aww 备注…图片来源:*[https://www.exai.com/blog/503-service-unavailable](https://www.exai.com/blog/503-service-unavailable)

上述场景是您在开发大规模应用程序时将面临的一种情况，缓存提供了一种近乎万无一失的处理方式，

***什么是缓存？***

简而言之，缓存包括将数据存储在临时存储解决方案中，以便可以更快地提供给用户。当在短时间内被重复请求的文件被缓存时，它们可以被存储在缓存中，这使得它们可以更快地被访问，而不需要重复查询数据库(或者在我们将在下面使用的例子中，外部 API 调用)，并且提高了我们的应用程序的性能。

***缓存在动作***

内存数据库是最常用的缓存资源。与将数据存储在磁盘上的数据库相比，它们主要依靠内存来存储数据。这减少了访问磁盘的需要，从而缩短了响应时间。最流行的内存数据库是 Redis，这是我们将在示例中使用的。你需要为你的操作系统(Mac 或 Linux)安装 Redis，或者为 Windows 使用云替代系统。Redis 还将数据备份到磁盘，因此它可以持久保存数据，从而提供了一个出色的数据恢复功能。

在我们的示例中，我们将缓存从 API 返回的数据，因此每当我们需要数据时，它将检查我们的缓存中的数据，如果数据存在就返回数据，而不是总是调用 API(其中一些可能不成功)。

使用`npm init -y`设置新的 npm 项目，并安装以下依赖项:

```
npm install redis axios express
```

这将安装 Node.js Redis 客户端和 Axios，以便进行 API 调用。在文件夹的根目录下，创建一个`redis.js`文件，并添加以下代码:

redis.js

Redis 默认监听端口 6379，如果使用云提供商，应该用正确的 URL 替换 localhost。

现在，同样在根文件夹中，创建一个`index.js`文件。在这里，我们将设置一个从 API 获取数据的路由，然后缓存这些数据。理解 Redis 重要性的一个简单方法是在 API 测试工具中记录下第一个请求的响应时间，并将其与随后的响应时间进行比较。

在我们的`index.js`文件中，我们有一个获取所有国家列表并返回给用户的端点。这些是我们缓存的数据类型——通常被频繁请求且很少更改的数据。当一个新用户要注册您的应用程序时，总是可以请求一个国家列表，而一个新的国家不会每天都弹出来。

下面是从 API 获取数据和在 Redis 中缓存数据所用时间的差异:

![](img/4ec260da002ebfbc1da652b6a7dacffd.png)

从 API 获取时大约 2 秒

![](img/7b36eb5ab43c812814185a2589c93d3c.png)

从我们的缓存中提取时，仅 22 毫秒

Redis 是高性能的，可以处理大量并发请求。事实上，它非常强大，可以做的不仅仅是缓存。您可以在这里看到更多使用 Node.js 客户端的 Redis 示例。