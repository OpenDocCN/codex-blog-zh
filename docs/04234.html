<html>
<head>
<title>JSON Web Token Authentication on React/Redux</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React/Redux上的JSON Web令牌认证</h1>
<blockquote>原文：<a href="https://medium.com/codex/json-web-token-authentication-on-react-redux-982e5f003422?source=collection_archive---------0-----------------------#2021-11-11">https://medium.com/codex/json-web-token-authentication-on-react-redux-982e5f003422?source=collection_archive---------0-----------------------#2021-11-11</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/8ae27a1a45de1162bd93f74dbaabb676.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OodX4DnzQMYfnACLgmiFKg.jpeg"/></div></div></figure><p id="9a80" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="jo">2022年1月14日更新，有重要说明和一些更新的代码片段。</em></p><p id="301c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">有一个词会经常出现，那就是认证。根据<a class="ae jp" href="https://www.merriam-webster.com/dictionary/authentication" rel="noopener ugc nofollow" target="_blank">韦氏词典</a>的说法，认证是显示某物(如身份、艺术品或金融交易)真实、真实或真实的行为、过程或方法。用技术术语来说，它将显示用户连接的应用程序是一个输入密码的正版应用程序。</p><p id="5d12" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们专注于React-Redux前端。如果您正在为您的Bootcamp组合项目寻找使用Ruby on Rails后端的身份验证，<a class="ae jp" href="https://github.com/dakotalmartinez/rails-devise-jwt-tutorial" rel="noopener ugc nofollow" target="_blank">该文档和GitHub repo是一个很好的演练</a>。他还得到了<a class="ae jp" href="https://github.com/DakotaLMartinez/react-redux-auth-client" rel="noopener ugc nofollow" target="_blank"> frontend React-Redux演练</a>，虽然我的代码在调试了几个问题后结果是不一样的。</p><p id="28e4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">由于我们专注于身份验证，让我们假设我们已经通过运行命令<code class="du jq jr js jt b">npx create-react-app my-app — template redux</code>创建了一个带有Redux的React应用程序，并且在实现身份验证之前拥有了我们想要的所有动作、组件和reducers。</p><p id="23e9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">非常重要的是，在深入研究在我们的项目中添加身份验证之前，让我们确保我们添加了我们将要在index.js文件的<code class="du jq jr js jt b">combineReducer</code>函数中实现的身份验证缩减器。</p><pre class="ju jv jw jx fd jy jt jz ka aw kb bi"><span id="85c1" class="kc kd hi jt b fi ke kf l kg kh">import authorization from './reducers/authorizationReducer'; </span><span id="a390" class="kc kd hi jt b fi ki kf l kg kh">const reducer = combineReducers({  <br/>   podcasts,  <br/>   authorization,<br/>})</span></pre><h1 id="a0b9" class="kj kd hi bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">动作:</h1><p id="9b00" class="pw-post-body-paragraph iq ir hi is b it lg iv iw ix lh iz ja jb li jd je jf lj jh ji jj lk jl jm jn hb bi translated">让我们继续前进，并得到行动头痛的方式。我最近了解到，最佳实践是将它们存储在同一个文件中。因此，在动作文件夹中，让我们创建一个文件，并将其命名为<code class="du jq jr js jt b">actionTypes.js</code>。在该文件中，我们将添加动作类型<code class="du jq jr js jt b">AUTHENTICATED</code>和<code class="du jq jr js jt b">NOT_AUTHENTICATED</code>，并导出它们。</p><pre class="ju jv jw jx fd jy jt jz ka aw kb bi"><span id="4feb" class="kc kd hi jt b fi ke kf l kg kh">const AUTHENTICATED = 'AUTHENTICATED'<br/>const NOT_AUTHENTICATED = 'NOT_AUTHENTICATED' </span><span id="f175" class="kc kd hi jt b fi ki kf l kg kh">export {AUTHENTICATED, NOT_AUTHENTICATED}</span></pre><p id="8da7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将通过创建一个名为auth.js的文件来创建导入动作类型的动作。在同一个文件中，我们将添加函数<code class="du jq jr js jt b">setToken</code>、<code class="du jq jr js jt b">getToken</code>和<code class="du jq jr js jt b">deleteToken</code>，因为我们正在处理<a class="ae jp" href="https://javascript.plainenglish.io/where-to-store-the-json-web-token-jwt-4f76abcd4577" rel="noopener ugc nofollow" target="_blank"> JWT令牌，这些令牌将被相应地存储</a>和删除。在这种情况下，我使用<code class="du jq jr js jt b">localStorage</code>来保存那些令牌。</p><p id="6bca" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">以下是整个文件:</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="ll lm l"/></div></figure><p id="1a7b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在继续之前，让我们将所有的新动作导入到一个<code class="du jq jr js jt b">index</code>文件中。</p><p id="54ff" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du jq jr js jt b">export { signupUser, loginUser, logoutUser, checkAuth } from “./auth”;</code></p><h1 id="604c" class="kj kd hi bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">减速器:</h1><p id="abdf" class="pw-post-body-paragraph iq ir hi is b it lg iv iw ix lh iz ja jb li jd je jf lj jh ji jj lk jl jm jn hb bi translated">现在我们已经完成了身份验证操作。让我们来照顾减速器。让我们转到reducers文件夹并创建文件<code class="du jq jr js jt b">authorizationReducers.js</code>。还记得我们必须在<code class="du jq jr js jt b">index.js</code>中为<code class="du jq jr js jt b">combineReducers</code>功能添加授权吗？这是我们要导出减速器的地方。因此，让我们导入动作类型，声明一个初始状态并添加授权缩减器。</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="ll lm l"/></div></figure><p id="f2c4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们已经添加完了减速器。让我们深呼吸几秒钟。也许这是一个很好的时间来想想我们下一步该做什么。我们要创建组件吗？或者我们应该增加路线？对我来说，总是先有鸡还是先有蛋的困境。</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="ln lm l"/></div></figure><h1 id="ec7f" class="kj kd hi bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated"><strong class="ak">路线:</strong></h1><p id="9ec0" class="pw-post-body-paragraph iq ir hi is b it lg iv iw ix lh iz ja jb li jd je jf lj jh ji jj lk jl jm jn hb bi translated">现在，在深呼吸，让我们到目前为止所学的一切都在脑海中沉淀下来之后，我们感觉放松了。让我们快速浏览一下我们的路线，以便能够连接到我们现有的组件。</p><p id="89e4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">就我而言，我在<code class="du jq jr js jt b">app.js</code>文件中有路线。这是目前整个文件的样子。</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="ll lm l"/></div></figure><p id="d1ff" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在React项目中，路由是最简单的设置。安装<code class="du jq jr js jt b">react-router-dom</code>，从库中导入，创建路线。除了一些例外，它可能是整个项目中最简单的一行代码。但是，接下来，我想集中讨论这两条路线:</p><pre class="ju jv jw jx fd jy jt jz ka aw kb bi"><span id="668d" class="kc kd hi jt b fi ke kf l kg kh">&lt;Route exact path='/' component={Home}/&gt;            </span><span id="f17d" class="kc kd hi jt b fi ki kf l kg kh">&lt;Route exact path='/about' render={(routerProps) =&gt; &lt;wrappedComponents.AuthenticatedAbout {...routerProps}/&gt;}/&gt;            </span><span id="200c" class="kc kd hi jt b fi ki kf l kg kh">&lt;Route exact path='/signup' component={Signup} /&gt;            </span><span id="92ad" class="kc kd hi jt b fi ki kf l kg kh">&lt;Route exact path='/login' component={Login} /&gt;            </span><span id="5da3" class="kc kd hi jt b fi ki kf l kg kh">&lt;Route exact path='/logout' render={(routerProps) =&gt; &lt;wrappedComponents.AuthenticatedLogout protected {...routerProps} /&gt;}/&gt;            </span><span id="def5" class="kc kd hi jt b fi ki kf l kg kh">&lt;Route exact path='/podcasts/new' render={(routerProps) =&gt; &lt;wrappedComponents.ProtectedPodcastInput protected {...routerProps} /&gt;}/&gt;            </span><span id="9b76" class="kc kd hi jt b fi ki kf l kg kh">&lt;Route exact path='/podcasts' render={(routerProps) =&gt; &lt;wrappedComponents.AuthenticatedPodcasts {...routerProps} podcasts={this.props.podcasts}/&gt;}/&gt;            </span></pre><p id="0db5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">注意组件名看起来有什么不同吗？这是因为我们需要调用<code class="du jq jr js jt b">wrappedComponents</code>并确定那些将被保护的路由，并告诉我们将在导航栏中添加的三元条件语句何时显示登录和注册按钮以及何时显示注销按钮。</p><h1 id="0f34" class="kj kd hi bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">组件:</h1><p id="b761" class="pw-post-body-paragraph iq ir hi is b it lg iv iw ix lh iz ja jb li jd je jf lj jh ji jj lk jl jm jn hb bi translated">为了识别受保护的路由和不受保护的路由，让我们在components文件夹中创建一个文件并调用<code class="du jq jr js jt b">index.js</code>。在这个文件中，我们将导入我们想要声明为<code class="du jq jr js jt b">authComponents</code>或<code class="du jq jr js jt b">protComponents</code>的组件，这些组件是我们认为重要的对象。此外，我们还将导入一个名为<code class="du jq jr js jt b">withAuth</code>的重要组件，我们将在后面创建它。</p><pre class="ju jv jw jx fd jy jt jz ka aw kb bi"><span id="8901" class="kc kd hi jt b fi ke kf l kg kh">import About from "./About";<br/>import Podcasts from './Podcasts';<br/>import PodcastInput from "./PodcastInput";<br/>import PodcastEdit from "./PodcastEdit";<br/>import Logout from "./Logout";<br/>import Episodes from "./Episodes"<br/>import withAuth from "./WithAuth"; </span><span id="b512" class="kc kd hi jt b fi ki kf l kg kh">const authComponents = {About, Podcasts, Logout, Episodes}<br/>const protComponents = {PodcastEdit, PodcastInput}</span></pre><p id="acf8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">接下来，我们创建空对象，创建两个名为<code class="du jq jr js jt b">authenticatedComponents</code>和<code class="du jq jr js jt b">protectedComponents</code>的空对象。</p><pre class="ju jv jw jx fd jy jt jz ka aw kb bi"><span id="434c" class="kc kd hi jt b fi ke kf l kg kh">const authenticatedComponents = {}</span><span id="e82e" class="kc kd hi jt b fi ki kf l kg kh">const protectedComponents = {}</span></pre><p id="df0b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们已经创建了所有的四个对象，让我们添加两个循环，在其中我们将得到<code class="du jq jr js jt b">withAuth</code>的结果并生成值。这些将作为<code class="du jq jr js jt b">wrappedComponents</code>从文件导出到路线。</p><p id="5c9d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下面是整个<code class="du jq jr js jt b">index.js</code>文件的样子:</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="ll lm l"/></div></figure><p id="6606" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">说到<code class="du jq jr js jt b">Wrapped</code>，那是我们将要在withAuth.js组件文件中创建的类组件。在那里，我们将处理从actions文件夹中的<code class="du jq jr js jt b">index.js</code>文件导入的所有认证动作。我们甚至导入了一个加载指示器文件，如果你想在用户等待认证的时候变得有趣的话。</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="ll lm l"/></div></figure><p id="c4ca" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">没有登录或注册页面，就没有认证。因此，让我们继续创建这两个组件。</p><p id="bdfd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">注意:</strong>从<code class="du jq jr js jt b">path=’/’</code>开始不要添加主页或任何其他组件作为保护组件。用受保护的组件启动react会导致后端崩溃。</p><p id="70c9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">报名:</strong></p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="ll lm l"/></div></figure><p id="a4cf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">登录:</strong></p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="ll lm l"/></div></figure><p id="3082" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">注销:</strong></p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="ll lm l"/></div></figure><p id="26d4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最后，我们可以调整导航条来适应新的身份验证。我想提醒这个项目是用Material-ui实现的。更多详情请参考他们的<a class="ae jp" href="https://mui.com/components/app-bar/" rel="noopener ugc nofollow" target="_blank">应用程序栏文档</a>。整个<code class="du jq jr js jt b">navbar.js</code>看起来是这样的:</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="ll lm l"/></div></figure><p id="1ab0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我想着重谈以下几点:</p><p id="3cc6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">从react-redux导入<code class="du jq jr js jt b">useSelector</code>钩子。</p><p id="cf3a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du jq jr js jt b">import { useSelector } from ‘react-redux’</code></p><p id="6051" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在<code class="du jq jr js jt b">NavBar</code>函数中创建<code class="du jq jr js jt b">loggedIn</code>钩子。</p><p id="871c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du jq jr js jt b">const loggedIn = useSelector(state =&gt; state.authorization.loggedIn)</code></p><p id="a7a2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在您想要显示认证特性切换按钮的<code class="du jq jr js jt b">Navbar</code>类中，我们将输入以下代码。</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="ll lm l"/></div></figure><p id="cbd1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，我们将能够注册新用户，登录现有用户，并在可能的时候注销。只需点击导航栏中的链接。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lo"><img src="../Images/59726900d60f85f7e804d9c714d5db3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mutHRWc_SLycKj4mzQFXFw.png"/></div></div><figcaption class="lp lq et er es lr ls bd b be z dx translated">这里有一个截图，显示了在导航栏中使用注销按钮时，创建播客页面的外观。当前版本没有主页图标，但截屏只是一个例子。</figcaption></figure><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es lt"><img src="../Images/52748d4a4b90b79c432fe37117bed244.png" data-original-src="https://miro.medium.com/v2/resize:fit:712/0*1VrDZWp-t4S_4E2w.gif"/></div></figure><p id="2a58" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这个过程很长，但是可以通过提供的文档、一些研究、一些帮助和耐心来完成。谁知道呢？也许你得到了这个惊人的项目，在实现认证时不会破坏那么多。</p><p id="59df" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">希望你能做到，我也希望这能帮助你。编码快乐！</p><h1 id="ec31" class="kj kd hi bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">总结:</h1><ol class=""><li id="79a0" class="lu lv hi is b it lg ix lh jb lw jf lx jj ly jn lz ma mb mc bi translated">认证介绍。</li><li id="d701" class="lu lv hi is b it md ix me jb mf jf mg jj mh jn lz ma mb mc bi translated">开始在React-Redux项目中实现身份验证。</li><li id="f3fd" class="lu lv hi is b it md ix me jb mf jf mg jj mh jn lz ma mb mc bi translated">行动</li><li id="20a0" class="lu lv hi is b it md ix me jb mf jf mg jj mh jn lz ma mb mc bi translated">还原剂</li><li id="b1c8" class="lu lv hi is b it md ix me jb mf jf mg jj mh jn lz ma mb mc bi translated">路线</li><li id="e5f1" class="lu lv hi is b it md ix me jb mf jf mg jj mh jn lz ma mb mc bi translated">成分</li><li id="d72d" class="lu lv hi is b it md ix me jb mf jf mg jj mh jn lz ma mb mc bi translated">索引</li><li id="cd26" class="lu lv hi is b it md ix me jb mf jf mg jj mh jn lz ma mb mc bi translated">withAuth</li><li id="26b1" class="lu lv hi is b it md ix me jb mf jf mg jj mh jn lz ma mb mc bi translated">注册、登录、注销</li><li id="94f0" class="lu lv hi is b it md ix me jb mf jf mg jj mh jn lz ma mb mc bi translated">导航条</li></ol><h1 id="4583" class="kj kd hi bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">参考资料:</h1><ol class=""><li id="fa06" class="lu lv hi is b it lg ix lh jb lw jf lx jj ly jn lz ma mb mc bi translated">https://www.merriam-webster.com/dictionary/authentication</li><li id="1a81" class="lu lv hi is b it md ix me jb mf jf mg jj mh jn lz ma mb mc bi translated">Dakota L Martinez，在Github上设计Ruby Gem &amp; JWT文档:<a class="ae jp" href="https://github.com/dakotalmartinez/rails-devise-jwt-tutorial" rel="noopener ugc nofollow" target="_blank">https://Github . com/dakotalmartinez/rails-device-jwt-tutorial</a></li><li id="e703" class="lu lv hi is b it md ix me jb mf jf mg jj mh jn lz ma mb mc bi translated">Dakota L Martinez，React-Redux Github上的JWT认证文档:【https://github.com/DakotaLMartinez/react-redux-auth-client T4】</li><li id="a372" class="lu lv hi is b it md ix me jb mf jf mg jj mh jn lz ma mb mc bi translated">Naveen DA，你应该在哪里存储JSON Web令牌:<a class="ae jp" href="https://javascript.plainenglish.io/where-to-store-the-json-web-token-jwt-4f76abcd4577" rel="noopener ugc nofollow" target="_blank">https://JavaScript . plain English . io/Where-to-Store-the-JSON-we b-token-jwt-4 f 76 ABCD 4577</a></li><li id="667f" class="lu lv hi is b it md ix me jb mf jf mg jj mh jn lz ma mb mc bi translated">材质-ui App栏文档:<a class="ae jp" href="https://mui.com/components/app-bar/" rel="noopener ugc nofollow" target="_blank">https://mui.com/components/app-bar/</a></li></ol></div></div>    
</body>
</html>