<html>
<head>
<title>Service Classes and Anemic Objects</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">服务类和贫血对象</h1>
<blockquote>原文：<a href="https://medium.com/codex/class-design-is-important-99bd4725ecb8?source=collection_archive---------23-----------------------#2021-03-22">https://medium.com/codex/class-design-is-important-99bd4725ecb8?source=collection_archive---------23-----------------------#2021-03-22</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="5aa3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">随着我职业生涯的进展，我遇到了越来越多的项目，在这些项目中“<em class="jd">一个类设计</em> <em class="jd">如果有效就足够好了”。</em>由于<em class="jd"> </em>这一点，程序员经常想出短视的类设计，这些设计会制造维护噩梦。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/aa23d523ea873e75b595d76d28066b9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NGuSpe1hquk7aDKHxQKNhw.jpeg"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">弗拉德·亚历山德鲁·波帕摄于Pexels</figcaption></figure><p id="5dce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了这篇文章，我将提供一个简单的例子，尽管是一个真实的例子。考虑一个目的是处理支付的应用程序。这种应用程序中的核心域类是一个<em class="jd"> Money </em>类。毕竟没有<em class="jd">钱</em>处理款项是不可能的。</p><p id="6c29" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一个常见版本的<em class="jd"> Money </em>类如下所示:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="ju jv l"/></div></figure><p id="8ea8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个类泄露了它的内部状态。</p><p id="a184" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当你需要用这个类做业务操作的时候，问题就显现出来了。具有上述数据对象风格类的业务逻辑倾向于通过特定的<em class="jd">服务/ </em> <a class="ae jw" href="https://dzone.com/articles/transaction-script-pattern" rel="noopener ugc nofollow" target="_blank"> <em class="jd">事务脚本</em> </a> <em class="jd"> </em>类来处理。</p><p id="f254" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">虽然这对于超小型应用程序来说完全没问题，但是对于具有复杂业务逻辑的大型应用程序来说是绝对不行的。</p><p id="2313" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如，我看到的事件涉及</p><ol class=""><li id="9679" class="jx jy hi ih b ii ij im in iq jz iu ka iy kb jc kc kd ke kf bi translated">必须知道客户的最终发票是否高于275欧元的特定阈值，以及</li><li id="3ec8" class="jx jy hi ih b ii kg im kh iq ki iu kj iy kk jc kc kd ke kf bi translated">做一些非常具体的事情。</li></ol><p id="1b53" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请注意，这个应用程序适用于各个欧洲国家，甚至是那些没有采用欧元的国家。</p><p id="0867" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">完成此操作的类看起来很像这样:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="ju jv l"/></div></figure><p id="7aa0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我提到的特殊例子中，你在上面看到的这个<em class="jd">服务</em>是在两个独立的模块中实现的。实现这一新功能的开发人员并不知道，函数参数中的<em class="jd">阈值</em>在一个模块中以欧元的形式发送，而在另一个模块中则以当地货币的形式发送。</p><p id="5169" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">代码和语义都没有明确说明这一点。这是一场迫在眉睫的灾难。</p><h2 id="2864" class="kl km hi bd kn ko kp kq kr ks kt ku kv iq kw kx ky iu kz la lb iy lc ld le lf bi translated">让它变得更好</h2><p id="e2ea" class="pw-post-body-paragraph if ig hi ih b ii lg ik il im lh io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">现在，我们可以采取简单的方法，仅仅将函数参数重命名为<em class="jd"> thresholdValueInEuros </em>来表示意图。</p><h2 id="c2e6" class="kl km hi bd kn ko kp kq kr ks kt ku kv iq kw kx ky iu kz la lb iy lc ld le lf bi translated">进一步的变化</h2><p id="7bc0" class="pw-post-body-paragraph if ig hi ih b ii lg ik il im lh io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">我们可以再调整一下。在这个迭代中，我们可以使函数参数成为Money类本身的一个实例。现在函数的定义是这样的</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="ju jv l"/></div></figure><h2 id="2a62" class="kl km hi bd kn ko kp kq kr ks kt ku kv iq kw kx ky iu kz la lb iy lc ld le lf bi translated">我们能做得更多吗？</h2><p id="dc86" class="pw-post-body-paragraph if ig hi ih b ii lg ik il im lh io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">绝对的。</p><p id="a50d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我对上述解决方案的问题是，与核心<em class="jd"> Money </em>相关的逻辑现在将分布在另外两个类中，即<em class="jd"> ConversionService </em>(用于转换)和<em class="jd">billcutamingservice</em>(一个<em class="jd"> Money </em>的数值比另一个大)。</p><p id="ff8b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这意味着这三个类都是耦合的。</p><p id="4731" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们在这里举了一个简单的单个类的例子，但是想象一个场景，其中整个应用程序是用类似于<em class="jd"> Money </em>类的<em class="jd">数据对象</em>编写的，并且所有的业务逻辑分布在各个<em class="jd"> Service </em>类中。随着项目越来越多的特性，引入极度耦合的类的机会越来越多，这使得更改变得非常麻烦。</p><h2 id="16d5" class="kl km hi bd kn ko kp kq kr ks kt ku kv iq kw kx ky iu kz la lb iy lc ld le lf bi translated">我的首选方法</h2><p id="903b" class="pw-post-body-paragraph if ig hi ih b ii lg ik il im lh io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">我的首选方法的关键是创建不暴露其内部状态的封装类。</p><p id="b16a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一个不同的货币类实现如下所示</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="ju jv l"/></div></figure><p id="d605" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里有两个不同之处</p><ul class=""><li id="0648" class="jx jy hi ih b ii ij im in iq jz iu ka iy kb jc ll kd ke kf bi translated"><strong class="ih hj">值<em class="jd">和货币<em class="jd">都没有通过getter</em></em></strong>公开</li><li id="4469" class="jx jy hi ih b ii kg im kh iq ki iu kj iy kk jc ll kd ke kf bi translated"><strong class="ih hj">值的比较是通过</strong> <em class="jd">钱</em> <strong class="ih hj">类本身</strong>来完成的</li></ul><p id="34cf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这消除了对<em class="jd">billcutamingservice</em>类中货币比较的需要，并且<em class="jd"> ConversionService </em>中的转换逻辑也通过<em class="jd"> Money </em>类调用<em class="jd"> </em>。</p><p id="4aaf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但我会更进一步。我不会仅仅调用<em class="jd"> ConversionService </em>方法，而是将该逻辑移到别处。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="ju jv l"/></div></figure><p id="ae72" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用这种方法，每次在应用程序中引入一种新货币时(例如，在一个新的国家推出)，都必须指定转换因子，因为这将是一次编译时检查。</p><h2 id="9d35" class="kl km hi bd kn ko kp kq kr ks kt ku kv iq kw kx ky iu kz la lb iy lc ld le lf bi translated">更多地思考“对象”</h2><p id="ad15" class="pw-post-body-paragraph if ig hi ih b ii lg ik il im lh io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">我想到的最后一个变化是将<em class="jd"> thresholdAmount </em>参数转换为特定的<em class="jd"> ThresholdAmount </em>对象。</p><p id="6182" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在如果你想一想<em class="jd">threshold amount</em><a class="ae jw" href="https://en.wikipedia.org/wiki/Is-a" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj">是<em class="jd">-a</em></strong></a><em class="jd"/>Money，但唯一的区别是它是如何初始化的，前者是通过<em class="jd">配置完成的。</em>(记住，这个值是可配置的)</p><p id="6d08" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这就是为什么我认为可以有一个<em class="jd"> ThresholdAmount </em>对象。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="ju jv l"/></div></figure><h2 id="4402" class="kl km hi bd kn ko kp kq kr ks kt ku kv iq kw kx ky iu kz la lb iy lc ld le lf bi translated">结论</h2><p id="503d" class="pw-post-body-paragraph if ig hi ih b ii lg ik il im lh io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">过多的前期设计会适得其反。</p><p id="4d7a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">太少也可以！</p><p id="d564" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">找到最佳点是我们需要学习的东西，而且根据经验这经常会发生。</p><p id="e430" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">关键是要知道什么时候需要重构，然后说服你的团队，也许还有你的经理。设计良好的类通常是帮助您更快实现新功能或避免错误的重要工具。下一个维护你的代码库的人会感谢你的。</p></div></div>    
</body>
</html>