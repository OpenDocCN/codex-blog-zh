<html>
<head>
<title>Microfrontend — what, why, and how under 7 mins | ELI5</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">微前端—内容、原因和方式不到7分钟| ELI5</h1>
<blockquote>原文：<a href="https://medium.com/codex/microfrontend-what-why-and-how-under-7-mins-eli5-58041f726bbe?source=collection_archive---------7-----------------------#2021-07-03">https://medium.com/codex/microfrontend-what-why-and-how-under-7-mins-eli5-58041f726bbe?source=collection_archive---------7-----------------------#2021-07-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="4040" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这将是我尽可能用最好的方式解释网络内容的众多故事之一(像我一样解释给我听)。所以坚持住，不会太久的。</p><p id="1402" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，正如标题所暗示的，让我们一次一个地讨论一下微前端是什么、为什么、如何工作的。</p></div><div class="ab cl jd je gp jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="hb hc hd he hf"><h1 id="8865" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated"><code class="du ki kj kk kl b"><strong class="ak"><em class="km">The What</em></strong></code></h1><p id="835f" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated"><em class="ks">微前端</em>，现在已经被各行各业广泛采用，已经有一段时间了。这基本上意味着让你不同的前端应用程序，协同工作，让它感觉/行为像一个单一的应用程序。</p><blockquote class="kt ku kv"><p id="6289" class="if ig ks ih b ii ij ik il im in io ip kw ir is it kx iv iw ix ky iz ja jb jc hb bi translated">如果你来自后台，并且你编写服务，你应该熟悉微服务架构。微前端基本上就是这样，但是对于前端来说。</p></blockquote><p id="1668" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这里，您可以绑定多个前端应用程序，最终用户会感觉他们在使用一个web应用程序。</p><figure class="la lb lc ld fd le er es paragraph-image"><div class="er es kz"><img src="../Images/250f97c3c35f6860daf8829c692eac8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:770/format:webp/1*0Sex3NZD0HO1HrZjziKVhg.png"/></div><figcaption class="lh li et er es lj lk bd b be z dx translated">在这里，终端用户只知道App 1。(此处应用1是主机应用)</figcaption></figure><p id="fd1f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里，您有4个不同的应用程序，它们在后台协同工作。这4个可以是任何前端应用，用任何框架构建，可以完全隔离。(假设我们在app4中有一个angular应用程序，在app2中有一个react应用程序，在App1中有一个vue应用程序)。</p></div><div class="ab cl jd je gp jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="hb hc hd he hf"><h1 id="373c" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated"><strong class="ak"> <em class="km">这个为什么</em> </strong></h1><p id="9e50" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">假设您有一个用于电子商务业务的web应用程序，它展示了登录页面、一些产品和价格。<br/>现在，你需要一个支付门户，你意识到这将是一个至关重要的功能，你希望你的客户能有一个流畅的体验。你也意识到你已经拥有的应用程序是一个遗留软件，现在很难维护。</p><p id="34db" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在你想改造你的整个产品，但你没有时间或资源去做。所以你决定继续前进，平台上的任何新特性都将是你最近遇到的这个超级酷的框架。</p><p id="d46d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此外，您不希望破坏当前的客户体验。</p><p id="b8f6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你是做什么的？</p><p id="ec2a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你所做的就是在你的平台之外做微前端。你雇佣了一个团队致力于这项功能(在我们的例子中是支付)——为此建立一个单独的应用程序，并将其放在你的主应用程序中。</p><p id="3cc1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你基本上是给你的用户一个全新的应用程序与现有的集成。</p><p id="4ccb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，这个功能将会非常快，因为它不像你的主应用程序那样有一万亿个依赖项，具有非常小的包大小(与你的主应用程序相比)和非常美观的外观和感觉(取决于你设计它lol)。</p><p id="3f4d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是你还问什么？</p><p id="d1d5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">拥有一套不同的应用程序有助于你独立运行不同的团队，每个团队的核心焦点更加集中。<br/>此外，由于它们是独立的应用程序，你的应用程序2干扰应用程序3的机会显著减少(不是零，因为你有时确实有一个共享状态)。</p><p id="0723" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您的团队可以并行工作，而不必担心其他团队在做什么。</p><p id="6dcb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是公司真的用这个吗？是的，他们有。宜家、Spotify、SoundCloud、Upwork等等。</p><figure class="la lb lc ld fd le er es paragraph-image"><div class="er es ll"><img src="../Images/b5f224a94584073e693c4a9aeb355ec6.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/1*geaMyik-vXZW3uwrxYLvHA.gif"/></div></figure><p id="7183" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果它有那么好，每个人都应该使用它，对吗？</p><p id="23a3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">嗯，套用本叔叔的话，伟大的架构带来了巨大的复杂性。</p><p id="fdad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因为你要把你的应用程序分割成不同的小程序，所以在它的状态管理中需要做一些工作。状态基本上是数据，应用程序用它来做一些操作。</p><p id="5568" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这方面的一个基本例子是:假设您的支付应用程序需要某种令牌来验证支付。或者它需要用户数据来生成发票。现在你不能让你的用户每次访问任何新的微前端应用时都登录。这显然会泄露你可爱的小建筑，更重要的是，一些可怕的UX。</p><p id="d079" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，必须有一种方法在不同的应用程序之间共享状态，对吗？—或者至少是你的微前端应用之间的某种通信。</p><p id="6c4b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们看看“如何”部分。</p></div><div class="ab cl jd je gp jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="hb hc hd he hf"><h1 id="1dfd" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">怎么做</h1><p id="45db" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">我们将采用不同的方法来微前端化你的应用。随着<a class="ae lm" href="https://webpack.js.org/concepts/module-federation/" rel="noopener ugc nofollow" target="_blank"> Webpack 5的模块联盟</a>的发布，微前端获得了进一步的流行。这涉及到调整您的配置以适应这种架构。但是我们将走一条不同的路线。一个非常著名的公司Hubspot使用的。</p><p id="5ca0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="ks"> iframes </em> </strong></p><p id="9eef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于那些不知道iframe是什么的人来说，它基本上是一个与你的网站不同的网站。你可以有你的作品集网站，你可以把google.com放在你的网站里。它就像一个容器。<br/>你可能见过一些地方，youtube视频被嵌入到不同的网站中，就像这个。</p><figure class="la lb lc ld fd le"><div class="bz dy l di"><div class="ln lo l"/></div></figure><p id="0627" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">继续检查视频上的元素，您会看到一个叫做<iframe>的东西。这有助于轻松地将这个视频或任何网站放入您自己的网站。</iframe></p><p id="fd37" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你不知道youtube，你会认为这个视频是这个网站的一部分。还有tada！这基本上是微前端:D的症结所在</p><p id="9322" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是这里很简单，因为这个网站和youtube之间没有数据交换。那么，如果你需要分享一些数据，或者换句话说，与子应用程序(在这种情况下是youtube)进行交流，那又如何呢？</p><p id="f229" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可以使用<a class="ae lm" href="https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage" rel="noopener ugc nofollow" target="_blank"> PostMessage API </a>来完成。您可以将数据模型传递给子应用程序，并且可以监听子应用程序发出的事件。</p><p id="814c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我们的支付案例中，我们可以将用户对象和令牌传递给子应用程序，一旦支付完成，子应用程序可以发出一个事件，让主机/父应用程序知道支付完成。然后父应用程序可以重定向并生成发票。</p><p id="2c55" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">好吧好吧。你是怎么做到的呢？</p><figure class="la lb lc ld fd le er es paragraph-image"><div class="er es lp"><img src="../Images/47d2ab85503503764373e056358f55db.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*uw9zz2DntlYeRe-275YfDg.jpeg"/></div></figure><p id="1370" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以为了让Linus Torvalds冷静下来，我将向您展示一些关于如何开始的基本片段。</p><p id="8ea2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在您的主应用程序中，您想要呈现子应用程序的地方，您只需要一个容器(最好是一个div ),然后在iframe中托管您的子应用程序。为了与应用程序交流，我们将使用<a class="ae lm" href="https://www.npmjs.com/package/postmate" rel="noopener ugc nofollow" target="_blank"> Postmate </a>，但也可以随意使用您选择的任何其他库。</p><p id="7e64" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="ks">主应用的典型设置</em></p><pre class="la lb lc ld fd lq kl lr ls aw lt bi"><span id="662f" class="lu jl hi kl b fi lv lw l lx ly">&lt;template&gt;<br/>  &lt;div<br/>    id="childapp"<br/>    ref="childapp"<br/>    style="height: 100vh; width: 100%; border: none"<br/>  &gt;&lt;/div&gt;<br/>&lt;/template&gt;</span><span id="d736" class="lu jl hi kl b fi lz lw l lx ly">&lt;script&gt;</span><span id="a414" class="lu jl hi kl b fi lz lw l lx ly">// Postmate sets up an handshake with your child app</span><span id="d72f" class="lu jl hi kl b fi lz lw l lx ly">    new Postmate({<br/>        container: this.$refs.childapp,<br/>        url: `${url-of-your-child-app}`,<br/>        name: 'child-app-name',<br/>        model: {<br/>          // any data that you need to pass to your child.<br/>       <br/>          sampleData: 'tokenABC'</span><span id="f408" class="lu jl hi kl b fi lz lw l lx ly">        },<br/>      })</span><span id="4095" class="lu jl hi kl b fi lz lw l lx ly">      .then((child: any) =&gt; {</span><span id="ffbc" class="lu jl hi kl b fi lz lw l lx ly">          // Handshake with Child is complete</span><span id="aa7b" class="lu jl hi kl b fi lz lw l lx ly">         /* <br/>            now that your handshake is setup, you can listen<br/>            to events from your child app. <br/>          */</span><span id="7c39" class="lu jl hi kl b fi lz lw l lx ly">          child.on('getRefreshedTokenId', async () =&gt; {<br/>            const tokenId = await this.getTokenId()</span><span id="fbb5" class="lu jl hi kl b fi lz lw l lx ly">            /* <br/>             you can also call any child app's function that is <br/>             exposed by the child app. <br/>            /*</span><span id="b916" class="lu jl hi kl b fi lz lw l lx ly">          child.call('setTokenId', tokenId)</span><span id="7da0" class="lu jl hi kl b fi lz lw l lx ly">          })<br/>        })</span><span id="5c2a" class="lu jl hi kl b fi lz lw l lx ly">       .catch(async (err: Error) =&gt; {<br/>          // catch errors if any. </span><span id="a734" class="lu jl hi kl b fi lz lw l lx ly">       })</span><span id="3365" class="lu jl hi kl b fi lz lw l lx ly">&lt;/script&gt;</span></pre><p id="f848" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在让我们看看子应用程序，以及它如何与父应用程序通信。</p><p id="bf37" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">子应用程序的根级组件:</p><pre class="la lb lc ld fd lq kl lr ls aw lt bi"><span id="b32d" class="lu jl hi kl b fi lv lw l lx ly">&lt;script&gt; <br/> new Postmate.Model({</span><span id="7996" class="lu jl hi kl b fi lz lw l lx ly">        setTokenId: setTokenIdFromParentApp, // this function is<br/>                                              exposed to parent app<br/>        })</span><span id="2938" class="lu jl hi kl b fi lz lw l lx ly">  .then((parent: any) =&gt; {<br/>        console.log('Handshake with parent complete.')<br/>        const { model } = parent</span><span id="e57c" class="lu jl hi kl b fi lz lw l lx ly">// model has all the data that is passed down from parent. <br/>   <br/>        // you can also emit to parent using<br/>     <br/>        parent.emit('getRefreshedTokenId') // name of the event</span><span id="80fe" class="lu jl hi kl b fi lz lw l lx ly">      })</span><span id="2995" class="lu jl hi kl b fi lz lw l lx ly">&lt;/script&gt;</span></pre><p id="95aa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您也可以将您的连接/握手保存到一个变量中，并在应用程序中使用，以防止创建超过1个连接。<br/>只需使用parent connection = new post mate . model()或child connection = new post mate()<br/>并在以后使用它们。</p><p id="bd25" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦完成，也就是说，当您路由到一个不同的url或组件时，您可以使用</p><pre class="la lb lc ld fd lq kl lr ls aw lt bi"><span id="8199" class="lu jl hi kl b fi lv lw l lx ly">childConnection.then(child =&gt; child.destroy())</span></pre><p id="c86a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">还有…差不多就是这样。</p><p id="6b79" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您希望您的子路由显示在浏览器url上，那么会有一些与路由相关的复杂情况。这超出了本文的范围，我将让您自己解决。如果你遇到这个问题，可以亲自联系我，我很乐意帮助你。</p><p id="7e0f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，如果你在想，为什么使用Postmate模型将数据传递到子应用程序中，而不仅仅是使用浏览器本地存储或cookies。</p><p id="1bc0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是因为由于你使用iframe，你的孩子应用程序无法访问你父母的本地存储。或者饼干。</p></div><div class="ab cl jd je gp jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="hb hc hd he hf"><p id="deba" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">希望这能澄清一些事情，让你学到一些新的东西。如果这是真的，一两个掌声将不胜感激！</p><p id="c9c4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我知道这可能有点超过了ELI5，在未来我会试着打破常规。</p><p id="de60" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要阅读更多ELI5系列中与网络相关的东西，你可以在这里关注我的作品！</p></div><div class="ab cl jd je gp jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="hb hc hd he hf"><blockquote class="ma"><p id="a1d0" class="mb mc hi bd md me mf mg mh mi mj jc dx translated">谢谢你走了这么远！！！</p></blockquote><p id="15c4" class="pw-post-body-paragraph if ig hi ih b ii mk ik il im ml io ip iq mm is it iu mn iw ix iy mo ja jb jc hb bi translated"><em class="ks">可以在上面联系我，</em><a class="ae lm" href="https://github.com/baibhabmondal" rel="noopener ugc nofollow" target="_blank"><em class="ks">github</em></a><em class="ks">，</em><a class="ae lm" href="https://www.linkedin.com/in/baibhab-mondal/" rel="noopener ugc nofollow" target="_blank"><em class="ks">linkedIn</em></a><em class="ks">。或者</em> <a class="ae lm" href="https://twitter.com/baibhabmondal" rel="noopener ugc nofollow" target="_blank"> <em class="ks">碎碎念</em> </a></p></div></div>    
</body>
</html>