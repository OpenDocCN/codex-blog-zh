<html>
<head>
<title>Understanding Event Loop in JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">理解JavaScript中的事件循环</h1>
<blockquote>原文：<a href="https://medium.com/codex/understanding-event-loop-in-javascript-be44340e243b?source=collection_archive---------13-----------------------#2022-10-12">https://medium.com/codex/understanding-event-loop-in-javascript-be44340e243b?source=collection_archive---------13-----------------------#2022-10-12</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/39fa8edcc9713b2a3759dd9e6019a05f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*28I9QRE9ZUWrbbr-.png"/></div></div></figure><h1 id="55c2" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">定义</h1><p id="cc89" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">JavaScript有一个基于事件循环的运行时模型，它负责执行代码、收集和处理事件，以及执行排队的子任务。可能发生的事件有:</p><ul class=""><li id="f6d5" class="km kn hi jq b jr ko jv kp jz kq kd kr kh ks kl kt ku kv kw bi translated">浏览器事件，比如当一个页面加载完毕或者要卸载的时候</li><li id="d94c" class="km kn hi jq b jr kx jv ky jz kz kd la kh lb kl kt ku kv kw bi translated">网络事件，比如来自服务器的响应(Ajax事件、服务器端事件)</li><li id="ffaa" class="km kn hi jq b jr kx jv ky jz kz kd la kh lb kl kt ku kv kw bi translated">用户事件，如鼠标点击、鼠标移动和按键</li><li id="464c" class="km kn hi jq b jr kx jv ky jz kz kd la kh lb kl kt ku kv kw bi translated">计时器事件，例如当超时过期或时间间隔触发时</li></ul><p id="1b96" class="pw-post-body-paragraph jo jp hi jq b jr ko jt ju jv kp jx jy jz lc kb kc kd ld kf kg kh le kj kk kl hb bi translated">所有生成的事件都按照浏览器检测到它们的顺序放置在事件队列中。该流程可以简单地解释为:</p><ul class=""><li id="2594" class="km kn hi jq b jr ko jv kp jz kq kd kr kh ks kl kt ku kv kw bi translated">浏览器检查事件队列的头部</li><li id="e923" class="km kn hi jq b jr kx jv ky jz kz kd la kh lb kl kt ku kv kw bi translated">如果没有事件，浏览器将继续检查</li><li id="fba5" class="km kn hi jq b jr kx jv ky jz kz kd la kh lb kl kt ku kv kw bi translated">如果有一个事件，浏览器将执行它，在此期间，其他事件将不得不等待轮到他们。因此，请记住事件的处理时间，以防止崩溃或冻结。</li></ul><p id="783f" class="pw-post-body-paragraph jo jp hi jq b jr ko jt ju jv kp jx jy jz lc kb kc kd ld kf kg kh le kj kk kl hb bi translated">这很容易理解，不是吗？但是还有更多的。</p><p id="62d8" class="pw-post-body-paragraph jo jp hi jq b jr ko jt ju jv kp jx jy jz lc kb kc kd ld kf kg kh le kj kk kl hb bi translated">我们知道JavaScript是由<strong class="jq hj">同步</strong>和<strong class="jq hj">异步</strong>事件组合而成的。<strong class="jq hj">同步</strong>是一个接一个，<strong class="jq hj">异步</strong>是回调或者承诺。让我们进入刚才的<strong class="jq hj">同步</strong></p><h2 id="9f9f" class="lf ir hi bd is lg lh li iw lj lk ll ja jz lm ln je kd lo lp ji kh lq lr jm ls bi translated"><strong class="ak">同步事件</strong></h2><p id="e831" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">JavaScript是单线程的，这意味着总有一个线程完成所有的工作。假设你点击按钮A来触发一个函数，JavaScript将执行这个点击的工作，但是如果你点击按钮B，JS会立即放弃正在做的事情来执行这个动作吗？<strong class="jq hj">不</strong>，它把动作推入一个队列，那个队列叫做<strong class="jq hj">任务队列，意思是任务的队列</strong></p><p id="ab20" class="pw-post-body-paragraph jo jp hi jq b jr ko jt ju jv kp jx jy jz lc kb kc kd ld kf kg kh le kj kk kl hb bi translated">这个动作可能是一个简单的函数，但是如果是一个复杂的函数，它会调用其他函数吗？事情是这样的:</p><figure class="lu lv lw lx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lt"><img src="../Images/5fe2bdd8d78c21358afec7b62fd1eb24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c6NIFlcT-zrb5Flg0Z_2ig.png"/></div></div></figure><p id="aff3" class="pw-post-body-paragraph jo jp hi jq b jr ko jt ju jv kp jx jy jz lc kb kc kd ld kf kg kh le kj kk kl hb bi translated">这种情况下的单线程别无选择，只能跟随那个函数调用栈，这种嵌套的函数调用通常使用栈数据结构来管理，它被称为<strong class="jq hj">调用栈</strong></p><h2 id="d8d0" class="lf ir hi bd is lg lh li iw lj lk ll ja jz lm ln je kd lo lp ji kh lq lr jm ls bi translated">异步事件</h2><p id="35ac" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">JavaScript中的异步事件通常伴随着回调。回调意味着传递给另一个函数的函数。当一个异步事件开始执行时，回调没有立即开始，而是被推入，它进入任务队列的末尾。这解释了你现在看到的大多数JavaScript行为</p><h1 id="845e" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">潜得更深</h1><p id="cea7" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">首先，事件循环至少有两个队列，除了保存事件之外，还保存浏览器执行的其他操作，而不是只保存事件的单个事件队列。这些动作被称为<em class="ly">任务</em>并被分为两类:<strong class="jq hj"> <em class="ly">宏任务</em> </strong> <em class="ly"> </em>(或者通常只是称为任务)和<strong class="jq hj"> <em class="ly">微任务</em> </strong>。</p><figure class="lu lv lw lx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lz"><img src="../Images/617b99e1cce36727b215d238f1f04c33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HxXaVvmg7FkBAziIyysZ4Q.png"/></div></div></figure><p id="6fc8" class="pw-post-body-paragraph jo jp hi jq b jr ko jt ju jv kp jx jy jz lc kb kc kd ld kf kg kh le kj kk kl hb bi translated">我就不解释“任务”的事情了，有了上图，你就能明白什么是<strong class="jq hj">宏任务</strong>和什么是<strong class="jq hj">微任务</strong></p><p id="dc6f" class="pw-post-body-paragraph jo jp hi jq b jr ko jt ju jv kp jx jy jz lc kb kc kd ld kf kg kh le kj kk kl hb bi translated">事件循环首先检查宏任务队列，如果有宏任务等待执行，就开始执行。只有在任务被完全处理之后(或者如果队列中没有任务)，事件循环才移动到处理微任务队列。如果队列中有一个任务在等待，事件循环就会接收它并执行它直到完成。这是对队列中的所有微任务执行的。注意处理宏任务和微任务队列的区别:在一次循环迭代中，最多处理一个宏任务(其他的留在队列中等待)，而所有的微任务都被处理。</p><p id="5a65" class="pw-post-body-paragraph jo jp hi jq b jr ko jt ju jv kp jx jy jz lc kb kc kd ld kf kg kh le kj kk kl hb bi translated">当微任务队列最终为空时，事件循环检查是否需要UI呈现更新，如果需要，则重新呈现UI。这将结束事件循环的当前迭代，返回到开始处并再次检查宏任务队列。</p><h1 id="fb5f" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">结论</h1><p id="b6d9" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">在文章的最后，我希望你能理解什么是事件循环，它是如何工作的，理解任务队列，如果你理解宏观和微观任务队列，那就很好了。<br/>我希望这篇文章能帮助你更好地理解JavaScript，提高你的知识！</p><h1 id="2445" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">遗言</h1><p id="3ac8" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">虽然我的内容对每个人都是免费的，但是如果你觉得这篇文章有帮助，<a class="ae ma" href="https://www.buymeacoffee.com/kylele19" rel="noopener ugc nofollow" target="_blank">你可以在这里给我买杯咖啡</a></p></div></div>    
</body>
</html>