<html>
<head>
<title>Raspberry Pi Controlled Laptop Cooling Pad. The Software Story. (Part II.)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">树莓Pi控制的笔记本电脑冷却垫。软件的故事。(第二部分。)</h1>
<blockquote>原文：<a href="https://medium.com/codex/raspberry-pi-controlled-laptop-cooling-pad-the-software-story-part-ii-f8591e74e378?source=collection_archive---------19-----------------------#2021-03-20">https://medium.com/codex/raspberry-pi-controlled-laptop-cooling-pad-the-software-story-part-ii-f8591e74e378?source=collection_archive---------19-----------------------#2021-03-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><h2 id="5da2" class="hg hh hi bd b fp hj hk hl hm hn ho dx hp translated" aria-label="kicker paragraph"><a class="ae ge" href="http://medium.com/codex" rel="noopener">法典</a></h2><div class=""/><figure class="ev ex ip iq ir is er es paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="er es io"><img src="../Images/5a34deb904b519accb72172209ed2d50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MgQQVwvjLIwHD2GX_1w_4Q.jpeg"/></div></div><figcaption class="iz ja et er es jb jc bd b be z dx translated">费多尔对那里发生的事情视而不见，因为实际上没有那么多好处。</figcaption></figure><p id="6ff7" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">好吧，好奇的网民们。在我的<a class="ae kb" rel="noopener" href="/swlh/raspberry-pi-controlled-laptop-cooling-pad-the-hardware-part-part-i-6a665c7bdf98">上一篇文章</a>中，我们探索了如何创造性地重建普通笔记本电脑的内部。现在是时候控制这个生物了。但是在我们开始之前，让我们回顾一下我愿意处理的问题。这些事情是:</p><ul class=""><li id="d505" class="kc kd hi jf b jg jh jk jl jo ke js kf jw kg ka kh ki kj kk bi translated">两个<strong class="jf hs"> DHT22传感器</strong>我想从中读取测量值</li><li id="7736" class="kc kd hi jf b jg kl jk km jo kn js ko jw kp ka kh ki kj kk bi translated">我想要控制的那群PWM风扇</li><li id="3f05" class="kc kd hi jf b jg kl jk km jo kn js ko jw kp ka kh ki kj kk bi translated"><strong class="jf hs">灯</strong>通过RPi的<strong class="jf hs"> PWM </strong>连接，我也想对其进行控制</li></ul><h1 id="a0ea" class="kq kr hi bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">眼睛盯着球——唯一重要的是进球。</h1><p id="eae6" class="pw-post-body-paragraph jd je hi jf b jg lo ji jj jk lp jm jn jo lq jq jr js lr ju jv jw ls jy jz ka hb bi translated">最终目标是使垫子能够自主运转:一旦垫子内部的温度升高，它的冷却器就会开始工作。如果能够切换到手动控制模式，并最终能够对风扇进行一些控制，那也将是非常棒的。更不用说开关灯的能力，以及在自主状态下查看事情进展的能力。就此而言，一些简单的用户界面也是一个理想的选择。</p><h1 id="4f7c" class="kq kr hi bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">建筑。</h1><p id="2b47" class="pw-post-body-paragraph jd je hi jf b jg lo ji jj jk lp jm jn jo lq jq jr js lr ju jv jw ls jy jz ka hb bi translated">一旦目标明确，我们就要想办法了。因为从我想出这个主意到我最终组装好这个东西大约用了一个月的时间，所以我决定让它尽可能简单，只要它能让项目向前发展。你有时可能会忘记自己在做什么，简单的解决方法就在那里。你只需要找到合适的。</p><p id="4256" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">正如已经说过的——UI是一个选项，我从一开始就认为<strong class="jf hs"> <em class="lt"> Flask </em> </strong>是合适的工具。它不能也不应该存储状态。但是我需要存储一些状态。因此，在对globals()进行了一些痛苦的实验后，我强烈地意识到——这不是一个选项。一些存储是非常需要的。于是我想到了<strong class="jf hs"> <em class="lt">雷迪斯</em> </strong>。它将存储我需要的状态和一些设置，以便能够在飞行中改变它们。这也将允许我把我需要进一步阅读的温度测量值，并决定这是否是r̶e̶l̶e̶a̶s̶e̶̶t̶h̶e̶̶k̶r̶a̶k̶e̶n̶启用球迷的正确时间。</p><p id="8372" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">所以要把它分解成几块:</p><ul class=""><li id="ffd6" class="kc kd hi jf b jg jh jk jl jo ke js kf jw kg ka kh ki kj kk bi translated">Flask web app 为控件提供UI和API。</li><li id="46c4" class="kc kd hi jf b jg kl jk km jo kn js ko jw kp ka kh ki kj kk bi translated"><strong class="jf hs"> DHT传感器应用程序</strong>不断读取温度，并写入读取的任何内容。</li><li id="ebf8" class="kc kd hi jf b jg kl jk km jo kn js ko jw kp ka kh ki kj kk bi translated"><strong class="jf hs"> PWM控制应用</strong>读取温度测量值，启用/禁用风扇/灯，并查看任何设置/模式变化。</li></ul><p id="5ed7" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">这三个人都在通过<strong class="jf hs"> <em class="lt"> Redis </em> </strong>互相交谈。所以我所需要的就是想出这三个，并进一步使它们变得神秘。到目前为止很简单，不是吗？现在，我不会在这里介绍如何设置Redis之类的东西——这从来都不是这篇文章的目的，尽管我已经完全准备好介绍这个项目的一些简洁的方面。因此，如果有人试图DYI类似的东西，这将是有益的。当然，我会提供所有的链接和资源，而我一直在精心制作它。当然还有带代码的回购。</p><h1 id="0d23" class="kq kr hi bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">组件。</h1><p id="e7cf" class="pw-post-body-paragraph jd je hi jf b jg lo ji jj jk lp jm jn jo lq jq jr js lr ju jv jw ls jy jz ka hb bi translated">现在，让我们更深入地了解它们。我更愿意从最重要的一个开始— <strong class="jf hs"> <em class="lt"> Redis </em> </strong>。好吧，最终它们对任务都是至关重要的:没有温度测量——没有自主性，没有PWM控制——浪费测量等等。但是，即使他们都能做自己的事情，除非他们能相互交流，否则一切都毫无意义。所以<strong class="jf hs"> <em class="lt"> Redis </em> </strong>就是了。</p><h2 id="c414" class="lu kr hi bd ks lv lw lx kw ly lz ma la jo mb mc le js md me li jw mf mg lm ho bi translated">雷迪斯。</h2><p id="5fb6" class="pw-post-body-paragraph jd je hi jf b jg lo ji jj jk lp jm jn jo lq jq jr js lr ju jv jw ls jy jz ka hb bi translated">同样，我不想浪费经验丰富的读者的时间设置步骤。我只是简单地按照这个指示去做，它确实对我很有效。对于刚接触Redis的人来说也是如此。</p><p id="cc99" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">假设所有的设置步骤都完成了，让我们来看看我们的客户端。这里没有什么真正复杂的:我需要通过键设置一些值，并通过键获取一些值。值得一提的是<strong class="jf hs"> <em class="lt"> Redis </em> </strong>将值存储为字符串，所以你需要注意这一点。同样的，你也需要注意将要进一步阅读的内容。考虑到这一点，我的客户的要素是:</p><pre class="mh mi mj mk fd ml mm mn mo aw mp bi"><span id="3e7f" class="lu kr hi mm b fi mq mr l ms mt">def _set(self, k, v):<br/>    self._conn.set(k, v)</span><span id="8d8a" class="lu kr hi mm b fi mu mr l ms mt">def _get(self, k):<br/>    return self._conn.get(k)</span><span id="d014" class="lu kr hi mm b fi mu mr l ms mt">def _get_typed_value(self, v, t):<br/>    try:<br/>        return t(v)<br/>    except (TypeError, ValueError):<br/>        return None</span><span id="1358" class="lu kr hi mm b fi mu mr l ms mt">def set_value(self, k, v):<br/>    if type(v) != str:<br/>        v = str(v)<br/>    self._set(k, v)</span></pre><p id="cc54" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">其中<code class="du mv mw mx mm b">_conn</code>本质上是:</p><pre class="mh mi mj mk fd ml mm mn mo aw mp bi"><span id="01a9" class="lu kr hi mm b fi mq mr l ms mt">redis.Redis(host=host, port=port, db=db, charset="utf-8", decode_responses=True)</span></pre><p id="8b5e" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">这四个将<strong class="jf hs"> <em class="lt">得到</em> </strong>它和<strong class="jf hs"> <em class="lt">集</em> </strong>它以适当的方式照顾类型上的需求。剩下的只是我需要检索的不同数据类型的属性:</p><pre class="mh mi mj mk fd ml mm mn mo aw mp bi"><span id="49af" class="lu kr hi mm b fi mq mr l ms mt">import settings</span><span id="3451" class="lu kr hi mm b fi mu mr l ms mt">...</span><span id="8d17" class="lu kr hi mm b fi mu mr l ms mt">@property<br/>def current_ctrl_mode(self):<br/>    return self._get(settings.CURR_CTRL_MODE)</span><span id="2010" class="lu kr hi mm b fi mu mr l ms mt">@property<br/>def current_pwm_duty(self):<br/>    return self._get_typed_value(self._get(settings.CURR_PWM_DUTY), int)</span><span id="6177" class="lu kr hi mm b fi mu mr l ms mt">@property<br/>def current_t1_temperature(self):<br/>   return self._get_typed_value(self._get(settings.CURR_T1_TEMP), float)</span><span id="a340" class="lu kr hi mm b fi mu mr l ms mt">...</span></pre><p id="943f" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">您明白了:无论何时属性都默认存储为字符串——没什么大不了的。在检索任何类型时也没有——只需传递类型就可以了。</p><p id="5e9f" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">完整的<strong class="jf hs"> <em class="lt"> Redis </em> </strong>客户端源代码在那里:</p><div class="my mz ez fb na nb"><a href="https://github.com/xxmatyuk/rpi_fans_control/blob/main/redis_client.py" rel="noopener  ugc nofollow" target="_blank"><div class="nc ab dw"><div class="nd ab ne cl cj nf"><h2 class="bd hs fi z dy ng ea eb nh ed ef hr bi translated">xxmatyuk/rpi_fans_control</h2><div class="ni l"><h3 class="bd b fi z dy ng ea eb nh ed ef dx translated">在GitHub上创建一个帐户，为xxmatyuk/rpi_fans_control开发做贡献。</h3></div><div class="nj l"><p class="bd b fp z dy ng ea eb nh ed ef dx translated">github.com</p></div></div><div class="nk l"><div class="nl l nm nn no nk np ix nb"/></div></div></a></div><h2 id="094a" class="lu kr hi bd ks lv lw lx kw ly lz ma la jo mb mc le js md me li jw mf mg lm ho bi translated">DHT传感器应用程序。</h2><p id="d40c" class="pw-post-body-paragraph jd je hi jf b jg lo ji jj jk lp jm jn jo lq jq jr js lr ju jv jw ls jy jz ka hb bi translated"><em class="lt">蟒蛇2.7+ </em>死了。不管你喜不喜欢，事实不在乎你的感受，2.7的死就是事实。所以我在谷歌上搜索的第一个图书馆没有<em class="lt"> python3。X+ </em>实现。幸运的是，还有<a class="ae kb" href="https://github.com/adafruit/Adafruit_Blinka" rel="noopener ugc nofollow" target="_blank">另一个</a>。</p><p id="3455" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">从它的例子来看，您需要做的事情非常清楚:只需初始化一个传感器，向类构造函数提供一个pin号，您将传感器连接到这个pin号，然后只需获取相应的属性值。是啊，它默认为摄氏度，所以对不起，我的非公制朋友。</p><pre class="mh mi mj mk fd ml mm mn mo aw mp bi"><span id="9e64" class="lu kr hi mm b fi mq mr l ms mt">&gt;&gt;&gt;import adafruit_dht<br/>&gt;&gt;&gt;dht = adafruit_dht.DHT22(pin)<br/>&gt;&gt;&gt;dht.temperature<br/>13.12</span></pre><p id="61db" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">不是火箭科学。但是请记住，虽然你是在和真实的物理世界打交道，传感器可能会出问题。放心会的。因此，在这两个步骤中的任何一步，它都可能抛出一个您可能想要处理的异常。在第一步<code class="du mv mw mx mm b">RuntimeError</code>可能会被抛出。这同样适用于第二个..再加上其他的。</p><pre class="mh mi mj mk fd ml mm mn mo aw mp bi"><span id="2a37" class="lu kr hi mm b fi mq mr l ms mt">from logger import logger</span><span id="3c48" class="lu kr hi mm b fi mu mr l ms mt">...</span><span id="9dfe" class="lu kr hi mm b fi mu mr l ms mt">def _get_dht_sensor(pin):<br/>    """Returns DHT sensor instance"""<br/>    d = None<br/>    try:<br/>       d = adafruit_dht.DHT22(pin)<br/>    except RuntimeError as e:<br/>       d.exit()<br/>       d = adafruit_dht.DHT22(pin)<br/>       logger.error(str(e))<br/>    return d</span><span id="20dd" class="lu kr hi mm b fi mu mr l ms mt">def _get_sensor_temperature(pin):<br/>    """Gets tempreature mesure of a given sensor"""<br/>    try:<br/>        d = _get_dht_sensor(pin)<br/>        if d:<br/>            t = d.temperature<br/>            d.exit()<br/>        return t<br/>     except Exception as e:<br/>        logger.error(str(e))<br/>        if d:<br/>            d.exit()</span></pre><p id="4c43" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">两个关键功能。第一个尝试通过pin初始化传感器，第二个尝试读取温度。两者都试图捕捉可能发生的情况并记录错误。最终，这个不确定的循环将试图获取两个传感器的温度，如果足够幸运的话，将它放在一个合适的位置。在投票时间睡觉，然后再睡一遍。</p><pre class="mh mi mj mk fd ml mm mn mo aw mp bi"><span id="1102" class="lu kr hi mm b fi mq mr l ms mt">import settings</span><span id="167f" class="lu kr hi mm b fi mu mr l ms mt">from redis_client import RedisClient</span><span id="d909" class="lu kr hi mm b fi mu mr l ms mt">...</span><span id="d710" class="lu kr hi mm b fi mu mr l ms mt">redis_client = RedisClient()</span><span id="8920" class="lu kr hi mm b fi mu mr l ms mt">...</span><span id="900a" class="lu kr hi mm b fi mu mr l ms mt">def run_sensors_readings():<br/>    while True:<br/>        t1 = _get_sensor_temperature(settings.DHT_PIN_16)<br/>        t2 = _get_sensor_temperature(settings.DHT_PIN_20)<br/>        <br/>        if t1:<br/>            redis_client.set_value(settings.CURR_T1_TEMP, t1)</span><span id="d16d" class="lu kr hi mm b fi mu mr l ms mt">        if t2:<br/>            redis_client.set_value(settings.CURR_T2_TEMP, t2)</span><span id="e5e4" class="lu kr hi mm b fi mu mr l ms mt">        time.sleep(settings.DHT_POLLING_TIMEOUT_SECONDS)</span></pre><p id="a59a" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">完整的源代码可以在那里找到:</p><div class="my mz ez fb na nb"><a href="https://github.com/xxmatyuk/rpi_fans_control/blob/main/dht_sensors.py" rel="noopener  ugc nofollow" target="_blank"><div class="nc ab dw"><div class="nd ab ne cl cj nf"><h2 class="bd hs fi z dy ng ea eb nh ed ef hr bi translated">xxmatyuk/rpi_fans_control</h2><div class="ni l"><h3 class="bd b fi z dy ng ea eb nh ed ef dx translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="nj l"><p class="bd b fp z dy ng ea eb nh ed ef dx translated">github.com</p></div></div><div class="nk l"><div class="nq l nm nn no nk np ix nb"/></div></div></a></div><h2 id="f0c6" class="lu kr hi bd ks lv lw lx kw ly lz ma la jo mb mc le js md me li jw mf mg lm ho bi translated">PWM控制应用。</h2><p id="903e" class="pw-post-body-paragraph jd je hi jf b jg lo ji jj jk lp jm jn jo lq jq jr js lr ju jv jw ls jy jz ka hb bi translated">现在，由于我们有了<strong class="jf hs"> <em class="lt"> Redis </em> </strong>，Redis客户端和DHT应用程序通过客户端将温度测量值写入<strong class="jf hs"> <em class="lt"> Redis </em> </strong>中，我们很有可能最终实现生物自动化。但是，在您自动化任何事情之前，有理由提前了解哪些事情应该在您的控制之下:</p><ul class=""><li id="9a2d" class="kc kd hi jf b jg jh jk jl jo ke js kf jw kg ka kh ki kj kk bi translated">Pad的操作模式:自动或手动。</li><li id="536f" class="kc kd hi jf b jg kl jk km jo kn js ko jw kp ka kh ki kj kk bi translated">灯的状态:开或关。</li><li id="65df" class="kc kd hi jf b jg kl jk km jo kn js ko jw kp ka kh ki kj kk bi translated">更精确的控制取决于操作模式。</li></ul><p id="101c" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">但是在我们开始之前，让我们先了解一些基础知识。不管你想通过RPi的<strong class="jf hs"> PWM </strong>控制什么，流程将保持不变:</p><ul class=""><li id="d1ce" class="kc kd hi jf b jg jh jk jl jo ke js kf jw kg ka kh ki kj kk bi translated">您定义RPi的<strong class="jf hs"> GPIO </strong>引脚的寻址</li><li id="52cb" class="kc kd hi jf b jg kl jk km jo kn js ko jw kp ka kh ki kj kk bi translated">您用模式(输入或输出)和一些首字母(如果需要)设置pin</li><li id="5b79" class="kc kd hi jf b jg kl jk km jo kn js ko jw kp ka kh ki kj kk bi translated">你启动<strong class="jf hs">脉宽调制</strong></li></ul><p id="4fab" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">下面是一个示例，说明我如何通过引脚20触发调制，默认占空比为0%，稍后以75%和50 Hz的频率启动调制:</p><pre class="mh mi mj mk fd ml mm mn mo aw mp bi"><span id="8998" class="lu kr hi mm b fi mq mr l ms mt">&gt;&gt;&gt;import RPi.GPIO as GPIO<br/>&gt;&gt;&gt;pin=20<br/>&gt;&gt;&gt;freq=50<br/>&gt;&gt;&gt;duty_cycle=75<br/>&gt;&gt;&gt;GPIO.setmode(GPIO.BCM)<br/>&gt;&gt;&gt;GPIO.setup(pin, GPIO.OUT, initial=GPIO.LOW)<br/>&gt;&gt;&gt;pwm = GPIO.PWM(pin, freq)<br/>&gt;&gt;&gt;pwm.start(duty_cycle)</span></pre><p id="4cb3" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">本质上，这就是我运行风扇或开灯的方式。</p><p id="1dec" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">现在，回到控制上来。该应用程序的目标是根据特定状态变化的逻辑启用/禁用<strong class="jf hs"> PWM </strong>。可能发生的变化:</p><ul class=""><li id="20ba" class="kc kd hi jf b jg jh jk jl jo ke js kf jw kg ka kh ki kj kk bi translated">两个DHT22传感器的平均温度</li><li id="39d7" class="kc kd hi jf b jg kl jk km jo kn js ko jw kp ka kh ki kj kk bi translated">控制模式设置(自动或手动)</li><li id="fd34" class="kc kd hi jf b jg kl jk km jo kn js ko jw kp ka kh ki kj kk bi translated">风扇的占空比设置</li><li id="afd5" class="kc kd hi jf b jg kl jk km jo kn js ko jw kp ka kh ki kj kk bi translated">温度阈值设置</li><li id="eb9e" class="kc kd hi jf b jg kl jk km jo kn js ko jw kp ka kh ki kj kk bi translated">灯光状态设置</li></ul><p id="74ff" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">同样的概念也适用于无限循环。在每次迭代的开始，我们会从<strong class="jf hs"><em class="lt"/></strong>中得到所有必要的值。然后，我们将努力记住上面的任何状态是否已经改变，如果是，我们将采取相应的行动。</p><p id="e9f0" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">每个受控方面都有两个变量:当前值和新值。在每次迭代中，我们都会比较这些值，如果它们不相等，就意味着状态已经改变。因此，从外部改变状态实质上意味着设置新的值，该值将再次与当前值进行比较。</p><p id="9fba" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">让我们直接看代码。在运行无限循环之前，我们需要做一些初始化:</p><pre class="mh mi mj mk fd ml mm mn mo aw mp bi"><span id="8e54" class="lu kr hi mm b fi mq mr l ms mt"># GPIO initials<br/>GPIO.setmode(GPIO.BCM)<br/>GPIO.setwarnings(False)</span><span id="857d" class="lu kr hi mm b fi mu mr l ms mt"># Redis client wrapper<br/>redis_client = RedisClient()</span><span id="1455" class="lu kr hi mm b fi mu mr l ms mt"># Globals<br/>fans = None<br/>lights = None</span></pre><p id="6bf7" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">然后，在这个循环中，我们阅读我们感兴趣的所有内容，例如:</p><pre class="mh mi mj mk fd ml mm mn mo aw mp bi"><span id="b5b5" class="lu kr hi mm b fi mq mr l ms mt"># Get all values</span><span id="7682" class="lu kr hi mm b fi mu mr l ms mt">pwm_enabled = redis_client.pwm_enabled<br/>new_pwm_enabled = redis_client.new_pwm_enabled<br/>lights_enabled = redis_client.lights_enabled<br/>new_lights_enabled = redis_client.new_lights_enabled<br/>curr_ctrl_mode = redis_client.current_ctrl_mode<br/>new_ctrl_mode = redis_client.new_ctrl_mode<br/>curr_pwm_duty = redis_client.current_pwm_duty<br/>new_pwm_duty = redis_client.new_pwm_duty<br/>curr_t1_temp = redis_client.current_t1_temperature<br/>curr_t2_temp = redis_client.current_t2_temperature<br/>curr_temp_threshold = redis_client.current_temperature_threshold<br/>new_temp_threshold = redis_client.new_temperature_threshold</span></pre><p id="81cf" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">例如，灯光控制部件将如下所示:</p><pre class="mh mi mj mk fd ml mm mn mo aw mp bi"><span id="5d2d" class="lu kr hi mm b fi mq mr l ms mt"># Lights state has changed</span><span id="0767" class="lu kr hi mm b fi mu mr l ms mt">if lights_enabled != new_lights_enabled:<br/>    redis_client.set_value(settings.LIGHTS_ENABLED, new_lights_enabled)<br/>    if new_lights_enabled == False:<br/>        if lights:<br/>            lights.start(0)<br/>    else:<br/>        GPIO.setmode(GPIO.BCM)<br/>        GPIO.setup(settings.LIGHTS_PIN, GPIO.OUT, initial=GPIO.LOW)<br/>        if not lights:<br/>            lights = GPIO.PWM(settings.LIGHTS_PIN, settings.LIGHT_DEFAULT_FREQ)<br/>        lights.start(settings.LIGHTS_PWM_DEFAULT)<br/>    continue</span></pre><p id="628d" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">这里发生的事情如下:假设状态已经改变，首先我们设置新的值在下一个迭代周期不走相同的路线，然后，根据改变，我们或者关灯或者开灯。</p><p id="077e" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">一个细心的人可能会问，如果我在最开始的时候就设置了GPIO,那我为什么还要重新设置呢？好吧，答案听起来没那么工程化:你最好做就是了。有时<strong class="jf hs"> GPIO </strong>行为不当，因此init在这里。出于同样的原因，我一开始就禁用了警告。</p><pre class="mh mi mj mk fd ml mm mn mo aw mp bi"><span id="7d53" class="lu kr hi mm b fi mq mr l ms mt"># PWM state has changed</span><span id="79a7" class="lu kr hi mm b fi mu mr l ms mt">if pwm_enabled != new_pwm_enabled:<br/>    redis_client.set_value(settings.PWM_ENABLED, new_pwm_enabled)<br/>    if new_pwm_enabled == False:<br/>        if fans:<br/>            fans.stop()<br/>        GPIO.cleanup()<br/>        fans = None<br/>    else:<br/>        GPIO.setmode(GPIO.BCM)<br/>        GPIO.setup(settings.FANS_PIN, GPIO.OUT, initial=GPIO.LOW)<br/>        try:<br/>            fans = GPIO.PWM(settings.FANS_PIN, settings.PWM_DEFAULT_FREQ)<br/>        except RuntimeError as e:<br/>            logger.error(str(e))<br/>        fans.start(settings.PWM_DEFAULT_DUTY)<br/>    continue</span></pre><p id="2f93" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">与上面的几乎相同:状态已经改变，设置新的值，然后记住新的状态，要么停止风扇并调用<strong class="jf hs"> GPIO </strong>清理，要么进行设置并启动风扇。还有同样的安全措施appleid。也请注意尝试——除了在粉丝中:它对我来说失败了几次，我觉得非常讨厌。尽管在调试过程中，下一个调用会工作得很好。所以只需记录错误并进行下一次调用。</p><p id="bd3c" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">我将跳过接下来的三个检查，因为它们对故事不太感兴趣，您可以在完整的代码示例中找到它们。唯一有趣的是，如果pwm状态变为False，即禁用，则无需进行任何进一步的检查，这就是为什么它会在检查手动模式的新占空比之前放置，或者最终执行自动部分。说到这里:</p><pre class="mh mi mj mk fd ml mm mn mo aw mp bi"><span id="3595" class="lu kr hi mm b fi mq mr l ms mt"># Auto mode</span><span id="ca0e" class="lu kr hi mm b fi mu mr l ms mt">if curr_ctrl_mode == settings.AUTO_MODE and curr_t1_temp and curr_t2_temp:<br/>    avg_temp = (curr_t1_temp + curr_t2_temp)/2<br/>    if fans:<br/>        if avg_temp &gt; curr_temp_threshold + 2:<br/>            fans.ChangeDutyCycle(100)<br/>            redis_client.set_value(settings.CURR_PWM_DUTY, 100)<br/>    elif avg_temp &gt; curr_temp_threshold+1:<br/>        duty = settings.PWM_DEFAULT_DUTY + 5<br/>        fans.ChangeDutyCycle(duty)<br/>        redis_client.set_value(settings.CURR_PWM_DUTY, duty)<br/>    elif avg_temp &gt; curr_temp_threshold:<br/>        fans.ChangeDutyCycle(settings.PWM_DEFAULT_DUTY)<br/>        redis_client.set_value(settings.CURR_PWM_DUTY, settings.PWM_DEFAULT_DUTY)<br/>    else:<br/>        fans.ChangeDutyCycle(0)<br/>        redis_client.set_value(settings.CURR_PWM_DUTY, 0)<br/>    continue</span></pre><p id="e78a" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">主要的和丑陋的。但是这个意大利面条完成了它的任务。首先是它的工作方式，其次是为什么。如何通过检查我们是否运行正确的模式并从两个DHT22传感器获得两个测量值来解决。如果我们足够幸运，我们要么完全停止风扇，要么根据平均温度，设置相应的占空比值。我可能想出了一些更有智慧的东西，但我们已经到了为什么的问题。</p><p id="1657" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">在我开始自动化任何东西之前，我进行了几轮实验。首先，弄清楚这一切是否值得，意思是它是否真的变凉了。即使没有，我也不会告诉你，但它确实发生了。然后我找到了最低的<strong class="jf hs"> PWM </strong>占空比值，低于这个值甚至打扰风扇都没有意义。然后，我检查了它如何在不同的设置下冷却，以得出算法方法。你需要明白，平均温度仍然在某种程度上接近真实温度。当笔记本电脑运行像在docker容器中模拟宇宙诞生这样的繁重任务时，它还会从室温加1-1.5度变化到38度以上。顺便说一下，都是摄氏温度。因此，即使这是一个有点丑陋的解决方案，它符合所有的项目目标，所以我不在乎。顺其自然吧。</p><pre class="mh mi mj mk fd ml mm mn mo aw mp bi"><span id="ebec" class="lu kr hi mm b fi mq mr l ms mt"># Do a clean-up</span><span id="e34a" class="lu kr hi mm b fi mu mr l ms mt">atexit.register(_stop_pwm_control)</span><span id="a61c" class="lu kr hi mm b fi mu mr l ms mt">if __name__ == "__main__":<br/>    try:<br/>        run_pwm_controls()<br/>    except Exception as e:<br/>        logger.exception(str(e))<br/>        sys.exit(1)</span></pre><p id="134a" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">这里唯一整洁的时刻是我定义了(查看完整代码)如果某些东西完全脱离了轨道，我在退出时调用的清理函数。</p><p id="c0f8" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">完整的源代码可以在那里找到:</p><div class="my mz ez fb na nb"><a href="https://github.com/xxmatyuk/rpi_fans_control/blob/main/pwm_controls.py" rel="noopener  ugc nofollow" target="_blank"><div class="nc ab dw"><div class="nd ab ne cl cj nf"><h2 class="bd hs fi z dy ng ea eb nh ed ef hr bi translated">xxmatyuk/rpi_fans_control</h2><div class="ni l"><h3 class="bd b fi z dy ng ea eb nh ed ef dx translated">在GitHub上创建一个帐户，为xxmatyuk/rpi_fans_control开发做贡献。</h3></div><div class="nj l"><p class="bd b fp z dy ng ea eb nh ed ef dx translated">github.com</p></div></div><div class="nk l"><div class="nr l nm nn no nk np ix nb"/></div></div></a></div><h2 id="325b" class="lu kr hi bd ks lv lw lx kw ly lz ma la jo mb mc le js md me li jw mf mg lm ho bi translated">Web应用程序。</h2><p id="47c9" class="pw-post-body-paragraph jd je hi jf b jg lo ji jj jk lp jm jn jo lq jq jr js lr ju jv jw ls jy jz ka hb bi translated">如果没有API和一些UI来查看在自我控制下发生了什么，那将是一个遗憾。因为它只是一堆端点加上一个单屏页面，<strong class="jf hs"> <em class="lt">烧瓶</em> </strong>工作得非常好。互联网上有一大堆信息，几乎所有方面都有例子或文档，甚至两者都有。所以我不想在这里花太多时间。只是一些美好的瞬间。我会在故事的底部去掉所有有用的链接。</p><pre class="mh mi mj mk fd ml mm mn mo aw mp bi"><span id="70aa" class="lu kr hi mm b fi mq mr l ms mt">def _set_and_wait(k, v):</span><span id="8553" class="lu kr hi mm b fi mu mr l ms mt">"""Sets the given value provided by key and wait until it"s set or failed."""<br/>    try:<br/>        redis_client.set_value(k, v)<br/>        start = datetime.now()<br/>        delta = 0<br/>        while delta &lt; app.config["SET_AND_WAIT_TIMEOUT"]:<br/>            time.sleep(app.config["POLLING_INTERVAL"])<br/>            if getattr(redis_client, k) == v:<br/>                return True<br/>            delta = (datetime.now() - start).seconds<br/>    except Exception as e:<br/>        logger.error(str(e))</span></pre><p id="93a5" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">这确保了值是真正设置好的，否则我们就彻底搞砸了。我们稍后将在UI中用到它。</p><p id="386d" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">例如，我们的照明路线及其逻辑:</p><pre class="mh mi mj mk fd ml mm mn mo aw mp bi"><span id="6108" class="lu kr hi mm b fi mq mr l ms mt">@app.route("/lights/on", methods=["POST"])<br/>def lights_on():<br/>    """Turns light on"""</span><span id="cb72" class="lu kr hi mm b fi mu mr l ms mt">    if not redis_client.lights_enabled:<br/>        if not _set_and_wait(app.config["NEW_LIGHTS_ENABLED"], True):<br/>        return _get_error_response(app.config.get("UNABLE_TO_SET_PROP_MSG").format(app.config["NEW_LIGHTS_ENABLED"]))</span><span id="cf36" class="lu kr hi mm b fi mu mr l ms mt">    return _get_response(app.config["LIGHTS_ON_MSG"])</span><span id="2461" class="lu kr hi mm b fi mu mr l ms mt">return _get_response(app.config["NO_ACTION_MSG"])</span></pre><p id="16ab" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">这里，只有在没有采取任何行动或者成功设置了新值的情况下，我们才返回成功响应。如果由于某种原因我们失败了，抛出一个错误响应。这同样适用于我们的其他API端点:</p><ul class=""><li id="c89e" class="kc kd hi jf b jg jh jk jl jo ke js kf jw kg ka kh ki kj kk bi translated">/get-平均温度</li><li id="bd61" class="kc kd hi jf b jg kl jk km jo kn js ko jw kp ka kh ki kj kk bi translated">/pwm/enable/ <mode/></li><li id="fb77" class="kc kd hi jf b jg kl jk km jo kn js ko jw kp ka kh ki kj kk bi translated">/PWM/禁用</li><li id="bcea" class="kc kd hi jf b jg kl jk km jo kn js ko jw kp ka kh ki kj kk bi translated">/PWM/设置温度阈值/ <threshold/></li><li id="9a9b" class="kc kd hi jf b jg kl jk km jo kn js ko jw kp ka kh ki kj kk bi translated">/pwm/set-duty/ <percent/></li><li id="5241" class="kc kd hi jf b jg kl jk km jo kn js ko jw kp ka kh ki kj kk bi translated">/PWM/停止-风扇</li><li id="881e" class="kc kd hi jf b jg kl jk km jo kn js ko jw kp ka kh ki kj kk bi translated">/灯/开着</li><li id="bde3" class="kc kd hi jf b jg kl jk km jo kn js ko jw kp ka kh ki kj kk bi translated">/灯/关</li><li id="c644" class="kc kd hi jf b jg kl jk km jo kn js ko jw kp ka kh ki kj kk bi translated">/stats</li></ul><p id="8c25" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">UI非常简单，建立在bootstrap和一些普通的js之上，通过API发送请求。这里我们的设置和等待逻辑也在起作用:只有当值真正被设置时，页面才被重新加载以显示正确的按钮颜色。</p><figure class="mh mi mj mk fd is er es paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="er es ns"><img src="../Images/404f2fc8256ee76b669497eb3120fce9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qv-JO7n_Wb1MMew7L3-1jA.png"/></div></div><figcaption class="iz ja et er es jb jc bd b be z dx translated">一页纸。</figcaption></figure><p id="4539" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">为了说明按钮的颜色逻辑和启用用户界面:</p><figure class="mh mi mj mk fd is er es paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="er es nt"><img src="../Images/b8a276fb2da762cf09cb0ad4c2ccdc21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lAdI8R7MR_tSraXAthwC8A.png"/></div></div><figcaption class="iz ja et er es jb jc bd b be z dx translated">启用自动模式。</figcaption></figure><p id="6cd8" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">完整的源代码可以在那里找到:</p><div class="my mz ez fb na nb"><a href="https://github.com/xxmatyuk/rpi_fans_control/blob/main/pi_fan_app.py" rel="noopener  ugc nofollow" target="_blank"><div class="nc ab dw"><div class="nd ab ne cl cj nf"><h2 class="bd hs fi z dy ng ea eb nh ed ef hr bi translated">xxmatyuk/rpi_fans_control</h2><div class="ni l"><h3 class="bd b fi z dy ng ea eb nh ed ef dx translated">在GitHub上创建一个帐户，为xxmatyuk/rpi_fans_control开发做贡献。</h3></div><div class="nj l"><p class="bd b fp z dy ng ea eb nh ed ef dx translated">github.com</p></div></div><div class="nk l"><div class="nu l nm nn no nk np ix nb"/></div></div></a></div></div><div class="ab cl nv nw gp nx" role="separator"><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa"/></div><div class="hb hc hd he hf"><p id="c2c4" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">不确定你是否达到了阅读的这个阶段:长阅读的标准在过去几年里已经发生了巨大的变化，平均的注意力持续时间也是如此。我想指出:你和大多数人不一样，如果你还和我在一起，所以谢谢你！是时候把它完全放下了。</p><h1 id="e345" class="kq kr hi bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">放在一起。</h1><figure class="mh mi mj mk fd is er es paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="er es oc"><img src="../Images/e7781d75e1beb594dff58a8ea1c7c2d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*39Pe_uXBuxocrsoLZFgvDA.png"/></div></div><figcaption class="iz ja et er es jb jc bd b be z dx translated">守护进程正在做他们邪恶的工作。所有的错误都被处理了。</figcaption></figure><p id="4fae" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">现在我们已经准备好了所有的关键组件，让我们在守护进程中一个接一个地运行它们。在我们开始之前，从python的角度来说，显然这个项目有一些要求。我将它们全部收集在众所周知的python需求文件中，创建了虚拟环境，然后安装了所有的库。完整的清单并不令人印象深刻，但我们已经尽力保持简约:</p><pre class="mh mi mj mk fd ml mm mn mo aw mp bi"><span id="14c2" class="lu kr hi mm b fi mq mr l ms mt">uwsgi<br/>flask<br/>redis<br/>adafruit-circuitpython-dht<br/>pystemd<br/>systemd</span></pre><h2 id="7301" class="lu kr hi bd ks lv lw lx kw ly lz ma la jo mb mc le js md me li jw mf mg lm ho bi translated">DHT传感器服务。</h2><pre class="mh mi mj mk fd ml mm mn mo aw mp bi"><span id="fc90" class="lu kr hi mm b fi mq mr l ms mt">[Unit]<br/>Description=Service to read DHT22 sensors measurements<br/>After=network.target</span><span id="002a" class="lu kr hi mm b fi mu mr l ms mt">[Service]<br/>User=pi<br/>Group=pi<br/>WorkingDirectory=&lt;CODE_PATH&gt;<br/>Environment="PATH=&lt;VENV_PATH&gt;/bin"<br/>ExecStart=&lt;CODE_PATH&gt;/dht_sensors.py<br/>Restart=on-abort</span><span id="7834" class="lu kr hi mm b fi mu mr l ms mt">[Install]<br/>WantedBy=multi-user.target</span></pre><h2 id="ce14" class="lu kr hi bd ks lv lw lx kw ly lz ma la jo mb mc le js md me li jw mf mg lm ho bi translated">PWM控制服务。</h2><pre class="mh mi mj mk fd ml mm mn mo aw mp bi"><span id="bfd0" class="lu kr hi mm b fi mq mr l ms mt">[Unit]<br/>Description=Service control PWM via RPi GPIO<br/>After=network.target</span><span id="fb0c" class="lu kr hi mm b fi mu mr l ms mt">[Service]<br/>User=pi<br/>Group=pi<br/>WorkingDirectory=&lt;CODE_PATH&gt;<br/>Environment="PATH=&lt;VENV_PATH&gt;/bin"<br/>ExecStart=&lt;VENV_PATH&gt;/bin/python &lt;CODE_PATH&gt;/pwm_controls.py<br/>Restart=on-abort</span><span id="8855" class="lu kr hi mm b fi mu mr l ms mt">[Install]<br/>WantedBy=multi-user.target</span></pre><h2 id="cc3a" class="lu kr hi bd ks lv lw lx kw ly lz ma la jo mb mc le js md me li jw mf mg lm ho bi translated">Web应用服务。</h2><pre class="mh mi mj mk fd ml mm mn mo aw mp bi"><span id="619f" class="lu kr hi mm b fi mq mr l ms mt">[Unit]<br/>Description=uWSGI instance to serve pi_fan_app<br/>After=network.target</span><span id="0bb7" class="lu kr hi mm b fi mu mr l ms mt">[Service]<br/>User=pi<br/>Group=www-data<br/>WorkingDirectory=&lt;CODE_PATH&gt;<br/>Environment="PATH=&lt;VENV_PATH&gt;/bin"<br/>ExecStart=&lt;VENV_PATH&gt;/bin/uwsgi --ini pi_fan_app.ini</span><span id="a2e1" class="lu kr hi mm b fi mu mr l ms mt">[Install]<br/>WantedBy=multi-user.target</span></pre><p id="ccfa" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">一切都很简单，但我觉得后者需要详细说明。如上所述，我会附上我使用的链接，所以不会浪费太多时间在安装解释。</p><p id="65d8" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">我们在uwsgi上用Nginx运行我们的web应用程序，因此两者都需要设置:</p><pre class="mh mi mj mk fd ml mm mn mo aw mp bi"><span id="4b91" class="lu kr hi mm b fi mq mr l ms mt">[uwsgi]</span><span id="6207" class="lu kr hi mm b fi mu mr l ms mt">module = wsgi:app</span><span id="edf3" class="lu kr hi mm b fi mu mr l ms mt">master = true<br/>processes = 2</span><span id="ba98" class="lu kr hi mm b fi mu mr l ms mt">socket = pi_fan.sock<br/>chmod-socket = 660<br/>vacuum = true</span><span id="75c6" class="lu kr hi mm b fi mu mr l ms mt">die-on-term = true<br/>enable-threads = true</span></pre><p id="dc5d" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">你需要知道的是，它将创建一个套接字，这个套接字将在<strong class="jf hs"> <em class="lt"> Nginx </em> </strong>设置中进一步使用:</p><pre class="mh mi mj mk fd ml mm mn mo aw mp bi"><span id="6320" class="lu kr hi mm b fi mq mr l ms mt">server {<br/>    listen 8080;<br/>    server_name fancy.pod.server.name;</span><span id="9df2" class="lu kr hi mm b fi mu mr l ms mt">location / {<br/>        include uwsgi_params;<br/>        uwsgi_pass unix:&lt;CODE_PATH&gt;/pi_fan.sock;<br/>    }<br/>}</span></pre><p id="09db" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">这样，我会将所有传入的请求路由到:8080到我漂亮的小网络应用程序。所有相应的安装文件都在repo中，所以可以随意查看。</p><div class="my mz ez fb na nb"><a href="https://github.com/xxmatyuk/rpi_fans_control/tree/main/services" rel="noopener  ugc nofollow" target="_blank"><div class="nc ab dw"><div class="nd ab ne cl cj nf"><h2 class="bd hs fi z dy ng ea eb nh ed ef hr bi translated">xxmatyuk/rpi_fans_control</h2><div class="ni l"><h3 class="bd b fi z dy ng ea eb nh ed ef dx translated">在GitHub上创建一个帐户，为xxmatyuk/rpi_fans_control开发做贡献。</h3></div><div class="nj l"><p class="bd b fp z dy ng ea eb nh ed ef dx translated">github.com</p></div></div><div class="nk l"><div class="od l nm nn no nk np ix nb"/></div></div></a></div><h1 id="3335" class="kq kr hi bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">Outro。</h1><p id="5a2e" class="pw-post-body-paragraph jd je hi jf b jg lo ji jj jk lp jm jn jo lq jq jr js lr ju jv jw ls jy jz ka hb bi translated">所以，我们都做得很好！你的是阅读，我的是做所有的休息，我们在这里弥补！酪酪有人可能会问:<em class="lt">“伙计，一份试卷都没写。你没测试过吧？”。</em>那是痛苦而合法的。当然，我测试过，但100%是手动的。因此，在下一部分中，我将讨论如何用测试覆盖它，如何(不可避免地)根据测试进行重构，以及如何设置本地预提交挂钩或如何设置自己的管道。或者两者都有。敬请期待，感谢您的关注！</p><h1 id="af3a" class="kq kr hi bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">使用了非常有用的链接:</h1><ol class=""><li id="1e25" class="kc kd hi jf b jg lo jk lp jo oe js of jw og ka oh ki kj kk bi translated"><a class="ae kb" href="https://www.digitalocean.com/community/tutorials/how-to-serve-flask-applications-with-uswgi-and-nginx-on-ubuntu-18-04" rel="noopener ugc nofollow" target="_blank">https://www . digital ocean . com/community/tutorials/how-to-serve-flask-applications-with-uswgi-and-nginx-on-Ubuntu-18-04</a></li><li id="6f7b" class="kc kd hi jf b jg kl jk km jo kn js ko jw kp ka oh ki kj kk bi translated"><a class="ae kb" href="http://raspi.tv/2013/rpi-gpio-0-5-2a-now-has-software-pwm-how-to-use-it" rel="noopener ugc nofollow" target="_blank">http://raspi . TV/2013/rpi-gpio-0-5-2a-now-has-software-PWM-how-to-use-it</a></li><li id="1bdb" class="kc kd hi jf b jg kl jk km jo kn js ko jw kp ka oh ki kj kk bi translated"><a class="ae kb" href="https://www.instructables.com/PWM-Regulated-Fan-Based-on-CPU-Temperature-for-Ras/" rel="noopener ugc nofollow" target="_blank">https://www . instructables . com/PWM-Regulated-Fan-Based-on-CPU-Temperature-for-Ras/</a></li><li id="602e" class="kc kd hi jf b jg kl jk km jo kn js ko jw kp ka oh ki kj kk bi translated"><a class="ae kb" href="https://trstringer.com/systemd-logging-in-python/" rel="noopener ugc nofollow" target="_blank">https://trstringer.com/systemd-logging-in-python/</a></li><li id="4ec3" class="kc kd hi jf b jg kl jk km jo kn js ko jw kp ka oh ki kj kk bi translated">https://pypi.org/project/pystemd/<a class="ae kb" href="https://pypi.org/project/pystemd/" rel="noopener ugc nofollow" target="_blank"/></li><li id="bf9b" class="kc kd hi jf b jg kl jk km jo kn js ko jw kp ka oh ki kj kk bi translated">【https://flask.palletsprojects.com/en/1.1.x/ T4】</li><li id="8e70" class="kc kd hi jf b jg kl jk km jo kn js ko jw kp ka oh ki kj kk bi translated"><a class="ae kb" href="https://realpython.com/python-redis/" rel="noopener ugc nofollow" target="_blank">https://realpython.com/python-redis/</a></li><li id="5eec" class="kc kd hi jf b jg kl jk km jo kn js ko jw kp ka oh ki kj kk bi translated"><a class="ae kb" href="https://learn.adafruit.com/dht-humidity-sensing-on-raspberry-pi-with-gdocs-logging/python-setup" rel="noopener ugc nofollow" target="_blank">https://learn . ada fruit . com/DHT-moisture-sensing-on-raspberry-pi-with-gdocs-logging/python-setup</a></li></ol></div></div>    
</body>
</html>