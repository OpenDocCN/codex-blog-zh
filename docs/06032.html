<html>
<head>
<title>Cloud Compute to Cloud Database Connectivity in Oracle Cloud Infrastructure</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Oracle云基础架构中云计算到云数据库的连接</h1>
<blockquote>原文：<a href="https://medium.com/codex/cloud-compute-to-cloud-database-connectivity-in-oracle-cloud-infrastructure-77f58562a2b3?source=collection_archive---------27-----------------------#2022-04-06">https://medium.com/codex/cloud-compute-to-cloud-database-connectivity-in-oracle-cloud-infrastructure-77f58562a2b3?source=collection_archive---------27-----------------------#2022-04-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="e34f" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">填补我努力寻找的缺失部分。</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/d71b6997a3d8f4eecd8406168a51ac8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*i6-LbMQPlH79STfV"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">鲁道夫·夸德罗斯在<a class="ae jn" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</figcaption></figure><p id="a322" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在我职业生涯的大部分时间里，我习惯于连接本地数据库。慢慢地，当我的职业生涯进入云阶段时，连接到云数据库也不是一件难事。但是，突然之间，我不得不将一个云虚拟机连接到一个云数据库，并且我总是失败。</p><p id="9c15" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">几天后，想到这个麻烦让我笑了，是的，当然是带着自怜。:).但最终这被证明是很好的学习。</p><h1 id="cb51" class="kk kl hi bd km kn ko kp kq kr ks kt ku io kv ip kw ir kx is ky iu kz iv la lb bi translated"><strong class="ak">挑战</strong></h1><p id="042e" class="pw-post-body-paragraph jo jp hi jq b jr lc ij jt ju ld im jw jx le jz ka kb lf kd ke kf lg kh ki kj hb bi translated">我的要求是使用Oracle Cloud VM作为只运行shell脚本或python的访问网关，并且应该连接到Oracle Cloud中的自治事务数据库。虽然这听起来很简单，但是完成起来很麻烦，无论是文档还是博客都会提到大部分细节，但会遗漏一些，最终你会迷失方向。<br/>因此，真正的挑战是找到该遵循哪一条。</p><h1 id="0d08" class="kk kl hi bd km kn ko kp kq kr ks kt ku io kv ip kw ir kx is ky iu kz iv la lb bi translated">设置基础</h1><p id="893f" class="pw-post-body-paragraph jo jp hi jq b jr lc ij jt ju ld im jw jx le jz ka kb lf kd ke kf lg kh ki kj hb bi translated">设置VM和ATP数据库非常简单，并且有很好的文档记录。您可以设置对虚拟机的SSH访问。您必须为ATP生成例程wallet。下载钱包，因为我们稍后会需要它。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lh"><img src="../Images/00590dad9e131747f4c4d690e786f7ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z1q0znRfnL6TJKVnm8ZAhQ.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">下载钱包</figcaption></figure><p id="aec9" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">mTLS wallet是一个打包了多个文件的zip文件。这些文件可用于通过各种客户端建立与特定数据库的连接，例如SQL*Plus、Python、JDBC等。由于我使用的是SQL*Plus，我主要对包中的两个文件感兴趣——sqlnet . ora和tnsnames.ora。您可以使用本地SQL Developer中的wallet检查您的数据库连接是否一切正常。检查步骤<a class="ae jn" href="https://docs.oracle.com/en/cloud/paas/autonomous-data-warehouse-cloud/cswgs/autonomous-connect-sql-developer.html" rel="noopener ugc nofollow" target="_blank">此处</a>。</p><h1 id="afe1" class="kk kl hi bd km kn ko kp kq kr ks kt ku io kv ip kw ir kx is ky iu kz iv la lb bi translated"><strong class="ak">在虚拟机中设置Oracle即时客户端和SQL * Plus</strong></h1><p id="cee5" class="pw-post-body-paragraph jo jp hi jq b jr lc ij jt ju ld im jw jx le jz ka kb lf kd ke kf lg kh ki kj hb bi translated">如前所述，我的目标是从Oracle计算实例连接到ATP数据库。我们需要在Linux虚拟机中设置Oracle客户端和SQL*Plus。<br/>这里详细介绍了<a class="ae jn" href="https://www.geeksforgeeks.org/how-to-install-sqlplus-on-linux/" rel="noopener ugc nofollow" target="_blank">的步骤。但是最后还需要一些额外的步骤。</a></p><p id="f59a" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">步骤1: </strong>使用以下命令下载<strong class="jq hj"> </strong>基础包(ZIP):</p><pre class="iy iz ja jb fd li lj lk ll aw lm bi"><span id="29c9" class="ln kl hi lj b fi lo lp l lq lr">wget <a class="ae jn" href="https://download.oracle.com/otn_software/linux/instantclient/214000/instantclient-basic-linux.x64-21.4.0.0.0dbru.zip" rel="noopener ugc nofollow" target="_blank">https://download.oracle.com/otn_software/linux/instantclient/214000/instantclient-basic-linux.x64-21.4.0.0.0dbru.zip</a></span></pre><p id="270e" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">步骤2: </strong>使用以下命令下载SQL*Plus包(ZIP):</p><pre class="iy iz ja jb fd li lj lk ll aw lm bi"><span id="ed16" class="ln kl hi lj b fi lo lp l lq lr">wget https://download.oracle.com/otn_software/linux/instantclient/214000/instantclient-sqlplus-linux.x64-21.4.0.0.0dbru.zip</span></pre><p id="5096" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">第三步:</strong>为即时客户端新建一个目录。</p><pre class="iy iz ja jb fd li lj lk ll aw lm bi"><span id="dd9d" class="ln kl hi lj b fi lo lp l lq lr">sudo mkdir -p /opt/oracle</span></pre><p id="9e4c" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">第四步:</strong>在新创建的目录下解压基础包。</p><pre class="iy iz ja jb fd li lj lk ll aw lm bi"><span id="eb8b" class="ln kl hi lj b fi lo lp l lq lr"><em class="ls">sudo unzip -d /opt/oracle instantclient-basic-linux.x64-21.4.0.0.0dbru.zip</em></span></pre><p id="4e65" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">第五步:</strong>在新创建的目录下解压SQL *Plus包。</p><pre class="iy iz ja jb fd li lj lk ll aw lm bi"><span id="eda4" class="ln kl hi lj b fi lo lp l lq lr">sudo unzip -d /opt/oracle instantclient-sqlplus-linux.x64–21.4.0.0.0dbru.zip</span></pre><p id="a14b" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">第七步:</strong>在你的~/中设置LD_LIBRARY_PATH。bashrc源文件。<br/>在vi中打开文件，并将这些行添加到文件的末尾</p><pre class="iy iz ja jb fd li lj lk ll aw lm bi"><span id="4d5c" class="ln kl hi lj b fi lo lp l lq lr">export LD_LIBRARY_PATH=/opt/oracle/instantclient_21_4:$LD_LIBRARY_PATH</span></pre><p id="ba2c" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">第8步:</strong>在你的~/中设置ORACLE_HOME变量。bashrc</p><pre class="iy iz ja jb fd li lj lk ll aw lm bi"><span id="efdf" class="ln kl hi lj b fi lo lp l lq lr">export ORACLE_HOME=/opt/oracle/instantclient_21_4</span></pre><p id="c951" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">第九步:</strong>在你的~/中设置ORACLE_HOME。bashrc</p><pre class="iy iz ja jb fd li lj lk ll aw lm bi"><span id="c06a" class="ln kl hi lj b fi lo lp l lq lr">export ORACLE_HOME=/opt/oracle/instantclient_21_4</span></pre><p id="838c" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">第十步:</strong>在你的~/中设置路径env vars。bashrc</p><pre class="iy iz ja jb fd li lj lk ll aw lm bi"><span id="7ba0" class="ln kl hi lj b fi lo lp l lq lr">export PATH=$ORACLE_HOME:$LD_LIBRARY_PATH:$PATH</span></pre><p id="15a1" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">步骤11: </strong>运行sqlplus -V命令，确认是否安装。</p><pre class="iy iz ja jb fd li lj lk ll aw lm bi"><span id="be79" class="ln kl hi lj b fi lo lp l lq lr">sqlplus -V</span></pre><p id="40ec" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">步骤11应该不会给你任何错误。</p><p id="7895" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">但是我们还没有完成。我们现在需要使用我们之前下载的mTLS wallet来连接数据库。</p><h1 id="ff7e" class="kk kl hi bd km kn ko kp kq kr ks kt ku io kv ip kw ir kx is ky iu kz iv la lb bi translated"><strong class="ak">使用钱包(mTLS)连接数据库</strong></h1><p id="fc0e" class="pw-post-body-paragraph jo jp hi jq b jr lc ij jt ju ld im jw jx le jz ka kb lf kd ke kf lg kh ki kj hb bi translated">我发现<a class="lt lu ge" href="https://medium.com/u/4ac8c86cd8df?source=post_page-----77f58562a2b3--------------------------------" rel="noopener" target="_blank">卢卡斯·杰利马</a>的<a class="ae jn" href="https://technology.amis.nl/oracle-cloud/connecting-sqlplus-in-cloud-shell-to-an-autonomous-database/" rel="noopener ugc nofollow" target="_blank">博客</a>在这里很有帮助。他解释了如何将云shell连接到云数据库实例。对我来说，这种情况有点不同，我需要在计算实例中做同样的事情。</p><p id="19f3" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">步骤1: </strong>将wallet zip文件上传到计算实例:<br/> <em class="ls">由于我已经将我的ssh公钥上传到了VM，所以我能够使用SCP命令来完成这项工作。</em></p><pre class="iy iz ja jb fd li lj lk ll aw lm bi"><span id="5fb6" class="ln kl hi lj b fi lo lp l lq lr">scp ~/Downloads/Wallet_labd.zip opc@&lt;VM Public IP Address&gt;:</span></pre><p id="f647" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">第二步:</strong>创建一个目录<em class="ls"> db </em>，将zip文件的内容解压到这个目录中:</p><pre class="iy iz ja jb fd li lj lk ll aw lm bi"><span id="0601" class="ln kl hi lj b fi lo lp l lq lr">unzip wallet.zip -d db</span></pre><p id="7d58" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">步骤3: </strong>在vi编辑器中打开sqlnet.ora，并将目录设置为指向当前目录，该目录包含tnsnames.ora文件。保存sqlnet.ora文件。</p><pre class="iy iz ja jb fd li lj lk ll aw lm bi"><span id="4888" class="ln kl hi lj b fi lo lp l lq lr">WALLET_LOCATION = (SOURCE = (METHOD = file) (METHOD_DATA = (DIRECTORY="/home/opc/db")))<br/>SSL_SERVER_DN_MATCH=yes</span></pre><p id="dff4" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">第四步:</strong>在你的~/中设置TNS_ADMIN变量。bashrc</p><pre class="iy iz ja jb fd li lj lk ll aw lm bi"><span id="aded" class="ln kl hi lj b fi lo lp l lq lr">export TNS_ADMIN=/home/opc/db</span></pre><p id="6a58" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">第五步:</strong>源你的~/。bashrc文件</p><pre class="iy iz ja jb fd li lj lk ll aw lm bi"><span id="0ba0" class="ln kl hi lj b fi lo lp l lq lr">source ~/.bashrc</span></pre><p id="944e" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">步骤6: </strong>从SQL*Plus测试您的数据库连接</p><pre class="iy iz ja jb fd li lj lk ll aw lm bi"><span id="ea58" class="ln kl hi lj b fi lo lp l lq lr">sqlplus admin@&lt;TNS Name&gt;</span></pre><h1 id="ab61" class="kk kl hi bd km kn ko kp kq kr ks kt ku io kv ip kw ir kx is ky iu kz iv la lb bi translated">关键要点</h1><p id="a0f0" class="pw-post-body-paragraph jo jp hi jq b jr lc ij jt ju ld im jw jx le jz ka kb lf kd ke kf lg kh ki kj hb bi translated">关键在于设置3个环境变量，即。LD_LIBRARY_PATH，ORACLE_HOME，TNS_ADMIN。</p><ul class=""><li id="615f" class="lv lw hi jq b jr js ju jv jx lx kb ly kf lz kj ma mb mc md bi translated"><strong class="jq hj"> LD_LIBRARY_PATH: </strong>用来告诉动态链接加载器，一个启动你所有应用的小程序，决定在哪里寻找一个应用所链接的动态共享库。冒号(:)分隔目录列表，甚至在内置搜索路径和常规位置(如(/lib，/usr/lib)之前检查该列表..).</li><li id="a9d4" class="lv lw hi jq b jr me ju mf jx mg kb mh kf mi kj ma mb mc md bi translated"><strong class="jq hj"> ORACLE_HOME </strong>环境变量指向安装ORACLE数据库客户端软件的目录。</li><li id="b9aa" class="lv lw hi jq b jr me ju mf jx mg kb mh kf mi kj ma mb mc md bi translated"><strong class="jq hj"> TNS_ADMIN </strong>是一个环境变量，它指向SQL*Net配置文件所在的目录(如sqlnet。ora和tnsnames。ora)的位置。</li></ul></div></div>    
</body>
</html>