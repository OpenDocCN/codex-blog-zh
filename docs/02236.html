<html>
<head>
<title>Building a Slack Bot using Node.js (part 1)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Node.js构建Slack Bot(第1部分)</h1>
<blockquote>原文：<a href="https://medium.com/codex/building-a-slack-bot-using-node-js-part-1-7b3e7d54e9b6?source=collection_archive---------1-----------------------#2021-07-09">https://medium.com/codex/building-a-slack-bot-using-node-js-part-1-7b3e7d54e9b6?source=collection_archive---------1-----------------------#2021-07-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/51aa636911afe0a95f30cca17105fa92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f0N98KOm2wpTCNxzRHXkUA.jpeg"/></div></div></figure><p id="f107" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我最近使用Node.js、Express、PostgreSQL和Sequelize构建了一个slack bot。我花了很多时间来学习使用这些技术和玩slack api。学习使用所有这些技术的过程是乏味的(尽管是有教育意义的)，所以我决定写这一系列的博客文章，这样你就可以开始运行，同时避免花时间研究。</p><p id="9da8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要构建一个slack bot，您需要以下东西:</p><ol class=""><li id="08bf" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn jt ju jv jw bi translated"><a class="ae jx" href="https://docs.npmjs.com/downloading-and-installing-node-js-and-npm" rel="noopener ugc nofollow" target="_blank">安装在计算机上的节点和NPM</a>。</li><li id="6b0b" class="jo jp hi is b it jy ix jz jb ka jf kb jj kc jn jt ju jv jw bi translated">安装在您的计算机上的ngrok(这允许您将发生在您的slack工作空间上的事件转发到本地主机服务器进行开发)</li><li id="aad3" class="jo jp hi is b it jy ix jz jb ka jf kb jj kc jn jt ju jv jw bi translated">(可选)在您的计算机上安装PostgreSQL(实际上，我们要到第2部分才会谈到这一点)。</li></ol><p id="f340" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">好吧！我们开始吧！</p><p id="f3fa" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">本指南的前几个步骤将介绍如何设置初始文件结构和依赖关系。如果您不在乎，只想让自己开始运行，只需派生并克隆<a class="ae jx" href="https://github.com/andy-aguilar/Slackbot-Boilerplate" rel="noopener ugc nofollow" target="_blank">这个GitHub repo </a>并跳过步骤1-4。</p><p id="0182" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您想从头开始构建项目，请按照下列步骤操作:</p><h2 id="1836" class="kd ke hi bd kf kg kh ki kj kk kl km kn jb ko kp kq jf kr ks kt jj ku kv kw kx bi translated">步骤0:检查您的授权</h2><p id="940d" class="pw-post-body-paragraph iq ir hi is b it ky iv iw ix kz iz ja jb la jd je jf lb jh ji jj lc jl jm jn hb bi translated">首先确保您有权在工作空间中创建应用程序。转到<a class="ae jx" href="https://api.slack.com/apps/" rel="noopener ugc nofollow" target="_blank">此链接</a>，点击<code class="du ld le lf lg b">Create New App.</code>点击<code class="du ld le lf lg b">from scratch</code>选项，将会打开一个模式，其中包含您的应用名称输入和选择工作区下拉列表。点击<code class="du ld le lf lg b">Select a Workspace</code>,确保在列表中看到你想要添加应用的工作区。如果您没有看到它，请向您的工作区管理员请求访问权限，或者创建一个新的工作区，您可以在其中构建/测试bot(将bot从一个工作区移动到另一个工作区很容易)。</p><p id="a129" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">给你的应用起一个名字，选择工作区，点击<code class="du ld le lf lg b">Create App.</code>保持这个标签打开或者加书签(我们在第6步需要它)。</p><h2 id="974a" class="kd ke hi bd kf kg kh ki kj kk kl km kn jb ko kp kq jf kr ks kt jj ku kv kw kx bi translated">步骤1:创建项目文件夹</h2><p id="1879" class="pw-post-body-paragraph iq ir hi is b it ky iv iw ix kz iz ja jb la jd je jf lb jh ji jj lc jl jm jn hb bi translated">打开你的终端，导航到你想要保存这个项目的文件夹，使用<code class="du ld le lf lg b">mkdir</code>为这个项目创建一个新文件夹。打开您在首选代码编辑器中创建的文件夹。然后运行<code class="du ld le lf lg b">npm init</code>来初始化一个npm项目。这个命令将允许您设置这个项目的属性，包括它的名称、版本、描述等。您可以将这些值设置为您想要的任何值，但是我喜欢将入口点设置为app.js(默认为index.js)。您随时可以在以后更改这些值。</p><h2 id="5de4" class="kd ke hi bd kf kg kh ki kj kk kl km kn jb ko kp kq jf kr ks kt jj ku kv kw kx bi translated">步骤2:创建一些文件</h2><p id="db03" class="pw-post-body-paragraph iq ir hi is b it ky iv iw ix kz iz ja jb la jd je jf lb jh ji jj lc jl jm jn hb bi translated">创建以下文件:</p><pre class="lh li lj lk fd ll lg lm ln aw lo bi"><span id="0ef6" class="kd ke hi lg b fi lp lq l lr ls">app.js<br/>.env<br/>.gitignore<br/>README.md</span></pre><p id="49c4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">打开。gitignore文件并添加以下代码(以及这个项目中您不想添加到github的任何内容):</p><pre class="lh li lj lk fd ll lg lm ln aw lo bi"><span id="5ea8" class="kd ke hi lg b fi lp lq l lr ls">/*.env<br/>/node_modules<br/>.DS_Store</span></pre><h2 id="f6a3" class="kd ke hi bd kf kg kh ki kj kk kl km kn jb ko kp kq jf kr ks kt jj ku kv kw kx bi translated">步骤3(可选):为这个项目设置GitHub存储库</h2><p id="80b4" class="pw-post-body-paragraph iq ir hi is b it ky iv iw ix kz iz ja jb la jd je jf lb jh ji jj lc jl jm jn hb bi translated">从终端运行以下命令:</p><pre class="lh li lj lk fd ll lg lm ln aw lo bi"><span id="68ee" class="kd ke hi lg b fi lp lq l lr ls">git init<br/>git add .<br/>git commit -m “First commit”</span></pre><p id="0692" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">前往GitHub.com并登录您的帐户。在屏幕左侧，您应该会看到这个绿色图标:</p><figure class="lh li lj lk fd ij er es paragraph-image"><div class="er es lt"><img src="../Images/539703b13c3d16c6d1152118c0d7b413.png" data-original-src="https://miro.medium.com/v2/resize:fit:750/format:webp/1*1GK5BVKHSublGHHyVxqK6Q.png"/></div></figure><p id="153a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">单击它创建一个新的存储库。给它一个名称和描述，然后在下一个屏幕上单击<code class="du ld le lf lg b">Create Repository.</code>，将代码复制到<code class="du ld le lf lg b">...or push an existing repository from the command line .</code>下，它应该看起来像这样:</p><pre class="lh li lj lk fd ll lg lm ln aw lo bi"><span id="63a6" class="kd ke hi lg b fi lp lq l lr ls">git remote add origin git@github.com:your-github-username/repo-name.git<br/>git branch -M main<br/>git push -u origin main</span></pre><h2 id="a854" class="kd ke hi bd kf kg kh ki kj kk kl km kn jb ko kp kq jf kr ks kt jj ku kv kw kx bi translated">步骤4:设置依赖关系</h2><p id="788d" class="pw-post-body-paragraph iq ir hi is b it ky iv iw ix kz iz ja jb la jd je jf lb jh ji jj lc jl jm jn hb bi translated">从您的终端运行<code class="du ld le lf lg b">npm install.</code>,然后运行以下命令:</p><pre class="lh li lj lk fd ll lg lm ln aw lo bi"><span id="8642" class="kd ke hi lg b fi lp lq l lr ls">npm install express --save<br/>npm install dotenv<br/>npm install @slack/events-api<br/>npm install @slack/web-api<br/>npm install --save-dev nodemon</span></pre><p id="504b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">打开package.json文件，将以下内容添加到<code class="du ld le lf lg b">"scripts"</code>部分:</p><pre class="lh li lj lk fd ll lg lm ln aw lo bi"><span id="c24e" class="kd ke hi lg b fi lp lq l lr ls">"start": "node app.js",<br/>"dev": "nodemon app.js"</span></pre><p id="4834" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这将允许您在运行<code class="du ld le lf lg b">npm start</code>时运行<code class="du ld le lf lg b">app.js</code>，并允许您在运行<code class="du ld le lf lg b">npm run dev</code>时使用nodemon(它会在您将更改保存到项目中的文件时重启服务器)。</p><h2 id="5329" class="kd ke hi bd kf kg kh ki kj kk kl km kn jb ko kp kq jf kr ks kt jj ku kv kw kx bi translated">步骤5:设置你的app.js文件</h2><p id="7663" class="pw-post-body-paragraph iq ir hi is b it ky iv iw ix kz iz ja jb la jd je jf lb jh ji jj lc jl jm jn hb bi translated">打开app.js文件并添加以下代码:</p><pre class="lh li lj lk fd ll lg lm ln aw lo bi"><span id="dfb3" class="kd ke hi lg b fi lp lq l lr ls">require('dotenv').config({path: __dirname + '/.env'})<br/>const express = require("express")<br/>const app = express()<br/>const PORT = process.env.PORT || 3000</span><span id="b5e1" class="kd ke hi lg b fi lu lq l lr ls">//YOUR CODE HERE</span><span id="82ac" class="kd ke hi lg b fi lu lq l lr ls">app.listen(PORT, () =&gt; {<br/>    console.log(`App listening at <a class="ae jx" href="http://localhost:${PORT}`)" rel="noopener ugc nofollow" target="_blank">http://localhost:${PORT}`)</a><br/>})</span></pre><p id="80ca" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这将设置一个运行在localhost:3000上的express服务器(除非您在。env文件，我将在以后的文章中讨论它)。</p><p id="2a70" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要测试一切是否正常，运行<code class="du ld le lf lg b">npm start</code>，您应该会看到类似这样的内容:</p><pre class="lh li lj lk fd ll lg lm ln aw lo bi"><span id="9c0e" class="kd ke hi lg b fi lp lq l lr ls">&gt; your-app-name@your-app-version start<br/>&gt; node app.js</span><span id="c59e" class="kd ke hi lg b fi lu lq l lr ls">App listening at <a class="ae jx" href="http://localhost:3000" rel="noopener ugc nofollow" target="_blank">http://localhost:3000</a></span></pre><p id="24d4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">用ctrl-c关闭服务器，然后运行<code class="du ld le lf lg b">npm run dev</code>，您应该会看到:</p><pre class="lh li lj lk fd ll lg lm ln aw lo bi"><span id="1d28" class="kd ke hi lg b fi lp lq l lr ls">&gt; your-app-name@1.0.0 dev<br/>&gt; nodemon app.js</span><span id="7ba7" class="kd ke hi lg b fi lu lq l lr ls">[nodemon] 2.0.9<br/>[nodemon] to restart at any time, enter `rs`<br/>[nodemon] watching path(s): *.*<br/>[nodemon] watching extensions: js,mjs,json<br/>[nodemon] starting `node app.js`<br/>App listening at <a class="ae jx" href="http://localhost:3000" rel="noopener ugc nofollow" target="_blank">http://localhost:3000</a></span></pre><p id="3f74" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一旦你有这两个工作，让我们把这个东西连接到slack。</p><h2 id="10dd" class="kd ke hi bd kf kg kh ki kj kk kl km kn jb ko kp kq jf kr ks kt jj ku kv kw kx bi translated">第六步:设置你的slack应用程序</h2><p id="61a0" class="pw-post-body-paragraph iq ir hi is b it ky iv iw ix kz iz ja jb la jd je jf lb jh ji jj lc jl jm jn hb bi translated">打开您在步骤0中保存的选项卡/链接。在页面左侧的<code class="du ld le lf lg b">Features</code>菜单下，点击<code class="du ld le lf lg b">OAuth &amp; Permissions.</code>，在这里你可以为你的机器人设置权限。对于添加哪些权限，一个好的规则是检查这些方法，决定您想要使用哪些方法，并点击它们以查看它们需要哪些权限。现在，让我们只添加一个:</p><p id="d73e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在<code class="du ld le lf lg b">Bot Token Scopes</code>下点击<code class="du ld le lf lg b">Add an OAuth Scope</code>并添加<code class="du ld le lf lg b">chat:write.</code>这将允许你的机器人发送消息。点击页面顶部附近的<code class="du ld le lf lg b">Install to Workspace</code>，然后点击<code class="du ld le lf lg b">Allow</code>安装应用程序。</p><h2 id="9009" class="kd ke hi bd kf kg kh ki kj kk kl km kn jb ko kp kq jf kr ks kt jj ku kv kw kx bi translated">步骤7:保存您的令牌和签名机密</h2><p id="3ecc" class="pw-post-body-paragraph iq ir hi is b it ky iv iw ix kz iz ja jb la jd je jf lb jh ji jj lc jl jm jn hb bi translated">在浏览器左侧的<code class="du ld le lf lg b">Settings</code>部分，点击<code class="du ld le lf lg b">Basic Information</code>向下滚动，直到你看到<code class="du ld le lf lg b">Signing Secret</code>点击<code class="du ld le lf lg b">Show</code>显示秘密，然后将其复制到你的剪贴板。</p><p id="a297" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">进入你的项目文件夹，打开<code class="du ld le lf lg b">.env</code>文件。在文件中添加:</p><pre class="lh li lj lk fd ll lg lm ln aw lo bi"><span id="fd29" class="kd ke hi lg b fi lp lq l lr ls">SIGNING_SECRET=paste-your-signing-secret-here</span></pre><p id="1d0b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">再次点击<code class="du ld le lf lg b">OAuth &amp; Permissions</code>并复制<code class="du ld le lf lg b">Bot User Auth Token.</code>保存到您的。环境文件为</p><pre class="lh li lj lk fd ll lg lm ln aw lo bi"><span id="784d" class="kd ke hi lg b fi lp lq l lr ls">BOT_TOKEN=paste-your-OAuth-Bot-Token-Here</span></pre><h2 id="184f" class="kd ke hi bd kf kg kh ki kj kk kl km kn jb ko kp kq jf kr ks kt jj ku kv kw kx bi translated">步骤8:将你的快速应用程序连接到你的Slack应用程序</h2><p id="1f33" class="pw-post-body-paragraph iq ir hi is b it ky iv iw ix kz iz ja jb la jd je jf lb jh ji jj lc jl jm jn hb bi translated">在<code class="du ld le lf lg b">app.js:</code>的<code class="du ld le lf lg b">//YOUR CODE HERE</code>部分添加以下代码</p><pre class="lh li lj lk fd ll lg lm ln aw lo bi"><span id="ed74" class="kd ke hi lg b fi lp lq l lr ls">const token = process.env.BOT_TOKEN<br/>const eventsApi = require('@slack/events-api')<br/>const slackEvents = eventsApi.createEventAdapter(process.env.SIGNING_SECRET)<br/>const { WebClient, LogLevel } = require("@slack/web-api");<br/>const client = new WebClient(token, {<br/>    logLevel: LogLevel.DEBUG<br/>});</span><span id="f4d4" class="kd ke hi lg b fi lu lq l lr ls">app.use('/', slackEvents.expressMiddleware())</span><span id="9ba7" class="kd ke hi lg b fi lu lq l lr ls">slackEvents.on("message", async(event) =&gt; {<br/>    console.log(event)<br/>})</span></pre><p id="ac27" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这里发生了几件事。此代码:</p><pre class="lh li lj lk fd ll lg lm ln aw lo bi"><span id="8193" class="kd ke hi lg b fi lp lq l lr ls">const eventsApi = require('@slack/events-api')<br/>const slackEvents = eventsApi.createEventAdapter(process.env.SIGNING_SECRET)</span><span id="336b" class="kd ke hi lg b fi lu lq l lr ls">***</span><span id="0c9a" class="kd ke hi lg b fi lu lq l lr ls">app.use('/', slackEvents.expressMiddleware())</span><span id="f1ac" class="kd ke hi lg b fi lu lq l lr ls">slackEvents.on("message", async(event) =&gt; {<br/>    console.log(event)<br/>})</span></pre><p id="46f0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">允许我们的应用程序接收它已添加到的频道上出现的消息。目前，该应用程序将简单地记录任何进来的东西。</p><p id="0d11" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这部分:</p><pre class="lh li lj lk fd ll lg lm ln aw lo bi"><span id="67d6" class="kd ke hi lg b fi lp lq l lr ls">const { WebClient, LogLevel } = require("@slack/web-api");<br/>const client = new WebClient(token, {<br/>    logLevel: LogLevel.DEBUG<br/>});</span></pre><p id="3a9e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">将允许我们的应用程序响应部分(或全部)消息。</p><p id="a421" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们启动我们的应用程序！转到您的app.js并运行<code class="du ld le lf lg b">npm run dev.</code>同样，让我们通过从终端运行<code class="du ld le lf lg b">ngrok http 3000</code>在另一个终端窗口中启动一个ngrok服务器。您应该会看到如下所示的响应:</p><pre class="lh li lj lk fd ll lg lm ln aw lo bi"><span id="d667" class="kd ke hi lg b fi lp lq l lr ls">Session Status                online<br/>Session Expires               1 hour, 59 minutes<br/>Version                       2.3.40<br/>Region                        United States (us)<br/>Web Interface                 <a class="ae jx" href="http://127.0.0.1:404" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:404</a><br/>Forwarding                    http://feaf909adcfc.ngrok.io -&gt; <a class="ae jx" href="http://localhost:3" rel="noopener ugc nofollow" target="_blank">http://localhost:3</a><br/>Forwarding                    https://feaf909adcfc.ngrok.io -&gt; http://localhost:</span></pre><p id="66d3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">复制<code class="du ld le lf lg b">https</code>链接(在- &gt;之前)。</p><p id="56c2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在让我们回到slack api网站，点击<code class="du ld le lf lg b">Features</code>部分下的<code class="du ld le lf lg b">Event Subscriptions</code>。翻转开关打开事件订阅，应该会弹出一个标记为<code class="du ld le lf lg b">Request URL</code>的输入字段。将ngrok服务器url粘贴到该字段中。您应该会在字段旁边看到一个<code class="du ld le lf lg b">Verified</code>复选标记。向下滚动到<code class="du ld le lf lg b">Subscribe to bot events,</code>然后点击<code class="du ld le lf lg b">Add Bot User Event,</code>然后添加<code class="du ld le lf lg b">message.channels.</code>现在，点击<code class="du ld le lf lg b">Save Changes.</code>会弹出一个黄色横幅，指示您将应用程序重新安装到工作区。重新安装它，你应该准备好接收信息。</p><p id="e4fd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最后，转到一个slack通道(理想情况下是您为测试而创建的通道)，并将bot添加到该通道中。你可以点击频道名称旁边的下拉菜单，然后点击<code class="du ld le lf lg b">Integrations</code>，再点击<code class="du ld le lf lg b">Add Apps</code>，找到你的应用。在运行node.js应用程序的终端中，您应该会看到如下内容:</p><pre class="lh li lj lk fd ll lg lm ln aw lo bi"><span id="9ef3" class="kd ke hi lg b fi lp lq l lr ls">{<br/>  type: 'message',<br/>  subtype: 'channel_join',<br/>  ts: '***',<br/>  user: '***',<br/>  text: '&lt;@<a class="ae jx" href="http://twitter.com/U02797SMTGB" rel="noopener ugc nofollow" target="_blank">*</a>**&gt; has joined the channel',<br/>  inviter: '***',<br/>  channel: '***',<br/>  event_ts: '***',<br/>  channel_type: 'channel'<br/>}</span></pre><p id="bbf8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">每当有人在该通道中发送消息时，您还应该看到一个新的console.log。</p><h2 id="85b7" class="kd ke hi bd kf kg kh ki kj kk kl km kn jb ko kp kq jf kr ks kt jj ku kv kw kx bi translated">第九步:让你的机器人回复！</h2><p id="150c" class="pw-post-body-paragraph iq ir hi is b it ky iv iw ix kz iz ja jb la jd je jf lb jh ji jj lc jl jm jn hb bi translated">转到您的<code class="du ld le lf lg b">app.js</code>文件并更改此代码:</p><pre class="lh li lj lk fd ll lg lm ln aw lo bi"><span id="0480" class="kd ke hi lg b fi lp lq l lr ls">slackEvents.on("message", async(event) =&gt; {<br/>    console.log(event)<br/>})</span></pre><p id="0e14" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对此:</p><pre class="lh li lj lk fd ll lg lm ln aw lo bi"><span id="34ea" class="kd ke hi lg b fi lp lq l lr ls">slackEvents.on("message", async(event) =&gt; {<br/>    if(!event.subtype &amp;&amp; !event.bot_id)<br/>        client.chat.postMessage({<br/>            token, <br/>            channel: event.channel, <br/>            thread_ts: event.ts, <br/>            text: "Hello World!"<br/>        })<br/>    }<br/>})</span></pre><p id="5ff2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du ld le lf lg b">if(!event.subtype &amp;&amp; !event.bot_id)</code>确保机器人不会对人们加入频道之类的事情做出响应，也不会回复自己(或其他机器人)的消息。<a class="ae jx" href="https://api.slack.com/methods" rel="noopener ugc nofollow" target="_blank">这些文档</a>描述了如何使用<code class="du ld le lf lg b">chat.postMessage</code> api方法。我选择通过传入事件的ts号来回复线程。如果你没有包含一个<code class="du ld le lf lg b">thread_ts</code>属性，那么响应将被简单地发送到通道本身(而不是线程)。在您的slack通道中发送一条消息，您应该会看到类似这样的内容:</p><h2 id="5d0f" class="kd ke hi bd kf kg kh ki kj kk kl km kn jb ko kp kq jf kr ks kt jj ku kv kw kx bi translated">第十步:让它做酷的事情！</h2><p id="2bf7" class="pw-post-body-paragraph iq ir hi is b it ky iv iw ix kz iz ja jb la jd je jf lb jh ji jj lc jl jm jn hb bi translated">在这一点上，你可以用这个应用程序做各种事情。探索此处列出的<a class="ae jx" href="https://api.slack.com/methods" rel="noopener ugc nofollow" target="_blank">方法，感受各种可能性。在第2部分(将于7/14发布)中，我们将讨论如何将数据库连接到这个应用程序。</a></p></div></div>    
</body>
</html>