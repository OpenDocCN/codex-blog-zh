<html>
<head>
<title>Unpredictable Weekend Java</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">不可预知的周末Java</h1>
<blockquote>原文：<a href="https://medium.com/codex/unpredictable-weekend-java-8d184bdb828a?source=collection_archive---------16-----------------------#2021-08-28">https://medium.com/codex/unpredictable-weekend-java-8d184bdb828a?source=collection_archive---------16-----------------------#2021-08-28</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="3a0d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">想象一下，你有一个没有任何参数、自变量和随机性的Java程序。你既没有循环也没有条件。你敢打赌不改变任何东西就改变一个程序的行为是不可能的吗？</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/72197084d7efb7d8e6a2d3f97099a361.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Kg7a-SmXR6v9QFbv"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">乔恩·泰森在<a class="ae jt" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><h1 id="f784" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">问题介绍</h1><p id="3353" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">Java是一个很好的工具，它有很多优化。通常，你并不关心他们。但有时这些优化可能会奇怪地影响您的代码。看一看下面的代码，并尝试回答您将在控制台日志中看到的内容。会是<code class="du kx ky kz la b">true</code>还是<code class="du kx ky kz la b">false</code>？请在下面的评论中写下你的观点，它会帮助我抓住一些统计数据。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lb lc l"/></div></figure><p id="b305" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，我使用了一个<code class="du kx ky kz la b">Integer</code>对象，而不是原语<code class="du kx ky kz la b">int</code>。其次，<code class="du kx ky kz la b">==</code>运营商收购会参照比较对象。不要忘记<a class="ae jt" href="https://www.javatpoint.com/how-to-compare-two-objects-in-java" rel="noopener ugc nofollow" target="_blank">按值比较和按引用比较</a>差异。简单地说，在堆中可能有两个不同的<code class="du kx ky kz la b">Integer</code>类型的对象，它们的值是相同的。通过<code class="du kx ky kz la b">==</code>比较它们将返回<code class="du kx ky kz la b">false</code>。这种比较不考虑对象的值，而只考虑它的引用。任何对象实例都有其唯一的引用。</p><h1 id="7174" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">简单的答案</h1><p id="fec7" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">根据我上面所说的，你可能会猜测代码会输出<code class="du kx ky kz la b">false</code>作为结果。您甚至可以在本地运行代码，并且很可能得到<code class="du kx ky kz la b">false</code>。但重点是有效的简单答案是<strong class="ih hj"> <em class="ld">看情况</em> </strong> <em class="ld">。</em>🙂</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es le"><img src="../Images/2b165490d79cb6788b6bc0ee85b67caa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*YtserC0TX-TjSB-m"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">照片由<a class="ae jt" href="https://unsplash.com/@rhyskentish?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">里斯·肯特什</a>在<a class="ae jt" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><h1 id="331e" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">没有这么简单的答案</h1><p id="da30" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">正如你已经知道的，Java有很多不同的优化。整数缓存就是其中之一。实际上，每当JVM需要实例化一个<code class="du kx ky kz la b">Integer</code>对象时，它都会在缓存范围内查找。如果所需的数字在缓存中，那么JVM使用缓存中的一个整数来优化内存使用。</p><p id="acf0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">默认情况下，Java初始化<code class="du kx ky kz la b">Integer</code>对象的范围从-128到127，包括127。因此，如果您从上面运行一个Java片段而没有任何额外的选项，您将在控制台输出中看到<code class="du kx ky kz la b">false</code>。唯一的纯程序执行命令<code class="du kx ky kz la b">java Example</code>。这是因为数字130超过了默认的缓存大小。JVM必须为变量<code class="du kx ky kz la b">a</code>创建第一个对象实例，为<code class="du kx ky kz la b">b++</code>的输出创建第二个对象实例。</p><p id="ab19" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是您也可以扩展缓存大小。一旦你通过JVM参数扩展它，你可以强迫你的Java应用程序在日志中输入<code class="du kx ky kz la b">true</code>。运行<code class="du kx ky kz la b">java -XX:AutoBoxCacheMax=200 Example</code>就可以了。参数<code class="du kx ky kz la b">-XX:AutoBoxCacheMax=200</code>将缓存扩展到[-128；200]的范围，所以数字130现在命中缓存。而且JVM不需要为了<code class="du kx ky kz la b">b++</code>的结果实例化新的<code class="du kx ky kz la b">Integer</code>对象。它只需要在缓存中找到所需的对象并使用它。这意味着变量<code class="du kx ky kz la b">a</code>和变量<code class="du kx ky kz la b">b</code>将引用堆中的同一个对象。这就是为什么通过<code class="du kx ky kz la b">==</code>比较它们会返回<code class="du kx ky kz la b">true</code>。</p><p id="062a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可以看看下面我的终端截图。您可以通过<a class="ae jt" href="https://gist.github.com/DzianisH/04fc641f5c3193486bd95bf29cee0647#file-example-java" rel="noopener ugc nofollow" target="_blank">此链接</a>下载源代码，并验证您在本地PC上是否有相同的行为。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lf"><img src="../Images/4180545fa2b2b0865d28576e0fd09d72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1010/format:webp/1*8eGPuPwlEClw6bh3NQ2FGg.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">输出的示例</figcaption></figure><h1 id="9a9e" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">摘要</h1><p id="e20b" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">非常有趣的是，由于Java中大量复杂的优化，您可能会面临一种意想不到的行为。在JVM的某个地方更改某个属性可能会影响您的代码流。看起来有时候你可能需要知道很多关于Java如何工作的细节，以确保你的代码像预期的那样工作。</p><p id="3aae" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">希望你喜欢这篇文章。关注我，阅读更多关于Java和软件工程的内容。把你的想法贴在评论里。祝你愉快！</p></div></div>    
</body>
</html>