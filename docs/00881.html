<html>
<head>
<title>How to upload images to Cloudinary using NestJS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用NestJS将图像上传到Cloudinary</h1>
<blockquote>原文：<a href="https://medium.com/codex/how-to-upload-images-to-cloudinary-using-nestjs-9f496460e8d7?source=collection_archive---------3-----------------------#2021-03-23">https://medium.com/codex/how-to-upload-images-to-cloudinary-using-nestjs-9f496460e8d7?source=collection_archive---------3-----------------------#2021-03-23</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/2b29d7b9affdb9c419b88bd14e8550c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gRDtx0RQkgRpZLrcwMR5uw.png"/></div></div></figure><div class=""/><blockquote class="iq ir is"><p id="54ae" class="it iu iv iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在本文中，我将解释如何将Cloudinary包与NestJS定制提供程序一起使用。你可以在文章末尾找到一个例子。</p></blockquote><h1 id="5d40" class="js jt ht bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">项目配置</h1><ol class=""><li id="8b53" class="kq kr ht iw b ix ks jb kt ku kv kw kx ky kz jr la lb lc ld bi translated">首先，用NestJS CLI创建一个项目:</li></ol><pre class="le lf lg lh fd li lj lk ll aw lm bi"><span id="716f" class="ln jt ht lj b fi lo lp l lq lr">nest new nest-cloudinary-example</span></pre><p id="47f7" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je ku jg jh ji kw jk jl jm ky jo jp jq jr hb bi translated">2.然后，使用NestJS CLI生成一个模块、提供者和服务:</p><pre class="le lf lg lh fd li lj lk ll aw lm bi"><span id="d7e3" class="ln jt ht lj b fi lo lp l lq lr">nest generate module cloudinary<br/>nest generate provider cloudinary<br/>nest generate service clodinary</span></pre><p id="ad24" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je ku jg jh ji kw jk jl jm ky jo jp jq jr hb bi translated">3.安装来自npmjs.com的<a class="ae ls" href="https://www.npmjs.com/package/cloudinary" rel="noopener ugc nofollow" target="_blank"> Cloudinary </a>和<a class="ae ls" href="https://www.npmjs.com/package/buffer-to-stream" rel="noopener ugc nofollow" target="_blank"> buffer-to-stream </a>包</p></div><div class="ab cl lt lu gp lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="hb hc hd he hf"><h1 id="951a" class="js jt ht bd ju jv ma jx jy jz mb kb kc kd mc kf kg kh md kj kk kl me kn ko kp bi translated">代码实现</h1><p id="186c" class="pw-post-body-paragraph it iu ht iw b ix ks iz ja jb kt jd je ku mf jh ji kw mg jl jm ky mh jp jq jr hb bi translated">4.在cloudinary文件夹中创建一个名为<code class="du mi mj mk lj b">constants.ts</code> <em class="iv">，</em>的文件，这个文件包含一个名为<code class="du mi mj mk lj b">Cloudinary</code>的常量，它被用作提供者注入令牌。</p><figure class="le lf lg lh fd hk"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="5638" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je ku jg jh ji kw jk jl jm ky jo jp jq jr hb bi translated">5.在<code class="du mi mj mk lj b">cloudinary.provider.ts</code> <em class="iv">，</em>中您需要添加这段代码:</p><figure class="le lf lg lh fd hk"><div class="bz dy l di"><div class="ml mm l"/></div></figure><ul class=""><li id="122d" class="kq kr ht iw b ix iy jb jc ku mn kw mo ky mp jr mq lb lc ld bi translated"><code class="du mi mj mk lj b"><strong class="iw hu"><em class="iv">v2</em></strong></code> <em class="iv"> : </em>是从Cloudinary包中导出的名称空间。</li><li id="38c2" class="kq kr ht iw b ix mr jb ms ku mt kw mu ky mv jr mq lb lc ld bi translated"><code class="du mi mj mk lj b"><strong class="iw hu">CLOUDINARY</strong></code>:常量用作我们的提供者注入令牌。</li><li id="960f" class="kq kr ht iw b ix mr jb ms ku mt kw mu ky mv jr mq lb lc ld bi translated"><code class="du mi mj mk lj b"><strong class="iw hu">CloudinaryProvider</strong></code>:动态提供程序，初始化连接到您的cloudinary帐户的配置。</li><li id="e71f" class="kq kr ht iw b ix mr jb ms ku mt kw mu ky mv jr mq lb lc ld bi translated"><code class="du mi mj mk lj b">cloud_name</code>、<code class="du mi mj mk lj b">api_key</code>和<code class="du mi mj mk lj b">api_secret</code>属性来自您的<a class="ae ls" href="https://cloudinary.com/users/login" rel="noopener ugc nofollow" target="_blank"> Cloudinary账户。</a></li></ul><figure class="le lf lg lh fd hk er es paragraph-image"><div class="er es mw"><img src="../Images/d8381c2ab46dbb00114b1d1e5a7b6800.png" data-original-src="https://miro.medium.com/v2/resize:fit:1196/format:webp/1*DK2Tdu1UQrg9rs2bls8LmQ.png"/></div></figure><p id="908d" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je ku jg jh ji kw jk jl jm ky jo jp jq jr hb bi translated">6.接下来，在<code class="du mi mj mk lj b">cloudinary.service.ts</code>中添加以下代码:</p><figure class="le lf lg lh fd hk"><div class="bz dy l di"><div class="ml mm l"/></div></figure><ul class=""><li id="ae33" class="kq kr ht iw b ix iy jb jc ku mn kw mo ky mp jr mq lb lc ld bi translated"><code class="du mi mj mk lj b"><strong class="iw hu"><em class="iv">toStream</em></strong></code> <strong class="iw hu"> <em class="iv"> : </em> </strong>这个函数将从缓冲区到流的包转换成可读的流。</li><li id="f83c" class="kq kr ht iw b ix mr jb ms ku mt kw mu ky mv jr mq lb lc ld bi translated"><code class="du mi mj mk lj b"><strong class="iw hu"><em class="iv">uploadImage</em></strong></code>:该方法使用Cloudinary包中的<code class="du mi mj mk lj b">upload_stream</code>函数，它需要一个回调函数来验证图像是否成功上传，最后，我们将缓冲区转换为可读的流，并通过管道传输到上传函数。</li><li id="650d" class="kq kr ht iw b ix mr jb ms ku mt kw mu ky mv jr mq lb lc ld bi translated">这个方法需要一个Multer文件类型，要了解关于这个包和实现的更多信息，请阅读NestJS官方文档中的章节<a class="ae ls" href="https://docs.nestjs.com/techniques/file-upload" rel="noopener ugc nofollow" target="_blank"> <strong class="iw hu">文件上传</strong> </a>。但是如果你想跳过这个，删除<strong class="iw hu">文件参数的类型。</strong></li><li id="abaf" class="kq kr ht iw b ix mr jb ms ku mt kw mu ky mv jr mq lb lc ld bi translated">此外，如果您对Multer命名空间有问题，只需安装来自npmjs.com的<a class="ae ls" href="https://www.npmjs.com/package/@types/multer" rel="noopener ugc nofollow" target="_blank"> Multer types </a>包</li></ul><p id="5361" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je ku jg jh ji kw jk jl jm ky jo jp jq jr hb bi translated">7.之后，在<code class="du mi mj mk lj b">cloudinary.module.ts</code>中插入以下代码:</p><figure class="le lf lg lh fd hk"><div class="bz dy l di"><div class="ml mm l"/></div></figure></div><div class="ab cl lt lu gp lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="hb hc hd he hf"><h1 id="332f" class="js jt ht bd ju jv ma jx jy jz mb kb kc kd mc kf kg kh md kj kk kl me kn ko kp bi translated">例子</h1><p id="5747" class="pw-post-body-paragraph it iu ht iw b ix ks iz ja jb kt jd je ku mf jh ji kw mg jl jm ky mh jp jq jr hb bi translated">8.最后，您可以在项目的另一部分导入这个模块:</p><figure class="le lf lg lh fd hk"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="1fb2" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je ku jg jh ji kw jk jl jm ky jo jp jq jr hb bi translated">9.这是您使用该服务的方式:</p><figure class="le lf lg lh fd hk"><div class="bz dy l di"><div class="ml mm l"/></div></figure></div><div class="ab cl lt lu gp lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="hb hc hd he hf"><h1 id="2132" class="js jt ht bd ju jv ma jx jy jz mb kb kc kd mc kf kg kh md kj kk kl me kn ko kp bi translated">Github存储库示例</h1><div class="hh hi ez fb hj mx"><a href="https://github.com/saulcalderon/NestJS-Cloudinary" rel="noopener  ugc nofollow" target="_blank"><div class="my ab dw"><div class="mz ab na cl cj nb"><h2 class="bd hu fi z dy nc ea eb nd ed ef hs bi translated">索尔卡德龙/内斯特-克劳德纳里</h2><div class="ne l"><h3 class="bd b fi z dy nc ea eb nd ed ef dx translated">如何使用Cloudinary包将图像上传到此服务的示例。-saulcalderon/NestJS-cloud inary</h3></div><div class="nf l"><p class="bd b fp z dy nc ea eb nd ed ef dx translated">github.com</p></div></div><div class="ng l"><div class="nh l ni nj nk ng nl hp mx"/></div></div></a></div><p id="89ee" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je ku jg jh ji kw jk jl jm ky jo jp jq jr hb bi translated">感谢您的阅读，如果这篇文章有用或无用，请给我反馈。</p></div></div>    
</body>
</html>