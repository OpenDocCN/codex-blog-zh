<html>
<head>
<title>How to Use DiffUtils in RecyclerView in Kotlin</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Kotlin的RecyclerView中使用DiffUtils</h1>
<blockquote>原文：<a href="https://medium.com/codex/how-to-use-diffutils-in-recyclerview-in-kotlin-2b5d1f01abe2?source=collection_archive---------0-----------------------#2022-05-29">https://medium.com/codex/how-to-use-diffutils-in-recyclerview-in-kotlin-2b5d1f01abe2?source=collection_archive---------0-----------------------#2022-05-29</a></blockquote><div><div class="dt gx gy gz ha hb"/><div class="hc hd he hf hg"><div class=""/><figure class="ew ey ih ii ij ik es et paragraph-image"><div role="button" tabindex="0" class="il im di in bf io"><div class="es et ig"><img src="../Images/a23cc8ac3025a9264954a7f819063ecd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BNhlKfWq3nXoG_eCYMaxDA.jpeg"/></div></div></figure><h2 id="7edd" class="ir is hj bd it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo bi translated">你在Android中创过列表吗？🤔</h2><h2 id="f787" class="ir is hj bd it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo bi translated">你用什么做的？🤔</h2><p id="69fb" class="pw-post-body-paragraph jp jq hj jr b js jt ju jv jw jx jy jz jc ka kb kc jg kd ke kf jk kg kh ki kj hc bi translated">ListView或RecyclerView是两种类型的视图。</p><p id="15e4" class="pw-post-body-paragraph jp jq hj jr b js kk ju jv jw kl jy jz jc km kb kc jg kn ke kf jk ko kh ki kj hc bi translated">如果你是一名Android开发者，你肯定在某个时候用过RecyclerView。在本文中，我们将介绍如何使用DiffUtils更新RecyclerView。</p><p id="85d0" class="pw-post-body-paragraph jp jq hj jr b js kk ju jv jw kl jy jz jc km kb kc jg kn ke kf jk ko kh ki kj hc bi translated">之前我们有一篇文章(<a class="ae kp" rel="noopener" href="/@ezatpanah/recyclerview-in-android-with-example-in-depth-guide-94462a6b573b"> Here </a>)是关于使用recyclerview和它有多简单的，现在我想向你展示一个更好的方法来管理你的列表。</p><p id="8e71" class="pw-post-body-paragraph jp jq hj jr b js kk ju jv jw kl jy jz jc km kb kc jg kn ke kf jk ko kh ki kj hc bi translated">大多数时候，我们的列表会完全改变，我们会为RecyclerView Adapter设置一个新列表。为了更新适配器，我们使用notifyDataSetChanged。这个手术很贵。DiffUtil类现在处理这个问题。它做得很好！</p><h2 id="6804" class="ir is hj bd it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo bi translated">什么是困难</h2><p id="06bc" class="pw-post-body-paragraph jp jq hj jr b js jt ju jv jw jx jy jz jc ka kb kc jg kd ke kf jk kg kh ki kj hc bi translated">这个类找出两个列表之间的差异，并提供更新后的列表作为输出。此类用于通知RecyclerView适配器的更新。</p><p id="30e8" class="pw-post-body-paragraph jp jq hj jr b js kk ju jv jw kl jy jz jc km kb kc jg kn ke kf jk ko kh ki kj hc bi translated">我们开始吧👩🏻‍💻</p></div><div class="ab cl kq kr gq ks" role="separator"><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv"/></div><div class="hc hd he hf hg"><h2 id="79ae" class="ir is hj bd it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo bi translated">逐步实施</h2><h2 id="5867" class="ir is hj bd it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo bi translated">步骤1-准备每行的用户界面</h2><p id="d0a9" class="pw-post-body-paragraph jp jq hj jr b js jt ju jv jw jx jy jz jc ka kb kc jg kd ke kf jk kg kh ki kj hc bi translated">在资源布局中为RecyclerView创建一个自定义布局文件，名为item_row.xml。</p><pre class="kx ky kz la fe lb lc ld le aw lf bi"><span id="b771" class="ir is hj lc b fj lg lh l li lj">&lt;?xml version="1.0" encoding="utf-8"?&gt;<br/>&lt;androidx.constraintlayout.widget.ConstraintLayout xmlns:android="http://schemas.android.com/apk/res/android"<br/>    xmlns:app="http://schemas.android.com/apk/res-auto"<br/>    android:layout_width="match_parent"<br/>    android:layout_height="wrap_content"<br/>    android:background="#B3E5FC"<br/>    android:layout_margin="5dp"<br/>    android:padding="5dp"&gt;<br/><br/>    &lt;TextView<br/>        android:id="@+id/tvId"<br/>        android:text="Id"<br/>        android:layout_width="wrap_content"<br/>        android:layout_height="wrap_content"<br/>        app:layout_constraintStart_toStartOf="parent"<br/>        app:layout_constraintTop_toTopOf="parent" /&gt;<br/><br/>    &lt;TextView<br/>        android:id="@+id/tvName"<br/>        android:text="Name"<br/>        android:layout_marginTop="5dp"<br/>        android:layout_width="wrap_content"<br/>        android:layout_height="wrap_content"<br/>        app:layout_constraintStart_toStartOf="parent"<br/>        app:layout_constraintTop_toBottomOf="@id/tvId" /&gt;<br/>&lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;</span></pre><h2 id="8541" class="ir is hj bd it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo bi translated">步骤2 —在活动或片段布局中添加RecyclerView</h2><p id="b87d" class="pw-post-body-paragraph jp jq hj jr b js jt ju jv jw jx jy jz jc ka kb kc jg kd ke kf jk kg kh ki kj hc bi translated">在活动布局<strong class="jr hk"> activity_main.xml </strong>布局文件中添加RecyclerView，并添加以下代码。</p><pre class="kx ky kz la fe lb lc ld le aw lf bi"><span id="0152" class="ir is hj lc b fj lg lh l li lj">&lt;?xml version="1.0" encoding="utf-8"?&gt;<br/>&lt;androidx.constraintlayout.widget.ConstraintLayout xmlns:android="http://schemas.android.com/apk/res/android"<br/>    xmlns:app="http://schemas.android.com/apk/res-auto"<br/>    xmlns:tools="http://schemas.android.com/tools"<br/>    android:layout_width="match_parent"<br/>    android:layout_height="match_parent"<br/>    tools:context=".MainActivity"&gt;<br/><br/>    &lt;androidx.recyclerview.widget.RecyclerView<br/>        android:id="@+id/rvMain"<br/>        android:layout_height="match_parent"<br/>        android:layout_width="match_parent"<br/>        app:layout_constraintTop_toTopOf="parent"<br/>        app:layout_constraintStart_toStartOf="parent"/&gt;<br/><br/>&lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;</span></pre><h2 id="f8ba" class="ir is hj bd it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo bi translated">步骤3-创建数据资源类</h2><p id="bcf9" class="pw-post-body-paragraph jp jq hj jr b js jt ju jv jw jx jy jz jc ka kb kc jg kd ke kf jk kg kh ki kj hc bi translated">样本模型. kt</p><pre class="kx ky kz la fe lb lc ld le aw lf bi"><span id="2a40" class="ir is hj lc b fj lg lh l li lj">class SampleModel(val id:Int,val name : String)</span></pre><h2 id="76a3" class="ir is hj bd it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo bi translated">步骤4-创建适配器类</h2><p id="277e" class="pw-post-body-paragraph jp jq hj jr b js jt ju jv jw jx jy jz jc ka kb kc jg kd ke kf jk kg kh ki kj hc bi translated">为视图项创建视图容器，连接recycle view的数据源，并通过创建recycle view适配器来处理视图逻辑。</p><pre class="kx ky kz la fe lb lc ld le aw lf bi"><span id="2c95" class="ir is hj lc b fj lg lh l li lj">class SampleAdapter  : RecyclerView.Adapter&lt;SampleAdapter.ViewHolder&gt;(){<br/>    private lateinit var binding: ItemRowBinding<br/>    override fun onCreateViewHolder(parent: ViewGroup, viewType: Int): SampleAdapter.ViewHolder {<br/>        binding= ItemRowBinding.inflate(LayoutInflater.from(parent.context),parent,false)<br/>        return ViewHolder()<br/>    }<br/><br/>    override fun onBindViewHolder(holder: SampleAdapter.ViewHolder, position: Int) {<br/>        holder.setData(differ.currentList[position])<br/>        holder.setIsRecyclable(false)<br/>    }<br/><br/>    override fun getItemCount()=differ.currentList.size<br/><br/>    inner class ViewHolder : RecyclerView.ViewHolder(binding.root){<br/>        fun setData(item : SampleModel){<br/>            binding.apply {<br/>                tvId.text=item.id.toString()<br/>                tvName.text = item.name<br/>            }<br/>        }<br/><br/>    }<br/><br/>    private val differCallback = object : DiffUtil.ItemCallback&lt;SampleModel&gt;(){<br/>        override fun areItemsTheSame(oldItem: SampleModel, newItem: SampleModel): Boolean {<br/>            return  oldItem.id == newItem.id<br/>        }<br/><br/>        @SuppressLint("DiffUtilEquals")<br/>        override fun areContentsTheSame(oldItem: SampleModel, newItem: SampleModel): Boolean {<br/>            return oldItem == newItem<br/>        }<br/><br/>    }<br/><br/>    val differ = AsyncListDiffer(this,differCallback)<br/><br/>}</span></pre><h2 id="2c96" class="ir is hj bd it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo bi translated">步骤5 —使用MainActivity.kt</h2><p id="990b" class="pw-post-body-paragraph jp jq hj jr b js jt ju jv jw jx jy jz jc ka kb kc jg kd ke kf jk kg kh ki kj hc bi translated">现在，我们需要的东西都有了。<br/>将适配器连接到RecyclerView。接下来，将RecyclerView附加到MainActivity的适配器类。</p><pre class="kx ky kz la fe lb lc ld le aw lf bi"><span id="af62" class="ir is hj lc b fj lg lh l li lj">class MainActivity : AppCompatActivity() {<br/>    private lateinit var binding: ActivityMainBinding<br/>    private val sampleAdapter by lazy{ SampleAdapter() }<br/><br/>    override fun onCreate(savedInstanceState: Bundle?) {<br/>        super.onCreate(savedInstanceState)<br/>        binding= ActivityMainBinding.inflate(layoutInflater)<br/>        setContentView(binding.root)<br/><br/>        sampleAdapter.differ.submitList(loadData())<br/><br/>        binding.apply {<br/>            rvMain.apply {<br/>                layoutManager=LinearLayoutManager(this@MainActivity)<br/>                adapter=sampleAdapter<br/>            }<br/>        }<br/>    }<br/>    fun loadData() : MutableList&lt;SampleModel&gt;{<br/>        val nameList : MutableList&lt;SampleModel&gt; = mutableListOf()<br/>        nameList.add(SampleModel(1,"Sample 1"))<br/>        nameList.add(SampleModel(2,"Sample 2"))<br/>        nameList.add(SampleModel(3,"Sample 3"))<br/>        nameList.add(SampleModel(4,"Sample 4"))<br/>        nameList.add(SampleModel(5,"Sample 5"))<br/>        nameList.add(SampleModel(6,"Sample 6"))<br/>        nameList.add(SampleModel(7,"Sample 7"))<br/>        nameList.add(SampleModel(8,"Sample 8"))<br/>        nameList.add(SampleModel(9,"Sample 9"))<br/>        nameList.add(SampleModel(10,"Sample 10"))<br/>        nameList.add(SampleModel(11,"Sample 11"))<br/>        nameList.add(SampleModel(12,"Sample 12"))<br/><br/>        return nameList<br/>    }<br/>}</span></pre><p id="504b" class="pw-post-body-paragraph jp jq hj jr b js kk ju jv jw kl jy jz jc km kb kc jg kn ke kf jk ko kh ki kj hc bi translated">搞定了:)</p></div><div class="ab cl kq kr gq ks" role="separator"><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv"/></div><div class="hc hd he hf hg"><p id="1c1c" class="pw-post-body-paragraph jp jq hj jr b js kk ju jv jw kl jy jz jc km kb kc jg kn ke kf jk ko kh ki kj hc bi translated">Github来源:</p><div class="lk ll fa fc lm ln"><a href="https://github.com/ezatpanah/DiffUtils-Youtube" rel="noopener  ugc nofollow" target="_blank"><div class="lo ab dx"><div class="lp ab lq cl cj lr"><h2 class="bd hk fj z dz ls eb ec lt ee eg hi bi translated">GitHub-ezatpanah/DiffUtils-Youtube</h2><div class="lu l"><h3 class="bd b fj z dz ls eb ec lt ee eg dy translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="lv l"><p class="bd b fq z dz ls eb ec lt ee eg dy translated">github.com</p></div></div><div class="lw l"><div class="lx l ly lz ma lw mb ip ln"/></div></div></a></div><p id="4723" class="pw-post-body-paragraph jp jq hj jr b js kk ju jv jw kl jy jz jc km kb kc jg kn ke kf jk ko kh ki kj hc bi translated">另外，你可以在Youtube上查看我关于这篇文章的android视频:</p><figure class="kx ky kz la fe ik"><div class="bz dz l di"><div class="mc md l"/></div></figure><p id="0481" class="pw-post-body-paragraph jp jq hj jr b js kk ju jv jw kl jy jz jc km kb kc jg kn ke kf jk ko kh ki kj hc bi translated">感谢您的阅读和快乐编码！</p><p id="c173" class="pw-post-body-paragraph jp jq hj jr b js kk ju jv jw kl jy jz jc km kb kc jg kn ke kf jk ko kh ki kj hc bi translated"><em class="me">别忘了</em>👏</p></div></div>    
</body>
</html>