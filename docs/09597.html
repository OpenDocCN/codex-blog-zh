<html>
<head>
<title>Zerologon — Netlogon Elevation of Privilege Vulnerability — CVE-2020-1472</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">zero logon-Netlogon特权提升漏洞-CVE-2020-1472</h1>
<blockquote>原文：<a href="https://medium.com/codex/zerologon-netlogon-elevation-of-privilege-vulnerability-cve-2020-1472-3c7631239478?source=collection_archive---------27-----------------------#2022-10-28">https://medium.com/codex/zerologon-netlogon-elevation-of-privilege-vulnerability-cve-2020-1472-3c7631239478?source=collection_archive---------27-----------------------#2022-10-28</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="ca25" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了一个课程项目，我一直在研究这个CVE，它是2020年的<strong class="ih hj">五大漏洞之一。有很多东西我不知道，但学习它们是非常愉快的。我看了大概十篇博文，了解了这次攻击的细节及其组成部分，想用简单的话分享一下我的理解。我们走吧！</strong></p><h1 id="37ce" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated"><strong class="ak"> 1。定义</strong></h1><p id="bf34" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated"><strong class="ih hj"> Netlogon: </strong>域中的用户和其他服务通过名为Netlogon的Windows Server进程进行身份验证。这是一个本地安全机构服务。</p><p id="4d40" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> AES: </strong>用于保护电子数据的对称分组密码。美国政府选择AES来保护机密信息。AES算法可用于加密(加密)和解密(解密)信息。</p><p id="25d1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">MS-NRPC: 微软视窗Netlogon远程协议</p><p id="7020" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> Windows域:</strong>一种计算机网络，其中每个用户帐户、计算机、打印机和其他安全主体都在许多中央计算机集群(称为域控制器)上的中央数据库中注册。</p><p id="d74b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> DS: </strong>目录(域)服务。网络资源名称及其相应网络地址的映射(DNS就是一个例子)。</p><p id="74b7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> AD: </strong>活动目录。windows域网络的目录服务</p><p id="42f7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> DC: </strong>域控制器。也称为“AD DS”，用于Windows域网络的Active Directory域服务</p><p id="030d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> Kerberos: </strong>基于票证的网络认证协议</p><h1 id="b19f" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">2.时间表</h1><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es kg"><img src="../Images/29e85a69a564b20c1ef912b987f60008.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WbsFql_gCFyvahXjfLwh-A.jpeg"/></div></div></figure><h1 id="25e5" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated"><strong class="ak"> 3。漏洞描述和影响</strong></h1><p id="647a" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">该漏洞是由MS-NRPC使用的加密认证方案中的错误引起的，通过该方案，除了别的以外，计算机密码可以被更新。通过利用此漏洞，攻击者可以伪装成任何机器，甚至是域控制器本身，并执行远程过程调用。该漏洞的核心存在于MS-NRPC的ComputeNetlogonCredential调用的不符合标准的实现中，稍后将对此进行解释。Secura的高级安全专家Tom Tervoort首先发现了它。该CVE也称为Zerologon，是Windows Server中的一个严重漏洞，已从微软获得10.0的CVSS评分。它被称为2020年发现的最关键的活动目录漏洞。由于连接到域控制器是成功利用漏洞的唯一先决条件，因此该漏洞尤其严重。</p><h1 id="b67e" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">4.编程缺陷</h1><p id="a9aa" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">Microsoft Windows Netlogon远程协议(MS-NRPC)是Active Directory的核心身份验证组件，为用户和计算机帐户提供身份验证。ComputeNetlogonCredential将一个8字节的质询作为输入，使用AES算法执行加密转换，并输出一个8字节的结果。</p><p id="bf14" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了安全地使用AES，有一个随机初始化向量(IV ),用于使用同一密钥加密的每个明文。但是，ComputeNetlogonCredential函数将IV设置为16个零字节的固定值。这违反了安全使用AES-CFB8的要求:只有当iv是随机的时，它的安全属性才成立。这导致了一个密码缺陷，其中8字节零的加密可能导致零的密文，概率为1/256。通过选择全零的ClientCredential，攻击者有1/256的机会成功验证为任何加入域的计算机。通过模拟域控制器，攻击者可以采取额外的步骤来更改计算机的Active Directory密码，因此，它可以访问DC的所有数据。</p><h1 id="3889" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">5.剥削</h1><p id="228f" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">有很多库可以利用这个漏洞。其中一个是<a class="ae ks" href="https://github.com/dirkjanm/CVE-2020-1472." rel="noopener ugc nofollow" target="_blank">https://github.com/dirkjanm/CVE-2020-1472.</a>步骤非常简单直白，在很多视频中都可以看到；你只需要搜索“CVE-2020-1472利用”！</p><p id="fa24" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">步骤如下:</p><p id="7e2b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">1.使用8个零字节的质询和密文发起暴力攻击，创建与域控制器的不安全Netlogon通道。平均需要256次尝试才能做到这一点。</p><p id="2d40" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.将存储在AD中的DC帐户密码设置为空。由于存储在DC注册表中的密码不变，一些域控制器功能将被破坏。</p><p id="9f43" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3.使用空密码连接到同一个DC并转储额外的哈希。</p><p id="a19f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4.为了避免被发现，请将域控制器密码重置为保存在本地注册表中的原始值。</p><p id="c56f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">5.使用从阶段3转储的散列来执行任何想要的攻击。</p><p id="3f61" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">作为步骤4的结果，将不会有对DC的攻击的任何踪迹。</p><h1 id="ba8e" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">6.勒索软件关系</h1><p id="7124" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">Ryuk是一种勒索软件，因针对大型、面向公众的微软Windows网络系统而臭名昭著。这些报告强调，Ryuk勒索软件(2020年最多产的勒索软件变种之一)背后的攻击者正在将此漏洞纳入他们的武器库。</p><h1 id="382f" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">7.参考</h1><p id="c253" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">维基百科(一个基于wiki技术的多语言的百科全书协作计划ˌ也是一部用不同语言写成的网络百科全书ˌ 其目标及宗旨是为全人类提供自由的百科全书)ˌ开放性的百科全书</p><p id="1051" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Zerologon:通过破坏Netlogon加密技术来危害未经验证的域控制器(CVE-2020–1472)，Tom Tervoort，2020年9月，Secura</p><p id="1985" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Netlogon特权提升漏洞，<a class="ae ks" href="https://msrc.microsoft.com/updateguide/" rel="noopener ugc nofollow" target="_blank">https://msrc.microsoft.com/updateguide/</a>漏洞/CVE-2020–1472</p><p id="270a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">zero logon(CVE-2020–1472):未经认证的权限升级为全域权限，<a class="ae ks" href="https://www.crowdstrike.com/blog/cve-2020-1472-zerologonsecurity-" rel="noopener ugc nofollow" target="_blank">https://www . crowd strike . com/blog/CVE-2020-1472-zero logon-security-</a>咨询</p><p id="33e6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">微软Windows Netlogon远程协议(MS-NRPC)使用不安全的AESCFB8初始化向量，【https://www.kb.cert.org/vuls/id/490028】T4</p><p id="0a04" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">关于开发零logon(CVE-2020–1472)对环境的影响，似乎有一些问题和困惑。这里有一条线索，<a class="ae ks" href="https://threadreaderapp.com/thread/1306280553281449985.html" rel="noopener ugc nofollow" target="_blank">https://threadreaderapp.com/thread/1306280553281449985.html</a></p><p id="e3e4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ZeroLogon利用脚本，<a class="ae ks" href="https://github.com/risksense/zerologon" rel="noopener ugc nofollow" target="_blank">https://github.com/risksense/zerologon</a></p></div></div>    
</body>
</html>