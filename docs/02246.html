<html>
<head>
<title>Creating ViewModel dependencies using Hilt</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Hilt创建视图模型依赖项</h1>
<blockquote>原文：<a href="https://medium.com/codex/creating-viewmodel-dependencies-using-hilt-ff8005488910?source=collection_archive---------11-----------------------#2021-07-09">https://medium.com/codex/creating-viewmodel-dependencies-using-hilt-ff8005488910?source=collection_archive---------11-----------------------#2021-07-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="6170" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在前一篇博客中，我们了解了如何创建网络模块，以及如何使用Hilt注入与网络连接相关的依赖项。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/7e8c191aa9624bbe4f99bfb1be2fcdeb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*40JWF7GgOoz4X0uR"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated"><a class="ae jt" href="https://unsplash.com/@photohunter?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">吉米·张</a>在<a class="ae jt" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><p id="1c6b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可以从这里跳转到以前的博客</p><div class="kb kc ez fb kd ke"><a rel="noopener follow" target="_blank" href="/@priyansh-kedia/using-hilt-in-the-network-module-6ff8c50027d6"><div class="kf ab dw"><div class="kg ab kh cl cj ki"><h2 class="bd hj fi z dy kj ea eb kk ed ef hh bi translated">中等</h2><div class="kl l"><h3 class="bd b fi z dy kj ea eb kk ed ef dx translated">在网络模块中使用Hilt</h3></div></div></div></a></div><div class="kb kc ez fb kd ke"><a rel="noopener follow" target="_blank" href="/@priyansh-kedia/creating-the-network-module-with-hilt-3eefc54b72"><div class="kf ab dw"><div class="kg ab kh cl cj ki"><h2 class="bd hj fi z dy kj ea eb kk ed ef hh bi translated">中等</h2><div class="kl l"><h3 class="bd b fi z dy kj ea eb kk ed ef dx translated">创建网络模块</h3></div></div></div></a></div></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><h2 id="8c08" class="km kn hi bd ko kp kq kr ks kt ku kv kw iq kx ky kz iu la lb lc iy ld le lf lg bi translated">ApiClient接口</h2><pre class="je jf jg jh fd lh li lj lk aw ll bi"><span id="3da9" class="km kn hi li b fi lm ln l lo lp">@JvmSuppressWildcards<br/>interface ApiClient {<br/><br/>    @POST("&lt;Your endpoint here&gt;")<br/>    suspend fun loginUsingCredentials(@Body requestBody: RequestBody): Token<br/><br/>}</span></pre><p id="858d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在上面的代码块中，我们创建了一个简单的接口类和一个从服务器获取身份验证令牌的挂起函数。你可以在这里阅读暂停功能<a class="ae jt" href="https://blog.mindorks.com/suspend-function-in-kotlin-coroutines" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="50a5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，我们将添加一些代码来为我们的视图模型注入依赖项。</p></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><h2 id="ae18" class="km kn hi bd ko kp kq kr ks kt ku kv kw iq kx ky kz iu la lb lc iy ld le lf lg bi translated">VMFactory</h2><p id="3fa6" class="pw-post-body-paragraph if ig hi ih b ii lq ik il im lr io ip iq ls is it iu lt iw ix iy lu ja jb jc hb bi translated">首先，创建一个新类，并将其命名为VMFactory。</p><pre class="je jf jg jh fd lh li lj lk aw ll bi"><span id="2ee1" class="km kn hi li b fi lm ln l lo lp">@Singleton<br/>class VMFactory @Inject constructor(private val viewModels: MutableMap&lt;Class&lt;out ViewModel&gt;, Provider&lt;ViewModel&gt;&gt;) :<br/>    ViewModelProvider.Factory {<br/><br/>    override fun &lt;T : ViewModel&gt; create(modelClass: Class&lt;T&gt;): T = viewModels[modelClass]?.get() as T<br/>}</span></pre><p id="3705" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这只是一个工厂方法，将用于创建我们的ViewModel类的实例。您可以看到这个方法有一个可变的map和Provider作为依赖项。</p><h2 id="983e" class="km kn hi bd ko kp kq kr ks kt ku kv kw iq kx ky kz iu la lb lc iy ld le lf lg bi translated">VMKey</h2><p id="8a51" class="pw-post-body-paragraph if ig hi ih b ii lq ik il im lr io ip iq ls is it iu lt iw ix iy lu ja jb jc hb bi translated">我们现在创建一个VMKey注释。这将是我们唯一一次创建要使用的java文件。</p><pre class="je jf jg jh fd lh li lj lk aw ll bi"><span id="042b" class="km kn hi li b fi lm ln l lo lp">@MapKey<br/>@Documented<br/>@Target({ElementType.<em class="lv">METHOD</em>})<br/>@Retention(RetentionPolicy.<em class="lv">RUNTIME</em>)<br/>public @interface VMKey {<br/>    Class&lt;? extends ViewModel&gt; value();<br/>}</span></pre><p id="891c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在创建新的java文件时，一定要记得选择注释。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lw"><img src="../Images/65388eeb3af8a49aa803b194bfad78f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:848/format:webp/1*_p-OuZ3pmtxztDAwYGjMjw.png"/></div></figure><p id="3d84" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该注释将用于指定可变映射中的键，即<strong class="ih hj"> VMFactory </strong>的依赖项。</p><p id="500e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，我们创建了我们的<strong class="ih hj">虚拟机模块</strong>。</p></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><h2 id="2281" class="km kn hi bd ko kp kq kr ks kt ku kv kw iq kx ky kz iu la lb lc iy ld le lf lg bi translated">虚拟机模块</h2><p id="56d0" class="pw-post-body-paragraph if ig hi ih b ii lq ik il im lr io ip iq ls is it iu lt iw ix iy lu ja jb jc hb bi translated">这个模块将包含我们所有的视图模型，并将它们和它们所需的依赖项一起注入。</p><pre class="je jf jg jh fd lh li lj lk aw ll bi"><span id="716b" class="km kn hi li b fi lm ln l lo lp">@Module<br/>@InstallIn(ApplicationComponent::class)<br/>abstract class VMModule {<br/><br/>    @Binds<br/>    internal abstract fun bindVMFactory(factory: VMFactory): ViewModelProvider.Factory<br/><br/>    @Binds<br/>    @IntoMap<br/>    @VMKey(AuthViewModel::class)<br/>    abstract fun authViewModel(authViewModel: AuthViewModel): ViewModel<br/><br/>}</span></pre><p id="e320" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正如您所看到的，我们在这个模块中添加了我们的VMFactory，因此它可以用于注入视图模型。</p><p id="e5e9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在此之下，我们添加了AuthViewModel，这只是身份验证包的一个ViewModel类。您可以用您的ViewModel类替换它。</p><p id="048c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">维奥拉，我们结束了。这就是使用<strong class="ih hj">句柄</strong>注入网络依赖项所需要做的全部工作。</p></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><p id="fce6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以使用一些代码示例来创建repo和ViewModel类。</p><p id="c858" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">回购类的代码。</strong></p><pre class="je jf jg jh fd lh li lj lk aw ll bi"><span id="1148" class="km kn hi li b fi lm ln l lo lp">class AuthRepo @Inject constructor(private val apiClient: ApiClient) {<br/>// Add code for the repo methods</span><span id="8bc3" class="km kn hi li b fi lx ln l lo lp">}</span></pre><p id="e9eb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">虚拟机类的代码</strong></p><pre class="je jf jg jh fd lh li lj lk aw ll bi"><span id="debd" class="km kn hi li b fi lm ln l lo lp">class AuthViewModel @Inject constructor(private val authRepo: AuthRepo): ViewModel() {</span><span id="19cc" class="km kn hi li b fi lx ln l lo lp">// Add code for Viewmodel methods<br/>} </span></pre><p id="7ef6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，这是我们如何在片段或活动中实例化一个ViewModel类。</p><pre class="je jf jg jh fd lh li lj lk aw ll bi"><span id="00a5" class="km kn hi li b fi lm ln l lo lp">private val authViewModel by viewModels&lt;AuthViewModel&gt; <strong class="li hj">{ </strong>vMFactory <strong class="li hj">}</strong></span></pre><p id="d916" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在上面的代码块中，vMFactory被注入到BaseFragment中，我们是这样做的</p><pre class="je jf jg jh fd lh li lj lk aw ll bi"><span id="60dc" class="km kn hi li b fi lm ln l lo lp">@Inject<br/>lateinit var viewModelFactory: ViewModelFactory</span></pre><p id="1916" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">希尔特负责剩下的。</p></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><p id="5a24" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在前三篇博客中，我们了解了如何使用Hilt注入我们的网络和视图模型依赖项，这让我们可以使用像MVVM这样的定义好的架构获得干净的代码。</p></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><p id="8260" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">参考文献</strong></p><div class="kb kc ez fb kd ke"><a href="https://blog.mindorks.com/android-viewmodels-under-the-hood" rel="noopener  ugc nofollow" target="_blank"><div class="kf ab dw"><div class="kg ab kh cl cj ki"><h2 class="bd hj fi z dy kj ea eb kk ed ef hh bi translated">Android视图模型:引擎盖下</h2><div class="kl l"><h3 class="bd b fi z dy kj ea eb kk ed ef dx translated">在本文中，我们将讨论作为Android架构组件一部分的ViewModel的内部结构…</h3></div><div class="ly l"><p class="bd b fp z dy kj ea eb kk ed ef dx translated">blog.mindorks.com</p></div></div><div class="lz l"><div class="ma l mb mc md lz me jn ke"/></div></div></a></div></div></div>    
</body>
</html>