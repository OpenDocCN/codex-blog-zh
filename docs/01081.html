<html>
<head>
<title>Saving and Loading Transformed Image Tensors in PyTorch</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在PyTorch中保存和加载变换后的图像张量</h1>
<blockquote>原文：<a href="https://medium.com/codex/saving-and-loading-transformed-image-tensors-in-pytorch-f37b4daa9658?source=collection_archive---------1-----------------------#2021-04-03">https://medium.com/codex/saving-and-loading-transformed-image-tensors-in-pytorch-f37b4daa9658?source=collection_archive---------1-----------------------#2021-04-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/fc16b8232b6f558b37d89dcb1aff7263.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3G90f7g9YfnJl0Haif-s5w.png"/></div></div></figure><p id="81a0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我一直在研究一个来自Kaggle的<a class="ae jo" href="https://www.kaggle.com/andrewmvd/covid19-ct-scans" rel="noopener ugc nofollow" target="_blank"> Covid CT数据集</a>，其中包含20个被诊断为新冠肺炎患者的CT扫描，以及专家对肺部和感染的分割。我的目标是使用UNet建立一个细分模型。由于图像较少(只有20个；p)，我必须执行数据扩充，之后，我在训练数据集中有3200个图像和遮罩。在将这些数据传递给数据加载器并训练模型时，运行单个epoch需要1.5小时，而GPU几乎没有被使用。</p><p id="8469" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">经过一番挖掘，我在<a class="ae jo" href="https://www.kaggle.com/c/siim-isic-melanoma-classification/discussion/163481" rel="noopener ugc nofollow" target="_blank"> Kaggle </a>上发现，代码花费了更多的时间来获取图像和调整图像大小，加速的最好方法是首先将图像预处理到合适的大小，然后将它们保存为数据集。作为PyTorch的新手，我无法理解这个过程。现在我终于有了解决方案，我决定与任何面临同样问题的人分享代码。</p><h1 id="e61f" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">执行增强</h1><p id="aaa9" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">我已经创建了一个自定义的火炬数据集，它将应用一些变换，如翻转，扭曲，随机亮度和对比度，并将图像调整为224x224。然后分为训练集和值集。</p><figure class="ks kt ku kv fd ij"><div class="bz dy l di"><div class="kw kx l"/></div></figure><h1 id="42d5" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">保存变换后的张量</h1><p id="2943" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">现在我们需要将转换后的图像张量保存在dataset_train和dataset_val中。我们需要遍历数据集，并在其中使用<code class="du ky kz la lb b">torch.save()</code>。</p><figure class="ks kt ku kv fd ij"><div class="bz dy l di"><div class="kw kx l"/></div></figure><h1 id="c44d" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">编写一个新的数据集来加载转换后的张量</h1><p id="8875" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">我们现在必须创建一个新的自定义torch数据集来加载这些转换后的张量，而不是jpeg图像，并将它们传递给数据加载器。模型训练将在这些张量上进行。</p><figure class="ks kt ku kv fd ij"><div class="bz dy l di"><div class="kw kx l"/></div></figure><h1 id="c46f" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">加载张量进行模型训练</h1><p id="9f5b" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">最后，我们加载这些变换图像的张量，并将它们传递给数据加载器进行模型训练。</p><figure class="ks kt ku kv fd ij"><div class="bz dy l di"><div class="kw kx l"/></div></figure><blockquote class="lc ld le"><p id="e773" class="iq ir lf is b it iu iv iw ix iy iz ja lg jc jd je lh jg jh ji li jk jl jm jn hb bi translated">我参考了<a class="ae jo" href="https://discuss.pytorch.org/t/save-transformed-resized-images-after-dataloader/56464/11" rel="noopener ugc nofollow" target="_blank">这个</a> PyTorch论坛的讨论来找到解决方案。</p></blockquote><p id="435b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我没有在本文中包括必要的包导入，但是我想这些是不言自明的。在使用这种直接上传转换张量的方法时，运行时间已经显著减少到每个时期平均1-2分钟。</p><p id="f24f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">希望这有所帮助！</p></div></div>    
</body>
</html>