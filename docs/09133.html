<html>
<head>
<title>Invoke Lambda function when we upload data into S3 Bucket — Part -1.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">当我们将数据上传到S3桶时调用Lambda函数—第1部分。</h1>
<blockquote>原文：<a href="https://medium.com/codex/invoke-lambda-function-when-we-upload-data-into-s3-bucket-part-1-e1e5a0081ecd?source=collection_archive---------4-----------------------#2022-09-27">https://medium.com/codex/invoke-lambda-function-when-we-upload-data-into-s3-bucket-part-1-e1e5a0081ecd?source=collection_archive---------4-----------------------#2022-09-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="c957" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">S3水桶是AWS平台上最受欢迎和使用最多的服务。</p><p id="1a82" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们已经知道，我们使用S3存储桶来存储CSV文件、Excel文件、数据库文件等数据。</p><p id="4eb5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">每当我们上传和删除任何文件或在S3桶上执行任何操作时，它都会触发并运行AWS Lambda函数。</p><p id="adb2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我提到了下面的框图，它让你明白我在整个场景中会做什么。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/dbbfe6e1bee49c4f2cba2a90c7d20883.png" data-original-src="https://miro.medium.com/v2/resize:fit:1170/format:webp/1*clZhmk28AtYljDllsFpcvw.jpeg"/></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">框图</figcaption></figure><p id="da53" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们在这整个场景中所做的</p><ol class=""><li id="29cf" class="jp jq hi ih b ii ij im in iq jr iu js iy jt jc ju jv jw jx bi translated">我们将创建一个S3存储桶。</li><li id="0caa" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">我们将编写一个示例代码，打印一些数据，如文件上传列表和文件内容。</li><li id="3e8b" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">之后，我们将创建一个事件。</li><li id="2ea1" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">然后我们将在AWS Lambda中运行代码。</li><li id="0641" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">我们将在AWS Cloudwatch中看到输出。</li></ol><p id="e132" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你想创建一个AWS S3桶并通过python代码放入一个文件，你可以访问我以前的文章<a class="ae kd" rel="noopener" href="/codex/aws-s3-with-python-by-shoeb-ahmed-923c1cf47110"> <strong class="ih hj"> AWS S3与Python——Shoeb Ahmed</strong></a></p><p id="9679" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这篇文章中，我将手动创建一个S3桶，它非常简单快捷。</p><p id="c559" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您只需登录AWS控制台，访问S3铲斗服务。</p><p id="e316" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">之后，点击“创建存储桶”。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="er es ke"><img src="../Images/f7d30a57a7d43c6ad387949737738e5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o_00Pp4fsF_bvRXv138x1g.jpeg"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">单击创建存储桶</figcaption></figure><p id="7e61" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我只是简单地给出了桶的名称，但是我更愿意给出位置US East-1，如下所示。之后，单击“创建存储桶”。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="er es kj"><img src="../Images/76ad7c55830a23bbf51978fd7221a641.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2FaA10q8KgkWBza3wrZZGg.jpeg"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">存储桶信息</figcaption></figure><p id="599b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我将上传存储桶中的文件。我们将编写一个脚本来读取文件并打印数据内容。</p><p id="186d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我已经手动上传了CSV文件，以测试我的代码是否可以从S3桶中提取数据。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="er es kk"><img src="../Images/12f091c3ba8f609609ab1f0c6f6cc34e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mgIuOh7zeRWC_H4GKSjXJA.jpeg"/></div></div></figure><p id="8a70" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我将编写一个脚本来收集文件列表并打印文件内容，对于这个场景，我更喜欢使用CSV文件。这对于初学者来说很容易，如果你想提取另一种文件格式或下载另一种格式的文件，我会帮助你，你可以在我的LinkedIn帐户上ping我。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="kl km l"/></div></figure><p id="d1a1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">执行上面的代码后，我们可以看到下面的输出，可以看到桶的列表和文件的内容。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="er es kn"><img src="../Images/6de559f5b69ffd7fcf649254dc47b90d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PJjZRVqyB7ADcvof_Chx9A.jpeg"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">代码的输出</figcaption></figure><p id="0676" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在输出图像的右侧，我们可以看到箭头，这是我们正在使用的存储桶，左侧是CSV文件的输出。</p><p id="b189" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们将深入研究AWS Lambda。</p><p id="044b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在使用AWS Lambda之前，我们需要设置我们的层，其中包含运行代码及其功能所需的包。</p><ol class=""><li id="4329" class="jp jq hi ih b ii ij im in iq jr iu js iy jt jc ju jv jw jx bi translated">首先，我们将创建一个名为“packages”的目录。</li></ol><pre class="je jf jg jh fd ko kp kq kr aw ks bi"><span id="ec95" class="kt ku hi kp b fi kv kw l kx ky">mkdir packages</span></pre><p id="e97c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.现在，我们将更改目录，进入“packages”目录。</p><pre class="je jf jg jh fd ko kp kq kr aw ks bi"><span id="a609" class="kt ku hi kp b fi kv kw l kx ky">cd packages</span></pre><p id="5ab9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3.现在我们要创建一个虚拟环境。</p><pre class="je jf jg jh fd ko kp kq kr aw ks bi"><span id="7a45" class="kt ku hi kp b fi kv kw l kx ky">python3 -m venv venv</span></pre><p id="8e31" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4.之后，我们将激活环境。</p><pre class="je jf jg jh fd ko kp kq kr aw ks bi"><span id="48ba" class="kt ku hi kp b fi kv kw l kx ky">source venv/bin/activate</span></pre><p id="5954" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">5.现在我们要创建另一个名为“python”的目录。</p><pre class="je jf jg jh fd ko kp kq kr aw ks bi"><span id="ff12" class="kt ku hi kp b fi kv kw l kx ky">mkdir python<br/>cd python</span></pre><p id="e833" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">6.现在，我将安装所需的软件包。</p><pre class="je jf jg jh fd ko kp kq kr aw ks bi"><span id="a2be" class="kt ku hi kp b fi kv kw l kx ky">pip3 install pandas -t .<br/>pip3 install numpy -t .<br/>pip3 install boto3 -t .</span></pre><p id="66a6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">7.现在，我将返回python目录。</p><pre class="je jf jg jh fd ko kp kq kr aw ks bi"><span id="944e" class="kt ku hi kp b fi kv kw l kx ky">cd ..</span></pre><p id="bf10" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">8.现在，我们将把python目录中包含的任何数据制作成zip文件。</p><pre class="je jf jg jh fd ko kp kq kr aw ks bi"><span id="5299" class="kt ku hi kp b fi kv kw l kx ky">zip -r layer-v1.zip python</span></pre><p id="7888" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我做了一个新的S3桶来存储zip文件，它将在运行lambda函数时用作层。</p><p id="7e11" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">笔记。确保S3桶的区域、λ和λ层应该相同。我用的是“N.Virginia”地区。</p><p id="6f33" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我把一个新的S3桶命名为“层-为-S3-λ-v1”。</p><p id="3a30" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">9.现在我正在转移压缩文件到S3桶。</p><pre class="je jf jg jh fd ko kp kq kr aw ks bi"><span id="cf3a" class="kt ku hi kp b fi kv kw l kx ky">aws s3 cp layer-v1.zip s3://layer-for-s3-lambda-v1/</span><span id="8ffe" class="kt ku hi kp b fi kz kw l kx ky">aws s3 cp zip_file_name.zip s3://s3_bucket_name/</span></pre><p id="1ddd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们转到AWS Lambda。我将在第2部分向您展示。</p></div></div>    
</body>
</html>