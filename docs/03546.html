<html>
<head>
<title>Predicting Counterfactual Building Energy Consumption</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">预测反事实建筑能耗</h1>
<blockquote>原文：<a href="https://medium.com/codex/predicting-counterfactual-building-energy-consumption-79b3b0e97e22?source=collection_archive---------9-----------------------#2021-09-08">https://medium.com/codex/predicting-counterfactual-building-energy-consumption-79b3b0e97e22?source=collection_archive---------9-----------------------#2021-09-08</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/></div><div class="ab cl if ig gp ih" role="separator"><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik"/></div><div class="hb hc hd he hf"><figure class="in io ip iq fd ir er es paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><div class="er es im"><img src="../Images/ceb2ff9e6b1fe2adb4f61ed1fa758596.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*misqfHlKgWC4MoxqeZ558A.jpeg"/></div></div><figcaption class="iy iz et er es ja jb bd b be z dx translated">克里斯蒂安·杜博万在<a class="ae jc" href="https://unsplash.com/photos/gxsRL8B_ZqE" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure></div><div class="ab cl if ig gp ih" role="separator"><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik"/></div><div class="hb hc hd he hf"><h1 id="0d80" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">介绍</h1><p id="b9e6" class="pw-post-body-paragraph kb kc hi kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky hb bi translated">近年来，人们越来越重视减少建筑物的能源排放和消耗。最大限度地减少能源消耗不仅有助于经济，而且对环境也有重大的积极影响。随着投资被用于降低能源使用水平，问题仍然是如何衡量它们的好处？</p><h1 id="7b1d" class="jd je hi bd jf jg kz ji jj jk la jm jn jo lb jq jr js lc ju jv jw ld jy jz ka bi translated">商业问题</h1><p id="ecd0" class="pw-post-body-paragraph kb kc hi kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky hb bi translated">我们试图解决的问题不仅具有经济意义，而且还能带来显著的环境效益。随着环境意识的不断增强，企业正在积极努力减少碳足迹，其中一项努力就是减少他们消耗的能源。商业建筑正在翻新，以确保有效的能源消耗。然而，为了量化投资产生的价值，我们需要能够比较改造能耗水平与反事实(没有改造投资)水平。这不仅对于确定投资的有效性很重要，而且对于提高对可能产生的潜在节约的认识也很重要。</p><p id="c5b4" class="pw-post-body-paragraph kb kc hi kd b ke le kg kh ki lf kk kl km lg ko kp kq lh ks kt ku li kw kx ky hb bi translated">过去，研究人员尝试了各种方法来估计这些反事实的消耗值，但这些方法受到电表类型的限制，或者仅适用于特定的建筑物。因此，我们在这里试图解决并创造价值的业务问题是，能够创建能够预测反事实能耗值的模型，而不管电表类型或建筑类型如何。简而言之，我们面临的挑战是构建一个可扩展的解决方案，它与建筑类型或仪表类型无关。</p><h1 id="aa17" class="jd je hi bd jf jg kz ji jj jk la jm jn jo lb jq jr js lc ju jv jw ld jy jz ka bi translated">数据来源</h1><p id="c51b" class="pw-post-body-paragraph kb kc hi kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky hb bi translated">我们将要研究的数据集是由美国供暖、制冷和空调工程师协会<strong class="kd hj"> ASHRAE收集的。</strong> ASHRAE成立于1894年，目标是推动供暖、通风和空调制冷领域的技术进步。从2016年1月1日到2018年12月31日的三年时间里，从全球16个站点收集了能源或电表读数数据集。还提供了每个地点的相应天气数据。</p><h1 id="1a37" class="jd je hi bd jf jg kz ji jj jk la jm jn jo lb jq jr js lc ju jv jw ld jy jz ka bi translated">数据描述</h1><p id="75b2" class="pw-post-body-paragraph kb kc hi kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky hb bi translated">数据被分成三个链接表，下面详细描述了每一个表。</p><blockquote class="lj lk ll"><p id="769b" class="kb kc lm kd b ke le kg kh ki lf kk kl ln lg ko kp lo lh ks kt lp li kw kx ky hb bi translated"><strong class="kd hj">仪表读数</strong></p></blockquote><p id="633c" class="pw-post-body-paragraph kb kc hi kd b ke le kg kh ki lf kk kl km lg ko kp kq lh ks kt ku li kw kx ky hb bi translated">此表包含给定建筑和仪表类型的每小时仪表读数。这些仪表读数是我们的目标变量，或者是我们的机器学习算法最终需要预测的。我们需要预测四种不同类型的电表的能耗水平:电、冷水、蒸汽和热水。</p><blockquote class="lj lk ll"><p id="35be" class="kb kc lm kd b ke le kg kh ki lf kk kl ln lg ko kp lo lh ks kt lp li kw kx ky hb bi translated"><strong class="kd hj">构建元数据</strong></p></blockquote><p id="e803" class="pw-post-body-paragraph kb kc hi kd b ke le kg kh ki lf kk kl km lg ko kp kq lh ks kt ku li kw kx ky hb bi translated">这些仪表读数是从世界各地的1449栋建筑中收集的。对于这些建筑中的每一个，我们都被提供了它们的主要用途、平方英尺的面积、建造年份和楼层数。</p><blockquote class="lj lk ll"><p id="bb8c" class="kb kc lm kd b ke le kg kh ki lf kk kl ln lg ko kp lo lh ks kt lp li kw kx ky hb bi translated"><strong class="kd hj">天气数据</strong></p></blockquote><p id="7988" class="pw-post-body-paragraph kb kc hi kd b ke le kg kh ki lf kk kl km lg ko kp kq lh ks kt ku li kw kx ky hb bi translated">1449座建筑中的每一座都根据它们的位置被分成了16个地点。每小时的天气记录，如气温、云量等。已经为这些网站提供了。</p><figure class="in io ip iq fd ir er es paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><div class="er es lq"><img src="../Images/880950eb404fcbedadcc525551246006.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jhoSL5y68PCutX9GDHABLA.jpeg"/></div></div><figcaption class="iy iz et er es ja jb bd b be z dx translated">数据表和连接</figcaption></figure><h1 id="55fd" class="jd je hi bd jf jg kz ji jj jk la jm jn jo lb jq jr js lc ju jv jw ld jy jz ka bi translated">ML问题公式化</h1><p id="95bc" class="pw-post-body-paragraph kb kc hi kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky hb bi translated">既然我们已经了解了总体业务目标和数据集，我们需要能够将其转化为数据科学目标。使用过去或历史能耗数据，我们需要能够预测未来的反事实能耗水平。由于目标变量(能耗)是实值，在最大似然术语中，我们有一个基于时间序列的预测或回归问题。因为除了历史负荷数据之外，我们还有建筑元数据和天气数据形式的额外数据源，更准确地说，我们有一个多元回归问题。</p><h1 id="db70" class="jd je hi bd jf jg kz ji jj jk la jm jn jo lb jq jr js lc ju jv jw ld jy jz ka bi translated">模型评估</h1><p id="55d8" class="pw-post-body-paragraph kb kc hi kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky hb bi translated">对于任何数据科学问题，我们都需要能够客观地评估我们的机器学习模型的性能。因此，我们需要清楚地定义一个适合我们问题的性能指标。</p><p id="c9e8" class="pw-post-body-paragraph kb kc hi kd b ke le kg kh ki lf kk kl km lg ko kp kq lh ks kt ku li kw kx ky hb bi translated">我们可以用来评估和测量模型的性能指标是均方根对数误差，其数学定义如下:</p><figure class="in io ip iq fd ir er es paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><div class="er es lr"><img src="../Images/a22c400827a646cc945788c7d3a0daf3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KnVKpu-rkscAVROE_o8Cow.jpeg"/></div></div></figure><p id="3ef3" class="pw-post-body-paragraph kb kc hi kd b ke le kg kh ki lf kk kl km lg ko kp kq lh ks kt ku li kw kx ky hb bi translated">从等式中可以看出，与简单的RMSE相比，我们使用自然对数，然后计算实际值和预测值之间的平方差。我们建议使用RMSLE而不是简单指标的原因是因为我们的目标变量(能耗)是有偏差的，并且可能具有较大的非负值。因此，应用对数变换来确保我们的度量不受大的异常值的影响是适当的。此外，因为我们的目标具有较大的非负值，所以我们希望考虑相对误差并忽略数据的规模，这是RMSLE允许我们实现的。</p></div><div class="ab cl if ig gp ih" role="separator"><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik"/></div><div class="hb hc hd he hf"><h1 id="6c35" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">探索性数据分析</h1><p id="6f26" class="pw-post-body-paragraph kb kc hi kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky hb bi translated">在开始用复杂的机器学习算法解决我们的问题之前，深入了解可用的数据并识别特征变量和我们的目标变量之间的相关性至关重要。</p><p id="e259" class="pw-post-body-paragraph kb kc hi kd b ke le kg kh ki lf kk kl km lg ko kp kq lh ks kt ku li kw kx ky hb bi translated">我们将把EDA工作的重点放在三大目标上:</p><ul class=""><li id="378d" class="ls lt hi kd b ke le ki lf km lu kq lv ku lw ky lx ly lz ma bi translated">数据理解</li><li id="106f" class="ls lt hi kd b ke mb ki mc km md kq me ku mf ky lx ly lz ma bi translated">识别异常</li><li id="0ad1" class="ls lt hi kd b ke mb ki mc km md kq me ku mf ky lx ly lz ma bi translated">因变量和仪表读数之间的关系</li></ul><p id="8312" class="pw-post-body-paragraph kb kc hi kd b ke le kg kh ki lf kk kl km lg ko kp kq lh ks kt ku li kw kx ky hb bi translated"><strong class="kd hj">数据理解</strong></p><p id="813f" class="pw-post-body-paragraph kb kc hi kd b ke le kg kh ki lf kk kl km lg ko kp kq lh ks kt ku li kw kx ky hb bi translated">在本节中，我们的目标是理解已经提供的不同数据表，并对每个数据表下可用的不同原始功能有所了解。</p><p id="dca5" class="pw-post-body-paragraph kb kc hi kd b ke le kg kh ki lf kk kl km lg ko kp kq lh ks kt ku li kw kx ky hb bi translated">让我们首先看看不同的仪表类型，并分析我们的目标变量(仪表读数)。</p><figure class="in io ip iq fd ir er es paragraph-image"><div class="er es mg"><img src="../Images/801706aeef1c4de307e0179aac960089.png" data-original-src="https://miro.medium.com/v2/resize:fit:988/format:webp/1*s_7MtZdU8NU02i25o_w7kQ.png"/></div><figcaption class="iy iz et er es ja jb bd b be z dx translated">按仪表类型的记录计数</figcaption></figure><p id="a59f" class="pw-post-body-paragraph kb kc hi kd b ke le kg kh ki lf kk kl km lg ko kp kq lh ks kt ku li kw kx ky hb bi translated">上图描述了不同仪表类型的记录或观察计数。从上面的图中可以看出，大多数记录或观察值都与仪表id 0有关。在2000万个仪表读数中，大约有1200万个(大约。60%)的记录只与仪表id 0相关。仪表ID 1的第二高观测值约为400万次(约为100万次)。20%).剩下的两米构成了其余的20%的观测值。</p><figure class="in io ip iq fd ir er es paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><div class="er es mh"><img src="../Images/d45980ce58a90e1f8e60b411b3c4de33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Mq9z0ABafGqN-FGqCoSa-g.png"/></div></div><figcaption class="iy iz et er es ja jb bd b be z dx translated">建筑ID 1232的仪表读数分布</figcaption></figure><figure class="in io ip iq fd ir er es paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><div class="er es mi"><img src="../Images/21e468d59447003adf47bbf6eb805b2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*az18XU_RrVsCqAyttcZitg.png"/></div></div><figcaption class="iy iz et er es ja jb bd b be z dx translated">建筑ID 1294的仪表读数分布</figcaption></figure><p id="c586" class="pw-post-body-paragraph kb kc hi kd b ke le kg kh ki lf kk kl km lg ko kp kq lh ks kt ku li kw kx ky hb bi translated">上图描绘了所有仪表类型和给定建筑物id的仪表读数分布。从本质上讲，每个图都与单个建筑相关，然后每个子图都按仪表类型描述了能耗分布。我们随机选择了2栋建筑(安装了所有类型的电表)来分析分布情况。仔细分析后发现，在几乎所有的图中，都有许多仪表读数为零。另一个观察结果是，在所有仪表类型的情况下，我们确实有一些正常读数范围，但也有一些可以看到极值的情况，或者简单地说，我们有右偏分布。</p><p id="d927" class="pw-post-body-paragraph kb kc hi kd b ke le kg kh ki lf kk kl km lg ko kp kq lh ks kt ku li kw kx ky hb bi translated">现在我们将从天气数据中探索气温时间序列。</p><figure class="in io ip iq fd ir er es paragraph-image"><div class="er es mj"><img src="../Images/613ea5a0d967e3ac7384a68d0599866a.png" data-original-src="https://miro.medium.com/v2/resize:fit:984/format:webp/1*rmeNC66zCdcJleBvJ24H9w.png"/></div><figcaption class="iy iz et er es ja jb bd b be z dx translated">站点9的平均温度趋势</figcaption></figure><figure class="in io ip iq fd ir er es paragraph-image"><div class="er es mj"><img src="../Images/94d0ca7f4f8c2c116b3b3d3aeb11a325.png" data-original-src="https://miro.medium.com/v2/resize:fit:984/format:webp/1*ndnb7VfJczFldBE2i2yfeg.png"/></div><figcaption class="iy iz et er es ja jb bd b be z dx translated">站点8的平均温度趋势</figcaption></figure><p id="ce52" class="pw-post-body-paragraph kb kc hi kd b ke le kg kh ki lf kk kl km lg ko kp kq lh ks kt ku li kw kx ky hb bi translated">这些线图展示了随机选择的两个地点的日平均温度趋势。从上面的图中，我们可以根据日平均气温来观察季节趋势。两幅图都显示了1月至3月期间的较低温度。从5月开始，我们可以观察到温度持续上升，直到7月左右，然后从9月开始再次下降。有趣的是，当我为所有剩余的网站绘制相同的信息时，观察到了类似的模式。基于这一点，我们可以得出结论，我们所有的站点以及所有的建筑都位于北半球。</p><p id="fc90" class="pw-post-body-paragraph kb kc hi kd b ke le kg kh ki lf kk kl km lg ko kp kq lh ks kt ku li kw kx ky hb bi translated">现在，我们将强调建筑元数据中的几个可用特征:平方英尺和主要用途。</p><figure class="in io ip iq fd ir er es paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><div class="er es mk"><img src="../Images/c1f9c522687ed5f50cd3e626d105460f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PatAPHpZcQJxLviJJL0RrA.png"/></div></div><figcaption class="iy iz et er es ja jb bd b be z dx translated">按主要用途统计的建筑物数量</figcaption></figure><p id="0111" class="pw-post-body-paragraph kb kc hi kd b ke le kg kh ki lf kk kl km lg ko kp kq lh ks kt ku li kw kx ky hb bi translated">条形图显示了按主要用途划分的建筑数量。据观察，大约35-40%的建筑主要用于教育目的。继教育之后，第二个最常见的主要用途是“办公室”,约占所有建筑的20%。由于大多数建筑要么是教育机构，要么是办公场所，因此考虑诸如一天中的时间、日期类型、公共假日等因素是很重要的。同时选择特征来预测目标变量。</p><figure class="in io ip iq fd ir er es paragraph-image"><div class="er es ml"><img src="../Images/8e3d825a2965b213e7e232311121a67d.png" data-original-src="https://miro.medium.com/v2/resize:fit:994/format:webp/1*G_SLv59XbkbN7xCtv7nb0Q.png"/></div><figcaption class="iy iz et er es ja jb bd b be z dx translated">建筑平方英尺的分布</figcaption></figure><p id="eff1" class="pw-post-body-paragraph kb kc hi kd b ke le kg kh ki lf kk kl km lg ko kp kq lh ks kt ku li kw kx ky hb bi translated">上图描绘了建筑面积的平方英尺分布。建筑平方英尺的分布似乎是右偏的，大多数建筑的面积不到20万平方英尺。很小一部分建筑分布在很大的区域。虽然大多数建筑的面积覆盖范围相似，但我们仍然观察到建筑平方英尺分布的一些变化。因为能源需求在很大程度上受建筑物大小的影响，我们在定义我们的特征时需要考虑这一点。</p><h2 id="f9b4" class="mm je hi bd jf mn mo mp jj mq mr ms jn km mt mu jr kq mv mw jv ku mx my jz mz bi translated">识别异常</h2><p id="024b" class="pw-post-body-paragraph kb kc hi kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky hb bi translated">在这一节中，我们将努力找出数据中是否有任何异常，我们可能需要在数据预处理中纠正这些异常。</p><figure class="in io ip iq fd ir er es paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><div class="er es mk"><img src="../Images/c10b8661b79ca278cb4cdaf7f0546c74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n-JPogOQ5rnzxG9_NTbAXg.png"/></div></div><figcaption class="iy iz et er es ja jb bd b be z dx translated">建筑物ID 320和仪表ID 0的仪表读数</figcaption></figure><figure class="in io ip iq fd ir er es paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><div class="er es na"><img src="../Images/b60a71fa16df3296e3b0eff0f3bbd535.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8g37SZBcvI4SXsrDCv5j7w.png"/></div></div><figcaption class="iy iz et er es ja jb bd b be z dx translated">建筑ID 103和仪表ID 1的仪表读数</figcaption></figure><figure class="in io ip iq fd ir er es paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><div class="er es mk"><img src="../Images/42b977a6eac24471274fd36a367e335d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q0AB4xtW2KGzpmvOS9Q-AA.png"/></div></div><figcaption class="iy iz et er es ja jb bd b be z dx translated">建筑物ID 3和仪表ID 0的仪表读数</figcaption></figure><p id="4a4e" class="pw-post-body-paragraph kb kc hi kd b ke le kg kh ki lf kk kl km lg ko kp kq lh ks kt ku li kw kx ky hb bi translated">上面的图是按建筑物id过滤的特定电表类型的时间序列图。如上所述，我们试图绘制出在整个数据集中观察到的每种不同异常的样本。在第一个图中，我们可以观察到有一个突然的负尖峰。第二个图与第一个图正好相反，我们看到恒定值，然后是突然的正尖峰。第三种绘图类型表示数据中普遍存在的一种情况，在这种情况下，我们在很长一段时间内都有恒定的零读数。因为作为这个问题的一部分，仪表读数是我们需要预测的目标变量，所以跨数据集检测这样的异常并移除它们将是至关重要的。</p><p id="5f20" class="pw-post-body-paragraph kb kc hi kd b ke le kg kh ki lf kk kl km lg ko kp kq lh ks kt ku li kw kx ky hb bi translated">一些参赛选手指出，对于气象数据中的一些站点，时区是以UTC表示的，而不是当地时间。为了进一步分析这一点，我们将绘制几个站点id:全年每小时的平均温度。</p><figure class="in io ip iq fd ir er es paragraph-image"><div class="er es mj"><img src="../Images/1e9d7ccfb95a751fd19232d5fd22ff3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:984/format:webp/1*apEOlfycrMxyyxTnqS6jaQ.png"/></div><figcaption class="iy iz et er es ja jb bd b be z dx translated">站点2每小时的平均温度</figcaption></figure><figure class="in io ip iq fd ir er es paragraph-image"><div class="er es mj"><img src="../Images/724fb47bac25ee069a26d22d2c45c116.png" data-original-src="https://miro.medium.com/v2/resize:fit:984/format:webp/1*9-7vKo3LUq_pJ--lbnLHxA.png"/></div><figcaption class="iy iz et er es ja jb bd b be z dx translated">站点13每小时的平均温度</figcaption></figure><p id="4315" class="pw-post-body-paragraph kb kc hi kd b ke le kg kh ki lf kk kl km lg ko kp kq lh ks kt ku li kw kx ky hb bi translated">上面按站点id过滤的图反映了在观察时间段内给定小时的平均温度。在这两个图中，我们可以观察到温度值在大约2100小时或晚上9点达到峰值。同样，我们也可以观察到温度在1200时左右或中午下降。根据这些观察，我们可以明确地得出结论，天气数据中的时间戳是基于UTC的，而不是本地的。温度峰值和下降似乎是反直觉的，我们通常期望在中午看到温度峰值，而在晚上看到较低的温度。</p><h2 id="a491" class="mm je hi bd jf mn mo mp jj mq mr ms jn km mt mu jr kq mv mw jv ku mx my jz mz bi translated">特征和目标变量之间的关系</h2><p id="4a77" class="pw-post-body-paragraph kb kc hi kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky hb bi translated">在本节中，我们的目标是解码我们的各种特征和目标变量(仪表读数)之间的关系。所有的分析和探索都将集中在寻找相关的或影响能源消耗的特征上。</p><p id="6adf" class="pw-post-body-paragraph kb kc hi kd b ke le kg kh ki lf kk kl km lg ko kp kq lh ks kt ku li kw kx ky hb bi translated">让我们先来看看日期时间特性(如一天中的小时和一天中的类型)是如何影响能耗的。</p><figure class="in io ip iq fd ir er es paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><div class="er es mk"><img src="../Images/20d457340adce0221fb3387be905d3ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zrmNqtwUohaDlBejTrcTaw.png"/></div></div><figcaption class="iy iz et er es ja jb bd b be z dx translated">一周中各天的能耗</figcaption></figure><p id="62f5" class="pw-post-body-paragraph kb kc hi kd b ke le kg kh ki lf kk kl km lg ko kp kq lh ks kt ku li kw kx ky hb bi translated">条形图显示了工作日和周末的能耗差异。每个子图表示根据仪表id过滤出的数据。对于仪表类型0、1、2，我们可以清楚地观察到工作日的中值消耗量高于周末。对于仪表类型3，周末和工作日的中值消耗量看起来几乎相似，但仔细观察就会发现，工作日的消耗量略高。</p><figure class="in io ip iq fd ir er es paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><div class="er es mk"><img src="../Images/c83dee83753b99ac4e067acf334ea2ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sN5UUJie63tN65xMlebG9g.png"/></div></div><figcaption class="iy iz et er es ja jb bd b be z dx translated">一天中每个小时的能耗</figcaption></figure><p id="ccf3" class="pw-post-body-paragraph kb kc hi kd b ke le kg kh ki lf kk kl km lg ko kp kq lh ks kt ku li kw kx ky hb bi translated">这些图试图描述基于一天中某个小时的能源消耗模式。每个子图由特定的仪表类型过滤。所有电表类型的一个共同观察结果是，夜间能耗相对较低，白天能耗相对较高。仪表ID 0和1显示能量消耗从上午10点左右开始增加，并在下午达到峰值。另一方面，仪表ID 2和3在上午6点到8点之间达到峰值，然后在上午9点开始下降。当我们查看提供的数据描述时，仪表id 0、1、2和3代表电力、冷冻水、热水和蒸汽相关的能耗。从这个意义上说，观察结果似乎也很直观，因为我们预计与冷却水相关的能耗会在下午达到峰值，然后在夜间下降，这正是从仪表id 2的曲线图中观察到的行为。</p><p id="c919" class="pw-post-body-paragraph kb kc hi kd b ke le kg kh ki lf kk kl km lg ko kp kq lh ks kt ku li kw kx ky hb bi translated">接下来，我们将继续确定天气特征和目标变量之间的相关性。</p><figure class="in io ip iq fd ir er es paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><div class="er es nb"><img src="../Images/aa1c1a07427f318afeebb5f6e10d2517.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TDzP11VS18OnOhJn6TQvcw.png"/></div></div><figcaption class="iy iz et er es ja jb bd b be z dx translated">建筑物ID 1296的天气相关热图</figcaption></figure><figure class="in io ip iq fd ir er es paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><div class="er es nb"><img src="../Images/40fccf085b924272ddad6c653462d94c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gE6J0AsMh2tyeiLO3dPtrQ.png"/></div></div><figcaption class="iy iz et er es ja jb bd b be z dx translated">建筑物ID 1293的天气相关热图</figcaption></figure><p id="485e" class="pw-post-body-paragraph kb kc hi kd b ke le kg kh ki lf kk kl km lg ko kp kq lh ks kt ku li kw kx ky hb bi translated">这些热图试图描述天气变量和我们的目标变量“仪表读数”之间的相关性。我们随机选择了两栋拥有所有四种仪表类型的建筑，然后尝试测量仪表读数和天气变量之间的相关系数。对于这两个建筑，空气温度和露水温度与仪表ID 1、2和3有很强的相关性。空气温度和露水温度都与仪表id 1的能耗读数正相关。由于该仪表与冷冻水相关，因此它也具有直观意义，因为随着温度升高，我们预计冷却需求也会增加。相反，空气温度和露水温度与仪表id 2和3的读数有很强的负相关性。这表明随着温度下降，能量消耗增加，这又是直观的，因为仪表2和3与加热要求相关。风向、风速和海平面气压与仪表读数的相关性较弱，其他变量的相关值在零附近。</p><p id="01af" class="pw-post-body-paragraph kb kc hi kd b ke le kg kh ki lf kk kl km lg ko kp kq lh ks kt ku li kw kx ky hb bi translated">现在，我们将重点了解一些建筑属性如何影响能源消耗模式。</p><figure class="in io ip iq fd ir er es paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><div class="er es nc"><img src="../Images/a1a669a9988666deb55305ed4cd4d9bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UchwPi0Ex36ViuGhIuUAfw.png"/></div></div><figcaption class="iy iz et er es ja jb bd b be z dx translated">散点图:建筑平方英尺与能耗</figcaption></figure><p id="2663" class="pw-post-body-paragraph kb kc hi kd b ke le kg kh ki lf kk kl km lg ko kp kq lh ks kt ku li kw kx ky hb bi translated">这些散点图试图代表建筑平方英尺和给定电表类型的能耗之间的相关性。对于每幅图，我们可以观察到，在大多数情况下，随着建筑面积或平方英尺的增加，我们会看到建筑的中值消耗量增加。建筑面积和能源消耗之间没有非常强的相关性，但我们可以笼统地说，随着建筑面积的增加，我们可以预期能源消耗也会增加。</p><figure class="in io ip iq fd ir er es paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><div class="er es nd"><img src="../Images/12372776bc314295fe809141048dfba3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*noVYekRaK5RVKw8PhG2zcw.png"/></div></div><figcaption class="iy iz et er es ja jb bd b be z dx translated">建筑主要用途的能源消耗</figcaption></figure><p id="c2dc" class="pw-post-body-paragraph kb kc hi kd b ke le kg kh ki lf kk kl km lg ko kp kq lh ks kt ku li kw kx ky hb bi translated">这些图表试图通过建筑的主要用途或目的得出能源消耗的比较。快速观察每种仪表类型的曲线图可以发现，建筑类型不同，能耗差异也很大。对于仪表id 0，我们观察到主要用于医疗保健的建筑具有最高的日能耗中值。同样，仪表id 1，2和3分别在公共设施，服务和公共服务建筑类型中消耗最高。</p></div><div class="ab cl if ig gp ih" role="separator"><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik"/></div><div class="hb hc hd he hf"><h1 id="6994" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">数据处理和清理</h1><p id="f033" class="pw-post-body-paragraph kb kc hi kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky hb bi translated">既然我们已经很好地理解了数据中的任何不一致，我们就可以着手清理和处理它们了。在本节中，我们将重点关注四大活动:</p><ul class=""><li id="f1fc" class="ls lt hi kd b ke le ki lf km lu kq lv ku lw ky lx ly lz ma bi translated">天气数据-时区偏移</li><li id="e426" class="ls lt hi kd b ke mb ki mc km md kq me ku mf ky lx ly lz ma bi translated">清洗常量零值</li><li id="3d52" class="ls lt hi kd b ke mb ki mc km md kq me ku mf ky lx ly lz ma bi translated">清理异常尖峰</li><li id="721e" class="ls lt hi kd b ke mb ki mc km md kq me ku mf ky lx ly lz ma bi translated">缺失值插补</li></ul><p id="02b3" class="pw-post-body-paragraph kb kc hi kd b ke le kg kh ki lf kk kl km lg ko kp kq lh ks kt ku li kw kx ky hb bi translated"><strong class="kd hj">天气数据—时区偏移</strong></p><p id="b624" class="pw-post-body-paragraph kb kc hi kd b ke le kg kh ki lf kk kl km lg ko kp kq lh ks kt ku li kw kx ky hb bi translated">正如在EDA阶段所讨论的，对于天气数据中的一些站点id，我们需要偏移时区。下面的讨论提供了每个站点需要应用的偏移。</p><div class="ne nf ez fb ng nh"><a href="https://www.kaggle.com/patrick0302/locate-cities-according-weather-temperature" rel="noopener  ugc nofollow" target="_blank"><div class="ni ab dw"><div class="nj ab nk cl cj nl"><h2 class="bd hj fi z dy nm ea eb nn ed ef hh bi translated">根据天气温度定位城市🌇</h2><div class="no l"><h3 class="bd b fi z dy nm ea eb nn ed ef dx translated">使用Kaggle笔记本探索和运行机器学习代码|使用来自多个数据源的数据</h3></div><div class="np l"><p class="bd b fp z dy nm ea eb nn ed ef dx translated">www.kaggle.com</p></div></div><div class="nq l"><div class="nr l ns nt nu nq nv iw nh"/></div></div></a></div><figure class="in io ip iq fd ir"><div class="bz dy l di"><div class="nw nx l"/></div><figcaption class="iy iz et er es ja jb bd b be z dx translated">时区偏移</figcaption></figure><p id="bede" class="pw-post-body-paragraph kb kc hi kd b ke le kg kh ki lf kk kl km lg ko kp kq lh ks kt ku li kw kx ky hb bi translated"><strong class="kd hj">清洗常量零值</strong></p><p id="d69e" class="pw-post-body-paragraph kb kc hi kd b ke le kg kh ki lf kk kl km lg ko kp kq lh ks kt ku li kw kx ky hb bi translated">在我们的EDA过程中，我们观察到电表读数在很长一段时间内都是恒定的零值。现在，这些恒定的零值可能是因为相应的系统已经关闭(出于季节性目的)，或者它们只是我们需要清理的异常。为了清除不合理的零读数，我们将采取以下方法:</p><ul class=""><li id="341d" class="ls lt hi kd b ke le ki lf km lu kq lv ku lw ky lx ly lz ma bi translated">对于仪表id 0，删除所有连续48小时或更长时间读数为零的行，无论季节如何。由于电表id 0与用电量相关，我们希望它全年都可以正常工作。</li><li id="f124" class="ls lt hi kd b ke mb ki mc km md kq me ku mf ky lx ly lz ma bi translated">对于仪表id 1(冷冻水)，删除所有连续48小时或以上读数为零的行，冬季除外(十二月、一月、二月、三月)。</li><li id="f653" class="ls lt hi kd b ke mb ki mc km md kq me ku mf ky lx ly lz ma bi translated">对于仪表id 2(蒸汽)和仪表id 3(热水)，删除所有连续48小时或以上读数为零的行，夏季除外(六月、七月、八月、九月)。</li></ul><figure class="in io ip iq fd ir"><div class="bz dy l di"><div class="nw nx l"/></div><figcaption class="iy iz et er es ja jb bd b be z dx translated">清除不合理零读数的功能</figcaption></figure><p id="69de" class="pw-post-body-paragraph kb kc hi kd b ke le kg kh ki lf kk kl km lg ko kp kq lh ks kt ku li kw kx ky hb bi translated"><strong class="kd hj">清洗异常尖刺</strong></p><p id="a473" class="pw-post-body-paragraph kb kc hi kd b ke le kg kh ki lf kk kl km lg ko kp kq lh ks kt ku li kw kx ky hb bi translated">除了恒定的零值之外，在我们的EDA过程中，我们还观察到异常的正负尖峰。这是非常重要的清理出来，使它不影响我们的模型训练过程。为了识别这些异常峰值，我们将基于<strong class="kd hj"> building_id </strong>、<strong class="kd hj">计量器、</strong>和<strong class="kd hj">季节</strong>来创建组。在我们的每个小组中，我们将计算仪表读数的z分数，并删除任何z分数为4或偏离小组仪表读数平均值超过4个标准偏差的读数。</p><p id="0c71" class="pw-post-body-paragraph kb kc hi kd b ke le kg kh ki lf kk kl km lg ko kp kq lh ks kt ku li kw kx ky hb bi translated">因为我们所有的建筑都在北半球，所以我们将季节定义如下:</p><figure class="in io ip iq fd ir er es paragraph-image"><div class="er es ny"><img src="../Images/b7070a9a6555d804e3adf510ac82f0e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1058/format:webp/1*FDUP-CAwN7M2xWQWVMqWuA.jpeg"/></div><figcaption class="iy iz et er es ja jb bd b be z dx translated">季节定义</figcaption></figure><figure class="in io ip iq fd ir"><div class="bz dy l di"><div class="nw nx l"/></div><figcaption class="iy iz et er es ja jb bd b be z dx translated">识别异常峰值的功能</figcaption></figure><p id="5781" class="pw-post-body-paragraph kb kc hi kd b ke le kg kh ki lf kk kl km lg ko kp kq lh ks kt ku li kw kx ky hb bi translated"><strong class="kd hj">缺失值插补</strong></p><p id="e1ac" class="pw-post-body-paragraph kb kc hi kd b ke le kg kh ki lf kk kl km lg ko kp kq lh ks kt ku li kw kx ky hb bi translated">在我们的数据理解阶段，我们发现我们的大部分天气变量都缺少观测值或记录。我们将使用简单的线性插值策略来输入这些缺失值。</p><figure class="in io ip iq fd ir"><div class="bz dy l di"><div class="nw nx l"/></div><figcaption class="iy iz et er es ja jb bd b be z dx translated">使用线性插值法估算缺失天气变量的函数</figcaption></figure></div><div class="ab cl if ig gp ih" role="separator"><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik"/></div><div class="hb hc hd he hf"><h1 id="8a20" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">特征工程</h1><p id="9021" class="pw-post-body-paragraph kb kc hi kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky hb bi translated">解决任何机器学习问题的最关键因素是能够设计与我们的目标变量高度相关的特征。我们将应用从EDA第三阶段学到的知识(在该阶段，我们探索了原始特征和目标变量之间的关系),同时创建新的特征。</p><p id="540c" class="pw-post-body-paragraph kb kc hi kd b ke le kg kh ki lf kk kl km lg ko kp kq lh ks kt ku li kw kx ky hb bi translated"><strong class="kd hj">温差特征</strong></p><p id="550b" class="pw-post-body-paragraph kb kc hi kd b ke le kg kh ki lf kk kl km lg ko kp kq lh ks kt ku li kw kx ky hb bi translated">除了我们已经保留的原始天气特征，我们将为气温创建两个额外的基于滞后的特征，定义如下。</p><figure class="in io ip iq fd ir"><div class="bz dy l di"><div class="nw nx l"/></div><figcaption class="iy iz et er es ja jb bd b be z dx translated">产生一阶和二阶温差的功能</figcaption></figure><ol class=""><li id="9b17" class="ls lt hi kd b ke le ki lf km lu kq lv ku lw ky nz ly lz ma bi translated"><strong class="kd hj"> first_order_temp </strong>:这里我们将对每个站点的气温进行一阶差分。换句话说，这意味着当前时间戳和先前时间戳之间的气温差异。</li><li id="6b42" class="ls lt hi kd b ke mb ki mc km md kq me ku mf ky nz ly lz ma bi translated"><strong class="kd hj"> second_order_temp </strong>:这里我们将对每个站点的空气温度进行二阶差分。换句话说，这意味着当前时间戳和先前时间戳之间的一阶空气温度差。</li></ol><figure class="in io ip iq fd ir er es paragraph-image"><div class="er es oa"><img src="../Images/3713c38a3711ef018bf25990e855ec4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:754/format:webp/1*m4URQ2fADjQl8YMsgW-K6w.jpeg"/></div><figcaption class="iy iz et er es ja jb bd b be z dx translated">一阶差分</figcaption></figure><figure class="in io ip iq fd ir er es paragraph-image"><div class="er es ob"><img src="../Images/618d63ad769a83368341d42da6b1ca3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1020/format:webp/1*9i9NJFUOWwXpWYFrlczPGg.jpeg"/></div><figcaption class="iy iz et er es ja jb bd b be z dx translated">二阶差分</figcaption></figure><p id="24e5" class="pw-post-body-paragraph kb kc hi kd b ke le kg kh ki lf kk kl km lg ko kp kq lh ks kt ku li kw kx ky hb bi translated"><strong class="kd hj">日期时间特性</strong></p><p id="1352" class="pw-post-body-paragraph kb kc hi kd b ke le kg kh ki lf kk kl km lg ko kp kq lh ks kt ku li kw kx ky hb bi translated">在本节中，我们将研究时间戳或日期时间元素的工程特征。为了保留日期时间特征的循环性质，我们将主要使用正弦和余弦变换在二维空间中表示它们。这样做很重要，因为如果我们按顺序考虑基于时间的特征，我们将无法反映不同值之间的真实关系。例如，直觉上，11pm和12am(午夜)应该表示为彼此接近，因为我们知道12am发生在11pm之后。然而，当用连续数字(0 &amp; 23小时)表示时，我们不能保持这种关系。</p><p id="6561" class="pw-post-body-paragraph kb kc hi kd b ke le kg kh ki lf kk kl km lg ko kp kq lh ks kt ku li kw kx ky hb bi translated">从下图中可以看到数学解释和直观表示。</p><figure class="in io ip iq fd ir er es paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><div class="er es oc"><img src="../Images/390db4bcd029057d1123d85bedfcc2a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RfyO0StU6jKuf12J3-Sx5w.jpeg"/></div></div><figcaption class="iy iz et er es ja jb bd b be z dx translated">小时数据转换</figcaption></figure><p id="a6ba" class="pw-post-body-paragraph kb kc hi kd b ke le kg kh ki lf kk kl km lg ko kp kq lh ks kt ku li kw kx ky hb bi translated">从上面的图中可以明显看出，通过将每小时的数据转换成二维数据，我们能够保持一天中不同时间之间的关系。例如，现在12点与晚上11点和凌晨1点都相邻。</p><figure class="in io ip iq fd ir er es paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><div class="er es od"><img src="../Images/324a65b3b36ad274e325e646835d9096.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3o58o4khyODQ05DyEk-8Gw.jpeg"/></div></div><figcaption class="iy iz et er es ja jb bd b be z dx translated">月数据转换</figcaption></figure><p id="128a" class="pw-post-body-paragraph kb kc hi kd b ke le kg kh ki lf kk kl km lg ko kp kq lh ks kt ku li kw kx ky hb bi translated">类似地，这些转换也可以用于表示一周中的几天和几个月，因为它们也遵循类似循环的关系模式。上图中显示了月份转换的类似情况。</p><p id="9d00" class="pw-post-body-paragraph kb kc hi kd b ke le kg kh ki lf kk kl km lg ko kp kq lh ks kt ku li kw kx ky hb bi translated">我们将从时间戳列创建以下功能:</p><ol class=""><li id="9e91" class="ls lt hi kd b ke le ki lf km lu kq lv ku lw ky nz ly lz ma bi translated"><strong class="kd hj"> hour_x: </strong>小时特征的第一维将使用正弦变换来表示</li><li id="548e" class="ls lt hi kd b ke mb ki mc km md kq me ku mf ky nz ly lz ma bi translated"><strong class="kd hj"> hour_y: </strong>小时特征的第二维将使用余弦变换表示</li><li id="aeae" class="ls lt hi kd b ke mb ki mc km md kq me ku mf ky nz ly lz ma bi translated"><strong class="kd hj"> day_x: </strong>日特征的第一维将使用正弦变换表示</li><li id="1c48" class="ls lt hi kd b ke mb ki mc km md kq me ku mf ky nz ly lz ma bi translated"><strong class="kd hj"> day_y: </strong>日特征的第二维将使用余弦变换表示</li><li id="9abd" class="ls lt hi kd b ke mb ki mc km md kq me ku mf ky nz ly lz ma bi translated"><strong class="kd hj"> dayofweek_x: </strong>星期几特征的第一维将使用正弦变换表示</li><li id="819d" class="ls lt hi kd b ke mb ki mc km md kq me ku mf ky nz ly lz ma bi translated"><strong class="kd hj"> dayofweek_y: </strong>星期几特征的第二维将使用余弦变换表示</li><li id="64be" class="ls lt hi kd b ke mb ki mc km md kq me ku mf ky nz ly lz ma bi translated"><strong class="kd hj"> month_x: </strong>月特征的第一维将使用正弦变换表示</li><li id="f4d8" class="ls lt hi kd b ke mb ki mc km md kq me ku mf ky nz ly lz ma bi translated"><strong class="kd hj"> month_y: </strong>月特征的第二维将使用余弦变换表示</li><li id="d7fe" class="ls lt hi kd b ke mb ki mc km md kq me ku mf ky nz ly lz ma bi translated"><strong class="kd hj"> is_weekend: </strong>表示观察值是与工作日还是周末相关的二元特征。如果是周末，我们将其标记为1，否则如果是工作日，我们将其标记为0</li></ol><figure class="in io ip iq fd ir er es paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><div class="er es oe"><img src="../Images/e5871fa84f3b4b21b05e44489df4d1d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ezwpf84sNDpVpd79ZCM82g.jpeg"/></div></div><figcaption class="iy iz et er es ja jb bd b be z dx translated">日期时间具有正弦和余弦转换功能</figcaption></figure><figure class="in io ip iq fd ir"><div class="bz dy l di"><div class="nw nx l"/></div><figcaption class="iy iz et er es ja jb bd b be z dx translated">创建日期时间功能的函数</figcaption></figure><p id="f279" class="pw-post-body-paragraph kb kc hi kd b ke le kg kh ki lf kk kl km lg ko kp kq lh ks kt ku li kw kx ky hb bi translated"><strong class="kd hj">建筑特征</strong></p><p id="ebe9" class="pw-post-body-paragraph kb kc hi kd b ke le kg kh ki lf kk kl km lg ko kp kq lh ks kt ku li kw kx ky hb bi translated">既然我们已经设计了所需的日期时间特性，我们将致力于构建元数据特性。在使用这些功能之前，我们将首先根据仪表id将训练数据分成四个部分，也就是说，我们希望为每种仪表类型训练四个独立的模型。在根据仪表id分割数据时，我们还将使用log函数转换我们的目标变量(仪表读数)。</p><figure class="in io ip iq fd ir"><div class="bz dy l di"><div class="nw nx l"/></div><figcaption class="iy iz et er es ja jb bd b be z dx translated">根据仪表类型划分数据，并将对数转换应用于仪表读数</figcaption></figure><p id="e592" class="pw-post-body-paragraph kb kc hi kd b ke le kg kh ki lf kk kl km lg ko kp kq lh ks kt ku li kw kx ky hb bi translated">建筑物元数据主要涉及类别特征，如建筑物id、站点id和主要用途。为了对这些分类特征进行编码，我们将遵循留一个目标编码策略。</p><p id="c237" class="pw-post-body-paragraph kb kc hi kd b ke le kg kh ki lf kk kl km lg ko kp kq lh ks kt ku li kw kx ky hb bi translated"><strong class="kd hj">留一编码</strong>类似于均值目标编码，其中我们通过给定类别过滤的目标变量的均值对每个类别进行编码。然而，朴素均值目标编码的一个问题是，存在数据泄漏和过拟合问题的可能性。因此，为了避免遗漏编码中数据泄漏，对于给定类别中的给定观察，我们通过来自该类别中所有其他观察的目标变量来替换它，在计算平均值时忽略给定观察。它可以用数学方法表示如下:</p><figure class="in io ip iq fd ir er es paragraph-image"><div class="er es of"><img src="../Images/fb554d3371619233ab5af24e8d2f718f.png" data-original-src="https://miro.medium.com/v2/resize:fit:942/format:webp/1*JJwVdQA94aLoqvpTHdUg4A.jpeg"/></div></figure><p id="167a" class="pw-post-body-paragraph kb kc hi kd b ke le kg kh ki lf kk kl km lg ko kp kq lh ks kt ku li kw kx ky hb bi translated">此外，为了使其对过拟合和数据泄漏更加鲁棒，我们还向目标编码值添加高斯噪声。</p><figure class="in io ip iq fd ir er es paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><div class="er es og"><img src="../Images/7178b8a67b30d3c28d895ee2d0bd1a43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UinRDMdjg_cxUoDcat8QLA.jpeg"/></div></div><figcaption class="iy iz et er es ja jb bd b be z dx translated">省略一个编码示例</figcaption></figure><p id="f923" class="pw-post-body-paragraph kb kc hi kd b ke le kg kh ki lf kk kl km lg ko kp kq lh ks kt ku li kw kx ky hb bi translated">为了实现我们的遗漏编码策略，我们将借助<strong class="kd hj">类别编码器</strong>库。</p><figure class="in io ip iq fd ir"><div class="bz dy l di"><div class="nw nx l"/></div><figcaption class="iy iz et er es ja jb bd b be z dx translated">函数对分类特征进行编码</figcaption></figure></div><div class="ab cl if ig gp ih" role="separator"><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik"/></div><div class="hb hc hd he hf"><h1 id="2a88" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">系统模型化</h1><p id="b824" class="pw-post-body-paragraph kb kc hi kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky hb bi translated">现在，我们已经分析和理解了数据，执行了所需的数据处理/清理，并根据原始数据设计了特征，我们可以继续进行建模阶段。</p><p id="7648" class="pw-post-body-paragraph kb kc hi kd b ke le kg kh ki lf kk kl km lg ko kp kq lh ks kt ku li kw kx ky hb bi translated">由于我们已经对目标变量进行了对数转换，为了评估我们模型的性能，我们将使用RMSE指标。</p><figure class="in io ip iq fd ir er es paragraph-image"><div class="er es oh"><img src="../Images/4d6c89fa72da11eb3d09960cb3f8d378.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*JcLkd-1jsTXcVXMlrc_zsg.jpeg"/></div></figure><p id="5c08" class="pw-post-body-paragraph kb kc hi kd b ke le kg kh ki lf kk kl km lg ko kp kq lh ks kt ku li kw kx ky hb bi translated">对于我们试验的每个机器学习算法，我们将为每种仪表类型训练四个单独的模型。建模策略的可视化表示如下所示。</p><figure class="in io ip iq fd ir er es paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><div class="er es oi"><img src="../Images/ad866480c0273133e9900ccdaa8241c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ScqEm0bGfT6NCqZ49eCQoA.png"/></div></div></figure><h2 id="c716" class="mm je hi bd jf mn mo mp jj mq mr ms jn km mt mu jr kq mv mw jv ku mx my jz mz bi translated">基线模型</h2><p id="b397" class="pw-post-body-paragraph kb kc hi kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky hb bi translated">因为我们的性能指标是误差的平方，我们没有误差的上限，我们需要建立一个简单的基线模型，我们将所有测试仪表读数预测为列车仪表读数的平均值。然后，我们可以将我们实际的机器学习模型的性能与这个简单的基线模型的误差进行比较。只有当机器学习模型比这个简单的基线模型表现得更好时，我们才能得出结论，我们的模型已经能够从数据中学习一些模式。</p><figure class="in io ip iq fd ir"><div class="bz dy l di"><div class="nw nx l"/></div><figcaption class="iy iz et er es ja jb bd b be z dx translated">基线预测的代码片段</figcaption></figure><p id="9889" class="pw-post-body-paragraph kb kc hi kd b ke le kg kh ki lf kk kl km lg ko kp kq lh ks kt ku li kw kx ky hb bi translated">在Kaggle上上传基线预测导致在看不见的测试数据集上的性能下降。</p><figure class="in io ip iq fd ir er es paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><div class="er es oj"><img src="../Images/84505a43fe0ce3f0780c6d219d64ab85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AQxeFVBU062tg3O5m-Lv5Q.jpeg"/></div></div><figcaption class="iy iz et er es ja jb bd b be z dx translated">基线模型性能</figcaption></figure><h2 id="1ea3" class="mm je hi bd jf mn mo mp jj mq mr ms jn km mt mu jr kq mv mw jv ku mx my jz mz bi translated">单一型号</h2><p id="b0b1" class="pw-post-body-paragraph kb kc hi kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky hb bi translated">在本节中，我们将训练两个简单的机器学习模型，如下所示:</p><ol class=""><li id="3b75" class="ls lt hi kd b ke le ki lf km lu kq lv ku lw ky nz ly lz ma bi translated">线性回归</li><li id="1366" class="ls lt hi kd b ke mb ki mc km md kq me ku mf ky nz ly lz ma bi translated">决策树回归器</li></ol><p id="634e" class="pw-post-body-paragraph kb kc hi kd b ke le kg kh ki lf kk kl km lg ko kp kq lh ks kt ku li kw kx ky hb bi translated">对于这些模型中的每一个，我们将使用五重网格搜索验证策略来调整超参数。</p><figure class="in io ip iq fd ir"><div class="bz dy l di"><div class="nw nx l"/></div><figcaption class="iy iz et er es ja jb bd b be z dx translated">超参数调谐功能</figcaption></figure><p id="e67c" class="pw-post-body-paragraph kb kc hi kd b ke le kg kh ki lf kk kl km lg ko kp kq lh ks kt ku li kw kx ky hb bi translated">在交叉验证期间找到的最佳超参数上训练模型后，我们在Kaggle的测试数据集上测量性能，结果如下所示。</p><figure class="in io ip iq fd ir er es paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><div class="er es ok"><img src="../Images/dbbb39d480c43e6ba9253be165d80c72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TkP79L-2doxXbIQzuyPG7Q.jpeg"/></div></div><figcaption class="iy iz et er es ja jb bd b be z dx translated">线性回归(SGD)性能</figcaption></figure><figure class="in io ip iq fd ir er es paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><div class="er es ol"><img src="../Images/f1a7c6d0a2052e5f20985626b82c0a6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F0Or-Dp3lSe8dxo8B9URmQ.jpeg"/></div></div><figcaption class="iy iz et er es ja jb bd b be z dx translated">决策树回归器性能</figcaption></figure><h2 id="2a81" class="mm je hi bd jf mn mo mp jj mq mr ms jn km mt mu jr kq mv mw jv ku mx my jz mz bi translated">集合模型</h2><p id="2ccd" class="pw-post-body-paragraph kb kc hi kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky hb bi translated">既然我们已经用简单的单个模型进行了实验，我们将把重点放在用基于集合的模型进行训练上。这里的建模策略是相似的，即我们将为每种仪表类型训练一个单独的模型。然而，我们将稍微改变的一个方面是超参数优化。因为我们的数据集非常大，所以对于复杂的基于集合的模型来说，搜索CV的计算代价太高。因此，我们将使用一种称为<strong class="kd hj">贝叶斯优化</strong>的技术来调整超参数。</p><p id="e4df" class="pw-post-body-paragraph kb kc hi kd b ke le kg kh ki lf kk kl km lg ko kp kq lh ks kt ku li kw kx ky hb bi translated">GridSearch和RandomSearch CV的失败之处在于它们不能将以前的迭代(超参数选择)与未来的迭代联系起来。有可能他们花了很多时间试图评估不好的超参数。这就是<strong class="kd hj">贝叶斯优化</strong>的用武之地，因为它只关注最有希望的超参数。<strong class="kd hj">贝叶斯优化</strong>利用过去的信息为自己服务。因此，与其他基于网格的技术相比，它可以通过只关注重要的区域来节省时间。</p><p id="8c9f" class="pw-post-body-paragraph kb kc hi kd b ke le kg kh ki lf kk kl km lg ko kp kq lh ks kt ku li kw kx ky hb bi translated">为了使用贝叶斯优化调整超参数，我们将依赖一个名为<strong class="kd hj">hyperpt</strong><em class="lm">的库。</em></p><p id="6ecf" class="pw-post-body-paragraph kb kc hi kd b ke le kg kh ki lf kk kl km lg ko kp kq lh ks kt ku li kw kx ky hb bi translated">在这一节中，我们将实验以下众所周知的集成算法</p><ol class=""><li id="ce91" class="ls lt hi kd b ke le ki lf km lu kq lv ku lw ky nz ly lz ma bi translated">随机森林回归量</li><li id="67c6" class="ls lt hi kd b ke mb ki mc km md kq me ku mf ky nz ly lz ma bi translated">XGBoost回归器</li><li id="0326" class="ls lt hi kd b ke mb ki mc km md kq me ku mf ky nz ly lz ma bi translated">LGBM回归器</li></ol><figure class="in io ip iq fd ir"><div class="bz dy l di"><div class="nw nx l"/></div><figcaption class="iy iz et er es ja jb bd b be z dx translated">应用贝叶斯优化的每个算法的目标函数</figcaption></figure><p id="7cc8" class="pw-post-body-paragraph kb kc hi kd b ke le kg kh ki lf kk kl km lg ko kp kq lh ks kt ku li kw kx ky hb bi translated">从上面的代码片段可以看出，我们已经为每个集成算法定义了单独的目标函数。贝叶斯优化的目标是搜索整个参数网格，并找到使这些函数的得分或输出最小化的最佳参数。在我们的例子中，要最小化的分数只不过是前面描述的均方误差。</p><p id="d5ec" class="pw-post-body-paragraph kb kc hi kd b ke le kg kh ki lf kk kl km lg ko kp kq lh ks kt ku li kw kx ky hb bi translated">一旦我们为每个模型找到了最佳参数，我们就用它们来训练前面提到的每个集合模型。这些模型在看不见的数据上的表现可以在下面看到。</p><figure class="in io ip iq fd ir er es paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><div class="er es om"><img src="../Images/a533c84253e323fb3d42a657ede0de56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oDUgRyegqqmuGzZE6mM6Aw.png"/></div></div><figcaption class="iy iz et er es ja jb bd b be z dx translated">随机森林模型性能</figcaption></figure><figure class="in io ip iq fd ir er es paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><div class="er es on"><img src="../Images/217bf8e7092d2c8dfe1e9d4a36129304.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QyQxr5d7qLdsYSpmZl_caQ.png"/></div></div><figcaption class="iy iz et er es ja jb bd b be z dx translated">XGBoost模型性能</figcaption></figure><figure class="in io ip iq fd ir er es paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><div class="er es oo"><img src="../Images/978f3f64aac1bfce1e2587d9acc56c21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fQW-m9EevWN6UQH0UepZGg.png"/></div></div><figcaption class="iy iz et er es ja jb bd b be z dx translated">LGBM模型性能</figcaption></figure><h2 id="8f52" class="mm je hi bd jf mn mo mp jj mq mr ms jn km mt mu jr kq mv mw jv ku mx my jz mz bi translated">堆叠模型</h2><p id="ebdf" class="pw-post-body-paragraph kb kc hi kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky hb bi translated">堆叠模型使用多个基础模型的预测来预测目标变量。换句话说，所有基础模型的预测都被用作训练元模型的特征。下面的架构图和数学表达式展示了堆叠模型的工作原理。</p><figure class="in io ip iq fd ir er es paragraph-image"><div class="er es op"><img src="../Images/be591efe4c8e1191fbf6fbaa2ecbc6e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1394/format:webp/1*wyXJmPYijNAXu_UGBV2ZzA.png"/></div><figcaption class="iy iz et er es ja jb bd b be z dx translated">堆叠模型的架构</figcaption></figure><figure class="in io ip iq fd ir er es paragraph-image"><div class="er es oq"><img src="../Images/d67dd5e5b8e68ad55d9ffa9988cdf738.png" data-original-src="https://miro.medium.com/v2/resize:fit:1166/format:webp/1*defd1YybqrIdAk2NWVIEag.jpeg"/></div><figcaption class="iy iz et er es ja jb bd b be z dx translated">叠加模型的预测方程</figcaption></figure><p id="e9d5" class="pw-post-body-paragraph kb kc hi kd b ke le kg kh ki lf kk kl km lg ko kp kq lh ks kt ku li kw kx ky hb bi translated">对于我们的堆叠架构，我们将使用之前训练的集合模型Random Forest、XGBoost和LGBM作为基础模型。我们将再次使用LGBM作为我们的元模型，如下所示。</p><figure class="in io ip iq fd ir er es paragraph-image"><div class="er es or"><img src="../Images/608375e4193a220aabac23201a7e6da2.png" data-original-src="https://miro.medium.com/v2/resize:fit:802/format:webp/1*axns2LpANo8SEwSGNeIwJA.png"/></div><figcaption class="iy iz et er es ja jb bd b be z dx translated">集合模型的堆叠</figcaption></figure><figure class="in io ip iq fd ir"><div class="bz dy l di"><div class="nw nx l"/></div><figcaption class="iy iz et er es ja jb bd b be z dx translated">为堆叠模型准备数据</figcaption></figure><p id="99e6" class="pw-post-body-paragraph kb kc hi kd b ke le kg kh ki lf kk kl km lg ko kp kq lh ks kt ku li kw kx ky hb bi translated">元回归器的超参数，即LGBM，再次使用贝叶斯优化进行调整。下面可以观察到堆叠算法对不可见数据的性能。</p><figure class="in io ip iq fd ir er es paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><div class="er es os"><img src="../Images/4dd79cfdb7c0eb19e04981056c71eaee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3Em0tLLAprcw9F_9p4XaCA.png"/></div></div><figcaption class="iy iz et er es ja jb bd b be z dx translated">堆叠模型性能</figcaption></figure></div><div class="ab cl if ig gp ih" role="separator"><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik"/></div><div class="hb hc hd he hf"><h1 id="5013" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">汇总结果</h1><p id="f3c6" class="pw-post-body-paragraph kb kc hi kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky hb bi translated">下表总结了我们试验过的所有模型在不可见数据上的性能。</p><pre class="in io ip iq fd ot ou ov ow aw ox bi"><span id="998c" class="mm je hi ou b fi oy oz l pa pb">     +-------------------------+---------------+--------------+<br/>     |          Model          | Private Score | Public Score |<br/>     +-------------------------+---------------+--------------+<br/>     |         Baseline        |     2.355     |    2.089     |<br/>     |    Linear Regression    |     1.437     |    1.196     |<br/>     | Decision Tree Regressor |     1.365     |    1.195     |<br/>     | Random Forest Regressor |     1.381     |    1.206     |<br/>     |    XGBoost Regressor    |     1.325     |    1.142     |<br/>     |      LGBM Regressor     |     1.315     |    1.135     |<br/>     |      Stacking Model     |     1.341     |    1.169     |<br/>     +-------------------------+---------------+--------------+</span></pre><p id="18e2" class="pw-post-body-paragraph kb kc hi kd b ke le kg kh ki lf kk kl km lg ko kp kq lh ks kt ku li kw kx ky hb bi translated">从上表可以清楚地观察到，我们所有的机器学习模型都有比基线预测更好的结果。基于此，我们可以得出结论，我们的所有模型都能够学习能源消耗数据中的一些模式或相关性。</p><p id="3c68" class="pw-post-body-paragraph kb kc hi kd b ke le kg kh ki lf kk kl km lg ko kp kq lh ks kt ku li kw kx ky hb bi translated">总的来说，轻型GBM是所有其他型号中性能最好的。与LGBM回归器相比，堆叠模型的性能似乎有所下降。</p></div><div class="ab cl if ig gp ih" role="separator"><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik"/></div><div class="hb hc hd he hf"><h1 id="fef5" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">未来的工作</h1><figure class="in io ip iq fd ir er es paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><div class="er es pc"><img src="../Images/2d1937b7e32fa0624b2f6c50942be946.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K3955YJzvWGzJce1577Lmg.jpeg"/></div></div><figcaption class="iy iz et er es ja jb bd b be z dx translated">照片由<a class="ae jc" href="https://unsplash.com/@hjwinunsplsh" rel="noopener ugc nofollow" target="_blank"> Jungwoo Hong </a>在<a class="ae jc" href="https://unsplash.com/photos/cYUMaCqMYvI" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="8e95" class="pw-post-body-paragraph kb kc hi kd b ke le kg kh ki lf kk kl km lg ko kp kq lh ks kt ku li kw kx ky hb bi translated">我们可以通过尝试以下额外的想法来进一步改进性能指标:</p><ul class=""><li id="7233" class="ls lt hi kd b ke le ki lf km lu kq lv ku lw ky lx ly lz ma bi translated">在我们的功能工程部分，我们可以创建增强的基于天气的功能，例如相对湿度，它会影响能耗水平</li><li id="a07a" class="ls lt hi kd b ke mb ki mc km md kq me ku mf ky lx ly lz ma bi translated">我们目前只研究了涉及机器学习算法的方法。此外，我们可以探索各种深度学习方法。</li><li id="3ec7" class="ls lt hi kd b ke mb ki mc km md kq me ku mf ky lx ly lz ma bi translated">目前，对于每个机器算法，我们只训练4个模型(每个仪表类型一个)。我们可以考虑为数据集中的每个不同建筑训练多个模型的可能性。</li></ul></div><div class="ab cl if ig gp ih" role="separator"><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik"/></div><div class="hb hc hd he hf"><h1 id="19a5" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">参考</h1><ol class=""><li id="b1f2" class="ls lt hi kd b ke kf ki kj km pd kq pe ku pf ky nz ly lz ma bi translated">【https://www.appliedaicourse.com/】T5<a class="ae jc" href="https://www.appliedaicourse.com/" rel="noopener ugc nofollow" target="_blank">T6</a></li><li id="f705" class="ls lt hi kd b ke mb ki mc km md kq me ku mf ky nz ly lz ma bi translated"><a class="ae jc" href="https://www.kaggle.com/c/ashrae-energy-prediction" rel="noopener ugc nofollow" target="_blank"><em class="lm">https://www.kaggle.com/c/ashrae-energy-prediction</em></a></li><li id="60dd" class="ls lt hi kd b ke mb ki mc km md kq me ku mf ky nz ly lz ma bi translated"><a class="ae jc" href="https://www.ashrae.org/" rel="noopener ugc nofollow" target="_blank"><em class="lm">https://www.ashrae.org/</em></a></li><li id="659f" class="ls lt hi kd b ke mb ki mc km md kq me ku mf ky nz ly lz ma bi translated"><a class="ae jc" href="https://contrib.scikit-learn.org/category_encoders/" rel="noopener ugc nofollow" target="_blank"><em class="lm">https://contrib.scikit-learn.org/category_encoders/</em></a></li><li id="859f" class="ls lt hi kd b ke mb ki mc km md kq me ku mf ky nz ly lz ma bi translated"><a class="ae jc" href="http://hyperopt.github.io/hyperopt/" rel="noopener ugc nofollow" target="_blank">http://hyperopt.github.io/hyperopt/T21</a></li></ol><div class="ne nf ez fb ng nh"><a href="https://www.linkedin.com/in/mohammedzoher/" rel="noopener  ugc nofollow" target="_blank"><div class="ni ab dw"><div class="nj ab nk cl cj nl"><h2 class="bd hj fi z dy nm ea eb nn ed ef hh bi translated">Mohammed z .-Rubik on实验室的初级数据科学家| LinkedIn</h2><div class="no l"><h3 class="bd b fi z dy nm ea eb nn ed ef dx translated">在世界上最大的职业社区LinkedIn上查看Mohammed Z的个人资料。穆罕默德有两个工作列在他们的…</h3></div><div class="np l"><p class="bd b fp z dy nm ea eb nn ed ef dx translated">www.linkedin.com</p></div></div></div></a></div></div></div>    
</body>
</html>