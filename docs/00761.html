<html>
<head>
<title>Implementing a TinyMCE URL Dialog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">实现TinyMCE URL对话框</h1>
<blockquote>原文：<a href="https://medium.com/codex/implementing-a-tinymce-url-dialog-a8419d09c1c6?source=collection_archive---------4-----------------------#2021-03-17">https://medium.com/codex/implementing-a-tinymce-url-dialog-a8419d09c1c6?source=collection_archive---------4-----------------------#2021-03-17</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><h2 id="6587" class="hg hh hi bd b fp hj hk hl hm hn ho dx hp translated" aria-label="kicker paragraph"><a class="ae ge" href="http://medium.com/codex" rel="noopener">法典</a></h2><div class=""/><figure class="ev ex ip iq ir is er es paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="er es io"><img src="../Images/cdfef576849021a1f988730fa4cf01c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_rsXrdGVio_uGh1MOZ8gng.png"/></div></div></figure><p id="32ea" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">URL对话框是用来显示外部网页的TinyMCE UI组件。这些对话框用于标准TinyMCE插件和对话框不能满足需要的场景。URL对话框中显示的外部页面可能位于与TinyMCE父页面完全不同的域中。</p><figure class="jy jz ka kb fd is er es paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="er es jx"><img src="../Images/871fbcd11e345a443dd51b2dd7dd894b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qf2UWPWTqzpEv_FWnNQsyQ.png"/></div></div><figcaption class="kc kd et er es ke kf bd b be z dx translated"><strong class="bd kg">图1: </strong>带有TinyMCE编辑器和URL对话框的网页</figcaption></figure><h1 id="5c20" class="kh ki hi bd kg kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">沟通</h1><p id="18a8" class="pw-post-body-paragraph iz ja hi jb b jc le je jf jg lf ji jj jk lg jm jn jo lh jq jr js li ju jv jw hb bi translated">TinyMCE编辑器和外部页面之间的消息传递是用JavaScript通过<a class="ae lj" href="https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage" rel="noopener ugc nofollow" target="_blank">window . postmessage</a><strong class="jb hs">()</strong>方法完成的，该方法允许窗口对象之间的跨源通信。</p><figure class="jy jz ka kb fd is er es paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="er es jx"><img src="../Images/1edd0732a092830a65d16b84e7e56d62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F62twSN43AfeIBTSJHd8QQ.png"/></div></div><figcaption class="kc kd et er es ke kf bd b be z dx translated"><strong class="bd kg">图2</strong>:TinyMCE与外部页面之间的消息传递</figcaption></figure><p id="f52d" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">为了理解本文的其余部分，您可能希望<a class="ae lj" href="https://jeffholst.github.io/tinymce-url-dialog/index.html" rel="noopener ugc nofollow" target="_blank">打开演示应用程序</a>并从<a class="ae lj" href="https://github.com/jeffholst/tinymce-url-dialog" rel="noopener ugc nofollow" target="_blank"> GitHub </a>下载源代码。</p><p id="5999" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated"><strong class="jb hs">从GitHub克隆演示应用</strong></p><pre class="jy jz ka kb fd lk ll lm ln aw lo bi"><span id="0899" class="lp ki hi ll b fi lq lr l ls lt">$ git clone <a class="ae lj" href="https://github.com/jeffholst/tinymce-url-dialog" rel="noopener ugc nofollow" target="_blank">https://github.com/jeffholst/tinymce-url-dialog</a><br/>$ cd tinymce-url-dialog</span></pre><p id="fca4" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated"><strong class="jb hs"> tinymce-url-dialog </strong>文件夹现在应该包含以下文件:</p><ul class=""><li id="ebb5" class="lu lv hi jb b jc jd jg jh jk lw jo lx js ly jw lz ma mb mc bi translated"><strong class="jb hs"> README.md </strong></li><li id="94e7" class="lu lv hi jb b jc md jg me jk mf jo mg js mh jw lz ma mb mc bi translated"><strong class="jb hs">. js</strong></li><li id="672d" class="lu lv hi jb b jc md jg me jk mf jo mg js mh jw lz ma mb mc bi translated"><strong class="jb hs">index.html</strong></li><li id="8c7d" class="lu lv hi jb b jc md jg me jk mf jo mg js mh jw lz ma mb mc bi translated"><strong class="jb hs">dialog.html</strong></li></ul><h1 id="793a" class="kh ki hi bd kg kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">演示演练</h1><ol class=""><li id="b210" class="lu lv hi jb b jc le jg lf jk mi jo mj js mk jw ml ma mb mc bi translated">在网络浏览器中打开<strong class="jb hs">index.html</strong>文件</li><li id="3020" class="lu lv hi jb b jc md jg me jk mf jo mg js mh jw ml ma mb mc bi translated">点击TinyMCE工具栏中的<strong class="jb hs">打开URL对话框</strong>按钮，打开一个新的对话框窗口</li><li id="a2ff" class="lu lv hi jb b jc md jg me jk mf jo mg js mh jw ml ma mb mc bi translated">在<strong class="jb hs"> URL对话框</strong>中点击<strong class="jb hs">获取TinyMCE内容</strong>按钮来检索<strong class="jb hs">“Hello，World！”</strong>父TinyMCE编辑器的内容</li><li id="e534" class="lu lv hi jb b jc md jg me jk mf jo mg js mh jw ml ma mb mc bi translated">在<strong class="jb hs"> URL对话框</strong>中，更新文本区域，说<strong class="jb hs">“你好，银河！”</strong>而不是<strong class="jb hs">“你好，世界！”</strong></li><li id="f12a" class="lu lv hi jb b jc md jg me jk mf jo mg js mh jw ml ma mb mc bi translated">在<strong class="jb hs"> URL对话框</strong>中点击<strong class="jb hs">设置TinyMCE内容</strong>按钮，用新消息更新父TinyMCE</li><li id="0a4e" class="lu lv hi jb b jc md jg me jk mf jo mg js mh jw ml ma mb mc bi translated">点击右上角的<strong class="jb hs"> X </strong>关闭<strong class="jb hs"> URL对话框</strong></li><li id="151f" class="lu lv hi jb b jc md jg me jk mf jo mg js mh jw ml ma mb mc bi translated">TinyMCE内容现在应该说<strong class="jb hs">“你好，银河！”</strong></li></ol><figure class="jy jz ka kb fd is er es paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="er es mm"><img src="../Images/3202459e142edca22b1bfa1ef7de4025.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*NiK8xbTGpV5cia3_NRp2tQ.gif"/></div></div><figcaption class="kc kd et er es ke kf bd b be z dx translated"><strong class="bd kg">图3 </strong>:演示演练</figcaption></figure><h1 id="dcaf" class="kh ki hi bd kg kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">概观</h1><p id="4bd3" class="pw-post-body-paragraph iz ja hi jb b jc le je jf jg lf ji jj jk lg jm jn jo lh jq jr js li ju jv jw hb bi translated"><strong class="jb hs"> main.js </strong></p><p id="eb13" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">为了简化这个演示，index.html和dialog.html使用的所有JavaScript都包含在文件中。</p><p id="8404" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated"><strong class="jb hs">index.html</strong></p><p id="49fa" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">这是项目的起始页，包含TinyMCE编辑器。一旦页面加载到浏览器中，就会调用<strong class="jb hs">main.js/initializeParent</strong>()函数。</p><figure class="jy jz ka kb fd is er es paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="er es mn"><img src="../Images/b1c1636c8bf527a18c09f4ddfa58a4a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2y92d71iOGTWPRSQ9lVSTg.png"/></div></div><figcaption class="kc kd et er es ke kf bd b be z dx translated">图四:index.html<strong class="bd kg"/></figcaption></figure><p id="d8c2" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">main.js/initializeParent的<strong class="jb hs"/>()函数用这些关键特性初始化TinyMCE:</p><ul class=""><li id="351e" class="lu lv hi jb b jc jd jg jh jk lw jo lx js ly jw lz ma mb mc bi translated">TinyMCE工具栏上增加了一个<strong class="jb hs">打开URL对话框</strong>按钮</li><li id="5646" class="lu lv hi jb b jc md jg me jk mf jo mg js mh jw lz ma mb mc bi translated">点击<strong class="jb hs">打开URL对话框</strong>按钮触发<strong class="jb hs"> onAction </strong>()函数，并在模态窗口中打开外部<strong class="jb hs">dialog.html</strong>文件</li><li id="eace" class="lu lv hi jb b jc md jg me jk mf jo mg js mh jw lz ma mb mc bi translated">添加了<strong class="jb hs"> onMessage </strong>()函数来监听来自外部页面的消息</li><li id="694c" class="lu lv hi jb b jc md jg me jk mf jo mg js mh jw lz ma mb mc bi translated"><strong class="jb hs"> sendMessage </strong> () API调用用于将消息从TinyMCE发送到外部页面。</li></ul><figure class="jy jz ka kb fd is er es paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="er es mo"><img src="../Images/acba3849246178680966a5dca445ba4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bjgudmE4asQp4zkpIuokaA.png"/></div></div><figcaption class="kc kd et er es ke kf bd b be z dx translated"><strong class="bd kg">图5</strong>:tiny MCE的main.js初始化</figcaption></figure><p id="8774" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated"><strong class="jb hs">dialog.html</strong></p><p id="25fb" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">当在TinyMCE编辑器中点击<strong class="jb hs">打开URL对话框</strong>按钮时，外部<strong class="jb hs">dialog.html</strong>显示为URL对话框。一旦页面加载到浏览器中，就会调用<strong class="jb hs">main.js/initializeDialog</strong>()JavaScript函数。</p><figure class="jy jz ka kb fd is er es paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="er es mp"><img src="../Images/481c9e5afbab854988a8adb574360485.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rTAsGm8bJxxtuL3mMN682g.png"/></div></div><figcaption class="kc kd et er es ke kf bd b be z dx translated"><strong class="bd kg">图六</strong>:dialog.html</figcaption></figure><p id="3a73" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated"><strong class="jb hs">main.js/initializeDialog</strong>()函数的关键特性是在页面中添加一个<a class="ae lj" href="https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener" rel="noopener ugc nofollow" target="_blank">window . addevent listener</a>()函数来<em class="mq">监听</em>来自TinyMCE父窗口的消息。</p><figure class="jy jz ka kb fd is er es paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="er es mr"><img src="../Images/6597e3c1edd3ccd7725cf258aa65df1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YnrsjKfoqssfWd3iOLewYw.png"/></div></div><figcaption class="kc kd et er es ke kf bd b be z dx translated"><strong class="bd kg">图7 </strong> : main.js添加window.addEventListener()到页面</figcaption></figure><pre class="jy jz ka kb fd lk ll lm ln aw lo bi"><span id="be7c" class="lp ki hi ll b fi lq lr l ls lt">The <a class="ae lj" href="https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener" rel="noopener ugc nofollow" target="_blank">window.addEventListener</a>() function is responsible for checking the received <strong class="ll hs">event.origin</strong> to verify it should be accepted and then needs to examine the <strong class="ll hs">event.data</strong> to determine what to do.</span></pre><p id="5448" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">外部<strong class="jb hs">dialog.html</strong>页面通过调用<strong class="jb hs">main.js/sendMessage</strong>()函数中的<a class="ae lj" href="https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage" rel="noopener ugc nofollow" target="_blank">window . parent . postmessage</a>向父TinyMCE发送消息。</p><figure class="jy jz ka kb fd is er es paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="er es ms"><img src="../Images/acdd343fe1384b399c356cd8ea4c8733.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZpogNmp32_xjvFZ4W_e4cQ.png"/></div></div><figcaption class="kc kd et er es ke kf bd b be z dx translated"><strong class="bd kg">图8 </strong> : main.js — sendMessage()</figcaption></figure><pre class="jy jz ka kb fd lk ll lm ln aw lo bi"><span id="84de" class="lp ki hi ll b fi lq lr l ls lt"><strong class="ll hs">Syntax</strong>: <a class="ae lj" href="https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage" rel="noopener ugc nofollow" target="_blank">window.parent.postMessage</a>(message, targetOrigin)</span><span id="86d1" class="lp ki hi ll b fi mt lr l ls lt"><strong class="ll hs">message</strong>: data sent to parent window</span><span id="e4a2" class="lp ki hi ll b fi mt lr l ls lt"><strong class="ll hs">targetOrigin: </strong>specifies what the origin of the parent window must be to dispatch the event.  Wildcard(*) indicates no preference otherwise the scheme, hostname, and port of the specified origin must match for the event to be dispatched</span></pre><h1 id="8061" class="kh ki hi bd kg kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">交流流程</h1><figure class="jy jz ka kb fd is er es paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="er es mu"><img src="../Images/b2f777392cc639815d933b423e27ce3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DfwDq0eU9-g4ybg_bfBMfA.png"/></div></div><figcaption class="kc kd et er es ke kf bd b be z dx translated"><strong class="bd kg">图9 </strong>:通信流程</figcaption></figure><h1 id="8b6a" class="kh ki hi bd kg kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">结论</h1><p id="d107" class="pw-post-body-paragraph iz ja hi jb b jc le je jf jg lf ji jj jk lg jm jn jo lh jq jr js li ju jv jw hb bi translated">要获得额外的例子和查看TinyMCE URL对话框的所有配置选项，请务必查看<a class="ae lj" href="https://www.tiny.cloud/docs/ui-components/urldialog/#urldialogconfiguration" rel="noopener ugc nofollow" target="_blank">官方文档</a>。</p></div><div class="ab cl mv mw gp mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="hb hc hd he hf"><h1 id="9519" class="kh ki hi bd kg kj nc kl km kn nd kp kq kr ne kt ku kv nf kx ky kz ng lb lc ld bi translated">参考</h1><ul class=""><li id="a0f2" class="lu lv hi jb b jc le jg lf jk mi jo mj js mk jw lz ma mb mc bi translated"><a class="ae lj" href="https://jeffholst.github.io/tinymce-url-dialog/index.html" rel="noopener ugc nofollow" target="_blank">演示链接</a></li><li id="b102" class="lu lv hi jb b jc md jg me jk mf jo mg js mh jw lz ma mb mc bi translated"><a class="ae lj" href="https://github.com/jeffholst/tinymce-url-dialog" rel="noopener ugc nofollow" target="_blank"> GitHub资源库</a></li><li id="6410" class="lu lv hi jb b jc md jg me jk mf jo mg js mh jw lz ma mb mc bi translated">【TinyMCE入门</li><li id="ee6f" class="lu lv hi jb b jc md jg me jk mf jo mg js mh jw lz ma mb mc bi translated"><a class="ae lj" href="https://www.tiny.cloud/docs/ui-components/urldialog/" rel="noopener ugc nofollow" target="_blank"> TinyMCE Docs | URL对话框</a></li></ul></div></div>    
</body>
</html>