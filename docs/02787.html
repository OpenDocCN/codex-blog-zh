<html>
<head>
<title>Deploying a Rack app to Heroku</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将机架应用程序部署到Heroku</h1>
<blockquote>原文：<a href="https://medium.com/codex/deploying-a-rack-app-to-heroku-6d160b14904c?source=collection_archive---------12-----------------------#2021-08-05">https://medium.com/codex/deploying-a-rack-app-to-heroku-6d160b14904c?source=collection_archive---------12-----------------------#2021-08-05</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/edf8ec9261916b5b8616e07ca3a393e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zOmlX_YQko_-_6JV0Ai_XQ.png"/></div></div></figure><p id="f9e4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我最近在Heroku上部署了我的第一个Rack应用。这个过程并不简单，在这个过程中，我遇到了许多问题/错误。因为Rack不像Rails那样常用，所以我很难找到关于部署Rack应用程序的信息。在从开发数据库(SQLite)切换到生产数据库(Heroku使用的PostgreSQL)时，我也有些纠结。然而，我确实成功地将我的应用程序部署到了Heroku，所以我想我应该将我采取的步骤作为一个(有点长的)教程来分享！</p><h1 id="19ed" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">步骤1:安装所需的软件</h1><p id="994c" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">如果你和我或我的开发人员朋友一样，你可能非常渴望开始这个过程，以至于你浏览了教程的开头，却错过了完成最重要的步骤1。不要像我一样，你以后会省去一些头疼的事情！</p><p id="5874" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">打开终端并导航到您的主目录。我们将安装一些东西，我将使用的命令假设你在Mac上(使用非M1芯片；如果你的设置和我的不同，你必须做一些额外的谷歌搜索来找到正确的命令。</p><p id="d813" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先，运行<code class="du kr ks kt ku b">brew install postgresql</code>。这是我们将要切换到的数据库(假设您像我一样在开发中使用SQLite)。安装完成后，运行<code class="du kr ks kt ku b">brew services start postgresql</code>在您的计算机上开始运行数据库服务器(这对以后非常重要！)</p><p id="7544" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">接下来，运行<code class="du kr ks kt ku b">brew install pgloader</code>。这将帮助我们将数据从SQLite数据库移动到PostgreSQL数据库。</p><p id="0f74" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最后运行<code class="du kr ks kt ku b">brew tap heroku/brew &amp;&amp; brew install heroku</code>。稍后我们将使用Heroku CLI进行部署。</p><h1 id="acaa" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">步骤2:备份您的SQLite数据库</h1><p id="2675" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">继续前进，导航到项目目录的根目录，并在您喜欢的代码编辑器中打开它。找到你的数据库文件(应该是类似于<code class="du kr ks kt ku b">&lt;your-database-name&gt;.sqlite3</code>的东西)，复制并粘贴到同一个目录中。您可以将副本重命名为类似于<code class="du kr ks kt ku b">&lt;your-database-name-backup&gt;.sqlite3</code>的名称。现在你有一个备份副本，以防发生什么事情！</p><h1 id="03d0" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">第3步:配置你的<code class="du kr ks kt ku b">database.yml</code>文件</h1><p id="189b" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">这是重要的一步，因为我已经看到了许多关于如何正确配置这个文件的变体(并不是所有的都适合我)。我首先注释掉文件中的任何现有代码，这是我使用的代码(大致符合Heroku为Rails应用程序推荐的代码):</p><pre class="kv kw kx ky fd kz ku la lb aw lc bi"><span id="39a1" class="ld jp hi ku b fi le lf l lg lh"># database.yml file</span><span id="d853" class="ld jp hi ku b fi li lf l lg lh"># Swap &lt;app-name&gt; for whatever your project's name is (without the '&lt;&gt;')</span><span id="f7a0" class="ld jp hi ku b fi li lf l lg lh">default: &amp;default<br/> adapter: postgresql<br/> encoding: unicode<br/> pool: 5</span><span id="2aca" class="ld jp hi ku b fi li lf l lg lh">development:<br/> &lt;&lt;: *default<br/> database: &lt;app-name&gt;_dev</span><span id="3f3c" class="ld jp hi ku b fi li lf l lg lh">test:<br/> &lt;&lt;: *default<br/> database: &lt;app-name&gt;_test</span><span id="d169" class="ld jp hi ku b fi li lf l lg lh">production:<br/> &lt;&lt;: *default<br/> database: &lt;app-name&gt;</span></pre><h1 id="1ddd" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">步骤4:设置PostgreSQL数据库</h1><p id="22d6" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">在终端中导航到您的项目的根目录，如果您不在那里，然后运行<code class="du kr ks kt ku b">rake db:setup</code>。这将创建我们在<code class="du kr ks kt ku b">database.yml</code>文件中概述的数据库。如果您在这里遇到错误，请确保您完成了上面最重要的步骤1(特别是运行<code class="du kr ks kt ku b">brew services start postgresql</code>的部分)。</p><p id="0847" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一旦创建了数据库，运行<code class="du kr ks kt ku b">pgloader ./db/development.sqlite3 postgresql:///&lt;app-name&gt;_dev</code>(使用您在<code class="du kr ks kt ku b">database.yml</code>文件中命名的开发数据库)。这将把数据从SQLite数据库移动到新创建的PostgreSQL数据库。</p><h1 id="05a2" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">步骤5:配置您的Gemfile</h1><p id="4bf4" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">这是另一个重要的步骤，因为我最初缺少一个gem，并在尝试部署时以一个恼人的错误结束。不要像我一样，现在就配置您的Gemfile，然后再尝试部署！</p><figure class="kv kw kx ky fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lj"><img src="../Images/7f79658ed79ad7b1a805736995c01612.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QRW93mYH4GpCQgN1IUazHA.png"/></div></div><figcaption class="lk ll et er es lm ln bd b be z dx translated">我犯了一个令人讨厌的错误。你可能会认为这是因为我没有在我的gem文件中包含gem 'concurrent-ruby'。事实上，我错过了“耙子”宝石。谢谢，超级有用的错误信息！</figcaption></figure><p id="3a05" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在您的终端中，确保您在项目的根目录中。运行<code class="du kr ks kt ku b">bundle add pg</code>，完成后运行<code class="du kr ks kt ku b">bundle add rake</code>。使用<code class="du kr ks kt ku b">bundle add</code>命令不仅可以安装所需的gem，还可以将它们及其版本号自动添加到您的gem文件中。</p><p id="640d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">还有，我们不应该再需要宝石了。继续从gem文件中删除它，然后运行<code class="du kr ks kt ku b">bundle install</code>。</p><p id="5cdf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">另一个注意事项:Heroku(以及许多其他在线教程)建议将您的Ruby版本添加到Gemfile中。对我来说，这不起作用。当我这样做的时候，我结束了更多的错误，所以如果你正在部署一个Rack应用程序，我会首先尝试<em class="lo">而不是</em>添加它。如果遇到麻烦，被要求在Gemfile中指定一个Ruby版本，您可以随时返回到这一步并添加它。</p><h1 id="d48c" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">第6步:检查本地的一切工作正常</h1><p id="71e2" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">好了，关键时刻到了！在您的终端中，运行<code class="du kr ks kt ku b">shotgun</code>命令(或您用来启动Rack server的任何命令)，并检查您是否可以在<a class="ae lp" href="http://localhost:9393" rel="noopener ugc nofollow" target="_blank"> http://localhost:9393 </a>(或您正在使用的任何端口)访问您的应用程序。它应该在这一点上工作，使用PostgreSQL数据库。如果没有，请尝试再次执行前面的步骤，并在谷歌上搜索您得到的错误。</p><h1 id="bd15" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">第7步:提交您的更改！</h1><p id="66e3" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">一切都在本地工作，这很好，但是我们需要实际地提交这些更改！首先，你可以通过按<code class="du kr ks kt ku b">Control-C</code>来杀死机架式服务器。我假设您已经在项目中设置了git，所以只需运行<code class="du kr ks kt ku b">git add .</code>然后运行<code class="du kr ks kt ku b">git commit -m “&lt;your-message-here&gt;”</code>。您可以通过运行<code class="du kr ks kt ku b">git status</code>来仔细检查所有的事情都被提交了，并且您在您的主分支上。</p><h1 id="1c42" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">步骤8:创建一个新的Heroku应用程序</h1><p id="d107" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">在你的终端里，运行<code class="du kr ks kt ku b">heroku login</code>。应该会在新的浏览器窗口中提示您登录您的帐户。成功登录后，确保您仍然在项目的根目录中。然后，运行<code class="du kr ks kt ku b">heroku create</code>。这将为您创建一个新的应用程序。</p><p id="fdb0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">创建Heroku应用程序后，运行<code class="du kr ks kt ku b">git config --list | grep heroku</code>。此命令为您的项目创建新的远程控件。现在，运行<code class="du kr ks kt ku b">git push heroku main</code>。当东西被取出并安装到Heroku应用程序中时，你会在终端中收到一条很长的消息。如果它成功了，你会在最后看到这样的东西:</p><pre class="kv kw kx ky fd kz ku la lb aw lc bi"><span id="7a6d" class="ld jp hi ku b fi le lf l lg lh">remote: Verifying deploy... done.<br/>To <a class="ae lp" href="https://git.heroku.com/secret-tor-42278.git" rel="noopener ugc nofollow" target="_blank">https://git.heroku.com/secret-tor-42278.git</a><br/>* [new branch] main -&gt; main</span></pre><p id="ec38" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们快完成了！你只需要运行命令<code class="du kr ks kt ku b">heroku run rake db:migrate</code>，只要你没有得到错误，你应该是好的！</p><p id="6c7d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">完成后，您可以通过运行<code class="du kr ks kt ku b">heroku open</code>来访问您部署的应用程序。</p><p id="67ed" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">恭喜你！您刚刚将Rack应用程序部署到Heroku！</p><h2 id="aa67" class="ld jp hi bd jq lq lr ls ju lt lu lv jy jb lw lx kc jf ly lz kg jj ma mb kk mc bi translated">资源</h2><p id="e5a9" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">顺便说一句，我非常依赖<a class="ae lp" href="https://stackoverflow.com/a/51068611" rel="noopener ugc nofollow" target="_blank"> Dan William的StackOverflow答案</a>和<a class="ae lp" href="https://devcenter.heroku.com/articles/getting-started-with-rails5" rel="noopener ugc nofollow" target="_blank"> Heroku的Rails文档</a>，不仅是为了部署我的应用程序，也是为了编写本教程！</p></div></div>    
</body>
</html>