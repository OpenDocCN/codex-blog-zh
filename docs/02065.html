<html>
<head>
<title>PDF Manipulation Application Part 1 — Creating an application using Streamlit and PDFRW</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">PDF操作应用程序第1部分—使用Streamlit和PDFRW创建应用程序</h1>
<blockquote>原文：<a href="https://medium.com/codex/pdf-manipulation-application-using-streamlit-and-pdfrw-917a1f89bf5a?source=collection_archive---------5-----------------------#2021-06-27">https://medium.com/codex/pdf-manipulation-application-using-streamlit-and-pdfrw-917a1f89bf5a?source=collection_archive---------5-----------------------#2021-06-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/></div><div class="ab cl if ig gp ih" role="separator"><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik"/></div><div class="hb hc hd he hf"><blockquote class="im in io"><p id="da7a" class="ip iq ir is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">使用python library Streamlit在交互式web应用程序中添加水印功能、删除元数据，甚至将不同的Doc/Docx/PDF文件连接在一起。</p></blockquote><figure class="jp jq jr js fd jt er es paragraph-image"><div class="er es jo"><img src="../Images/bc693738ac40b59cb07b78fd875789e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/1*b1AZYKl913t0VdZZ3lRagg.png"/></div></figure><h1 id="ea21" class="jw jx hi bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">为什么选择Streamlit？</h1><p id="5372" class="pw-post-body-paragraph ip iq hi is b it ku iv iw ix kv iz ja kw kx jd je ky kz jh ji la lb jl jm jn hb bi translated">Streamlit可在几分钟内将数据脚本转化为可共享的web应用程序[1]。最重要的是，不需要前端经验。通过Streamlit，该应用程序能够获得用户对其要求和输入的输入，以便为他们定制解决方案。这无疑也让它对用户更有吸引力！</p><h1 id="b0d9" class="jw jx hi bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">本申请的目的</h1><p id="9cc0" class="pw-post-body-paragraph ip iq hi is b it ku iv iw ix kv iz ja kw kx jd je ky kz jh ji la lb jl jm jn hb bi translated">此脚本利用软件包Streamlit和PDFRW来添加水印、删除元数据或连接PDF或文档(Doc/Docx ),并将它们输出到单个PDF或单个PDF(如果选择了连接选项)。</p><p id="21a8" class="pw-post-body-paragraph ip iq hi is b it iu iv iw ix iy iz ja kw jc jd je ky jg jh ji la jk jl jm jn hb bi translated">虽然有许多解决方案可以轻松解决这个问题，但python包PDFRW上的解决方案并不多，当然也没有多少将该解决方案与Streamlit提供的优秀接口相结合。</p><h1 id="8f58" class="jw jx hi bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">简化应用程序的界面</h1><figure class="jp jq jr js fd jt er es paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="er es lc"><img src="../Images/c3d1b9f1d735ef18f6bfe8fcff41a519.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Yxl7EOwtPY0XV2XxQwMthQ.png"/></div></div><figcaption class="lh li et er es lj lk bd b be z dx translated">接口和可能配置的示例</figcaption></figure><h1 id="2b02" class="jw jx hi bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">应用程序的特征</h1><p id="d5f9" class="pw-post-body-paragraph ip iq hi is b it ku iv iw ix kv iz ja kw kx jd je ky kz jh ji la lb jl jm jn hb bi translated">这个web应用程序是根据我的个人需求建立的:(1)合并页眉和页脚；(2)将doc/docx转换成PDF以及(3)将“修正”文档连接在一起成为一个PDF的选项。</p><p id="ba72" class="pw-post-body-paragraph ip iq hi is b it iu iv iw ix iy iz ja kw jc jd je ky jg jh ji la jk jl jm jn hb bi translated"><strong class="is hj">水印文档(包含页眉和页脚)</strong></p><p id="4686" class="pw-post-body-paragraph ip iq hi is b it iu iv iw ix iy iz ja kw jc jd je ky jg jh ji la jk jl jm jn hb bi translated">目前，水印功能是通过在实际的PDF上叠加另一个包含水印的PDF来实现的。它有两个版本，风景和肖像。如果选择了水印功能，用户必须拖放这些文件。脚本将自动检测PDF的方向，并在PDF上加入正确的水印。</p><p id="3cf2" class="pw-post-body-paragraph ip iq hi is b it iu iv iw ix iy iz ja kw jc jd je ky jg jh ji la jk jl jm jn hb bi translated"><strong class="is hj">输入路径(doc/docx只能在此选项上运行)与手动输入文件</strong></p><p id="b6fb" class="pw-post-body-paragraph ip iq hi is b it iu iv iw ix iy iz ja kw jc jd je ky jg jh ji la jk jl jm jn hb bi translated">对于“输入路径”选项，用户必须输入文件夹的路径，脚本将考虑该文件夹中的PDF和doc/docx文件。</p><p id="ee97" class="pw-post-body-paragraph ip iq hi is b it iu iv iw ix iy iz ja kw jc jd je ky jg jh ji la jk jl jm jn hb bi translated">对于“手动输入文件”选项，用户只需将所需文件拖放到下拉框中。这个选项的缺点是它只支持PDF文件，但是可以一次处理多个文件。</p><p id="187e" class="pw-post-body-paragraph ip iq hi is b it iu iv iw ix iy iz ja kw jc jd je ky jg jh ji la jk jl jm jn hb bi translated"><strong class="is hj">串联vs非串联</strong></p><p id="2399" class="pw-post-body-paragraph ip iq hi is b it iu iv iw ix iy iz ja kw jc jd je ky jg jh ji la jk jl jm jn hb bi translated">如果选择了“连接”选项，所有pdf将在规定的输出路径中保存为一个PDF调用“Annex.pdf”。如果未选择该选项，单个PDF将输出为“附件X.pdf，附件X.pdf，…，附件X.pdf”</p><h1 id="631e" class="jw jx hi bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">此web应用程序未来可能的改进</h1><p id="8dec" class="pw-post-body-paragraph ip iq hi is b it ku iv iw ix kv iz ja kw kx jd je ky kz jh ji la lb jl jm jn hb bi translated">虽然这个web应用程序确实满足了我当前的需求，但我确实看到了许多可以实现的潜在改进，以便将这个应用程序带到下一个级别。</p><p id="5e99" class="pw-post-body-paragraph ip iq hi is b it iu iv iw ix iy iz ja kw jc jd je ky jg jh ji la jk jl jm jn hb bi translated"><strong class="is hj">合并其他文件类型</strong></p><p id="8a77" class="pw-post-body-paragraph ip iq hi is b it iu iv iw ix iy iz ja kw jc jd je ky jg jh ji la jk jl jm jn hb bi translated">对于starter，如果用户选择“输入路径”选项，该web应用程序只能接受doc/docx文件类型，脚本将在该路径中搜索所有doc/docx和pdf文件进行操作。</p><p id="6a66" class="pw-post-body-paragraph ip iq hi is b it iu iv iw ix iy iz ja kw jc jd je ky jg jh ji la jk jl jm jn hb bi translated">其次，这种功能应该能够复制到其他文件类型，如excel或txt。尽管这个特性的有用性可能并不是真正必要的。</p><p id="cc26" class="pw-post-body-paragraph ip iq hi is b it iu iv iw ix iy iz ja kw jc jd je ky jg jh ji la jk jl jm jn hb bi translated"><strong class="is hj">识别文件尺寸的能力</strong></p><p id="c377" class="pw-post-body-paragraph ip iq hi is b it iu iv iw ix iy iz ja kw jc jd je ky jg jh ji la jk jl jm jn hb bi translated">目前，虽然脚本能够自动识别文档的方向(横向或纵向)并为其应用正确的水印，但它仅在文档大小为A4时有效。</p><p id="5ed4" class="pw-post-body-paragraph ip iq hi is b it iu iv iw ix iy iz ja kw jc jd je ky jg jh ji la jk jl jm jn hb bi translated">当然，并不是所有的文件都是A4的。为了真正实现自动化，而不是半自动化，脚本能够自动识别文档的大小(如果是A4、B5甚至是letter)并对其应用正确尺寸的水印功能将非常有用。</p><p id="9014" class="pw-post-body-paragraph ip iq hi is b it iu iv iw ix iy iz ja kw jc jd je ky jg jh ji la jk jl jm jn hb bi translated"><strong class="is hj">水印特征增强</strong></p><p id="2fb4" class="pw-post-body-paragraph ip iq hi is b it iu iv iw ix iy iz ja kw jc jd je ky jg jh ji la jk jl jm jn hb bi translated">该脚本在将水印功能应用到PDF方面肯定可以做得更好。目前，脚本在将文档整体导出之前，会将横向或纵向水印PDF叠加到文档上。虽然这是可行的，但是没有为用户提供定制。</p><p id="f5d9" class="pw-post-body-paragraph ip iq hi is b it iu iv iw ix iy iz ja kw jc jd je ky jg jh ji la jk jl jm jn hb bi translated">用户应该能够输入水印的话，水印将被放置的位置以及方向。</p><p id="8993" class="pw-post-body-paragraph ip iq hi is b it iu iv iw ix iy iz ja kw jc jd je ky jg jh ji la jk jl jm jn hb bi translated"><strong class="is hj">在Heroku或其他主机上托管应用</strong></p><p id="ef2c" class="pw-post-body-paragraph ip iq hi is b it iu iv iw ix iy iz ja kw jc jd je ky jg jh ji la jk jl jm jn hb bi translated">最后，最后一步是在Heroku这样的平台上托管应用程序，以便这个web应用程序可以很容易地共享和使用。</p><h1 id="d31f" class="jw jx hi bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated"><strong class="ak">最终想法</strong></h1><p id="69a3" class="pw-post-body-paragraph ip iq hi is b it ku iv iw ix kv iz ja kw kx jd je ky kz jh ji la lb jl jm jn hb bi translated">这对我来说绝对是一个有趣的项目，很大一部分是因为这个脚本是在Streamlit中实现的，这迫使我从用户的角度进行思考。</p><p id="0af6" class="pw-post-body-paragraph ip iq hi is b it iu iv iw ix iy iz ja kw jc jd je ky jg jh ji la jk jl jm jn hb bi translated">最后，非常感谢你阅读我的文章！:)</p><h1 id="d8f2" class="jw jx hi bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">完整代码</h1><pre class="jp jq jr js fd ll lm ln lo aw lp bi"><span id="f062" class="lq jx hi lm b fi lr ls l lt lu">import streamlit as st<br/>from pdfrw import PdfReader, PdfWriter, PageMerge, IndirectPdfDict<br/>import pathlib<br/>import os<br/>from os import path<br/>from glob import glob<br/>from PIL import Image<br/>import numpy as np<br/>import comtypes.client<br/>from pathlib import Path</span><span id="da1e" class="lq jx hi lm b fi lv ls l lt lu">#################### Streamlit ####################<br/>def load_image(img):<br/> im = Image.open(img)<br/> image = np.array(im)<br/> return image</span><span id="f5ad" class="lq jx hi lm b fi lv ls l lt lu">st.image(load_image(os.getcwd()+”\Title.png”))<br/>st.write(“##”)</span><span id="2a8d" class="lq jx hi lm b fi lv ls l lt lu">st.subheader(“Choose Options”)</span><span id="4d34" class="lq jx hi lm b fi lv ls l lt lu">config_select_options = st.selectbox(“Select option:”, [“Input files manually”, “Input path”], 0)</span><span id="60b7" class="lq jx hi lm b fi lv ls l lt lu">if config_select_options == “Input files manually”:<br/> uploaded_file_pdf = st.file_uploader(“Upload PDF Files”,type=[‘pdf’], accept_multiple_files=True)<br/> # uploaded_file_doc = st.file_uploader(“Upload doc/docx Files”,type=[‘docx’,’doc’], accept_multiple_files=True)<br/>else:<br/> input_path = st.text_input(“Please input the path of your folder”)<br/> uploaded_file = []<br/> if len(input_path) &gt; 0:<br/> st.write(f”PDFs in this path {input_path} will be uploaded”)</span><span id="2ec1" class="lq jx hi lm b fi lv ls l lt lu">output_path = st.text_input(“Please input the output path to house your PDFs”)<br/>if len(output_path) &gt; 0:<br/> st.write(f”Amended PDFs will be housed in this path {output_path}”)</span><span id="5cd5" class="lq jx hi lm b fi lv ls l lt lu">st.write(“ — — -”)<br/>st.subheader(“Choose type of manipulation to PDF”)</span><span id="c0f5" class="lq jx hi lm b fi lv ls l lt lu">config_select_manipulation = st.multiselect(“Select one or more options:”, [“Add Watermark”, “Remove Metadata”, “Concatenate PDFs”], [“Add Watermark”, “Remove Metadata”, “Concatenate PDFs”])<br/>if “Add Watermark” in config_select_manipulation:<br/> uploaded_file_wmp = st.file_uploader(“Upload watermark PDF for portrait”,type=[‘pdf’])<br/> uploaded_file_wml = st.file_uploader(“Upload watermark PDF for landscape”,type=[‘pdf’])</span><span id="a466" class="lq jx hi lm b fi lv ls l lt lu">#################### Actual Code ####################</span><span id="855c" class="lq jx hi lm b fi lv ls l lt lu">def main():<br/> ## Set up progress bar<br/> st.write(“ — — -”)<br/> st.subheader(“Status”)</span><span id="9d62" class="lq jx hi lm b fi lv ls l lt lu">progress_bar = st.progress(0)<br/> status_text = st.empty()</span><span id="e7af" class="lq jx hi lm b fi lv ls l lt lu">status_text.text(“In progress… Please Wait.”)</span><span id="f876" class="lq jx hi lm b fi lv ls l lt lu">## Checking the output directory<br/> if not os.path.exists(‘output_path’):<br/> os.makedirs(‘output_path’)<br/> status_text.text(“Output path checked okay. Proceeding to next step…”)</span><span id="3f1d" class="lq jx hi lm b fi lv ls l lt lu">## Define the reader and writer objects</span><span id="5fcc" class="lq jx hi lm b fi lv ls l lt lu">writer = PdfWriter()<br/> if “Add Watermark” in config_select_manipulation:<br/> watermark_input_P = PdfReader(uploaded_file_wmp)<br/> watermark_input_LS = PdfReader(uploaded_file_wml)<br/> watermark_P = watermark_input_P.pages[0]<br/> watermark_LS = watermark_input_LS.pages[0]<br/> status_text.text(“Loaded Watermark PDF. Progressing to the next step…”)<br/> progress_bar.progress(0.25)</span><span id="835e" class="lq jx hi lm b fi lv ls l lt lu">def find_ext(dr, ext):<br/> return glob(path.join(dr,”*.{}”.format(ext)))</span><span id="30da" class="lq jx hi lm b fi lv ls l lt lu">wdFormatPDF = 17</span><span id="b490" class="lq jx hi lm b fi lv ls l lt lu">if config_select_options == “Input path”:</span><span id="9968" class="lq jx hi lm b fi lv ls l lt lu">filepath_doc = find_ext(input_path,”doc”)<br/> filepath_docx = find_ext(input_path,”docx”)<br/> filepath_all_doc = filepath_doc + filepath_docx</span><span id="2289" class="lq jx hi lm b fi lv ls l lt lu">for file in filepath_all_doc:<br/> name = Path(file).name.split(“.”)[0]<br/> word = comtypes.client.CreateObject(‘Word.Application’, dynamic = True)<br/> word.Visible = True<br/> doc = word.Documents.Open(file)<br/> doc.SaveAs(input_path+”\\”+ name +”.pdf”, wdFormatPDF)<br/> doc.Close()<br/> word.Quit()<br/> filepath = find_ext(input_path,”pdf”)<br/> else:<br/> # for file in uploaded_file_doc:<br/> # #name = Path(file).name.split(“.”)[0]<br/> # word = comtypes.client.CreateObject(‘Word.Application’, dynamic = True)<br/> # word.Visible = True<br/> # doc = word.Documents.Open(file)<br/> # doc.SaveAs(output_path+”\\intermediate\\”+ file +”.pdf”, wdFormatPDF)<br/> # doc.Close()<br/> # word.Quit()<br/> # filepath_pdf = find_ext(output_path+”\intermediate”,”pdf”)<br/> # filepath = uploaded_file_pdf + filepath_pdf<br/> filepath = uploaded_file_pdf</span><span id="00ed" class="lq jx hi lm b fi lv ls l lt lu">## Create a loop for all the paths<br/> for i in range(len(filepath)):<br/> file = filepath[i]<br/> reader_input = PdfReader(file)<br/> status_text.text(f”Processing {file} now…”)</span><span id="0549" class="lq jx hi lm b fi lv ls l lt lu">if “Add Watermark” in config_select_manipulation:<br/> ## go through the pages one after the next<br/> for current_page in range(len(reader_input.pages)):<br/> merger = PageMerge(reader_input.pages[current_page])</span><span id="3573" class="lq jx hi lm b fi lv ls l lt lu">try:<br/> mediabox = reader_input.pages[current_page].values()[1][‘/Kids’][0][‘/MediaBox’]<br/> except TypeError:<br/> mediabox = reader_input.pages[0].values()[1]</span><span id="069f" class="lq jx hi lm b fi lv ls l lt lu">if mediabox[2] &lt; mediabox[3]:<br/> merger.add(watermark_P).render()<br/> else:<br/> merger.add(watermark_LS).render()<br/> writer.addpages(reader_input.pages)<br/> status_text.text(f”Watermark done for {file}…”)<br/> else:<br/> writer.addpages(reader_input.pages)</span><span id="a3b4" class="lq jx hi lm b fi lv ls l lt lu">if “Remove Metadata” in config_select_manipulation:<br/> # Remove metadata<br/> writer.trailer.Info = IndirectPdfDict(<br/> Title=’’,<br/> Author=’’,<br/> Subject=’’,<br/> Creator=’’,<br/> )</span><span id="77ae" class="lq jx hi lm b fi lv ls l lt lu">if “Concatenate PDFs” not in config_select_manipulation:<br/> writer.write(output_path+”\Annex “+str(i+1)+”.pdf”)<br/> writer = PdfWriter()</span><span id="2b73" class="lq jx hi lm b fi lv ls l lt lu">status_text.text(f”{file} completed…”)<br/> progress_bar.progress(0.25+(0.75/len(filepath))*(i+1))</span><span id="38cc" class="lq jx hi lm b fi lv ls l lt lu">if “Concatenate PDFs” not in config_select_manipulation:<br/> status_text.text(f”All done!!!”)<br/> st.balloons()<br/> else:<br/> # write the modified content to disk<br/> writer.write(output_path+”\Annex.pdf”)</span><span id="6246" class="lq jx hi lm b fi lv ls l lt lu">if config_select_options == “Input files manually”:<br/> for file in filepath_pdf:<br/> if os.path.exists(file):<br/> os.remove(file)<br/> else:<br/> for file in filepath:<br/> if os.path.exists(file):<br/> os.remove(file)<br/> st.balloons()</span><span id="7ff7" class="lq jx hi lm b fi lv ls l lt lu">st.write(“ — — -”)<br/>st.write(“Once you have selected the required options above, you can click on the button below to start processing. “)</span><span id="1a3b" class="lq jx hi lm b fi lv ls l lt lu">if st.button(“Click here to start!”):<br/> main()</span></pre><h1 id="674e" class="jw jx hi bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">参考</h1><p id="1e11" class="pw-post-body-paragraph ip iq hi is b it ku iv iw ix kv iz ja kw kx jd je ky kz jh ji la lb jl jm jn hb bi translated">[1]<a class="ae lw" href="https://streamlit.io/" rel="noopener ugc nofollow" target="_blank">https://streamlit.io/</a></p><h1 id="2ae1" class="jw jx hi bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">其他项目</h1><ul class=""><li id="c56e" class="lx ly hi is b it ku ix kv kw lz ky ma la mb jn mc md me mf bi translated"><a class="ae lw" href="https://choodesmond42.medium.com/price-comparison-application-using-streamlit-and-selenium-96212aa5a229" rel="noopener">使用Streamlit和Selenium进行价格比较</a></li><li id="0350" class="lx ly hi is b it mg ix mh kw mi ky mj la mk jn mc md me mf bi translated"><a class="ae lw" href="https://choodesmond42.medium.com/tabular-data-from-pdf-camelot-vs-tabula-why-not-use-both-together-433aa852f607" rel="noopener">PDF表格数据:卡梅洛特vs Tabula？为什么不两者并用呢？</a></li><li id="448d" class="lx ly hi is b it mg ix mh kw mi ky mj la mk jn mc md me mf bi translated"><a class="ae lw" href="https://choodesmond42.medium.com/pdf-manipulation-how-to-remove-unwanted-pages-using-pdfminer-56ba93bdd7d1" rel="noopener"> PDF处理应用程序第2部分——如何使用PDFminer删除不需要的页面</a></li><li id="b246" class="lx ly hi is b it mg ix mh kw mi ky mj la mk jn mc md me mf bi translated"><a class="ae lw" href="https://choodesmond42.medium.com/pdf-manipulation-application-part-3-deploying-the-application-on-heroku-and-output-result-as-zip-531886732f0e" rel="noopener"> PDF操作应用程序第3部分—在Heroku上部署应用程序，并将结果输出为zip文件</a></li></ul></div></div>    
</body>
</html>