<html>
<head>
<title>How I am using IActionConstraintFactory to handle content negotiation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我如何使用IActionConstraintFactory来处理内容协商</h1>
<blockquote>原文：<a href="https://medium.com/codex/how-i-am-using-iactionconstraintfactory-to-handle-content-negotiation-c6bed3e66b89?source=collection_archive---------6-----------------------#2022-08-15">https://medium.com/codex/how-i-am-using-iactionconstraintfactory-to-handle-content-negotiation-c6bed3e66b89?source=collection_archive---------6-----------------------#2022-08-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="266e" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">基于接受类型的资源表示</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/51a7b1605494f297d729e0c2fceeff17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aKb2gW_72hvOQlyCctxcVg.jpeg"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">照片由<a class="ae jn" href="https://stock.adobe.com/" rel="noopener ugc nofollow" target="_blank"> stock.adobe </a>中的<a class="ae jn" href="https://stock.adobe.com/uk/contributor/202206661/tierney?load_type=author&amp;prev_url=detail" rel="noopener ugc nofollow" target="_blank"> Tierney </a>拍摄</figcaption></figure><p id="0ca6" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我在这篇文章中假设你已经知道什么是Rest和RestApi，或者如果你像我一样，那么你练习它们，但是找到正确的术语来解释它们并不容易。</p><p id="c682" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">坦率地说，虽然我在过去几年中一直在使用API，并且我已经阅读了许多关于True Rest和HateOS的文章(并且观看了许多教程),但是我还没有在实践中使用过True Rest……直到现在。</p><p id="078d" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">为什么要内容协商？因为Rest资源可以有多种表现形式，这取决于谁在请求该信息。一个可能是人力资源部门，另一个可能是会计部门，这两个部门都想要关于同一资源的不同类型的信息。</p><p id="fff9" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">但是</strong>，我不打算写内容协商，而是写我如何通过<code class="du kk kl km kn b">IActionConstraintFactory</code>实现内容协商，以便为客户提供相同的端点。</p><blockquote class="ko kp kq"><p id="f65e" class="jo jp kr jq b jr js ij jt ju jv im jw ks jy jz ka kt kc kd ke ku kg kh ki kj hb bi translated">您可以使用以下链接找到演示的链接:<a class="ae jn" href="https://github.com/ramihamati/webapidemos/tree/main/WebApi.DemoActionConstraintFactory" rel="noopener ugc nofollow" target="_blank">https://github.com/ramihamati/webapidemos/tree/main/WebApi.DemoActionConstraintFactory</a></p></blockquote></div><div class="ab cl kv kw gp kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="hb hc hd he hf"><h2 id="d3cb" class="lc ld hi bd le lf lg lh li lj lk ll lm jx ln lo lp kb lq lr ls kf lt lu lv lw bi translated">限制</h2><p id="ddfc" class="pw-post-body-paragraph jo jp hi jq b jr lx ij jt ju ly im jw jx lz jz ka kb ma kd ke kf mb kh ki kj hb bi translated">首先，什么是一个<code class="du kk kl km kn b"><a class="ae jn" href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.mvc.actionconstraints.iactionconstraint?view=aspnetcore-6.0" rel="noopener ugc nofollow" target="_blank">IActionConstraint</a></code>？它们提供条件逻辑来确定某个操作对于给定的请求是否有效，并且与没有应用约束的操作相比，它还为路径查找提供了更好的匹配。</p><p id="c38d" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">因此，我们实际上可以创建一个属性，该属性从<code class="du kk kl km kn b">IActionConstraint</code>接口派生，并将其应用于我们的端点，但是在我们的示例中，我们希望创建一个基于枚举的特定约束，因此，我们将使用<code class="du kk kl km kn b">IActionConstraintFactory</code>，它允许我们实际生成一个遵循更动态逻辑的<code class="du kk kl km kn b">IActionConstraint</code></p></div><div class="ab cl kv kw gp kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="hb hc hd he hf"><h2 id="241c" class="lc ld hi bd le lf lg lh li lj lk ll lm jx ln lo lp kb lq lr ls kf lt lu lv lw bi translated">设计概念</h2><ul class=""><li id="3b56" class="mc md hi jq b jr lx ju ly jx me kb mf kf mg kj mh mi mj mk bi translated">创建一个供应商类型，告诉我们谁在请求数据</li><li id="0579" class="mc md hi jq b jr ml ju mm jx mn kb mo kf mp kj mh mi mj mk bi translated">创建一个动作约束工厂，它将根据供应商类型生成动作约束</li><li id="97fb" class="mc md hi jq b jr ml ju mm jx mn kb mo kf mp kj mh mi mj mk bi translated">创建一个动作约束，该约束将确定标头中的<strong class="jq hj">接受</strong>类型是否与接受的类型相匹配</li></ul></div><div class="ab cl kv kw gp kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="hb hc hd he hf"><p id="869d" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">enum供应商类型具有可能要求资源的所有供应商类型的列表</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mq mr l"/></div></figure><p id="4b46" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">InputAcceptTypes是一个类，我们在其中保存接受头值的常量值</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mq mr l"/></div></figure><p id="bd1b" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">现在我们的工厂，将接收一个供应商类型并生成相应的<code class="du kk kl km kn b">IActionConstraint</code></p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mq mr l"/></div></figure><p id="b61a" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">上面的工厂创建了一个VendorRouteConstraint，它的简单任务是从请求头中提取接受值，并确定适当的供应商类型</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mq mr l"/></div></figure><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mq mr l"/></div></figure><p id="7a28" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">接下来呢？我为相同的资源创建了两个模型，然后两个控制器有完全相同的端点，但是有不同的路由约束</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mq mr l"/></div></figure><p id="972d" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">下一步是在InputFormatters中实际注册我们的媒体类型。因此，如果您转到启动文件，您可以添加以下行:</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mq mr l"/></div></figure><p id="e16d" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">结果是:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ms"><img src="../Images/fdaa7b75b1ad5a4c9867efebdbc5b574.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ml_njA4xqcffO5gstZD_Eg.png"/></div></div></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mt"><img src="../Images/b79e96ccbdc5d38bbd8cc72fd25cf310.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g8G4Evqwde8sVRzF_cXqQw.png"/></div></div></figure></div></div>    
</body>
</html>