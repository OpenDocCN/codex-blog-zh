<html>
<head>
<title>Custom Sequence — Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">自定义序列Python</h1>
<blockquote>原文：<a href="https://medium.com/codex/custom-sequence-python-53ddcc37a1c7?source=collection_archive---------7-----------------------#2021-08-23">https://medium.com/codex/custom-sequence-python-53ddcc37a1c7?source=collection_archive---------7-----------------------#2021-08-23</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/0f2487367161a0753b9d1a76f29c2de1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*UfPB_b3wt7BjOnhfRFV-yg.jpeg"/></div><figcaption class="im in et er es io ip bd b be z dx translated">塔德乌什·拉科塔在<a class="ae iq" href="https://unsplash.com/s/photos/sequence-animal?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="4344" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">我在Python中用过<code class="du jp jq jr js b">__str__</code>、<code class="du jp jq jr js b">__repr__</code>、<code class="du jp jq jr js b">__class__</code>、<code class="du jp jq jr js b">__len__</code>、<code class="du jp jq jr js b">__init__ </code>特殊/dunder/magic方法。当我得知还有其他特殊的方法可以用来将方法的高级行为映射到Python内部调用时，我感到惊喜。让我们开始创建我们自己的定制序列。</p><p id="4b30" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">我们将使用序列协议的<code class="du jp jq jr js b">__getitem__</code>、<code class="du jp jq jr js b">__len__</code>来创建我们自己的序列。这里的协议指的是一个契约，它基本上声明了您需要实现某些特殊的/dunder/magic方法来使数据结构以某种方式运行。我们还将添加其他添加剂，使一个序列有更多的功能。</p><p id="d3fe" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">让我们来看一个实现协议所需的dunder方法的序列示例:</p><figure class="jt ju jv jw fd ij"><div class="bz dy l di"><div class="jx jy l"/></div></figure><p id="320e" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">运行该文件时，我们得到:</p><pre class="jt ju jv jw fd jz js ka kb aw kc bi"><span id="c310" class="kd ke hi js b fi kf kg l kh ki"><strong class="js hj">for looping squares</strong><br/>0<br/>1<br/>4<br/>9<br/>16</span><span id="7fb6" class="kd ke hi js b fi kj kg l kh ki"><strong class="js hj">squares after the for loop</strong><br/>[]</span><span id="9944" class="kd ke hi js b fi kj kg l kh ki"><strong class="js hj">reinitialising Squares...</strong><br/><strong class="js hj">using list comprehension</strong><br/>[0, 1, 4, 9, 16]</span><span id="f831" class="kd ke hi js b fi kj kg l kh ki"><strong class="js hj">Out of index error as we are trying to get 6th element from the sequence</strong><br/>Traceback (most recent call last):<br/>  File "/Users/&lt;username&gt;/Documents/Projects/medium/custom-sequence/squares-seq.py", line 33, in &lt;module&gt;<br/>    print(f'{squares[5]}')<br/>  File "/Users/&lt;username&gt;/Documents/Projects/medium/custom-sequence/squares-seq.py", line 12, in __getitem__<br/>    raise IndexError<br/>IndexError</span></pre><p id="1075" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">看，你可以创建自己的列表。如果你试图访问一个不可访问的元素，你会得到<code class="du jp jq jr js b">IndexError</code>。还要注意，一旦一个序列完成迭代，我们需要再次初始化这个类来再次迭代。</p><p id="897a" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">现在，让我们像内置序列类型一样添加更多的哨声和铃声，让代码变得更有趣。</p><figure class="jt ju jv jw fd ij"><div class="bz dy l di"><div class="jx jy l"/></div></figure><p id="4fdb" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">运行该文件时，我们得到:</p><pre class="jt ju jv jw fd jz js ka kb aw kc bi"><span id="db13" class="kd ke hi js b fi kf kg l kh ki"><strong class="js hj">original:</strong> [Square(num=0, square=0), Square(num=1, square=1), Square(num=2, square=4), Square(num=3, square=9), Square(num=4, square=16)]</span><span id="2567" class="kd ke hi js b fi kj kg l kh ki"><strong class="js hj">getting 3rd element:</strong> Square(num=2, square=4)</span><span id="4cc8" class="kd ke hi js b fi kj kg l kh ki"><strong class="js hj">getting element from index 2 to 4 using slice:</strong> [Square(num=1, square=1), Square(num=2, square=4), Square(num=3, square=9)]</span><span id="6f2d" class="kd ke hi js b fi kj kg l kh ki"><strong class="js hj">setting values in slice(1, 3)...</strong><br/><strong class="js hj">squares list now:</strong> [Square(num=0, square=0), Square(num=6, square=36), Square(num=7, square=49), Square(num=3, square=9), Square(num=4, square=16)]</span><span id="faf3" class="kd ke hi js b fi kj kg l kh ki"><strong class="js hj">deleting 3rd element from square...</strong><br/><strong class="js hj">squares list now:</strong> [Square(num=0, square=0), Square(num=6, square=36), Square(num=3, square=9), Square(num=4, square=16)]</span></pre><p id="bfe4" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">在这里，我们指导了dunder方法如何表现，以便它像Python的内置序列<code class="du jp jq jr js b">list</code>一样工作。</p><p id="f14b" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">我们实现了<code class="du jp jq jr js b">__setitem__</code>、<code class="du jp jq jr js b">__getitem__</code>、<code class="du jp jq jr js b">__delitem__</code>，这样我们就可以设置、获取和删除序列中的项目。</p><p id="760c" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">我们还有其他方法来调用这些dunder方法。例如:<code class="du jp jq jr js b">__setitem__</code>的赋值操作:</p><pre class="jt ju jv jw fd jz js ka kb aw kc bi"><span id="6daf" class="kd ke hi js b fi kf kg l kh ki">squares[2] = 10</span></pre><p id="2b51" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated"><code class="du jp jq jr js b">__getitem__</code>的括号查找:</p><pre class="jt ju jv jw fd jz js ka kb aw kc bi"><span id="afdb" class="kd ke hi js b fi kf kg l kh ki">squares[2]</span></pre><p id="f017" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated"><code class="du jp jq jr js b">del</code>操作员为<code class="du jp jq jr js b">__delitem__</code>:</p><pre class="jt ju jv jw fd jz js ka kb aw kc bi"><span id="cf80" class="kd ke hi js b fi kf kg l kh ki">del squares[2]</span></pre><p id="8de9" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">你还可以实现许多其他方法，比如<code class="du jp jq jr js b">append</code>、<code class="du jp jq jr js b">extend</code>、<code class="du jp jq jr js b">clear</code>、<code class="du jp jq jr js b">pop</code>、<code class="du jp jq jr js b">__add__</code>、<code class="du jp jq jr js b">__iadd__</code>来使你的<code class="du jp jq jr js b">Squares</code>序列更加有效。</p><p id="8765" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">这个练习感觉非常类似于我在本科上的算法课，你基本上实现了你自己的自平衡树，Splay树。</p><p id="543b" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">本文到此为止。希望它给你更多的工具来创建你自己的自定义数据结构，除了Python的内置类型！</p><p id="b069" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">恭喜你！💃下周我们将主要讨论Python中的Iterable vs Iterator或者<code class="du jp jq jr js b">__delitem__</code> vs <code class="du jp jq jr js b">__delete__</code> vs <code class="du jp jq jr js b">__del__</code>。</p></div><div class="ab cl kk kl gp km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="hb hc hd he hf"><p id="7ffe" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">灵感:</p><ul class=""><li id="e247" class="kr ks hi it b iu iv iy iz jc kt jg ku jk kv jo kw kx ky kz bi translated"><a class="ae iq" href="https://www.udemy.com/course/python-3-deep-dive-part-2/" rel="noopener ugc nofollow" target="_blank">巨蟒深潜</a></li></ul><p id="3f69" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">你可以在<a class="ae iq" href="https://www.patreon.com/dkhambu" rel="noopener ugc nofollow" target="_blank"> Patreon </a>支持我。</p></div></div>    
</body>
</html>