<html>
<head>
<title>A Beginner’s Guide to Bloom Filter</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">布鲁姆过滤器初学者指南</h1>
<blockquote>原文：<a href="https://medium.com/codex/how-to-efficiently-check-if-a-username-is-registered-dbbe02cca20f?source=collection_archive---------1-----------------------#2022-11-25">https://medium.com/codex/how-to-efficiently-check-if-a-username-is-registered-dbbe02cca20f?source=collection_archive---------1-----------------------#2022-11-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="7149" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">如何高效地检查用户名是否注册？</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/d13b24636d313de82ce1ece5d48a93a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Adbrqzbm7MYnpaVZWCoA6w.jpeg"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">由<a class="ae jn" href="https://www.pexels.com/@rahulp9800/" rel="noopener ugc nofollow" target="_blank">拉胡尔·潘迪特</a>在<a class="ae jn" href="https://www.pexels.com/photo/yellow-cosmos-flower-close-up-photography-1212487/" rel="noopener ugc nofollow" target="_blank">佩克斯</a>拍摄的照片</figcaption></figure><p id="eeea" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">给定用户注册页面上的用户名，我们如何判断它是否已经注册了？</p><p id="7b8b" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">虽然查询索引数据库很有帮助，但是它很慢，而且会引起网络调用。</p><p id="950d" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">为了加快速度，我们可以在Redis这样的键值存储中缓存注册用户名的列表。</p><p id="16d8" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">然而，这意味着缓存数百万条记录，并使我们的内存占用加倍。</p><p id="de12" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在这个看似微不足道的问题上，我们如何才能做得更好？</p><p id="18d4" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">布鲁姆过滤器可能是答案，让我们来看看吧！</p><h1 id="2cb7" class="kk kl hi bd km kn ko kp kq kr ks kt ku io kv ip kw ir kx is ky iu kz iv la lb bi translated">什么是布鲁姆过滤器？</h1><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lc"><img src="../Images/2f84318bc5600d2731a218e12a355b06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AwOI_GEcUpDXGhZ-aM91Cg.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">布隆过滤器检查项目是否在集合中</figcaption></figure><p id="77a5" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">布隆过滤器回答了一个简单的问题，</p><p id="b003" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">一个元素是否存在于给定的集合中？</strong></p><p id="6e22" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">布隆过滤器是一种概率数据结构。对于上面的问题，它输出以下答案之一</p><ul class=""><li id="6419" class="ld le hi jq b jr js ju jv jx lf kb lg kf lh kj li lj lk ll bi translated"><strong class="jq hj">大概</strong>是的</li><li id="93f4" class="ld le hi jq b jr lm ju ln jx lo kb lp kf lq kj li lj lk ll bi translated"><strong class="jq hj"> 100% </strong>否</li></ul><p id="6abd" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">换句话说，假阳性<strong class="jq hj">可能</strong>，而假阴性<strong class="jq hj">永远不会</strong>发生。</p><p id="62e0" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">而它最大的优势就是，它做到了在<strong class="jq hj">恒定</strong>的时间和空间里。</p><h1 id="0f48" class="kk kl hi bd km kn ko kp kq kr ks kt ku io kv ip kw ir kx is ky iu kz iv la lb bi translated">它是如何工作的？</h1><p id="c9bf" class="pw-post-body-paragraph jo jp hi jq b jr lr ij jt ju ls im jw jx lt jz ka kb lu kd ke kf lv kh ki kj hb bi translated">布隆过滤器由两个组件组成</p><ul class=""><li id="c8de" class="ld le hi jq b jr js ju jv jx lf kb lg kf lh kj li lj lk ll bi translated">N大小的位数组</li><li id="aabe" class="ld le hi jq b jr lm ju ln jx lo kb lp kf lq kj li lj lk ll bi translated">几个散列函数</li></ul><h2 id="203e" class="lw kl hi bd km lx ly lz kq ma mb mc ku jx md me kw kb mf mg ky kf mh mi la mj bi translated"><strong class="ak">初始化</strong></h2><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mk"><img src="../Images/6306d0fb3db32e2426f0c33e81aff2a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PXKNvd6_QfQCDjVwqeXn2w.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">布隆过滤器是N大小的比特阵列</figcaption></figure><p id="c0c9" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">它首先被初始化为一个N大小的位数组，所有的位都被设置为零。现在让我们假设数组的长度为10。</p><h2 id="3224" class="lw kl hi bd km lx ly lz kq ma mb mc ku jx md me kw kb mf mg ky kf mh mi la mj bi translated"><strong class="ak">添加项目</strong></h2><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ml"><img src="../Images/33755b4921f5d058ca591e6f1729a5d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DWOWz93Qy86vG10punYW8g.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">对项目进行散列和mod以获得有界索引</figcaption></figure><p id="2871" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">添加一个项目很简单</p><ul class=""><li id="7472" class="ld le hi jq b jr js ju jv jx lf kb lg kf lh kj li lj lk ll bi translated">称之为“tiger”的项目是使用散列函数散列的</li><li id="5b90" class="ld le hi jq b jr lm ju ln jx lo kb lp kf lq kj li lj lk ll bi translated">生成的哈希值由数组长度决定，以获得一个有界索引</li><li id="0706" class="ld le hi jq b jr lm ju ln jx lo kb lp kf lq kj li lj lk ll bi translated">然后，位数组的索引被设置为1</li></ul><h2 id="0dc8" class="lw kl hi bd km lx ly lz kq ma mb mc ku jx md me kw kb mf mg ky kf mh mi la mj bi translated"><strong class="ak">检查一个项目是否存在</strong></h2><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mm"><img src="../Images/d34a7bd3737552d452818b527dedddda.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZZVSfepj490kbIzeh8NqtQ.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">如果index设置为1，则项目可能在集合中。不然肯定不在套里。</figcaption></figure><p id="aa68" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">类似于添加一个条目，我们使用散列函数对元素进行散列，并对其进行修改以获得一个有界索引。</p><p id="565f" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">输出评估如下，</p><ul class=""><li id="a700" class="ld le hi jq b jr js ju jv jx lf kb lg kf lh kj li lj lk ll bi translated">如果位数组的索引值为0，则该项是集合中的<strong class="jq hj">而不是</strong>。</li><li id="1902" class="ld le hi jq b jr lm ju ln jx lo kb lp kf lq kj li lj lk ll bi translated">否则，该物品可能是<strong class="jq hj">中的</strong></li></ul><p id="e289" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">布隆过滤器中的项目不能<strong class="jq hj">被移除，因为多个项目可能共享相同的索引。</strong></p><h2 id="b2a5" class="lw kl hi bd km lx ly lz kq ma mb mc ku jx md me kw kb mf mg ky kf mh mi la mj bi translated">存储布隆过滤器</h2><p id="fdd1" class="pw-post-body-paragraph jo jp hi jq b jr lr ij jt ju ls im jw jx lt jz ka kb lu kd ke kf lv kh ki kj hb bi translated">我们可以将其位表示转换为十进制数，而不是将bloom filter存储为数组。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mn"><img src="../Images/3dcbbb54b7527b34cc45c367d359e09c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cNYp9TR-WgRttQcWuiFZYw.png"/></div></div></figure><p id="778a" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">例如，我们可以将包含<code class="du mo mp mq mr b">10011</code>的数组转换为19，并将其存储在缓存中。</p><p id="87b2" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">如果列表不经常改变，服务器可以将十进制数发送给客户端，允许在客户端进行验证。</p><h1 id="4a4e" class="kk kl hi bd km kn ko kp kq kr ks kt ku io kv ip kw ir kx is ky iu kz iv la lb bi translated">我们能做得更好吗？</h1><p id="411d" class="pw-post-body-paragraph jo jp hi jq b jr lr ij jt ju ls im jw jx lt jz ka kb lu kd ke kf lv kh ki kj hb bi translated">如果散列函数为“tiger”和“cow”都输出了索引1，那么检查“cow”是否在集合中会产生答案Yes <strong class="jq hj">，即使它不是</strong>。</p><p id="e295" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我们可以通过以下解决方案降低误报的几率。</p><ul class=""><li id="698c" class="ld le hi jq b jr js ju jv jx lf kb lg kf lh kj li lj lk ll bi translated">增加数组的长度</li><li id="a928" class="ld le hi jq b jr lm ju ln jx lo kb lp kf lq kj li lj lk ll bi translated">增加哈希函数的数量</li></ul><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ms"><img src="../Images/fc9e4be4106692bc7775df349092384b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vHNdO_LjxiukU-1PMNntLQ.png"/></div></div></figure><p id="8eb7" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">增加阵列的长度减少了碰撞的机会。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mt"><img src="../Images/9b7719bdb58dcbe22f5503a0959cf0d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aRFvUvf6PyOCn2Ndcv3FNg.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">使用多个散列获得多个索引</figcaption></figure><p id="b91c" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">代替一个索引，我们可以使用几个散列获得多个索引。</p><p id="0c09" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">添加项目时，所有获得的索引将被设置为1。</p><p id="f0ba" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">只有当<strong class="jq hj">所有的</strong>索引都被设为1时，一个项目才被认为可能在集合中。</p><p id="f344" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">利用这些方法，我们可以显著降低假阳性的概率。</p><h1 id="1a15" class="kk kl hi bd km kn ko kp kq kr ks kt ku io kv ip kw ir kx is ky iu kz iv la lb bi translated">应用程序</h1><p id="ee0e" class="pw-post-body-paragraph jo jp hi jq b jr lr ij jt ju ls im jw jx lt jz ka kb lu kd ke kf lv kh ki kj hb bi translated">让我们来看一些现实生活中的例子。</p><h2 id="c9e3" class="lw kl hi bd km lx ly lz kq ma mb mc ku jx md me kw kb mf mg ky kf mh mi la mj bi translated">检查用户名是否存在于用户注册流程中</h2><ul class=""><li id="06f3" class="ld le hi jq b jr lr ju ls jx mu kb mv kf mw kj li lj lk ll bi translated">当创建用户名时，该用户名被添加到存储在键值存储中的布隆过滤器中。</li><li id="7fb8" class="ld le hi jq b jr lm ju ln jx lo kb lp kf lq kj li lj lk ll bi translated">当用户在用户注册页面上键入用户名时，服务器首先查询布隆过滤器。</li><li id="0f7e" class="ld le hi jq b jr lm ju ln jx lo kb lp kf lq kj li lj lk ll bi translated">如果用户名不在布隆过滤器中，服务器会立即向客户端返回一个错误。</li><li id="949b" class="ld le hi jq b jr lm ju ln jx lo kb lp kf lq kj li lj lk ll bi translated">否则，服务器会在数据库中进行查询和交叉检查。</li></ul><h2 id="d0b6" class="lw kl hi bd km lx ly lz kq ma mb mc ku jx md me kw kb mf mg ky kf mh mi la mj bi translated">检查用户是否阅读了中等文章</h2><ul class=""><li id="f23d" class="ld le hi jq b jr lr ju ls jx mu kb mv kf mw kj li lj lk ll bi translated">中为每个用户维护一个布隆过滤器。</li><li id="4175" class="ld le hi jq b jr lm ju ln jx lo kb lp kf lq kj li lj lk ll bi translated">在推荐文章之前，Medium会检查文章ID是否存在于用户的bloom filter中。</li><li id="87db" class="ld le hi jq b jr lm ju ln jx lo kb lp kf lq kj li lj lk ll bi translated">当然不在布隆过滤器中的文章被推荐给用户。</li></ul><h2 id="e421" class="lw kl hi bd km lx ly lz kq ma mb mc ku jx md me kw kb mf mg ky kf mh mi la mj bi translated">在Chrome中检查一个URL是否是恶意的</h2><ul class=""><li id="b7fc" class="ld le hi jq b jr lr ju ls jx mu kb mv kf mw kj li lj lk ll bi translated">当访问一个URL时，Chrome首先验证该URL是否是恶意列表的一部分。</li><li id="9c2a" class="ld le hi jq b jr lm ju ln jx lo kb lp kf lq kj li lj lk ll bi translated">Google不是每次都查询Google服务器，而是使用预先确定的恶意列表构建一个bloom filter并发送给浏览器。</li><li id="cdfa" class="ld le hi jq b jr lm ju ln jx lo kb lp kf lq kj li lj lk ll bi translated">在访问网站之前，浏览器会对URL进行哈希处理，并与布隆过滤器进行交叉检查。</li></ul><h1 id="d111" class="kk kl hi bd km kn ko kp kq kr ks kt ku io kv ip kw ir kx is ky iu kz iv la lb bi translated">关闭</h1><p id="fa1c" class="pw-post-body-paragraph jo jp hi jq b jr lr ij jt ju ls im jw jx lt jz ka kb lu kd ke kf lv kh ki kj hb bi translated">虽然可能会有<strong class="jq hj">误报</strong>，但是当我们想要判断列表中的某个项目是否是<strong class="jq hj">而不是</strong>时，布隆过滤器是很方便的。</p><p id="4046" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">由于其在时间和空间上的效率，它可以用作第一层过滤。</p><p id="43f3" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我希望这能对你有所帮助，下次再见！</p></div></div>    
</body>
</html>