<html>
<head>
<title>How to deploy Application Insights with alert-based Smart Detection using Terraform</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Terraform通过基于警报的智能检测部署应用洞察</h1>
<blockquote>原文：<a href="https://medium.com/codex/how-to-deploy-application-insights-with-alert-based-smart-detection-using-terraform-c22685204126?source=collection_archive---------7-----------------------#2022-08-26">https://medium.com/codex/how-to-deploy-application-insights-with-alert-based-smart-detection-using-terraform-c22685204126?source=collection_archive---------7-----------------------#2022-08-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/780b6a46613efd547f75d9f39c5450e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bny8Mg3Tks7JhpL89xXeZA.png"/></div></div></figure><p id="fc7e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Azure Monitor是Azure服务之一，涵盖了负责收集、分析和执行来自各种环境的遥测数据的横切关注点。Application Insights作为Azure Monitor的一部分，为各种类型的应用程序提供可扩展的应用程序性能管理和监控。</p><p id="084b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Application Insights的一个支柱是智能检测机制，它可以自动警告潜在的性能问题和故障异常。由于Azure的历史，该功能有一个非常有限的通知机制。一个例外是故障异常检测器，它是警报管理的一部分。作为Azure Monitor的一部分，警报管理提供了各种配置选项，如警报规则的粒度定义、具有特定通知机制的操作组的定义以及警报处理规则的定义。</p><p id="aa86" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">使用新的预览功能，智能检测规则现在可以集成到Azure Monitor的警报管理中。本指南展示了如何使用Terraform通过基于警报的智能检测自动部署应用洞察。</p></div><div class="ab cl jo jp gp jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="hb hc hd he hf"><h1 id="a219" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">Azure Monitor警报概述</h1><p id="0116" class="pw-post-body-paragraph iq ir hi is b it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj kx jl jm jn hb bi translated">Azure Monitor中的警报功能基于指标或捕获的日志主动通知关键情况。预警管理主要由三个支柱组成:预警规则、行动组和预警处理规则:</p><ul class=""><li id="5b40" class="ky kz hi is b it iu ix iy jb la jf lb jj lc jn ld le lf lg bi translated">警报规则<br/>警报通知违反监控数据的条件。警报规则指定监控所需的所有相关参数，如条件或在违规情况下应通知的操作组。</li><li id="bef3" class="ky kz hi is b it lh ix li jb lj jf lk jj ll jn ld le lf lg bi translated">行动组<br/>一个行动组指定了应该向谁发出警报以及如何发出通知。</li><li id="8417" class="ky kz hi is b it lh ix li jb lj jf lk jj ll jn ld le lf lg bi translated">警报处理规则<br/>这些类型的规则允许您对引发的警报进行处理，如应用过滤器、修改操作组或抑制通知等。</li></ul><p id="7bfd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">关于Azure Monitor特性的更深入的见解和详细信息可以在<a class="ae lm" href="https://docs.microsoft.com/en-US/azure/azure-monitor/overview" rel="noopener ugc nofollow" target="_blank">微软文档</a>中找到。</p></div><div class="ab cl jo jp gp jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="hb hc hd he hf"><h1 id="e106" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">地形部署</h1><h2 id="3c06" class="ln jw hi bd jx lo lp lq kb lr ls lt kf jb lu lv kj jf lw lx kn jj ly lz kr ma bi translated">步骤1:创建应用洞察</h2><p id="169b" class="pw-post-body-paragraph iq ir hi is b it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj kx jl jm jn hb bi translated">要开始使用Terraform，必须首先配置相应的提供者。在我们的例子中，我们使用提供者<code class="du mb mc md me b">azurerm</code>和<code class="du mb mc md me b">azapi</code>。<code class="du mb mc md me b">providers.tf</code>文件的结果部分看起来像下面的代码片段。像身份验证和状态管理这样的事情不在本指南的讨论范围之内。如果您不熟悉azurerm提供程序的配置，请简要浏览一下<a class="ae lm" href="https://learn.hashicorp.com/tutorials/terraform/azure-build?in=terraform/azure-get-started" rel="noopener ugc nofollow" target="_blank"> Terraform文档</a>。</p><pre class="mf mg mh mi fd mj me mk ml aw mm bi"><span id="4a40" class="ln jw hi me b fi mn mo l mp mq">terraform {<br/>  required_version = "&gt;=1.2.8"<br/><br/>  required_providers {<br/>    azurerm = {<br/>      source  = "hashicorp/azurerm"<br/>      version = "~&gt;3.20.0"<br/>    }<br/>    azapi = {<br/>      source  = "azure/azapi"<br/>      version = "~&gt;0.5.0"<br/>    }<br/>  }<br/>}</span></pre><p id="15f8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">提供者<code class="du mb mc md me b">azurerm</code>用于部署不同资源的基本实例。<code class="du mb mc md me b">azapi</code>提供商是必需的，因为我们将使用<code class="du mb mc md me b">azurerm</code>提供商尚未涵盖的功能。</p><p id="66f9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">有了提供者配置，我们现在可以编写我们的Terraform块了。我们从包含基于日志分析工作区的应用洞察实例的资源组开始。</p><blockquote class="mr ms mt"><p id="fd98" class="iq ir mu is b it iu iv iw ix iy iz ja mv jc jd je mw jg jh ji mx jk jl jm jn hb bi translated">日志分析是Azure Monitor的一部分，提供存储、保留和查询从受监控资源收集的数据的功能。工作区是保存数据的逻辑存储单元。日志分析工作区应该是创建应用洞察的首选方式，因为经典模式已过时，将于2024年2月29日退役。</p></blockquote><p id="02fe" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">该步骤中使用的所有资源都可以在<code class="du mb mc md me b">azurerm</code>提供程序中获得。以下代码片段显示了Terraform配置。</p><pre class="mf mg mh mi fd mj me mk ml aw mm bi"><span id="cf9c" class="ln jw hi me b fi mn mo l mp mq">resource "azurerm_resource_group" "example" {<br/>  name     = "rg-example-dev-we-001"<br/>  location = "westeurope"<br/>}<br/><br/>resource "azurerm_log_analytics_workspace" "example" {<br/>  name                = "log-example-dev-we-001"<br/>  location            = azurerm_resource_group.example.location<br/>  resource_group_name = azurerm_resource_group.example.name<br/>  sku                 = "PerGB2018"<br/>}<br/><br/>resource "azurerm_application_insights" "example" {<br/>  name                = "appi-example-dev-we-001"<br/>  location            = azurerm_resource_group.example.location<br/>  resource_group_name = azurerm_resource_group.example.name<br/>  workspace_id        = azurerm_log_analytics_workspace.example.id<br/>  application_type    = "web"<br/>}</span></pre><p id="4010" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">执行Terraform脚本后，Azure中创建的资源如下图所示:</p><figure class="mf mg mh mi fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es my"><img src="../Images/733046bdbe88e5578dbed9901cb4c65d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*HxglofQ-aFssJNBy"/></div></div></figure><p id="319d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在Application Insights实例中，智能检测分为两个视图。第一个显示了引发的警报和一个关于新的基于警报的方法的小提示。</p><figure class="mf mg mh mi fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es my"><img src="../Images/cf16c9490a96c75a706628017c097846.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*N-fjBnVhFGl_2VNk"/></div></div></figure><p id="900e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在有关智能检测设置的视图中，会显示所有可用的规则。在编辑对话框中，我们可以配置通知。</p><figure class="mf mg mh mi fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es my"><img src="../Images/38cbd617e52c77fec5055b4a2b390e3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*GW-fUbfhmupYC3Lm"/></div></div></figure><p id="28e0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如上所述，故障异常规则一直是一种特殊的智能检测。它是作为Azure Monitor中的警报规则自动创建的。</p><figure class="mf mg mh mi fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es my"><img src="../Images/14bb07257a089c7d7945940fc16597aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*4IFvHXk377gkwQND"/></div></div></figure><p id="bd4a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当前的方法有几个缺点:</p><ul class=""><li id="f26b" class="ky kz hi is b it iu ix iy jb la jf lb jj lc jn ld le lf lg bi translated">无论是否需要，都会创建智能检测规则</li><li id="05f6" class="ky kz hi is b it lh ix li jb lj jf lk jj ll jn ld le lf lg bi translated">智能检测通知机制受到限制，无法根据需要进行配置</li><li id="9f40" class="ky kz hi is b it lh ix li jb lj jf lk jj ll jn ld le lf lg bi translated">无法阻止故障异常规则的创建，并且应用的通知接收者通常是错误的人</li></ul><p id="838e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">但也有好消息。在新的预览版中，许多问题都将得到改善。接下来的部分将涵盖这些主题。</p><h2 id="28a4" class="ln jw hi bd jx lo lp lq kb lr ls lt kf jb lu lv kj jf lw lx kn jj ly lz kr ma bi translated">步骤2:创建和配置警报</h2><h2 id="6758" class="ln jw hi bd jx lo lp lq kb lr ls lt kf jb lu lv kj jf lw lx kn jj ly lz kr ma bi translated"><strong class="ak">部署行动小组</strong></h2><p id="234a" class="pw-post-body-paragraph iq ir hi is b it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj kx jl jm jn hb bi translated">使用Terraform，可以使用<code class="du mb mc md me b">azurerm_monitor_action_group</code>块创建一个动作组。下面的代码片段将使用邮件接收器创建一个新的操作组，作为许多可用的可能性之一，如调用Azure函数、执行Logic App或运行自动化Runbook。</p><pre class="mf mg mh mi fd mj me mk ml aw mm bi"><span id="8e66" class="ln jw hi me b fi mn mo l mp mq">resource "azurerm_monitor_action_group" "example" {<br/>  name                = "ag-example-dev-we-001"<br/>  resource_group_name = azurerm_resource_group.example.name<br/>  short_name          = "ag-example"<br/><br/>  dynamic "email_receiver" {<br/>    for_each = [{ name = "receiver", mail = "receiver@example.com" }]<br/><br/>    content {<br/>      name                    = "Send to (${lookup(email_receiver.value, "name", null)})"<br/>      email_address           = lookup(email_receiver.value, "mail", null)<br/>      use_common_alert_schema = true<br/>    }<br/>  }<br/>}</span></pre><p id="1da5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">使用上面的代码片段，您可以轻松地将多个接收者添加到操作组中，而无需重复使用<code class="du mb mc md me b">email_receiver</code>块。因此，由于<code class="du mb mc md me b">for_each</code>只能在特定的块类型中使用，我们必须使用一个<a class="ae lm" href="https://www.terraform.io/language/expressions/dynamic-blocks" rel="noopener ugc nofollow" target="_blank">动态块</a>。</p><h2 id="6fe8" class="ln jw hi bd jx lo lp lq kb lr ls lt kf jb lu lv kj jf lw lx kn jj ly lz kr ma bi translated">部署智能检测警报规则</h2><p id="eaa0" class="pw-post-body-paragraph iq ir hi is b it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj kx jl jm jn hb bi translated">指定操作组后，我们现在可以创建警报规则。在智能检测规则的情况下，必须使用Terraform块<code class="du mb mc md me b">azurerm_monitor_smart_detector_alert_rule</code>。对于公制警报，<code class="du mb mc md me b">azurerm_monitor_metric_alert</code>是正确的选择。由于我们关注的是应用洞察和智能检测，该片段展示了如何使用Terraform创建智能检测警报规则的示例。</p><pre class="mf mg mh mi fd mj me mk ml aw mm bi"><span id="caff" class="ln jw hi me b fi mn mo l mp mq">resource "azurerm_monitor_smart_detector_alert_rule" "request_performance_degradation_detector" {<br/>  name                = "Response Latency Degradation - ${azurerm_application_insights.example.name}"<br/>  description         = "Notifies you of an unusual increase in latency in your app response to requests."<br/>  resource_group_name = azurerm_resource_group.example.name<br/>  severity            = "Sev3"<br/>  scope_resource_ids  = [azurerm_application_insights.example.id]<br/>  frequency           = "P1D"<br/>  detector_type       = "RequestPerformanceDegradationDetector"<br/>  enabled             = true<br/><br/>  action_group {<br/>    ids = [azurerm_monitor_action_group.example.id]<br/>  }<br/>}</span></pre><p id="626d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如您所见，该规则适用于之前创建的application insights实例，并通知我们的操作组。通过字段<code class="du mb mc md me b">detector_type</code>可以选择智能检测规则。目前可以使用以下检测器类型:</p><ul class=""><li id="fb18" class="ky kz hi is b it iu ix iy jb la jf lb jj lc jn ld le lf lg bi translated">故障异常检测器</li><li id="ba2a" class="ky kz hi is b it lh ix li jb lj jf lk jj ll jn ld le lf lg bi translated">RequestPerformanceDegradationDetector</li><li id="46a3" class="ky kz hi is b it lh ix li jb lj jf lk jj ll jn ld le lf lg bi translated">DependencyPerformanceDegradationDetector</li><li id="add9" class="ky kz hi is b it lh ix li jb lj jf lk jj ll jn ld le lf lg bi translated">ExceptionVolumeChangedDetector</li><li id="e3d2" class="ky kz hi is b it lh ix li jb lj jf lk jj ll jn ld le lf lg bi translated">TraceSeverityDetector</li><li id="f596" class="ky kz hi is b it lh ix li jb lj jf lk jj ll jn ld le lf lg bi translated">内存泄漏检测器</li></ul><h2 id="fc1a" class="ln jw hi bd jx lo lp lq kb lr ls lt kf jb lu lv kj jf lw lx kn jj ly lz kr ma bi translated">步骤3:切换智能检测</h2><p id="6fd0" class="pw-post-body-paragraph iq ir hi is b it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj kx jl jm jn hb bi translated">我们几乎成功地切换到新的警报基础智能检测机制。还需要最后一个重要步骤。我们必须告诉Application Insights，内部智能检测评估已经被Azure Monitor alerts中可用的检测器所取代。</p><p id="f995" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这个步骤可以例如通过Azure门户来执行。然后它隐式地启用资源类型<code class="du mb mc md me b">Microsoft.Insights/components/ProactiveDetectionConfigs</code>的<code class="du mb mc md me b">migrationToAlertRulesCompleted</code>。</p><figure class="mf mg mh mi fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mz"><img src="../Images/a700e7d2f3ae2ccd1d0639991e406bab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*PQ0NV0wX1WSjtap8"/></div></div></figure><p id="0816" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">但是，由于我们想要一个自动化的部署，我们必须寻找一种不同的方式。<code class="du mb mc md me b">azurerm</code>不支持<code class="du mb mc md me b">ProactiveDetectionConfigs</code>的部署。这就是为什么我们使用<code class="du mb mc md me b">azapi</code>提供者，它允许自动部署<code class="du mb mc md me b">azurerm</code>没有覆盖的资源。</p><p id="7144" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下面的块使用<code class="du mb mc md me b">azapi_update_resource</code>来添加或修改<code class="du mb mc md me b">migrationToAlertRulesCompleted</code>资源。</p><pre class="mf mg mh mi fd mj me mk ml aw mm bi"><span id="ea8d" class="ln jw hi me b fi mn mo l mp mq">resource "azapi_update_resource" "application_insights_migrate_to_alerts" {<br/>  type      = "Microsoft.Insights/components/ProactiveDetectionConfigs@2018-05-01-preview"<br/>  name      = "migrationToAlertRulesCompleted"<br/>  parent_id = azurerm_application_insights.example.id<br/><br/>  body = jsonencode({<br/>    properties = {<br/>      Name                           = "migrationToAlertRulesCompleted"<br/>      SendEmailsToSubscriptionOwners = false<br/>      Enabled                        = true<br/>      CustomEmails                   = []<br/>    }<br/>  })<br/><br/>  depends_on = [<br/>    azurerm_monitor_smart_detector_alert_rule.request_performance_degradation_detector<br/>  ]<br/>}</span></pre><p id="df2f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">随着<code class="du mb mc md me b">migrationToAlertRulesCompleted</code>资源启用，Application Insight现在了解Azure Monitor中的智能检测。Application Insights中的设置刀片现在显示新的Azure Monitor警报规则，而不是显示内部智能检测机制。</p><figure class="mf mg mh mi fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mz"><img src="../Images/b681bb811c3d3017ca101fb954b3ceb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*NuW_fY-CHfvnM2tL"/></div></div></figure></div><div class="ab cl jo jp gp jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="hb hc hd he hf"><h1 id="d39f" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">特殊情况:“故障异常”</h1><p id="6ad4" class="pw-post-body-paragraph iq ir hi is b it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj kx jl jm jn hb bi translated">智能检测器<code class="du mb mc md me b">FailureAnomaliesDetector</code>是Azure在创建新的应用洞察实例时创建的。在此创建过程中，默认操作组应用于规则。使用该组，当警报发生时，分配给订阅的角色为“监视参与者”和“监视读者”的所有身份都会得到通知。目前没有办法阻止或改变这种行为。但是Terraform和<code class="du mb mc md me b">azapi</code>提供救援。</p><p id="2269" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">由于<code class="du mb mc md me b">azurerm</code>提供者<a class="ae lm" href="https://github.com/hashicorp/terraform-provider-azurerm/releases/tag/v3.0.0" rel="noopener ugc nofollow" target="_blank">版本3.0.0 </a> Terraform可以使用<code class="du mb mc md me b">disable_generated_rule</code>标志禁用警报规则。</p><pre class="mf mg mh mi fd mj me mk ml aw mm bi"><span id="cbc5" class="ln jw hi me b fi mn mo l mp mq">provider "azurerm" {<br/>  features {<br/>    application_insights {<br/>      disable_generated_rule = true<br/>    }<br/>  }<br/>}</span></pre><p id="d866" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">设置了此标志后，仍会使用默认操作组创建警报规则“故障异常”。但是，默认情况下，该规则是禁用的。</p><p id="2e67" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">但是如果我们想使用智能探测器，这不是正确的方法。相反，我们需要在我们的自动化Terraform部署中调整规则。由于我们无法创建规则(因为它是通过Application Insights隐式创建的)，我们可以将其导入Terraform状态，或者通过再次使用<code class="du mb mc md me b">azapi</code> Terraform提供程序来调整规则。</p><p id="459c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下一个代码块可用于修改故障异常规则。在本例中，操作组被映射到我们之前创建的组，并且规则被启用。</p><pre class="mf mg mh mi fd mj me mk ml aw mm bi"><span id="2427" class="ln jw hi me b fi mn mo l mp mq">resource "azapi_update_resource" "failure_anomalies_detector" {<br/>  type      = "Microsoft.AlertsManagement/SmartDetectorAlertRules@2021-04-01"<br/>  name      = "Failure Anomalies - ${azurerm_application_insights.example.name}"<br/>  parent_id = azurerm_resource_group.example.id</span><span id="d539" class="ln jw hi me b fi na mo l mp mq">  body = jsonencode({<br/>    properties = {<br/>      state: "Enabled",<br/>      actionGroups = {<br/>        groupIds = [<br/>          azurerm_monitor_action_group.example.id<br/>        ]<br/>      }<br/>    }<br/>  })</span><span id="7231" class="ln jw hi me b fi na mo l mp mq">  depends_on = [<br/>    azurerm_application_insights.default<br/>  ]<br/>}</span></pre></div><div class="ab cl jo jp gp jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="hb hc hd he hf"><h1 id="d166" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">包扎</h1><p id="f786" class="pw-post-body-paragraph iq ir hi is b it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj kx jl jm jn hb bi translated">在本文中，我向您解释了如何为Application Insights创建Terraform部署。使用新的基于警报的智能检测功能，现在可以根据需要配置警报，并使用操作组通知合适的人员。由于在<code class="du mb mc md me b">azurerm</code> Terraform provider中并非所有需要的功能都可用，我们还使用了<code class="du mb mc md me b">azapi</code> provider，该provider支持使用<code class="du mb mc md me b">azurerm</code> provider尚未涵盖的功能。因此，我们可以使用完全自动化的部署作为基础设施和代码来创建和配置应用洞察。</p><p id="3884" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你喜欢这篇文章，并希望看到更多与编码相关的内容，请在我的社交档案中关注我。</p></div></div>    
</body>
</html>