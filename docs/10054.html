<html>
<head>
<title>Go serverless: GCP Cloud Functions, explained</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">去无服务器:GCP云功能，解释</h1>
<blockquote>原文：<a href="https://medium.com/codex/go-serverless-gcp-cloud-functions-explained-64cb0a38cc7b?source=collection_archive---------15-----------------------#2022-11-29">https://medium.com/codex/go-serverless-gcp-cloud-functions-explained-64cb0a38cc7b?source=collection_archive---------15-----------------------#2022-11-29</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="f234" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">以及如何构建和(本地)测试您自己的无服务器Python函数</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/4f2ca2784738adb655ba1c390067ae41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*h5YqUblkMUrCuE9Z"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">由<a class="ae jn" href="https://unsplash.com/@nasa?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> NASA </a>在<a class="ae jn" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="7383" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">谷歌云平台提供了所有行业标准的云处理工具，包括存储和计算，并且是我选择的数据科学任务的云提供商(即因为生态系统与其他GCP工具，如BigQuery或Airflow，提供直观的数据工程和MLOps工具)。它还为AWS Lambda提供了一种替代方案，这种服务提供了托管无服务器功能的能力，称为云功能。</p><h2 id="7f3f" class="kk kl hi bd km kn ko kp kq kr ks kt ku jx kv kw kx kb ky kz la kf lb lc ld le bi translated">“无服务器”是什么意思？</h2><p id="9a36" class="pw-post-body-paragraph jo jp hi jq b jr lf ij jt ju lg im jw jx lh jz ka kb li kd ke kf lj kh ki kj hb bi translated">“无服务器”实际上并不意味着您的代码在没有服务器的情况下运行。事实上，您可以在本地服务器上运行无服务器功能(我们稍后会谈到这一点)。无服务器指的是这样一个事实，作为一个客户端，你不必每次想运行你的一些代码时都要安装和关闭一个服务器，你也绝对不必处理服务器的维护或初始化(云提供商处理这些)。相反，你可以编写一些代码，在每次向服务器发出<em class="lk">请求</em>时运行——大多数无服务器计算提供商的运行时间限制在10秒左右，偶尔他们会允许几分钟的异步调用。这意味着它们最适合于不需要存储任何数据的任务，只需要发出一个POST请求，对数据做一些事情，然后在几秒钟后关闭。</p><h1 id="eb6d" class="ll kl hi bd km lm ln lo kq lp lq lr ku io ls ip kx ir lt is la iu lu iv ld lv bi translated">编写自己的无服务器函数</h1><p id="7c1d" class="pw-post-body-paragraph jo jp hi jq b jr lf ij jt ju lg im jw jx lh jz ka kb li kd ke kf lj kh ki kj hb bi translated">Cloud Functions支持Python，以及其他几种标准语言，尽管它像许多其他云无服务器提供商一样，也允许您指定自己的运行时。本教程的其余部分将涉及Python，但是您可以很容易地将这些概念扩展到您选择的编程语言。</p><p id="5c6c" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">要进行本地测试，您只需要一个名为<strong class="jq hj"> main.py </strong>的脚本，放在新文件夹<strong class="jq hj">、</strong>中，您可以在其中定义任何想要的函数。唯一的规定是函数<em class="lk">必须</em>返回一些东西，最好是一个JSON或者一段文本。例如，在<strong class="jq hj"> main.py </strong>中:</p><pre class="iy iz ja jb fd lw lx ly bn lz ma bi"><span id="b3e9" class="mb kl hi lx b be mc md l me mf">def say_hello(event):<br/>    name = request.args.get('name', None)<br/>    if name is None:<br/>        return f"Hi there!"<br/>    else:<br/>        return f"Hi, {name}!"</span></pre><p id="1983" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">其中<code class="du mg mh mi lx b">request</code>是<code class="du mg mh mi lx b">Flask.request</code>对象。</p><p id="22a7" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">接下来，你需要安装<em class="lk"> functions-framework </em>，这是GCP为运行他们的云功能而开发的框架。在Python中，它实际上只是Flask的一个包装器，处理POST请求的请求信息。可以用<code class="du mg mh mi lx b">pip install functions-framework</code>安装。</p><p id="20f5" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">现在在您的终端中运行<code class="du mg mh mi lx b">functions-framework --target=say_hello</code>。您的服务器现在正在运行，可能在<a class="ae jn" href="http://localhost:8080." rel="noopener ugc nofollow" target="_blank"> http://localhost:8080上。</a></p><p id="1232" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">要发出POST请求，要么使用<code class="du mg mh mi lx b">curl</code>，要么编写第二个可以运行的Python脚本，如下所示:</p><pre class="iy iz ja jb fd lw lx ly bn lz ma bi"><span id="2abe" class="mb kl hi lx b be mc md l me mf">import requests<br/><br/>params = {<br/>    "name": "Neha"<br/>}<br/><br/>print(requests.post("http://localhost:8080", json=params).content)</span></pre><p id="8214" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">稍后，在云函数上，您将需要一个<code class="du mg mh mi lx b">requirements.txt</code>文件。我推荐通过<code class="du mg mh mi lx b">conda create &lt;env_name&gt;</code>创建一个新的<code class="du mg mh mi lx b">conda</code>环境，然后是<code class="du mg mh mi lx b">conda activate &lt;env_name&gt;</code>。这样，您就可以跟踪您必须为这个项目单独安装的模块，以及一个特定的Python运行时(如果您愿意指定的话)。要在最后导出需求，运行<code class="du mg mh mi lx b">pip list --format=freeze &gt; requirements.txt</code>。</p><h1 id="f835" class="ll kl hi bd km lm ln lo kq lp lq lr ku io ls ip kx ir lt is la iu lu iv ld lv bi translated">托管在GCP云功能上</h1><p id="ffcf" class="pw-post-body-paragraph jo jp hi jq b jr lf ij jt ju lg im jw jx lh jz ka kb li kd ke kf lj kh ki kj hb bi translated">你需要一个有效的谷歌云平台帐户才能使用云功能。一旦你注册了，在你的第一个项目的<strong class="jq hj">产品</strong>中查找“云功能”。按照步骤设置和部署您的第一个云功能！您可以从多个运行时中进行选择，或者使用一个定制的运行时，并使用内联代码编辑器或以. zip格式上传文件。</p><p id="d6e4" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">记下一些权限:</p><ol class=""><li id="d046" class="mj mk hi jq b jr js ju jv jx ml kb mm kf mn kj mo mp mq mr bi translated">如果您希望您的API对公众可见，请确保您已经选择了<strong class="jq hj">编辑</strong> &gt; <em class="lk">运行时、构建、连接和安全设置下的<em class="lk">允许所有流量</em>。</em>这确保了所有的流量实际上都能够<em class="lk">访问</em>你的功能。</li><li id="c42a" class="mj mk hi jq b jr ms ju mt jx mu kb mv kf mw kj mo mp mq mr bi translated">如果你想让所有的流量都能运行你的功能，你需要多一个权限:转到权限标签，然后点击授权访问添加一个新用户。新用户的名称应该是“allUsers”给他们“云功能调用者”的角色。</li></ol><p id="7f45" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">编码快乐！</p></div><div class="ab cl mx my gp mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="hb hc hd he hf"><p id="a441" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">Neha Desaraju是德克萨斯大学奥斯汀分校学习计算机科学的学生。你可以在网上的<a class="ae jn" href="https://estaudere.github.io/" rel="noopener ugc nofollow" target="_blank"><strong class="jq hj">estau dere . github . io</strong></a><strong class="jq hj">找到她。</strong></p></div></div>    
</body>
</html>