<html>
<head>
<title>Configure cluster access via Okta</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过Okta配置集群访问</h1>
<blockquote>原文：<a href="https://medium.com/codex/configure-cluster-access-via-okta-661d159efc5?source=collection_archive---------7-----------------------#2021-07-31">https://medium.com/codex/configure-cluster-access-via-okta-661d159efc5?source=collection_archive---------7-----------------------#2021-07-31</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="4f1c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，您希望使用Okta通过OIDC配置对kubernetes集群的访问。事实证明，这比您想象的要简单得多，您应该在5-10分钟内启动并运行。</p><p id="f303" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可以在Github <a class="ae jd" href="https://github.com/joshes/example-clusters-using-okta" rel="noopener ugc nofollow" target="_blank">这里</a>找到一些样本代码和例子。</p><p id="6985" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本例中，我们将使用minikube。就配置而言，minikube和AWS的EKS产品之间唯一真正的区别是API服务器是如何配置的。Minikube通过启动标志完成，EKS通过身份验证配置完成(可以作为IaC或通过AWS控制台完成)。稍后会详细介绍。</p><h1 id="8dc3" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">配置Okta</h1><p id="f8e3" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">如果你还没有一个Okta账户，那就去<a class="ae jd" href="https://developer.okta.com/signup/" rel="noopener ugc nofollow" target="_blank">创建一个开发者账户</a>，最多允许5个申请。</p><p id="e074" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，让我们创建一个组并将其分配给我们自己。进入“目录”和“组”，点击“添加组”。给它起个对你有用的名字，我把我的命名为“Minikube用户”。</p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es kh"><img src="../Images/56dd656a9d85387bf5772131c6319e4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*enCis3Bqkq1EhmKo_ieREA.png"/></div></div></figure><p id="e70a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">点击你新创建的群，点击“管理人员”并添加你自己(如果这是一个新的Okta帐户，它将是列表中唯一的用户— <em class="kt">简单！</em>)到组并保存。</p><p id="50b1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，创建一个新的应用程序集成，并选择“OIDC-OpenID连接”和“本地应用程序”选项。</p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es ku"><img src="../Images/4d9ecd4c1f75005ac65faa0939c43827.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_dbiL--WJdv8Wj-aJKVCwg.png"/></div></div></figure><p id="968b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">保持默认值选中，将“授权类型”保留为“授权代码”。</p><p id="8c6d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，更新登录和注销重定向URL，将两者都设置为以下内容:</p><ul class=""><li id="e90e" class="kv kw hi ih b ii ij im in iq kx iu ky iy kz jc la lb lc ld bi translated"><a class="ae jd" href="http://localhost:8000" rel="noopener ugc nofollow" target="_blank"> http://localhost:8000 </a></li><li id="b275" class="kv kw hi ih b ii le im lf iq lg iu lh iy li jc la lb lc ld bi translated"><a class="ae jd" href="http://localhost:18000" rel="noopener ugc nofollow" target="_blank"> http://localhost:18000 </a></li></ul><p id="f26d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">选中“分配”部分下的“限制对选定组的访问”并选择之前创建的MiniKube组。</p><p id="6d2c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建之后，记下客户机Id和Okta域，以便稍后配置kubectl客户机。</p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es lj"><img src="../Images/b64fe335819becefc504f3cec9def672.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0BnpzJ0C2h2S9_TnBOIR_g.png"/></div></div></figure><h2 id="f661" class="lk jf hi bd jg ll lm ln jk lo lp lq jo iq lr ls js iu lt lu jw iy lv lw ka lx bi translated">揭露该团体的主张</h2><p id="99ac" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">因为我们使用组来更容易地在集群上分配权限，所以我们需要确保Okta OIDC集成实际上公开了组。在更类似于生产的设置中，可以创建许多组来发布集群中的正确权限集(例如，生产集群管理员、生产集群审计员、非生产开发人员等)。).不过，在这个演练中，我们尽量保持简单。</p><p id="1dad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在Okta中，单击左侧的安全导航链接，然后选择API选项(您可能需要向下滚动一点才能看到它)。</p><p id="b07a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">单击默认授权服务器，然后单击“Scopes”选项卡部分并添加一个新的范围。将所有文本字段设置为“组”，并选中“包含在公共元数据中”并保存。</p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es ly"><img src="../Images/6e1bce51d0a014ab12f5001f992ffe53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KHu_na2d3N9gRIhXctMK6Q.png"/></div></div></figure><p id="cee7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在转到“索赔”选项卡部分，向“ID”索赔类型添加新索赔。按如下方式设置值:</p><ul class=""><li id="31ab" class="kv kw hi ih b ii ij im in iq kx iu ky iy kz jc la lb lc ld bi translated"><strong class="ih hj">名称:</strong>团体</li><li id="812b" class="kv kw hi ih b ii le im lf iq lg iu lh iy li jc la lb lc ld bi translated"><strong class="ih hj">包含在令牌类型中:</strong> ID令牌，始终</li><li id="1fd8" class="kv kw hi ih b ii le im lf iq lg iu lh iy li jc la lb lc ld bi translated"><strong class="ih hj">值类型:</strong>组</li><li id="8757" class="kv kw hi ih b ii le im lf iq lg iu lh iy li jc la lb lc ld bi translated"><strong class="ih hj">过滤器:</strong>匹配正则表达式，。*</li><li id="f33e" class="kv kw hi ih b ii le im lf iq lg iu lh iy li jc la lb lc ld bi translated"><strong class="ih hj">禁用索赔:</strong>不勾选</li><li id="211c" class="kv kw hi ih b ii le im lf iq lg iu lh iy li jc la lb lc ld bi translated"><strong class="ih hj">包括在:</strong>以下范围，“组”</li></ul><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es lz"><img src="../Images/beadb15d771784edc8c01c375532ebd9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zniAjPJClfB6q_Qq55DBsA.png"/></div></div></figure><p id="be85" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在进入“访问策略”选项卡部分，Okta马上就要完成了！添加一个新策略，并将其命名为对您有用的名称，我选择了“Minikube Cluster”。最重要的是，将“分配给”设置为以下客户端，并选择您的应用程序名称(在我的例子中，它被命名为Minikube)。一致性使这变得简单。</p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es ma"><img src="../Images/567fc6f00a58c193ab7a173eae0a08de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4OiFosDZz4XFYswzkJqy2Q.png"/></div></div></figure><h2 id="6312" class="lk jf hi bd jg ll lm ln jk lo lp lq jo iq lr ls js iu lt lu jw iy lv lw ka lx bi translated">确认Okta设置正确</h2><p id="cb6a" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">转到“令牌预览”选项卡部分，确认您的令牌上的组正在进入。</p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es mb"><img src="../Images/a551142991f39e66c38d48afac0f8e74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aH_QLzjYlTanuHJAwLYTow.png"/></div></div></figure><p id="14d2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="kt">注意:</em> </strong> <em class="kt">在上面的图片中，我已经将我的用户添加到了“Everyone”组中，所以如果按照这个步骤进行操作，您可能看不到这一点。</em></p><h1 id="2495" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">配置集群</h1><p id="7121" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">我将尝试概述如何更新我已配置的几种类型的集群，当然有大量的提供者，但一般来说，这里的想法是更新Kubernetes API服务器的启动标志，以包括相关的OIDC标志，这是一项简单的任务。</p><p id="8891" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您将需要之前创建应用程序集成时的客户端Id和Okta域值。如果你没有，不要担心——只要打开Okta，点击你的应用程序并立即获取它们。我将它们称为向前移动的<code class="du mc md me mf b">$CLIENT_ID</code>和<code class="du mc md me mf b">$OKTA_DOMAIN</code>。</p><h2 id="0f9e" class="lk jf hi bd jg ll lm ln jk lo lp lq jo iq lr ls js iu lt lu jw iy lv lw ka lx bi translated">迷你库贝</h2><p id="4ee1" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">如果您的minikube集群已经在运行，请停止它，并使用以下启动标志重新启动它。</p><pre class="ki kj kk kl fd mg mf mh mi aw mj bi"><span id="423c" class="lk jf hi mf b fi mk ml l mm mn">minikube start \<br/>  --extra-config=apiserver.oidc-issuer-url=https://$OKTA_DOMAIN/oauth2/default \<br/>  --extra-config=apiserver.oidc-client-id=$CLIENT_ID \<br/>  --extra-config=apiserver.oidc-username-prefix=oidc: \<br/>  --extra-config=apiserver.oidc-username-claim=sub \<br/>  --extra-config=apiserver.oidc-groups-prefix=oidc: \<br/>  --extra-config=apiserver.oidc-groups-claim=groups</span></pre><h2 id="8e54" class="lk jf hi bd jg ll lm ln jk lo lp lq jo iq lr ls js iu lt lu jw iy lv lw ka lx bi translated">AWS EKS</h2><p id="4cef" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">和所有事情一样，你可以用几种方法来做这件事。为了简单起见，我将解释如何使用AWS控制台，它可以很好地转换为任何自动化工具或CLI。</p><p id="66d9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">打开AWS控制台，导航到EKS集群并选择您的集群。现在选择“身份验证”选项卡，并关联一个新的身份提供者。</p><p id="68af" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于配置，使用以下选项，如果需要，展开高级选项部分:</p><ul class=""><li id="06be" class="kv kw hi ih b ii ij im in iq kx iu ky iy kz jc la lb lc ld bi translated"><strong class="ih hj">发行人网址:</strong> <code class="du mc md me mf b">https://$OKTA_DOMAIN/oauth2/default</code></li><li id="48ec" class="kv kw hi ih b ii le im lf iq lg iu lh iy li jc la lb lc ld bi translated"><strong class="ih hj">客户端ID:</strong>T3】</li><li id="34b2" class="kv kw hi ih b ii le im lf iq lg iu lh iy li jc la lb lc ld bi translated"><strong class="ih hj">用户名声明:</strong> sub</li><li id="6008" class="kv kw hi ih b ii le im lf iq lg iu lh iy li jc la lb lc ld bi translated"><strong class="ih hj">团体索赔:</strong>团体索赔</li><li id="b48f" class="kv kw hi ih b ii le im lf iq lg iu lh iy li jc la lb lc ld bi translated"><strong class="ih hj">组前缀:</strong> oidc: <em class="kt">(是的，那是一个结尾冒号)</em></li><li id="b7ec" class="kv kw hi ih b ii le im lf iq lg iu lh iy li jc la lb lc ld bi translated"><strong class="ih hj">用户名前缀:</strong> oidc: <em class="kt">(是的，那是尾随冒号)</em></li></ul><p id="f230" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">保存。根据我的经验，这需要一段时间才能生效，所以抓紧时间，喝杯咖啡吧。☕️</p><h1 id="6026" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">配置集群中的角色</h1><p id="4143" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">因为我们只有一个Okta组，所以我们只用一个<code class="du mc md me mf b">ClusterRole</code>和<code class="du mc md me mf b">ClusterRoleBinding</code>将这些点连接起来，以确保用户有访问权和一组权限，并显示我们的系统正在工作。</p><p id="e335" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于我们的示例，我们将使用下面的简单访问策略，允许组使用<code class="du mc md me mf b">list</code>、<code class="du mc md me mf b">get</code>和<code class="du mc md me mf b">watch</code>pod和名称空间来证明我们的系统工作正常(注意<code class="du mc md me mf b">oidc:Minikube Users</code>组——这与前面提到的ID令牌组一致)。</p><p id="dd97" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">参见本文档，了解更多关于<a class="ae jd" href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/" rel="noopener ugc nofollow" target="_blank">基于角色的访问控制</a> (RBAC)以及如何将RBAC应用于您的情况的信息。</p><pre class="ki kj kk kl fd mg mf mh mi aw mj bi"><span id="0fa7" class="lk jf hi mf b fi mk ml l mm mn"># example-role.yaml<br/># apply via: kubectl apply -f example-role.yaml</span><span id="47a2" class="lk jf hi mf b fi mo ml l mm mn">---<br/>kind: ClusterRole<br/>apiVersion: rbac.authorization.k8s.io/v1<br/>metadata:<br/>  name: example-role<br/>rules:<br/>  - apiGroups: [""]<br/>    resources: ["namespaces","pods"]<br/>    verbs: ["get", "watch", "list"]</span><span id="8269" class="lk jf hi mf b fi mo ml l mm mn">---<br/>kind: ClusterRoleBinding<br/>apiVersion: rbac.authorization.k8s.io/v1<br/>metadata:<br/>  name: example-crb<br/>roleRef:<br/>  apiGroup: rbac.authorization.k8s.io<br/>  kind: ClusterRole<br/>  name: example-role<br/>subjects:<br/>- kind: Group<br/>  name: "oidc:Minikube Users"<br/>  apiGroup: rbac.authorization.k8s.io</span></pre><p id="d6d5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将这些配置放入集群的最快方法是将上述内容复制/粘贴到文件<code class="du mc md me mf b">example-role.yaml</code>中，并通过终端<code class="du mc md me mf b">kubectl apply -f example-role.yaml</code>应用。</p><h1 id="3eef" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">配置kubectl客户机</h1><p id="c2ee" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">最后一英里！好了，现在我们有了一个配置好的OIDC提供者和集群来连接这些点。为此，我们将通过<a class="ae jd" href="https://krew.sigs.k8s.io/" rel="noopener ugc nofollow" target="_blank"> krew </a>使用一个<a class="ae jd" href="https://kubernetes.io/docs/tasks/tools/#kubectl" rel="noopener ugc nofollow" target="_blank"> kubectl </a>插件。</p><h2 id="4fe9" class="lk jf hi bd jg ll lm ln jk lo lp lq jo iq lr ls js iu lt lu jw iy lv lw ka lx bi translated">安装krew插件管理器</h2><p id="561b" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">完整安装选项<a class="ae jd" href="https://krew.sigs.k8s.io/docs/user-guide/setup/install/" rel="noopener ugc nofollow" target="_blank">这里</a>，这是bash和zsh shells的快速设置方法。</p><pre class="ki kj kk kl fd mg mf mh mi aw mj bi"><span id="bba9" class="lk jf hi mf b fi mk ml l mm mn"># for bash or zsh<br/>(<br/>  <em class="kt">set</em> -x; <em class="kt">cd</em> "$(mktemp -d)" &amp;&amp;<br/>  <em class="kt">OS</em>="$(uname | tr '[:upper:]' '[:lower:]')" &amp;&amp;<br/>  <em class="kt">ARCH</em>="$(uname -m | sed -e 's/x86_64/amd64/' -e 's/\(arm\)\(64\)\?.*/\1\2/' -e 's/aarch64$/arm64/')" &amp;&amp;<br/>  curl -fsSLO "https://github.com/kubernetes-sigs/krew/releases/latest/download/krew.tar.gz" &amp;&amp;<br/>  tar zxvf krew.tar.gz &amp;&amp;<br/>  <em class="kt">KREW</em>=./krew-"${<em class="kt">OS</em>}_${<em class="kt">ARCH</em>}" &amp;&amp;<br/>  "<em class="kt">$KREW</em>" install krew<br/>)</span><span id="f037" class="lk jf hi mf b fi mo ml l mm mn"><em class="kt"># Add this to your .bashrc or .zshrc<br/>export</em> <em class="kt">PATH</em>="${<em class="kt">KREW_ROOT</em>:-<em class="kt">$HOME</em>/.krew}/bin:<em class="kt">$PATH</em>"</span><span id="79d6" class="lk jf hi mf b fi mo ml l mm mn"># Confirm installation<br/>kubectl krew version</span></pre><h2 id="7bec" class="lk jf hi bd jg ll lm ln jk lo lp lq jo iq lr ls js iu lt lu jw iy lv lw ka lx bi translated">配置您的kubeconfig</h2><p id="5229" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">在下面的代码片段中，我们配置我们的kubeconfig <code class="du mc md me mf b">~/.kube/config</code>来创建一个新用户<code class="du mc md me mf b">oidc-user</code>(根据您的需要进行更新)，可以像<code class="du mc md me mf b">kubectl get pods --user oidc-user</code>一样使用</p><pre class="ki kj kk kl fd mg mf mh mi aw mj bi"><span id="3a1b" class="lk jf hi mf b fi mk ml l mm mn">kubectl config set-credentials oidc-user \<br/>  --exec-api-version=client.authentication.k8s.io/v1beta1 \<br/>  --exec-command=kubectl \<br/>  --exec-arg=oidc-login \<br/>  --exec-arg=get-token \<br/>  --exec-arg=--oidc-issuer-url=https://$OKTA_DOMAIN/oauth2/default \<br/>  --exec-arg=--oidc-client-id=$CLIENT_ID \<br/>  --exec-arg=--oidc-extra-scope=groups</span></pre><h1 id="29f8" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">收尾工作</h1><p id="f4aa" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">要确认其工作正常，请尝试将pod列为<code class="du mc md me mf b">oidc-user</code></p><pre class="ki kj kk kl fd mg mf mh mi aw mj bi"><span id="7e0a" class="lk jf hi mf b fi mk ml l mm mn"># This should work<br/>kubectl get pods --user oidc-user</span><span id="e1ba" class="lk jf hi mf b fi mo ml l mm mn"># This should NOT work<br/>kubectl get cronjobs --user oidc-user</span></pre><h2 id="c265" class="lk jf hi bd jg ll lm ln jk lo lp lq jo iq lr ls js iu lt lu jw iy lv lw ka lx bi translated">后续步骤</h2><ul class=""><li id="ac5f" class="kv kw hi ih b ii kc im kd iq mp iu mq iy mr jc la lb lc ld bi translated">正式确定Okta组以及它们在您的集群中应该如何对齐</li><li id="a08e" class="kv kw hi ih b ii le im lf iq lg iu lh iy li jc la lb lc ld bi translated">根据需要创建<code class="du mc md me mf b">ClusterRoles</code>和<code class="du mc md me mf b">ClusterRoleBindings</code>(或<code class="du mc md me mf b">RoleBindings</code>)，并将它们与您的Okta组对齐</li></ul><h2 id="254b" class="lk jf hi bd jg ll lm ln jk lo lp lq jo iq lr ls js iu lt lu jw iy lv lw ka lx bi translated">陷阱&amp;需要寻找的东西</h2><p id="2f6d" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">我在测试的时候遇到了一些事情。</p><p id="42fc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Okta的App Integration部分显示的<code class="du mc md me mf b">$OKTA_DOMAIN</code>很容易意外粘贴到需要issuer-url值的地方。其实是<em class="kt"/><code class="du mc md me mf b">https://$OKTA_DOMAIN/oauth2/domain</code>不是<code class="du mc md me mf b">http://$OKTA_DOMAIN</code>或者只是<code class="du mc md me mf b">$OKTA_DOMAIN.</code></p><p id="aa9b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可以把整个过程想象成3个不同的配置，这样想有助于调试。</p><ol class=""><li id="f45e" class="kv kw hi ih b ii ij im in iq kx iu ky iy kz jc ms lb lc ld bi translated">配置Okta并确保令牌预览工作。如果这有效，你可以进行第二步。</li><li id="7f18" class="kv kw hi ih b ii le im lf iq lg iu lh iy li jc ms lb lc ld bi translated">配置API服务器。如果您可以验证启动标志已经在集群中应用，请继续执行步骤#3。</li><li id="de34" class="kv kw hi ih b ii le im lf iq lg iu lh iy li jc ms lb lc ld bi translated">配置您的kubeconfig。如果kube-config已经设置好了，并且你可以通过检查你的<code class="du mc md me mf b">~/.kube/config</code>(或者类似的设备)来验证它，那么你应该没问题。</li></ol><p id="72e8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">思考每一部分如何进入下一部分有助于隔离调试空间。</p><p id="2950" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我希望你发现这是有用的！</p></div></div>    
</body>
</html>