<html>
<head>
<title>Building a Newegg Web Scraper (Part 2)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建新蛋网刮刀(第2部分)</h1>
<blockquote>原文：<a href="https://medium.com/codex/building-a-newegg-web-scraper-part-2-90eb8d953bde?source=collection_archive---------8-----------------------#2021-01-21">https://medium.com/codex/building-a-newegg-web-scraper-part-2-90eb8d953bde?source=collection_archive---------8-----------------------#2021-01-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><h2 id="ae97" class="hg hh hi bd b fp hj hk hl hm hn ho dx hp translated" aria-label="kicker paragraph"><a class="ae ge" href="http://medium.com/codex" rel="noopener">法典</a></h2><div class=""/><div class=""><h2 id="e501" class="pw-subtitle-paragraph io hr hi bd b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf dx translated">将所有东西整合在一起</h2></div><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es jg"><img src="../Images/fbe3ce81ff237c03e67c87b9e34805d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*K2IaFB-fqZl9krjh"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx translated">由<a class="ae jw" href="https://unsplash.com/@goshua13?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">约书亚·阿拉贡</a>在<a class="ae jw" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure></div><div class="ab cl jx jy gp jz" role="separator"><span class="ka bw bk kb kc kd"/><span class="ka bw bk kb kc kd"/><span class="ka bw bk kb kc"/></div><div class="hb hc hd he hf"><h2 id="76b3" class="ke kf hi bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ho bi translated">添加导入</h2><figure class="jh ji jj jk fd jl"><div class="bz dy l di"><div class="lb lc l"/></div></figure><p id="c533" class="pw-post-body-paragraph ld le hi lf b lg lh is li lj lk iv ll kp lm ln lo kt lp lq lr kx ls lt lu lv hb bi translated">上面的代码导入了BeautifulSoup库、urlopen函数、Beautiful Soup函数和csv模块。随着我们继续编写代码，您将会看到这些东西是如何使用的。</p><h2 id="66a0" class="ke kf hi bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ho bi translated">获取HTML并执行解析</h2><figure class="jh ji jj jk fd jl"><div class="bz dy l di"><div class="lb lc l"/></div></figure><p id="2d72" class="pw-post-body-paragraph ld le hi lf b lg lh is li lj lk iv ll kp lm ln lo kt lp lq lr kx ls lt lu lv hb bi translated">在Python中，可以通过不同的别名导入函数。所以request(url)和soup(page_html，' html.parser ')实际上分别是urlopen(url)和BeautifulSoup(page_html，' html.parser ')。</p><p id="8f68" class="pw-post-body-paragraph ld le hi lf b lg lh is li lj lk iv ll kp lm ln lo kt lp lq lr kx ls lt lu lv hb bi translated">在第3行到第5行，我们打开URL，获取HTML，并关闭连接。第7行将URL中的HTML代码转换成一个经过解析的文档。第8行调用find_all()来检索与我们想要抓取的显卡直接关联的HTML代码。在这种情况下，find_all()函数通过查找所有具有值为“item-cell”的class属性的div元素来工作。该函数将返回一个列表，其中包含所有符合属性规范的div元素。</p><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es lw"><img src="../Images/239d3a4ca809cbb3584e5abaa48fd10c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*NuBMRTam0kPFwItSujVnEg.gif"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx translated">作者GIF</figcaption></figure><p id="6109" class="pw-post-body-paragraph ld le hi lf b lg lh is li lj lk iv ll kp lm ln lo kt lp lq lr kx ls lt lu lv hb bi translated">在上面的GIF中，你可以看到用class="item-cell "导航到div元素突出显示了整个MSI显卡。这就是为什么我们需要找到所有这些特定的div元素，因为每个元素都包含一个单独的图形卡。</p><p id="06df" class="pw-post-body-paragraph ld le hi lf b lg lh is li lj lk iv ll kp lm ln lo kt lp lq lr kx ls lt lu lv hb bi translated">注意:当光标移动到“查看详细信息”按钮的右侧时，我执行了右键单击并单击了“检查”。录像没有获得那个动作。这就是我如何为网站打开HTML源代码的方法。</p><h2 id="d8db" class="ke kf hi bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ho bi translated">设置要写入的CSV</h2><figure class="jh ji jj jk fd jl"><div class="bz dy l di"><div class="lb lc l"/></div></figure><p id="eb9c" class="pw-post-body-paragraph ld le hi lf b lg lh is li lj lk iv ll kp lm ln lo kt lp lq lr kx ls lt lu lv hb bi translated">在上面的代码中，我们设置了一个CSV文件来存储我们收集的数据。writerow()函数将创建包含四列的第一行。这一行将指示每一列中存储了什么信息。在后面的代码中，我们将再次调用writerow()函数，将抓取的数据连续添加到各个列中。</p><h2 id="dff9" class="ke kf hi bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ho bi translated">广告检测、数据检索和异常处理</h2><figure class="jh ji jj jk fd jl"><div class="bz dy l di"><div class="lb lc l"/></div></figure><p id="6203" class="pw-post-body-paragraph ld le hi lf b lg lh is li lj lk iv ll kp lm ln lo kt lp lq lr kx ls lt lu lv hb bi translated">注意:第1行的for循环将写在“设置要写入的CSV”一节中的file_writer.writerow(['Brand '，' Product Name '，' Price '，' Shipping'])行的下面。</p><p id="0128" class="pw-post-body-paragraph ld le hi lf b lg lh is li lj lk iv ll kp lm ln lo kt lp lq lr kx ls lt lu lv hb bi translated">第2行包含对臭名昭著的广告检测的检查。在新蛋网站上搜索显卡时，你会注意到在所有其他显卡中插入了一个广告。新蛋网站上的图形卡是用一个div元素分类的，该元素具有属性:class="item-cell。"然而，该广告也以相同的属性被分类。这意味着第一次调用find_all()函数会导致广告包含在返回的列表中。因此，我们必须检查不同的指示器(在本例中为“txt-ads-link”)，以确保我们的代码只在图形卡上执行。</p><p id="e76a" class="pw-post-body-paragraph ld le hi lf b lg lh is li lj lk iv ll kp lm ln lo kt lp lq lr kx ls lt lu lv hb bi translated">第4行到第8行检索品牌名称和产品名称。</p><p id="96d4" class="pw-post-body-paragraph ld le hi lf b lg lh is li lj lk iv ll kp lm ln lo kt lp lq lr kx ls lt lu lv hb bi translated">注意:末尾有“tag”的变量(brand_tag，tittle_tag等)。)存储了包含相关数据(商标名、产品名等)的特定HTML标签。).</p><p id="90cb" class="pw-post-body-paragraph ld le hi lf b lg lh is li lj lk iv ll kp lm ln lo kt lp lq lr kx ls lt lu lv hb bi translated">第10到28行检索价格和运输信息。</p><p id="296a" class="pw-post-body-paragraph ld le hi lf b lg lh is li lj lk iv ll kp lm ln lo kt lp lq lr kx ls lt lu lv hb bi translated">注:10行占显卡缺货。如果显卡缺货，那么在获取定价和发货信息时，我们必须执行不同的程序。</p><p id="af9d" class="pw-post-body-paragraph ld le hi lf b lg lh is li lj lk iv ll kp lm ln lo kt lp lq lr kx ls lt lu lv hb bi translated">异常处理是这个web scraper代码的关键组成部分。我对它进行了设置，这样如果出现错误，错误名称、错误消息和出现错误的单元(图形卡)将被打印到控制台/终端。web scraper的代码非常容易出现错误。这是因为网站(尤其是新蛋)在不断更新。以前工作得非常好的代码，一旦引入了最微小的变化(由于没有考虑到变化)，就会遇到障碍。尽管在某些时候会出现错误，但异常处理允许程序处理错误并继续抓取没有潜在问题的显卡。无论是否引发异常，finally语句都将执行，以确保数据写入CSV文件。</p></div><div class="ab cl jx jy gp jz" role="separator"><span class="ka bw bk kb kc kd"/><span class="ka bw bk kb kc kd"/><span class="ka bw bk kb kc"/></div><div class="hb hc hd he hf"><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es lx"><img src="../Images/0705d17ce8be750384520d0338f7b580.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Bxu20nq4X8BlkbLc"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx translated">照片由<a class="ae jw" href="https://unsplash.com/@davealmine?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">达维德·扎维亚</a>在<a class="ae jw" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><h2 id="0fc2" class="ke kf hi bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ho bi translated">最后的想法</h2><p id="80fe" class="pw-post-body-paragraph ld le hi lf b lg ly is li lj lz iv ll kp ma ln lo kt mb lq lr kx mc lt lu lv hb bi translated">我将在我的GitHub上修复任何错误并维护/更新web scraper代码(将在下面的参考资料中链接到)。每次运行代码时，似乎都有一些新的细微差别被Newegg添加到他们的站点中。然而，我会继续努力解决这个过程中反复出现的问题。</p><h2 id="3865" class="ke kf hi bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ho bi translated">参考</h2><p id="37ef" class="pw-post-body-paragraph ld le hi lf b lg ly is li lj lz iv ll kp ma ln lo kt mb lq lr kx mc lt lu lv hb bi translated">数据科学道场。(2017年1月6日)。介绍用Python和漂亮的汤进行网络抓取。【YouTube视频】。数据科学道场。从<a class="ae jw" href="https://www.youtube.com/watch?v=XQgXKtPSzUI&amp;t=205s" rel="noopener ugc nofollow" target="_blank">https://www.youtube.com/watch?v=XQgXKtPSzUI&amp;取回t=205s </a></p><p id="5e66" class="pw-post-body-paragraph ld le hi lf b lg lh is li lj lk iv ll kp lm ln lo kt lp lq lr kx ls lt lu lv hb bi translated">我的<a class="ae jw" href="https://github.com/wormhole85/newegg-web-scraper" rel="noopener ugc nofollow" target="_blank"> GitHub回购</a>的网页抓取器代码。</p></div></div>    
</body>
</html>