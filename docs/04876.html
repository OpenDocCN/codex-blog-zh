<html>
<head>
<title>How to store user passwords in a database?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在数据库中存储用户密码？</h1>
<blockquote>原文：<a href="https://medium.com/codex/how-to-store-user-passwords-in-a-database-1237c37bc52?source=collection_archive---------0-----------------------#2022-01-14">https://medium.com/codex/how-to-store-user-passwords-in-a-database-1237c37bc52?source=collection_archive---------0-----------------------#2022-01-14</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/39eaece12461bc295fbd2da5d965af7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IyH9Iwpzd-gcHxlBnCuLNQ.jpeg"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">在数据库中安全地存储用户密码</figcaption></figure><div class=""/><p id="88b0" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果您仍然以纯文本格式保存用户密码，请遵循本指南来实施简单而可靠的策略来保存用户密码。</p><p id="ccc7" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">用户认证是几乎所有类型的web应用程序都需要的基本实现之一。这听起来很简单，但需要小心操作，以确保您的用户免受数据泄露或潜在安全故障的影响。</p><p id="0ed6" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">简而言之，您永远不应该将用户密码存储在数据库中！是的，你没看错。用户密码(也称为纯文本)不应被存储。相反，我们应该通过将密码转换成散列来存储它们。本指南通过一个非常简单的循序渐进的过程，解释了散列密码并将其存储在数据库中的过程。</p><h1 id="0ae0" class="js jt hx bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">哈希是什么？</h1><p id="2934" class="pw-post-body-paragraph iu iv hx iw b ix kq iz ja jb kr jd je jf ks jh ji jj kt jl jm jn ku jp jq jr hb bi translated">哈希的简单定义:</p><blockquote class="kv kw kx"><p id="a1a1" class="iu iv ky iw b ix iy iz ja jb jc jd je kz jg jh ji la jk jl jm lb jo jp jq jr hb bi translated">哈希是将给定的键转换成另一个值的过程。使用<strong class="iw hy">散列函数</strong>根据数学算法生成新值。哈希函数的结果被称为<strong class="iw hy">哈希值</strong>，或者简称为<strong class="iw hy">哈希</strong>。— <a class="ae lc" href="https://www.educative.io/edpresso/what-is-hashing" rel="noopener ugc nofollow" target="_blank">教育性io </a></p></blockquote><p id="f85c" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">哈希通常是单向函数，由此产生的哈希无法转换回原始源。在用户密码的情况下，一旦你散列它们，你得到一串代表原始文本的字符，但是没有办法把它转换回原始文本。</p><p id="2861" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">请参见下面的哈希字符串示例:</p><figure class="le lf lg lh fd hk er es paragraph-image"><div class="er es ld"><img src="../Images/92ddce1d6255d3d1bdc96e7c17e935b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1064/format:webp/1*Ch7N3TWT4pWzvTYH2xro7g.png"/></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">简单的字符串散列</figcaption></figure><h1 id="d50f" class="js jt hx bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">不要单独哈希密码！</h1><p id="5091" class="pw-post-body-paragraph iu iv hx iw b ix kq iz ja jb kr jd je jf ks jh ji jj kt jl jm jn ku jp jq jr hb bi translated">单独散列用户密码不是一个好的做法。因此，在执行散列之前，您需要将<em class="ky">或其他</em>与密码混合。这个<em class="ky">‘别的东西’</em>叫做‘盐’。</p><h1 id="d313" class="js jt hx bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">什么是盐？</h1><p id="04e7" class="pw-post-body-paragraph iu iv hx iw b ix kq iz ja jb kr jd je jf ks jh ji jj kt jl jm jn ku jp jq jr hb bi translated">让我们先来看看定义:</p><blockquote class="kv kw kx"><p id="c361" class="iu iv ky iw b ix iy iz ja jb jc jd je kz jg jh ji la jk jl jm lb jo jp jq jr hb bi translated">在密码学中，salt是随机数据，用作散列数据、密码或密码短语的单向函数的附加输入。— <a class="ae lc" href="https://en.wikipedia.org/wiki/Salt_(cryptography)" rel="noopener ugc nofollow" target="_blank">维基百科</a></p></blockquote><p id="e725" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">因此，在哈希密码时，我们会在密码中添加一个随机字符串，然后对其进行哈希处理。这里有一个例子:</p><figure class="le lf lg lh fd hk er es paragraph-image"><div class="er es li"><img src="../Images/ec9f6932281aa2e8882df5e0d55c4404.png" data-original-src="https://miro.medium.com/v2/resize:fit:1032/format:webp/1*h-DGrnPfjf2FD91IWFBbxw.png"/></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">密码结合盐进行哈希运算</figcaption></figure><p id="3498" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">您可能会注意到，即使新字符串(P@55wordABCD123)的长度比旧字符串(P@55word)长，哈希值在字符数方面也具有相同的长度。这是由于哈希的工作方式。但是我们在这里不深入讨论这个话题。你可以<a class="ae lc" href="https://en.wikipedia.org/wiki/Cryptographic_hash_function" rel="noopener ugc nofollow" target="_blank">在这里</a>阅读更多关于哈希的内容。</p><p id="de3e" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">关于盐需要注意的要点:</p><ol class=""><li id="6729" class="lj lk hx iw b ix iy jb jc jf ll jj lm jn ln jr lo lp lq lr bi translated">盐的长度不应该像上面例子中所示的那么短。我会推荐20到40个字符的内容。</li><li id="7f63" class="lj lk hx iw b ix ls jb lt jf lu jj lv jn lw jr lo lp lq lr bi translated">盐应该对每个用户都是独一无二的。使用相同的Salt对所有用户密码进行哈希运算是不安全的，也不推荐使用。</li></ol><p id="e040" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">不要被术语“T1”哈希“T2”和“T3”盐“T4”弄得不知所措。这些只是由算法生成的字符串。你不需要学习算法，除非你真的有兴趣知道幕后发生了什么。为了在应用程序中实现散列，您只需要调用几个函数。我们将在下面详细讨论这些步骤。</p><h1 id="3a7d" class="js jt hx bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">在数据库中实现散列密码存储</h1><h2 id="94a8" class="lx jt hx bd ju ly lz ma jy mb mc md kc jf me mf kg jj mg mh kk jn mi mj ko mk bi translated">在数据库中设置用户表</h2><p id="6732" class="pw-post-body-paragraph iu iv hx iw b ix kq iz ja jb kr jd je jf ks jh ji jj kt jl jm jn ku jp jq jr hb bi translated">首先，在用户表中创建两列(除了已经有的其他列，如姓名、电子邮件、电话等。)</p><ol class=""><li id="1324" class="lj lk hx iw b ix iy jb jc jf ll jj lm jn ln jr lo lp lq lr bi translated">PasswordHash(字符串)</li><li id="62c9" class="lj lk hx iw b ix ls jb lt jf lu jj lv jn lw jr lo lp lq lr bi translated">PasswordSalt(字符串)</li></ol><p id="b834" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">名字可以是任何东西，以上名字仅供参考。</p><h2 id="2f62" class="lx jt hx bd ju ly lz ma jy mb mc md kc jf me mf kg jj mg mh kk jn mi mj ko mk bi translated">新用户注册</h2><p id="d020" class="pw-post-body-paragraph iu iv hx iw b ix kq iz ja jb kr jd je jf ks jh ji jj kt jl jm jn ku jp jq jr hb bi translated">每当一个新用户注册时，您都可以将他们的用户名和密码(由用户输入)以及其他字段保存在数据库中。</p><p id="7f43" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在，不要将用户密码直接保存为纯文本，而是按照以下步骤操作:</p><ol class=""><li id="9c12" class="lj lk hx iw b ix iy jb jc jf ll jj lm jn ln jr lo lp lq lr bi translated">随机生成<strong class="iw hy"> <em class="ky">盐</em> </strong>:</li></ol><figure class="le lf lg lh fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ml"><img src="../Images/9b62526f489dbd4133ecf32e8472c355.png" data-original-src="https://miro.medium.com/v2/resize:fit:1338/format:webp/1*3qLiiJzP3-ZFOvUNfwVKxA.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">生成一个随机字符串作为“盐”</figcaption></figure><p id="caab" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">2.计算组合字符串(密码+ Salt)的<strong class="iw hy"> <em class="ky">哈希</em> </strong></p><figure class="le lf lg lh fd hk er es paragraph-image"><div class="er es mm"><img src="../Images/5e157b8bc92e1d0201084af615388de8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1170/format:webp/1*vMwSn_XqpONgmvGC7ghtVQ.png"/></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">计算字符串的散列值</figcaption></figure><p id="c458" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">注意，在上面的例子中，我使用了<strong class="iw hy"> <em class="ky"> SHA256 </em> </strong>加密类来计算散列。这个类在<code class="du mn mo mp mq b">System.Security.Cryptography</code> C#中可用。几乎所有的编程语言都有其他的选择。你可以在这里找到更多关于其他流行加密提供商的信息——<a class="ae lc" href="https://en.wikipedia.org/wiki/MD5" rel="noopener ugc nofollow" target="_blank">MD5</a>、<a class="ae lc" href="https://en.wikipedia.org/wiki/Whirlpool_(hash_function)" rel="noopener ugc nofollow" target="_blank">惠而浦</a>、<a class="ae lc" href="https://en.wikipedia.org/wiki/BLAKE_(hash_function)" rel="noopener ugc nofollow" target="_blank">布雷克</a>。</p><p id="8241" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">3.在数据库中保存<strong class="iw hy"> <em class="ky">哈希密码</em> </strong>和<strong class="iw hy"> <em class="ky">盐</em> </strong></p><p id="644c" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在，您可以将<strong class="iw hy"> <em class="ky">散列密码</em> </strong>和<strong class="iw hy"> <em class="ky"> Salt </em> </strong>保存在数据库中上述相应的列中。这样，我们完全不知道用户的实际密码。您可能会注意到，即使有人可以访问数据库，他们也看不到任何用户的实际密码。此外，即使可以访问<strong class="iw hy"> <em class="ky">散列密码</em> </strong>和<strong class="iw hy"> <em class="ky"> Salt </em> </strong>，也不可能逆向工程找到任何用户的密码。</p><h1 id="a472" class="js jt hx bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">登录时验证用户密码</h1><p id="2427" class="pw-post-body-paragraph iu iv hx iw b ix kq iz ja jb kr jd je jf ks jh ji jj kt jl jm jn ku jp jq jr hb bi translated">您可能想知道在这个阶段，当用户下次尝试登录时，如何验证他们是否输入了正确的密码？因为我们不再存储用户的密码，所以我们不能简单地验证用户输入的纯文本密码的正确性。因此，我们需要遵循相同的散列过程来验证用户输入。下面是它的工作原理:</p><figure class="le lf lg lh fd hk er es paragraph-image"><div class="er es mr"><img src="../Images/8b4fea5e9484d6323c102bc5aab80b4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1172/format:webp/1*x35eGeOZzW28MbBBkDM5xg.png"/></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">使用哈希比较用户输入密码</figcaption></figure><p id="d22d" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这就是如何在应用程序中实现健壮的密码存储机制。这是大多数应用程序遵循的标准方法，还有其他方法可以进一步增强安全性。</p><p id="0ad3" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">希望你喜欢这篇文章，今天学到了一些新东西。如果你有更多的东西要分享，请在评论中留下你的想法。</p></div><div class="ab cl ms mt gp mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="hb hc hd he hf"><p id="57a1" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">为了阅读我所有的故事，以及媒体上成千上万的其他作家，考虑选择媒体会员。如果你使用我的链接加入，我将从你的加入费中获得佣金。祝你好运！</p></div></div>    
</body>
</html>