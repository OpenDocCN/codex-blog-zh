<html>
<head>
<title>Android Jetpack: Lifecycle-aware component (LifecycleEventObserver).</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Android Jetpack:生命周期感知组件(LifecycleEventObserver)。</h1>
<blockquote>原文：<a href="https://medium.com/codex/android-jetpack-lifecycle-aware-components-df0e716648cb?source=collection_archive---------4-----------------------#2022-03-20">https://medium.com/codex/android-jetpack-lifecycle-aware-components-df0e716648cb?source=collection_archive---------4-----------------------#2022-03-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ih ii ij ik er es paragraph-image"><div role="button" tabindex="0" class="il im di in bf io"><div class="er es ig"><img src="../Images/dac8beb85121aa2e2253b0de7b29e4b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rCpb_ExUbzt9c6DS2BCjwg.png"/></div></div><figcaption class="ir is et er es it iu bd b be z dx translated">图片来源:谷歌图片</figcaption></figure><p id="0122" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi jt translated"><span class="l ju jv jw bm jx jy jz ka kb di"> L </span>如果感知生命周期的组件，比如活动和片段，采取行动来响应另一个组件的生命周期状态的变化。这些组件有助于创建更加组织良好的代码，并且在许多情况下，是更易于维护的轻量级代码。</p><p id="9310" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在活动和片段的生命周期方法中实现依赖组件的动作是一种流行的做法。另一方面，这种方法会导致混乱的代码库和大量的错误。通过利用生命周期感知组件，您可以将依赖组件的代码从生命周期方法转移到组件本身。</p><p id="2f3b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">考虑以下场景:我们有一个在屏幕上显示设备位置的活动。下面是一个常见实现的示例:</p><figure class="kc kd ke kf fd ik"><div class="bz dy l di"><div class="kg kh l"/></div></figure><p id="4715" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">尽管这个示例看起来可以工作，但是在真实的项目中，您将会有太多的调用来管理UI和其他组件以响应当前的生命周期状态。生命周期方法，如onStart()和onStop()，在管理几个组件时包含大量代码，使它们难以维护。</p><p id="d554" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">此外，不能保证组件会在活动或片段终止之前开始。如果需要长时间运行的操作，例如onStart()中的配置检查，这一点尤其正确。这可能会导致一种争用情况，在这种情况下，onStop()函数在onStart()方法之前完成，导致组件保持不必要的活动时间。</p></div><div class="ab cl ki kj gp kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="hb hc hd he hf"><p id="de51" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果我告诉你有可能使它更容易实现呢？</p><p id="9ffc" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们看看如何使用生命周期组件。</p><ul class=""><li id="51af" class="kp kq hi ix b iy iz jc jd jg kr jk ks jo kt js ku kv kw kx bi translated"><strong class="ix hj"> <em class="ky"> LifecycleEvents(已弃用):</em> </strong>一个<strong class="ix hj"> <em class="ky"> </em> </strong>已弃用的方法，如果您已经实现了它，让我们看看如何设置它以使用<em class="ky">lifecycleeventsobserver</em></li></ul><figure class="kc kd ke kf fd ik"><div class="bz dy l di"><div class="kg kh l"/></div></figure><p id="fa1d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Android Studio在将生命周期库升级到2.4.0后，将所有生命周期事件标识为不推荐使用。</p><p id="4068" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">不推荐使用它，因为您现在应该使用Java 8并实现DefaultLifecycleObserver接口。因为Java 8允许接口有默认的实现，所以他们创建了DefaultLifecycleObserver，它有所有方法的空实现，所以你只需要覆盖你需要的方法。</p><p id="03c5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">更改您的类以实现DefaultLifecycleObserver，并更改您的函数以覆盖您的情况中必需的DefaultLifecycleObserver函数。如果您的项目还没有使用Java 8，您必须更改您的Gradle构建文件。将这些放入模块的<code class="du kz la lb lc b">build.gradle</code>中的<code class="du kz la lb lc b">android</code>块:</p><figure class="kc kd ke kf fd ik er es paragraph-image"><div role="button" tabindex="0" class="il im di in bf io"><div class="er es ld"><img src="../Images/e1993e82790f31444fbeafec463ec7c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4hd8ubd1sUXJoyD604C9Fw.png"/></div></div><figcaption class="ir is et er es it iu bd b be z dx translated"><code class="du kz la lb lc b">build.gradle(Module)</code></figcaption></figure><p id="5902" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这就是我们现在准备使用的<em class="ky">生命周期事件观察者</em> <strong class="ix hj"> <em class="ky">。</em> </strong></p></div><div class="ab cl ki kj gp kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="hb hc hd he hf"><ul class=""><li id="949f" class="kp kq hi ix b iy iz jc jd jg kr jk ks jo kt js ku kv kw kx bi translated"><strong class="ix hj"><em class="ky">LifecycleEventObserver:</em></strong>是一个类，存储关于组件生命周期状态的信息(比如一个活动或者一个片段)，并允许其他对象查看。</li></ul><p id="d434" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为了监控其相关组件的生命周期状态，<em class="ky">生命周期事件观察者</em>使用了两种主要的枚举:</p><figure class="kc kd ke kf fd ik er es paragraph-image"><div role="button" tabindex="0" class="il im di in bf io"><div class="er es le"><img src="../Images/5985944cba8d52dcf8ebd36d10409611.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Sopy80iLGvITxtckGa1p4g.png"/></div></div><figcaption class="ir is et er es it iu bd b be z dx translated">Android活动生命周期由状态和事件组成。</figcaption></figure><ul class=""><li id="60b7" class="kp kq hi ix b iy iz jc jd jg kr jk ks jo kt js ku kv kw kx bi translated"><strong class="ix hj">事件:</strong>框架和生命周期类的生命周期事件被调度。活动和片段中的回调事件与这些事件相对应。</li><li id="92a9" class="kp kq hi ix b iy lf jc lg jg lh jk li jo lj js ku kv kw kx bi translated"><strong class="ix hj">状态:</strong>一个类可以跟踪一个组件的生命周期。</li></ul></div><div class="ab cl ki kj gp kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="hb hc hd he hf"><p id="6be9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们通过创建LifecycleEventObserver和覆盖onCreate、onStart等方法来看看。然后，如下例所示，您可以通过执行Lifecycle类的addObserver()函数并提供观察者的实例来添加观察者:</p><figure class="kc kd ke kf fd ik"><div class="bz dy l di"><div class="kg kh l"/></div></figure><ul class=""><li id="40ce" class="kp kq hi ix b iy iz jc jd jg kr jk ks jo kt js ku kv kw kx bi translated"><strong class="ix hj"><em class="ky">life cycle owner:</em></strong>life cycle owner接口是一个单一的方法接口，表示一个类是否有生命周期。它只有一个方法，getLifecycle()，该类必须实现它。</li></ul><p id="0bb1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这个接口将生命周期的所有权从特定的类(如Fragment和Activity)中分离出来，允许您编写与之交互的组件。</p></div><div class="ab cl ki kj gp kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="hb hc hd he hf"><p id="6d84" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们通过调用<code class="du kz la lb lc b">Lifecycle</code>类的<code class="du kz la lb lc b">addObserver()</code>方法并传递一个observer实例来添加一个observer</p><figure class="kc kd ke kf fd ik"><div class="bz dy l di"><div class="kg kh l"/></div></figure><p id="82bc" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">就这样，现在代码应该准备好运行并提供所需的输出。</p></div><div class="ab cl ki kj gp kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="hb hc hd he hf"><h1 id="6ee2" class="lk ll hi bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">参考</h1><ul class=""><li id="c727" class="kp kq hi ix b iy mi jc mj jg mk jk ml jo mm js ku kv kw kx bi translated"><a class="ae mn" href="https://developer.android.com/topic/libraries/architecture/lifecycle" rel="noopener ugc nofollow" target="_blank"> <strong class="ix hj">用生命周期感知组件处理生命周期</strong> </a></li><li id="1cc4" class="kp kq hi ix b iy lf jc lg jg lh jk li jo lj js ku kv kw kx bi translated"><a class="ae mn" href="https://developer.android.com/guide/components/activities/activity-lifecycle" rel="noopener ugc nofollow" target="_blank"> <strong class="ix hj">活动生命周期</strong> </a></li><li id="cd2b" class="kp kq hi ix b iy lf jc lg jg lh jk li jo lj js ku kv kw kx bi translated"><a class="ae mn" href="https://developer.android.com/reference/android/arch/lifecycle/LifecycleObserver" rel="noopener ugc nofollow" target="_blank"> <strong class="ix hj">生命周期观察者</strong> </a></li></ul></div><div class="ab cl ki kj gp kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="hb hc hd he hf"><p id="0f30" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这里是你可以找到完整代码的地方。</p><div class="mo mp ez fb mq mr"><a href="https://github.com/vinodbaste/android-lifeCycleAware-component" rel="noopener  ugc nofollow" target="_blank"><div class="ms ab dw"><div class="mt ab mu cl cj mv"><h2 class="bd hj fi z dy mw ea eb mx ed ef hh bi translated">GitHub-vinodbaste/Android-life cycle ware-component:生命周期感知组件，如…</h2><div class="my l"><h3 class="bd b fi z dy mw ea eb mx ed ef dx translated">感知生命周期的组件，比如活动和片段，采取行动来响应生命周期中的变化…</h3></div><div class="mz l"><p class="bd b fp z dy mw ea eb mx ed ef dx translated">github.com</p></div></div><div class="na l"><div class="nb l nc nd ne na nf ip mr"/></div></div></a></div></div><div class="ab cl ki kj gp kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="hb hc hd he hf"><p id="6433" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">感谢您花时间阅读这篇文章。如果你觉得这个帖子有用又有趣，请鼓掌推荐。</p><p id="c5ae" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果我做错了什么，请在评论中提出来。我很想进步。</p></div></div>    
</body>
</html>