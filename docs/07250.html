<html>
<head>
<title>How to build a messaging UI for your Android chat app</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何为你的Android聊天应用建立一个消息用户界面</h1>
<blockquote>原文：<a href="https://medium.com/codex/how-to-build-a-messaging-ui-for-your-android-chat-app-883fad05f43a?source=collection_archive---------3-----------------------#2022-06-07">https://medium.com/codex/how-to-build-a-messaging-ui-for-your-android-chat-app-883fad05f43a?source=collection_archive---------3-----------------------#2022-06-07</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div class="er es hg"><img src="../Images/a771afc7946652e2a46c8d13e3c77667.png" data-original-src="https://miro.medium.com/v2/resize:fit:1152/format:webp/0*NeanzocddKbfw78a.png"/></div><figcaption class="hn ho et er es hp hq bd b be z dx translated">仙鸟2022</figcaption></figure><div class=""/><div class=""><h2 id="566e" class="pw-subtitle-paragraph iq hs ht bd b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh dx translated">创建一个UI，将消息与UI连接起来，并初始化活动中所有必需的组件</h2></div><p id="ca8b" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">解决方案工程师| <a class="ae ke" href="https://www.sendbird.com/" rel="noopener ugc nofollow" target="_blank"> Sendbird </a></p><p id="70fa" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated"><em class="kf">我们建议您查看</em> <a class="ae ke" href="https://github.com/sendbird/Sendbird-Android" rel="noopener ugc nofollow" target="_blank"> <em class="kf">示例应用</em> </a> <em class="kf">获取您可能需要的代码。如需更多指导，请访问我们的</em> <a class="ae ke" href="https://sendbird.com/docs/chat/v3/android/quickstart/send-first-message" rel="noopener ugc nofollow" target="_blank"> <em class="kf">文档</em> </a> <em class="kf">。别忘了查看应用内聊天的</em> <a class="ae ke" href="https://sendbird.com/demos/in-app-chat" rel="noopener ugc nofollow" target="_blank"> <em class="kf">演示</em> </a> <em class="kf">，并访问我们的</em> <a class="ae ke" href="https://sendbird.com/features/chat-messaging" rel="noopener ugc nofollow" target="_blank"> <em class="kf">网站</em> </a> <em class="kf">了解更多关于Sendbird Chat可以提供的服务。</em></p><blockquote class="kg kh ki"><p id="e80c" class="ji jj kf jk b jl jm iu jn jo jp ix jq kj js jt ju kk jw jx jy kl ka kb kc kd hb bi translated"><em class="ht">为了第一个了解新教程、开发者相关聊天/电话发布以及其他重要更新，</em> <a class="ae ke" href="https://get.sendbird.com/dev-newsletter-subscription.html" rel="noopener ugc nofollow" target="_blank"> <em class="ht">注册</em> </a> <em class="ht">获取我们的开发者简讯。</em></p></blockquote><h1 id="af8e" class="km kn ht bd ko kp kq kr ks kt ku kv kw iz kx ja ky jc kz jd la jf lb jg lc ld bi translated">介绍</h1><p id="f934" class="pw-post-body-paragraph ji jj ht jk b jl le iu jn jo lf ix jq jr lg jt ju jv lh jx jy jz li kb kc kd hb bi translated">尽管聊天和消息应用越来越流行，但实现起来仍然很乏味。这很大程度上是因为官方文档不存在，而非官方教程很少并且通常已经过时。</p><p id="413d" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">本教程试图弥合这一差距。</p><p id="356a" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">我们都见过充满文本、图像、甚至可播放媒体的彩色聊天气泡——他们是如何构建的？答案出奇的简单:RecyclerViews，加上ViewHolder模式。</p><p id="0130" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">本教程将引导您完成构建高质量消息传递UI所需的步骤，该UI为支持上述文本、图像和可播放媒体奠定了基础。</p><p id="eb94" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">本指南旨在创建:</p><ol class=""><li id="c4ae" class="lj lk ht jk b jl jm jo jp jr ll jv lm jz ln kd lo lp lq lr bi translated">消息传递用户界面</li><li id="c548" class="lj lk ht jk b jl ls jo lt jr lu jv lv jz lw kd lo lp lq lr bi translated">RecyclerView的适配器</li><li id="b2a1" class="lj lk ht jk b jl ls jo lt jr lu jv lv jz lw kd lo lp lq lr bi translated">渠道活动</li></ol><p id="a57e" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">本教程要求:</p><ol class=""><li id="cfd3" class="lj lk ht jk b jl jm jo jp jr ll jv lm jz ln kd lo lp lq lr bi translated">安卓工作室:4.0.2</li><li id="8376" class="lj lk ht jk b jl ls jo lt jr lu jv lv jz lw kd lo lp lq lr bi translated">Android版本:10 API 29</li><li id="1599" class="lj lk ht jk b jl ls jo lt jr lu jv lv jz lw kd lo lp lq lr bi translated">Sendbird核心SDK: 3.0.148</li></ol><figure class="ly lz ma mb fd hk er es paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="er es lx"><img src="../Images/5e195252e6bc07bfbee8bdf289285ced.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*40xki29JhkL1OYa9.png"/></div></div></figure><p id="1ae0" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">请注意，本教程假设您对Android开发有基本的了解。</p><h1 id="f749" class="km kn ht bd ko kp kq kr ks kt ku kv kw iz kx ja ky jc kz jd la jf lb jg lc ld bi translated">第一步。创建消息传递用户界面</h1><p id="6c04" class="pw-post-body-paragraph ji jj ht jk b jl le iu jn jo lf ix jq jr lg jt ju jv lh jx jy jz li kb kc kd hb bi translated"><strong class="jk hu">创建活动界面</strong></p><figure class="ly lz ma mb fd hk er es paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="er es mg"><img src="../Images/0f2c3e5e276298f6422aac38dcf0c26d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*cSKmoUcsYxFkdsbx.png"/></div></div></figure><p id="3c97" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">在本教程中，我们将创建一个专门的活动来托管我们的消息。对于这个活动，我们需要一个XML。因此，我们要做的第一件事是创建activity_channel.xml。</p><p id="f29d" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">此活动中的主要组件是RecyclerView，它将占据屏幕的大部分。您会注意到还有一个带有工具栏的AppBarLayout。我们现在不会做太多，但一般来说，你可以添加一个“后退”按钮，一个“关于”按钮，或者关于频道的信息。我们要添加的最后一个东西是一个RelativeLayout，它将包含“编辑文本”和“发送”按钮。这将分别是用户如何输入和发送文本。在这个RelativeLayout中，还可以添加图标来支持添加<a class="ae ke" href="https://sendbird.com/docs/chat/v3/android/guides/group-channel#2-send-a-message" rel="noopener ugc nofollow" target="_blank">视频/图像</a>。</p><figure class="ly lz ma mb fd hk"><div class="bz dy l di"><div class="mh mi l"/></div></figure><p id="6534" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated"><strong class="jk hu">为每条消息创建一个列表项</strong></p><figure class="ly lz ma mb fd hk er es paragraph-image"><div class="er es mj"><img src="../Images/1649a10fa04ec7d917a1f9e3b837a12a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1202/format:webp/0*CToXxgxHL5o817o0.png"/></div></figure><p id="69a8" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">使用单独的XML文件为RecyclerView定义每个项目(即邮件)的布局。通常，每封邮件都包含类似上面的内容(例如，发件人的姓名、他们的个人资料图像和时间戳)。由于聊天气泡的排列通常指示消息的所有者，所以显示每条消息的发件人的个人资料图像和姓名是多余的。例如，在上面的图像中，右对齐的聊天气泡表示它属于发送者，因此我们不需要包含图像或名称。</p><p id="88ce" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">我们需要创建两个不同的XML。第一个。xml将用于从“我”的角度来看的消息，或者由当前用户发送的消息。为此，我们选择将实际消息的TextView包装在Cardview中。围绕这个文本视图的是其他文本视图，比如日期。</p><figure class="ly lz ma mb fd hk er es paragraph-image"><div class="er es mj"><img src="../Images/917be6887f1a1ede69d0437310c851d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1202/format:webp/0*gcP7icFw2Thqi0jF.png"/></div></figure><figure class="ly lz ma mb fd hk"><div class="bz dy l di"><div class="mh mi l"/></div></figure><p id="f1ac" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">第二个。xml将用于“其他”角度的消息——这意味着当前用户没有发送的任何消息。这个用户界面将类似于“我”用户界面。但是，它是左对齐的，包含关于“其他”用户的信息，例如用于配置文件图像的ImageView和用于用户名的TextField。除此之外，观点都比较相似。</p><figure class="ly lz ma mb fd hk"><div class="bz dy l di"><div class="mh mi l"/></div></figure><h1 id="0a9c" class="km kn ht bd ko kp kq kr ks kt ku kv kw iz kx ja ky jc kz jd la jf lb jg lc ld bi translated">第二步。为recyclerview创建适配器</h1><p id="2713" class="pw-post-body-paragraph ji jj ht jk b jl le iu jn jo lf ix jq jr lg jt ju jv lh jx jy jz li kb kc kd hb bi translated">现在我们已经创建了聊天的UI，我们需要将消息与UI连接起来。我们将使用RecyclerView.Adapter来实现这一点。</p><p id="7a4c" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">这个适配器将完成三件事。它将:</p><ul class=""><li id="5f1b" class="lj lk ht jk b jl jm jo jp jr ll jv lm jz ln kd mk lp lq lr bi translated">存储邮件列表</li><li id="b12d" class="lj lk ht jk b jl ls jo lt jr lu jv lv jz lw kd mk lp lq lr bi translated">确定是否发送或接收了消息</li><li id="90c6" class="lj lk ht jk b jl ls jo lt jr lu jv lv jz lw kd mk lp lq lr bi translated">在RecyclerView中展开适当的布局</li></ul><p id="d71b" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">但是在进一步探索之前，我们需要一个消息列表！</p><p id="e11f" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">为实时消息传递设计后端超出了本教程的范围。因此，我们将继续使用Sendbird的聊天SDK中的模型。它大致采用以下结构:</p><p id="5af8" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated"><strong class="jk hu">通用消息和用户模型</strong></p><pre class="ly lz ma mb fd ml mm mn mo aw mp bi"><span id="4538" class="mq kn ht mm b fi mr ms l mt mu">class Message {<br/>  String message;<br/>  User sender;<br/>  long createdAt;<br/>}<br/><br/>class User {<br/>  String nickname;<br/>  String profileUrl;<br/>}</span></pre><p id="d719" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">因为以这种方式设计消息传递实现是很常见的，所以希望您能够遵循本教程，只需对代码做最小的更改。</p><p id="dc11" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">现在，让我们创建一个适配器，并将其命名为MessageListAdapter。这将包含将在RecyclerView中显示的消息列表。</p><figure class="ly lz ma mb fd hk"><div class="bz dy l di"><div class="mh mi l"/></div></figure><p id="a79f" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">默认情况下，一个适配器至少需要一个视图保持器。这是一个布局，可以被它所包含的对象膨胀和绑定。在我们的例子中，我们将从两个开始:一个SendMessageHolder和一个ReceivedMessageHolder。随着您添加更多类型的邮件，您可以添加更多的持有者。本教程侧重于用户消息或基于文本的消息。</p><p id="f6fc" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">为此，我们将在MessageListAdapter中有两个私有内部类。</p><figure class="ly lz ma mb fd hk"><div class="bz dy l di"><div class="mh mi l"/></div></figure><figure class="ly lz ma mb fd hk"><div class="bz dy l di"><div class="mh mi l"/></div></figure><p id="8993" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">每个视图持有者持有可以绑定到消息中包含的特定信息的成员视图。例如，TextView messageText绑定到消息的内容，而nameText绑定到消息发送者的姓名。Antonio Leiva建议我们在ViewHolder类中实现一个bind(object)方法。这将视图绑定到ViewHolder类，而不是onBindViewHolder。因此，它在多个视图持有者和视图类型中产生更干净的代码。如果需要，它还允许我们轻松地添加OnClickListeners。</p><p id="b79f" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">完成ViewHolder后，返回适配器并覆盖必要的方法:</p><ol class=""><li id="b0e5" class="lj lk ht jk b jl jm jo jp jr ll jv lm jz ln kd lo lp lq lr bi translated">从消息列表中获取消息</li><li id="4405" class="lj lk ht jk b jl ls jo lt jr lu jv lv jz lw kd lo lp lq lr bi translated">确定它是发送的消息还是接收的消息</li><li id="5110" class="lj lk ht jk b jl ls jo lt jr lu jv lv jz lw kd lo lp lq lr bi translated">为视图持有者放大适当的布局</li><li id="5ab9" class="lj lk ht jk b jl ls jo lt jr lu jv lv jz lw kd lo lp lq lr bi translated">将消息传递给视图持有者进行绑定</li></ol><p id="d52a" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">实现这个过程对于大多数适配器来说是标准的，并且相对来说是不言自明的；因此，我们将展示完整适配器的代码，无需进一步解释。</p><figure class="ly lz ma mb fd hk"><div class="bz dy l di"><div class="mh mi l"/></div></figure><p id="fbba" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">我们刚刚完成了适配器。我们现在可以在前面定义的聊天气泡中显示已发送和已接收消息的列表。</p><h1 id="c8ec" class="km kn ht bd ko kp kq kr ks kt ku kv kw iz kx ja ky jc kz jd la jf lb jg lc ld bi translated">第三步。创建渠道活动</h1><p id="b9d2" class="pw-post-body-paragraph ji jj ht jk b jl le iu jn jo lf ix jq jr lg jt ju jv lh jx jy jz li kb kc kd hb bi translated">我们已经创建了所有的组件，现在我们需要在活动中初始化它们。创建一个名为MessageListActivity的活动。在onCreate中，用消息列表实例化RecyclerView和MessageListAdapter，瞧！您刚刚创建了自己的消息传递UI。</p><figure class="ly lz ma mb fd hk"><div class="bz dy l di"><div class="mh mi l"/></div></figure><h1 id="fed4" class="km kn ht bd ko kp kq kr ks kt ku kv kw iz kx ja ky jc kz jd la jf lb jg lc ld bi translated">结论</h1><p id="c136" class="pw-post-body-paragraph ji jj ht jk b jl le iu jn jo lf ix jq jr lg jt ju jv lh jx jy jz li kb kc kd hb bi translated">您可以构建高级功能，如图像预览、聊天气泡中的动画gif等。在Sendbird的开源<a class="ae ke" href="https://github.com/sendbird/Sendbird-Android" rel="noopener ugc nofollow" target="_blank">示例UI应用中查看高级聊天UI的示例！</a>这基于我们在本教程中介绍的RecyclerViews和adapters的使用，将帮助您创建一个具有各种功能的生产级聊天应用。</p><p id="2ee9" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">开心聊楼！</p></div></div>    
</body>
</html>