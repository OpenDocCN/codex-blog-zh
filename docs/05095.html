<html>
<head>
<title>AWS Amplify Pitfalls and Solutions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">AWS放大了陷阱和解决方案</h1>
<blockquote>原文：<a href="https://medium.com/codex/aws-amplify-pitfalls-and-solutions-e011621a65e0?source=collection_archive---------13-----------------------#2022-01-31">https://medium.com/codex/aws-amplify-pitfalls-and-solutions-e011621a65e0?source=collection_archive---------13-----------------------#2022-01-31</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/2e589602ff73444bebfd10ed14797ac2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*On0zVHJ-phgpwLagNglQyQ.jpeg"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">AWS放大了陷阱和解决方案</figcaption></figure><div class=""/><h1 id="0804" class="iu iv hx bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">背景</h1><p id="0f68" class="pw-post-body-paragraph js jt hx ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">在过去的一年里，我一直在使用<a class="ae kq" href="https://aws.amazon.com/amplify/" rel="noopener ugc nofollow" target="_blank"> AWS Amplify </a>来建立一个网站。我第一次被AWS Amplify吸引是因为它的简单、高效和高维护性。除了它带来的所有好东西，目前版本的AWS Amplify也有一些限制。</p><p id="745b" class="pw-post-body-paragraph js jt hx ju b jv kr jx jy jz ks kb kc kd kt kf kg kh ku kj kk kl kv kn ko kp hb bi translated">我将分享我的一些经验，并希望这些可以帮助您决定是否要完全依靠AWS Amplify来开发自己的产品。</p><h1 id="46b9" class="iu iv hx bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">小心删除</h1><p id="bb58" class="pw-post-body-paragraph js jt hx ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">这个技巧可以应用于所有类型的开发工具，但是让我们更多地了解AWS Amplify中的删除操作。</p><h2 id="bef3" class="kw iv hx bd iw kx ky kz ja la lb lc je kd ld le ji kh lf lg jm kl lh li jq lj bi translated">后端删除</h2><p id="79e0" class="pw-post-body-paragraph js jt hx ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">目前，AWS Amplify本身并不支持为资源配置<code class="du lk ll lm ln b">DeletionPolicy: Retain</code>。所以当你删除了Amplify后端，一切都将不复存在。</p><p id="659a" class="pw-post-body-paragraph js jt hx ju b jv kr jx jy jz ks kb kc kd kt kf kg kh ku kj kk kl kv kn ko kp hb bi translated">还有一点，删除操作是不可取消的。我询问了AWS Amplify支持团队，他们说一旦提交了删除请求，他们就无能为力了。</p><p id="2444" class="pw-post-body-paragraph js jt hx ju b jv kr jx jy jz ks kb kc kd kt kf kg kh ku kj kk kl kv kn ko kp hb bi translated"><strong class="ju hy">解决</strong>。强烈建议您自己进行备份。对于DynamoDB，您可以使用定期备份。对于S3存储桶，您可以启用版本控制，或者将数据备份到不属于AWS Amplify的另一个S3存储桶。</p><h2 id="a0e6" class="kw iv hx bd iw kx ky kz ja la lb lc je kd ld le ji kh lf lg jm kl lh li jq lj bi translated">前端删除</h2><p id="0cac" class="pw-post-body-paragraph js jt hx ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">从AWS Amplify中删除前端主机后，所有的后端资源仍然存在。但是，您将丢失所有的域配置和存储库挂钩。这将导致您的网站不可用，直到您再次设置前端托管。</p><p id="7154" class="pw-post-body-paragraph js jt hx ju b jv kr jx jy jz ks kb kc kd kt kf kg kh ku kj kk kl kv kn ko kp hb bi translated"><strong class="ju hy">解决方案</strong>。对于所有的前端配置，总有办法在不删除app的情况下进行修改。</p><h1 id="67b8" class="iu iv hx bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">Cognito的备份</h1><p id="d1a7" class="pw-post-body-paragraph js jt hx ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">从我的调查来看，没有什么好的方法可以完全备份你的AWS Cognito数据。</p><p id="173f" class="pw-post-body-paragraph js jt hx ju b jv kr jx jy jz ks kb kc kd kt kf kg kh ku kj kk kl kv kn ko kp hb bi translated">亚马逊发布了一个开源工具来备份Cognito数据:<a class="ae kq" href="https://docs.aws.amazon.com/solutions/latest/cognito-user-profiles-export-reference-architecture/welcome.html" rel="noopener ugc nofollow" target="_blank"> <strong class="ju hy"> Cognito用户配置文件导出参考架构</strong> </a> <strong class="ju hy">。</strong>但是导出的数据不包含哈希用户密码。这意味着如果您需要将身份验证数据迁移到另一个地区，您必须想办法通知客户重新设置密码。</p><p id="6ba4" class="pw-post-body-paragraph js jt hx ju b jv kr jx jy jz ks kb kc kd kt kf kg kh ku kj kk kl kv kn ko kp hb bi translated"><strong class="ju hy">解决方案</strong>。一种方法是开发您自己的认证平台，并通过<a class="ae kq" href="https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-pools-oidc-idp.html" rel="noopener ugc nofollow" target="_blank"> Cognito OIDC </a>将您的认证平台与Cognito相连。</p><h1 id="6e92" class="iu iv hx bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">AWS放大导入</h1><p id="df3b" class="pw-post-body-paragraph js jt hx ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">当使用amplify-cli创建资源时，amplify还会将所有CloudFormation配置写入JSON文件。这些基础设施配置文件支持轻松迁移和修改，甚至可以迁移到AWS Amplify之外。开发人员还可以使用amplify-cli命令轻松更改配置。</p><p id="8b47" class="pw-post-body-paragraph js jt hx ju b jv kr jx jy jz ks kb kc kd kt kf kg kh ku kj kk kl kv kn ko kp hb bi translated">另一方面，我们也可以导入现有的AWS资源来放大app。但是对于那些导入的资源，将没有匹配的CloudFormation文件，并且它们不能用amplify-cli改变。</p><p id="7c26" class="pw-post-body-paragraph js jt hx ju b jv kr jx jy jz ks kb kc kd kt kf kg kh ku kj kk kl kv kn ko kp hb bi translated"><strong class="ju hy">解决方案</strong>。避免导入资源，而是使用amplify-cli创建资源，并将数据迁移到新资源。</p><h1 id="735a" class="iu iv hx bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">面向S3接入的CDN</h1><p id="db51" class="pw-post-body-paragraph js jt hx ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">对于使用amplify-cli创建的S3存储桶，默认情况下没有连接CDN。目前，AWS Amplify尚未将CDN纳入其管理面板。如果您需要加速对S3资源的访问，您必须为您的S3 bucket和path手动设置CloudFront endpoint。</p><p id="fa09" class="pw-post-body-paragraph js jt hx ju b jv kr jx jy jz ks kb kc kd kt kf kg kh ku kj kk kl kv kn ko kp hb bi translated"><strong class="ju hy">解</strong>。在AWS Amplify之外创建和管理您自己的CDN端点。</p><h1 id="2a0d" class="iu iv hx bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">遗言</h1><p id="28f5" class="pw-post-body-paragraph js jt hx ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">尽管存在上述不便，但AWS Amplify确实提高了我的开发效率。AWS Amplify也在快速迭代和更新产品，希望它们能覆盖越来越多的方面。</p></div></div>    
</body>
</html>