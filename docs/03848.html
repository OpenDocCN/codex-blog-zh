<html>
<head>
<title>💪Deploying WordPress on Azure using Bicep</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">💪使用Bicep在Azure上部署WordPress</h1>
<blockquote>原文：<a href="https://medium.com/codex/deploying-wordpress-on-azure-using-bicep-ad7e1dd96065?source=collection_archive---------4-----------------------#2021-10-01">https://medium.com/codex/deploying-wordpress-on-azure-using-bicep-ad7e1dd96065?source=collection_archive---------4-----------------------#2021-10-01</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="9365" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在Azure中部署WordPress的基础设施即代码方法。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/49dcd9334af2a901100402a8dcead72a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W2fdR72hUpZXcMgV_2RTvw.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">Azure二头肌——部署WordPress</figcaption></figure></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><p id="6252" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">本文旨在为您提供一个如何使用Bicep在Azure中部署WordPress实例的快速示例。</p><p id="5007" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在之前的<a class="ae ka" href="https://blog.azinsider.net/" rel="noopener ugc nofollow" target="_blank">文章</a>中，我们讨论了为什么Bicep与作为云工程师的你相关，以及你如何利用这种新的特定于领域的语言在Azure中声明性地部署你的资源。</p><p id="e630" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将创建一个Bicep模板来在Azure中部署一个WordPress实例。WordPress是一个免费的开源内容管理系统，用PHP编写，配有MySQL数据库。</p><p id="8efe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们从定义二头肌模板的参数开始。</p><h1 id="db0f" class="kb kc hi bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">1.WordPress Bicep模板—参数</h1><p id="279a" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">在下面的代码中，我们定义了几个参数:SKU、'<em class="le">repoURL【T3]、分支和位置。</em></p><pre class="je jf jg jh fd lf lg lh li aw lj bi"><span id="3bb0" class="lk kc hi lg b fi ll lm l ln lo">param sku string = 'F1'<br/>param repoUrl string = '<a class="ae ka" href="https://github.com/azureappserviceoss/wordpress-azure'" rel="noopener ugc nofollow" target="_blank">https://github.com/azureappserviceoss/wordpress-azure'</a><br/>param branch string = 'master'<br/>param location string = resourceGroup().location</span></pre><p id="6501" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意，我们使用函数“resourceGroup()”传递位置。</p><p id="b300" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下一步是定义变量。</p><h1 id="be2a" class="kb kc hi bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">2.WordPress Bicep模板—变量</h1><p id="f3e8" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">我们将定义两个变量:</p><ul class=""><li id="49cf" class="lp lq hi ih b ii ij im in iq lr iu ls iy lt jc lu lv lw lx bi translated">托管计划名称</li><li id="74a3" class="lp lq hi ih b ii ly im lz iq ma iu mb iy mc jc lu lv lw lx bi translated">网站名称</li></ul><pre class="je jf jg jh fd lf lg lh li aw lj bi"><span id="34ef" class="lk kc hi lg b fi ll lm l ln lo">var hostingPlanName_var = '${uniqueString(resourceGroup().id)}hostingplan'</span><span id="8d7b" class="lk kc hi lg b fi md lm l ln lo">var siteName_var = '${uniqueString(resourceGroup().id)}website'</span></pre><p id="d84b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在上面的代码中，我们没有使用'<em class="le"> concat() </em>'函数，而是使用了字符串插值。这样，我们可以为托管计划名称和站点名称获得一个唯一的名称。</p><p id="0015" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们将定义资源。</p><h1 id="6f2e" class="kb kc hi bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">3.WordPress Bicep模板—变量</h1><p id="1808" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">我们将在Bicep模板中定义四种资源:</p><ul class=""><li id="e1cb" class="lp lq hi ih b ii ij im in iq lr iu ls iy lt jc lu lv lw lx bi translated">服务器群</li><li id="a78c" class="lp lq hi ih b ii ly im lz iq ma iu mb iy mc jc lu lv lw lx bi translated">网站—应用服务</li><li id="58b5" class="lp lq hi ih b ii ly im lz iq ma iu mb iy mc jc lu lv lw lx bi translated">源代码控制</li><li id="845c" class="lp lq hi ih b ii ly im lz iq ma iu mb iy mc jc lu lv lw lx bi translated">站点配置</li></ul><p id="996f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们从定义服务器群或应用服务计划开始。</p><pre class="je jf jg jh fd lf lg lh li aw lj bi"><span id="9a86" class="lk kc hi lg b fi ll lm l ln lo">resource hostingPlanName 'Microsoft.Web/serverfarms@2020-06-01' = {<br/>  sku: {<br/>    name: sku<br/>    capacity: 1<br/>  }<br/>  name: hostingPlanName_var<br/>  location: location<br/>  properties: {}<br/>}</span></pre><p id="60f9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在上面的代码中，我们定义了App服务计划。我们包括SKU和容量。然后，我们传递托管计划的名称和位置。</p><p id="72b0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要定义的以下资源是应用程序服务:</p><pre class="je jf jg jh fd lf lg lh li aw lj bi"><span id="70f8" class="lk kc hi lg b fi ll lm l ln lo">resource siteName 'Microsoft.Web/sites@2020-06-01' = {<br/>  name: siteName_var<br/>  location: location<br/>  properties: {<br/>    serverFarmId: hostingPlanName.id<br/>    siteConfig: {<br/>      localMySqlEnabled: true<br/>      appSettings: [<br/>        {<br/>          name: 'WEBSITE_MYSQL_ENABLED'<br/>          value: '1'<br/>        }<br/>        {<br/>          name: 'WEBSITE_MYSQL_GENERAL_LOG'<br/>          value: '0'<br/>        }<br/>        {<br/>          name: 'WEBSITE_MYSQL_SLOW_QUERY_LOG'<br/>          value: '0'<br/>        }<br/>        {<br/>          name: 'WEBSITE_MYSQL_ARGUMENTS'<br/>          value: '--max_allowed_packet=16M'<br/>        }<br/>      ]<br/>    }<br/>  }<br/>}</span></pre><p id="cf8d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在上面的代码中，我们描述了站点的名称和位置。然后，在属性中，我们引用托管计划名称ID和配置。</p><p id="63f8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于这个具体的例子，我们提供了一些设置来在App中启用MySQL。</p><p id="4a39" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将定义的以下资源是源代码管理。</p><pre class="je jf jg jh fd lf lg lh li aw lj bi"><span id="6046" class="lk kc hi lg b fi ll lm l ln lo">resource siteName_web 'Microsoft.Web/sites/sourcecontrols@2020-06-01' = {<br/>  parent: siteName<br/>  name: 'web'<br/>  properties: {<br/>    repoUrl: repoUrl<br/>    branch: branch<br/>    isManualIntegration: true<br/>  }<br/>}</span></pre><p id="8520" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意，我们将其定义为子资源。父资源是应用服务。源代码管理定义包括名称和属性。</p><p id="c9e9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在属性中，我们引用'<em class="le"> repoURL </em>和分支。我们还将“isManualIntegration”属性的布尔值设置为true。</p><p id="c758" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，我们定义站点的配置。</p><pre class="je jf jg jh fd lf lg lh li aw lj bi"><span id="d691" class="lk kc hi lg b fi ll lm l ln lo">resource Microsoft_Web_sites_config_siteName_web 'Microsoft.Web/sites/config@2020-06-01' = {<br/>  parent: siteName<br/>  name: 'web'<br/>  properties: {<br/>    phpVersion: '7.0'<br/>  }<br/>}</span></pre><p id="b8bd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在上面的代码中，我们将这个资源定义为子资源，并指定要使用的<em class="le"> PHP版本</em>。</p><h1 id="2031" class="kb kc hi bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">4.正在部署二头肌模板。</h1><p id="7d8c" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">我们将使用下面的PowerShell cmdlet将其部署到资源组。我们之前在Azure订阅中创建了一个名为'<em class="le"> WordPress </em>的资源组。</p><pre class="je jf jg jh fd lf lg lh li aw lj bi"><span id="ca72" class="lk kc hi lg b fi ll lm l ln lo">$date = Get-Date -Format "MM-dd-yyyy"</span><span id="e82a" class="lk kc hi lg b fi md lm l ln lo">$deploymentName = "AzInsiderDeployment"+"$date"</span><span id="2916" class="lk kc hi lg b fi md lm l ln lo">New-AzResourceGroupDeployment -Name $deploymentName -ResourceGroupName WordPress -TemplateFile .\wordpress.bicep <strong class="lg hj">-c</strong></span></pre><p id="8197" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意，我们在命令末尾添加了标志-c来预览部署。</p><p id="2b59" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过使用这个标志，我们使用了WhatIf特性，并且我们将预览部署。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es me"><img src="../Images/520af15ee1a03ea68341bcb7f2403ceb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MbSPAeOf9vbdlV32YNmqYA.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">Azure Bicep部署预览</figcaption></figure><p id="2d25" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦我们验证了部署，我们就可以执行它。</p><p id="ecdd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下图突出显示了此部署的输出。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mf"><img src="../Images/0568f982d9f78a0328a2e769c0d0e5fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yTcEM1hSLNOFLGy-D7n5Vw.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">Azure Bicep部署输出</figcaption></figure><p id="1dae" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以下是完整的二头肌模板:</p><pre class="je jf jg jh fd lf lg lh li aw lj bi"><span id="66dc" class="lk kc hi lg b fi ll lm l ln lo">param sku string = 'F1'<br/>param repoUrl string = '<a class="ae ka" href="https://github.com/azureappserviceoss/wordpress-azure'" rel="noopener ugc nofollow" target="_blank">https://github.com/azureappserviceoss/wordpress-azure'</a><br/>param branch string = 'master'<br/>param location string = resourceGroup().location</span><span id="038f" class="lk kc hi lg b fi md lm l ln lo">var hostingPlanName_var = '${uniqueString(resourceGroup().id)}hostingplan'<br/>var siteName_var = '${uniqueString(resourceGroup().id)}website'</span><span id="bd73" class="lk kc hi lg b fi md lm l ln lo">resource hostingPlanName 'Microsoft.Web/serverfarms@2020-06-01' = {<br/>  sku: {<br/>    name: sku<br/>    capacity: 1<br/>  }<br/>  name: hostingPlanName_var<br/>  location: location<br/>  properties: {}<br/>}</span><span id="2798" class="lk kc hi lg b fi md lm l ln lo">resource siteName 'Microsoft.Web/sites@2020-06-01' = {<br/>  name: siteName_var<br/>  location: location<br/>  properties: {<br/>    serverFarmId: hostingPlanName.id<br/>    siteConfig: {<br/>      localMySqlEnabled: true<br/>      appSettings: [<br/>        {<br/>          name: 'WEBSITE_MYSQL_ENABLED'<br/>          value: '1'<br/>        }<br/>        {<br/>          name: 'WEBSITE_MYSQL_GENERAL_LOG'<br/>          value: '0'<br/>        }<br/>        {<br/>          name: 'WEBSITE_MYSQL_SLOW_QUERY_LOG'<br/>          value: '0'<br/>        }<br/>        {<br/>          name: 'WEBSITE_MYSQL_ARGUMENTS'<br/>          value: '--max_allowed_packet=16M'<br/>        }<br/>      ]<br/>    }<br/>  }<br/>}</span><span id="f775" class="lk kc hi lg b fi md lm l ln lo">resource siteName_web 'Microsoft.Web/sites/sourcecontrols@2020-06-01' = {<br/>  parent: siteName<br/>  name: 'web'<br/>  properties: {<br/>    repoUrl: repoUrl<br/>    branch: branch<br/>    isManualIntegration: true<br/>  }<br/>}</span><span id="eefd" class="lk kc hi lg b fi md lm l ln lo">resource Microsoft_Web_sites_config_siteName_web 'Microsoft.Web/sites/config@2020-06-01' = {<br/>  parent: siteName<br/>  name: 'web'<br/>  properties: {<br/>    phpVersion: '7.0'<br/>  }<br/>}</span></pre><p id="9a5f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正如您所看到的，利用Bicep的基础设施即代码比ARM模板简单得多，并且您仍然可以使用ARM中可用的特性(如WhatIf)来快速验证您的部署。</p><p id="36d2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae ka" href="http://eepurl.com/gKmLdf" rel="noopener ugc nofollow" target="_blank"> <em class="le">在此加入</em><strong class="ih hj"><em class="le">azin sider</em></strong><em class="le">邮箱列表。</em>T9】</a></p><p id="e24a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="le">-戴夫·r·</em></p></div></div>    
</body>
</html>