<html>
<head>
<title>Concurrency in Dart — Part I</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Dart中的并发性—第一部分</h1>
<blockquote>原文：<a href="https://medium.com/codex/concurrency-in-dart-part-i-d20bf5fcb250?source=collection_archive---------9-----------------------#2022-03-30">https://medium.com/codex/concurrency-in-dart-part-i-d20bf5fcb250?source=collection_archive---------9-----------------------#2022-03-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="25f3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">dart和一般情况下的并发性介绍。</p><p id="e50d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您来自并行进程或线程语言的世界，如Java/C++/Kotlin等，那么在开始时，您可能很难理解JS/Dart单线程方法。您可能听说过Javascript和Dart是单线程的，让我们深入研究一下这种方法。我将帮助您很好地理解这里的基本概念。</p><h2 id="538f" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">并行和并发</h2><p id="6907" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">当多个任务在一台机器的多个内核上执行时，这被称为并行。这可以通过操作系统上的线程或进程来完成。</p><p id="9a9d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">另一方面，并发指的是任务在单核上轮流执行的情况。这就像一个人从人群队列中接受命令一样。</p><p id="c5a9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要点:</p><ol class=""><li id="ddc8" class="kd ke hi ih b ii ij im in iq kf iu kg iy kh jc ki kj kk kl bi translated">在Dart这样的单线程环境中，异步任务之间不会发生争用情况，因为在任何时间点都只有一个任务在运行。</li><li id="f224" class="kd ke hi ih b ii km im kn iq ko iu kp iy kq jc ki kj kk kl bi translated">在只需要输入一次异步函数而其他函数必须等待上一次调用完成的地方，您仍然需要一种方法来强制序列化。我们将在后面用一个<a class="ae kr" href="https://tarunengineer.medium.com/concurrency-in-dart-part-iii-2086329d82a2" rel="noopener">例子</a>来讨论这个问题。</li><li id="9f45" class="kd ke hi ih b ii km im kn iq ko iu kp iy kq jc ki kj kk kl bi translated">在并行的情况下，多个线程可以同时访问内存，为了管理竞争情况，我们必须使用像互斥这样的系统来加强指令的原子性。</li><li id="e0a3" class="kd ke hi ih b ii km im kn iq ko iu kp iy kq jc ki kj kk kl bi translated">Dart有一种通过隔离创建线程的方法，但它们不与其他隔离共享内存，只能通过消息传递进行通信。</li></ol><h2 id="f9d8" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">同步与异步代码</h2><p id="b521" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">同步意味着以逐步的方式执行代码。在异步执行中是无序的，这里某些任务被重新安排在将来运行。如果你在下面的例子中看到，在异步的情况下输出的实际顺序不同于书写的顺序。</p><figure class="ks kt ku kv fd kw"><div class="bz dy l di"><div class="kx ky l"/></div><figcaption class="kz la et er es lb lc bd b be z dx translated">镖靶:【https://dartpad.dev/?id=b4bcb85f09ec9c2252f819757f36e860 T2】</figcaption></figure><p id="4aa9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">输出:</p><pre class="ks kt ku kv fd ld le lf lg aw lh bi"><span id="bd0c" class="jd je hi le b fi li lj l lk ll">First<br/>Second<br/>third</span></pre><figure class="ks kt ku kv fd kw"><div class="bz dy l di"><div class="kx ky l"/></div><figcaption class="kz la et er es lb lc bd b be z dx translated">镖靶:【https://dartpad.dev/?id=36bed4d762b48673310d901d2a872485 T4】</figcaption></figure><p id="429c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">输出</p><pre class="ks kt ku kv fd ld le lf lg aw lh bi"><span id="fe87" class="jd je hi le b fi li lj l lk ll">Third<br/>Second<br/>First</span></pre><h2 id="743b" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">事件循环</h2><p id="fa6e" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">在dart中，单线程运行在所谓的<strong class="ih hj">隔离</strong>中。dart本身使用的分离株被称为<strong class="ih hj">主分离株</strong>。它有自己分配的内存区域，任何其他dart隔离都无法访问该内存。Dart使用一个<strong class="ih hj">事件循环</strong>来执行之前被推迟的任务。dart有两个队列:一个<strong class="ih hj">微任务队列</strong>和一个<strong class="ih hj">事件队列</strong>。微任务队列主要由Dart内部使用。事件队列用于事件，如用户触摸屏、击键、来自数据库、文件或远程服务器的数据等。</p><figure class="ks kt ku kv fd kw er es paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="er es lm"><img src="../Images/88004d2662c03fa90106cf7a83d942b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X2bpQVU69mmoOovKtNWS2A.png"/></div></div></figure><ul class=""><li id="cf67" class="kd ke hi ih b ii ij im in iq kf iu kg iy kh jc lt kj kk kl bi translated">主隔离中的同步任务总是立即运行。你不能打断他们。</li><li id="7f06" class="kd ke hi ih b ii km im kn iq ko iu kp iy kq jc lt kj kk kl bi translated">如果任何长期运行的任务需要推迟，Dart会将它们放入事件队列中。</li><li id="9913" class="kd ke hi ih b ii km im kn iq ko iu kp iy kq jc lt kj kk kl bi translated">一旦同步任务完成，事件循环就检查微任务队列中的任务，并将它们放在主隔离上执行。这是连续的，直到微任务队列为空。</li><li id="3bdd" class="kd ke hi ih b ii km im kn iq ko iu kp iy kq jc lt kj kk kl bi translated">如果微任务队列和同步任务队列为空，则事件循环开始从事件队列中选取任务。</li><li id="5ec8" class="kd ke hi ih b ii km im kn iq ko iu kp iy kq jc lt kj kk kl bi translated">如果有任何新任务进入微任务队列，那么事件循环在从事件队列中选取任何进一步的任务之前先选取它们。</li><li id="aec8" class="kd ke hi ih b ii km im kn iq ko iu kp iy kq jc lt kj kk kl bi translated">这个过程一直持续到所有队列都为空。</li></ul><h2 id="66ca" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">在我们结束第一部分之前，有一点很重要</h2><p id="9cb3" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">虽然dart是单线程的，但这并不意味着您不能让任务在另一个线程上运行。</p><ol class=""><li id="d3aa" class="kd ke hi ih b ii ij im in iq kf iu kg iy kh jc ki kj kk kl bi translated">一个例子是，当我们请求读取一个文件时，该工作实际上在系统中自己的进程上发生，一旦该工作完成，它就通过事件队列将结果传递回dart。来自<em class="lu"> dart: io </em>库的很多dart I/O工作都是这样进行的。</li><li id="ed2a" class="kd ke hi ih b ii km im kn iq ko iu kp iy kq jc ki kj kk kl bi translated">在其他线程上执行工作的另一种方法是创建一个新的Dart隔离。不同的隔离可以通过消息传递相互交谈。内部隔离是通过操作系统方法(如线程和进程)实现的，但内部实现细节对应用程序程序员是隐藏的。</li></ol><p id="cdb8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">进一步阅读:</p><ol class=""><li id="4204" class="kd ke hi ih b ii ij im in iq kf iu kg iy kh jc ki kj kk kl bi translated"><a class="ae kr" href="https://tarunengineer.medium.com/concurrency-in-dart-part-ii-e67ec0f110c4" rel="noopener"><em class="lu">Dart中的并发:第二部分</em> </a></li><li id="f202" class="kd ke hi ih b ii km im kn iq ko iu kp iy kq jc ki kj kk kl bi translated"><a class="ae kr" href="https://tarunengineer.medium.com/concurrency-in-dart-part-iii-2086329d82a2" rel="noopener"><em class="lu">Dart中的并发:第三部分</em> </a></li></ol></div></div>    
</body>
</html>