<html>
<head>
<title>How to fix the error 0xc0000006 External Exception in a Delphi Application — Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何修复Delphi应用程序中的错误0xc0000006外部异常—第2部分</h1>
<blockquote>原文：<a href="https://medium.com/codex/how-to-fix-the-error-0xc0000006-external-exception-in-a-delphi-application-part-2-60a4a931ffd7?source=collection_archive---------17-----------------------#2022-04-09">https://medium.com/codex/how-to-fix-the-error-0xc0000006-external-exception-in-a-delphi-application-part-2-60a4a931ffd7?source=collection_archive---------17-----------------------#2022-04-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="fbee" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">Delphi的PE(可移植可执行文件)头标志</h2></div><p id="5f6f" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这篇<a class="ae jt" href="https://segovoni.medium.com/how-to-fix-the-error-0xc0000006-in-a-delphi-application-ff596d201c09" rel="noopener">文章</a>中，我谈到了与代码C0000006 (0xc0000006)相关的外部异常错误。这是一个一般性错误，它隐藏了与操作系统试图从网络加载的资源(文件)相关的真正的“低级错误”。</p><p id="2b89" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">该错误通常由在Windows终端服务器环境中使用Delphi应用程序的客户报告。</p><p id="e553" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这个解决方案解决了我场景中的问题:在<strong class="iz hj">中添加PE flag<a class="ae jt" href="https://docwiki.embarcadero.com/RADStudio/Sydney/en/PE_(portable_executable)_header_flags_(Delphi)" rel="noopener ugc nofollow" target="_blank">IMAGE _ FILE _ NET _ RUN _ FROM _ SWAP</a>所有</strong>应用涉及的Delphi包和项目(dpk，dpr，…)中。</p><p id="6a5e" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这篇文章中，我想把你的注意力集中在两个细节上:第一个是关于将带有PEflags的Delphi项目拖放到一个项目组中，第二个是关于应用程序使用的第三方模块(BPL)。</p><h2 id="2b5b" class="ju jv hi bd jw jx jy jz ka kb kc kd ke jg kf kg kh jk ki kj kk jo kl km kn ko bi translated">将Delphi项目拖放到项目组中</h2><p id="5e63" class="pw-post-body-paragraph ix iy hi iz b ja kp ij jc jd kq im jf jg kr ji jj jk ks jm jn jo kt jq jr js hb bi translated">我们注意到一个问题，当一个包含PEFlags的Delphi包dpk通过拖放操作(将包的项目拖到项目组中)被添加到一个Delphi项目组中时，会出现这个问题。在这种情况下，可能会出现本地路径的<em class="ku"> Winapi。将windows . pas</em>(C:\ Program files(x86)\ Embarcadero \…)添加到DPROJ文件中。如果保存了项目，该路径也会添加到DPK文件中。为了避免这种行为，有必要以不同于我在本文第一部分中解释的方式激活PEflag。标记是使用值$0800，而不是常量名称IMAGE_FILE_NET_RUN_FROM_SWAP，如下面这段代码所示:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="f2ec" class="ju jv hi la b fi le lf l lg lh">{$SetPEFlags $0800}</span></pre><p id="5008" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我知道PEFlags指令的这种用法不如常量IMAGE_FILE_NET_RUN_FROM_SWAP的用法清晰，但对于Delphi IDE来说更清晰，而且这种方式不需要添加<em class="ku"> Winapi。将Windows.pas </em>传递到项目的contains部分。</p><p id="c815" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">要清理已经发生这种行为的项目，必须打开DPROJ和DPK项目文件，并删除以下行:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="d2e9" class="ju jv hi la b fi le lf l lg lh">&lt;DCCReference Include = "C:\Program files (x86)\Embarcadero\Rad Studio\10.0\source\rtl\win\Winapi.Windows.pas"/&gt;</span></pre><h2 id="fdaf" class="ju jv hi bd jw jx jy jz ka kb kc kd ke jg kf kg kh jk ki kj kk jo kl km kn ko bi translated">第三方模块(BPL)</h2><p id="3743" class="pw-post-body-paragraph ix iy hi iz b ja kp ij jc jd kq im jf jg kr ji jj jk ks jm jn jo kt jq jr js hb bi translated">在所有应用程序模块上都设置了编译指令的客户那里，错误不断出现。案例研究使我们怀疑错误是由于没有IMAGE_FILE_NET_RUN_FROM_SWAP标志的外部模块(不是我们编译的)造成的，所以我们考虑使用<a class="ae jt" href="https://docs.microsoft.com/en-us/cpp/build/reference/editbin-options" rel="noopener ugc nofollow" target="_blank"> EDITBIN </a>工具来编辑这些外部模块。这个工具允许你编辑文件，如BPL，EXE等。添加各种选项，包括<a class="ae jt" href="https://docs.microsoft.com/en-us/cpp/build/reference/swaprun" rel="noopener ugc nofollow" target="_blank"> /SWAPRUN </a> : NET(对应于IMAGE_FILE_NET_RUN_FROM_SWAP指令)而无需重新编译项目。我们也认为最好不要只在外部BPL、EXE等上运行<a class="ae jt" href="https://docs.microsoft.com/en-us/cpp/build/reference/editbin-options" rel="noopener ugc nofollow" target="_blank"> EDITBIN </a>。但也在德尔福的(rtl，vcl等)。).</p><p id="4102" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在我们已经在两个客户那里安装了用EDITBIN修改的模块。外部异常似乎被永久解决了！</p></div></div>    
</body>
</html>