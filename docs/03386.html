<html>
<head>
<title>Encrypting your files using a USB stick key (Python)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用u盘密钥加密文件(Python)</h1>
<blockquote>原文：<a href="https://medium.com/codex/encrypting-your-files-using-a-usb-stick-as-the-key-python-e04b26657357?source=collection_archive---------2-----------------------#2021-08-31">https://medium.com/codex/encrypting-your-files-using-a-usb-stick-as-the-key-python-e04b26657357?source=collection_archive---------2-----------------------#2021-08-31</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="e242" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">网络安全对我们的数字生活越来越重要，人们真的低估了他们的信息被窃取的容易程度。有鉴于此，为什么不用python建立一个你自己的很酷的小系统来加密你的文件呢！在这篇文章中，我将介绍如何在你的windows pc上创建一个安全的位置，这将加密你的重要文件，除非你插入一个u盘。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/d6943e375b57a2aaf91b507becbff485.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GkoX_pkVlEyF-n566ZHa7g.jpeg"/></div></div></figure><p id="25f4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我不会假装这是你能做的保护自己的最安全的事情，但每一点都有帮助，而且非常简单。你需要的只是一个u盘，最好上面什么都没有，但这不是必须的。</p></div><div class="ab cl jp jq gp jr" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="hb hc hd he hf"><p id="e39e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，你要插上你的u盘，确保它能正常工作，并清除所有无用或不想要的文件。当它出现在您的计算机上时，在侧边菜单中，右键单击它并单击属性。在这里你可以给它一个名字，在我的例子中，我就称它为“KEY”。在我们进入代码之前，你要做的另一件事是选择你要在你的计算机上保存这些安全文件的位置。我刚刚在桌面上做了一个名为SecureData的文件夹，又快又简单。</p><p id="2b55" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以进入代码！这个项目需要三个库，其中两个需要pip安装。</p><pre class="je jf jg jh fd jw jx jy jz aw ka bi"><span id="66c5" class="kb kc hi jx b fi kd ke l kf kg">pip install wmi<br/>pip install cryptography</span><span id="9c24" class="kb kc hi jx b fi kh ke l kf kg">import os<br/>import wmi<br/>from cryptography.fernet import Fernet</span></pre><p id="1b79" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，您希望定义一个变量来保存您提供给u盘的字符串名称，并定义另一个变量来保存您的secure files文件夹的系统路径。</p><pre class="je jf jg jh fd jw jx jy jz aw ka bi"><span id="2329" class="kb kc hi jx b fi kd ke l kf kg">my_key = 'KEY'<br/>files = r'YOUR PATH HERE'</span></pre><p id="9777" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们实例化一个我们导入的“wmi”对象。这是允许我们扫描计算机端口的库。</p><pre class="je jf jg jh fd jw jx jy jz aw ka bi"><span id="2175" class="kb kc hi jx b fi kd ke l kf kg">c = wmi.WMI()</span></pre><p id="f405" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这就是我们现在需要的所有设置。下一部分被分解成四个不同的功能。首先是检查我们的“钥匙”是否插上了。</p><pre class="je jf jg jh fd jw jx jy jz aw ka bi"><span id="e021" class="kb kc hi jx b fi kd ke l kf kg">def check_for_key():<br/>   for disk in c.Win32_LogicalDisk():<br/>      if disk.VolumeName==my_key:<br/>         return disk</span></pre><p id="426c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">非常简单容易。这只是迭代任何磁盘驱动器，包括您的内部磁盘，但只有当驱动器名称与您给它的名称匹配时才返回值。</p><p id="5662" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">加密过程的第一部分是我们需要生成一个唯一的加密密钥。这就是我们知道并理解的数据是如何被转换成完全的胡言乱语的。所以在这个函数中，我们想从我们的u盘中读取数据，看看是否已经有一个密钥，如果没有，就创建一个新的。要做到这一点非常简单，我们将使用一个“try”块来尝试和加载密钥，如果没有，我们将在“except”块中创建一个新的。</p><pre class="je jf jg jh fd jw jx jy jz aw ka bi"><span id="0b2c" class="kb kc hi jx b fi kd ke l kf kg">def load_key(usbDisk):<br/>   port = usbDisk.DeviceID<br/>   try:<br/>      print('Trying to find key...')<br/>      with open(f'{port}\\encryptionKey.key','rb') as encryptKey:<br/>         key = encryptKey.read()<br/>         print('Key Found')<br/>   except:<br/>      print('Key not found... Creating a new key')<br/>      key = Fernet.generate_key()<br/>      with open(f'{port}\\encryptionKey.key','wb') as encryptKey:<br/>         encryptKey.write(key)<br/>   return key</span></pre><p id="2864" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以现在我们有了USB端口扫描仪和加密密钥来保护我们的数据。接下来我们需要做的两个函数是加密和解密函数。这些肯定可以浓缩成一个函数，但是为了简单起见，将它们分开更容易。</p><p id="c3fd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从加密功能开始:</p><pre class="je jf jg jh fd jw jx jy jz aw ka bi"><span id="9a7b" class="kb kc hi jx b fi kd ke l kf kg">def encryptFiles(key,directory):<br/>   files = os.listdir(directory)<br/>   cipher = Fernet(key)<br/>   global state<br/>   state = 'encrypted'<br/>   for file in files:<br/>      with open(f'{directory}\{file}','rb') as old:<br/>         original = old.read()<br/>      encrypted = cipher.encrypt(original)<br/>      with open(f'{directory}\{file}','wb') as old:<br/>         old.write(encrypted)</span></pre><p id="9856" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了清楚起见，我们传入的参数是我们的密钥，然后目录是我们在开始时定义的安全文件文件夹的路径。变量state的全局声明后面会更清楚。然后，我们打开目录中的每个文件，并读取它。我们加密内容，然后再次以“写”模式打开文件，用加密的数据替换内容。</p><p id="e53c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以现在解密函数，几乎是一样的:</p><pre class="je jf jg jh fd jw jx jy jz aw ka bi"><span id="0cae" class="kb kc hi jx b fi kd ke l kf kg">def decryptFiles(key,directory):<br/>   files = os.listdir(directory)<br/>   cipher = Fernet(key)<br/>   global state<br/>   state = 'decrypted'<br/>   for file in files:<br/>      with open(f'{directory}\{file}','rb') as old:<br/>         encrypted = old.read()<br/>      decrypted = cipher.decrypt(encrypted)<br/>      with open(f'{directory}\{file}','wb') as old:<br/>         old.write(decrypted)</span></pre><p id="dd27" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是我们唯一需要写的函数！我们只是在代码的底部增加了一个小部分，它将使用这些函数。</p><pre class="je jf jg jh fd jw jx jy jz aw ka bi"><span id="9dc9" class="kb kc hi jx b fi kd ke l kf kg">state = 'decrypted'<br/>if __name__=='__main__':<br/>   while True:<br/>      disk = check_for_key()<br/>      try:<br/>         key = load_key(disk)<br/>      except:<br/>         print('No Key Available')<br/>      if disk!=None:<br/>         current_state = 'decrypted'<br/>         if current_state!=state:<br/>            decryptFiles(key,files)<br/>         else:<br/>            current_state = 'encrypted'<br/>            if current_state!=state:<br/>               encryptFiles(key,files)</span></pre><p id="bcf6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，在这最后一部分，我们只是确保文件只有在“密钥”被插入或移除时才会被加密或解密，而不是不断地被加密或解密，这将给计算机带来真正的压力，并可能使文件无法打开。</p><p id="cedd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">值得注意的是，最后一部分的编码方式意味着当您开始运行脚本时，文件需要以正常格式(解密)存在，并且您的密钥已经插入。之后，它会完全按照你想要的那样工作。另一个注意事项是，并非所有文件类型都适合加密，它最适合纯文本格式和csv文件类型。特别是PDF文件可能会被破坏，所以要小心你使用它的文件，这是你的责任！</p></div><div class="ab cl jp jq gp jr" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="hb hc hd he hf"><p id="d301" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我希望您喜欢尝试加密文件，并且这是使用python保护重要数据安全的有益介绍！</p></div></div>    
</body>
</html>