<html>
<head>
<title>Bazel in Vulkan Projects. Part 2 — Shaders</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Vulkan项目中的Bazel。第2部分—着色器</h1>
<blockquote>原文：<a href="https://medium.com/codex/bazel-in-vulkan-projects-part-2-shaders-35cdeb0f4c67?source=collection_archive---------9-----------------------#2022-11-14">https://medium.com/codex/bazel-in-vulkan-projects-part-2-shaders-35cdeb0f4c67?source=collection_archive---------9-----------------------#2022-11-14</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="55ac" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">用Bazel构建三角形Vulkan应用程序</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/b1dcd8b966591818568a922c9fe54b22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yKHMCYyVaIATrEZae_f8VQ.jpeg"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">图片由<a class="ae jn" href="https://unsplash.com/photos/OiiVv1iiB0A" rel="noopener ugc nofollow" target="_blank">哈维尔·米兰达</a>在<a class="ae jn" href="https://unsplash.com/" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="3425" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这是关于使用Vulkan graphics API和Bazel构建系统构建项目的系列博客文章的第二部分。在第1部分中，我们为一个简单的Vulkan项目执行了一个环境设置，该项目使用了GLM和GLFW库。在这篇博文中，我们将扩展我们的知识，看看如何用Bazel构建GLSL着色器，并运行一个绘制三角形的项目。</p><p id="b019" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在继续这篇博文之前，请务必查看第1部分。</p><p id="ea83" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">您可以在GitHub上找到一个示例项目的完整源代码。</p><div class="kk kl ez fb km kn"><a href="https://github.com/Morfly/vulkan-bazel-samples" rel="noopener  ugc nofollow" target="_blank"><div class="ko ab dw"><div class="kp ab kq cl cj kr"><h2 class="bd hj fi z dy ks ea eb kt ed ef hh bi translated">GitHub-Morfly/vulkan-bazel-samples:为Vulkan建立环境的示例项目…</h2><div class="ku l"><h3 class="bd b fi z dy ks ea eb kt ed ef dx translated">这是一个样例库，展示了如何设置一个开发Vulkan应用程序的环境</h3></div><div class="kv l"><p class="bd b fp z dy ks ea eb kt ed ef dx translated">github.com</p></div></div><div class="kw l"><div class="kx l ky kz la kw lb jh kn"/></div></div></a></div></div><div class="ab cl lc ld gp le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="hb hc hd he hf"><h1 id="585b" class="lj lk hi bd ll lm ln lo lp lq lr ls lt io lu ip lv ir lw is lx iu ly iv lz ma bi translated">构建着色器</h1><p id="e29b" class="pw-post-body-paragraph jo jp hi jq b jr mb ij jt ju mc im jw jx md jz ka kb me kd ke kf mf kh ki kj hb bi translated"><strong class="jq hj"> OpenGL着色语言</strong>(<strong class="jq hj">GLSL</strong>)——是一种高级着色语言，其语法基于C编程语言。它也得到Vulkan的支持。</p><p id="e3aa" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我们将开始创建简单的<a class="ae jn" href="https://vulkan-tutorial.com/code/09_shader_base.vert" rel="noopener ugc nofollow" target="_blank">向量</a>和<a class="ae jn" href="https://vulkan-tutorial.com/code/09_shader_base.frag" rel="noopener ugc nofollow" target="_blank">片段</a>着色器来构建一个三角形。源代码取自<a class="ae jn" href="https://vulkan-tutorial.com/Drawing_a_triangle/Graphics_pipeline_basics/Shader_modules" rel="noopener ugc nofollow" target="_blank">官方Vulkan教程</a>，所以可以随意查看关于着色器代码本身的更多细节。</p><p id="8dfc" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">创建一个<code class="du mg mh mi mj b">shader.vert</code>文件，并将其放在我们在本系列第1部分的<a class="ae jn" rel="noopener" href="/codex/vulkan-in-bazel-projects-part-1-environment-setup-e9fc2ec51b">中使用的项目的<code class="du mg mh mi mj b">triangle/shaders</code>目录中。</a></p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mk ml l"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated"><strong class="ak">三角形/着色器/着色器.垂直</strong>文件内容</figcaption></figure><p id="93d3" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">类似地，在<code class="du mg mh mi mj b">triangle/shaders</code>目录下为名为<code class="du mg mh mi mj b">shader.frag</code>的片段着色器创建一个文件。在那里添加下面的代码。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mk ml l"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated"><strong class="ak">三角形/着色器/shader.frag </strong>文件内容</figcaption></figure><p id="68fb" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">现在，我们准备创建一个Bazel目标来构建我们的着色器。我们将使用之前包含在项目中的<code class="du mg mh mi mj b">rules_vulkan</code>中的<code class="du mg mh mi mj b">glsl_shader</code>规则。在同一个目录下创建一个<code class="du mg mh mi mj b">BUILD</code>文件，并用下面的代码填充它。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mk ml l"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated"><strong class="ak">三角形/着色器/构建</strong>文件内容</figcaption></figure><p id="d149" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">要验证所有操作是否正确，请在终端中运行以下命令，并确保着色器构建成功。</p><pre class="iy iz ja jb fd mm mj mn bn mo mp bi"><span id="756d" class="mq lk hi mj b be mr ms l mt mu">bazel build //triangle/shaders:vert_shader<br/><br/>bazel build //triangle/shaders:frag_shader</span></pre><p id="bfb5" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这是我们到目前为止的目录结构。</p><pre class="iy iz ja jb fd mm mj mn bn mo mp bi"><span id="b6f4" class="mq lk hi mj b be mr ms l mt mu">vulkan-bazel-samples<br/>├── <strong class="mj hj">triangle</strong><br/>│   └── <strong class="mj hj">shaders</strong><br/>│       ├── <strong class="mj hj">shader.frag</strong><br/>│       ├── <strong class="mj hj">shader.frag</strong><br/>│       └── <strong class="mj hj">BUILD</strong><br/>│<br/>├── env_setup<br/>├── third_party<br/>└── WORKSPACE</span></pre><p id="9f7b" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">最后，我们准备构建将使用这些着色器并绘制三角形的应用程序。</p><h1 id="26b5" class="lj lk hi bd ll lm mv lo lp lq mw ls lt io mx ip lv ir my is lx iu mz iv lz ma bi translated">画三角形</h1><p id="eae4" class="pw-post-body-paragraph jo jp hi jq b jr mb ij jt ju mc im jw jx md jz ka kb me kd ke kf mf kh ki kj hb bi translated">为了构建绘制三角形的应用程序，我们将使用来自官方Vulkan教程的源代码。创建一个<code class="du mg mh mi mj b">main.cpp</code>文件，并将其放在<code class="du mg mh mi mj b">triangle</code>目录中。用从Vulkan教程复制的<a class="ae jn" href="https://vulkan-tutorial.com/code/17_swap_chain_recreation.cpp" rel="noopener ugc nofollow" target="_blank">源代码</a>填充。</p><p id="8c06" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我们不会关注代码本身，因为一切都与Vulkan教程相同。然而，我们需要对我们项目的代码做一点小小的修改。打开<code class="du mg mh mi mj b">main.cpp</code>文件，找到一个<code class="du mg mh mi mj b">createGraphicsPipeline</code>函数声明。在这里，我们需要编辑它的前两行，在那里我们改变路径到我们编译的着色器，如下所示。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mk ml l"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated"><strong class="ak"> triangle/main.cpp </strong>文件内容修改</figcaption></figure><p id="f90e" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">现在，剩下的唯一一件事就是定义一个Bazel目标来构建和运行我们的程序。为此，在<code class="du mg mh mi mj b">triangle</code>目录中创建一个<code class="du mg mh mi mj b">BUILD</code>文件。我们将使用标准的<code class="du mg mh mi mj b">cc_binary</code>规则。</p><p id="10c8" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在<code class="du mg mh mi mj b">deps</code>参数中，我们需要包含我们在之前的博文中定义的<code class="du mg mh mi mj b">glfw</code>和<code class="du mg mh mi mj b">glm</code>库。此外，我们需要添加一个Vulkan库本身。</p><p id="ac98" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在<code class="du mg mh mi mj b">data</code>参数中，我们引用了刚刚创建的着色器目标。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mk ml l"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated"><strong class="ak">三角形/构建</strong>文件内容</figcaption></figure><p id="729c" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">最终，我们示例项目的最终文件夹结构如下所示。</p><pre class="iy iz ja jb fd mm mj mn bn mo mp bi"><span id="8800" class="mq lk hi mj b be mr ms l mt mu">vulkan-bazel-samples<br/>├── triangle<br/>│   ├── shaders<br/>│.  │<br/>│   ├── <strong class="mj hj">main.cpp</strong><br/>│   └── <strong class="mj hj">BUILD</strong><br/>│<br/>├── env_setup<br/>├── third_party<br/>└── WORKSPACE</span></pre><h2 id="2c15" class="na lk hi bd ll nb nc nd lp ne nf ng lt jx nh ni lv kb nj nk lx kf nl nm lz nn bi translated">运行应用程序</h2><p id="2d3c" class="pw-post-body-paragraph jo jp hi jq b jr mb ij jt ju mc im jw jx md jz ka kb me kd ke kf mf kh ki kj hb bi translated">这就是我们用Bazel运行三角形Vulkan应用程序所需的全部内容。</p><p id="a403" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">现在，使用下面的命令来构建和启动我们的应用程序。</p><pre class="iy iz ja jb fd mm mj mn bn mo mp bi"><span id="6540" class="mq lk hi mj b be mr ms l mt mu">bazel run //triangle</span></pre><p id="0855" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">如果一切都做得正确，它将运行一个应用程序，在屏幕上画一个三角形，如下所示。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es no"><img src="../Images/00905431aeb2a503550ba274baa02558.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2IXrotgjfEMsc0fq3s62oQ.png"/></div></div></figure><h1 id="f2c5" class="lj lk hi bd ll lm mv lo lp lq mw ls lt io mx ip lv ir my is lx iu mz iv lz ma bi translated">结论</h1><p id="9078" class="pw-post-body-paragraph jo jp hi jq b jr mb ij jt ju mc im jw jx md jz ka kb me kd ke kf mf kh ki kj hb bi translated">就是这个！在这一系列简短的博客文章中，我们看到了如何执行一个基本的设置，以便能够在带有Vulkan graphics API的项目中使用Bazel。</p><p id="793b" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在<a class="ae jn" rel="noopener" href="/codex/vulkan-in-bazel-projects-part-1-environment-setup-e9fc2ec51b">第1部分</a>中，我们为项目进行了环境设置，现在我们运行一个用Bazel构建的基本三角形应用程序。</p><p id="dcb5" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这篇博文的所有源代码都可以在GitHub上找到。</p><div class="kk kl ez fb km kn"><a href="https://github.com/Morfly/vulkan-bazel-samples" rel="noopener  ugc nofollow" target="_blank"><div class="ko ab dw"><div class="kp ab kq cl cj kr"><h2 class="bd hj fi z dy ks ea eb kt ed ef hh bi translated">GitHub-Morfly/vulkan-bazel-samples:为应用程序设置环境的示例报告…</h2><div class="ku l"><h3 class="bd b fi z dy ks ea eb kt ed ef dx translated">为使用Vulkan graphics API的应用程序设置环境的示例报告，该API是用Bazel - GitHub构建的…</h3></div><div class="kv l"><p class="bd b fp z dy ks ea eb kt ed ef dx translated">github.com</p></div></div><div class="kw l"><div class="np l ky kz la kw lb jh kn"/></div></div></a></div><h2 id="969c" class="na lk hi bd ll nb nc nd lp ne nf ng lt jx nh ni lv kb nj nk lx kf nl nm lz nn bi translated">参考</h2><ul class=""><li id="5df4" class="nq nr hi jq b jr mb ju mc jx ns kb nt kf nu kj nv nw nx ny bi translated"><a class="ae jn" href="https://github.com/jadarve/rules_vulkan" rel="noopener ugc nofollow" target="_blank"><strong class="jq hj">rules _ vulkan</strong></a><strong class="jq hj"/>—一个使Bazel能够支持Vulkan项目的存储库，由Juan David Adarve创建。</li></ul></div></div>    
</body>
</html>