<html>
<head>
<title>Easily update your React Native App with CodePush.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用CodePush轻松更新React原生应用。</h1>
<blockquote>原文：<a href="https://medium.com/codex/easily-update-your-react-native-app-with-codepush-db5858e0706b?source=collection_archive---------13-----------------------#2021-08-15">https://medium.com/codex/easily-update-your-react-native-app-with-codepush-db5858e0706b?source=collection_archive---------13-----------------------#2021-08-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/c9bda24ea440a6681b7525087fe47bb1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bR2ZqNEsZfNRREQF2dFt9A.jpeg"/></div></div></figure><h1 id="b4f1" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">为什么是CodePush？</h1><blockquote class="jo jp jq"><p id="0335" class="jr js jt ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated"><em class="hi"/><a class="ae kq" href="https://github.com/microsoft/code-push" rel="noopener ugc nofollow" target="_blank"><em class="hi">code push服务</em> </a> <em class="hi">，</em><a class="ae kq" href="https://appcenter.ms/" rel="noopener ugc nofollow" target="_blank"><em class="hi">App center</em></a><em class="hi">的一部分，是一个云服务，使</em><strong class="ju hj"><em class="hi">Cordova</em></strong><em class="hi">和</em> <strong class="ju hj"> <em class="hi"> React原生</em> </strong> <em class="hi">开发者能够将移动应用更新直接部署到他们用户的设备上。</em></p><p id="8776" class="jr js jt ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">App center是微软在云中构建、测试、分发和监控应用的解决方案。</p></blockquote><p id="9ebf" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">(TLDR)当你开始开发移动应用时，会发生一些事情。你意识到在某些时候项目的所有者会想看看你的工作进展到什么程度了。与web应用程序不同，在web应用程序中，你可以通过url发送给客户端进行检查，而对于移动应用程序(例如android ),你必须构建一个我们称之为<code class="du ku kv kw kx b">release apk</code>的东西，然后发送给客户端。有时apk的大小可以达到40mb+。我们在这里通常做的是将apk上传到Google drive，客户端可以从那里下载(当然也有其他细粒度的方法，比如在Playstore中托管为beta)。</p><p id="b3f9" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">现在的问题是，每次你做了一个新的改变(例如，修复一个打字错误，改变颜色)客户想看到的，你必须重新构建，然后再次上传到Google drive。因此，项目负责人必须从他的手机上卸载以前的应用程序，并下载新版本，比如说40mb+。但愿你没有再犯同样的错误，否则你就得重新开始。</p><blockquote class="jo jp jq"><p id="b935" class="jr js jt ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">一天早上，一位客户想向他的投资者演示一款应用，我们不得不上传和下载更多的9x，同时修改非常小的改动。</p></blockquote><p id="ab4e" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">另一件事是，一旦应用程序通过playstore(Android)或App store(ios)发布，更新JavaScript代码(例如，修复错误或添加新功能)或图像资产，需要重新编译和重新分发整个二进制文件，这当然包括与发布它的商店相关的任何审查时间。我必须说很可怕。</p><p id="3967" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">简单来说，CodePush为你做的是确保用户不必每次都删除他的应用程序并安装一个全新的40mb应用程序，而是告诉他有一个新的更新，如果他接受它，新的/所需的更改将在他仍然使用应用程序时下载。只有所需的变化大小将被下载，比如3mb，2kb等，而不是40mb+的整个应用程序。</p><p id="b1f0" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">CodePush的另一个优点是，它维护您发布的每个更新版本的副本。这样做的好处是，如果你发布了一个新的更新，而这个更新导致应用程序崩溃，你可以回滚到之前的工作更新。</p><p id="af69" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">有这么多，但这只是一点。我相信你现在已经了解大局了。因此，让我们看看如何将CodePush集成到我们的React本机应用程序中。</p><blockquote class="jo jp jq"><p id="73fc" class="jr js jt ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated"><em class="hi">但是请注意，CodePush不会更新任何影响本机代码的更改，例如修改app delegate . m/main activity . Java文件、添加新插件。这些必须通过适当的商店进行更新。</em></p></blockquote><h1 id="6777" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">创建一个React本地项目</h1><p id="38ac" class="pw-post-body-paragraph jr js hi ju b jv ky jx jy jz kz kb kc kr la kf kg ks lb kj kk kt lc kn ko kp hb bi translated">如果您已经有了一个React本地项目，那很好，否则请导航到您选择的终端目录并键入</p><pre class="ld le lf lg fd lh kx li lj aw lk bi"><span id="d66f" class="ll ir hi kx b fi lm ln l lo lp">npx react-native init RNTutorials</span></pre><p id="fab7" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">这将创建一个名为<code class="du ku kv kw kx b">RNTutorials</code>的新React本地项目。确保它在android和iOS上运行etc。</p><h1 id="0f2d" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">创建应用中心帐户</h1><p id="d59a" class="pw-post-body-paragraph jr js hi ju b jv ky jx jy jz kz kb kc kr la kf kg ks lb kj kk kt lc kn ko kp hb bi translated">前往<a class="ae kq" href="https://appcenter.ms/create-account" rel="noopener ugc nofollow" target="_blank">微软应用中心</a>创建一个免费账户。除了CodePush服务，App center还提供其他服务，如构建应用二进制文件(aab、apk、ipa)、应用分发管理、真实设备上的应用测试、崩溃和使用分析。</p><h1 id="369d" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">在应用中心创建您的应用</h1><p id="139e" class="pw-post-body-paragraph jr js hi ju b jv ky jx jy jz kz kb kc kr la kf kg ks lb kj kk kt lc kn ko kp hb bi translated">一旦你注册并登录到你的仪表板，接下来的事情是在应用中心创建你的应用，你的应用可以是ios或android。</p><p id="4e1f" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">在您的仪表板上，单击“<code class="du ku kv kw kx b">Add New</code>”按钮。</p><figure class="ld le lf lg fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lq"><img src="../Images/75db3e88193fde0383b379779a5de794.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5D-oOjNM-YuwDD8_"/></div></div></figure><p id="6030" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">这将打开一个新页面来创建您的应用程序，我们将进行两次，首先是iOS，然后是android。</p><figure class="ld le lf lg fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lr"><img src="../Images/ef2f4c025e5664a321edb8d1d6eb1ac6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*u7NsQP8RFUvnHshM"/></div></div></figure><p id="5796" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">为ios填写如下表格:</p><ul class=""><li id="fe5f" class="ls lt hi ju b jv jw jz ka kr lu ks lv kt lw kp lx ly lz ma bi translated">应用名称:你的是你的应用名称，我的是<code class="du ku kv kw kx b">RNTutorials-ios</code>，</li><li id="70db" class="ls lt hi ju b jv mb jz mc kr md ks me kt mf kp lx ly lz ma bi translated">图标:你的应用图标，</li><li id="0880" class="ls lt hi ju b jv mb jz mc kr md ks me kt mf kp lx ly lz ma bi translated">释放类型:选择<code class="du ku kv kw kx b">Production</code>，</li><li id="d818" class="ls lt hi ju b jv mb jz mc kr md ks me kt mf kp lx ly lz ma bi translated">OS:选择<code class="du ku kv kw kx b">iOS</code>，</li><li id="966a" class="ls lt hi ju b jv mb jz mc kr md ks me kt mf kp lx ly lz ma bi translated">平台:选择<code class="du ku kv kw kx b">React Native</code>，</li></ul><p id="8d60" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">现在点击<code class="du ku kv kw kx b">Add new app</code>按钮完成该过程。</p><p id="b0ab" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">它将带你到新创建的应用程序的概览屏幕，其中包含你想要添加分析和应用程序中心崩溃的信息。</p><p id="7724" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">返回上一页或再次点击仪表板上的<code class="du ku kv kw kx b">Add New</code>按钮，为android创建如下内容:</p><ul class=""><li id="377b" class="ls lt hi ju b jv jw jz ka kr lu ks lv kt lw kp lx ly lz ma bi translated">App名称:你的是你的app名称，我的是<code class="du ku kv kw kx b">RNTutorials-android</code>，</li><li id="c805" class="ls lt hi ju b jv mb jz mc kr md ks me kt mf kp lx ly lz ma bi translated">图标:你的应用图标，</li><li id="45ee" class="ls lt hi ju b jv mb jz mc kr md ks me kt mf kp lx ly lz ma bi translated">释放类型:选择<code class="du ku kv kw kx b">Production</code>，</li><li id="678c" class="ls lt hi ju b jv mb jz mc kr md ks me kt mf kp lx ly lz ma bi translated">操作系统:选择<code class="du ku kv kw kx b">Android</code>，</li><li id="40f8" class="ls lt hi ju b jv mb jz mc kr md ks me kt mf kp lx ly lz ma bi translated">平台:选择<code class="du ku kv kw kx b">React Native</code>，</li></ul><p id="2182" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">现在点击<code class="du ku kv kw kx b">Add new app</code>按钮完成该过程。</p><p id="c3b6" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">在您的仪表板上，您现在应该可以看到新创建的应用程序。</p><figure class="ld le lf lg fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mg"><img src="../Images/d2c7b24d3d910ef9e44a7fe81bd9090f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*7HnJ8M9M4W10yGEN"/></div></div></figure><p id="cf86" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">点击其中任何一个，让我们从android开始，所以点击</p><blockquote class="jo jp jq"><p id="6c0d" class="jr js jt ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated"><em class="hi">rn tutorials-Android&gt;Distribute&gt;code push&gt;创建标准部署。</em></p></blockquote><p id="154b" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">这样，App center将为您创建两个环境:暂存和生产。对于本指南，我们将使用生产。</p><p id="ada1" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">也去ios App做同样的事情</p><blockquote class="jo jp jq"><p id="263e" class="jr js jt ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated"><em class="hi">rn tutorials-IOs&gt;Distribute&gt;code push&gt;创建标准部署。</em></p></blockquote><figure class="ld le lf lg fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mh"><img src="../Images/12716af77661a6a39b49fe4a61b7bd9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Z6CzuWFJ4nPkWH23"/></div></div></figure><h1 id="dd5a" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">在React Native client应用中实现CodePush SDK</h1><p id="c355" class="pw-post-body-paragraph jr js hi ju b jv ky jx jy jz kz kb kc kr la kf kg ks lb kj kk kt lc kn ko kp hb bi translated">通过在命令行上运行以下命令来全局安装appcenter-cli</p><pre class="ld le lf lg fd lh kx li lj aw lk bi"><span id="8ed0" class="ll ir hi kx b fi lm ln l lo lp">npm install -g appcenter-cli</span></pre><p id="e6c1" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">在成功的全局安装之后，您必须通过终端运行以下命令登录到appcenter</p><pre class="ld le lf lg fd lh kx li lj aw lk bi"><span id="e1d3" class="ll ir hi kx b fi lm ln l lo lp">appcenter login</span></pre><p id="d5fb" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">现在转到你的应用程序，安装react原生代码推送</p><pre class="ld le lf lg fd lh kx li lj aw lk bi"><span id="82e6" class="ll ir hi kx b fi lm ln l lo lp">npm install --save react-native-code-push yarn add react-native-code-push</span></pre><blockquote class="jo jp jq"><p id="03c6" class="jr js jt ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated"><em class="hi">大多数React原生插件通常对Android和iOS有不同的集成流程。让我们继续做单独的设置。</em></p></blockquote><h1 id="954b" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">Android设置</h1><p id="2204" class="pw-post-body-paragraph jr js hi ju b jv ky jx jy jz kz kb kc kr la kf kg ks lb kj kk kt lc kn ko kp hb bi translated">从你的应用程序，</p><ul class=""><li id="9fed" class="ls lt hi ju b jv jw jz ka kr lu ks lv kt lw kp lx ly lz ma bi translated">转到<code class="du ku kv kw kx b">android/settings.gradle</code>并添加以下代码行；</li></ul><pre class="ld le lf lg fd lh kx li lj aw lk bi"><span id="afba" class="ll ir hi kx b fi lm ln l lo lp">include ':app', ':react-native-code-push'<br/>project(':react-native-code-push').projectDir = new File(rootProject.projectDir, '../node_modules/react-native-code-push/android/app')</span></pre><ul class=""><li id="38fa" class="ls lt hi ju b jv jw jz ka kr lu ks lv kt lw kp lx ly lz ma bi translated">转到<code class="du ku kv kw kx b">android/app/build.gradle</code>，寻找这段代码</li></ul><p id="d248" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated"><code class="du ku kv kw kx b">apply from: "../../node_modules/react-native/react.gradle"</code></p><ul class=""><li id="c1c8" class="ls lt hi ju b jv jw jz ka kr lu ks lv kt lw kp lx ly lz ma bi translated">然后在它下面加上这个</li></ul><p id="6763" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated"><code class="du ku kv kw kx b">apply from: "../../node_modules/react-native-code-push/android/codepush.gradle"</code></p><ul class=""><li id="2143" class="ls lt hi ju b jv jw jz ka kr lu ks lv kt lw kp lx ly lz ma bi translated">现在一切看起来应该是这样的:</li></ul><pre class="ld le lf lg fd lh kx li lj aw lk bi"><span id="d41c" class="ll ir hi kx b fi lm ln l lo lp">...<br/>apply from: "../../node_modules/react-native/react.gradle"<br/>apply from: "../../node_modules/react-native-code-push/android/codepush.gradle"<br/>...</span></pre><ul class=""><li id="4f08" class="ls lt hi ju b jv jw jz ka kr lu ks lv kt lw kp lx ly lz ma bi translated">去<code class="du ku kv kw kx b">android/app/src/main/java/MainApplication.java</code></li></ul><p id="d43d" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">首先导入插件类</p><pre class="ld le lf lg fd lh kx li lj aw lk bi"><span id="466e" class="ll ir hi kx b fi lm ln l lo lp">import com.microsoft.codepush.react.CodePush;</span></pre><p id="88a7" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">然后在这里更新</p><pre class="ld le lf lg fd lh kx li lj aw lk bi"><span id="ecf8" class="ll ir hi kx b fi lm ln l lo lp">public class MainApplication extends Application implements ReactApplication {<br/>    private final ReactNativeHost mReactNativeHost = new ReactNativeHost(this) {<br/>        ...<br/>        // Override the getJSBundleFile method to let<br/>        // the CodePush runtime determine where to get the JS<br/>        // bundle location from on each app start<br/>        <a class="ae kq" href="http://twitter.com/Override" rel="noopener ugc nofollow" target="_blank">@Override</a><br/>        protected String getJSBundleFile() {<br/>            return CodePush.getJSBundleFile();<br/>        }<br/>    };<br/>}</span></pre><p id="a464" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">要获取部署密钥，请在终端中键入以下内容</p><pre class="ld le lf lg fd lh kx li lj aw lk bi"><span id="95bc" class="ll ir hi kx b fi lm ln l lo lp">appcenter codepush deployment list -a &lt;ownerName&gt;/&lt;appName&gt; -k</span></pre><p id="27ff" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">我的看起来像这样</p><pre class="ld le lf lg fd lh kx li lj aw lk bi"><span id="ba22" class="ll ir hi kx b fi lm ln l lo lp">appcenter codepush deployment list -a dexiouz/RNTutorials-android -k</span></pre><p id="dd44" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">你应该有这样的东西</p><pre class="ld le lf lg fd lh kx li lj aw lk bi"><span id="c968" class="ll ir hi kx b fi lm ln l lo lp">Name: Staging, Key: <!-- -->opoGVuUethk2uZlFsWX5Oq1upZeSoiBLcYAjc<br/>Name: Production, Key: ZrgDzqIHGennFQ3fhDw3U915LmudyRcXSZswW</span></pre><p id="b8b7" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">部署密钥让CodePush知道它应该总是查询哪个运行时(从哪个运行时更新),是登台还是生产。我们将使用<code class="du ku kv kw kx b">production</code>。</p><p id="a16d" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">找到部署键的另一种方法是在<code class="du ku kv kw kx b">yourApp/Distribute/CodePush</code>点击CodePush仪表板上的选项图标。在右上角，看着像扳手哈哈。</p><figure class="ld le lf lg fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mh"><img src="../Images/057b0e4b8945acbb67545166bc2ebbc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JRoECQOZQI52asAf"/></div></div></figure><p id="ea36" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">为了利用<code class="du ku kv kw kx b">android/app/src/main/res/values/strings.xml</code>中的部署密钥，创建一个名为<code class="du ku kv kw kx b">CodePushDeploymentKey</code>的新字符串，其值是您想要配置此应用程序的部署密钥(类似于生产部署的密钥)。您的<code class="du ku kv kw kx b">strings.xml</code>应该看起来像这样，确保您复制了用于生产的部署密钥。</p><pre class="ld le lf lg fd lh kx li lj aw lk bi"><span id="7d63" class="ll ir hi kx b fi lm ln l lo lp">&lt;resources&gt; <br/>  &lt;string name="app_name"&gt;RNTutorials&lt;/string&gt; <br/>  &lt;string moduleConfig="true" name="CodePushDeploymentKey"&gt;ZrgDzqIHGennFQ3fhDw3U915LmudyRcXSZswW&lt;/string&gt; <br/>&lt;/resources&gt;</span></pre><h1 id="4307" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">用CodePush包装你的根组件。</h1><p id="3b1a" class="pw-post-body-paragraph jr js hi ju b jv ky jx jy jz kz kb kc kr la kf kg ks lb kj kk kt lc kn ko kp hb bi translated">在我的例子中，根组件是<code class="du ku kv kw kx b">App.js</code>。</p><pre class="ld le lf lg fd lh kx li lj aw lk bi"><span id="08e1" class="ll ir hi kx b fi lm ln l lo lp">// App.js<br/>...<br/>import codePush from "react-native-code-push";</span><span id="096e" class="ll ir hi kx b fi mi ln l lo lp">let codePushOptions = { <br/>    checkFrequency: codePush.CheckFrequency.ON_APP_RESUME, <br/>    updateDialog: { appendReleaseDescription: true }<br/>};</span><span id="122e" class="ll ir hi kx b fi mi ln l lo lp">...<br/>const App = () =&gt; {<br/>    return (<br/>        ...<br/>    )<br/>};</span><span id="e426" class="ll ir hi kx b fi mi ln l lo lp">export default codePush(codePushOptions)(App);</span></pre><p id="d74f" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">注意我们增加了<code class="du ku kv kw kx b">codePushOptions</code>，你可以在这里查看codePushOptions <a class="ae kq" href="https://docs.microsoft.com/en-gb/appcenter/distribution/codepush/rn-api-ref#codepushoptions" rel="noopener ugc nofollow" target="_blank">列表。选项update dialog:{ appendReleaseDescription:true }表示当更新可用时，用户将获得更新对话框。</a></p><p id="6af0" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">现在重新构建您的应用程序，并检查metro日志，您应该会看到类似这样的内容。</p><p id="8976" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">厉害！</p><h1 id="16e2" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">向CodePush发布一个android版本</h1><p id="6319" class="pw-post-body-paragraph jr js hi ju b jv ky jx jy jz kz kb kc kr la kf kg ks lb kj kk kt lc kn ko kp hb bi translated">通过跑步做到这一点</p><pre class="ld le lf lg fd lh kx li lj aw lk bi"><span id="8571" class="ll ir hi kx b fi lm ln l lo lp">appcenter codepush release-react -a &lt;owner_name&gt;/&lt;app_name&gt; -d Production</span></pre><p id="caf0" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">在我的情况下，我做到了</p><pre class="ld le lf lg fd lh kx li lj aw lk bi"><span id="1800" class="ll ir hi kx b fi lm ln l lo lp">appcenter codepush release-react -a dexiouz/RNTutorials-android -d Production</span></pre><p id="bca7" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">在处理和完成时，我的终端是这样的</p><pre class="ld le lf lg fd lh kx li lj aw lk bi"><span id="05d7" class="ll ir hi kx b fi lm ln l lo lp">chidera@Chideras-MacBook-Pro RNTutorials % appcenter codepush release-react -a dexiouz/RNTutorials-android -d Production</span><span id="2f2e" class="ll ir hi kx b fi mi ln l lo lp">Detecting android app version:</span><span id="ede6" class="ll ir hi kx b fi mi ln l lo lp">Using the target binary version value "1.0" from "android/app/build.gradle".</span><span id="63af" class="ll ir hi kx b fi mi ln l lo lp">Running "react-native bundle" command:</span><span id="a142" class="ll ir hi kx b fi mi ln l lo lp">node node_modules/.bin/react-native bundle --assets-dest /var/folders/0n/n74jzbv13t5269c8zqm7hwl00000gn/T/code-push2021715-16893-1gyz5o7.htyy/CodePush --bundle-output /var/folders/0n/n74jzbv13t5269c8zqm7hwl00000gn/T/code-push2021715-16893-1gyz5o7.htyy/CodePush/index.android.bundle --dev false --entry-file index.js --platform android<br/>Welcome to Metro!<br/>              Fast - Scalable - Integrated</span><span id="5610" class="ll ir hi kx b fi mi ln l lo lp">info Writing bundle output to:, /var/folders/0n/n74jzbv13t5269c8zqm7hwl00000gn/T/code-push2021715-16893-1gyz5o7.htyy/CodePush/index.android.bundle<br/>info Done writing bundle output<br/>info Copying 3 asset files<br/>info Done copying assets</span><span id="1e99" class="ll ir hi kx b fi mi ln l lo lp">Releasing update contents to CodePush:</span><span id="f859" class="ll ir hi kx b fi mi ln l lo lp">Your target-binary-version "1.0" will be treated as "1.0.X".</span><span id="37f0" class="ll ir hi kx b fi mi ln l lo lp">Successfully released an update containing the "/var/folders/0n/n74jzbv13t5269c8zqm7hwl00000gn/T/code-push2021715-16893-1gyz5o7.htyy/CodePush" directory to the "Production" deployment of the "RNTutorials-android" app.<br/>```</span></pre><p id="65b4" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">成功后，返回到应用中心的CodePush仪表板，重新加载并确保您的新版本在那里。</p><p id="bd5f" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">要确认一切正常，请再次运行应用程序，查看metro服务器日志，注意您可以从CodePush下载最新版本。</p><figure class="ld le lf lg fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mh"><img src="../Images/17addd5a69ef4d30a815b538e227587b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*g_T17NOAzQALOGQC"/></div></div></figure><p id="2427" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">单击“安装”后，我们会在metro服务器日志中看到这个消息</p><pre class="ld le lf lg fd lh kx li lj aw lk bi"><span id="006a" class="ll ir hi kx b fi lm ln l lo lp">LOG  Running "RNTutorials" with {"rootTag":21}<br/> LOG  [CodePush] Sync already in progress.<br/> LOG  [CodePush] Checking for update.<br/> LOG  [CodePush] Awaiting user action.<br/> LOG  [CodePush] Downloading package.<br/> LOG  [CodePush] Installing update.<br/> LOG  [CodePush] Update is installed and will be run on the next app restart.</span></pre><p id="e921" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">它说新的更新将在下一次应用程序重启时运行。但是如果你想在同一个会话中运行它，而不是在重启应用程序时，那么，点击应用程序中心上的<code class="du ku kv kw kx b">Released update</code>，点击选项图标，然后勾选“需要更新”按钮为真。然后点击“完成”。</p><figure class="ld le lf lg fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mh"><img src="../Images/f3fda71ebaeedb818291e994b16087b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*MaHZ1SaYmMYoUTNU"/></div></div></figure><h1 id="54ab" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">iOS设置</h1><p id="4a1c" class="pw-post-body-paragraph jr js hi ju b jv ky jx jy jz kz kb kc kr la kf kg ks lb kj kk kt lc kn ko kp hb bi translated">对于iOS设置，由于您已经安装了react-native-codePush，请执行以下操作</p><p id="dd5b" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">从你的应用程序，</p><p id="2147" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">还是在<code class="du ku kv kw kx b">AppDelegate.m</code>里，找到这行代码</p><pre class="ld le lf lg fd lh kx li lj aw lk bi"><span id="c7f5" class="ll ir hi kx b fi lm ln l lo lp">return [[NSBundle mainBundle] URLForResource:@"main" withExtension:@"jsbundle"];</span></pre><p id="6eaa" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">并替换为</p><pre class="ld le lf lg fd lh kx li lj aw lk bi"><span id="8f41" class="ll ir hi kx b fi lm ln l lo lp">return [CodePush bundleURL];</span></pre><p id="9d0d" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">此更改会将您的应用程序配置为始终加载您的应用程序的JS包的最新版本。</p><p id="470d" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">还记得那个部署键吗？，我们来拿iOS版的加到这里。</p><p id="c27c" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">我们将创建一个名为<code class="du ku kv kw kx b">CodePushDeploymentKey</code>的新条目，它的值是您想要配置该应用的部署的关键字(在我们的例子中，它是生产)。</p><p id="f693" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">要获取部署密钥，请在终端中键入以下内容</p><pre class="ld le lf lg fd lh kx li lj aw lk bi"><span id="f105" class="ll ir hi kx b fi lm ln l lo lp">appcenter codepush deployment list -a &lt;ownerName&gt;/&lt;appName&gt; -k</span></pre><p id="ef8f" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">我的看起来像这样</p><pre class="ld le lf lg fd lh kx li lj aw lk bi"><span id="ec48" class="ll ir hi kx b fi lm ln l lo lp">appcenter codepush deployment list -a dexiouz/RNTutorials-ios -kd</span></pre><p id="604c" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">你应该有这样的东西</p><pre class="ld le lf lg fd lh kx li lj aw lk bi"><span id="d1c8" class="ll ir hi kx b fi lm ln l lo lp">Name: <!-- -->Staging, Key: Xheg3rfeO7VyKtEoGSRnRh3Lrh0lgwVs2j4rt<br/>Name: Production, Key: QbQuDUS4hSELnN4BMrVos1pWsvX6k6MnFFedc</span></pre><p id="6b40" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">部署密钥让CodePush知道它应该总是查询哪个运行时(从哪个运行时更新),是登台还是生产。我们将使用<code class="du ku kv kw kx b">production</code>。</p><p id="771f" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">找到部署密钥的另一种方法是在<code class="du ku kv kw kx b">yourApp/Distribute/CodePush</code>点击CodePush仪表板上的选项图标。在右上角，看着像扳手哈哈。</p><p id="d5f3" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">现在复制用于生产的部署密钥，并将该密钥添加到<code class="du ku kv kw kx b">info.plist</code></p><pre class="ld le lf lg fd lh kx li lj aw lk bi"><span id="a09d" class="ll ir hi kx b fi lm ln l lo lp">... <br/>&lt;key&gt;CodePushDeploymentKey&lt;/key&gt; &lt;string&gt;QbQuDUS4hSELnN4BMrVos1pWsvX6k6MnFFedc&lt;/string&gt;<br/>...</span></pre><p id="0d19" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">因为我们已经用CodePush包装了根组件，所以让我们继续重新构建我们的ios应用程序。</p><p id="218f" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">检查metro服务器日志，我们得到</p><h1 id="e5f7" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">向代码推送发布iOS版本</h1><p id="007d" class="pw-post-body-paragraph jr js hi ju b jv ky jx jy jz kz kb kc kr la kf kg ks lb kj kk kt lc kn ko kp hb bi translated">通过跑步做到这一点</p><pre class="ld le lf lg fd lh kx li lj aw lk bi"><span id="be84" class="ll ir hi kx b fi lm ln l lo lp">appcenter codepush release-react -a &lt;owner_name&gt;/&lt;app_name&gt; -d Production</span></pre><p id="b052" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">在我的情况下，我做到了</p><pre class="ld le lf lg fd lh kx li lj aw lk bi"><span id="6e91" class="ll ir hi kx b fi lm ln l lo lp">appcenter codepush release-react -a dexiouz/RNTutorials-ios -d Production</span></pre><p id="fa1b" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">我的终端看起来像这样</p><pre class="ld le lf lg fd lh kx li lj aw lk bi"><span id="fa06" class="ll ir hi kx b fi lm ln l lo lp">chidera@Chideras-MacBook-Pro RNTutorials % appcenter codepush release-react -a dexiouz/RNTutorials-ios -d Production<br/>Detecting ios app version:</span><span id="4def" class="ll ir hi kx b fi mi ln l lo lp">Using the target binary version value "1.0" from "ios/rntutorials/Info.plist".</span><span id="4748" class="ll ir hi kx b fi mi ln l lo lp">Running "react-native bundle" command:</span><span id="9b63" class="ll ir hi kx b fi mi ln l lo lp">node node_modules/.bin/react-native bundle --assets-dest /var/folders/0n/n74jzbv13t5269c8zqm7hwl00000gn/T/code-push2021715-21428-tdqvv2.pgc5/CodePush --bundle-output /var/folders/0n/n74jzbv13t5269c8zqm7hwl00000gn/T/code-push2021715-21428-tdqvv2.pgc5/CodePush/main.jsbundle --dev false --entry-file index.js --platform ios<br/>Welcome to Metro!<br/>              Fast - Scalable - Integrated</span><span id="41c3" class="ll ir hi kx b fi mi ln l lo lp">info Writing bundle output to:, /var/folders/0n/n74jzbv13t5269c8zqm7hwl00000gn/T/code-push2021715-21428-tdqvv2.pgc5/CodePush/main.jsbundle<br/>info Done writing bundle output<br/>info Copying 3 asset files<br/>info Done copying assets</span><span id="3d56" class="ll ir hi kx b fi mi ln l lo lp">Releasing update contents to CodePush:</span><span id="056a" class="ll ir hi kx b fi mi ln l lo lp">Your target-binary-version "1.0" will be treated as "1.0.X".</span><span id="e4aa" class="ll ir hi kx b fi mi ln l lo lp">Successfully released an update containing the "/var/folders/0n/n74jzbv13t5269c8zqm7hwl00000gn/T/code-push2021715-21428-tdqvv2.pgc5/CodePush" directory to the "Production" deployment of the "RNTutorials-ios" app.<br/>chidera@Chideras-MacBook-Pro RNTutorials %</span></pre><p id="a672" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">要确认一切正常，请再次运行应用程序，查看metro服务器日志，注意您可以从CodePush下载最新版本。</p><figure class="ld le lf lg fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mh"><img src="../Images/0060ab0576c82e8299d5692b08d7238f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_Fc49xKwJDryRpt-"/></div></div></figure><p id="c07c" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">单击“安装”后，我们会在metro服务器日志中看到这个消息</p><pre class="ld le lf lg fd lh kx li lj aw lk bi"><span id="744e" class="ll ir hi kx b fi lm ln l lo lp">LOG  Running "RNTutorials" with {"rootTag":1,"initialProps":{}}<br/> LOG  [CodePush] Sync already in progress.<br/> LOG  [CodePush] Checking for update.<br/> LOG  [CodePush] Awaiting user action.<br/> LOG  [CodePush] Downloading package.<br/> WARN  Sending `CodePushDownloadProgress` with no listeners registered.<br/> LOG  [CodePush] Installing update.<br/> LOG  [CodePush] Update is installed and will be run on the next app restart.</span></pre><p id="3e6b" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">它说新的更新将在下一次应用程序重启时运行。但是，如果您想在同一个会话中运行它，而不是在重启应用程序时运行，那么，单击应用程序中心上的<code class="du ku kv kw kx b">Released update</code>,单击选项图标，然后选中“需要更新”按钮。然后点击“完成”。</p><figure class="ld le lf lg fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mh"><img src="../Images/6efd898fdde9e907e8ea2c3b3c5cdd40.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*tUt4j16aYu2GxpRX"/></div></div></figure><p id="4d5d" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">如果您访问，可以查看您的ios版本</p><p id="0c81" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated"><code class="du ku kv kw kx b">yourapp/Distribute/CodePush/Production(From the options icon - top right)</code>。</p><p id="0109" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">仅此而已。恭喜您，您已经成功在React本机应用中设置了CodePush服务。</p><blockquote class="jo jp jq"><p id="9934" class="jr js jt ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">如果你觉得这篇文章有用，请点赞，留下你的评论并与你的朋友分享。</p><p id="9ad6" class="jr js jt ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated"><em class="hi">你也可以在推特上关注我:</em> <a class="ae kq" href="https://twitter.com/talk2dera" rel="noopener ugc nofollow" target="_blank"> <em class="hi"> @talk2dera </em> </a></p></blockquote></div><div class="ab cl mj mk gp ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="hb hc hd he hf"><p id="618b" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated"><em class="jt">原发布于</em><a class="ae kq" href="https://dera.hashnode.dev/easily-update-your-react-native-app-with-codepush" rel="noopener ugc nofollow" target="_blank"><em class="jt">https://dera . hash node . dev</em></a><em class="jt">。</em></p></div></div>    
</body>
</html>