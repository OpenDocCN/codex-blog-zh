<html>
<head>
<title>A real example of building Electron app: from scratch to release, and all those gotchas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">一个构建电子应用的真实例子:从零开始到发布，以及所有这些问题</h1>
<blockquote>原文：<a href="https://medium.com/codex/a-real-example-of-building-electron-app-from-scratch-to-release-and-all-those-gotchas-36511d1e6eaa?source=collection_archive---------1-----------------------#2021-07-24">https://medium.com/codex/a-real-example-of-building-electron-app-from-scratch-to-release-and-all-those-gotchas-36511d1e6eaa?source=collection_archive---------1-----------------------#2021-07-24</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="bdb4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我不是一个阅读和编写图书馆教程的爱好者，我更喜欢阅读官方文档，我认为这是学习东西的最好方式，而不是阅读一些二手教程。但是当我试图构建自己的产品时:由React编写并由<a class="ae jd" href="https://electronjs.org/" rel="noopener ugc nofollow" target="_blank">电子</a>包装的<a class="ae jd" href="http://www.midinote.me" rel="noopener ugc nofollow" target="_blank"> Midinote </a>。我读了几乎所有的官方文件，但仍然很难把事情做好，官方文件似乎没有很好地组织起来，特别是对于它使用的一些子模块，如<a class="ae jd" href="https://www.electronforge.io/" rel="noopener ugc nofollow" target="_blank">Forge</a>——打包和发布电子应用程序的库——看起来像是在做一个益智游戏。事情不应该是这样的，它只是一个工具，对人来说应该越简单越好，我们需要用有限的精力去处理编程中真正辛苦的工作，对吧？</p><p id="a880" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用electronic构建应用程序很难的另一个原因是，它涉及到应用程序规范的一些概念和在不同平台(如macOS、Windows、App Store)上发布应用程序的工作流程，以及对应用程序结构的一些基本理解。</p><p id="f739" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以我决定写这篇文章，它将涵盖从开发一个电子应用程序到如何发布它的整个工作流程，以及我遇到的所有麻烦。我还将沿途解释一些基本概念或结构，让您知道它是如何工作的。</p><p id="50a1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我只能讲macOS的部分，因为我还没有在Windows上开发应用的经验，等我在Windows上开发的时候我会写这部分。</p><p id="ca2b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，这是我在macOS上运行的真实应用，Midinote，一个笔记应用:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/b8bf4d43e290fbf80a6f88de82386bcc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6SYy-G3lEZ8IYw7pT-c1AA.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">运行在macOS上的Midinote</figcaption></figure><p id="17e1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">而且为了简单起见，我还创建了一个示例repo进行演示，代码在这里:<a class="ae jd" href="https://github.com/dadiorchen/sandbox/tree/master/electron-react-app" rel="noopener ugc nofollow" target="_blank">https://github . com/dadiorchen/sandbox/tree/master/electronic-react-app</a></p><h1 id="82a8" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">向现有项目添加电子</h1><p id="5767" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">在这个真实的案例中，我首先创建了一个React应用程序，现在我考虑用电子包装它，并将其发布到自己的网站或应用程序商店。因此，我们需要将电子和包工具Forge导入到现有的React应用程序中。</p><p id="41a1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，让我们假设已经创建了React应用程序，(查看React <a class="ae jd" href="https://reactjs.org/docs/create-a-new-react-app.html#create-react-app" rel="noopener ugc nofollow" target="_blank">网站</a>了解如何操作)，现在安装电子锻造:</p><pre class="jf jg jh ji fd kx ky kz la aw lb bi"><span id="71e1" class="lc jv hi ky b fi ld le l lf lg">npm install --save-dev <a class="ae jd" href="http://twitter.com/electron" rel="noopener ugc nofollow" target="_blank">@electron</a>-forge/cli</span></pre><p id="a175" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">和</p><pre class="jf jg jh ji fd kx ky kz la aw lb bi"><span id="27cd" class="lc jv hi ky b fi ld le l lf lg">npx electron-forge import</span></pre><p id="319e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">关于<code class="du lh li lj ky b">npx</code>检查一下<a class="ae jd" href="https://github.com/npm/npx" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><p id="6ba2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个命令将添加电子核心，电子锻造到项目中。</p><p id="1a8a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上面的命令会自动修改你的<code class="du lh li lj ky b">package.json</code>，有些不是你想要的，它会覆盖命令<code class="du lh li lj ky b">npm start</code>来执行forge instant of React，把它改回来，<code class="du lh li lj ky b">package.json</code>中的<code class="du lh li lj ky b">script</code>部分的最终形式会是这样的:</p><pre class="jf jg jh ji fd kx ky kz la aw lb bi"><span id="da88" class="lc jv hi ky b fi ld le l lf lg">"scripts": {<br/>    "start": "react-scripts start",<br/>    "build": "react-scripts build",<br/>    "test": "react-scripts test",<br/>    "eject": "react-scripts eject",</span><span id="12bb" class="lc jv hi ky b fi lk le l lf lg">    "start-forge": "electron-forge start",<br/>    "package": "electron-forge package",<br/>    "make": "electron-forge make"<br/>  },</span></pre><p id="d156" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这一点上，仍然缺少一些东西，我们需要设置电子应用程序的入口点。</p><p id="e62a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">添加一行到<code class="du lh li lj ky b">package.json</code>，在根对象下:</p><pre class="jf jg jh ji fd kx ky kz la aw lb bi"><span id="834d" class="lc jv hi ky b fi ld le l lf lg">"main": "./main.js",</span></pre><p id="f850" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后在项目的根目录下添加文件<code class="du lh li lj ky b">main.js</code>:</p><pre class="jf jg jh ji fd kx ky kz la aw lb bi"><span id="2cf1" class="lc jv hi ky b fi ld le l lf lg">// main.js</span><span id="ccb8" class="lc jv hi ky b fi lk le l lf lg">// Modules to control application life and create native browser window<br/>const { app, BrowserWindow } = require('electron')<br/>const path = require('path')</span><span id="3bcb" class="lc jv hi ky b fi lk le l lf lg">function createWindow () {<br/>  // Create the browser window.<br/>  const mainWindow = new BrowserWindow({<br/>    width: 800,<br/>    height: 600,<br/>  })</span><span id="c269" class="lc jv hi ky b fi lk le l lf lg">// and load the index.html of the app.<br/>  if(ENV === "dev"){<br/>    //for dev<br/>    mainWindow.loadURL('<a class="ae jd" href="http://localhost:3000/'" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/'</a>);<br/>  }else if(ENV === "prod" || ENV === "production"){<br/>    //for prod<br/>    //win.loadFile('build/index.html')</span><span id="e03f" class="lc jv hi ky b fi lk le l lf lg">const url = require('url').format({<br/>      protocol: 'file',<br/>      slashes: true,<br/>      pathname: require('path').join(__dirname, 'build/index.html')<br/>    })<br/>    mainWindow.loadURL(url)<br/>  }else{<br/>    throw new Error("wrong env");<br/>  }</span><span id="fe50" class="lc jv hi ky b fi lk le l lf lg">// Open the DevTools.<br/>  // mainWindow.webContents.openDevTools()<br/>}</span><span id="0769" class="lc jv hi ky b fi lk le l lf lg">// This method will be called when Electron has finished<br/>// initialization and is ready to create browser windows.<br/>// Some APIs can only be used after this event occurs.<br/>app.whenReady().then(() =&gt; {<br/>  createWindow()</span><span id="75ae" class="lc jv hi ky b fi lk le l lf lg">app.on('activate', function () {<br/>    // On macOS it's common to re-create a window in the app when the<br/>    // dock icon is clicked and there are no other windows open.<br/>    if (BrowserWindow.getAllWindows().length === 0) createWindow()<br/>  })<br/>})</span><span id="5a80" class="lc jv hi ky b fi lk le l lf lg">// Quit when all windows are closed, except on macOS. There, it's common<br/>// for applications and their menu bar to stay active until the user quits<br/>// explicitly with Cmd + Q.<br/>app.on('window-all-closed', function () {<br/>  if (process.platform !== 'darwin') app.quit()<br/>})</span><span id="0971" class="lc jv hi ky b fi lk le l lf lg">// In this file you can include the rest of your app's specific main process<br/>// code. You can also put them in separate files and require them here.</span></pre><p id="1ead" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于上面的文件，我从Electron的<a class="ae jd" href="https://www.electronjs.org/docs/tutorial/quick-start" rel="noopener ugc nofollow" target="_blank">教程</a>中复制了代码，但做了一些调整以适应我们的情况。</p><p id="a449" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，您可以运行这些命令来运行电子版应用程序:</p><pre class="jf jg jh ji fd kx ky kz la aw lb bi"><span id="c0ca" class="lc jv hi ky b fi ld le l lf lg">npm start<br/>npm run start-forge</span></pre><p id="689b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您将看到类似这样的内容:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es ll"><img src="../Images/bbfafb828b99835e74aa2a047c51056e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9sb9dp7bokkIeheCEh5nvQ.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">电子包裹的反应应用程序</figcaption></figure><p id="2673" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对此有一些解释:</p><ul class=""><li id="6964" class="lm ln hi ih b ii ij im in iq lo iu lp iy lq jc lr ls lt lu bi translated">电子核心是包装web应用程序并在桌面应用程序中运行的真正材料。</li><li id="6709" class="lm ln hi ih b ii lv im lw iq lx iu ly iy lz jc lr ls lt lu bi translated">电子锻造是自由包装，发布应用程序。</li></ul><p id="85b1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">电子锻造公司将在引擎盖下使用/安装这些库:</p><ul class=""><li id="a90c" class="lm ln hi ih b ii ij im in iq lo iu lp iy lq jc lr ls lt lu bi translated">对lib进行电子公证，以处理苹果公证流程，这是你想创建一个app时苹果需要的。</li><li id="629b" class="lm ln hi ih b ii lv im lw iq lx iu ly iy lz jc lr ls lt lu bi translated">电子打包库将应用程序打包成操作系统要求的格式。</li><li id="bc9d" class="lm ln hi ih b ii lv im lw iq lx iu ly iy lz jc lr ls lt lu bi translated">电子-OS x-sign lib处理代码签名过程，如果你要发布app，这是苹果需要的。</li></ul><h1 id="3e56" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">构建应用程序</h1><p id="6040" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">现在，我们可以将该项目构建成一个可以在macOS上运行的应用程序。</p><p id="81b2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，构建React:</p><pre class="jf jg jh ji fd kx ky kz la aw lb bi"><span id="17d1" class="lc jv hi ky b fi ld le l lf lg">npm run build</span></pre><p id="a6d3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">制造电子:</p><pre class="jf jg jh ji fd kx ky kz la aw lb bi"><span id="ed72" class="lc jv hi ky b fi ld le l lf lg">npm run make</span></pre><p id="c9c6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在你会发现一个名为<code class="du lh li lj ky b">out</code>的新文件夹出现了。找到构建的应用程序，在我的例子中，它被命名为:<code class="du lh li lj ky b">electron-react-app</code>，双击运行它。</p><h1 id="0fb5" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">打包并签名应用程序</h1><p id="1c09" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">以上步骤只是让你尝试构建应用程序的一种方式，实际上，用这种方式构建的应用程序是不完整的，你不能用它在OSs上分发/发布你的软件。完整的步骤如下:</p><p id="937c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在macOS平台上发布app有两种方式:</p><ol class=""><li id="7ef1" class="lm ln hi ih b ii ij im in iq lo iu lp iy lq jc ma ls lt lu bi translated">应用商店</li><li id="95ca" class="lm ln hi ih b ii lv im lw iq lx iu ly iy lz jc ma ls lt lu bi translated">你自己的网站。</li></ol><p id="9d91" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">App Store是发布你的应用程序的地方，人们可以在macOS上的App Store应用程序中找到它，并下载它。从我的理解来说，App Store更严格。还有，如果你对你的应用程序收费，你需要按照一定的比例向苹果付费。</p><p id="5c32" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">发布到自己的网站更自由，你自己做支付方式，所以苹果对你的app不收钱。</p><p id="a84a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因为我的应用程序将做一些相当繁重的本地操作，如安装本地数据库，我担心如果我将它发布到应用程序商店，我会因违反苹果的一些规则而被卡住，所以我选择了后者，所以我将在本文中只涵盖这一部分，我可能会写另一个博客来涵盖当我体验它时发布到应用程序商店的工作流程。</p><p id="1072" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">而要发布app，你需要两步或者说3步，首先你需要打包app，这样做的一个前提是你的app必须通过苹果要求的所谓公证步骤。然后，你需要签署你的代码。这两者(公证和签名)都需要连接到Apple的云服务，并需要使用您的Apple开发者帐户进行设置，这意味着您需要注册Apple开发者会员并为设置创建一些东西，我将在以下步骤中介绍这一点:</p><p id="d780" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，将下面的设置放在<code class="du lh li lj ky b">package.json</code>的根对象下:</p><pre class="jf jg jh ji fd kx ky kz la aw lb bi"><span id="4220" class="lc jv hi ky b fi ld le l lf lg">"config": {<br/>    "forge": {<br/>      "packagerConfig": {<br/>        "osxSign": {<br/>          "identity": "[your apple identity]",<br/>          "hardened-runtime": true,<br/>          "entitlements": "entitlements.plist",<br/>          "entitlements-inherit": "entitlements.plist",<br/>          "signature-flags": "library"<br/>        },<br/>        "osxNotarize": {<br/>          "appleId": "<a class="ae jd" href="mailto:237769247@qq.com" rel="noopener ugc nofollow" target="_blank">[</a>your app ID]",<br/>          "appleIdPassword": "[your apple ID password"<br/>        }<br/>      },<br/>      "makers": [<br/>        {<br/>          "name": "<a class="ae jd" href="http://twitter.com/electron" rel="noopener ugc nofollow" target="_blank">@electron</a>-forge/maker-squirrel",<br/>          "config": {<br/>            "name": "electron_react_app"<br/>          }<br/>        },<br/>        {<br/>          "name": "<a class="ae jd" href="http://twitter.com/electron" rel="noopener ugc nofollow" target="_blank">@electron</a>-forge/maker-zip",<br/>          "platforms": [<br/>            "darwin"<br/>          ]<br/>        },<br/>        {<br/>          "name": "<a class="ae jd" href="http://twitter.com/electron" rel="noopener ugc nofollow" target="_blank">@electron</a>-forge/maker-dmg",<br/>          "config": {<br/>            "background": "./assets/b1-right.png",<br/>            "format": "ULFO"<br/>          }<br/>        }</span><span id="9cd9" class="lc jv hi ky b fi lk le l lf lg">      ]<br/>    }</span></pre><p id="596d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在项目根文件夹下添加一个名为<code class="du lh li lj ky b">entitlements.plist</code>的文件，内容如下:</p><pre class="jf jg jh ji fd kx ky kz la aw lb bi"><span id="313a" class="lc jv hi ky b fi ld le l lf lg">&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br/>&lt;!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "<a class="ae jd" href="http://www.apple.com/DTDs/PropertyList-1.0.dtd" rel="noopener ugc nofollow" target="_blank">http://www.apple.com/DTDs/PropertyList-1.0.dtd</a>"&gt;<br/>&lt;plist version="1.0"&gt;<br/>  &lt;dict&gt;<br/>    &lt;key&gt;com.apple.security.cs.allow-jit&lt;/key&gt;<br/>    &lt;true/&gt;<br/>    &lt;key&gt;com.apple.security.cs.allow-unsigned-executable-memory&lt;/key&gt;<br/>    &lt;true/&gt;<br/>    &lt;key&gt;com.apple.security.cs.debugger&lt;/key&gt;<br/>    &lt;true/&gt;<br/>  &lt;/dict&gt;<br/>&lt;/plist&gt;</span></pre><p id="580b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我解释一下:</p><ul class=""><li id="f950" class="lm ln hi ih b ii ij im in iq lo iu lp iy lq jc lr ls lt lu bi translated">关于Forge的<code class="du lh li lj ky b">make </code>是如何工作的</li></ul><p id="5f08" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当您运行命令<code class="du lh li lj ky b">npm run make</code>时，forge会从<code class="du lh li lj ky b">package.json</code>的config → forge → packageConfig中读取config，<code class="du lh li lj ky b">osxNotarize</code>用于Apple公证，<code class="du lh li lj ky b">oxsSign</code>用于Apple代码签名，还有其他可用的设置项，实际上Forge会使用这些设置来调用底层库，如<code class="du lh li lj ky b">electron-notarize</code> <code class="du lh li lj ky b">electron-osx-sign</code> <code class="du lh li lj ky b">electron-packager</code>，这样您就可以分别从它们的存储库中找到所有可用的设置。规则是，Forge会将所有直接在<code class="du lh li lj ky b">packageConfig</code>下的设置项发送给<code class="du lh li lj ky b">electron-packager</code>命令(Forge通过直接调用它们的命令来使用，将设置作为选项传递给命令)，Forge会将<code class="du lh li lj ky b">oxsSign</code>下的设置发送给<code class="du lh li lj ky b">electron-osx-sign</code>的命令，将<code class="du lh li lj ky b">oxsNotarize</code>下的设置发送给<code class="du lh li lj ky b">electron-notarize</code>。</p><ul class=""><li id="2cc7" class="lm ln hi ih b ii ij im in iq lo iu lp iy lq jc lr ls lt lu bi translated">关于如何设置oxsNotarize部分:</li></ul><p id="77f1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请检查苹果公司的这份<a class="ae jd" href="https://support.apple.com/en-us/HT204397" rel="noopener ugc nofollow" target="_blank">文件</a>。</p><ul class=""><li id="86ed" class="lm ln hi ih b ii ij im in iq lo iu lp iy lq jc lr ls lt lu bi translated">关于如何设置oxsSign</li></ul><p id="45e3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请检查电子版的<a class="ae jd" href="https://www.electronjs.org/docs/tutorial/mac-app-store-submission-guide" rel="noopener ugc nofollow" target="_blank">文件</a>。</p><p id="01b0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当你试图签署代码时，苹果要求你自己在苹果开发者控制台申请证书，根据你要分发的方式，主要有两种不同类型的证书，正如我所说的，应用商店和你自己的网站。选择证书的页面如下所示:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mb"><img src="../Images/929eecd50ca08637569c9fe82fb78613.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XcaAErbtCQD2l64YizclQw.png"/></div></div></figure><p id="1d86" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">生成证书后，你需要下载并安装到你的Mac上，另一种方法是使用苹果的Xcode。</p><p id="d33b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请查看上面的文档，了解更多细节，你会明白你应该选择哪个选项。</p><ul class=""><li id="2d2f" class="lm ln hi ih b ii ij im in iq lo iu lp iy lq jc lr ls lt lu bi translated">关于<code class="du lh li lj ky b">entitlement.plist</code>文件</li></ul><p id="e816" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个文件是苹果需要的，苹果用它来定义这个应用程序的一些方面，比如这个应用程序将使用什么样的OS资源。</p><ul class=""><li id="adad" class="lm ln hi ih b ii ij im in iq lo iu lp iy lq jc lr ls lt lu bi translated">关于设备寄存器</li></ul><p id="0c25" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要完成整个过程，您还需要在Apple开发者控制台上注册您的设备:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mc"><img src="../Images/d6d845e02bc652a9201b0552146fcd8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dBnphV8FJn7u_yXEU0LZtw.png"/></div></div></figure><ul class=""><li id="38b3" class="lm ln hi ih b ii ij im in iq lo iu lp iy lq jc lr ls lt lu bi translated">关于<code class="du lh li lj ky b">makers</code></li></ul><p id="3e6e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上面配置中的最后一部分是<code class="du lh li lj ky b">makers</code>，这是一个特性，或者说，一些Forge支持的流程步骤。将会发生的是，在打包应用程序后，Forge将对打包的应用程序做一些额外的工作。</p><ol class=""><li id="8bc8" class="lm ln hi ih b ii ij im in iq lo iu lp iy lq jc ma ls lt lu bi translated">压缩包，在上面的例子中，<code class="du lh li lj ky b">@electron-forge/maker-zip</code>会将app压缩到<code class="du lh li lj ky b">.zip</code>文件。</li><li id="bc19" class="lm ln hi ih b ii lv im lw iq lx iu ly iy lz jc ma ls lt lu bi translated">为macOS建立一个可安装文件，主要是我们用一个扩展名为<code class="du lh li lj ky b">.dmg</code>的安装文件来安装一个软件，<code class="du lh li lj ky b"><a class="ae jd" href="http://twitter.com/electron" rel="noopener ugc nofollow" target="_blank">@electron</a>-forge/maker-dmg</code>的设置使得这种情况发生。您还可以通过设置<code class="du lh li lj ky b">config--&gt;background</code>在安装程序UI上设置背景图像</li></ol><p id="9686" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">也可以只给你的用户app文件夹(<code class="du lh li lj ky b">.app</code>文件夹)而不是<code class="du lh li lj ky b">.dmg</code>文件来直接使用app，但是在某些场景下不好，有一些限制。例如，我的应用程序无法通过这样做得到更新，因为macOS禁止你写/替换你的原始应用程序文件以让它得到更新，除非它在应用程序文件夹中，<code class="du lh li lj ky b">.dmg</code>将为你解决这个问题。</p><p id="f266" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意，您需要手动安装<code class="du lh li lj ky b">.dmg</code> maker的库:</p><pre class="jf jg jh ji fd kx ky kz la aw lb bi"><span id="0a32" class="lc jv hi ky b fi ld le l lf lg">npm install --save <a class="ae jd" href="http://twitter.com/electron" rel="noopener ugc nofollow" target="_blank">@electron</a>-forge/maker-dmg</span></pre><ul class=""><li id="858a" class="lm ln hi ih b ii ij im in iq lo iu lp iy lq jc lr ls lt lu bi translated">结束</li></ul><p id="1b35" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通常，当您运行<code class="du lh li lj ky b">npm run make</code>时:</p><ol class=""><li id="ce17" class="lm ln hi ih b ii ij im in iq lo iu lp iy lq jc ma ls lt lu bi translated"><code class="du lh li lj ky b">npm run make</code></li><li id="d81c" class="lm ln hi ih b ii lv im lw iq lx iu ly iy lz jc ma ls lt lu bi translated">Forge将使用适当的工具来做事:</li><li id="5a19" class="lm ln hi ih b ii lv im lw iq lx iu ly iy lz jc ma ls lt lu bi translated">使用appleId凭据将您的应用程序上传到Apple的服务进行公证。</li><li id="eea9" class="lm ln hi ih b ii lv im lw iq lx iu ly iy lz jc ma ls lt lu bi translated">尝试使用在苹果开发者控制台中创建的<code class="du lh li lj ky b">identity</code>来签署代码。</li><li id="b450" class="lm ln hi ih b ii lv im lw iq lx iu ly iy lz jc ma ls lt lu bi translated">为应用程序创建包后，将其压缩到<code class="du lh li lj ky b">.zip</code>并构建一个<code class="du lh li lj ky b">.dmg</code>作为应用程序安装程序。</li><li id="9bc9" class="lm ln hi ih b ii lv im lw iq lx iu ly iy lz jc ma ls lt lu bi translated">完成后，在您的<code class="du lh li lj ky b">out</code>文件夹中查看结果。</li></ol><p id="01bb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在你的应用已经可以发布了。</p><h1 id="b328" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">发布应用程序</h1><p id="ce5e" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">要使用自维护网站发布应用程序，很简单，你只需要将<code class="du lh li lj ky b">.dmg</code>或<code class="du lh li lj ky b">.zip</code>文件放到你网站的下载文件夹或类似<code class="du lh li lj ky b">s3</code>的文件服务中，让人们下载。</p><p id="34d6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我的例子中，我使用Github的发布功能来发布新版本，因为我需要自动更新功能来升级应用程序。我使用的库:<a class="ae jd" href="https://github.com/electron/update.electronjs.org" rel="noopener ugc nofollow" target="_blank">https://github.com/electron/update.electronjs.org</a></p><h1 id="d9b5" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">一些陷阱和提示</h1><p id="122e" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">列举一些我遇到的问题，希望有帮助。</p><ul class=""><li id="5fb1" class="lm ln hi ih b ii ij im in iq lo iu lp iy lq jc lr ls lt lu bi translated">当你遇到问题时，日志总是帮助你解决问题的最好方法。</li></ul><p id="885c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于一个电子app，以及打包、发布的过程，有一些不同种类的日志:</p><ol class=""><li id="5060" class="lm ln hi ih b ii ij im in iq lo iu lp iy lq jc ma ls lt lu bi translated">安慰</li></ol><p id="6f0c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">传统的<code class="du lh li lj ky b">console.log()</code>在你运行app的时候是看不见的。所以你需要这个:<a class="ae jd" href="https://github.com/megahertz/electron-log" rel="noopener ugc nofollow" target="_blank">电子日志</a>输出日志，默认情况下，它的日志会输出到<code class="du lh li lj ky b">~/Library/Logs/{app name}/{process type}.log</code></p><p id="1b47" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.<code class="du lh li lj ky b">squirrel</code>的日志</p><p id="90bb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" href="https://github.com/Squirrel/Squirrel.Mac" rel="noopener ugc nofollow" target="_blank"> Squirrel </a>是Electron用来更新app的一个lib。日志将输出到<code class="du lh li lj ky b">~/Library/Caches/{app name}.ShipIt</code></p><p id="5a55" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3.浏览器</p><p id="06e6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用Chrome的devtool检查浏览器中运行的代码的日志输出。</p><ul class=""><li id="2459" class="lm ln hi ih b ii ij im in iq lo iu lp iy lq jc lr ls lt lu bi translated">只读缓存文件问题</li></ul><p id="54b8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我在打包app的时候遇到了一个问题，在打包的app中，React build文件夹下，也就是React build命令输出的文件夹下，在<code class="du lh li lj ky b">node-module/.cache</code>文件夹下(默认情况下电子会打包整个app文件夹)，有一个只读文件生成，会导致一个app的更新失败。最后我找到的是这个模块:terser-webpack-plugin生成的只读文件，我对此的解决方案是在打包app之前，在React building之后，插入一个命令(<code class="du lh li lj ky b">rm</code>)来清理<code class="du lh li lj ky b">.cache</code>文件夹。</p><ul class=""><li id="b76c" class="lm ln hi ih b ii ij im in iq lo iu lp iy lq jc lr ls lt lu bi translated">虚拟机有所帮助</li></ul><p id="db2d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你在自己的Mac上做所有这些事情，安装一个虚拟机并尝试在虚拟机上安装和运行你的应用程序是一个好主意，它隔离环境，避免意外结果并保持你的主机操作系统干净，应用程序将安装在你的<code class="du lh li lj ky b">applications</code>文件夹中，并将各种文件，如缓存，本地数据库文件存储到你的macOS的系统文件夹中。我使用了<code class="du lh li lj ky b">VirtualBox</code>来完成这项工作，它非常简洁。</p><ul class=""><li id="9bdc" class="lm ln hi ih b ii ij im in iq lo iu lp iy lq jc lr ls lt lu bi translated">避免我正在做的方式</li></ul><p id="4161" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">实际上，就导入forge的方式而言，我所做的不是一个好的实践，事情是，我使用React，并且我将Forge导入到React所在的同一个文件夹中，这是有问题的:</p><ol class=""><li id="e9f6" class="lm ln hi ih b ii ij im in iq lo iu lp iy lq jc ma ls lt lu bi translated">默认情况下，锻造厂会打包整个项目，这在某种程度上是不必要的，也是有风险的。像我上面提到的案例，缓存文件问题。</li><li id="ab96" class="lm ln hi ih b ii lv im lw iq lx iu ly iy lz jc ma ls lt lu bi translated">这样，电子应用程序(main.js和其他非浏览器部分)和反应应用程序(浏览器部分)使用相同的<code class="du lh li lj ky b">package.json</code>和相同的依赖定义。这是有问题的，可能会导致库冲突。</li></ol><p id="0557" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，我将重新组织这个项目，以隔离应用程序源和包工具源，也许可以在未来与您分享新的知识。</p><h1 id="5729" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">结论</h1><p id="746e" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">与使用Xcode这样的原始工具相比，使用Electron构建应用程序有一些障碍，我所做的远非完美，我所写的并没有涵盖所有这些细节，但我希望这篇文章可以为您提供整个任务的清晰路径，以避免在配置的丛林中迷失方向。</p><p id="a4b7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如有建议，请在下方评论。</p></div></div>    
</body>
</html>