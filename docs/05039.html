<html>
<head>
<title>Simple Guide to Building a PHP Web Scraper Using Goutte for Beginners</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">初学者使用Goutte构建PHP Web Scraper的简单指南</h1>
<blockquote>原文：<a href="https://medium.com/codex/simple-guide-to-building-a-php-web-scraper-using-goutte-for-beginners-70f9c908a84f?source=collection_archive---------8-----------------------#2022-01-26">https://medium.com/codex/simple-guide-to-building-a-php-web-scraper-using-goutte-for-beginners-70f9c908a84f?source=collection_archive---------8-----------------------#2022-01-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="2332" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最初发表于<a class="ae jd" href="https://www.scraperapi.com/blog/simple-guide-to-building-a-php-web-scraper-using-goutte-for-beginners/" rel="noopener ugc nofollow" target="_blank"> ScraperAPI </a>。</p><p id="43dd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">PHP是一种广泛使用的后端语言。被很多人讨厌，被很多应用程序使用，比如WordPress。然而，当考虑网络抓取时，PHP并不是第一个想到的选项。</p><p id="f127" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有了像Python的<a class="ae jd" href="https://www.scraperapi.com/blog/how-to-scrape-amazon-product-data/" rel="noopener ugc nofollow" target="_blank">Scrapy</a>或Node.js的<a class="ae jd" href="https://www.scraperapi.com/blog/web-scraper-with-javascript/" rel="noopener ugc nofollow" target="_blank">Cheerio</a>这样的工具，网页抓取变得简单，很难想象为什么要用PHP来抓取数据。直到你学会所有不同的选择。</p><p id="0818" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因为它有一个活跃的社区，而且已经存在了很长时间，PHP有很多工具可以使web抓取不仅更简单，而且更强大。</p><p id="705c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你已经知道PHP或者你有兴趣学习一门能够快速有效地提取web数据的后端语言，那么本教程就是为你准备的。</p><p id="4126" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">今天，我们将探索一些您可以随意使用的工具，并做一个真实的代码示例，用PHP构建您的第一个web scraper。</p><h1 id="6d0b" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">选择PHP网页抓取库</h1><p id="4a17" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">在PHP中有很多方法可以进行网页抓取。但是最有效的方法是使用一个内置了下载和解析URL所需的所有工具的库。</p><p id="65a2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">否则，我们将不得不花费更多的时间和编写更复杂的代码来完成像发送HTTP请求这样的简单任务。</p><p id="0883" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果我们将网络抓取划分为核心任务，它看起来会是这样的:</p><ul class=""><li id="a01f" class="kh ki hi ih b ii ij im in iq kj iu kk iy kl jc km kn ko kp bi translated">首先，我们将向服务器发送一个HTTP请求来获取页面的源代码。</li><li id="0c87" class="kh ki hi ih b ii kq im kr iq ks iu kt iy ku jc km kn ko kp bi translated">然后，我们必须解析<a class="ae jd" href="https://www.w3schools.com/whatis/whatis_htmldom.asp" rel="noopener ugc nofollow" target="_blank"> DOM </a>来识别和过滤信息，以提取我们需要的数据。</li><li id="873f" class="kh ki hi ih b ii kq im kr iq ks iu kt iy ku jc km kn ko kp bi translated">最后，我们希望对数据进行格式化，使其更容易理解——比如转换成CSV或JSON文件。</li></ul><p id="5997" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">仅仅对于HTTP请求，我们可以使用几种不同的方法，比如:</p><ul class=""><li id="3cdb" class="kh ki hi ih b ii ij im in iq kj iu kk iy kl jc km kn ko kp bi translated">fsockopen()  —虽然不用于处理HTTP请求，但完全可以这样做。当然，这将需要大量我们并不想写的不必要的代码。</li><li id="51a1" class="kh ki hi ih b ii kq im kr iq ks iu kt iy ku jc km kn ko kp bi translated"><a class="ae jd" href="https://curl.se/docs/faq.html#What_is_cURL" rel="noopener ugc nofollow" target="_blank"> cURL </a> —这是一个URL客户端，允许您轻松执行HTTP请求，但对于导航HTML文件和提取我们正在寻找的数据没有太大帮助。</li><li id="625e" class="kh ki hi ih b ii kq im kr iq ks iu kt iy ku jc km kn ko kp bi translated">使用HTTP客户端，如<a class="ae jd" href="https://docs.guzzlephp.org/en/stable/" rel="noopener ugc nofollow" target="_blank"> Guzzle </a>或<a class="ae jd" href="https://github.com/FriendsOfPHP/Goutte" rel="noopener ugc nofollow" target="_blank">Goutte</a>——这也使得解析HTML DOM树比以前的选项更容易。</li></ul><p id="5cd2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如你所见，最后两个是我们称之为用PHP抓取网页的现成工具。</p><h1 id="d8f2" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">为什么使用Goutte进行PHP网页抓取？</h1><p id="c2bb" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">你已经知道我们在这个例子中要用Goutte剧透自标题——但是你知道为什么吗？</p><p id="6cc9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于网络抓取来说，Guzzle绝对是一个很好的选择。它简化了HTTP请求，并且能够解析下载的文件以提取数据。</p><p id="210a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">问题是，要实现这一点，我们必须将下载的HTML文件转换成DOMDocument，然后使用XPath表达式导航文档以选择我们想要获得的节点。</p><p id="edf6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这些增加了额外的步骤，我们可以使用Goutte轻松克服。</p><p id="c3b2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Goutte是一个HTTP客户端，由Symfony框架的创建者Fabian Potencier创建。</p><p id="a366" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个库结合了四个Symfony组件，使得网页抓取非常简单和优雅:</p><ol class=""><li id="9fed" class="kh ki hi ih b ii ij im in iq kj iu kk iy kl jc kv kn ko kp bi translated"><a class="ae jd" href="https://symfony.com/doc/current/components/browser_kit.html" rel="noopener ugc nofollow" target="_blank">browser kit</a>——模拟浏览器的行为。</li><li id="6720" class="kh ki hi ih b ii kq im kr iq ks iu kt iy ku jc kv kn ko kp bi translated"><a class="ae jd" href="https://symfony.com/doc/current/components/dom_crawler.html" rel="noopener ugc nofollow" target="_blank">DOM crawler</a>—这个组件允许我们使用类似<code class="du kw kx ky kz b">$crawler = $crawler-&gt;filter('body &gt; h2');</code>的表达式和许多其他方法来导航DOM文档。</li><li id="1fb2" class="kh ki hi ih b ii kq im kr iq ks iu kt iy ku jc kv kn ko kp bi translated"><a class="ae jd" href="https://symfony.com/doc/current/components/css_selector.html" rel="noopener ugc nofollow" target="_blank">CSS selector</a>—这个组件允许我们使用CSS选择器挑选元素，然后将其转换为相应的XPath表达式，从而使选择元素变得非常简单。例如，这个代码片段<code class="du kw kx ky kz b">$crawler-&gt;filter('.fire');</code>将查找所有带有<code class="du kw kx ky kz b">class=”fire”</code>的元素。</li><li id="be57" class="kh ki hi ih b ii kq im kr iq ks iu kt iy ku jc kv kn ko kp bi translated"><a class="ae jd" href="https://symfony.com/doc/current/http_client.html" rel="noopener ugc nofollow" target="_blank">Symfony HTTP客户端</a> —这是最新的组件，自2019年实现以来获得了很大的人气。</li></ol><p id="31e3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">由于这些原因，我们将在本教程的剩余部分使用Goutte。</p><p id="6a2b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">注意:</strong>我们将在未来发布一个暴饮暴食教程，所以请继续关注<a class="ae jd" href="https://www.scraperapi.com/blog/" rel="noopener ugc nofollow" target="_blank">我们的博客</a>和<a class="ae jd" href="https://twitter.com/scraperapi" rel="noopener ugc nofollow" target="_blank">社交媒体</a>。</p><h1 id="2f55" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">用PHP和Goutte构建Web刮刀</h1><p id="119f" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">在我们真正开始写代码之前，理解我们想要抓取的站点的结构是很重要的。</p><p id="4c13" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于本教程，我们将抓取<a class="ae jd" href="https://www.newchic.com/women-t-shirts-c-3666/?mg_id=1&amp;from=nav&amp;country=223&amp;NA=1" rel="noopener ugc nofollow" target="_blank"> NewChic的女装t恤页面</a>以提取:</p><ul class=""><li id="6e07" class="kh ki hi ih b ii ij im in iq kj iu kk iy kl jc km kn ko kp bi translated">t恤的名称</li><li id="cc96" class="kh ki hi ih b ii kq im kr iq ks iu kt iy ku jc km kn ko kp bi translated">链接到作品</li><li id="fbd5" class="kh ki hi ih b ii kq im kr iq ks iu kt iy ku jc km kn ko kp bi translated">价格</li></ul><p id="dce3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">像这样的刮刀可以用于希望进行竞争分析的电子商务企业。</p><p id="d64f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们从检查页面开始。</p><h1 id="37c4" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">1.使用浏览器开发工具检查页面</h1><p id="18c8" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">在我们的目标网站上，右击页面并点击“inspect”——或者，你也可以按ctrl + shift + c。</p><figure class="lb lc ld le fd lf er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es la"><img src="../Images/0d12a7aceb92fa874bbc63d8d8fbc110.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*85BQA8C5ZOYyvMKP.jpg"/></div></div></figure><p id="2513" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它将在您的浏览器上打开检查工具。</p><p id="bc6f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们在浏览器用来显示页面的HTML代码中看到的。每一行都有关于页面上一个元素的信息。</p><p id="0e41" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们真正关心的是每个元素的标签、类和id，因为这些是我们将用来让我们的scraper找到我们需要的信息的细节。</p><p id="937f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">那么，就从布的标题说起吧。为此，右键单击元素并检查它。</p><figure class="lb lc ld le fd lf er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es la"><img src="../Images/3bd37a7069737442ea30155263354761.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*77-p5RK2kBwBLFu_.jpg"/></div></div></figure><p id="24d3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以看到t恤的名字被包裹在<code class="du kw kx ky kz b">&lt;p&gt;</code>标签里面的<code class="du kw kx ky kz b">&lt;a&gt;</code>标签之间。</p><p id="4e49" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">也就是说，它肯定不是页面上唯一的链接。如果我们只使用元素的标签，我们将从页面中提取所有链接，包括导航链接、页脚链接和其他所有内容。</p><p id="51a0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这就是职业进入游戏的地方。</p><p id="6d20" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于t恤的名字来说，<code class="du kw kx ky kz b">&lt;a&gt;</code>标签有一个类“<code class="du kw kx ky kz b">lg text-ellipsis d-block text-hover-underline text-secondary-hover font-small-12 text-grey product-item-name-js</code>”。所以我们希望确保所有其他元素都使用同一个类。</p><figure class="lb lc ld le fd lf er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es la"><img src="../Images/f592a4d004b8e7ad8e08259a002f44ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Uli-fObiJai3SLoj.jpg"/></div></div></figure><p id="c041" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在检查了几个之后，它们都使用了同一个类，这对我们来说是完美的，因为我们可以用它来选择我们的标题和链接。</p><p id="ae3e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">注意:</strong>我们稍后将探索如何提取一个&lt; a &gt;标签的href属性。</p><p id="f0b9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，我们将对每个元素做同样的事情:</p><ul class=""><li id="a233" class="kh ki hi ih b ii ij im in iq kj iu kk iy kl jc km kn ko kp bi translated">对于价格:<code class="du kw kx ky kz b">span class="product-item-final-price-js price product-price-js font-middle font-bold text-black-light-1</code></li></ul><figure class="lb lc ld le fd lf er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es la"><img src="../Images/2fbdb3fe461dd61a979fa1f5d7c77395.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*oF-411B2e2PKMEqh.jpg"/></div></div></figure><ul class=""><li id="8da8" class="kh ki hi ih b ii ij im in iq kj iu kk iy kl jc km kn ko kp bi translated">对于链接:我们将使用与标题相同的方法，但不是获取文本，而是获取href值。</li></ul><h1 id="9d66" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">2.安装PHP和所有必要的依赖项</h1><p id="68a9" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">在我们下载任何文件之前，让我们先检查一下我们是否已经安装了PHP的任何版本。在你的终端输入<code class="du kw kx ky kz b">php -v</code>。</p><figure class="lb lc ld le fd lf er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es la"><img src="../Images/0a46591f7f599b12f85eb85494d0485d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*3Q8906H-jR68JRbT.jpg"/></div></div></figure><p id="0913" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是我们收到的通知，因为我们用的是M1的Macbook。重要的是我们有PHP的7.3.24版本。</p><p id="b647" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你还没有安装，那么按照下面的步骤<a class="ae jd" href="https://www.php.net/manual/en/install.macosx.packages.php" rel="noopener ugc nofollow" target="_blank">在你的Mac上安装PHP</a>:</p><ul class=""><li id="e477" class="kh ki hi ih b ii ij im in iq kj iu kk iy kl jc km kn ko kp bi translated">去https://brew.sh/<a class="ae jd" href="https://brew.sh/" rel="noopener ugc nofollow" target="_blank">安装自制软件。这是一个缺失的macOS软件包管理器</a></li><li id="9ffd" class="kh ki hi ih b ii kq im kr iq ks iu kt iy ku jc km kn ko kp bi translated">家酿安装后，您可以使用以下命令安装PHP:brew install PHP—在开始下载之前，它会要求您的机器的密码。</li></ul><p id="6d8e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你也可以跟着这个简单的<a class="ae jd" href="https://www.youtube.com/watch?v=Ry9tYKuXlW0" rel="noopener ugc nofollow" target="_blank">视频在macOS Big Sur中安装PHP 8 </a>。</p><p id="c078" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">注意:</strong>这里有一个资源解释了<a class="ae jd" href="https://www.sitepoint.com/how-to-install-php-on-windows/" rel="noopener ugc nofollow" target="_blank">如何在Windows上安装PHP</a>。</p><h2 id="d645" class="lm jf hi bd jg ln lo lp jk lq lr ls jo iq lt lu js iu lv lw jw iy lx ly ka lz bi translated">全局安装Composer</h2><p id="7dc9" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">现在PHP已经在我们的机器上了，<strong class="ih hj">我们将按照他们的文档下载</strong><a class="ae jd" href="https://getcomposer.org/doc/00-intro.md" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj">Composer</strong></a>(一个我们将用来下载Goutte的PHP包管理器)。</p><ul class=""><li id="ccfb" class="kh ki hi ih b ii ij im in iq kj iu kk iy kl jc km kn ko kp bi translated">在桌面(cd桌面)打开你的终端，写<code class="du kw kx ky kz b">php -r "copy('https://getcomposer.org/installer', 'composer-setup.php');"</code>。一个名为composer-setup.php的文件将会出现在你的桌面上。</li></ul><figure class="lb lc ld le fd lf er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es la"><img src="../Images/06b8e6ab58e67a6bd24a70ac3edda7fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ELBw5gGO9Crxqxyi.jpg"/></div></div></figure><ul class=""><li id="fed5" class="kh ki hi ih b ii ij im in iq kj iu kk iy kl jc km kn ko kp bi translated">接下来，复制并粘贴以下命令:</li></ul><p id="3025" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du kw kx ky kz b">php -r "if (hash_file('sha384', 'composer-setup.php') === '756890a4488ce9024fc62c56153228907f1545c228516cbf63f885e036d37e9a59d27d63f46af1d4d07ee0f76181c7d3') { echo 'Installer verified'; } else { echo 'Installer corrupt'; unlink('composer-setup.php'); } echo PHP_EOL;"</code></p><p id="181b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这将验证安装文件是否已正确下载。</p><ul class=""><li id="237e" class="kh ki hi ih b ii ij im in iq kj iu kk iy kl jc km kn ko kp bi translated">验证文件后，我们将使用PHP composer-setup.php运行脚本。该命令将下载并安装实际的编写器。</li><li id="9a13" class="kh ki hi ih b ii kq im kr iq ks iu kt iy ku jc km kn ko kp bi translated">如果我们停止在这一点上，我们将只能从桌面调用作曲家，这不是我们想要的。为了将它移动到我们的路径中，我们将使用命令<code class="du kw kx ky kz b">mv composer.phar /usr/local/bin/composer</code>。</li></ul><p id="4ce7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">哎呀！我们的指挥出了点小问题。但是不要担心，我们需要做的就是在命令中使用sudo，所以它看起来像这样:</p><p id="75b1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du kw kx ky kz b">sudo mv composer.phar /usr/local/bin/composer</code></p><p id="105d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它会询问我们的密码，然后将文件移动到指定的目录。</p><ul class=""><li id="92ea" class="kh ki hi ih b ii ij im in iq kj iu kk iy kl jc km kn ko kp bi translated">为了完成这个过程，让我们调用composer，通过在终端中键入Composer来验证它是否正常工作。它应该调用可执行文件，并向您显示以下消息。</li></ul><figure class="lb lc ld le fd lf er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es ma"><img src="../Images/3035c9b56776a2fdff80edb47c2b3666.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*RvNVD-oWR_-FOpNW.jpg"/></div></div></figure><p id="afb9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果它不工作，去你的finder，点击<code class="du kw kx ky kz b">shift+command+G</code>，在弹出窗口中输入<code class="du kw kx ky kz b">usr/local/bin/ path</code>。</p><figure class="lb lc ld le fd lf er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es la"><img src="../Images/33162cd22eb1171b5f765957f8845be5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Uh1WJ0KBD8vunF_N.jpg"/></div></div></figure><p id="26bb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意，我们的“composer.phar”文件现在被称为“composer ”,它是一个可执行文件。如果您看到它仍然是一个. phar文件，只需更改它的名称，您就可以使用composer命令。</p><p id="60ca" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">注意:</strong>完成后，您可以使用下面的命令p <code class="du kw kx ky kz b">hp -r "unlink('composer-setup.php');"</code>删除安装程序。</p><h2 id="8416" class="lm jf hi bd jg ln lo lp jk lq lr ls jo iq lt lu js iu lv lw jw iy lx ly ka lz bi translated">安装Guzzle和Goutte</h2><p id="e612" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">我们安装Guzzle的原因是因为Goutte需要它正常运行。</p><p id="a40e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">分别在你的终端运行<code class="du kw kx ky kz b">composer require guzzlehttp/guzzle</code>安装Guzzle和<code class="du kw kx ky kz b">composer require fabpot/goutte</code>安装goutte。</p><p id="d7e5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这需要几秒钟的时间，然后我们就可以开始编写我们的scraper了。</p><h1 id="fbb2" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">3.刮掉页面上的所有标题</h1><p id="adbe" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">我们将使用<a class="ae jd" href="https://code.visualstudio.com/" rel="noopener ugc nofollow" target="_blank"> Visual Studio代码</a>,但是您可以使用您喜欢的文本编辑器。</p><p id="8c92" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们创建一个名为“php_scraper_tutorial”的文件夹，并在visual studio中找到它。然后，打开一个新的端子，使用<code class="du kw kx ky kz b">composer require fabpot/goutte</code>将Goutte安装在里面。</p><p id="ddcb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它将添加一个名为“vendor”的新文件夹和两个文件(“composer.json”和“composer.lock”)。准备好之后，创建一个名为“php_scraper.php”的新文件。您的文件夹应该如下所示:</p><figure class="lb lc ld le fd lf er es paragraph-image"><div class="er es mb"><img src="../Images/e6a58fcfeadbff2dd5eae50f38b89051.png" data-original-src="https://miro.medium.com/v2/resize:fit:1040/format:webp/0*GLHHAMmIfFHQvigX.jpg"/></div></figure><p id="53aa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将以PHP标签(<?php ) and import our dependency to our project.</root?></p><p id="c732" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"> 【T6】 <br/> <code class="du kw kx ky kz b">require 'vendor/autoload.php';</code> <br/> <code class="du kw kx ky kz b">use Goutte\Client;</code> <br/> <code class="du kw kx ky kz b">$client = new Client();</code>)开始我们的文件</p><p id="a0b8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">PHP自动加载会自动加载我们需要的每一个库，节省我们很多时间和麻烦。然后我们打开一个新的Goutte客户端，通过它我们将发送请求。</p><p id="c273" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为此，我们将创建一个名为' $crawler '的新实例，并让它将请求发送到Newchic的页面，在URL之前指定方法——在我们的例子中是<code class="du kw kx ky kz b">GET</code>。</p><p id="20f9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du kw kx ky kz b">$crawler = $client-&gt;request('GET', 'https://www.newchic.com/women-t-shirts-c-3666/?mg_id=1&amp;from=nav&amp;country=223&amp;NA=1')</code></p><p id="8915" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是我们不仅仅想要HTML，不是吗？</p><p id="f9ae" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">得到响应后，我们希望使用之前确定的CSS类只提取每件t恤的名称。这就是<code class="du kw kx ky kz b">filter()</code>来拯救世界的时候。</p><p id="0048" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du kw kx ky kz b">$crawler-&gt;filter('.lg text-ellipsis d-block text-hover-underline text-s;econdary-hover font-small-12 text-grey product-item-name-js')-&gt;each(function($node){</code>T8<code class="du kw kx ky kz b"> var_dump($node-&gt;text());</code>T9】T3】</p><p id="7d54" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们的脚本将过滤所有与我们指定的类匹配的<a>元素，并遍历每个节点(因为当提取所有元素时，我们将有多个节点)。</a></p><p id="b8bb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然而，在运行脚本之后，我们实际上得到一个致命的错误，并且没有返回任何东西。</p><p id="0708" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这在web抓取中很常见(在任何开发环境中也是如此)，重要的是不要气馁。</p><p id="b664" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">经过多次尝试，我们使用chrome扩展SelectorGadget来获得正确的CSS选择器。</p><figure class="lb lc ld le fd lf er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es la"><img src="../Images/732a6eb4fbfa585216e730a7e0f32b08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*FUQBbEKfDBKlUnGC.jpg"/></div></div></figure><p id="b292" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">显然，问题是我们的脚本无法找到我们告诉它要寻找的类。所以它是在操作过程中坠毁的。</p><p id="b168" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">更新代码后:</p><p id="caa1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">【T4<br/><code class="du kw kx ky kz b"> var_dump($node-&gt;text());</code><br/><code class="du kw kx ky kz b">});</code></p><p id="01cc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们能够运行代码并在页面上获得60个产品名称:</p><figure class="lb lc ld le fd lf er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es la"><img src="../Images/03581c04ac920a3f02e1340265265d74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Dky2nvbVAgkMHXfr.png"/></div></div></figure><p id="7913" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">等等…西班牙语？刚刚发生了什么？</p><p id="cd1c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Newchic的网站根据位置显示不同的内容(就像亚马逊一样),因为我们发送请求的IP地址来自一个拉丁国家，所以该网站以西班牙语版本的页面进行响应。</p><p id="4716" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了克服这一点，我们需要改变我们的IP地址。</p><h1 id="8c36" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">4.将Scraper API与PHP集成用于地理定位</h1><p id="e0ff" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">Scraper API是一个结合了第三方代理、人工智能和多年统计数据的解决方案，以防止我们的抓取工具被验证码、禁令和其他反抓取技术阻止。</p><p id="190f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此外，我们可以使用API来执行JavaScript(为此我们必须使用一个无头浏览器)和访问特定于地理的数据。</p><p id="3939" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，让我们<a class="ae jd" href="https://dashboard.scraperapi.com/signup" rel="noopener ugc nofollow" target="_blank">创建一个免费的Scraper API帐户</a>来获得5000个免费API调用(每月)和我们的API密钥。</p><p id="784a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦我们进入仪表板，我们将使用cURL示例来构建用于脚本的URL。</p><figure class="lb lc ld le fd lf er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es la"><img src="../Images/7804401eb09091236539d7758d06118e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*OWMrt2K2ES980ww8.jpg"/></div></div></figure><p id="70d0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们现在做的是在url参数后添加Newchic的URL，并在字符串末尾添加一个额外的参数。</p><p id="3af8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du kw kx ky kz b">$crawler = $client-&gt;request('GET', 'http://api.scraperapi.com?api_key=51e43be283e4db2a5afb6266xxxxxxxx&amp;url=https://www.newchic.com/women-t-shirts-c-3666/?mg_id=1&amp;from=nav&amp;country=223&amp;NA=1&amp;country_code=us');</code></p><p id="f087" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du kw kx ky kz b">country_code</code>参数将告诉Scraper API从美国代理发送请求。</p><p id="5fee" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果我们现在运行我们的脚本，我们将看到返回的内容现在是英文的，这是美国用户将在他们的浏览器中看到的。</p><figure class="lb lc ld le fd lf er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es la"><img src="../Images/68badfa68fd4e243281de8fd4c776836.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*DC4ULGmWJUba7AvR.png"/></div></div></figure><p id="eac5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有关可用国家代码的完整列表及更多信息，请查看我们的<a class="ae jd" href="https://www.scraperapi.com/documentation/" rel="noopener ugc nofollow" target="_blank">详细文档</a>。</p><p id="a250" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">注意:</strong>如果你想从一个需要你执行JavaScript的站点获取access数据，只需设置<code class="du kw kx ky kz b">render=true</code>，记住每个参数都用一个&amp;隔开。</p><h1 id="1c03" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">5.从网页中抓取多个元素</h1><p id="af10" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">对于这一部分，我们将混合一些东西。我们希望为每个想要获取的元素创建一个不同的变量。</p><p id="869d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，让我们更改第一个过滤器，让我们的PHP scraper查找包装了名称、价格和链接的元素。</p><figure class="lb lc ld le fd lf er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es la"><img src="../Images/0611cfb2d6a9672ed070734f5bad72f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*HlLp5EEn0EgYW-8M.jpg"/></div></div></figure><p id="9b49" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将为每个元素创建新的变量，并使用filter()函数来查找$节点中的元素。</p><p id="d5d6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du kw kx ky kz b">crawler-&gt;filter('.product-item__bottom')-&gt;each(function($node){</code>T20<code class="du kw kx ky kz b"> $name = $node-&gt;filter('.product-item-name-js')-&gt;text();</code>T21】T4】</p><p id="df4b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于价格和名称，我们希望获取文本，但对于链接却不是这样。为了获取href属性中的值，我们将使用attr('href ')方法。为了确保它找到正确的行，我们在CSS选择器中添加了a标记。</p><p id="5f6f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du kw kx ky kz b">$link = $node-&gt;filter('a.product-item-name-js')-&gt;attr('href');</code></p><p id="21ff" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">更新我们的文件后，它应该看起来像这样:</p><p id="e7e7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du kw kx ky kz b">&lt;?php</code><br/><code class="du kw kx ky kz b">include 'vendor/autoload.php';</code><br/><code class="du kw kx ky kz b">use Goutte\Client;</code><br/><code class="du kw kx ky kz b">$client = new Client();</code><br/><code class="du kw kx ky kz b">$crawler = $client-&gt;request('GET', 'http://api.scraperapi.com?api_key=51e43be283e4db2a5afb62660fc6ee44&amp;url=https://www.newchic.com/women-t-shirts-c-3666/?mg_id=1&amp;from=nav&amp;country=223&amp;NA=1&amp;country_code=us');</code><br/><code class="du kw kx ky kz b">$crawler-&gt;filter('.product-item__bottom')-&gt;each(function($node){</code><br/><code class="du kw kx ky kz b"> $name = $node-&gt;filter('.product-item-name-js')-&gt;text();</code><br/><code class="du kw kx ky kz b"> $price = $node-&gt;filter('.product-price-js')-&gt;text();</code><br/><code class="du kw kx ky kz b"> $link = $node-&gt;filter('a.product-item-name-js')-&gt;attr('href');</code><br/><code class="du kw kx ky kz b">});</code></p><h1 id="b4b5" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">包扎</h1><p id="eff4" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">恭喜你！您刚刚使用Goutte创建了第一个PHP web scraper。当然，还有很多要学的。</p><p id="d77d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们将停止本教程在这一点上，因为它是一个关于PHP的网页抓取的介绍。</p><p id="712d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在未来的教程中，我们将扩展我们的scraper功能，以便它可以通过链接从一个脚本中抓取多个页面，并将我们抓取的数据转换为一个CSV文件，供我们进一步分析。</p><p id="081e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你想了解更多关于网络抓取的知识，看看我们关于大规模抓取项目的<a class="ae jd" href="https://www.scraperapi.com/blog/5-tips-for-build-large-scale-web-scrapers/" rel="noopener ugc nofollow" target="_blank">提示</a>。</p><p id="d4d4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有关使用Scraper API的更多信息，请查看<a class="ae jd" href="https://www.scraperapi.com/blog/web-scraping-best-practices/" rel="noopener ugc nofollow" target="_blank"> Scraper API备忘单和抓取最佳实践</a>页面。您将了解每个web抓取器将面临的主要挑战，以及如何通过一个简单的API调用来解决它们。</p><p id="b581" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">刮的开心！</p></div></div>    
</body>
</html>