<html>
<head>
<title>Plugin extensions, lineage coupling systems, production environment optimization, the application refactors to simplify the use of Apache DolphinScheduler</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">插件扩展、沿袭耦合系统、生产环境优化、应用程序重构以简化Apache DolphinScheduler的使用</h1>
<blockquote>原文：<a href="https://medium.com/codex/plugin-extensions-lineage-coupling-systems-production-environment-optimization-the-application-161eb0b53b16?source=collection_archive---------23-----------------------#2022-05-11">https://medium.com/codex/plugin-extensions-lineage-coupling-systems-production-environment-optimization-the-application-161eb0b53b16?source=collection_archive---------23-----------------------#2022-05-11</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/4f033cac5853c1883b58582b1d09b0dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8cgyGF4SqecJIUNgloQASg.png"/></div></div></figure><p id="2b35" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Apache DolphineScheduler，新一代大数据任务调度系统，旨在让调度更简单。为了更好地为用户服务，Apache DolphineScheduler贡献者Baiqiang Zhang提供了一些解决可用性现有问题的解决方案，如任务扩展、任务谱系耦合、任务日志优化等。，并在四月份的Apache DolphinScheduler在线会议上展示了它们，详细解释了他的一些应用实践和对Apache dolphin scheduler的优化。</p><p id="7c05" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">分享的主要内容如下。</p><ul class=""><li id="d428" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn jt ju jv jw bi translated">基于Apache DolphinScheduler的重构</li><li id="cde4" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">Apache DolphinScheduler插件的扩展</li><li id="f437" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">Apache DolphinScheduler沿袭耦合系统</li><li id="43f7" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">优化Apache DolphinScheduler以适应生产环境</li></ul><figure class="kc kd ke kf fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/23e341f2e9e1321f8e6d274010b33815.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9a-XhEBi0z40TzHJ7bUxYQ.png"/></div></div></figure><p id="45c6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">张百强，大数据基础平台开发者，从事大数据基础平台开发和底层组件运维</p><h1 id="9865" class="kg kh hi bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">01在Apache DolphinScheduler上重构</h1><h2 id="4a86" class="le kh hi bd ki lf lg lh km li lj lk kq jb ll lm ku jf ln lo ky jj lp lq lc lr bi translated">1在多种环境中重构元数据和任务执行</h2><p id="3a74" class="pw-post-body-paragraph iq ir hi is b it ls iv iw ix lt iz ja jb lu jd je jf lv jh ji jj lw jl jm jn hb bi translated">Apache DolphinScheduler的3.x和2.x版本在元数据和多种环境中的任务执行方面存在缺点，社区目前尚未进行功能优化，即，</p><p id="7956" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">1.无法在线编辑任务</p><p id="c4cb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">2.任务不能在Pro/Test环境之间动态切换</p><p id="07d3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">3.不能使用多个调度程序设置同一个流程工作流</p><p id="5098" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> 1.1元数据分离重构</strong></p><p id="3045" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了解决多个环境中的元数据和任务执行问题，我们对Apache DolphinScheduler进行了基本的修改。</p><p id="0346" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">改革始于任务上线后不可编辑的问题，这导致用户体验不太友好，如果随机更改，会影响在线调度。通常，任务只有在完全开发后才能修改，如果没有，它们不能在线弹出，因为它们可能会影响下游的依赖关系。因此，我们修改了Apache DolphinScheduler元数据，将用户编辑的任务和调度的任务分成两个独立的部分，这样，当用户单击任务发布时，它会触发对依赖于调度的任务信息表的更改，而用户的本地执行和修改都不会触发依赖于调度的任务信息表。</p><figure class="kc kd ke kf fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lx"><img src="../Images/229c50f2a33347ff35eb482e7ae972b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*k_G-dswOkNg2Mt3J"/></div></div></figure><p id="f4a7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如上图所示，当用户点击执行一个任务时，当一个任务被修改时，操作指向Dev的元数据。当用户点击发布任务，通过Dev发布到Apache DolphinScheduler，即调度元数据，调度元数据就可以执行了。这有助于我们解决任务编辑的问题。如果不发布任务，我们的任务不会影响在线任务。这相当于任务的多态转换，即测试和生产。</p><p id="d6da" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> 1.2多环境执行重构</strong></p><p id="7f8c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">第二个问题的改进:任务动态地切换环境。基于最新版本的Apache DolphinScheduler 2.x.x，支持多种环境，我们给出了一个部署配置scheduler . executor . environment . name，这个参数用来决定一个任务通过多种调度执行时应该使用哪种环境。比如调度a时用测试环境，调度b时用生产环境，任务执行的转换是通过参数配置自动完成的。</p><h2 id="3536" class="le kh hi bd ki lf lg lh km li lj lk kq jb ll lm ku jf ln lo ky jj lp lq lc lr bi translated">增加了2个任务信息列表</h2><p id="a74f" class="pw-post-body-paragraph iq ir hi is b it ls iv iw ix lt iz ja jb lu jd je jf lv jh ji jj lw jl jm jn hb bi translated">为了增强UI页面的可用性，我们特意添加了任务列表功能，以减少用户操作并在一个页面上显示消息。在原生Apache DolphinScheduler中，我们需要多次点击才能找到任务执行记录，部分任务的详细信息并不全面，包括任务最近的执行状态。同时，我们还修改了任务向上/向下模块，以单独显示任务。页面内容包括链接到版本的任务版本、任务历史、最近10次执行实例、任务名称、编辑任务流程、任务版本管理、定时管理、任务下载等。</p><h2 id="2fbc" class="le kh hi bd ki lf lg lh km li lj lk kq jb ll lm ku jf ln lo ky jj lp lq lc lr bi translated">3项目文件夹功能扩展和工作流UI修改</h2><p id="af20" class="pw-post-body-paragraph iq ir hi is b it ls iv iw ix lt iz ja jb lu jd je jf lv jh ji jj lw jl jm jn hb bi translated">在本地Apache DolphinScheduler中，不可能创建第二个调度程序。目前，我们已经修改了用户界面，以支持多种调度设置的调度任务。</p><p id="56d5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">具体来说，Apache DolphinScheduler提供了一个基于项目的最大单元，每个项目包含数百或数千个工作流单元，以及工作流下的任务。虽然它本身包含分页功能，但就使用场景而言，如果一个项目包含太多的工作流，用户将会弄不清该任务下有哪些任务，也无法根据当前项目的服务线划分任务。为了方便用户操作，我们提供了一个单位服务行文件夹，分为项目-&gt;工作流目录-&gt;目录，并修改了工作流定义界面的界面风格，如下图所示:</p><figure class="kc kd ke kf fd ij er es paragraph-image"><div class="er es ly"><img src="../Images/ad7efa98ae27b450732a9f10cb2c5396.png" data-original-src="https://miro.medium.com/v2/resize:fit:1020/0*SuBt1FEXzMdDRMLv"/></div></figure><p id="d464" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">脚本任务</p><h1 id="e88c" class="kg kh hi bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">02 Apache DolphinScheduler插件扩展</h1><p id="f35d" class="pw-post-body-paragraph iq ir hi is b it ls iv iw ix lt iz ja jb lu jd je jf lv jh ji jj lw jl jm jn hb bi translated">我们目前已经创建了许多类型的任务，但通常只使用三个类别，即Spark/Hive ClientSQL任务、DQC任务和SSH任务。</p><h2 id="04f5" class="le kh hi bd ki lf lg lh km li lj lk kq jb ll lm ku jf ln lo ky jj lp lq lc lr bi translated">1个Spark/Hive客户端SQL任务</h2><p id="d309" class="pw-post-body-paragraph iq ir hi is b it ls iv iw ix lt iz ja jb lu jd je jf lv jh ji jj lw jl jm jn hb bi translated">Apache DolphinScheduler的开箱即用任务仅提供了一种通过JDBC执行SQL任务的形式，但是对于一些筒仓场景，这些任务类型是不够的，因此我们提供了hive/spark SQL任务的基于模板的配置。但是，这可能会对其他系统产生影响，所以我们将其作为一个模板，它支持多个SQL，并包含高级参数，即所有Spark参数和所有Hive参数的列表，供用户搜索和配置，而其余功能保持不变。这些修改对允许用户快速开发离线任务有很大的影响，同时将当前任务绑定到一个谱系系统，该系统可以在任务执行时包含完整的可追溯谱系。</p><figure class="kc kd ke kf fd ij er es paragraph-image"><div class="er es lz"><img src="../Images/5aa3cfcdffe5f08c8b8dd21e1fa70205.png" data-original-src="https://miro.medium.com/v2/resize:fit:1112/0*ID8FnEa4D7izAo6a"/></div></figure><p id="3769" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">SQL语法</p><h2 id="869c" class="le kh hi bd ki lf lg lh km li lj lk kq jb ll lm ku jf ln lo ky jj lp lq lc lr bi translated">2 DQC任务</h2><p id="9065" class="pw-post-body-paragraph iq ir hi is b it ls iv iw ix lt iz ja jb lu jd je jf lv jh ji jj lw jl jm jn hb bi translated">当前2.x版尚不支持DQC任务。我们基于一组现有规则改进了DQC任务的第一个版本，提供了空值检查、最大值检查、最小值检查、重复检查和数据量检查，并支持多分类、多表比较和用户定义的函数。以上功能相对容易实现，相当于将规则包装成Spark SQL，通过Spark SQL或其他方式执行。</p><p id="38f5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在优化方面，对于统计数据量，我们编写了专门的程序，直接从ORC文件中读取数据量，提高资源利用率。目前，我们已经完成了包括任务检测、DQC警报和自定义规则在内的功能集成，但DQC尚未覆盖所有大数据场景。</p><h2 id="41e7" class="le kh hi bd ki lf lg lh km li lj lk kq jb ll lm ku jf ln lo ky jj lp lq lc lr bi translated">3 SSH任务</h2><p id="6044" class="pw-post-body-paragraph iq ir hi is b it ls iv iw ix lt iz ja jb lu jd je jf lv jh ji jj lw jl jm jn hb bi translated">SSH任务提供了一个任务模板。在某些场景下，如果Apache DolphinScheduler的工作人员不在机器上，我们需要自己定时执行任务，比如每天定时清理日志，定时操作某些bash。为了统一管理，我们为快速开发提供了冗余任务。</p><h1 id="ce2c" class="kg kh hi bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">03 Apache DolphinScheduler沿袭耦合系统</h1><p id="d8b1" class="pw-post-body-paragraph iq ir hi is b it ls iv iw ix lt iz ja jb lu jd je jf lv jh ji jj lw jl jm jn hb bi translated">沿袭耦合一直是社区中比较流行的需求之一，所以我将借此机会谈谈我们对此功能所做的改进，供您参考。</p><h2 id="6adf" class="le kh hi bd ki lf lg lh km li lj lk kq jb ll lm ku jf ln lo ky jj lp lq lc lr bi translated">1任务表沿袭绑定</h2><p id="7237" class="pw-post-body-paragraph iq ir hi is b it ls iv iw ix lt iz ja jb lu jd je jf lv jh ji jj lw jl jm jn hb bi translated">首先，是任务表沿袭绑定。当Apache DolphinScheduler执行一个任务时，我们会根据类型得到以下类型，并将这些类型的任务内容、任务名称、工作流名称写入沿袭服务器，然后在沿袭服务器建立沿袭后写入graph db或Hbase，最后通过API查询数据进行显示。</p><figure class="kc kd ke kf fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/6db3048ab7341bc32b557db49401a358.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Rx9XftgJ2uMJUAab"/></div></div></figure><p id="d5b9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">任务类型包括SeaTunnel、Spark、MySQL、Hive和Sqoop。我们如何从数据中提取血统？</p><p id="a1f1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先，数据提取是沿袭的来源，我们通过SeaTunnel和Sqoop本身包含的配置文件构建沿袭节点，并将配置文件发送到lineageServer。lineageServer相当于一个客户端，目的是解析接收到的配置文件和一些变量数据，并将其发送到MQ。</p><p id="6268" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">其次，数据仓库的Spark实现包括Spark的监听器和SparkSql的SparkSessionExtensions。</p><p id="45fd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">再者，MySQL是自定义解析规则，使用antlr4工具，你可以使用Druid或者其他你认为合适的解析工具。</p><p id="c328" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最后，hive类型使用了一个Hive钩子。钩子在SQL执行前有一个触发器，在SQL执行后有一个触发器，它向下游发送关于执行的信息。</p><p id="b52c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">LineageSource的具体实现是解析所有的用户定义，包括数据提取和目标数据，LineageSource解析SeaTunnel和Sqoop，将配置发送给下游的沿袭服务，沿袭服务会将其解析成一个大的json str，发送给MQ，我们会在解析中将其绑定到workflow.task.database.table格式的WorkflowName和TaskName。在这个过程中，我们如何获得工作流和任务名称？在Apache DolphinScheduler实现中，用户的任务最终被封装到一个shell中执行。然后将工作流名称和任务名称导入到流程级环境变量中，或者使用流程API进行设置，并在下游触发挂钩。当hook被触发时，环境变量仍然存在于同一个进程下，因此当hook、spark listener或lineage service触发时，它读取环境变量，在获得工作流名称和任务名称后将其连接成一个大的JSON，其中包含了关于lineage的全套信息，然后lineage的JSON数据被发送到MQ，由lineage的下游读写到图形库、Hbase或MySQL，最后通过API服务器显示出来。</p><p id="c7c7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您想构建更深层次的沿袭服务，您需要了解常见的SQL解析工具，包括</p><ul class=""><li id="2eba" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn jt ju jv jw bi translated">antlr4，通过它可以编写规则，生成规则类文件，然后直接使用解析。这个工具目前由Apache Spark使用。</li><li id="300d" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">方解石是Apache Flink目前使用的工具。</li><li id="e185" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">Druid，它有一个完全打包的API，可以解析Hive和MySQL。</li><li id="313d" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">解析包Hive-exec.jar和Spark-sql.jar. Native解析包会提供一个解析的公共API直接调用，也可以解析sql然后封装血刃。</li></ul><h2 id="da86" class="le kh hi bd ki lf lg lh km li lj lk kq jb ll lm ku jf ln lo ky jj lp lq lc lr bi translated">2沿袭存储设计建议</h2><ul class=""><li id="16e0" class="jo jp hi is b it ls ix lt jb ma jf mb jj mc jn jt ju jv jw bi translated">h基本存储</li></ul><p id="70fe" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们用Hbase存储来存储Atlas中的血统，Neo4j原生支持血统，那么为什么要用Hbase来存储血统呢？这是因为与使用Neo4j数据库相比，我们不需要进行任何额外的学习。</p><p id="9c87" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">复杂的是世系的设计，首先，我们以世系表结构为例，最简单的设计是</p><pre class="kc kd ke kf fd md me mf mg aw mh bi"><span id="f797" class="le kh hi me b fi mi mj l mk ml">tableName lineage_table (split[])<br/>rowkey<br/>column family s t</span></pre><p id="f980" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">第一行:为Hbase定义表名lineage_table</p><p id="1608" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">第二行:设计rowkey。rowkey是要搜索的表的当前名称。Hive的hook机制执行完任务SQL后，会将信息发送给下游。会有一个DDL监控，当用户触发DDL时，比如用户创建了一个新表，它会在Hbase中推送或者插入数据，包括创建时间和表名，表名就是它的rowkey。</p><p id="b044" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">第3行:列簇。有2种柱簇设计，包括源和目标。比如表a对应上下游任务表谱系，上游相当于源，下游相当于目标。这两个列簇将沿袭写入源和目标。</p><p id="a1b8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在应用程序级查询时，可以直接根据显示的行键查找所有的源和目标。这是一个简单的想法，由于各种原因，我们还没有应用。如果你对Hbase有很深的了解，我们建议你深入研究一下。一旦写入数据，我们每次只扩展最近的谱系，并根据最近的谱系按顺序扩展，而更新任务需要发送一个事件来删除旧的谱系和其他操作。</p><ul class=""><li id="35aa" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn jt ju jv jw bi translated">Neo4j</li></ul><p id="77d6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您知道如何使用Neo4j，存储血统信息比使用Hbase更容易，因为它对血统的自然支持，不需要设计自己的血统。</p><h1 id="6f11" class="kg kh hi bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">04 Apache dolphin scheduler的生产基本优化</h1><h2 id="a02c" class="le kh hi bd ki lf lg lh km li lj lk kq jb ll lm ku jf ln lo ky jj lp lq lc lr bi translated">1任务日志存储优化</h2><p id="46e2" class="pw-post-body-paragraph iq ir hi is b it ls iv iw ix lt iz ja jb lu jd je jf lv jh ji jj lw jl jm jn hb bi translated">任务调试对于服务于用户和开发人员的调度系统来说是必不可少的。通常，任务调试从演示、调试和日志开始，因此针对任务执行日志的调试对用户来说是必不可少的。随着任务的增加和时间的推移，日志会增加，但企业中的服务器往往有单独的存储磁盘和应用程序磁盘，所以我们需要采取的第一步是改变Apache DolphinScheduler的执行日志的位置。</p><figure class="kc kd ke kf fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mm"><img src="../Images/d84e621b29873392f4fa84b8ea63af32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hkdu3NwcUJTZdZ8DZBLlKA.png"/></div></div></figure><p id="7939" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如上图所示，部署应用程序的目录挂载在1T磁盘上，写入执行日志的目录挂载在5T磁盘上，用于可插拔数据磁盘。这是关于分裂。</p><p id="0b59" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">写的时候需要修改conf下的logback-worker，log base和file标签的内容，写到相应的位置。因此，可以划分日志、执行日志和应用程序，减少服务器的压力，方便日志监控和日志清理，而无需采取其他操作。</p><figure class="kc kd ke kf fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mn"><img src="../Images/21068fed52fd7a5f71e4ca74dbab774b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XbQEQWrPklBkymJe0inmZQ.png"/></div></div></figure><h2 id="7c02" class="le kh hi bd ki lf lg lh km li lj lk kq jb ll lm ku jf ln lo ky jj lp lq lc lr bi translated">2经验分享</h2><p id="2b85" class="pw-post-body-paragraph iq ir hi is b it ls iv iw ix lt iz ja jb lu jd je jf lv jh ji jj lw jl jm jn hb bi translated">在修改Apache DolphinScheduler的过程中，我们也获得了一些经验与大家分享。</p><p id="d981" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> 1。实例数据是如何管理的？</strong></p><p id="2aa7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">随着系统继续在线运行，实例数据会随着时间的推移逐渐重现，但是删除大量实例数据或者存储并不是一个好的解决方案。这个问题的更好的解决方案是拆分数据库和表，将数据写入HDFS，并留给HIVE管理，只将历史统计数据写入MySQL。第二种方式是修改Apache DolphinScheduler的查询，需要添加一些聚合，比如Hive结果和历史数据的聚合。</p><p id="87a5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> 2。Shell结果抓取失败的原因是什么？</strong></p><p id="e0c2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">shell的执行机制是，一旦一行代码报告错误，如果下一行还有代码，它仍然会执行，如果下一行代码正常执行，它将返回0。我们可以设置。</p><p id="73e5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> 3。如何添加新的管理员用户？</strong></p><p id="c31f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">将原生Apache DolphinScheduler的t_Apache DolphinScheduler_user表中的user_type改为0。</p><p id="de1b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> 4。如何在原生Apache DolphinScheduler中使用双环境执行？</strong></p><p id="6f9a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要保证Apache DolphinScheduler在两个集群中都可以运行，最简单的方法就是将worker部署到测试环境中，在这种情况下我们可以动态选择任务执行时执行哪个worker；如果不想部署太多的worker，可以设置两个不同的执行env，然后在不启动服务的情况下将测试环境包部署到其中一个worker位置，甚至可以取消service jar，只依赖客户机及其配置文件。如果您需要确保数据一致性，您将需要使用外部工具，如DQC工具和定制开发工具。</p><p id="3ce3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">以上就是我要分享的，谢谢！</p><h1 id="765b" class="kg kh hi bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">加入社区</h1><p id="6f80" class="pw-post-body-paragraph iq ir hi is b it ls iv iw ix lt iz ja jb lu jd je jf lv jh ji jj lw jl jm jn hb bi translated">参与DolphinScheduler社区并为其做出贡献的方式有很多，包括:</p><p id="58c7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">文档、翻译、Q &amp; A、测试、代码、文章、主题演讲等。</p><p id="58f8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们假设第一个PR(文档、代码)是简单的，应该用来熟悉提交过程和社区协作风格。</p><p id="3a4e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">所以社区整理了以下适合新手的问题列表:<a class="ae mo" href="https://github.com/apache/dolphinscheduler/issues/5689" rel="noopener ugc nofollow" target="_blank">https://github.com/apache/dolphinscheduler/issues/5689</a></p><p id="8dac" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">非新手问题列表:<a class="ae mo" href="https://github.com/apache/dolphinscheduler/issues?q=is%3Aopen+is%3Aissue+label%3A%22volunteer+wanted%22" rel="noopener ugc nofollow" target="_blank">https://github.com/apache/dolphinscheduler/issues?q = is % 3A open+is % 3A issue+label % 3A % 22 volunteer+wanted % 22</a></p><p id="5323" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如何参与投稿:<a class="ae mo" href="https://dolphinscheduler.apache.org/en-us/community/development/contribute.html" rel="noopener ugc nofollow" target="_blank">https://dolphin scheduler . Apache . org/en-us/community/development/contribute . html</a></p><p id="5139" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> GitHub代码库:</strong>【https://github.com/apache/dolphinscheduler】T4</p><p id="b95b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">官方网站:</strong>https://dolphinscheduler.apache.org/</p><p id="3212" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">邮件列表:dev@dolphinscheduler@apache.org</p><p id="63fe" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">推特:</strong>@海豚时间表</p><p id="3c7d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">YouTube:https://www.youtube.com/channel/UCmrPmeE7dVqo8DYhSLHa0vA</p><p id="5b1c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">松弛:</strong>https://s.apache.org/dolphinscheduler-slack</p><p id="e764" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">投稿指南:</strong>https://dolphin scheduler . Apache . org/en-us/community/index . html</p><p id="bf37" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你的项目之星很重要，不要犹豫，点亮阿帕奇海豚调度❤️之星</p></div></div>    
</body>
</html>