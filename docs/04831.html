<html>
<head>
<title>How to Send an SMS with .Net 6 Minimal API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用发送短信？Net 6最小API</h1>
<blockquote>原文：<a href="https://medium.com/codex/how-to-send-an-sms-with-net-6-minimal-api-82e63c1e3734?source=collection_archive---------6-----------------------#2022-01-10">https://medium.com/codex/how-to-send-an-sms-with-net-6-minimal-api-82e63c1e3734?source=collection_archive---------6-----------------------#2022-01-10</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/8c754824e1102f42e2bb246139766e08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rqMt4ntHSPmTV8ejUzmLgg.png"/></div></div></figure><p id="bb83" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我一直在看。Net 6已经有一段时间了，很多人一直在谈论的一个令人兴奋的特性是最小API。虽然意见似乎分歧很大，但我认为这是一个值得欢迎的补充。它消除了使用ASP.NET MVC的许多负担，当然也降低了入门门槛，与NodeJS中的ExpressJS有相似的感觉。</p><p id="06b5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一年多前，我们发布了一篇名为“<a class="ae jo" href="https://learn.vonage.com/blog/2020/07/09/how-to-send-an-sms-with-asp-net-core-mvc" rel="noopener ugc nofollow" target="_blank">如何用ASP.NET核心MVC </a>发送短信”的博文。所以随着。Net 6，我想这将是一个好主意，看看使用新的最小API语法来模拟相同的功能会是什么样子。</p><h1 id="6477" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">给我代码</h1><p id="f5fe" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">你可以直接跳到<a class="ae jo" href="https://github.com/Vonage-Community/blog-sms-dotnet_minimal_api-send_sms" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上的代码。</p><h1 id="3e55" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">先决条件</h1><ul class=""><li id="533f" class="ks kt hi is b it kn ix ko jb ku jf kv jj kw jn kx ky kz la bi translated">。Net 6 RC 2 SDK或更高版本</li><li id="4a36" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated">Visual Studio 2022预览版或Visual Studio代码</li></ul><h1 id="2825" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">Vonage API帐户</h1><p id="ab19" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">要完成这个教程，你需要一个<a class="ae jo" href="http://developer.nexmo.com/ed?c=blog_text&amp;ct=2021-11-09-how-to-send-an-sms-with-net-6-minimal-api" rel="noopener ugc nofollow" target="_blank"> Vonage API账户</a>。如果你还没有，你可以今天<a class="ae jo" href="http://developer.nexmo.com/ed?c=blog_text&amp;ct=2021-11-09-how-to-send-an-sms-with-net-6-minimal-api" rel="noopener ugc nofollow" target="_blank">注册</a>并开始用免费信用点数进行构建。一旦你有了一个帐户，你可以在<a class="ae jo" href="http://developer.nexmo.com/ed?c=blog_text&amp;ct=2021-11-09-how-to-send-an-sms-with-net-6-minimal-api" rel="noopener ugc nofollow" target="_blank"> Vonage API仪表板</a>的顶部找到你的API密匙和API秘密。</p><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/941d1ebad7252085aa9c1e88f9dc18f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9RUNrmWVrhuK9uZKQ1igZA.png"/></div></div></figure><h1 id="6667" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">创建项目</h1><p id="5b6a" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">我发现创建一个新的最小API项目的最简单的方法是使用下面的命令</p><figure class="lg lh li lj fd ij"><div class="bz dy l di"><div class="lk ll l"/></div></figure><p id="d8b3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">微软也有一个关于使用Visual Studio创建一个新的最小API项目的很棒的教程。</p><p id="5d9f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们现在应该有一个带有“Hello World”端点的API。对此我们将添加两个NuGet包，第一个是<a class="ae jo" href="https://www.nuget.org/packages/Vonage/" rel="noopener ugc nofollow" target="_blank"> Vonage的。net SDK</a>5 . 9 . 2版本在编写的时候。因为这将是一个API，我们没有UI，所以第二个是Swashbuckle / Swagger，它将使我们能够轻松地尝试我们创建的任何端点。</p><figure class="lg lh li lj fd ij"><div class="bz dy l di"><div class="lk ll l"/></div></figure><h1 id="5bd1" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">小的更美</h1><p id="9d14" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">与通常的<code class="du lm ln lo lp b">appsettings.json</code>一样，您新创建的项目将只是一个文件，<code class="du lm ln lo lp b">Program.cs</code>。这确实是最小的，至少对ASP.Net项目来说是这样。</p><figure class="lg lh li lj fd ij er es paragraph-image"><div class="er es lq"><img src="../Images/56154aaebf4caa93e287b734cf3b6d52.png" data-original-src="https://miro.medium.com/v2/resize:fit:808/format:webp/1*DFkawYXwjVHps_ggNg4ekQ.png"/></div></figure><p id="eb6a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们打开<code class="du lm ln lo lp b">Program.cs</code>，它应该是这样的。</p><figure class="lg lh li lj fd ij"><div class="bz dy l di"><div class="lk ll l"/></div></figure><p id="5e91" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这是你拥有羽翼丰满所需要的一切。NET API都在一个文件中。这将为构建小型API或微服务提供一个更轻松的起点。老实说，当我回想起WebAPI需要多少代码才能产生相同的结果时，我仍然感到震惊。</p><h1 id="737a" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">配置</h1><p id="ca7e" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">让我们从添加一些设置开始。在<code class="du lm ln lo lp b">appsettings.json</code>中，我们需要添加我们的Vonage密钥和密码，这些用于通过Vonage的服务验证您的应用程序，可以在<a class="ae jo" href="https://dashboard.nexmo.com/" rel="noopener ugc nofollow" target="_blank">仪表板</a>的顶部找到。</p><figure class="lg lh li lj fd ij"><div class="bz dy l di"><div class="lk ll l"/></div></figure><p id="7781" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">目前，我们还没有配置依赖注入，所以让我们将VonageClient类添加到服务集合中。这将允许它被注入到我们将进一步使用的任何类或方法中。</p><p id="31ca" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在文件顶部导入所需的名称空间。</p><figure class="lg lh li lj fd ij"><div class="bz dy l di"><div class="lk ll l"/></div></figure><p id="22d7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">向服务集合注册VonageClient。</p><figure class="lg lh li lj fd ij"><div class="bz dy l di"><div class="lk ll l"/></div></figure><p id="dd83" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">每次一行，我们可以看到我们得到了一个IConfiguration的实例，这使我们能够访问我们需要的应用程序设置。然后从配置中检索密钥和秘密，以便我们可以创建VonageClient构造函数所需的凭证。</p><h1 id="e811" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">发送短信</h1><p id="4991" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">现在我们已经配置好了VonageClient类，并准备好了注入，让我们创建一个可以向其发送请求的新端点。我们需要向端点传递一个数据模型，因此需要在一个名为“SmsModel”的新文件中创建一个类。然后在类内部，我们要添加以下属性。</p><figure class="lg lh li lj fd ij"><div class="bz dy l di"><div class="lk ll l"/></div></figure><p id="2afa" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">创建好模型后，我们可以继续添加一个新的POST方法，将VonageClient和我们的SmsModel类作为参数。</p><figure class="lg lh li lj fd ij"><div class="bz dy l di"><div class="lk ll l"/></div></figure><p id="a39a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">代码块中发生了几件事情。首先，我们使用<code class="du lm ln lo lp b">MapPost</code>扩展方法在<a class="ae jo" href="http://localhost:5000/sms" rel="noopener ugc nofollow" target="_blank">http://localhost:5000/SMS</a>创建一个端点。其次，我们声明方法的参数；<code class="du lm ln lo lp b">VonageClient</code>将使用我们之前设置的依赖注入进行注入，<code class="du lm ln lo lp b">SmsModel</code>将使用<a class="ae jo" href="https://docs.microsoft.com/en-us/aspnet/core/mvc/models/model-binding?view=aspnetcore-6.0" rel="noopener ugc nofollow" target="_blank">模型绑定</a>使用请求体进行创建。</p><p id="40e5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">该方法的主体执行发送SMS的实际工作。我们使用传入的模型中的数据创建SendSmsRequest的实例，然后只需将请求类传递给SmsClient的<code class="du lm ln lo lp b">SendAnSmsAsync</code>方法。本着“极小”的精神，这只是一句台词！</p><h1 id="bc47" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">尝试一下</h1><p id="7ed1" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">项目现在应该构建、运行和接收请求。如前所述，虽然我们没有UI来测试这一点，所以我们将添加几行代码来实现我们的项目中的Swagger UI。</p><p id="3047" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">紧接在var builder = WebApplication之后。CreateBuilder(args)我们需要添加两行代码。这些将为依赖注入添加必要的服务。</p><figure class="lg lh li lj fd ij"><div class="bz dy l di"><div class="lk ll l"/></div></figure><p id="0599" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">添加了这些之后，我们在<code class="du lm ln lo lp b">app.Run()</code>行之前注册了Swagger中间件</p><figure class="lg lh li lj fd ij"><div class="bz dy l di"><div class="lk ll l"/></div></figure><p id="4050" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们已经写好了所有的代码，我们可以运行项目了，如果您使用的是Visual Studio，请按F5键，或者在项目文件夹中运行下面的命令</p><figure class="lg lh li lj fd ij"><div class="bz dy l di"><div class="lk ll l"/></div></figure><p id="d58e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在浏览到<a class="ae jo" href="https://localhost:5001/swagger" rel="noopener ugc nofollow" target="_blank">https://localhost:5001/swagger</a>，您应该能够使用SMS端点上的“试用”按钮。从那里你会看到一个200响应代码，并收到一条短信。</p><h1 id="607c" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">确认</h1><p id="98d5" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">输入验证是任何API的重要组成部分，正如你在ASP.NET MVC中发现的那样，在最小的API中没有内置的验证。Damian Edwards创建了一个名为<a class="ae jo" href="https://github.com/DamianEdwards/MiniValidation" rel="noopener ugc nofollow" target="_blank"> MinimalValidation </a>的小库，使用了类似于MVC验证的验证属性。</p><p id="1dc4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">就个人而言，我更喜欢<a class="ae jo" href="https://fluentvalidation.net/" rel="noopener ugc nofollow" target="_blank">流畅验证</a>，因为它使用代码来定义规则而不是属性。下面是一个例子，包括验证在内的完整代码请查看GitHub 上的<a class="ae jo" href="https://github.com/Vonage-Community/blog-sms-dotnet_minimal_api-send_sms" rel="noopener ugc nofollow" target="_blank">库。</a></p><p id="db4f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">服务注册和端点更改</p><figure class="lg lh li lj fd ij"><div class="bz dy l di"><div class="lk ll l"/></div></figure><p id="a833" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">模型验证器</p><figure class="lg lh li lj fd ij"><div class="bz dy l di"><div class="lk ll l"/></div></figure><p id="9d04" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">验证扩展</p><figure class="lg lh li lj fd ij"><div class="bz dy l di"><div class="lk ll l"/></div></figure><h1 id="8618" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">最后的想法</h1><p id="a069" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">MVC是一个功能全面的框架，集成了内置的模型绑定和验证、通过过滤器的可扩展管道、基于约定和声明的行为等等。有些可能不需要特定的特性，或者有性能限制，这使得使用MVC并不理想。随着越来越多的功能作为ASP.NET核心中间件浮出水面(授权、认证、路由等)，ASP.NET 6和极简API将这些功能轻而易举地发挥出来，非常适合以可维护的方式及时创建轻量级微服务。</p><h1 id="a9dd" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">资源</h1><ul class=""><li id="2925" class="ks kt hi is b it kn ix ko jb ku jf kv jj kw jn kx ky kz la bi translated">本教程的代码可以在GitHub 上找到</li><li id="62a1" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated">微软<a class="ae jo" href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/minimal-apis?view=aspnetcore-6.0" rel="noopener ugc nofollow" target="_blank">最小API概述</a></li><li id="c1be" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated">大卫·福勒的要点<a class="ae jo" href="https://gist.github.com/davidfowl/ff1addd02d239d2d26f4648a06158727" rel="noopener ugc nofollow" target="_blank">最小API一览</a></li><li id="9df3" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated">什么人在<a class="ae jo" href="https://twitter.com/hashtag/minimalapis" rel="noopener ugc nofollow" target="_blank">推特上谈论最小API</a></li><li id="d410" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated"><a class="ae jo" href="https://www.vonage.co.uk/communications-apis/sms/" rel="noopener ugc nofollow" target="_blank"> Vonage短信API </a></li></ul></div><div class="ab cl lr ls gp lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="hb hc hd he hf"><p id="9545" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="ly">最初发布于</em><a class="ae jo" href="https://learn.vonage.com/blog/2021/11/09/how-to-send-an-sms-with-net-6-minimal-api/" rel="noopener ugc nofollow" target="_blank"><em class="ly">https://learn . vonage . com/blog/2021/11/09/how-to-send-an-SMS-with-net-6-minimal-API/</em></a></p></div></div>    
</body>
</html>