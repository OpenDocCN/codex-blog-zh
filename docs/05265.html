<html>
<head>
<title>Caching — Basic concept for next-level developers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">缓存——下一级开发人员的基本概念</h1>
<blockquote>原文：<a href="https://medium.com/codex/caching-basic-concept-for-next-level-developers-889dd85ee6eb?source=collection_archive---------3-----------------------#2022-02-13">https://medium.com/codex/caching-basic-concept-for-next-level-developers-889dd85ee6eb?source=collection_archive---------3-----------------------#2022-02-13</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="21e4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">缓存在拥有数百万用户的大型(和小型)系统的成功中扮演着重要的角色。这是一种技术或技能或任何你想称之为的东西，每一个开发者从后端到前端，从网络到移动，或从ML/AI、区块链等新领域。应该意识到。在某种程度上，对于任何系统，总有某些组件在进行缓存。这可能出现在像CPU的L1高速缓冲存储器这样的小东西中，也可能出现在像CDN这样的大型系统中，该系统广泛用于部署高流量需求的网站。</p><p id="1f97" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于那些希望自己的背景更上一层楼的人来说，在谷歌上搜索数百万条结果只会让他们更快地放弃。你在哪里，你的水平如何，应该研究哪种类型的缓存，希望你能在这个系列中找到这些问题的答案。</p></div><div class="ab cl jd je gp jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="hb hc hd he hf"><h1 id="47cc" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">0级—基本概念</h1><p id="a21b" class="pw-post-body-paragraph if ig hi ih b ii ki ik il im kj io ip iq kk is it iu kl iw ix iy km ja jb jc hb bi translated">不管是什么，这些是其中的基本原则:</p><ul class=""><li id="8cd8" class="kn ko hi ih b ii ij im in iq kp iu kq iy kr jc ks kt ku kv bi translated">缓存就是保存/存档/ <strong class="ih hj">存储</strong>(你可以说出来)一个<strong class="ih hj">耗时动作</strong>的结果，以便让它更快地恢复(以便<strong class="ih hj">重用</strong>)。IMHO，这是对缓存最好的解释。如果不了解这个原理，就很容易不知所措，甚至把缓存误解为Redis(？？？)，RAM(？？？).只要把粗体字记在心里，就没问题了。</li><li id="f490" class="kn ko hi ih b ii kw im kx iq ky iu kz iy la jc ks kt ku kv bi translated">通常以键值的格式表示(因为在键值数据结构中查找数据只需要O(1))。我敢打赌，您知道代码、键值数据库(Redis、Memcache)或文件(以名称作为键)中的hashmap。</li><li id="af6c" class="kn ko hi ih b ii kw im kx iq ky iu kz iy la jc ks kt ku kv bi translated">缓存的基本操作是获取(通过键)、设置(通过键)和删除(通过键)</li><li id="03e7" class="kn ko hi ih b ii kw im kx iq ky iu kz iy la jc ks kt ku kv bi translated">一个值通常与一个名为TTL(生存时间)的参数一起存储在缓存中。此参数指示从高速缓存中删除值以刷新高速缓存并释放高速缓存大小的到期时间。</li><li id="3da4" class="kn ko hi ih b ii kw im kx iq ky iu kz iy la jc ks kt ku kv bi translated">缓存的一个常见问题是<strong class="ih hj">过时数据</strong>，即数据与原始数据不一致。</li></ul><p id="e36b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们需要考虑以下因素来决定是否需要缓存:</p><ul class=""><li id="232d" class="kn ko hi ih b ii ij im in iq kp iu kq iy kr jc ks kt ku kv bi translated">时间或资源消耗</li><li id="6ec1" class="kn ko hi ih b ii kw im kx iq ky iu kz iy la jc ks kt ku kv bi translated">结果可以重复使用多次</li></ul><p id="c730" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在做任何决定之前，记住这两点。举个例子，</p><ul class=""><li id="5fc9" class="kn ko hi ih b ii ij im in iq kp iu kq iy kr jc ks kt ku kv bi translated">从数据库中获取数据需要500毫秒，但是对于来自一个没有人感兴趣的网页的一个请求=&gt; <strong class="ih hj">还没有缓存</strong></li><li id="e99d" class="kn ko hi ih b ii kw im kx iq ky iu kz iy la jc ks kt ku kv bi translated">构建一个CSS代码需要100ms，但是所有用户都需要加载= &gt;是的，<strong class="ih hj">你需要它。</strong></li></ul><h2 id="a186" class="lb jl hi bd jm lc ld le jq lf lg lh ju iq li lj jy iu lk ll kc iy lm ln kg lo bi translated"><strong class="ak">大图</strong></h2><figure class="lq lr ls lt fd lu er es paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="er es lp"><img src="../Images/e39d5694f3f4582e07a0430835dd9337.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*4d1YggkBRLO0slrL.png"/></div></div><figcaption class="mb mc et er es md me bd b be z dx translated">典型的支持缓存的系统</figcaption></figure><p id="6943" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如您所见，一个常见的应用程序有4个主要层:客户端、代理、应用程序和数据库。每一层都有相应的缓存系统，我们可以监控不同的级别。请注意，在操作系统/内核级别有一个缓存层，这超出了我们(应用程序开发人员)的范围。</p><p id="70c4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">客户端</strong>:这一层实际上来自终端用户设备，即手机app、浏览器。这里，缓存只有一个目标——提高用户体验的质量。因此，应该缓存什么以及缓存多长时间的问题是为了改善用户体验，而不是系统。</p><p id="2900" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这一层，我们可以通过以下方式在一定程度上控制缓存</p><ul class=""><li id="3f68" class="kn ko hi ih b ii ij im in iq kp iu kq iy kr jc ks kt ku kv bi translated">设置HTTP头以控制请求的缓存(不确定)</li><li id="8cb5" class="kn ko hi ih b ii kw im kx iq ky iu kz iy la jc ks kt ku kv bi translated">配置库的缓存HTTP请求</li><li id="1395" class="kn ko hi ih b ii kw im kx iq ky iu kz iy la jc ks kt ku kv bi translated">使用本地存储实现缓存</li></ul><p id="0d4c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请注意，任何对缓存的调用都可能会耗费时间/资源，并且很难排除故障。</p><p id="0161" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">代理</strong>:在最终用户的请求到达应用程序之前，这些被认为是中间层。它们可以是CDN、反向代理、网关等。这一层的缓存主要是针对大量用户的静态内容。</p><p id="da76" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这一层，我们可以通过以下方式管理缓存</p><ul class=""><li id="7016" class="kn ko hi ih b ii ij im in iq kp iu kq iy kr jc ks kt ku kv bi translated">设置HTTP头以控制请求的缓存</li><li id="032a" class="kn ko hi ih b ii kw im kx iq ky iu kz iy la jc ks kt ku kv bi translated">在中间服务器上配置缓存HTTP请求。</li></ul><p id="dd06" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">虽然可以从缓存中自动获取数据，但这需要时间，并且在出现问题时依赖于第三方。</p><p id="f6ab" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">应用</strong>:对，应用缓存。它适用于来自大量用户的动态内容。</p><p id="35ee" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们通过以下方式完全控制缓存</p><ul class=""><li id="a0c5" class="kn ko hi ih b ii ij im in iq kp iu kq iy kr jc ks kt ku kv bi translated">配置现有插件或插件</li><li id="918f" class="kn ko hi ih b ii kw im kx iq ky iu kz iy la jc ks kt ku kv bi translated">甚至从头开始实施</li></ul><p id="80d1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过完全控制，我的意思是我们可以决定缓存什么，在哪里，因此有知识来修改，定制以及故障排除。这一层的缓存对最终用户是透明的，并且不太依赖第三方。</p><p id="9a92" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">数据库</strong>:用于检索数据。</p><p id="c791" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">作为数据库用户，数据库实际上是一个黑盒，并根据提供者推荐的参数进行优化。您可以做的包括:</p><ul class=""><li id="9614" class="kn ko hi ih b ii ij im in iq kp iu kq iy kr jc ks kt ku kv bi translated">配置查询缓存</li><li id="19c8" class="kn ko hi ih b ii kw im kx iq ky iu kz iy la jc ks kt ku kv bi translated">配置内存使用</li></ul><p id="b228" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> OS/Kernel </strong>:这一层驻留在整个系统的任何地方，用于数据处理操作。</p><p id="7849" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通常，作为开发人员，我们无法控制操作系统如何使用内存来缓存东西。优化操作系统/内核缓存与微优化有关，在大多数情况下，我们并不真正关心。</p></div><div class="ab cl jd je gp jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="hb hc hd he hf"><h1 id="9150" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">第1级:具有单个服务器的整体网页</h1><p id="1617" class="pw-post-body-paragraph if ig hi ih b ii ki ik il im kj io ip iq kk is it iu kl iw ix iy km ja jb jc hb bi translated">或许，您可能像我一样，从老派的应用程序开始您的旅程:单块的，在单个服务器上运行，呈现HTML数据，等等。让我们回顾一下这一级别的一些要求:</p><ul class=""><li id="150b" class="kn ko hi ih b ii ij im in iq kp iu kq iy kr jc ks kt ku kv bi translated">主要是新闻、帖子、支持CRUD的应用程序，它们可以通过使用WordPress、Joomla等框架自行实现或部署。</li><li id="dfaf" class="kn ko hi ih b ii kw im kx iq ky iu kz iy la jc ks kt ku kv bi translated">HTML和数据是从web服务器呈现的，而不是使用React或Vue这样的新型JS框架。</li><li id="b12e" class="kn ko hi ih b ii kw im kx iq ky iu kz iy la jc ks kt ku kv bi translated">HTML模板，静态JS，CSS存储在DB中或使用视图引擎。</li><li id="5c90" class="kn ko hi ih b ii kw im kx iq ky iu kz iy la jc ks kt ku kv bi translated">通常是现有的系统，因此重用现有的东西，即代码，并减少系统修改是很重要的。</li><li id="c4ca" class="kn ko hi ih b ii kw im kx iq ky iu kz iy la jc ks kt ku kv bi translated">关注单个用户的体验，而不是扩展系统。</li><li id="6ffe" class="kn ko hi ih b ii kw im kx iq ky iu kz iy la jc ks kt ku kv bi translated">少量数据</li></ul><p id="6008" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以下是降低应用程序速度的因素</p><ul class=""><li id="3535" class="kn ko hi ih b ii ij im in iq kp iu kq iy kr jc ks kt ku kv bi translated">在对数据库运行10–50次查询后，可以呈现一个HTML页面，延迟时间为2–3秒。</li><li id="009e" class="kn ko hi ih b ii kw im kx iq ky iu kz iy la jc ks kt ku kv bi translated">加载图像、视频等媒体数据需要时间，因此页面会“空白”大约2-10秒。</li></ul><p id="f428" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我在下图中突出显示了可以优化的项目。</p><figure class="lq lr ls lt fd lu er es paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="er es mf"><img src="../Images/554ed02ad6d8b4cd49603217034894cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*1IrFb_O0o9VOklaU.png"/></div></div></figure><p id="6ef0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">具体来说，</p><figure class="lq lr ls lt fd lu er es paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="er es mg"><img src="../Images/e440a4d7d9264ca0dd86f60302bc3d81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*vX03PWwsrN_3ysff.png"/></div></div></figure><p id="b9b5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 1。启用数据库中的查询缓存</strong></p><p id="baa6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">像MySQL、PostgreSQL这样的RDBMS数据库提供了一种内置机制来缓存查询结果，并且可以作为一种配置来启用。你可以用谷歌搜索每种类型的数据库缓存，比如说<strong class="ih hj"> &lt; db-name &gt; cache。</strong></p><p id="8e12" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这一级别的应用程序中，不仅在不同用户的请求之间，而且在单个用户请求的单个页面的不同部分之间，查询都被高度重用。这可以使用数据库的查询缓存机制来管理。</p><p id="b97b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">考虑数据库缓存的另一个因素是您的数据大小。如果它很小，并且可以完全驻留在数据库的RAM中，那么查询缓存就足够了。</p><p id="922b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如，要启用MySQL缓存:</p><blockquote class="mh mi mj"><p id="0c3a" class="if ig mk ih b ii ij ik il im in io ip ml ir is it mm iv iw ix mn iz ja jb jc hb bi translated">Maria db[(none)]&gt; SET GLOBAL query _ cache _ type = 1；查询正常，0行受影响(0.00秒)</p></blockquote><p id="3880" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 2。按文件启用缓存CSS、js、HTML模板</strong></p><p id="4b41" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用文件作为包含从数据库渲染的数据的零件的缓存。</p><p id="2f07" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">优点:</strong></p><ul class=""><li id="0b25" class="kn ko hi ih b ii ij im in iq kp iu kq iy kr jc ks kt ku kv bi translated">没有依赖性，可以在任何应用程序上完成。</li><li id="68df" class="kn ko hi ih b ii kw im kx iq ky iu kz iy la jc ks kt ku kv bi translated">由WordPress或Xenforo等框架完全支持，以加速页面加载。你需要的只是启用它，这很容易做到。</li></ul><p id="8abc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 3。通过文件缓存整个HTML页面或部分页面</strong></p><p id="ddb4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">WordPress，Xenforo都有插件来做这个。使用视图引擎的框架也支持HTML格式的缓存结果。</p><blockquote class="mh mi mj"><p id="982a" class="if ig mk ih b ii ij ik il im in io ip ml ir is it mm iv iw ix mn iz ja jb jc hb bi translated">常见的误解是低估了使用文件缓存的重要性，认为磁盘IO很慢(比如，与Redis相比)。记住，如果Redis运行在它自己的服务器上，那么那将是在<strong class="ih hj">磁盘IO本地文件</strong>和<strong class="ih hj">到服务器redis </strong>的网络通信之间(不是磁盘IO对内存)。</p></blockquote><p id="bc7d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如，在Laravel中缓存整页的方法如下:</p><figure class="lq lr ls lt fd lu"><div class="bz dy l di"><div class="mo mp l"/></div></figure><p id="ccd4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 4。使用CDN提供媒体服务</strong></p><p id="58c3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以将视频、图像等媒体文件上传到CDN(内容交付网络)上。CDN基本上是一个根据地理位置的缓存系统，使美国或越南的用户能够以低延迟访问这些媒体文件。这些因素会显著影响用户的应用体验，因此需要从一开始就单独考虑。</p><p id="2774" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了将CDN用于媒体内容，您需要:</p><ul class=""><li id="ba00" class="kn ko hi ih b ii ij im in iq kp iu kq iy kr jc ks kt ku kv bi translated">将媒体文件上传到单独的系统或使用不同的路由到不同的域。一种选择是将它们部署在AWS S3上。</li><li id="da0c" class="kn ko hi ih b ii kw im kx iq ky iu kz iy la jc ks kt ku kv bi translated">配置CDN，即Cloudflare，以提供媒体文件</li></ul><p id="7633" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有很多类似S3的存储提供商供你选择，比如AWS、GCP、数字海洋。</p></div><div class="ab cl jd je gp jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="hb hc hd he hf"><h1 id="778c" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">第2级:具有多个服务器的整体网页</h1><p id="1101" class="pw-post-body-paragraph if ig hi ih b ii ki ik il im kj io ip iq kk is it iu kl iw ix iy km ja jb jc hb bi translated">在这个级别上，您可能会看到系统中有多个服务器，并且相同类型的应用程序有更多的流量负载。现在，缓存还需要提高系统的响应能力，同时可以将页面加载时间减少到比级别1稍低一点。</p><p id="9dfc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这些应用程序的一些共同特征包括:</p><ul class=""><li id="d573" class="kn ko hi ih b ii ij im in iq kp iu kq iy kr jc ks kt ku kv bi translated">运行在多个服务器上，因此需要考虑使用缓存导致的数据差异。</li><li id="42e7" class="kn ko hi ih b ii kw im kx iq ky iu kz iy la jc ks kt ku kv bi translated">高流量负载要求集中缓存整个页面，以减少应用程序和数据库层的负载。</li><li id="85d5" class="kn ko hi ih b ii kw im kx iq ky iu kz iy la jc ks kt ku kv bi translated">对于一个没有很好配置的数据库，有大量的数据</li><li id="2a56" class="kn ko hi ih b ii kw im kx iq ky iu kz iy la jc ks kt ku kv bi translated">代理或负载平衡器的存在。</li></ul><figure class="lq lr ls lt fd lu er es paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="er es mf"><img src="../Images/6ff9ad9c041c346f1ab5af14aba037e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Vb2k7TkEKNtzjtrY.png"/></div></div></figure><p id="5c35" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">具体来说，</p><figure class="lq lr ls lt fd lu er es paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="er es mq"><img src="../Images/d2acb765b290bc6a8c9e0949f9cb63d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*HXeLUEWtaFr66-te.png"/></div></div></figure><p id="0b5e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 1。使用第三存储缓存数据对象và HTML模板</strong></p><p id="20bf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">数据库的查询缓存有锁定限制，会降低整个数据库系统的性能。因此，我们从数据库中移出，在应用层对数据进行缓存。由于应用程序在多个服务器上运行，我们通过使用共享缓存系统更加重视数据完整性。特别是，我们在单独的服务器上使用Redis/Memcache，而不是在每台服务器上运行缓存文件。</p><p id="6bb3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们专注于缓存</p><ul class=""><li id="b247" class="kn ko hi ih b ii ij im in iq kp iu kq iy kr jc ks kt ku kv bi translated">HTML模板(用于基于模板的系统，如Laravel blade)</li><li id="9b9e" class="kn ko hi ih b ii kw im kx iq ky iu kz iy la jc ks kt ku kv bi translated">数据对象，即查询结果、HTTP结果</li></ul><blockquote class="mh mi mj"><p id="e365" class="if ig mk ih b ii ij ik il im in io ip ml ir is it mm iv iw ix mn iz ja jb jc hb bi translated">如果我的应用程序中有很多这样的对象，我应该缓存哪些对象？考虑前面提到的两个问题来决定:I)时间或资源消耗，以及ii)结果可以重复使用多次。</p></blockquote><p id="df88" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">示例:</p><figure class="lq lr ls lt fd lu"><div class="bz dy l di"><div class="mo mp l"/></div></figure><p id="10fb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 2。使用内存的缓存操作码</strong></p><p id="bc23" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这仅适用于像PHP这样的解释型语言。启用缓存操作代码可以显著提高具有大型代码库的应用程序的性能，并且可以减少发送请求的时间。</p><p id="195f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可以用关键字“opcache”来搜索这个选项。</p><p id="eecc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 3。使用CDN缓存静态资产</strong></p><p id="b4fd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将CDN用于静态内容，如CSS、JS、字体等。为此，我们需要:</p><ul class=""><li id="52af" class="kn ko hi ih b ii ij im in iq kp iu kq iy kr jc ks kt ku kv bi translated">将CSS、JS从动态内容分离到静态文件中</li><li id="635d" class="kn ko hi ih b ii kw im kx iq ky iu kz iy la jc ks kt ku kv bi translated">通过querystring，file hash等实现CSS，JS失效的机制。如果需要的话。</li><li id="a7a2" class="kn ko hi ih b ii kw im kx iq ky iu kz iy la jc ks kt ku kv bi translated">配置CDN为静态文件服务。</li></ul><p id="2a7a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 3。在反向代理上缓存整个页面</strong></p><p id="ae4f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们使用反向代理如Nginx，HAproxy来缓存整个HTML页面。我们所做的是</p><ul class=""><li id="6abe" class="kn ko hi ih b ii ij im in iq kp iu kq iy kr jc ks kt ku kv bi translated">确定哪个部分对所有用户是静态的，哪个部分对每个用户是动态的。动态的可以用AJAX调用，静态的完全缓存。</li><li id="df3f" class="kn ko hi ih b ii kw im kx iq ky iu kz iy la jc ks kt ku kv bi translated">配置反向代理以缓存HTML响应。</li></ul><p id="1080" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该解决方案在代理层阻止了来自最终用户的请求，并减少了应用程序的负载。对于基于posts的系统来说，这是一种重要而有效的方法，因为它既能改善用户体验，又能对大量流量做出响应。</p><p id="9ff4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用Nginx配置缓存的示例</p><figure class="lq lr ls lt fd lu"><div class="bz dy l di"><div class="mo mp l"/></div></figure><h1 id="fa3e" class="jk jl hi bd jm jn mr jp jq jr ms jt ju jv mt jx jy jz mu kb kc kd mv kf kg kh bi translated">结论</h1><p id="c9cf" class="pw-post-body-paragraph if ig hi ih b ii ki ik il im kj io ip iq kk is it iu kl iw ix iy km ja jb jc hb bi translated">我就写到这里吧，这样你就能有时间消化一下了。当实现一个大规模系统时，我会用另外2到3个级别的缓存来回答你。</p><h1 id="6c6d" class="jk jl hi bd jm jn mr jp jq jr ms jt ju jv mt jx jy jz mu kb kc kd mv kf kg kh bi translated">承认</h1><p id="a5cf" class="pw-post-body-paragraph if ig hi ih b ii ki ik il im kj io ip iq kk is it iu kl iw ix iy km ja jb jc hb bi translated">我想对光明(又名明孟门)允许翻译他的<a class="ae mw" href="https://viblo.asia/p/caching-dai-phap-1-nac-thang-len-level-cua-developer-V3m5WdO8KO7" rel="noopener ugc nofollow" target="_blank">原文</a>表示我的感谢。</p></div></div>    
</body>
</html>