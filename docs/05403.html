<html>
<head>
<title>Visualizing Gapminder Data Using Bokeh</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用散景可视化Gapminder数据</h1>
<blockquote>原文：<a href="https://medium.com/codex/visualizing-gapminder-data-using-bokeh-1aeeb7c85e6d?source=collection_archive---------2-----------------------#2022-02-25">https://medium.com/codex/visualizing-gapminder-data-using-bokeh-1aeeb7c85e6d?source=collection_archive---------2-----------------------#2022-02-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="3e2d" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">在Python中创建交互式数据可视化</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/6ddd1fc18bdcd3ff347bb3dcb18cfafc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*itp3YnTHLh4xy3ur"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">由<a class="ae jn" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae jn" href="https://unsplash.com/@hikmethl?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">希克迈特</a>拍摄的照片</figcaption></figure><p id="3be7" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">作为一个处理数据的人，你很可能熟悉已故的汉斯·罗斯林和他在Gapminder的工作。他的演讲很吸引人，使用散点图等可视化方式来讲述一个故事。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="kk kl l"/></div></figure><p id="5312" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">如果您使用Python处理数据，您可能已经使用matplotlib或seaborn进行了数据可视化。它在大多数情况下完成了工作，但有时你想要一个互动的情节，而不是静态的。这就是散景发挥作用的地方。</p><p id="de8d" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">根据<a class="ae jn" href="https://bokeh.org/" rel="noopener ugc nofollow" target="_blank">的散景文档</a>，它自诩为灵活、互动、可共享、高效、强大和开源。你可以用它做一个简单的可视化或者一个更复杂的可视化，通过利用散景服务器，你将能够进行交互式可视化，接近汉斯·罗斯林的演示(好吧，这篇文章不会给你完全相同的杰作，但概念是存在的)。</p><p id="29d4" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我们的目标是做一个交互式的可视化，你可以看到不同的国家是如何随着时间的推移通过播放按钮和滑块，以及可修改的x轴和y轴取得进展的。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es km"><img src="../Images/7ae8366bbf7aa37919c239256fddf500.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_MTzI4yw76NvWxEI44Z27w.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">最终目标(图片由作者提供)</figcaption></figure></div><div class="ab cl kn ko gp kp" role="separator"><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks"/></div><div class="hb hc hd he hf"><h2 id="fba3" class="ku kv hi bd kw kx ky kz la lb lc ld le jx lf lg lh kb li lj lk kf ll lm ln lo bi translated">创建基础图</h2><p id="94ec" class="pw-post-body-paragraph jo jp hi jq b jr lp ij jt ju lq im jw jx lr jz ka kb ls kd ke kf lt kh ki kj hb bi translated">在我们开始之前，你可以在这里下载数据集。此外，请确定您的电脑中已经安装了散景。如果没有，您可以使用pip安装它:</p><pre class="iy iz ja jb fd lu lv lw lx aw ly bi"><span id="5d28" class="ku kv hi lv b fi lz ma l mb mc">pip install bokeh</span></pre><p id="1aab" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">现在我们已经安装了散景，我们将从一个基本的静态图开始。首先，我们从Bokeh和pandas导入所需的包，然后导入数据。</p><p id="0821" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">然后，我们定义绘图轴和轴标签。我为轴标签使用了一个字典，这样当我们更新轴时，它将提供清晰的标签。我们使用<em class="md"> ColumnDataSource </em>为散景图提供数据源，并使用<em class="md"> CategoricalColorMapper </em>使用<em class="md"> Spectral6 </em>调色板对不同的地理区域进行颜色编码。</p><p id="74d4" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">然后我们制作<em class="md">图</em>并使用<em class="md"> plot.circle()制作散点图。</em>我们使用生育率作为x轴，预期寿命作为y轴，人口作为点大小(我使用pop_size，以便点适合绘图)。然后，我们使用<em class="md"> output_file() </em>将绘图保存为. html文件，并使用<em class="md"> show(plot) </em>来显示绘图。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="me kl l"/></div></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mf"><img src="../Images/c5dffb9b1213d050b385edef2adf2171.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YIYXzKRI01hsDivxSysoiw.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">基本情节(作者提供的图片)</figcaption></figure></div><div class="ab cl kn ko gp kp" role="separator"><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks"/></div><div class="hb hc hd he hf"><h2 id="19aa" class="ku kv hi bd kw kx ky kz la lb lc ld le jx lf lg lh kb li lj lk kf ll lm ln lo bi translated">添加悬停工具提示</h2><p id="de92" class="pw-post-body-paragraph jo jp hi jq b jr lp ij jt ju lq im jw jx lr jz ka kb ls kd ke kf lt kh ki kj hb bi translated">散景允许您添加悬停工具提示，当您悬停在数据点上时提供额外的信息。要添加一个悬停工具提示，导入<em class="md"> HoverTool </em>并用你想要的信息初始化它。参数<em class="md">工具提示</em>接受一个元组列表作为输入，标签在左边，数据在右边。与<em class="md">图</em>一样，数据源定义在<em class="md">列数据源</em>上。最后，使用<em class="md"> plot.add_tools() </em>将刚刚制作的悬停工具提示添加到图形中。确保在 <em class="md"> output_file() </em>和<em class="md"> show(plot) </em>之前添加此代码<strong class="jq hj">。</strong></p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="me kl l"/></div></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mg"><img src="../Images/3ec4df5a867128e55978c2936823696a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1106/1*eLXIdoF-uDePyAEDpgaB5w.gif"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">使用中的HoverTool(图片由作者提供)</figcaption></figure></div><div class="ab cl kn ko gp kp" role="separator"><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks"/></div><div class="hb hc hd he hf"><h2 id="6753" class="ku kv hi bd kw kx ky kz la lb lc ld le jx lf lg lh kb li lj lk kf ll lm ln lo bi translated">添加滑块和下拉菜单</h2><p id="21f8" class="pw-post-body-paragraph jo jp hi jq b jr lp ij jt ju lq im jw jx lr jz ka kb ls kd ke kf lt kh ki kj hb bi translated">为了使绘图具有交互性，散景也允许你添加滑块和下拉菜单。为此，我们从散景导入更多的库。要添加滑块，我们使用<em class="md">滑块</em>并为其指定参数。要添加下拉菜单，我们使用<em class="md">选择</em>并输入可能的下拉选项列表，给出默认值和标题。当我们移动滑块或使用下拉菜单时，为了使图形更新，我们使用<em class="md">。</em>on _ change()【法。这是一个更新绘图的回调方法，它将函数<em class="md"> update_plot() </em>作为参数。稍后将详细介绍。</p><p id="5ad8" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我们还需要为我们的地块创建一个布局。使用<em class="md">列</em>和<em class="md">行</em>，我们设计我们地块的布局。最后，我们使用<em class="md">show(layout)</em>代替<em class="md"> show(plot) </em>来显示布局(而不是情节)。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="me kl l"/></div></figure><p id="b631" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在我们继续之前，我们必须为我们的回调方法定义函数<em class="md"> update_plot() </em>。该函数的作用是从滑块和下拉菜单中获取新值，并将其设置为绘图的数据源。我们还通过删除和添加新创建的悬停工具来更新悬停工具。将悬停工具定义为<em class="md">全局</em>对于该函数的工作很重要，因为最初的悬停工具是在该函数之外定义的。记得把这个函数<strong class="jq hj">放在前一个代码</strong>之前。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="me kl l"/></div></figure><p id="f4a9" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在实现了这段代码之后，我们将在图的左侧得到这个带有滑块和下拉菜单的漂亮布局。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mh"><img src="../Images/95f998af9194b399e114b2c3f5324562.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JvMvgIRIxv9WFzxOwMdKNA.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">带有滑块和下拉菜单的绘图(图片由作者提供)</figcaption></figure></div><div class="ab cl kn ko gp kp" role="separator"><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks"/></div><div class="hb hc hd he hf"><h2 id="c85d" class="ku kv hi bd kw kx ky kz la lb lc ld le jx lf lg lh kb li lj lk kf ll lm ln lo bi translated">在散景服务器上运行</h2><p id="c6ce" class="pw-post-body-paragraph jo jp hi jq b jr lp ij jt ju lq im jw jx lr jz ka kb ls kd ke kf lt kh ki kj hb bi translated">您可能会注意到，当您使用滑块或下拉菜单时，图不会更新。这是因为<em class="md"> show(layout) </em>只会显示一个静态的剧情。我们需要在散景服务器上运行代码，使其具有交互性。为此，我们首先需要用下面的代码使用<em class="md"> curdoc </em>而不是<em class="md"> show(layout) </em>。</p><pre class="iy iz ja jb fd lu lv lw lx aw ly bi"><span id="8fa5" class="ku kv hi lv b fi lz ma l mb mc"># Import curdoc<br/>from bokeh.io import curdoc</span><span id="e4cf" class="ku kv hi lv b fi mi ma l mb mc"># Replace output_file and show(layout) with this<br/>curdoc().add_root(layout)<br/>curdoc().title = 'Gapminder'</span></pre><p id="2b82" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">然后我们在终端上运行这段bash代码(添加<em class="md">！</em>如果你在Python笔记本上运行代码的话，在开始的时候)。确保您已经保存了文件，您的终端在正确的目录中，并且您的文件名是正确的。对我来说，文件名是<em class="md">gapminder _ bokehserver . ipynb .</em></p><pre class="iy iz ja jb fd lu lv lw lx aw ly bi"><span id="0760" class="ku kv hi lv b fi lz ma l mb mc">bokeh serve --show gapminder_bokehserver.ipynb</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mj"><img src="../Images/53b465e223be11c045afededaaa362e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1070/1*wv6m5_Z9baJmM4dFVaONFQ.gif"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">滑块和下拉菜单的作用(图片由作者提供)</figcaption></figure></div><div class="ab cl kn ko gp kp" role="separator"><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks"/></div><div class="hb hc hd he hf"><h2 id="acc1" class="ku kv hi bd kw kx ky kz la lb lc ld le jx lf lg lh kb li lj lk kf ll lm ln lo bi translated">添加播放按钮</h2><p id="89bb" class="pw-post-body-paragraph jo jp hi jq b jr lp ij jt ju lq im jw jx lr jz ka kb ls kd ke kf lt kh ki kj hb bi translated">虽然前一步已经足够好了，但我决定再进一步，添加一个播放按钮，它将与滑块进行交互，以便数据在这些年中自动流动。一旦播放，播放按钮将变成暂停按钮来停止流动。为此，我们使用<em class="md">按钮</em>并设置标签和宽度。</p><p id="4b70" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">滑块和下拉菜单也是如此，我们需要为带有<em class="md">按钮的按钮添加一个回调方法。这有点棘手，所以请耐心等待。</em></p><p id="5e8d" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">就在<em class="md"> animate() </em>函数之前，我们定义了一个空的<em class="md">回调_animate </em>变量。我们通过调用<em class="md">全局回调_animate </em>在<em class="md"> animate() </em>函数中使用这个新定义的变量。我们使用条件语句在播放和暂停按钮之间切换。在<em class="md"> if </em>语句中，我们将<em class="md"> callback_animate </em>定义为另一个回调方法来触发<em class="md"> animate_update() </em>，这将更新滑块，进而更新绘图。在<em class="md"> else </em>语句中，我们移除回调，以便滑块停止更新。对于为什么我们必须定义一个空变量，然后在函数内部全局调用它，我没有一个好的答案，但是这是唯一对我有效的方法。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="me kl l"/></div></figure><p id="9024" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">然后我们更新布局以包含新创建的按钮。</p><pre class="iy iz ja jb fd lu lv lw lx aw ly bi"><span id="eec4" class="ku kv hi lv b fi lz ma l mb mc">layout = row(column(slider, button, x_select, y_select), plot)</span></pre><p id="6cce" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">最后，我们再次在散景服务器上运行这段代码。</p><pre class="iy iz ja jb fd lu lv lw lx aw ly bi"><span id="737f" class="ku kv hi lv b fi lz ma l mb mc">bokeh serve --show gapminder_bokehserver.ipynb</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mk"><img src="../Images/49fdac2c3072033d16c7f8b56beb7225.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*0Lu1jf-QtIWnUx0VcvgQYw.gif"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">最终结果(图片由作者提供)</figcaption></figure></div><div class="ab cl kn ko gp kp" role="separator"><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks"/></div><div class="hb hc hd he hf"><p id="a1b1" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我希望你觉得这很有用。对我来说，使用散景比matplotlib或seaborn更有挑战性。但散景提供的交互性确实让这个情节比静态情节突出。你可以在我的<a class="ae jn" href="https://github.com/abrahamzetz/gapminder_bokeh" rel="noopener ugc nofollow" target="_blank"> GitHub库</a>上找到完整的代码。</p><p id="3341" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">干杯！</p></div></div>    
</body>
</html>