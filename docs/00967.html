<html>
<head>
<title>Bootstrapping AWS EC2 instance to update packages, install and start Apache HTTP Server</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">引导AWS EC2实例来更新包、安装和启动Apache HTTP Server</h1>
<blockquote>原文：<a href="https://medium.com/codex/bootstrapping-aws-ec2-instance-to-update-packages-install-and-start-apache-http-server-f68fe1fe33ba?source=collection_archive---------0-----------------------#2021-03-28">https://medium.com/codex/bootstrapping-aws-ec2-instance-to-update-packages-install-and-start-apache-http-server-f68fe1fe33ba?source=collection_archive---------0-----------------------#2021-03-28</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><h2 id="472c" class="hg hh hi bd b fp hj hk hl hm hn ho dx hp translated" aria-label="kicker paragraph"><a class="ae ge" href="http://medium.com/codex" rel="noopener">法典</a></h2><div class=""/><p id="b000" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">AWS中的Bootstrapping仅仅意味着向<strong class="iq hs"> AWS EC2的实例用户数据</strong>部分添加命令或脚本，这些命令或脚本可以在实例启动时执行。采用这种方法来简化配置任务是一种很好的自动化实践。</p><h1 id="0086" class="jm jn hi bd jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj bi translated">教程目标</h1><ul class=""><li id="9e7e" class="kk kl hi iq b ir km iv kn iz ko jd kp jh kq jl kr ks kt ku bi translated">使用AWS管理控制台创建AWS EC2实例。</li><li id="e04f" class="kk kl hi iq b ir kv iv kw iz kx jd ky jh kz jl kr ks kt ku bi translated">使用Bash命令引导AWS EC2。</li><li id="a93b" class="kk kl hi iq b ir kv iv kw iz kx jd ky jh kz jl kr ks kt ku bi translated">了解如何查看引导命令的结果。</li></ul><p id="cc84" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">下图描绘了完成本教程后我们将完成的任务。</p><figure class="lb lc ld le fd lf er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es la"><img src="../Images/e646fe632cb269f2496604a2253c1269.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t5XthZnh0MZx7M3gqu-v-A.png"/></div></div><figcaption class="lm ln et er es lo lp bd b be z dx translated">引导代码和AWS EC2实例架构</figcaption></figure><h1 id="1a18" class="jm jn hi bd jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj bi translated">这是你需要的东西</h1><ul class=""><li id="d1fe" class="kk kl hi iq b ir km iv kn iz ko jd kp jh kq jl kr ks kt ku bi translated">具有管理员访问权限的AWS帐户用户。如果您还没有帐户，请不要担心，请先注册一个<a class="ae lq" href="http://aws.amazon.com/free" rel="noopener ugc nofollow" target="_blank"> AWS自由层帐户</a>，然后再继续。</li></ul><h1 id="0d57" class="jm jn hi bd jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj bi translated">使用Bootstrap命令启动EC2实例</h1><p id="52d9" class="pw-post-body-paragraph io ip hi iq b ir km it iu iv kn ix iy iz lr jb jc jd ls jf jg jh lt jj jk jl hb bi translated">在本节中，我们将使用AWS管理控制台创建一个AWS EC2实例，并在<strong class="iq hs">用户数据</strong>部分添加命令来更新所有包，安装并启动Apache HTTP Server。</p><ol class=""><li id="b703" class="kk kl hi iq b ir is iv iw iz lu jd lv jh lw jl lx ks kt ku bi translated">登录AWS管理<a class="ae lq" href="https://console.aws.amazon.com/console" rel="noopener ugc nofollow" target="_blank">控制台</a>。</li><li id="168e" class="kk kl hi iq b ir kv iv kw iz kx jd ky jh kz jl lx ks kt ku bi translated">在右侧的<strong class="iq hs">顶部导航</strong>中，选择您想要安装该实例的区域。我将使用<strong class="iq hs"> <em class="ly"> N. Virginia </em> </strong>地区。</li></ol><figure class="lb lc ld le fd lf er es paragraph-image"><div class="er es lz"><img src="../Images/4591f62ccb33d22735c3adb7d625b986.png" data-original-src="https://miro.medium.com/v2/resize:fit:962/format:webp/1*fPyQdNGsuc9vkEcZnYKQbg.png"/></div><figcaption class="lm ln et er es lo lp bd b be z dx translated">选择正确的区域</figcaption></figure><p id="33de" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">3.有多种方法可以找到<strong class="iq hs"> EC2服务</strong>:</p><ul class=""><li id="e479" class="kk kl hi iq b ir is iv iw iz lu jd lv jh lw jl kr ks kt ku bi translated">选择<strong class="iq hs">服务下拉箭头</strong></li><li id="382c" class="kk kl hi iq b ir kv iv kw iz kx jd ky jh kz jl kr ks kt ku bi translated">在<strong class="iq hs">搜索栏中输入EC2</strong></li><li id="ecf9" class="kk kl hi iq b ir kv iv kw iz kx jd ky jh kz jl kr ks kt ku bi translated">在<strong class="iq hs">所有服务—计算</strong>下，选择<strong class="iq hs"> EC2 </strong></li></ul><figure class="lb lc ld le fd lf er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es ma"><img src="../Images/32516e6a6a88e01d753d0babed681218.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-cVxW4KHqQJBmp_2mOQc1Q.png"/></div></div></figure><p id="714e" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">4.点击<strong class="iq hs">启动实例—启动实例</strong>。</p><figure class="lb lc ld le fd lf er es paragraph-image"><div class="er es mb"><img src="../Images/61de6e113c04b4fa6fdee2e5e64a0ef7.png" data-original-src="https://miro.medium.com/v2/resize:fit:540/format:webp/1*HXawy71IuYapaWfXWvkdiw.png"/></div><figcaption class="lm ln et er es lo lp bd b be z dx translated">启动实例</figcaption></figure><p id="69da" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">5.按照以下步骤完成AWS EC2实例配置</p><ul class=""><li id="2f40" class="kk kl hi iq b ir is iv iw iz lu jd lv jh lw jl kr ks kt ku bi translated"><strong class="iq hs">第一步:</strong> <strong class="iq hs">选择一个亚马逊机器镜像(AMI) </strong>。一个<strong class="iq hs"> <em class="ly"> 64位(x86)</em></strong><em class="ly"/><strong class="iq hs"><em class="ly">Amazon Linux 2am(HVM)，SSD卷类型</em> </strong>将用于此练习并单击<strong class="iq hs">选择。</strong></li></ul><pre class="lb lc ld le fd mc md me mf aw mg bi"><span id="82ed" class="mh jn hi md b fi mi mj l mk ml"><strong class="md hs">Tip: </strong>In the left-nav, in the <strong class="md hs">Quick Start </strong>menu select <strong class="md hs">Free tier only</strong> to filter the list to display free AMIs.</span></pre><figure class="lb lc ld le fd lf er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es mm"><img src="../Images/6d64f9baeb15e44b5b3096c76c8bce21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fJjrmD9UgNg8LCKQWSFpQg.png"/></div></div><figcaption class="lm ln et er es lo lp bd b be z dx translated">第一步:选择一个AMI</figcaption></figure><ul class=""><li id="f83b" class="kk kl hi iq b ir is iv iw iz lu jd lv jh lw jl kr ks kt ku bi translated"><strong class="iq hs">第二步:选择一个实例类型。</strong><strong class="iq hs"><em class="ly">T2 . micro(符合自由层条件)</em> </strong>应该已经选中，如果没有，请选中。该列表根据选定的区域而变化。点击<strong class="iq hs">下一步:配置实例详情</strong></li></ul><figure class="lb lc ld le fd lf er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es mn"><img src="../Images/f8fb6a1bf7908108be99ee9cc07952c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OIeEIKPFOBNonzoy7mIlNA.png"/></div></div><figcaption class="lm ln et er es lo lp bd b be z dx translated">步骤2:选择实例类型</figcaption></figure><ul class=""><li id="e4d5" class="kk kl hi iq b ir is iv iw iz lu jd lv jh lw jl kr ks kt ku bi translated"><strong class="iq hs">步骤3:配置实例详细信息。</strong>确保<strong class="iq hs">自动分配公共IP </strong>设置为<strong class="iq hs"> <em class="ly">使用子网设置(启用)</em> </strong>。我们将保留所有其他默认值。</li><li id="34ff" class="kk kl hi iq b ir kv iv kw iz kx jd ky jh kz jl kr ks kt ku bi translated">向下滚动到<strong class="iq hs"> <em class="ly">高级详细信息</em> </strong>部分。我们将在这里找到<strong class="iq hs"> <em class="ly">用户数据</em> </strong>部分来输入我们的引导命令。</li><li id="3bf0" class="kk kl hi iq b ir kv iv kw iz kx jd ky jh kz jl kr ks kt ku bi translated">在<strong class="iq hs"> <em class="ly">用户数据</em> </strong>部分确保<strong class="iq hs"> <em class="ly">作为文本</em> </strong>被选中。</li></ul><figure class="lb lc ld le fd lf er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es mo"><img src="../Images/6666101c19b684574103b6b02be0232c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6EQ9pd3nkrwyo8_MKiNm9Q.png"/></div></div><figcaption class="lm ln et er es lo lp bd b be z dx translated">步骤3:展开高级详细信息以查看用户数据部分</figcaption></figure><ul class=""><li id="91cf" class="kk kl hi iq b ir is iv iw iz lu jd lv jh lw jl kr ks kt ku bi translated">将下面的Bash命令复制粘贴到<strong class="iq hs"> <em class="ly">用户数据</em> </strong>部分，点击<strong class="iq hs">下一步:添加存储</strong>。</li></ul><pre class="lb lc ld le fd mc md me mf aw mg bi"><span id="e2e6" class="mh jn hi md b fi mi mj l mk ml"><br/>#!/bin/bash<br/>yum update -y<br/>yum install httpd -y<br/>systemctl start httpd<br/>systemctl enable httpd</span><span id="774a" class="mh jn hi md b fi mp mj l mk ml"><strong class="md hs">Tip</strong>:  Once the instance is launch and you may have to go back and modify this User Data section, stop the instance, click <strong class="md hs">Actions-Instance settings-Edit user data</strong>.  See image below.</span></pre><figure class="lb lc ld le fd lf er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es mq"><img src="../Images/e92a30280080f2860968fba4cdbdc4c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ajD1uUN30OeOulGlKVHFsQ.png"/></div></div><figcaption class="lm ln et er es lo lp bd b be z dx translated">更改用户数据</figcaption></figure><ul class=""><li id="3c5a" class="kk kl hi iq b ir is iv iw iz lu jd lv jh lw jl kr ks kt ku bi translated"><strong class="iq hs">第四步:添加存储空间。</strong>确保<strong class="iq hs">卷类型</strong>为<strong class="iq hs"> <em class="ly">通用SSD(gp2) </em> </strong>，点击<strong class="iq hs">下一步:添加标签。</strong></li><li id="7b7a" class="kk kl hi iq b ir kv iv kw iz kx jd ky jh kz jl kr ks kt ku bi translated"><strong class="iq hs">第五步:添加标签。</strong>点击<strong class="iq hs">添加标签。</strong>中<strong class="iq hs">键</strong>中<strong class="iq hs">键入<em class="ly">名称</em>和</strong>中<strong class="iq hs">值</strong>键入<strong class="iq hs">和<em class="ly"> Web Server01 </em> </strong>和<strong class="iq hs"> </strong>点击<strong class="iq hs">配置安全组。</strong></li></ul><pre class="lb lc ld le fd mc md me mf aw mg bi"><span id="c94e" class="mh jn hi md b fi mi mj l mk ml"><strong class="md hs">Tip:</strong>  Tag can be used to categorize AWS resource in different ways, for example creating key of Environment with a value of Production denotes that the resource is to be used for the Production environment.  </span></pre><figure class="lb lc ld le fd lf er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es mr"><img src="../Images/80aa89a0f3cc98ab191824b696997c47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f_2CSfr1386WagCgO0qvig.png"/></div></div><figcaption class="lm ln et er es lo lp bd b be z dx translated">步骤5:添加标签</figcaption></figure><ul class=""><li id="5d74" class="kk kl hi iq b ir is iv iw iz lu jd lv jh lw jl kr ks kt ku bi translated"><strong class="iq hs">第六步:配置安全组。</strong>确保选择了<strong class="iq hs">创建新的安全组</strong>。在<strong class="iq hs">安全组名称</strong>中键入<strong class="iq hs">web server 01 SG。 </strong>也在描述中添加相同的名称。</li><li id="4638" class="kk kl hi iq b ir kv iv kw iz kx jd ky jh kz jl kr ks kt ku bi translated">对SSH进行修改，然后单击<strong class="iq hs">添加规则</strong>来配置HTTP类型，如下图所示。</li></ul><pre class="lb lc ld le fd mc md me mf aw mg bi"><span id="a7de" class="mh jn hi md b fi mi mj l mk ml"><strong class="md hs">NOTE:</strong>  SSH — change <strong class="md hs">Source</strong> to <strong class="md hs"><em class="ly">Anywhere</em></strong>. You will receive a warning because this is best practice to allow access from known IP addresses only. It is OK for now because this is a tutorial.</span></pre><figure class="lb lc ld le fd lf er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es ms"><img src="../Images/b9509f48a69afa630f5d589047b4b7ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BiW8XKmeEr2kjwa5AARqIQ.png"/></div></div><figcaption class="lm ln et er es lo lp bd b be z dx translated">步骤6:配置防火墙规则</figcaption></figure><ul class=""><li id="044e" class="kk kl hi iq b ir is iv iw iz lu jd lv jh lw jl kr ks kt ku bi translated">点击<strong class="iq hs">查看并启动。第七步:复习。</strong>花点时间查看配置<strong class="iq hs"> </strong>并点击<strong class="iq hs">启动。</strong></li><li id="566b" class="kk kl hi iq b ir kv iv kw iz kx jd ky jh kz jl kr ks kt ku bi translated">选择<strong class="iq hs">旁边的下拉箭头选择一个现有的密钥对</strong>并选择<strong class="iq hs">创建一个新的密钥对。</strong></li></ul><p id="1560" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">6.为了安全地SSH到我们新创建的Linux实例，我们需要创建一个新的密钥对。</p><ul class=""><li id="5c00" class="kk kl hi iq b ir is iv iw iz lu jd lv jh lw jl kr ks kt ku bi translated">给它一个名称，点击<strong class="iq hs">立即下载密钥对</strong>并点击<strong class="iq hs">启动实例。</strong>记住您保存密钥对的位置，因为将在下一节中使用它。</li></ul><p id="e5de" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">7.点击<strong class="iq hs">查看实例</strong>，我们的WebServer01实例出现在列表中，状态为<strong class="iq hs">运行</strong>。</p><h1 id="bc5d" class="jm jn hi bd jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj bi translated">让我们确认我们的工作</h1><p id="1394" class="pw-post-body-paragraph io ip hi iq b ir km it iu iv kn ix iy iz lr jb jc jd ls jf jg jh lt jj jk jl hb bi translated">在本节中，使用AWS EC2 WebServer01的公共IP，我们将通过访问测试页面来确认Apache已启动并运行。我们还将使用上面创建的密钥登录到服务器，以查看我们的引导命令的结果。</p><ol class=""><li id="b747" class="kk kl hi iq b ir is iv iw iz lu jd lv jh lw jl lx ks kt ku bi translated">在实例列表中，选择WebServer01以查看有关服务器的详细信息。我们正在寻找公共IPv4地址。</li><li id="288b" class="kk kl hi iq b ir kv iv kw iz kx jd ky jh kz jl lx ks kt ku bi translated">打开Web浏览器，键入公共IPv4地址，应该会显示Apache HTTP Server测试页面。</li></ol><figure class="lb lc ld le fd lf er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es mt"><img src="../Images/7a0fea02ea74a8220d53e0ce96756ce3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UKwSaOAgfWGYfDTBZRW_og.png"/></div></div><figcaption class="lm ln et er es lo lp bd b be z dx translated">Apache测试页面</figcaption></figure><p id="2b29" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">如果没有显示测试页面，这意味着引导命令出现了问题。如果在Mac上，我们可以使用终端登录服务器。按照下面步骤<strong class="iq hs"> 3 </strong>和<strong class="iq hs"> 4 </strong>中显示的连接到实例屏幕的SSH客户端选项卡中的步骤进行操作。</p><p id="ac0a" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">我使用的是Windows机器，因此下面的步骤将使用PuTTY来访问服务器。油灰不支持。perm文件，所以按照这些<a class="ae lq" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/putty.html" rel="noopener ugc nofollow" target="_blank">步骤</a>来转换。pem我们将密钥文件下载到. ppk文件中并连接到服务器。</p><p id="1428" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">3.回到AWS管理控制台，我们可以通过在列表中选择WebSever01并在右上角菜单中单击<strong class="iq hs"> Connect </strong>来获取连接说明。</p><figure class="lb lc ld le fd lf er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es mu"><img src="../Images/3fd18a693b4969a0fb89227008b0f9e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YofQ3AwxCP22U3v4HqOT-w.png"/></div></div><figcaption class="lm ln et er es lo lp bd b be z dx translated">有关服务器连接的说明，请单击“连接”</figcaption></figure><p id="09a5" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">4.在连接到实例屏幕上，选择<strong class="iq hs"> SSH客户端</strong>选项卡。此外，在<strong class="iq hs"> EC2实例的</strong>选项卡上，在<strong class="iq hs">用户名</strong>中，我们将使用该用户名进行连接。</p><p id="a194" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">5.连接后，键入以下命令:</p><pre class="lb lc ld le fd mc md me mf aw mg bi"><span id="5ae2" class="mh jn hi md b fi mi mj l mk ml"><strong class="md hs">sudo yum history </strong></span></pre><figure class="lb lc ld le fd lf er es paragraph-image"><div class="er es mv"><img src="../Images/adbd9cc44071f4ee1867c49b1232c5ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1288/format:webp/1*84y7klyBqxlKpkpsqe2llw.png"/></div><figcaption class="lm ln et er es lo lp bd b be z dx translated">sudo yum history命令的结果</figcaption></figure><pre class="lb lc ld le fd mc md me mf aw mg bi"><span id="e9d2" class="mh jn hi md b fi mi mj l mk ml"><strong class="md hs"><em class="ly">Tip</em></strong>: sudo yum history info httpd will provide details specific to Apache HTTP Server(httpd).</span></pre><h1 id="4ecc" class="jm jn hi bd jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj bi translated">恭喜你！！！！您已经成功完成了本教程。</h1><p id="93c7" class="pw-post-body-paragraph io ip hi iq b ir km it iu iv kn ix iy iz lr jb jc jd ls jf jg jh lt jj jk jl hb bi translated">请返回AWS管理控制台，删除我们在上面创建的资源，这样我们就不会产生任何意外费用。</p><p id="9c91" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">请发表反馈。再次祝贺你成功完成本教程。</p></div></div>    
</body>
</html>