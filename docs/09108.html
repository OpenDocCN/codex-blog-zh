<html>
<head>
<title>Deploy a Java Application using Argo Workflows</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Argo工作流部署Java应用程序</h1>
<blockquote>原文：<a href="https://medium.com/codex/deploy-a-java-application-using-argo-workflows-92d4699877c6?source=collection_archive---------4-----------------------#2022-09-25">https://medium.com/codex/deploy-a-java-application-using-argo-workflows-92d4699877c6?source=collection_archive---------4-----------------------#2022-09-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/222e66cac3c3eabcf95987ef0f9e082f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NsYl5LiMiz73I4spJHHyig.jpeg"/></div></div></figure><div class=""/><p id="1407" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">本文演示了如何通过argo工作流部署一个简单的java应用程序。在本文中，我们将创建一个简单的java应用程序，使用maven打包它，创建打包的jar的docker映像，并使用argo工作流部署它。</p><h1 id="3d66" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">先决条件</h1><ol class=""><li id="8ec3" class="km kn ht is b it ko ix kp jb kq jf kr jj ks jn kt ku kv kw bi translated">Kubernetes、Docker和Argo的工作设置</li><li id="9267" class="km kn ht is b it kx ix ky jb kz jf la jj lb jn kt ku kv kw bi translated">安装在开发机器上的Java JDK和Maven</li></ol><h1 id="8eb5" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">1.创建一个简单的java应用程序</h1><p id="b65c" class="pw-post-body-paragraph iq ir ht is b it ko iv iw ix kp iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">我们将从创建一个打印“Hello World！”的简单java应用程序开始。</p><figure class="lg lh li lj fd hk er es paragraph-image"><div class="er es lf"><img src="../Images/0ad1da219b9920a56f6ad2f3b45df773.png" data-original-src="https://miro.medium.com/v2/resize:fit:720/format:webp/1*is2-KX919eY3ecvVcYGt9Q.jpeg"/></div><figcaption class="lk ll et er es lm ln bd b be z dx translated">java应用程序的结构</figcaption></figure><h2 id="5acb" class="lo jp ht bd jq lp lq lr ju ls lt lu jy jb lv lw kc jf lx ly kg jj lz ma kk mb bi translated">App.java</h2><pre class="lg lh li lj fd mc md me mf aw mg bi"><span id="0d7d" class="lo jp ht md b fi mh mi l mj mk">package edu.java;</span><span id="0c63" class="lo jp ht md b fi ml mi l mj mk">public class App {<br/> public static void main(String[] args) {<br/>  System.out.println("Hello World!");<br/> }<br/>}</span></pre><h2 id="2fd2" class="lo jp ht bd jq lp lq lr ju ls lt lu jy jb lv lw kc jf lx ly kg jj lz ma kk mb bi translated">pom.xml</h2><pre class="lg lh li lj fd mc md me mf aw mg bi"><span id="2538" class="lo jp ht md b fi mh mi l mj mk">&lt;project ae mm" href="http://maven.apache.org/POM/4.0.0" rel="noopener ugc nofollow" target="_blank"&gt;http://maven.apache.org/POM/4.0.0" <br/>  xmlns:xsi="<a class="ae mm" href="http://www.w3.org/2001/XMLSchema-instance" rel="noopener ugc nofollow" target="_blank">http://www.w3.org/2001/XMLSchema-instance</a>" <br/>  xsi:schemaLocation="<a class="ae mm" href="http://maven.apache.org/POM/4.0.0" rel="noopener ugc nofollow" target="_blank">http://maven.apache.org/POM/4.0.0</a> <br/>                      <a class="ae mm" href="https://maven.apache.org/xsd/maven-4.0.0.xsd" rel="noopener ugc nofollow" target="_blank">https://maven.apache.org/xsd/maven-4.0.0.xsd</a>"&gt;<br/>                      <br/>  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;<br/>  &lt;groupId&gt;edu.lalit&lt;/groupId&gt;<br/>  &lt;artifactId&gt;java-docker-example&lt;/artifactId&gt;<br/>  &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;<br/>  &lt;name&gt;JavaDockerExample&lt;/name&gt;<br/>  &lt;description&gt;Sample Java Docker Application&lt;/description&gt;<br/>  &lt;properties&gt;<br/>      &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;<br/>      &lt;maven.compiler.source&gt;1.8&lt;/maven.compiler.source&gt;<br/>      &lt;maven.compiler.target&gt;1.8&lt;/maven.compiler.target&gt;<br/>      &lt;java.version&gt;1.8&lt;/java.version&gt;<br/>  &lt;/properties&gt;</span><span id="ac68" class="lo jp ht md b fi ml mi l mj mk">&lt;build&gt;<br/>      &lt;finalName&gt;java-docker-app&lt;/finalName&gt;<br/>      &lt;plugins&gt;<br/>  <br/>          &lt;plugin&gt;<br/>              &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;<br/>              &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;<br/>              &lt;version&gt;3.8.0&lt;/version&gt;<br/>              &lt;configuration&gt;<br/>                  &lt;source&gt;${java.version}&lt;/source&gt;<br/>                  &lt;target&gt;${java.version}&lt;/target&gt;<br/>              &lt;/configuration&gt;<br/>          &lt;/plugin&gt;<br/>  <br/>          &lt;plugin&gt;<br/>              &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;<br/>              &lt;artifactId&gt;maven-jar-plugin&lt;/artifactId&gt;<br/>              &lt;version&gt;3.2.0&lt;/version&gt;<br/>              &lt;configuration&gt;<br/>                  &lt;archive&gt;<br/>                      &lt;manifest&gt;<br/>                          &lt;addClasspath&gt;true&lt;/addClasspath&gt;<br/>                          &lt;mainClass&gt;edu.java.App&lt;/mainClass&gt;<br/>                          &lt;classpathPrefix&gt;lib/&lt;/classpathPrefix&gt;<br/>                      &lt;/manifest&gt;<br/>                  &lt;/archive&gt;<br/>              &lt;/configuration&gt;<br/>          &lt;/plugin&gt;<br/>  <br/>          &lt;plugin&gt;<br/>              &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;<br/>              &lt;artifactId&gt;maven-dependency-plugin&lt;/artifactId&gt;<br/>              &lt;version&gt;3.1.1&lt;/version&gt;<br/>              &lt;executions&gt;<br/>                  &lt;execution&gt;<br/>                      &lt;id&gt;copy-dependencies&lt;/id&gt;<br/>                      &lt;phase&gt;package&lt;/phase&gt;<br/>                      &lt;goals&gt;<br/>                          &lt;goal&gt;copy-dependencies&lt;/goal&gt;<br/>                      &lt;/goals&gt;<br/>                      &lt;configuration&gt;<br/>                          &lt;outputDirectory&gt;<br/>                              ${project.build.directory}/lib/<br/>                          &lt;/outputDirectory&gt;<br/>                      &lt;/configuration&gt;<br/>                  &lt;/execution&gt;<br/>              &lt;/executions&gt;<br/>          &lt;/plugin&gt;<br/>  <br/>      &lt;/plugins&gt;<br/>  &lt;/build&gt;<br/>&lt;/project&gt;</span></pre><h1 id="1795" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">2.使用Maven打包应用程序</h1><h2 id="fb6e" class="lo jp ht bd jq lp lq lr ju ls lt lu jy jb lv lw kc jf lx ly kg jj lz ma kk mb bi translated">包装应用</h2><pre class="lg lh li lj fd mc md me mf aw mg bi"><span id="b89c" class="lo jp ht md b fi mh mi l mj mk"># cd &lt;path to application directory&gt; <br/>$ mvn clean compile package</span></pre><h2 id="7424" class="lo jp ht bd jq lp lq lr ju ls lt lu jy jb lv lw kc jf lx ly kg jj lz ma kk mb bi translated">通过命令行运行来测试应用程序</h2><pre class="lg lh li lj fd mc md me mf aw mg bi"><span id="7582" class="lo jp ht md b fi mh mi l mj mk"># change location to application directory<br/>$ cd /home/mehral/eclipse-workspace/java-docker-example</span><span id="e6f5" class="lo jp ht md b fi ml mi l mj mk"># run java application<br/>$ java -jar target/java-docker-app.jar<br/>Hello World!</span></pre><h1 id="566d" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">3.创建Docker图像</h1><p id="6883" class="pw-post-body-paragraph iq ir ht is b it ko iv iw ix kp iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">既然我们已经成功地测试了我们的应用程序，我们将继续创建Dockerfile，如下所述。创建docker映像只需要这个文件。它描述了创建docker映像应该遵循的所有步骤和命令。</p><h2 id="29d8" class="lo jp ht bd jq lp lq lr ju ls lt lu jy jb lv lw kc jf lx ly kg jj lz ma kk mb bi translated">Dockerfile文件</h2><pre class="lg lh li lj fd mc md me mf aw mg bi"><span id="d7f5" class="lo jp ht md b fi mh mi l mj mk">FROM openjdk:8-jdk-alpine</span><span id="e948" class="lo jp ht md b fi ml mi l mj mk"># properties<br/>ARG JAR_FILE=target/java-docker-app.jar<br/>ARG JAR_LIB_FILE=target/lib/</span><span id="a338" class="lo jp ht md b fi ml mi l mj mk"># change working directory # cd path-to-your-working-directory<br/>WORKDIR /home/mehral/docker-builds</span><span id="b539" class="lo jp ht md b fi ml mi l mj mk"># copy target/java-docker-app.jar path-to-your-working-directory/app.jar<br/>COPY ${JAR_FILE} app.jar</span><span id="e87c" class="lo jp ht md b fi ml mi l mj mk"># java -jar path-to-your-working-directory/app.jar<br/>ENTRYPOINT ["java","-jar","app.jar"]</span></pre><h2 id="2220" class="lo jp ht bd jq lp lq lr ju ls lt lu jy jb lv lw kc jf lx ly kg jj lz ma kk mb bi translated">建立docker形象</h2><pre class="lg lh li lj fd mc md me mf aw mg bi"><span id="3df3" class="lo jp ht md b fi mh mi l mj mk"># change location to application directory that contains Dockerfile<br/>$ cd /home/mehral/eclipse-workspace/java-docker-example</span><span id="19db" class="lo jp ht md b fi ml mi l mj mk"># build docker image<br/>$ docker build -t java-docker-app:1.0 .<br/>Sending build context to Docker daemon  33.79kB<br/>Step 1/6 : FROM openjdk:8-jdk-alpine<br/> ---&gt; a3562aa0b991<br/>Step 2/6 : ARG JAR_FILE=target/java-docker-app.jar<br/> ---&gt; Running in 0f3533fe1cb9<br/>Removing intermediate container 0f3533fe1cb9<br/> ---&gt; 548b36cde2ea<br/>Step 3/6 : ARG JAR_LIB_FILE=target/lib/<br/> ---&gt; Running in a0a8248b4883<br/>Removing intermediate container a0a8248b4883<br/> ---&gt; f80663dd30d6<br/>Step 4/6 : WORKDIR /home/mehral/docker-builds<br/> ---&gt; Running in adc408bb847f<br/>Removing intermediate container adc408bb847f<br/> ---&gt; fcb51ac88cb6<br/>Step 5/6 : COPY ${JAR_FILE} app.jar<br/> ---&gt; 9b7772d1adb4<br/>Step 6/6 : ENTRYPOINT ["java","-jar","app.jar"]<br/> ---&gt; Running in 4d9a98033eab<br/>Removing intermediate container 4d9a98033eab<br/> ---&gt; 7b2bdcd00941<br/>Successfully built 7b2bdcd00941<br/>Successfully tagged java-docker-app:1.0</span><span id="7841" class="lo jp ht md b fi ml mi l mj mk"># verify that the docker image is created<br/>$ docker images<br/>REPOSITORY        TAG   IMAGE ID      CREATED              SIZE<br/>java-docker-app   1.0   574745237661  About a minute ago   105MB</span></pre><h2 id="7c20" class="lo jp ht bd jq lp lq lr ju ls lt lu jy jb lv lw kc jf lx ly kg jj lz ma kk mb bi translated">验证映像是否按预期工作</h2><pre class="lg lh li lj fd mc md me mf aw mg bi"><span id="f867" class="lo jp ht md b fi mh mi l mj mk"># run docker image in a container<br/>$ docker run --name java-docker java-docker-app:1.0<br/>Hello World!</span></pre><h2 id="9c18" class="lo jp ht bd jq lp lq lr ju ls lt lu jy jb lv lw kc jf lx ly kg jj lz ma kk mb bi translated">将图像推送到docker hub</h2><pre class="lg lh li lj fd mc md me mf aw mg bi"><span id="bc3d" class="lo jp ht md b fi mh mi l mj mk"># login to your docker account<br/>$ docker login</span><span id="8993" class="lo jp ht md b fi ml mi l mj mk"># tag the docker image with your username<br/># docker image tag &lt;image:version&gt; &lt;username&gt;/&lt;image:version&gt;<br/>$ docker image tag java-docker-app:1.0 mehralalit/java-docker-app:1.0</span><span id="cdaa" class="lo jp ht md b fi ml mi l mj mk"># push image to docker hub<br/>$ docker image push mehralalit/java-docker-app:1.0</span><span id="af75" class="lo jp ht md b fi ml mi l mj mk"># delete image from local machine<br/>$ docker rmi mehralalit/java-docker-app:1.0</span><span id="5345" class="lo jp ht md b fi ml mi l mj mk"># pull image from docker hub to verify that the image is accessible<br/>$ docker pull mehralalit/java-docker-app:1.0</span><span id="ef8f" class="lo jp ht md b fi ml mi l mj mk"># alternatively you can search the image on docker hub<br/>$ docker search mehralalit/java-docker-app</span></pre><h1 id="12dd" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">4.使用argo工作流进行部署</h1><h2 id="97e8" class="lo jp ht bd jq lp lq lr ju ls lt lu jy jb lv lw kc jf lx ly kg jj lz ma kk mb bi translated">Argo清单文件</h2><pre class="lg lh li lj fd mc md me mf aw mg bi"><span id="28e0" class="lo jp ht md b fi mh mi l mj mk">metadata:<br/>  name: java-docker-app<br/>  namespace: argo<br/>spec:<br/>  entrypoint: java-docker<br/>  templates:<br/>    - name: java-docker<br/>      container:<br/>        name: main<br/>        image: 'mehralalit/java-docker-app:1.0'</span></pre><h2 id="af41" class="lo jp ht bd jq lp lq lr ju ls lt lu jy jb lv lw kc jf lx ly kg jj lz ma kk mb bi translated">创建新的工作流</h2><figure class="lg lh li lj fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mn"><img src="../Images/71674288cb3c31df5d994ac6fe5bcf4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ppLcckB1kmgMTfUnVxwq2A.jpeg"/></div></div><figcaption class="lk ll et er es lm ln bd b be z dx translated"><strong class="bd jq">点击提交新的工作流</strong></figcaption></figure><figure class="lg lh li lj fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mo"><img src="../Images/7d8ce9b188aa5557e4a8ebcc0c12b47f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lXMVrDzXZzqxPr5M46df-Q.jpeg"/></div></div><figcaption class="lk ll et er es lm ln bd b be z dx translated"><strong class="bd jq">点击编辑使用完整工作流程选项</strong></figcaption></figure><figure class="lg lh li lj fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mp"><img src="../Images/9729e46121f223d7b52baf65302c281e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XJ5dYuKQOJ_5R3pKiG1D1w.jpeg"/></div></div><figcaption class="lk ll et er es lm ln bd b be z dx translated"><strong class="bd jq">点击前一个屏幕中的“创建”并使其运行</strong></figcaption></figure><figure class="lg lh li lj fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mq"><img src="../Images/f9211c2e9d872a5ab85af3ce78c2b1a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O1HNmmbzLQ_6ZYl2_IPurw.jpeg"/></div></div><figcaption class="lk ll et er es lm ln bd b be z dx translated"><strong class="bd jq">点击上一屏幕的日志按钮查看日志</strong></figcaption></figure><p id="8d03" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们在第一步中创建的简单java应用程序通过四个简单的步骤使用Argo工作流成功部署到一个容器中。:)</p></div><div class="ab cl mr ms gp mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="hb hc hd he hf"><blockquote class="my"><p id="2662" class="mz na ht bd nb nc nd ne nf ng nh jn dx translated">这是我最近写的关于设计模式的书的链接。希望你会觉得有用。</p></blockquote><div class="ni nj nk nl nm nn"><a href="https://www.amazon.in/Software-Design-Patterns-Java-Developers/dp/9391392474" rel="noopener  ugc nofollow" target="_blank"><div class="no ab dw"><div class="np ab nq cl cj nr"><h2 class="bd hu fi z dy ns ea eb nt ed ef hs bi translated">面向Java开发人员的软件设计模式:专家主导的构建可重用软件的方法和…</h2><div class="nu l"><h3 class="bd b fi z dy ns ea eb nt ed ef dx translated">面向Java开发人员的软件设计模式讨论了软件设计的基础，以及公认的…</h3></div><div class="nv l"><p class="bd b fp z dy ns ea eb nt ed ef dx translated">www .亚马逊. in</p></div></div><div class="nw l"><div class="nx l ny nz oa nw ob hp nn"/></div></div></a></div></div></div>    
</body>
</html>