<html>
<head>
<title>Juggling Wide and Long Types Data in R: A Nice and Easy Approach</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在R中处理宽类型和长类型数据:一种简单的好方法</h1>
<blockquote>原文：<a href="https://medium.com/codex/juggling-wide-and-long-types-data-in-r-a-nice-and-easy-approach-e2473707f42f?source=collection_archive---------11-----------------------#2021-05-18">https://medium.com/codex/juggling-wide-and-long-types-data-in-r-a-nice-and-easy-approach-e2473707f42f?source=collection_archive---------11-----------------------#2021-05-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/96a24514d1ba2135fd72a5c05d5fc3d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yG3YxPGTifuo4lJeow1p1Q.jpeg"/></div></div></figure><p id="047c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您可能会听到人们谈论宽和长类型数据。什么是宽类型数据？这是一个由五个人组成的投资组合的例子。第一列记录个人IDs到5)，其余记录每个个人投资于三种类型资产的金额:<em class="jo">股票.市场、共同基金</em>和<em class="jo">银行.存款</em>。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jp"><img src="../Images/3db70d8669a12e21bd6c0bcf5f709d17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IeBS5Mke8CG22N4eez4CzQ.png"/></div></div></figure><p id="3bc8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">宽类型是常见的数据类型。如果我们想要汇总个人(或者更一般意义上的主题)的相似多维信息，它可能是默认的数据类型。销售经理可以使用广泛的数据来跟踪销售人员的每月表现，教师可以使用广泛的数据来记录学生在不同测试中的成绩，等等。</p><p id="209d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">有时，数据分析要求以长格式提供数据。长数据记录相同数量的信息，但以不同的方式呈现信息。顾名思义，它比宽数据长，但比宽数据窄。如果我们在一个长数据中呈现投资组合；看起来是这样的:</p><figure class="jq jr js jt fd ij er es paragraph-image"><div class="er es ju"><img src="../Images/f150b3d56d4bf3bea50cb549d1d7cfd3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1020/format:webp/1*9r_hotFYdHDS5y6PDYV_XA.png"/></div></figure><p id="786c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">前三排属于个人一号。她的性别和年龄信息重复三次(为什么是三次？)，对每一个个体也是如此。我们可以看到创建了两个新列:一列存储资产的类型，另一列存储该资产的投资额。</p><p id="4eee" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为什么要烦恼转型？原因有很多。R中的许多分析要求数据是长类型的；为了共同绘制多个变量和生成图例，一些ggplot任务也需要长数据。或者你只有宽数据，一个编程语言只接受长类型，你要把R中的数据扯皮导出。</p><p id="b549" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">例如，如何使用上述数据绘制一个条形图，显示每项资产的相对投资部分？没有宽/长的变形，这项工作是困难的。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jv"><img src="../Images/596dd1ac158cdfe65acab279fbe25483.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nVeBgay16PavzQk_ymAPlA.png"/></div></div></figure><p id="6ccd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因此，在R学习的这个阶段，非常需要掌握一个简单的技巧来将wide转换成long，以及long转换成wide。解决了不该头疼的头疼。</p><p id="fbb9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在R中，人们曾经在Reshape 2包中使用<em class="jo"> dcast </em>和<em class="jo"> melt </em>函数，后来<em class="jo">展开</em>和<em class="jo">集合</em>函数在<em class="jo"> tidyr </em>包中完成这项工作。各有利弊。随着新的<em class="jo"> tidyr </em>包中<em class="jo"> pivot _longer </em>和<em class="jo"> pivot_wider </em>函数的引入，我们终于有了这个漂亮而简单的工具。</p><p id="009e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">上述投资组合数据是转型的理想案例，因为每个人都投资于所有三种资产。使用管道操作，很容易在您自己身上复制以下结果。</p><p id="0ba0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">将下面的全部代码复制到你的R Studio中导入wide数据，命名为df.wide，关于<em class="jo"> read.table </em>函数的一些图示可以在这篇<a class="ae jw" rel="noopener" href="/codex/a-comprehensive-summary-of-data-import-in-r-from-the-most-user-friendly-to-the-most-time-saving-6c87319b1927">文章</a>中找到。</p><pre class="jq jr js jt fd jx jy jz ka aw kb bi"><span id="e6d6" class="kc kd hi jy b fi ke kf l kg kh">library(tidyr)</span><span id="acf8" class="kc kd hi jy b fi ki kf l kg kh">df.wide=read.table(text="<br/>ID  Gender Age Stock.market mutual.fund Bank.deposit<br/>1 F 45 55 22 32<br/>2 M 41 15 50 45<br/>3 F 56 27 21 14<br/>4 M 60 12 63 58<br/>5 F 39 37 34 20<br/>",header =T)</span><span id="bf9b" class="kc kd hi jy b fi ki kf l kg kh">df.wide %&gt;% pivot_longer(4:6,names_to=”Asset.type”,values_to=”Amount”)-&gt;df.long</span></pre><p id="d75a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在上面的代码中，4:6是我们希望R进行转换的列id；此外，我们使用<em class="jo"> names_to </em>参数指定了一个新列，这意味着您希望将4:6(股票、市场、共同基金等)的列名放入这个新列，并将其命名为<em class="jo"> Asset.type </em>。我们还使用<em class="jo"> values_to </em>参数指定一个新列来存储相应的金额，并将这个新列命名为<em class="jo"> Amount </em>。</p><p id="28ce" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">相应地，<em class="jo"> pivot_wider </em>将long数据转换回wide，切换参数<em class="jo"> names_from </em>和<em class="jo"> values_from </em>。</p><pre class="jq jr js jt fd jx jy jz ka aw kb bi"><span id="c0a2" class="kc kd hi jy b fi ke kf l kg kh">df.long %&gt;% pivot_wider(names_from=”Asset.type”,values_from=”Amount”)</span></pre><p id="f3c6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在上面的行中，引号可以删除。但是为了和pivot_longer的一致性，我们最好还是保留它们。</p><p id="06cd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我没有将上述结果保存到新的data.frame中，因为我已经有了宽数据。您可以检查转换是否完成。</p><p id="fdc9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">很简单，对吧？现在让我们看一些更复杂的场景。</p><p id="24f2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi kj translated">完成数据。当我们从长变宽时，它们会让人头疼。比如下面我们去掉最后两行<em class="jo"> df.long </em>。因此，没有关于个人5在共同基金和银行存款中的投资的信息。我们称这个新的长数据为df.long2 ，</p><pre class="jq jr js jt fd jx jy jz ka aw kb bi"><span id="3bca" class="kc kd hi jy b fi ke kf l kg kh">df.long2=read.table(text="Customer.ID Gender Age Asset.type Amount<br/>1 F 45 Stock.market 55<br/>1 F 45 mutual.fund 22<br/>1 F 45 Bank.deposit 32<br/>2 M 41 Stock.market 15<br/>2 M 41 mutual.fund 50<br/>2 M 41 Bank.deposit 45<br/>3 F 56 Stock.market 27<br/>3 F 56 mutual.fund 21<br/>3 F 56 Bank.deposit 14<br/>4 M 60 Stock.market 12<br/>4 M 60 mutual.fund 63<br/>4 M 60 Bank.deposit 58<br/>5 F 39 Stock.market 37<br/>",header =T)</span></pre><p id="02ca" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">看起来像这样:</p><pre class="jq jr js jt fd jx jy jz ka aw kb bi"><span id="5ae4" class="kc kd hi jy b fi ke kf l kg kh">Customer.ID Gender Age   Asset.type amount<br/>1            1      F  45 Stock.market     55<br/>2            1      F  45  mutual.fund     22<br/>3            1      F  45 Bank.deposit     32<br/>4            2      M  41 Stock.market     15<br/>5            2      M  41  mutual.fund     50<br/>6            2      M  41 Bank.deposit     45<br/>7            3      F  56 Stock.market     27<br/>8            3      F  56  mutual.fund     21<br/>9            3      F  56 Bank.deposit     14<br/>10           4      M  60 Stock.market     12<br/>11           4      M  60  mutual.fund     63<br/>12           4      M  60 Bank.deposit     58<br/><strong class="jy hj">13           5      F  39 Stock.market     37</strong></span></pre><p id="fd16" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果我们使用上面的代码直接从长到宽进行转换，我们最终会得到这样的数据帧:</p><pre class="jq jr js jt fd jx jy jz ka aw kb bi"><span id="35cf" class="kc kd hi jy b fi ke kf l kg kh">Customer.ID Gender   Age Stock.market mutual.fund Bank.deposit<br/>        <em class="jo">&lt;int&gt;</em> <em class="jo">&lt;chr&gt;</em>  <em class="jo">&lt;int&gt;</em>        <em class="jo">&lt;int&gt;</em>       <em class="jo">&lt;int&gt;</em>        <em class="jo">&lt;int&gt;</em><br/>1           1 F         45           55          22           32<br/>2           2 M         41           15          50           45<br/>3           3 F         56           27          21           14<br/>4           4 M         60           12          63           58<br/>5           5 F         39           37          <strong class="jy hj">NA           NA</strong></span></pre><p id="4e1a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">仍然创建宽数据，但是R使用NA替换丢失的值。如果我们确定个人五在这两项资产上投资为零，我们可以用零代替NA。在代码中，我们将v <em class="jo"> alues_fill=0的参数添加到<em class="jo"> pivot_wider </em>中。</em></p><pre class="jq jr js jt fd jx jy jz ka aw kb bi"><span id="68f9" class="kc kd hi jy b fi ke kf l kg kh">df.long2 %&gt;% pivot_wider(names_from="Asset.type",values_from="Amount",values_fill=0)</span></pre><p id="440f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您可以用任何想要的值来替换零。</p><pre class="jq jr js jt fd jx jy jz ka aw kb bi"><span id="d69c" class="kc kd hi jy b fi ke kf l kg kh">Customer.ID Gender   Age Stock.market mutual.fund Bank.deposit<br/>        <em class="jo">&lt;int&gt;</em> <em class="jo">&lt;chr&gt;</em>  <em class="jo">&lt;int&gt;</em>        <em class="jo">&lt;int&gt;</em>       <em class="jo">&lt;int&gt;</em>        <em class="jo">&lt;int&gt;</em><br/>1           1 F         45           55          22           32<br/>2           2 M         41           15          50           45<br/>3           3 F         56           27          21           14<br/>4           4 M         60           12          63           58<br/>5           5 F         39           37           <strong class="jy hj">0            0</strong></span></pre><p id="449b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">另一个复杂的场景正好相反:一个人有多行映射到一列。例如，在上面的投资组合数据框架中，个人1有两行银行存款，一行的贷方金额为32，另一行为70。</p><pre class="jq jr js jt fd jx jy jz ka aw kb bi"><span id="8509" class="kc kd hi jy b fi ke kf l kg kh">df.long3=read.table(text="Customer.ID Gender Age Asset.type Amount<br/>1 F 45 Stock.market 55<br/>1 F 45 mutual.fund 22<br/><strong class="jy hj">1 F 45 Bank.deposit 32<br/>1 F 45 Bank.deposit 70</strong><br/>2 M 41 Stock.market 15<br/>2 M 41 mutual.fund 50<br/>2 M 41 Bank.deposit 45<br/>3 F 56 Stock.market 27<br/>3 F 56 mutual.fund 21<br/>3 F 56 Bank.deposit 14<br/>4 M 60 Stock.market 12<br/>4 M 60 mutual.fund 63<br/>4 M 60 Bank.deposit 58<br/>5 F 39 Stock.market 37<br/>",header =T)</span></pre><p id="e105" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果我们直接使用<em class="jo"> pivot_wider </em>，我们会得到错误消息。这是因为我们首先需要回答一个问题:在转换后的宽数据中，我们要为个人的银行存款记录什么信息？是32和7的和，还是32和70的平均值，还是32和70的最大值？只有在我们告诉<em class="jo"> pivot_wider </em>我们的决定后，我们才能继续。</p><p id="2805" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">假设我们想得到银行存款总额。为此，我们添加<em class="jo"> values_fn=sum </em>来告诉R对所有个人及其资产类型进行求和。</p><pre class="jq jr js jt fd jx jy jz ka aw kb bi"><span id="e163" class="kc kd hi jy b fi ke kf l kg kh">df.long3 %&gt;% pivot_wider(names_from="Asset.type",values_from="Amount",values_fill=0,values_fn=sum)</span></pre><p id="0efb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当然，只执行一次求和:将个人的两笔银行存款相加，并将值(32+70=102)存储到新转换的wide数据中的<em class="jo"> Bank.deposit </em>列。</p><pre class="jq jr js jt fd jx jy jz ka aw kb bi"><span id="d201" class="kc kd hi jy b fi ke kf l kg kh">Customer.ID Gender   Age Stock.market mutual.fund Bank.deposit<br/>        <em class="jo">&lt;int&gt;</em> <em class="jo">&lt;chr&gt;</em>  <em class="jo">&lt;int&gt;</em>        <em class="jo">&lt;int&gt;</em>       <em class="jo">&lt;int&gt;</em>        <em class="jo">&lt;int&gt;</em><br/>1           1 F         45           55          22        <strong class="jy hj">  102</strong><br/>2           2 M         41           15          50           45<br/>3           3 F         56           27          21           14<br/>4           4 M         60           12          63           58<br/>5           5 F         39           37           0            0</span></pre><p id="d5f5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">接下来，我们考虑一个更复杂的情况，您打算转换两个类别的大量数据。为了形成示例，我们向投资组合数据框架添加三列(食品杂货、汽油和租金)来表示这些个人的支出。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ks"><img src="../Images/c441ac4cc3cbdfd66cf5026ed54a321b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Jr0rGXBlIVP-bXxztCbUJg.png"/></div></div></figure><p id="4a4c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们希望转换后的数据看起来像这样。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kt"><img src="../Images/dacae919ed1f1a5eed545ad30471bf32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AD3dqcC-6G4eozHmt-16Iw.png"/></div></div></figure><p id="086a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这是代码。我们使用两次<em class="jo"> pivot_longer </em>。并且每次我们指定分别存储项目名称和值的列。此外，先执行第一个<em class="jo"> pivot_longer </em>函数来标识食品杂货、汽油和租金的列id也很有用。</p><pre class="jq jr js jt fd jx jy jz ka aw kb bi"><span id="cd5d" class="kc kd hi jy b fi ke kf l kg kh">df.wide2=read.table(text="ID Gender Age Stock.market mutual.fund Bank.deposit Grocery Gas Rent<br/>1 F 45 55 22 32 4 1 3<br/>2 M 41 15 50 45 4 2 1<br/>3 F 56 27 21 14 2 1 6<br/>4 M 60 12 63 58 2 1 1<br/>5 F 39 37 34 20 3 1 4<br/>",header =T)</span><span id="1147" class="kc kd hi jy b fi ki kf l kg kh">df.wide2 %&gt;% pivot_longer(4:6,names_to="Asset.type",values_to="Amount") %&gt;% pivot_longer(4:6,names_to="Spending.type",values_to="Spending")</span></pre><p id="899f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您将生成以下宽数据帧。</p><pre class="jq jr js jt fd jx jy jz ka aw kb bi"><span id="0165" class="kc kd hi jy b fi ke kf l kg kh">ID Gender   Age Asset.type   Amount Spending.type Spending<br/>   <em class="jo">&lt;int&gt;</em> <em class="jo">&lt;chr&gt;</em>  <em class="jo">&lt;int&gt;</em> <em class="jo">&lt;chr&gt;</em>         <em class="jo">&lt;int&gt;</em> <em class="jo">&lt;chr&gt;</em>            <em class="jo">&lt;int&gt;</em><br/> 1     1 F         45 Stock.market     55 Grocery              4<br/> 2     1 F         45 Stock.market     55 Gas                  1<br/> 3     1 F         45 Stock.market     55 Rent                 3<br/> 4     1 F         45 mutual.fund      22 Grocery              4<br/> 5     1 F         45 mutual.fund      22 Gas                  1<br/> 6     1 F         45 mutual.fund      22 Rent                 3<br/> 7     1 F         45 Bank.deposit     32 Grocery              4<br/> 8     1 F         45 Bank.deposit     32 Gas                  1<br/> 9     1 F         45 Bank.deposit     32 Rent                 3<br/>10     2 M         41 Stock.market     15 Grocery              4<br/># ... with 35 more rows</span></pre><p id="1d3a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最后，有时我们需要转换混合long-wide类型中的多个列值，如下所示。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div class="er es ku"><img src="../Images/ff7c6c5635b1a59f2d2d72d4e5907a02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1270/format:webp/1*4XbZLeP8Zs6PtwMhJgc0Zw.png"/></div></figure><p id="df69" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在上面的数据框架中，每种资产类型都有2019年和2020年的值，分别显示在两个单独的列中(宽类型)。然而，对于资产类型，每个ID占据两行(长类型)。</p><p id="3e67" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们导入数据。</p><pre class="jq jr js jt fd jx jy jz ka aw kb bi"><span id="ac6a" class="kc kd hi jy b fi ke kf l kg kh">df.long4=read.table(text="ID Gender Age Asset.type Amount.2020 Amount.2019<br/>1 F 45 Stock.market 55 50<br/>1 F 45 mutual.fund 22 20<br/>2 M 41 Stock.market 15 10<br/>2 M 41 mutual.fund 50 45<br/>",header =T)</span></pre><p id="7b76" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们首先将两列<em class="jo">、Amount.2020 </em>和<em class="jo"> Amount.2019 </em>分别重命名为<em class="jo"> Y2020 </em>和<em class="jo"> Y2019 </em>，为新列创建易于解释的名称。然后我们使用<em class="jo"> pivot_wider </em>并指定要转换的值的向量(<em class="jo"> Y2020和Y2019) </em>。此外，我们使用<em class="jo"> names_glue </em>指定新列名的格式为<em class="jo"> Asset.type_Year </em>。</p><pre class="jq jr js jt fd jx jy jz ka aw kb bi"><span id="4040" class="kc kd hi jy b fi ke kf l kg kh">df.wide3=df.long4%&gt;% rename(Y2020=Amount.2020,Y2019=Amount.2019)%&gt;% pivot_wider(names_from=Asset.type,values_from=c(Y2020,Y2019),names_glue = "{Asset.type}_{.value}")</span></pre><p id="e127" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">新生成的宽数据如下所示</p><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kv"><img src="../Images/ebe7cc3f4ba038267d5b28906b29bd01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iiO19zAxmMXOo8GQ5_oUDg.png"/></div></div></figure><p id="953f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们可以进一步将这个宽数据转换回一个“完整的”长数据，每个ID占据四行。我们使用“_”将<em class="jo"> names_to </em> argument分隔成多个列，以使摘要更加清晰。</p><pre class="jq jr js jt fd jx jy jz ka aw kb bi"><span id="ca0f" class="kc kd hi jy b fi ke kf l kg kh">df.wide3%&gt;%<br/>pivot_longer(contains("_"),names_to=c("Asset","Year"),values_to="Amount",names_sep="_")</span></pre><p id="4172" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最后的最后，关于文章开头出现的情节。学会了我在这篇文章中描述的内容，你就可以简单明了地绘制它了！</p><pre class="jq jr js jt fd jx jy jz ka aw kb bi"><span id="f00e" class="kc kd hi jy b fi ke kf l kg kh">library(ggplot2)</span><span id="b1c2" class="kc kd hi jy b fi ki kf l kg kh">df.wide %&gt;% pivot_longer(4:6,names_to=”Asset.type”,values_to=”Amount”)%&gt;% ggplot() + geom_col(aes(x=ID,y=Amount,fill=Asset.type),position=”stack”) +scale_fill_manual(values=c(“sandybrown”,”darkblue”,”turquoise”))</span></pre><p id="81ca" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="jo">#希望这篇文章让长/宽转换不再是你的问题。</em></p></div></div>    
</body>
</html>