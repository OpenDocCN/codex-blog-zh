<html>
<head>
<title>How to build in-app chat using Kotlin — Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Kotlin构建应用内聊天——第2部分</h1>
<blockquote>原文：<a href="https://medium.com/codex/how-to-build-in-app-chat-using-kotlin-part-2-2558f208a3ee?source=collection_archive---------6-----------------------#2022-04-12">https://medium.com/codex/how-to-build-in-app-chat-using-kotlin-part-2-2558f208a3ee?source=collection_archive---------6-----------------------#2022-04-12</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/86f99d557f0b0f8a882c6995eb6c4277.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*SpZ_qIGvEEB-4X6P.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">仙鸟2022</figcaption></figure><div class=""/><div class=""><h2 id="ee40" class="pw-subtitle-paragraph iu hw hx bd b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl dx translated">使用Sendbird Android SDK构建消息传递UI并实现发送和接收应用内聊天消息的功能</h2></div><p id="4f8b" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">由Alex Preston <br/>解决方案工程师| <a class="ae ki" href="https://www.sendbird.com" rel="noopener ugc nofollow" target="_blank"> Sendbird </a></p><p id="cb0a" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">这是关于如何使用Kotlin建立应用内聊天的两部分指南的第二部分。您可能会发现查看我们的Android示例应用程序的 <a class="ae ki" href="https://github.com/sendbird/SendBird-Android" rel="noopener ugc nofollow" target="_blank"> <em class="kj">代码</em> </a> <em class="kj">很有用。如果需要额外的指导参见</em> <a class="ae ki" href="https://sendbird.com/docs/chat/v3/android/quickstart/send-first-message" rel="noopener ugc nofollow" target="_blank"> <em class="kj">文档</em> </a> <em class="kj">。别忘了看看用Sendbird构建的应用内</em> <a class="ae ki" href="https://sendbird.com/features/chat-messaging" rel="noopener ugc nofollow" target="_blank"> <em class="kj">聊天</em> </a> <em class="kj">的</em> <a class="ae ki" href="https://sendbird.com/demos/in-app-chat" rel="noopener ugc nofollow" target="_blank"> <em class="kj">演示</em> </a> <em class="kj">。</em></p><blockquote class="kk kl km"><p id="dd45" class="jm jn kj jo b jp jq iy jr js jt jb ju kn jw jx jy ko ka kb kc kp ke kf kg kh hb bi translated"><em class="hx">成为第一个了解新教程、开发者相关聊天/电话发布以及其他重要更新的人，</em> <a class="ae ki" href="https://get.sendbird.com/dev-newsletter-subscription.html" rel="noopener ugc nofollow" target="_blank"> <em class="hx">注册</em> </a> <em class="hx">订阅我们的开发者简讯。</em></p></blockquote><h1 id="cbc0" class="kq kr hx bd ks kt ku kv kw kx ky kz la jd lb je lc jg ld jh le jj lf jk lg lh bi translated">介绍</h1><p id="1e5b" class="pw-post-body-paragraph jm jn hx jo b jp li iy jr js lj jb ju jv lk jx jy jz ll kb kc kd lm kf kg kh hb bi translated">本教程遵循关于如何使用Kotlin建立应用内聊天的教程的第1部分。这个由两部分组成的指南旨在通过展示一个简单的聊天实现来帮助您入门和运行。</p><p id="0562" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">UIKit入门非常容易，但是在某些情况下，您可能需要从我们的核心SDK实现chat。本指南继续我们在第1部分中停止的地方。在第1部分中，我们构建了:</p><ul class=""><li id="de3b" class="ln lo hx jo b jp jq js jt jv lp jz lq kd lr kh ls lt lu lv bi translated">注册</li><li id="ea7d" class="ln lo hx jo b jp lw js lx jv ly jz lz kd ma kh ls lt lu lv bi translated">创建和列出频道的能力</li></ul><p id="ffe7" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">在本教程中，我们将创建:</p><ul class=""><li id="4f2a" class="ln lo hx jo b jp jq js jt jv lp jz lq kd lr kh ls lt lu lv bi translated"><code class="du mb mc md me b">ChatActivity</code>的用户界面</li><li id="efa2" class="ln lo hx jo b jp lw js lx jv ly jz lz kd ma kh ls lt lu lv bi translated"><code class="du mb mc md me b">MessageAdapter</code>设置UI组件</li><li id="b9f8" class="ln lo hx jo b jp lw js lx jv ly jz lz kd ma kh ls lt lu lv bi translated"><code class="du mb mc md me b">ChannelActivity</code>阶级</li></ul><p id="385a" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">在我们开始之前，请注意以下几点:</p><p id="f6f8" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">a.下图描述了类关系。当你继续学习本教程时，你会发现它是一个有用的参考。</p><figure class="mg mh mi mj fd hk er es paragraph-image"><div class="er es mf"><img src="../Images/9f8eef8c82c3ae530c55de00d6a19dc8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/format:webp/0*39y-fdXnY-e-OhOD.jpeg"/></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">图1:kot Lin示例的类图</figcaption></figure><p id="5ddf" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">b.本指南仅涵盖发送和接收用户消息。要查看如何发送文件消息，请访问我们的<a class="ae ki" href="https://docs.sendbird.com/android/group_channel#3_send_a_message" rel="noopener ugc nofollow" target="_blank">文档</a>。</p><p id="1b8a" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">c.本指南侧重于三个不同的部分:</p><ul class=""><li id="bf9b" class="ln lo hx jo b jp jq js jt jv lp jz lq kd lr kh ls lt lu lv bi translated"><code class="du mb mc md me b">Channel Activity</code>的用户界面</li><li id="9883" class="ln lo hx jo b jp lw js lx jv ly jz lz kd ma kh ls lt lu lv bi translated"><code class="du mb mc md me b">MessageAdapter.kt</code>类</li><li id="c534" class="ln lo hx jo b jp lw js lx jv ly jz lz kd ma kh ls lt lu lv bi translated"><code class="du mb mc md me b">ChannelActivity.kt</code>阶级</li></ul><p id="8bf7" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">d.本教程是使用以下工具构建的:</p><ul class=""><li id="29b2" class="ln lo hx jo b jp jq js jt jv lp jz lq kd lr kh ls lt lu lv bi translated">安卓工作室:4.0.2</li><li id="12fa" class="ln lo hx jo b jp lw js lx jv ly jz lz kd ma kh ls lt lu lv bi translated">Android版本:10 API 29</li><li id="1719" class="ln lo hx jo b jp lw js lx jv ly jz lz kd ma kh ls lt lu lv bi translated">科特林:1.3.72</li><li id="3850" class="ln lo hx jo b jp lw js lx jv ly jz lz kd ma kh ls lt lu lv bi translated">Sendbird核心SDK: 3.0.148</li></ul><p id="dafe" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">e.本教程假设预先了解Android和Android概念。</p><p id="3447" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">f.请查看第1部分和第2部分的完整源代码<a class="ae ki" href="https://github.com/AlexPrestonSB/SendbirdKotlinBlog" rel="noopener ugc nofollow" target="_blank">。</a></p><h1 id="decc" class="kq kr hx bd ks kt ku kv kw kx ky kz la jd lb je lc jg ld jh le jj lf jk lg lh bi translated">步骤1:为渠道活动构建UI</h1><figure class="mg mh mi mj fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mk"><img src="../Images/ce1378bbfe881c545bc5e01ce2e3ad66.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*WofL0sq154SLiDzd.png"/></div></div></figure><ol class=""><li id="5d4b" class="ln lo hx jo b jp jq js jt jv lp jz lq kd lr kh ml lt lu lv bi translated"><code class="du mb mc md me b">activity_chat.xml</code> <br/>我们需要做的第一件事是创建一个聊天界面。我们将添加一个顶部带有“返回”按钮的<strong class="jo hy"> AppBarLayout </strong>，以返回到<strong class="jo hy">channelistactivity</strong>。在此之下，我们将添加一个<strong class="jo hy"> RecyclerView </strong>来显示实际的消息。最后，在底部，我们将添加一个简单的布局来处理消息的输入和发送。这是要点:</li></ol><figure class="mg mh mi mj fd hk"><div class="bz dy l di"><div class="mm mn l"/></div></figure><p id="98d5" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">2.<code class="du mb mc md me b">item_chat_me.xml</code> <br/>现在我们已经完成了这个活动框架的UI，我们需要为消息创建两个不同的项目视图。我们将需要这样做，因为我们将为当前用户发送的消息提供不同的UI，并且我们将为聊天中其他人发送的消息提供不同的UI。(随着您实现更多类型的消息，您将拥有更多这样的. XML。)</p><p id="0d82" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">第一个。xml将用于从“我”的角度来看的消息，或者由当前用户发送的消息。为此，我们选择了一个用于实际消息的<code class="du mb mc md me b">TextView</code>，它被包装在一个<code class="du mb mc md me b">Cardview</code>中。围绕这个<code class="du mb mc md me b">TextView</code>的是其他的<code class="du mb mc md me b">TextViews</code> <strong class="jo hy"> </strong>比如日期之类的东西。这是要点:</p><figure class="mg mh mi mj fd hk"><div class="bz dy l di"><div class="mm mn l"/></div></figure><p id="b05d" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">3.<code class="du mb mc md me b">item_chat_other.xml</code> <br/>第二种。xml将用于来自“其他”视角的消息或者不是来自当前用户的任何消息。这个UI将类似于“我”UI；但是，它是左对齐的，包含关于“其他”用户的信息。这包括像一个用于概要图像的<code class="du mb mc md me b">ImageView</code>和一个用于用户名的<code class="du mb mc md me b">TextField</code>这样的东西。除此之外，观点都比较相似。这是要点:</p><figure class="mg mh mi mj fd hk"><div class="bz dy l di"><div class="mm mn l"/></div></figure><h1 id="58c6" class="kq kr hx bd ks kt ku kv kw kx ky kz la jd lb je lc jg ld jh le jj lf jk lg lh bi translated">第二步。MessageAdapter.kt类</h1><p id="1fa5" class="pw-post-body-paragraph jm jn hx jo b jp li iy jr js lj jb ju jv lk jx jy jz ll kb kc kd lm kf kg kh hb bi translated">现在我们已经实现了UI，我们将实现<code class="du mb mc md me b">MessageAdapter.kt</code>类。我们跳过了<code class="du mb mc md me b">ChannelActivity.kt</code>，因为在我们进入通道处理程序之前讨论UI如何设置更有意义。这个类将把传递给它的数据附加到<code class="du mb mc md me b">recyclerView</code>中的特定视图。</p><p id="ca5d" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">现在，创建一个名为<code class="du mb mc md me b">MessageAdapter.kt</code>的类。这个类将扩展<code class="du mb mc md me b">RecyclerView.Adapter</code> &lt; RecyclerView。ViewHolder &gt;()，因此您将需要确保实现以下方法:</p><ol class=""><li id="8f32" class="ln lo hx jo b jp jq js jt jv lp jz lq kd lr kh ml lt lu lv bi translated"><code class="du mb mc md me b">onCreateViewHolder</code> <br/>这将返回对应于消息类型的<code class="du mb mc md me b">customViewHolder</code>。</li><li id="dc54" class="ln lo hx jo b jp lw js lx jv ly jz lz kd ma kh ml lt lu lv bi translated"><code class="du mb mc md me b">getItemViewType</code> <br/>这是我们弄清楚消息类型的地方。目前我们只实现了<code class="du mb mc md me b">UserMessage</code>。该功能将确定它是“我”消息还是“其他”消息。我们将相应地返回。</li><li id="1061" class="ln lo hx jo b jp lw js lx jv ly jz lz kd ma kh ml lt lu lv bi translated"><code class="du mb mc md me b">onBindViewHolder</code> <br/>该功能将消息绑定到视图。</li><li id="ae69" class="ln lo hx jo b jp lw js lx jv ly jz lz kd ma kh ml lt lu lv bi translated"><code class="du mb mc md me b">getItemCount</code> <br/>该函数返回消息的当前位置。</li></ol><p id="6a25" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">我们需要添加两个额外的功能。这些是:</p><ol class=""><li id="0722" class="ln lo hx jo b jp jq js jt jv lp jz lq kd lr kh ml lt lu lv bi translated"><code class="du mb mc md me b">loadMessages</code> <br/>这个方法的要点是加载我们将在<code class="du mb mc md me b">ChannelActivity</code>中得到的初始过去消息。</li><li id="da9a" class="ln lo hx jo b jp lw js lx jv ly jz lz kd ma kh ml lt lu lv bi translated"><code class="du mb mc md me b">addFirst</code> <br/>该功能将刚刚发送或接收的消息添加到适配器中。显然，这两个函数都需要调用<code class="du mb mc md me b">notifyDataSetChanged()</code>来更新<code class="du mb mc md me b">recyclerView</code>。这是要点:</li></ol><figure class="mg mh mi mj fd hk"><div class="bz dy l di"><div class="mm mn l"/></div></figure><p id="cafb" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">在我们处理了一个<code class="du mb mc md me b">recyclerView</code> <strong class="jo hy">适配器</strong>的基本功能之后，我们将需要实现我们自己的<code class="du mb mc md me b">customViewHolders</code>。我们有两个内部类，分别表示为:</p><ol class=""><li id="cd2e" class="ln lo hx jo b jp jq js jt jv lp jz lq kd lr kh ml lt lu lv bi translated">这个类简单地将“我”发送的相应消息绑定到项目，我们之前已经为其创建了视图。这是要点:</li></ol><figure class="mg mh mi mj fd hk"><div class="bz dy l di"><div class="mm mn l"/></div></figure><p id="aa64" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">2.这个类简单地将“Other”发送的消息绑定到条目，我们之前已经为其创建了视图。这是要点:</p><figure class="mg mh mi mj fd hk"><div class="bz dy l di"><div class="mm mn l"/></div></figure><p id="d0d7" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">为了看起来更整洁，我们还添加了一个对象，它有两个帮助日期格式化的函数。这是要点:</p><figure class="mg mh mi mj fd hk"><div class="bz dy l di"><div class="mm mn l"/></div></figure><p id="0cf1" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">这就完成了<code class="du mb mc md me b">MessageAdapter</code>类的代码。要查看<code class="du mb mc md me b">MessageAdapter.kt</code>的完整课程，请点击处的<a class="ae ki" href="https://github.com/AlexPrestonSB/SendbirdKotlinBlog/blob/master/app/src/main/java/com/example/sendbirdkotlinblog/adapters/MessageAdapter.kt" rel="noopener ugc nofollow" target="_blank">。</a></p><h1 id="7631" class="kq kr hx bd ks kt ku kv kw kx ky kz la jd lb je lc jg ld jh le jj lf jk lg lh bi translated">第三步。ChannelActivity.kt类</h1><p id="37a5" class="pw-post-body-paragraph jm jn hx jo b jp li iy jr js lj jb ju jv lk jx jy jz ll kb kc kd lm kf kg kh hb bi translated">现在我们已经实现了UI，并负责将UI连接到传递的数据的适配器，我们将实现<code class="du mb mc md me b">ChannelActivity.kt</code>。</p><p id="d53e" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">下面的类将:</p><ul class=""><li id="070d" class="ln lo hx jo b jp jq js jt jv lp jz lq kd lr kh ls lt lu lv bi translated">设置好<code class="du mb mc md me b">recyclerView</code>和<code class="du mb mc md me b">Adapter</code></li><li id="8096" class="ln lo hx jo b jp lw js lx jv ly jz lz kd ma kh ls lt lu lv bi translated">处理获得和进入通过<code class="du mb mc md me b">CreateChannelActivity </code>或<code class="du mb mc md me b">ChannelListActivity</code>的通道</li><li id="1ba5" class="ln lo hx jo b jp lw js lx jv ly jz lz kd ma kh ls lt lu lv bi translated">处理发送和接收消息</li></ul><p id="9cdc" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">首先，创建一个<code class="du mb mc md me b">ChannelActivity.kt</code>类。在<code class="du mb mc md me b">onCreate</code>函数中，我们将设置<code class="du mb mc md me b">contentView</code>并调用两个函数来处理设置。</p><p id="3c6f" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated"><code class="du mb mc md me b">onCreate</code></p><figure class="mg mh mi mj fd hk"><div class="bz dy l di"><div class="mm mn l"/></div></figure><p id="dc59" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">第一个函数设置了我们刚刚创建的<code class="du mb mc md me b">recyclerView</code>和<code class="du mb mc md me b">messageAdapter</code>。这段代码遵循实例化一个<code class="du mb mc md me b">recyclerView</code>的基本实现。确保为<code class="du mb mc md me b">messageAdapter</code>传递<code class="du mb mc md me b">Activity</code>的上下文，因为我们在设置图像时需要它，就像我们上面做的那样。</p><p id="57cd" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated"><code class="du mb mc md me b">setUpRecyclerView.kt</code></p><figure class="mg mh mi mj fd hk"><div class="bz dy l di"><div class="mm mn l"/></div></figure><p id="b2e4" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">第二个功能处理设置<strong class="jo hy">活动</strong>上的两个按钮:<strong class="jo hy">返回</strong>和<strong class="jo hy">发送</strong>。<strong class="jo hy">返回</strong>按钮不言而喻，下面我们重点介绍一下<strong class="jo hy">发送</strong>按钮。</p><p id="420d" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated"><code class="du mb mc md me b">setButtonListeners</code></p><figure class="mg mh mi mj fd hk"><div class="bz dy l di"><div class="mm mn l"/></div></figure><p id="210a" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">对于发送按钮，我们有一个叫做<code class="du mb mc md me b">sendMessage</code>的方法。该功能从<code class="du mb mc md me b">editText</code>中取出文本，并将其设置在<strong class="jo hy"> </strong> <code class="du mb mc md me b">UserMessageParams()</code>的参数上。使用<a class="ae ki" href="https://sendbird.com/docs/chat/v3/android/guides/group-channel#3-send-a-message" rel="noopener ugc nofollow" target="_blank"> UserMessageParams() </a>还可以做更多的事情，我鼓励你去看看，但是为了简单起见，我们将只添加消息。那我们就拿<code class="du mb mc md me b">groupChannel</code>实例和<code class="du mb mc md me b">sendMessage()</code>来说吧。一旦返回成功发送，我们将把它添加到适配器，然后清除<code class="du mb mc md me b">editText</code>。</p><p id="b6ac" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated"><code class="du mb mc md me b">sendMessage</code></p><figure class="mg mh mi mj fd hk"><div class="bz dy l di"><div class="mm mn l"/></div></figure><p id="8faf" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">现在我们已经讨论了<code class="du mb mc md me b">onCreate</code>呼叫的情况，让我们开始讨论<code class="du mb mc md me b">onResume</code> <strong class="jo hy"> </strong>呼叫。在这个调用中，我们将处理获取传递的通道，并注册通道处理程序来获取各种事件——在本例中是<code class="du mb mc md me b">onMessageReceived</code>事件。</p><p id="0655" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">首先，我们想从意图中获取<code class="du mb mc md me b">channelURL</code>。为了便于理解，我们将把它移到一个单独的方法中。</p><p id="4f4c" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated"><code class="du mb mc md me b">getChannelUrl</code></p><figure class="mg mh mi mj fd hk"><div class="bz dy l di"><div class="mm mn l"/></div></figure><p id="85ba" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">有了<code class="du mb mc md me b">channelURL</code>之后，我们将需要使用函数<code class="du mb mc md me b">GroupChannel.getChannel()</code>进行调用。这个调用将使用<code class="du mb mc md me b">channelUrl</code> <strong class="jo hy"> </strong>并检索通道对象来发送消息并获取相关的通道信息。一旦成功返回频道，设置频道并确保调用<code class="du mb mc md me b">getMessages()</code>。</p><p id="a9fb" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">这个函数非常简单。它创建一个<code class="du mb mc md me b"><a class="ae ki" href="https://sendbird.com/docs/chat/v3/android/guides/group-channel#3-load-previous-messages" rel="noopener ugc nofollow" target="_blank">previousMessageListQuery</a> </code>(这里也可以进行很多定制)，然后加载消息，最后在适配器上调用<code class="du mb mc md me b">loadMessages</code>。这将获取对话中所有以前的消息。该函数支持分页，因此您可以获得整个对话历史。</p><p id="69aa" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated"><code class="du mb mc md me b">getMessages()</code></p><figure class="mg mh mi mj fd hk"><div class="bz dy l di"><div class="mm mn l"/></div></figure><p id="01d6" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">在<code class="du mb mc md me b">onResume</code>调用中，我们需要做的最后一件事是设置一个通道处理程序。通道处理程序是您获取各种事件的方式，比如输入指示器、消息读取、消息传递事件和<code class="du mb mc md me b">onMessageReceived</code>事件。我们实现的唯一方法是<code class="du mb mc md me b"><a class="ae ki" href="https://sendbird.com/docs/chat/v3/android/guides/group-channel#3-receive-messages-through-a-channel-event-handler" rel="noopener ugc nofollow" target="_blank">onMessageReceived</a></code>。每当另一个用户发来消息时，都会触发此事件。一旦我们获得了事件，我们就将它添加到适配器中，如下面的代码所述。</p><p id="aa93" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated"><code class="du mb mc md me b">onResume()</code></p><figure class="mg mh mi mj fd hk"><div class="bz dy l di"><div class="mm mn l"/></div></figure><p id="b592" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">既然我们有一个<code class="du mb mc md me b">onResume</code>呼叫，让我们添加一个<code class="du mb mc md me b">onPause</code>。这里我们要做的唯一一件事就是移除通道处理程序进行清理。</p><p id="da25" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated"><code class="du mb mc md me b">onPause()</code></p><figure class="mg mh mi mj fd hk"><div class="bz dy l di"><div class="mm mn l"/></div></figure><p id="1918" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">这就完成了<code class="du mb mc md me b"> ChannelActivity</code>类的代码。参见<code class="du mb mc md me b">ChannelActivity.kt</code> <strong class="jo hy"> </strong> <a class="ae ki" href="https://github.com/AlexPrestonSB/SendbirdKotlinBlog/blob/master/app/src/main/java/com/example/sendbirdkotlinblog/ChannelActivity.kt" rel="noopener ugc nofollow" target="_blank">此处</a>的完成类。</p><h1 id="d84f" class="kq kr hx bd ks kt ku kv kw kx ky kz la jd lb je lc jg ld jh le jj lf jk lg lh bi translated">结论</h1><p id="9ecc" class="pw-post-body-paragraph jm jn hx jo b jp li iy jr js lj jb ju jv lk jx jy jz ll kb kc kd lm kf kg kh hb bi translated">在本教程中，我们讲述了如何:</p><ul class=""><li id="ab9f" class="ln lo hx jo b jp jq js jt jv lp jz lq kd lr kh ls lt lu lv bi translated">创建聊天用户界面</li><li id="4a6b" class="ln lo hx jo b jp lw js lx jv ly jz lz kd ma kh ls lt lu lv bi translated">连接聊天界面，以便能够发送/接收和显示消息</li></ul><p id="a712" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">本教程是你可以用<a class="ae ki" href="https://sendbird.com/docs/chat/v3/android/quickstart/send-first-message" rel="noopener ugc nofollow" target="_blank"> Sendbird SDK </a>做很多事情的垫脚石。借助我们刚刚实施的内容，您可以轻松开始:</p><ul class=""><li id="1a1b" class="ln lo hx jo b jp jq js jt jv lp jz lq kd lr kh ls lt lu lv bi translated">合并其他类型的消息</li><li id="4362" class="ln lo hx jo b jp lw js lx jv ly jz lz kd ma kh ls lt lu lv bi translated">为邮件生命周期添加更完整的视图</li><li id="930d" class="ln lo hx jo b jp lw js lx jv ly jz lz kd ma kh ls lt lu lv bi translated">添加推送通知、输入指示器、翻译等等</li></ul><p id="d16b" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">你做到了！您现在正在您的Android应用程序中通过聊天连接用户！查看我们的<a class="ae ki" href="http://sendbird.com/docs" rel="noopener ugc nofollow" target="_blank">文档</a>和<a class="ae ki" href="http://sendbird.com/developer" rel="noopener ugc nofollow" target="_blank">开发者门户</a>以构建更多功能。如果您有任何问题，请通过<a class="ae ki" href="https://community.sendbird.com/" rel="noopener ugc nofollow" target="_blank">社区网站</a>联系我们。同时，开心聊楼！🙂</p><blockquote class="kk kl km"><p id="a7a6" class="jm jn kj jo b jp jq iy jr js jt jb ju kn jw jx jy ko ka kb kc kp ke kf kg kh hb bi translated"><em class="hx">成为第一个了解新教程、开发者相关聊天/电话发布以及其他重要更新的人，</em> <a class="ae ki" href="https://get.sendbird.com/dev-newsletter-subscription.html" rel="noopener ugc nofollow" target="_blank"> <em class="hx">注册</em> </a> <em class="hx">获取我们的开发者简讯。</em></p></blockquote></div></div>    
</body>
</html>