<html>
<head>
<title>Fancy world of ipywidgets</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ipywidgets的奇幻世界</h1>
<blockquote>原文：<a href="https://medium.com/codex/fancy-world-of-ipywidgets-e3301de58bd7?source=collection_archive---------7-----------------------#2021-08-08">https://medium.com/codex/fancy-world-of-ipywidgets-e3301de58bd7?source=collection_archive---------7-----------------------#2021-08-08</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/c8dd4b3af0c1154a904f509f8af4bace.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*s4RjtnZ5v4pInmTa"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">瓦斯·索什尼科夫在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="e1a0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">作为数据科学家，我们总是需要以一种他们不会迷失在代码中的方式向观众解释我们的发现。我们没有太多的选择，我们最好的朋友是笔记本，即Jupyter笔记本。</p><p id="6b81" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Jupyter笔记本真的提供了一个很好的环境来解决问题并在过程中记录下来，并且以一种让非技术利益相关者感觉他们正在阅读博客文章的方式来呈现结果。这太棒了，至少在理论上是这样。但事实是，一些数据科学家(就是我)无法停止挖掘数据，尝试许多替代模型和参数，希望找到指标的微小增加，将发现留在身边，很难证明真正的观点。</p><p id="0c7b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">虽然我知道<a class="ae iu" href="https://ipywidgets.readthedocs.io/en/stable/" rel="noopener ugc nofollow" target="_blank"> ipywidgets </a>已经存在很多年了，但我还是在过去的几个月里体验了它们，并看到它们确实将笔记本带到了一个终极水平。现在我无法阻止自己将库默认导入到每个新笔记本中。我不打算写它是怎么安装的，你可以在这里找到它<a class="ae iu" href="https://ipywidgets.readthedocs.io/en/latest/user_install.html" rel="noopener ugc nofollow" target="_blank">。相反，我想展示我的经历，告诉你它是如何改变你的工作方式的。</a></p></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><p id="74fe" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，让我们从基础开始，导入库并添加一些交互性。向代码中添加交互性最简单的方法是@interact装饰器。这个装饰器允许处理参数，而不需要每次都运行单元。让我们看看我们如何能做到这一点。</p><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="6d08" class="kj kk hi kf b fi kl km l kn ko">from ipywidgets import interact<br/><a class="ae iu" href="http://twitter.com/interact" rel="noopener ugc nofollow" target="_blank">@interact</a><br/>def calculate(x=2):<br/>    print(x**2)</span></pre><figure class="ka kb kc kd fd ij er es paragraph-image"><div class="er es kp"><img src="../Images/b87e0d078e05f798c52ec3e707231a56.png" data-original-src="https://miro.medium.com/v2/resize:fit:756/format:webp/1*YxaEzYJLLPeIY60yb9SSvw.png"/></div></figure><p id="8cf2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">是的，我明白了，你不能用这个演示太多。让我们继续。</p><p id="54cd" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">会议中几乎总是有两种人，沉迷于图表的人和沉迷于桌子的人。因此，在这种情况下，我们可能需要用表格来显示图表。但是把它们一个接一个地展示出来并不是最漂亮的方式。所以看看这个。</p><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="4dac" class="kj kk hi kf b fi kl km l kn ko">from ipywidgets import interact, HBox, VBox, Output<br/>import pandas as pd<br/>import matplotlib.pyplot as plt</span><span id="da34" class="kj kk hi kf b fi kq km l kn ko"><a class="ae iu" href="http://twitter.com/interact" rel="noopener ugc nofollow" target="_blank">@interact</a><br/>def chart_and_table(filterby=['A','B','C']):<br/>    df = pd.DataFrame({'A':[23,45,26,43,67], 'B':[25,65,85,74,56], 'C':[23,65,87,89,65]})<br/>    <br/>    o1, o2 = Output(), Output()<br/>    scene = HBox([o1,o2])<br/>    display(scene)<br/>    <br/>    with o1:<br/>        df[[filterby]].plot(kind='bar')<br/>        plt.show()<br/>    with o2:<br/>        display(df[[filterby]])</span></pre><figure class="ka kb kc kd fd ij er es paragraph-image"><div class="er es kr"><img src="../Images/0acc4565dd5fce635c13ba311949ecf7.png" data-original-src="https://miro.medium.com/v2/resize:fit:916/format:webp/1*sS6p19sGKknH6dRwXIV89w.png"/></div></figure><p id="d5ee" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们首先创建一个虚拟数据帧来显示。然后创建两个<a class="ae iu" href="https://ipywidgets.readthedocs.io/en/latest/examples/Widget%20List.html?highlight=Output#Output" rel="noopener ugc nofollow" target="_blank">输出</a>对象来逐个显示图表和表格。然后把它们放到一个<a class="ae iu" href="https://ipywidgets.readthedocs.io/en/latest/examples/Widget%20List.html?highlight=HBox#HBox" rel="noopener ugc nofollow" target="_blank"> HBox </a>对象中，这个对象允许我们显示水平堆叠的窗口小部件。这里堆叠的小部件是输出。我们可以添加尽可能多的对象，并将它们与VBox相结合，以显示您需要的任意数量的输出。一个例子如下:</p><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="8eab" class="kj kk hi kf b fi kl km l kn ko">from ipywidgets import interact, HBox, VBox, Output, HTML, Layout<br/>import pandas as pd<br/>import matplotlib.pyplot as plt</span><span id="2547" class="kj kk hi kf b fi kq km l kn ko"><a class="ae iu" href="http://twitter.com/interact" rel="noopener ugc nofollow" target="_blank">@interact</a><br/>def chart_and_table(filterby=['A','B','C']):<br/>    df = pd.DataFrame({'A':[23,45,26,43,67], 'B':[25,65,85,74,56], 'C':[23,65,87,89,65]})<br/>    <br/>    style="""<br/>        &lt;style&gt;<br/>            .style_a {background-color:#fafaaa}<br/>            .style_b {background-color:#faaafa}<br/>            .style_c {background-color:#aafafa}<br/>        &lt;/style&gt;<br/>    """<br/>    display(HTML(style))<br/>    <br/>    o1 = Output(layout=Layout(width='400px'))<br/>    o2 = Output(layout=Layout(width='200px')) <br/>    o3 = Output()<br/>    o4 = Output()<br/>    scene = HBox([o1,<br/>                  o2,<br/>                  VBox([o3, o4])<br/>                 ])<br/>    display(scene)<br/>    <br/>    with o1:<br/>        df[[filterby]].plot(kind='bar')<br/>        plt.show()<br/>    with o2:<br/>        display(df[[filterby]])<br/>    with o3:<br/>        if filterby=='A':<br/>            o3.add_class('style_a')<br/>        elif filterby=='B':<br/>            o3.add_class('style_b')<br/>        elif filterby=='C':<br/>            o3.add_class('style_c')<br/>        print('The selected filter is :', filterby)<br/>    with o4:<br/>        display(df)</span></pre><figure class="ka kb kc kd fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ks"><img src="../Images/97185013f382cba9ab4f29f9280215ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9YSakOnug3y2mTIZLBO1lg.png"/></div></div></figure><p id="062d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">你看，在单个单元格输出中，我们可以显示四种不同类型的信息。这为解释我们的发现带来了一个很好的机会，而不用在单元格之间滚动。这里，除了前面的显示，我们还添加了一个<a class="ae iu" href="https://ipywidgets.readthedocs.io/en/latest/examples/Widget%20List.html?highlight=HTML#HTML" rel="noopener ugc nofollow" target="_blank"> HTML </a>对象，它不仅允许我们在显示输出中显示任何HTML代码，还允许我们插入css样式。在HTML对象中，我们放置了一些css样式，我们将使用这些样式根据所选的过滤器来改变输出的颜色。然后我们添加带有布局参数的布局对象来设置输出的宽度。最后，我们根据选择的过滤器将样式类添加到输出对象中。</p></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><p id="a903" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">到目前为止一切顺利。我们可以在细胞内建立一个微小的世界来玩我们的参数。一旦你感受到这种自由，你会渴望更多。现在，让我们看看更多的互动。这一次我们将把小部件的动作相互结合起来。让我们看看。</p><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="4fc4" class="kj kk hi kf b fi kl km l kn ko">from ipywidgets import interact, HBox, VBox, Output, HTML, Dropdown, Button, Layout, Label<br/>from IPython.display import display, clear_output<br/>import pandas as pd<br/>import matplotlib.pyplot as plt<br/>import datetime as dt<br/>class demo():<br/>    def __init__(self):<br/>        self.df = pd.DataFrame({'A':[23,45,26,43,67], 'B':[25,65,85,74,56], 'C':[23,65,87,89,65]})<br/>        <br/>        style="""<br/>            &lt;style&gt;<br/>                /* enlarges the default jupyter cell outputs, can revert by Cell-&gt;Current Outputs-&gt;Clear */<br/>                .container { width:1020 !important; } <br/>                <br/>                /* styles for output widgets */<br/>                .o2 {width:400px; border:1px solid #ddd}<br/>                .o3 {width:400px; border:1px solid #ddd}<br/>                .o4 {width:400px; border:1px solid #ddd}<br/>                .o5 {width:800px; }<br/>                .o5 span {color:red !important}<br/>                <br/>                /* custom styles for testing */<br/>                .style_A {background-color:#fafaaa}<br/>                .style_B {background-color:#faaafa}<br/>                .style_C {background-color:#aafafa}<br/>            &lt;/style&gt;<br/>        """<br/>        display(HTML(style))<br/>        self.o1 = Output(layout=Layout(width='400px'))<br/>        <br/>        self.o2 = Output() <br/>        self.o2.add_class('o2')<br/>        self.o3 = Output()<br/>        self.o3.add_class('o3')<br/>        self.o4 = Output()<br/>        self.o4.add_class('o4')<br/>        self.o5 = Output()<br/>        self.o5.add_class('o5')<br/>        # create a scene for displaying the outputs, <br/>        # Output1 on the top row, 2,3, and 4 stacked horizontally in the second row<br/>        scene = VBox([self.o1,<br/>                      HBox([self.o2, self.o3, self.o4]),<br/>                      self.o5<br/>                     ])<br/>        display(scene)<br/>    <br/>        with self.o1:<br/>            display(HTML('&lt;h2&gt;Demo&lt;/h2&gt;'))<br/>            <br/>        with self.o2:<br/>            self.dd_filter = Dropdown(description='Select Filter', options=['', 'A','B','C'])<br/>            self.dd_filter.observe(self.fill_values)<br/>            <br/>            self.dd_values = Dropdown(description='Select Value')<br/>            <br/>            self.btn = Button(description='Run')<br/>            self.btn.on_click(self.display_results)<br/>            <br/>            display(self.dd_filter, self.dd_values, self.btn)<br/>            <br/>            <br/>    def fill_values(self,x):<br/>        if x['type'] == 'change' and x['name'] == 'value':<br/>            filter_by = x['owner'].value<br/>            <br/>            if filter_by=='':<br/>                filter_values = []<br/>            else:<br/>                filter_values = self.df[filter_by].values<br/>            self.dd_values.options = filter_values<br/>        <br/>    def display_results(self, x):<br/>        filter_by = self.dd_filter.value<br/>        filter_val = self.dd_values.value<br/>        <br/>        if filter_by=='':<br/>            with self.o3:<br/>                clear_output()<br/>                print('Please select filter')<br/>            return<br/>        <br/>        df_filtered = self.df[self.df[filter_by]&gt;=filter_val]<br/>        <br/>        with self.o3:<br/>            clear_output()<br/>            lbl = Label(value=f'Filter by {filter_by}, with {filter_val}, found {df_filtered.shape[0]} observation(s)')<br/>            lbl.add_class(f'style_{filter_by}')<br/>            display(lbl)<br/>            display(df_filtered)<br/>            <br/>        with self.o4:<br/>            clear_output()<br/>            df_filtered.plot(kind='bar')<br/>            plt.show()<br/>            <br/>        with self.o5:<br/>            clear_output()<br/>            display(Label(value= f'Code last run {dt.datetime.now().strftime("%Y-%m-%d %H:%M:%S")}' ))<br/>            <br/>        <br/>d = demo()</span></pre><p id="8310" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这次我们更进一步，利用面向对象编程的优势。我们创建一个类对象来存储所有的小部件并维护它们之间的交互。我们的类由三个函数组成。</p><p id="f34f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">第一个是“__init__”函数，一旦用d=demo()行初始化了类，就会调用这个函数。在这个函数中，我们首先构造我们的数据帧，并把它赋给一个df变量，通过添加“self”使它在整个类中可访问关键词在前面。然后，我们创建样式和输出小部件，并像前面的例子一样显示它们。再次，我们把“自我”以提供类内的可访问性。与前面的例子不同，我们手动创建Dropdown小部件，而不是@interact decorator，并设置“observe”参数，以便能够跟踪它的select事件。我们将一个名为“fill_values”的函数传递给这个参数，并将根据dataframe的选定列填充第二个下拉列表值。一旦用户从这个下拉列表中选择了一个值，就会调用“fill_values”函数，并用该列下的值填充第二个下拉列表。</p><p id="1eb5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然后我们添加一个按钮来触发主作业“display_results”。单击此按钮后，调用“display_results”函数，首先从下拉列表中读取值，相应地过滤数据帧，清除输出3、4和5中的现有输出，并用所需的输出填充它们。</p><p id="05a0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">最后，借助<a class="ae iu" href="https://github.com/ipython-contrib/jupyter_contrib_nbextensions" rel="noopener ugc nofollow" target="_blank"> Jupyter笔记本扩展</a>‘nb extensions’隐藏输入扩展，整个笔记本可以显示如下。</p><figure class="ka kb kc kd fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kt"><img src="../Images/e244cfd22dc3e619fbf9857f7befba04.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ESATKJh6OjGYZVBP8cHbCQ.png"/></div></div></figure><h1 id="ebf6" class="ku kk hi bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">结论</h1><p id="4778" class="pw-post-body-paragraph iv iw hi ix b iy lr ja jb jc ls je jf jg lt ji jj jk lu jm jn jo lv jq jr js hb bi translated">如你所见，你只受限于你的想象力。你可以对你的发现进行令人印象深刻的演示，并轻松地保持观众的注意力，而不会迷失在你的草图单元中。</p><p id="527e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">下面我放了一张我最新演示的截图，希望它有助于为这些小工具的使用提供一些直觉。</p><figure class="ka kb kc kd fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lw"><img src="../Images/037e23de38cf4acfe3a4807e3d3aa63f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6DVJLem3nx5Q5t8HQqKSfw.png"/></div></div></figure><h1 id="7245" class="ku kk hi bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">参考</h1><div class="lx ly ez fb lz ma"><a href="https://ipywidgets.readthedocs.io/en/stable/index.html" rel="noopener  ugc nofollow" target="_blank"><div class="mb ab dw"><div class="mc ab md cl cj me"><h2 class="bd hj fi z dy mf ea eb mg ed ef hh bi translated">ipywidgets - Jupyter小部件7.6.2文档</h2><div class="mh l"><h3 class="bd b fi z dy mf ea eb mg ed ef dx translated">编辑描述</h3></div><div class="mi l"><p class="bd b fp z dy mf ea eb mg ed ef dx translated">ipywidgets.readthedocs.io</p></div></div></div></a></div></div></div>    
</body>
</html>