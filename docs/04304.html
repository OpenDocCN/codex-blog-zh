<html>
<head>
<title>How to interact with Memcached using Telnet, Netcat, Python, or Django</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Telnet、Netcat、Python或Django与Memcached交互</h1>
<blockquote>原文：<a href="https://medium.com/codex/how-to-interact-with-memcached-using-telnet-netcat-python-or-django-b88788b71375?source=collection_archive---------0-----------------------#2021-11-20">https://medium.com/codex/how-to-interact-with-memcached-using-telnet-netcat-python-or-django-b88788b71375?source=collection_archive---------0-----------------------#2021-11-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="f317" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这比你想象的要容易</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/f59f4765b26a0e44efb3d3b279d74619.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*0QPaoEhQrSFKmY8R"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">Joshua Sortino 在<a class="ae jt" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><h1 id="ff38" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">背景</h1><p id="7ff8" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">缓存是一种提高程序或网站性能的技术。主要思想是将昂贵的操作、查询或计算的结果存储到一个位置，以便将来类似的调用/请求不需要再次重做，它将只返回存储的值。</p><p id="6e48" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">由于I/O操作缓慢，文件或数据库不是很好的缓存存储，而利用RAM要快得多。Memcached非常流行，用于扩展大型项目，如脸书、YouTube、Twitter、维基百科等。一旦你的网站有了显著的流量，Memcached就是提高性能的有效方法之一。</p><p id="2e1c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">Memcached</strong>(<strong class="ih hj">Mem</strong>ory<strong class="ih hj">Cache D</strong>aemon)是一个内存缓存服务器。Telnet、Netcat、Python和Django可以充当<strong class="ih hj">客户端</strong>。Memcached将数据作为键值对存储在RAM中，因此它可以被视为一个巨大但快速的Python字典。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kx"><img src="../Images/d70624b0d6c392be0879ab4d13372ea9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6sq8d0glJ1xo8PZKvRcHYQ.png"/></div></div></figure><h1 id="1490" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">Memcached服务器</h1><p id="789d" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">关于安装，参见<a class="ae jt" href="https://github.com/memcached/memcached/wiki/Install" rel="noopener ugc nofollow" target="_blank">https://github.com/memcached/memcached/wiki/Install</a>。</p><p id="d631" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于Mac用户来说，通过自制软件安装很容易:</p><p id="336c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ky kz la lb b">brew install memcached</code></p><p id="1f51" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要运行它:</p><p id="4ebe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ky kz la lb b">brew services start memcached</code></p><p id="2cf6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">检查它是否正在运行(对于类Unix系统):</p><p id="14a0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ky kz la lb b">ps aux | grep memcached</code></p><h1 id="556c" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">Telnet客户端</h1><p id="3056" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated"><a class="ae jt" href="https://en.wikipedia.org/wiki/Telnet" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj">telnet</strong></a><strong class="ih hj"/>(<code class="du ky kz la lb b"><strong class="ih hj">tel</strong>etype <strong class="ih hj">net</strong>work</code>)是一项古老的技术，创建于60年代，因为当时的计算机非常昂贵，而且体积庞大，无法在家中使用。这是一种连接到远程计算机的机制。<strong class="ih hj"> ssh </strong> ( <code class="du ky kz la lb b"><strong class="ih hj">s</strong>ecure <strong class="ih hj">sh</strong>ell</code>)是<em class="lc"> telnet </em>的继任者，主要是为了增加安全性。使用<em class="lc"> telnet </em>你可以使用<em class="lc"> telnet </em>协议与服务器通信。你甚至可以在你的终端上下棋，试试看:</p><p id="3a4a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ky kz la lb b"><strong class="ih hj">telnet</strong> www.freechess.org</code></p><p id="d3cf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">与<code class="du ky kz la lb b">memcached</code>沟通的方式有很多种，via <em class="lc"> telnet </em>就是其中之一。<strong class="ih hj">主机</strong>和<strong class="ih hj">端口</strong>都是必需的，<code class="du ky kz la lb b">11211</code>是<code class="du ky kz la lb b">memcached</code>的默认端口:</p><p id="3a09" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ky kz la lb b"><strong class="ih hj">telnet</strong> localhost 11211</code></p><p id="dc80" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这将显示<em class="lc"> telnet </em>提示符:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ld"><img src="../Images/d6f78cb0dadcd3fe9c9b64dbbf0f2d7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:712/format:webp/1*Ls4Wc3tA3Pb6nKqV_ZJ9kA.png"/></div></figure><p id="612e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后我们可以开始输入<code class="du ky kz la lb b">memcached</code>命令，如<strong class="ih hj"> set </strong>、<strong class="ih hj"> get </strong>、<strong class="ih hj"> delete </strong>或<strong class="ih hj"> flush_all </strong>:</p><pre class="je jf jg jh fd le lb lf lg aw lh bi"><span id="c6bd" class="li jv hi lb b fi lj lk l ll lm"># Caches <em class="lc">foo</em> with the value of <em class="lc">bar</em> for 5 minutes (300 seconds).<br/># Default timeout is 0 (i.e. no expiration).<br/># Syntax: <strong class="lb hj">set</strong> KEY FLAGS TIMEOUT SIZE<br/># FLAGS usually is just 0.<br/># SIZE is the number of characters.<br/># the <em class="lc">bar</em> value is inputted in the next line.<br/><strong class="lb hj">set</strong> foo 0 300 3<br/>bar</span><span id="7738" class="li jv hi lb b fi ln lk l ll lm"># Returns <em class="lc">bar</em>.<br/><strong class="lb hj">get</strong> foo</span><span id="51cd" class="li jv hi lb b fi ln lk l ll lm"># Deletes <em class="lc">foo</em>.<br/><strong class="lb hj">delete</strong> foo</span><span id="0429" class="li jv hi lb b fi ln lk l ll lm"># Deletes all keys.<br/><strong class="lb hj">flush_all</strong></span></pre><p id="0891" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面是一个运行示例:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lo"><img src="../Images/b1cd2a0287e75da188259e225b8c2dc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1084/1*w0-qiBgqN0reUKlewCIQUw.gif"/></div></figure><p id="c7b1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">更多细节和其他命令，见<a class="ae jt" href="https://github.com/memcached/memcached/wiki/Commands" rel="noopener ugc nofollow" target="_blank">https://github.com/memcached/memcached/wiki/Commands</a></p><h1 id="2842" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">Netcat客户端</h1><p id="3b7d" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated"><code class="du ky kz la lb b"><a class="ae jt" href="https://en.wikipedia.org/wiki/Netcat" rel="noopener ugc nofollow" target="_blank">nc</a></code> ( <code class="du ky kz la lb b"><strong class="ih hj">n</strong>et<strong class="ih hj">c</strong>at</code>)是一个Unix CLI工具，主要用于网络检查或调试。它可以通过TCP协议与<code class="du ky kz la lb b">memcached</code>服务器通信。我们可以使用<code class="du ky kz la lb b">echo</code>语句将<code class="du ky kz la lb b">memcached</code>命令输入其中。</p><p id="582a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，要快速检查缓存键的值，使用<code class="du ky kz la lb b">nc</code>比<code class="du ky kz la lb b">telnet</code>更方便:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lp"><img src="../Images/1ad0a8871c899c198ddcd008212b4448.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/1*lQ3klfQp4zTOGq2HozVH-w.png"/></div></figure><p id="b336" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">并刷新所有按键，这是重启<code class="du ky kz la lb b">memcached </code>或使用<code class="du ky kz la lb b">telnet</code>的便捷替代方式:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lq"><img src="../Images/8735179cd99f78e25517ba66f01fc9f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1004/format:webp/1*P9C6MQ1jRMAh80oysbl1PQ.png"/></div></figure><p id="b1da" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以下是使用<code class="du ky kz la lb b">nc</code>的四个<code class="du ky kz la lb b">memcached</code>命令:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lr"><img src="../Images/6828ef07c16dddf398f36ae0747372ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-g8AXyrysw4zB75CMDBzRQ.png"/></div></div></figure><p id="9baa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">同样，为它们创建shell函数更有效(将这些放在<code class="du ky kz la lb b">.bashrc</code>或<code class="du ky kz la lb b">.zshrc</code>中):</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ls"><img src="../Images/148114cbf06dc23afbbd55a65c5e8361.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JHjZ3THKLPpkAW5oz89AdQ.png"/></div></div></figure><p id="86ad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以，现在我们<strong class="ih hj"> </strong>可以简单地将它们运行为<strong class="ih hj"> cache_set </strong>、<strong class="ih hj"> cache_get </strong>、<strong class="ih hj"> cache_delete </strong>和<strong class="ih hj"> cache_clear </strong>:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lt"><img src="../Images/022148a71686513a3c24fa426cfea577.png" data-original-src="https://miro.medium.com/v2/resize:fit:848/format:webp/1*I0puCotCbfg-BBppYb7x3w.png"/></div></figure><h1 id="7e65" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">Python客户端</h1><p id="effe" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">Python中实现了很多<code class="du ky kz la lb b">memcached</code>客户端。虽然它们有类似的API(<strong class="ih hj">set</strong>()，<strong class="ih hj"> get </strong>()，<strong class="ih hj"> delete </strong>()，<strong class="ih hj"> flush_all </strong>())。其中比较受欢迎的就是<code class="du ky kz la lb b"><a class="ae jt" href="https://github.com/linsomniac/python-memcached" rel="noopener ugc nofollow" target="_blank">python-memcached</a></code>。要安装:</p><p id="e4e0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ky kz la lb b">pip install python</code></p><p id="e3bd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它很容易使用:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lu"><img src="../Images/b984df6a215645ceb7c28636cecdab10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1292/format:webp/1*rFXEUKBK1sX8LC3lFhHFmw.png"/></div></figure><h1 id="970e" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">Django客户</h1><p id="2ac5" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">Django可以使用各种缓存后端:文件、数据库、内存等。<a class="ae jt" href="https://docs.djangoproject.com/en/dev/topics/cache/" rel="noopener ugc nofollow" target="_blank">缓存API </a>是一个一致的接口，因此当您决定切换缓存后端时，您的代码不会改变。我们只需要定义<strong class="ih hj">缓存</strong> Django设置。默认的缓存后端是<strong class="ih hj">本地内存缓存</strong> ( <code class="du ky kz la lb b">django.core.cache.backends.locmem.<strong class="ih hj">LocMemCache</strong></code>)，它也将利用RAM。因此，对于<code class="du ky kz la lb b">memcached</code>，我们使用<code class="du ky kz la lb b">MemcachedCache</code>类:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lv"><img src="../Images/86b6cb18fee1d45282847f17264686a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d7nW06EbMFzBF87VgpUXRA.png"/></div></div></figure><p id="f0ac" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后我们可以调用缓存API方法。这里的代码与上面的Python代码非常相似。但是，请注意Django使用了<code class="du ky kz la lb b">clear()</code>而不是<code class="du ky kz la lb b">flush_all()</code>:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lu"><img src="../Images/8b691114333a57c745bfd29494a874ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1292/format:webp/1*VMScI7TsUJrku8sppcTWkg.png"/></div></figure><p id="0e19" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了检查它是否确实存储在<code class="du ky kz la lb b">memcached</code>中，我们需要使用<code class="du ky kz la lb b"><strong class="ih hj">get</strong> :1:foo</code>格式，而不是简单的<code class="du ky kz la lb b"><strong class="ih hj">get</strong> foo</code>，因为Django使用了一个<a class="ae jt" href="https://docs.djangoproject.com/en/dev/ref/settings/#key-function" rel="noopener ugc nofollow" target="_blank">缓存键函数</a>来生成这个字符串模式:</p><p id="65f9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ky kz la lb b">PREFIX:VERSION:<strong class="ih hj">KEY</strong></code></p><p id="18a3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">其中，默认值为:</p><pre class="je jf jg jh fd le lb lf lg aw lh bi"><span id="ff85" class="li jv hi lb b fi lj lk l ll lm">PREFIX = ''<br/>VERSION = 1</span></pre><p id="ec31" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，我们最终得到了<code class="du ky kz la lb b">:1:<strong class="ih hj">foo</strong></code>结果键。我们可以使用<code class="du ky kz la lb b">nc</code>来验证这一点:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lw"><img src="../Images/b098354263a94f9415ea3ef652e204e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1048/format:webp/1*-aBxK_V4gBmzFlbnAtFP2g.png"/></div></figure><p id="5302" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">或者使用我们为它创建的shell函数:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lx"><img src="../Images/7d052dc03fa4450d736b2cb9ad96e7f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:528/format:webp/1*uj3VLPscJmOLnX9GdNBjzA.png"/></div></figure><h1 id="62b4" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">关键要点</h1><ul class=""><li id="78f0" class="ly lz hi ih b ii ks im kt iq ma iu mb iy mc jc md me mf mg bi translated">Memcached功能强大，易于设置，也易于学习。</li><li id="2995" class="ly lz hi ih b ii mh im mi iq mj iu mk iy ml jc md me mf mg bi translated">各种工具中的命令相对一致:</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mm"><img src="../Images/57a3650f85e01a4a28f8148649eb6edd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e8NHBLigb627Se6-a7BZxQ.png"/></div></div></figure><ul class=""><li id="7577" class="ly lz hi ih b ii ij im in iq mn iu mo iy mp jc md me mf mg bi translated">对于<code class="du ky kz la lb b">netcat</code> ( <code class="du ky kz la lb b">nc</code>)，最好使用我们实现的<strong class="ih hj"> cache_set </strong>、<strong class="ih hj"> cache_get </strong>、<strong class="ih hj"> cache_delete </strong>、<strong class="ih hj"> cache_clear </strong> shell函数，尤其是真正方便的<strong class="ih hj"> cache_get </strong>和<strong class="ih hj"> cache_clear </strong>。</li><li id="d5f3" class="ly lz hi ih b ii mh im mi iq mj iu mk iy ml jc md me mf mg bi translated">为了简洁起见，我们在本文中只使用了<code class="du ky kz la lb b">'foo': 'bar'</code>作为示例键值对。但是即使使用更复杂的对象/结构，原理仍然是相同的。</li></ul></div><div class="ab cl mq mr gp ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="hb hc hd he hf"><p id="bf8d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi mx translated">感谢您的阅读。如果你发现了一些有价值的东西，请关注我，或者给文章鼓掌/评论，或者<a class="ae jt" href="https://ko-fi.com/ranelpadon" rel="noopener ugc nofollow" target="_blank">请我喝杯咖啡</a>。这对我意义重大，鼓励我创作更多高质量的内容。</p></div></div>    
</body>
</html>