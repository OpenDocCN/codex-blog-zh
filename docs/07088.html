<html>
<head>
<title>Build a Data pipeline for online store sales deep analysis — elasticsearch — logstash</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为在线商店销售构建数据管道深度分析— elasticsearch — logstash</h1>
<blockquote>原文：<a href="https://medium.com/codex/build-a-data-pipeline-for-online-store-sales-deep-analysis-elasticsearch-logstash-680a7c8e3097?source=collection_archive---------8-----------------------#2022-05-29">https://medium.com/codex/build-a-data-pipeline-for-online-store-sales-deep-analysis-elasticsearch-logstash-680a7c8e3097?source=collection_archive---------8-----------------------#2022-05-29</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/47e56d9bbb155feb131a4b667776dbee.png" data-original-src="https://miro.medium.com/v2/resize:fit:760/format:webp/1*LsRycDX-Gl7i-Goz--sp2w.jpeg"/></div></figure><h1 id="b104" class="im in hi bd io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj bi translated">那么，用例是什么呢？</h1><p id="bf55" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">我们是一家网上商店，我们希望有效地了解我们的销售行为、退货率，并根据每个产品预测我们的销售额。我们希望获得这种可见性的原因(我需要强调的不是一次性视图或批处理视图，而是这些关键指标的持续实时视图)，是因为我们想知道:</p><ul class=""><li id="4fec" class="ki kj hi jm b jn kk jr kl jv km jz kn kd ko kh kp kq kr ks bi translated">哪种产品销售最多，销售速度如何，影响销售的因素是什么。</li><li id="0925" class="ki kj hi jm b jn kt jr ku jv kv jz kw kd kx kh kp kq kr ks bi translated">我们的回报是什么</li><li id="510b" class="ki kj hi jm b jn kt jr ku jv kv jz kw kd kx kh kp kq kr ks bi translated">哪些产品将在未来几周销售</li></ul><p id="07f9" class="pw-post-body-paragraph jk jl hi jm b jn kk jp jq jr kl jt ju jv ky jx jy jz kz kb kc kd la kf kg kh hb bi translated">最后，我们希望最大化利润，尽我们所能降低T2的损失。</p><p id="2e38" class="pw-post-body-paragraph jk jl hi jm b jn kk jp jq jr kl jt ju jv ky jx jy jz kz kb kc kd la kf kg kh hb bi translated">好，既然我们已经解决了这个问题——让我们开始工作吧。我们从哪里开始？🤔 …</p><p id="e480" class="pw-post-body-paragraph jk jl hi jm b jn kk jp jq jr kl jt ju jv ky jx jy jz kz kb kc kd la kf kg kh hb bi translated">我们的在线商店有一个API，我们可以从中提取数据，下面是json有效载荷。</p><figure class="lb lc ld le fd ij"><div class="bz dy l di"><div class="lf lg l"/></div><figcaption class="lh li et er es lj lk bd b be z dx translated">源json格式</figcaption></figure><p id="d850" class="pw-post-body-paragraph jk jl hi jm b jn kk jp jq jr kl jt ju jv ky jx jy jz kz kb kc kd la kf kg kh hb bi translated">当我们把这个有效载荷按原样载入<strong class="jm hj"> elasticsearch </strong>时，下面是它的样子。这对于使用数据☹️进行任何工作都不理想😭</p><figure class="lb lc ld le fd ij er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es ll"><img src="../Images/684fd322cbbbe8c7de4ab130d1735562.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K7P2dFYic5__TNmrYR_uoA.png"/></div></div></figure><p id="bc54" class="pw-post-body-paragraph jk jl hi jm b jn kk jp jq jr kl jt ju jv ky jx jy jz kz kb kc kd la kf kg kh hb bi translated">elasticsearch之所以这样显示，是因为[ <strong class="jm hj"> sales </strong> ]字段是一个对象数组，所以我们需要做的是在我们的ETL工具(<strong class="jm hj"> logstash </strong>)中设置一个“<strong class="jm hj"> split </strong>”过滤器，在包含对象的字段上拆分事件，如下所示。除此之外，我们需要我们的时间序列数据是基于订单日期。为此，我们使用“<strong class="jm hj">日期</strong>”过滤器来匹配<strong class="jm hj"> <em class="lq">订单日期</em> </strong>格式，并将其用作摄取时间戳，一旦处理完毕，我们就不再需要消息字段，因此我们将其删除。最后一件重要的事情是，我们需要将我们的<strong class="jm hj"> <em class="lq">文档id </em> </strong>设置为一个唯一的标识符——这将确保我们不会重复进入的事件，为此我们使用<strong class="jm hj"> order_id </strong>。</p><figure class="lb lc ld le fd ij"><div class="bz dy l di"><div class="lf lg l"/></div></figure><p id="9d85" class="pw-post-body-paragraph jk jl hi jm b jn kk jp jq jr kl jt ju jv ky jx jy jz kz kb kc kd la kf kg kh hb bi translated">一旦管道开始运行，下面是现在弹性如何吸收它:</p><figure class="lb lc ld le fd ij er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es lr"><img src="../Images/3061cabbbc1967936051e476563b9bb7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qyHOTv68ITT8FumEfmLPHw.png"/></div></div></figure><p id="52c4" class="pw-post-body-paragraph jk jl hi jm b jn kk jp jq jr kl jt ju jv ky jx jy jz kz kb kc kd la kf kg kh hb bi translated">干得好的👏🏿—你把数据输入我们的<strong class="jm hj">分析平台</strong>。现在，真正的工作开始了。让我们建立可视化和仪表板来回答我们的问题。</p><h2 id="0bd3" class="ls in hi bd io lt lu lv is lw lx ly iw jv lz ma ja jz mb mc je kd md me ji mf bi translated"><strong class="ak">第一个问题</strong> —到目前为止，我们在一段时间内的总销售额是多少:</h2><figure class="lb lc ld le fd ij er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es mg"><img src="../Images/9933d48933d410bc955f3c6f489f025e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RFz1m0NdIvT8-n6IXThoMA.png"/></div></div><figcaption class="lh li et er es lj lk bd b be z dx translated">销售与退货</figcaption></figure><figure class="lb lc ld le fd ij er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es lr"><img src="../Images/ed4b11b160ab3b91ee9e892ec775bd0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uHLA1ypBwb5yTHNmwWdjGg.png"/></div></div><figcaption class="lh li et er es lj lk bd b be z dx translated">退回的项目</figcaption></figure><h2 id="37b2" class="ls in hi bd io lt lu lv is lw lx ly iw jv lz ma ja jz mb mc je kd md me ji mf bi translated">第二个问题—销售在我们产品中的分布是怎样的:</h2><figure class="lb lc ld le fd ij er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es mh"><img src="../Images/ff74424d0b1f2531ed84fbc0c8e46008.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PkIccQBydzUq_8jytaIuOg.png"/></div></div><figcaption class="lh li et er es lj lk bd b be z dx translated">销售额分成一个馅饼</figcaption></figure><h2 id="793d" class="ls in hi bd io lt lu lv is lw lx ly iw jv lz ma ja jz mb mc je kd md me ji mf bi translated">第三个问题——在我们产品的生命周期中，我们会根据季节、特价和其他情况改变价格。一种产品每种价格的销售额是多少？这很重要，因为我们想知道高销售额的因素是什么。价格有影响吗？</h2><p id="3465" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">例如，在这里，我们的“健身有氧自行车”以2种不同的价格出售，尽管价格很高，但最高的价格似乎卖得最多。这是什么意思？较低的价格不是影响销售的因素，而是产品和时间的可见性(这些销售是何时发生的)</p><figure class="lb lc ld le fd ij er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es mh"><img src="../Images/b3a40a14c0a023d6c657f0cfd5b3fd20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vpq80aivkUMV9FHCLRWgTA.png"/></div></div></figure><h2 id="f2f6" class="ls in hi bd io lt lu lv is lw lx ly iw jv lz ma ja jz mb mc je kd md me ji mf bi translated">4日——我们每天的最低、平均和最高销售额是多少？</h2><figure class="lb lc ld le fd ij er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es mi"><img src="../Images/1e2ef45087ba3f29e28987c572691a52.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WsSC6U5AKIEZ6oga_Co2kg.png"/></div></div></figure><h2 id="97fa" class="ls in hi bd io lt lu lv is lw lx ly iw jv lz ma ja jz mb mc je kd md me ji mf bi translated">第五，有了足够的数据，我们可以建立一个异常检测作业，它将从我们的销售模式中学习，并能够预测每种产品的销售或退货😎</h2><p id="d0c4" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">这是我们销售模式的异常检测作业的配置。这是按产品细分的<strong class="jm hj"> <em class="lq">事件率</em> </strong>计数。我们从产品在我们的时间序列日志中出现的频率来看，一次出现就是一次销售。选择你的影响者领域— <strong class="jm hj">非常重要的</strong>，这里你要定义是什么让异常成为异常。在我们的例子中，它是产品的标题，因为我们的工作是基于按产品标题分解的事件率。</p><figure class="lb lc ld le fd ij er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es lr"><img src="../Images/593d987934b0752dfb2ce6393bf9fe75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dr2pPbTdZJDMiYniAv3z4w.png"/></div></div></figure><p id="1770" class="pw-post-body-paragraph jk jl hi jm b jn kk jp jq jr kl jt ju jv ky jx jy jz kz kb kc kd la kf kg kh hb bi translated">这项工作已经过分析，可以开始工作了。灰色区域是<strong class="jm hj"> <em class="lq">下层</em> </strong>和<strong class="jm hj"> <em class="lq">上层</em> </strong>学习模型。它越接近行数，模型就越好，越精确。它越宽，模型越不精确。我们还没有一个非常好的模型…但是我们至少在这个练习中有了一个。我将用这个数据集解释红色异常背后的原因。</p><figure class="lb lc ld le fd ij er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es lr"><img src="../Images/9a1aaae15498ca42fab3e3c4d81066e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1qXh3Zbv1qWMizTBgDBlrg.png"/></div></div></figure><figure class="lb lc ld le fd ij er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es lr"><img src="../Images/513b6b860ff0563f0fc6f6ea0398e9b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z4DKBwVeCnBEpVIwKxmi2Q.png"/></div></div></figure><p id="dff3" class="pw-post-body-paragraph jk jl hi jm b jn kk jp jq jr kl jt ju jv ky jx jy jz kz kb kc kd la kf kg kh hb bi translated">我们的模型检测到“健身有氧健身车”这款产品的<strong class="jm hj"> <em class="lq">销售额异常低</em> </strong>，原因是在此期间，该产品因产品图像增强而被禁用，因此无法销售。</p><figure class="lb lc ld le fd ij er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es mj"><img src="../Images/8f93487f4fe12f67c8938f9bcb68d109.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U5KshLNd0bTAj2zHv6U6Sg.png"/></div></div><figcaption class="lh li et er es lj lk bd b be z dx translated">检测到异常—销售数量减少</figcaption></figure><p id="514a" class="pw-post-body-paragraph jk jl hi jm b jn kk jp jq jr kl jt ju jv ky jx jy jz kz kb kc kd la kf kg kh hb bi translated">我们可以清楚地看到，我们的模型预期销售额在3到9之间，但收到的远低于这个数字。</p><p id="ac76" class="pw-post-body-paragraph jk jl hi jm b jn kk jp jq jr kl jt ju jv ky jx jy jz kz kb kc kd la kf kg kh hb bi translated">现在，让我们预测未来7天(一周)每件产品的销售额</p><figure class="lb lc ld le fd ij er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es mk"><img src="../Images/03fa1501e657a47002ea7f9824784154.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_-oAF9n1fJ9iyOSCrLtCUw.png"/></div></div></figure><p id="e292" class="pw-post-body-paragraph jk jl hi jm b jn kk jp jq jr kl jt ju jv ky jx jy jz kz kb kc kd la kf kg kh hb bi translated">据此，我们有0.277 (27%)的几率在2022年5月30日至少卖出一辆“健身车”，在5月31日卖出75%，如下所示:</p><figure class="lb lc ld le fd ij er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es ml"><img src="../Images/cda619e3c815ec222d6da945a7c9b950.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9kcbvDpHT6NVy4KAT8XP4w.png"/></div></div></figure><p id="2a90" class="pw-post-body-paragraph jk jl hi jm b jn kk jp jq jr kl jt ju jv ky jx jy jz kz kb kc kd la kf kg kh hb bi translated">2022年5月30日和31日的销售数字显示了预测产品“健身有氧健身车”的两项销售记录:</p><figure class="lb lc ld le fd ij er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es mm"><img src="../Images/37639b08d31583ff4d97f0ebdc11ead9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r7ESopGQbS4OEVDZmTQtOA.png"/></div></div><figcaption class="lh li et er es lj lk bd b be z dx translated">2022年5月30日至31日销售</figcaption></figure><p id="96bc" class="pw-post-body-paragraph jk jl hi jm b jn kk jp jq jr kl jt ju jv ky jx jy jz kz kb kc kd la kf kg kh hb bi translated">这是一种不同的产品，预计在未来7天内销售，5月30日的销售概率为91%:</p><figure class="lb lc ld le fd ij er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es mn"><img src="../Images/c17a85fc352fe5e513e130d069320714.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tBqX2YgV3GKHiheDWdbsEQ.png"/></div></div></figure><p id="5734" class="pw-post-body-paragraph jk jl hi jm b jn kk jp jq jr kl jt ju jv ky jx jy jz kz kb kc kd la kf kg kh hb bi translated">这些日期的销售结果:</p><figure class="lb lc ld le fd ij er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es mm"><img src="../Images/7cb5be49c379f5b8ad3c09d927905864.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ErPBC9CxaMa7TVfjK-XOWA.png"/></div></div></figure><p id="c8f9" class="pw-post-body-paragraph jk jl hi jm b jn kk jp jq jr kl jt ju jv ky jx jy jz kz kb kc kd la kf kg kh hb bi translated">那么为什么这很重要呢？如果我们能够在一定程度上准确预测哪种商品将在何时出售，那么我们就知道应该储备哪些产品，投资哪些产品，从而使我们的业务更加有利可图。</p><h1 id="c8bf" class="im in hi bd io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj bi translated">结论:</h1><p id="3400" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">我们已经建立了一个近乎实时的分析平台，该平台不断地从我们的数据源中提取数据，以动态地回答我们的问题，而不是作为一些批处理作业或任何手动干预—该工作流是自动化的，我们所做的只是随意可视化我们的仪表盘和模型。</p><p id="8b95" class="pw-post-body-paragraph jk jl hi jm b jn kk jp jq jr kl jt ju jv ky jx jy jz kz kb kc kd la kf kg kh hb bi translated">米卡·卢博亚</p></div></div>    
</body>
</html>