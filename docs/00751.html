<html>
<head>
<title>Makers DevOps Bootcamp: Week 2 — CI/CD, Serverless and more AWS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">制造商DevOps Bootcamp:第2周— CI/CD、无服务器和更多AWS</h1>
<blockquote>原文：<a href="https://medium.com/codex/makers-devops-bootcamp-week-2-building-our-first-serverless-ci-cd-with-jenkins-and-aws-f2e9f8210031?source=collection_archive---------7-----------------------#2021-03-16">https://medium.com/codex/makers-devops-bootcamp-week-2-building-our-first-serverless-ci-cd-with-jenkins-and-aws-f2e9f8210031?source=collection_archive---------7-----------------------#2021-03-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><h2 id="f63e" class="hg hh hi bd b fp hj hk hl hm hn ho dx hp translated" aria-label="kicker paragraph"><a class="ae ge" href="http://medium.com/codex" rel="noopener">法典</a></h2><div class=""/><p id="4b00" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated"><em class="jm">(我的三国志之一</em> <a class="ae jn" href="https://tuyet-le.medium.com/makers-devops-bootcamp-week-1-devops-containers-and-aws-elastic-beanstalk-601ce285c616" rel="noopener"> <em class="jm">此处</em> </a> <em class="jm">)。)</em></p><figure class="jp jq jr js fd jt er es paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="er es jo"><img src="../Images/cd9c3ceca81181bbf9160f25797f216c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WI0s5fI_sU0_65j6hfHDbg.jpeg"/></div></div><figcaption class="ka kb et er es kc kd bd b be z dx translated"><a class="ae jn" href="https://unsplash.com/@billy_huy?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Billy Huynh </a>在<a class="ae jn" rel="noopener ugc nofollow" target="_blank" href="/s/photos/clouds?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="fa5a" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">我们开始了第二周，直接投入到新的每周团队项目中，目标是:</p><ul class=""><li id="16fa" class="ke kf hi iq b ir is iv iw iz kg jd kh jh ki jl kj kk kl km bi translated">使用AWS S3桶托管静态网站应用程序；</li><li id="bcdf" class="ke kf hi iq b ir kn iv ko iz kp jd kq jh kr jl kj kk kl km bi translated">使用Jenkins构建我们的第一个CI/CD管道；</li><li id="9fb4" class="ke kf hi iq b ir kn iv ko iz kp jd kq jh kr jl kj kk kl km bi translated">用AWS Lambda和Amazon API Gateway部署静态网站；</li><li id="9cd9" class="ke kf hi iq b ir kn iv ko iz kp jd kq jh kr jl kj kk kl km bi translated">成为比前一天更好的DevOps工程师；</li><li id="aabb" class="ke kf hi iq b ir kn iv ko iz kp jd kq jh kr jl kj kk kl km bi translated">为了开心！</li></ul><p id="8bb9" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">到本周末，我们应该有一个简单的部署在AWS上的无服务器网站。</p><figure class="jp jq jr js fd jt er es paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="er es ks"><img src="../Images/2dbf3e8bae1f25169b68933159b1c5d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vHq58gHoGqUzg0j-32VM1A.jpeg"/></div></div></figure><p id="5621" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">AWS生态系统非常庞大，因此我很高兴能够了解更多关于其他AWS服务和持续集成(CI)以及持续交付/部署(CD)的信息，这是您在DevOps和现代软件开发实践中经常听到的。</p></div><div class="ab cl kt ku gp kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="hb hc hd he hf"><h1 id="59ff" class="la lb hi bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">CI/CD概述</h1><figure class="jp jq jr js fd jt er es paragraph-image"><div class="er es ly"><img src="../Images/68bbfc7f11d4322d37a583312b87a249.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/1*apeKCozAPxQl3TP9QqMSBA.gif"/></div></figure><p id="26ab" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">CI/CD是构成DevOps基础架构的实践，使工程师能够更快地交付软件和更高质量的代码。</p><h2 id="fc8b" class="lz lb hi bd lc ma mb mc lg md me mf lk iz mg mh lo jd mi mj ls jh mk ml lw ho bi translated">海峡群岛</h2><p id="44b4" class="pw-post-body-paragraph io ip hi iq b ir mm it iu iv mn ix iy iz mo jb jc jd mp jf jg jh mq jj jk jl hb bi translated">CI是DevOps生命周期中的重要一步。由于自动化测试的帮助，这是一个频繁地将开发人员的代码变更合并到共享存储库中的过程。当开发人员发出一个合并请求时，它会触发一个管道，该管道会在合并到存储库之前自动构建、测试和验证代码更改。将测试自动化作为CI解决方案的一部分，有助于更快地识别错误，并确保更高质量的构建。</p><h2 id="d003" class="lz lb hi bd lc ma mb mc lg md me mf lk iz mg mh lo jd mi mj ls jh mk ml lw ho bi translated">激光唱片</h2><p id="d350" class="pw-post-body-paragraph io ip hi iq b ir mm it iu iv mn ix iy iz mo jb jc jd mp jf jg jh mq jj jk jl hb bi translated">CD将CI验证的代码部署到应用程序中。连续交付通常与连续部署互换使用。两者之间的细微差别在于，连续交付将代码部署到一个阶段环境中，在应用程序交付给客户之前，团队成员可以在这个环境中对其进行试验。另一方面，连续部署会自动将代码直接部署到生产环境中。</p></div><div class="ab cl kt ku gp kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="hb hc hd he hf"><h1 id="ffa6" class="la lb hi bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">创建亚马逊S3桶</h1><p id="8edc" class="pw-post-body-paragraph io ip hi iq b ir mm it iu iv mn ix iy iz mo jb jc jd mp jf jg jh mq jj jk jl hb bi translated">项目时间！</p><p id="dfaa" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">在创建我们的第一个CI/CD管道解决方案之前，我们首先需要在AWS上创建一个S3桶，并将其配置为托管我们的静态网站。</p><figure class="jp jq jr js fd jt er es paragraph-image"><div class="er es mr"><img src="../Images/1ddddb0eb66a0807b3efcfaca89ca742.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/1*cDHe5Q_RDkNt_g-KKxZVcw.png"/></div><figcaption class="ka kb et er es kc kd bd b be z dx translated">AWS S3铲斗</figcaption></figure><h2 id="125b" class="lz lb hi bd lc ma mb mc lg md me mf lk iz mg mh lo jd mi mj ls jh mk ml lw ho bi translated">亚马逊S3桶到底是什么？</h2><p id="d731" class="pw-post-body-paragraph io ip hi iq b ir mm it iu iv mn ix iy iz mo jb jc jd mp jf jg jh mq jj jk jl hb bi translated">这是亚马逊提供的一种简单的对象存储服务，用于存储和保护不同用例的数据，如图像、文本文件、网站、移动应用程序等。它最常用于托管静态网站，通常包含在应用部署的自动化管道中，并直接托管在S3桶上。</p><p id="0f27" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">幸运的是，我们的教练提供了一个简单的应用程序，其中有一个简单的HTML文件供我们使用，所以我们不需要花时间建立一个网站，让我们专注于本周的主要目标。</p></div><div class="ab cl kt ku gp kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="hb hc hd he hf"><h1 id="21a1" class="la lb hi bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">在AWS上设置Jenkins</h1><p id="2d22" class="pw-post-body-paragraph io ip hi iq b ir mm it iu iv mn ix iy iz mo jb jc jd mp jf jg jh mq jj jk jl hb bi translated">一旦我们创建了我们的S3 bucket，就应该学习流行的CI工具Jenkins，用它来构建我们的CI/CD管道，并在AWS远程服务器上设置它。</p><h2 id="f9e7" class="lz lb hi bd lc ma mb mc lg md me mf lk iz mg mh lo jd mi mj ls jh mk ml lw ho bi translated">詹金斯是什么？</h2><p id="76c1" class="pw-post-body-paragraph io ip hi iq b ir mm it iu iv mn ix iy iz mo jb jc jd mp jf jg jh mq jj jk jl hb bi translated">Jenkins管理所有类型的自动化，包括软件构建、应用测试和部署。为了帮助想象詹金斯如何在CI/CD中发挥作用，我涂鸦了这个流程(为贴纸图道歉😅).</p><figure class="jp jq jr js fd jt er es paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="er es ms"><img src="../Images/b4160a1f7579be5fc056039da543eb47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xahdcQd6_F3_j3XFeQmOAg.jpeg"/></div></div><figcaption class="ka kb et er es kc kd bd b be z dx translated">Jenkins的CI/CD渠道</figcaption></figure></div><div class="ab cl kt ku gp kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="hb hc hd he hf"><h1 id="2b18" class="la lb hi bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">创建Amazon EC2实例并在其上安装Jenkins</h1><p id="59b0" class="pw-post-body-paragraph io ip hi iq b ir mm it iu iv mn ix iy iz mo jb jc jd mp jf jg jh mq jj jk jl hb bi translated">将Jenkins设置到AWS远程服务器(也称为EC2实例)上，需要花费大量的时间和研究来理解和实现。关于如何在AWS 上安装<a class="ae jn" href="https://www.jenkins.io/doc/tutorials/tutorial-for-installing-jenkins-on-AWS/" rel="noopener ugc nofollow" target="_blank"> Jenkins的Jenkins文档是我们使用的一个很好的资源，它清楚地分解了各个步骤。</a></p><p id="cb3c" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">下面是我们在AWS管理控制台上使用Jenkins设置EC2实例的步骤概述:</p><ol class=""><li id="a238" class="ke kf hi iq b ir is iv iw iz kg jd kh jh ki jl mt kk kl km bi translated">创建一个密钥对— <em class="jm">这将创建一组由公钥和私钥组成的安全凭证，用于在连接到EC2实例时证明您的身份</em></li><li id="cbd5" class="ke kf hi iq b ir kn iv ko iz kp jd kq jh kr jl mt kk kl km bi translated">创建一个安全组— <em class="jm">这为EC2实例创建了一个虚拟防火墙来控制传入和传出的流量</em></li><li id="ba4c" class="ke kf hi iq b ir kn iv ko iz kp jd kq jh kr jl mt kk kl km bi translated">启动EC2实例</li><li id="82f1" class="ke kf hi iq b ir kn iv ko iz kp jd kq jh kr jl mt kk kl km bi translated">从命令行使用SSH连接到EC2实例</li><li id="3b65" class="ke kf hi iq b ir kn iv ko iz kp jd kq jh kr jl mt kk kl km bi translated">下载Jenkins并将其安装到EC2实例上</li><li id="ca4e" class="ke kf hi iq b ir kn iv ko iz kp jd kq jh kr jl mt kk kl km bi translated">通过安装推荐的插件来配置现在安装在EC2实例上的Jenkins，将其连接到我们的Github存储库，并为所有团队成员设置访问Jenkins的用户权限<em class="jm">(注意:我们为所有团队成员使用了相同的密钥对凭证)</em></li></ol><p id="09d1" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">完成这些步骤后，我们能够让Jenkins处理我们的EC2实例了！</p></div><div class="ab cl kt ku gp kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="hb hc hd he hf"><h1 id="4cd2" class="la lb hi bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">构建我们的CI/CD渠道(Jenkinsfile和Webhooks)</h1><p id="e43b" class="pw-post-body-paragraph io ip hi iq b ir mm it iu iv mn ix iy iz mo jb jc jd mp jf jg jh mq jj jk jl hb bi translated">您现在可能想知道，我们的Jenkins实例如何知道开发人员何时更新了存储库？输入… Webhooks！</p><p id="91f2" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">Webhooks允许您设置集成，以便在某些事件被触发时为其他应用程序提供实时信息。因此，在我们的例子中，当我们的一个团队成员向存储库发出一个push或merge pull请求时，webhook会向我们的Jenkins实例发送一个HTTP POST请求。这将自动触发Jenkins实例上的CI构建作业。</p><h2 id="6419" class="lz lb hi bd lc ma mb mc lg md me mf lk iz mg mh lo jd mi mj ls jh mk ml lw ho bi translated">詹金斯文件</h2><p id="b746" class="pw-post-body-paragraph io ip hi iq b ir mm it iu iv mn ix iy iz mo jb jc jd mp jf jg jh mq jj jk jl hb bi translated">我们通过在Jenkinsfile中编写脚本来定义我们的管道。Jenkinsfile是用<em class="jm"> groovy </em>编写的文本文件(多么有趣的名字！)创建在项目的根目录中。</p><p id="6ae8" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">我们实现了一个非常基本的三阶段连续交付管道——构建、测试和部署——用一个脚本分别打印构建的ID、运行单元测试和将HTML文件部署到我们的S3存储桶。</p><figure class="jp jq jr js fd jt er es paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="er es mu"><img src="../Images/95d40aa0f7468ac08b9d86c5b6af62a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rDOrlyH-jlTKTLOkDFRt_w.png"/></div></div><figcaption class="ka kb et er es kc kd bd b be z dx translated">我们用grooovy编写的非常简单的管道</figcaption></figure><p id="72f5" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">这些阶段是按顺序执行的，因此如果我们的单元测试失败，管道将不会进入部署阶段。</p><p id="ee52" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">经过大量的配置和测试管道中的不同脚本，我们的HTML文件成功部署了！🎉</p><figure class="jp jq jr js fd jt er es paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="er es mv"><img src="../Images/37f7cd8e28c26b3a668b3fa33e16c1d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q95LkkyI4ufv4uuvEfDR3w.png"/></div></div><figcaption class="ka kb et er es kc kd bd b be z dx translated">主页</figcaption></figure></div><div class="ab cl kt ku gp kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="hb hc hd he hf"><h1 id="b606" class="la lb hi bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">使用AWS Lambda实现无服务器</h1><p id="40a6" class="pw-post-body-paragraph io ip hi iq b ir mm it iu iv mn ix iy iz mo jb jc jd mp jf jg jh mq jj jk jl hb bi translated">最后一步是让按钮改变猴子图像和文本。目前，该按钮在点击时不做任何事情。</p><p id="34ea" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">我们了解到，我们可以用AWS Lambda设置这一功能，这是一种无服务器服务，允许您基于传入的请求或事件运行代码。包括AWS Lambda在内的许多无服务器解决方案的一个巨大优势是它支持事件触发器，这使得它非常适合管道。</p><figure class="jp jq jr js fd jt er es paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="er es mw"><img src="../Images/d969406a260701bbf779635e1285e9b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3dvVhsRPgrwlTPwPaTQwBw.jpeg"/></div></div><figcaption class="ka kb et er es kc kd bd b be z dx translated">我们召开了一个研讨会，讨论无服务器架构是什么样子，以及亚马逊S3如何与亚马逊API Gateway和亚马逊Lambda合作来实现这一点</figcaption></figure><p id="e27a" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">除去上图中的用户认证部分，设置Amazon API网关和Amazon Lambda是创建无服务器网站的最后一部分。</p><p id="d06a" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">我们创建了一个Lambda函数，在用户点击按钮时改变HTML主体的文本。</p><figure class="jp jq jr js fd jt er es paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="er es mx"><img src="../Images/14209a2613fdddf65fe01458b89029c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jwrzKJRof0-6OPMDRb5gFw.png"/></div></div><figcaption class="ka kb et er es kc kd bd b be z dx translated">我们用Python写的Lambda函数</figcaption></figure><p id="86a7" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">为了让S3桶在用户点击按钮时调用Lambda函数，我们首先在AWS上的Lambda控制台中配置了S3触发器，使其能够通过API网关发送事件通知。下一步是在Amazon API Gateway中设置一个HTTP API，并在我们的HTML文件中添加端点URL，以便将请求正确地发送给Lambda函数，并将函数的响应返回给客户端。</p><p id="3f85" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">瞧啊。我们的按钮现在工作了——它显示新的文本和猴子照片！</p><figure class="jp jq jr js fd jt er es paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="er es mv"><img src="../Images/6e47e94d4afd256aa37e81e9ccbf56aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_n5Bap10gknFMIkzhtIkCQ.png"/></div></div></figure></div><div class="ab cl kt ku gp kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="hb hc hd he hf"><h1 id="c97d" class="la lb hi bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">反射</h1><p id="85ce" class="pw-post-body-paragraph io ip hi iq b ir mm it iu iv mn ix iy iz mo jb jc jd mp jf jg jh mq jj jk jl hb bi translated">AWS生态系统是巨大的，了解管道实际上是如何工作的是令人兴奋的🤯</p><p id="bd94" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">我喜欢了解更多关于其他流行的AWS服务，包括Lambda、EC2和S3 bucket，并看到它们如何在虚拟服务器上协同工作来托管一个简单的网站。</p><p id="c8a4" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">在我们开始构建我们的管道之前，在设置和配置Jenkins上花费了很多步骤和时间，所以在接下来的一周，看看使用另一个流行的CI工具Github Actions与使用Jenkins有何不同将是很有趣的。</p></div></div>    
</body>
</html>