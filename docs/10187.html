<html>
<head>
<title>Inflate your Power BI Large Dataset Refresh using REST APIs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用REST APIs提升您的Power BI大型数据集刷新</h1>
<blockquote>原文：<a href="https://medium.com/codex/inflate-your-power-bi-large-dataset-refresh-using-rest-apis-c29906660ed7?source=collection_archive---------6-----------------------#2022-12-11">https://medium.com/codex/inflate-your-power-bi-large-dataset-refresh-using-rest-apis-c29906660ed7?source=collection_archive---------6-----------------------#2022-12-11</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="bb4e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">微软最近宣布推出Power BI Refresh Dataset REST APIs，以增强大型数据集刷新。对于那些正在努力使用传统方法(如表格对象模型、PowerShell或表格模型脚本语言)刷新大型数据集的人来说，这是一大解脱。</p><p id="5769" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，增强的API提供了更多有利于大型数据模型的定制选项和特性，如下图所示。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/217c868adc4b13c079e9017570999289.png" data-original-src="https://miro.medium.com/v2/resize:fit:1124/format:webp/1*bjm8Co664ukk56iWVoS3zQ.png"/></div></figure><p id="01c8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在让我们逐一探讨这些选项</p><h1 id="1cf9" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated"><strong class="ak"> 1。表和分区级刷新</strong></h1><p id="fdea" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated">对于此示例，让我们创建一个逻辑应用程序来刷新Power BI数据集，并使用增强的Power BI刷新数据集REST APIs</p><ol class=""><li id="a3f1" class="ko kp hi ih b ii ij im in iq kq iu kr iy ks jc kt ku kv kw bi translated">在我们创建一个逻辑cApp之前，我们需要下面的，所以准备好下面的项目。</li></ol><blockquote class="kx ky kz"><p id="cc41" class="if ig la ih b ii ij ik il im in io ip lb ir is it lc iv iw ix ld iz ja jb jc hb bi translated">→ Power BI数据集(大型数据集在测试该场景时会处于空闲状态)<br/> → Power BI工作区id和数据集id <br/> → SPN(在Azure AD中注册一个应用程序)具有Power BI数据集所需的权限</p></blockquote><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es le"><img src="../Images/e787dfe0487e29ac091bee3082525e73.png" data-original-src="https://miro.medium.com/v2/resize:fit:978/format:webp/1*0cYTlLIyiL_Z9xuPKwE9EA.png"/></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es lf"><img src="../Images/9d9e066a38ecf97262d8075c21f7f215.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YMNaW4oPB-uxDWbE-Y5odg.png"/></div></div></figure><p id="a5bc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我已经用4个表创建了一个数据集，其中一个有4个分区</p><p id="f2cf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.如果您在Power BI门户中打开您的数据集，您会看到与下面类似的URL，因此在groups/和datasets/之后复制id..它们是您的工作空间id和数据集id</p><pre class="je jf jg jh fd lk ll lm bn ln lo bi"><span id="3072" class="lp jm hi ll b be lq lr l ls lt">https://api.powerbi.com/v1.0/myorg/groups/{workspaceid}/datasets/{datasetId}/refreshes</span></pre><p id="1e57" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3.若要获取SPN和其他详细信息，请连接到Azure门户→转到应用程序→获取客户端Id、租户Id和客户端密码</p><p id="530e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4.现在我们已经准备好了创建逻辑应用程序的所有细节，并使用增强的REST APIs来刷新分区和表</p><p id="b386" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">5.打开Azure门户并搜索LogicApp →输入所需的详细信息并单击创建</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es lu"><img src="../Images/313281ee34c11c4cae4b75247833a98d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9uVJ_ib26mOaoHLqWU8_2A.png"/></div></div></figure><p id="53dd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">6.您可以选择“Recurrence”(定期刷新)或收到HTTP请求时(基于来自另一个应用程序的HTTP请求进行刷新)，在本例中，我使用了Recurrence</p><p id="6b86" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">7.添加HTTP任务并选择方法为“Post”</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lv"><img src="../Images/ccab1b15aeefe78dfd4fd61c24450033.png" data-original-src="https://miro.medium.com/v2/resize:fit:1216/format:webp/1*QwvUzZidV1PzA5ZRzS4MBQ.png"/></div></figure><p id="aa8a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">8.现在，从前面的步骤中获取工作空间id和数据集id，并在下面的URL中分别替换它们</p><pre class="je jf jg jh fd lk ll lm bn ln lo bi"><span id="5115" class="lp jm hi ll b be lq lr l ls lt">https://api.powerbi.com/v1.0/myorg/groups/{groupId}/datasets/{datasetId}/refreshes</span></pre><p id="8c95" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">9.该URL应该类似于下图所示</p><pre class="je jf jg jh fd lk ll lm bn ln lo bi"><span id="5f38" class="lp jm hi ll b be lq lr l ls lt">https://api.powerbi.com/v1.0/myorg/groups/f089354e-8366-4e18-aea3-4cb4a3a50b48/datasets/cfafbeb1-8037-4d0c-896e-a46fb27ff229/refreshes</span></pre><p id="85ab" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">10.将URL复制并粘贴到URI文本框中，然后将身份验证类型选择为oAuth，并使用您在前面步骤中复制的值填写必填字段</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lw"><img src="../Images/92b6c51edca944e79a3c56d94d436187.png" data-original-src="https://miro.medium.com/v2/resize:fit:1234/format:webp/1*LT1aeXmwQpRJ_I4dOuWLSg.png"/></div></figure><p id="ea82" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">11.复制主体部分中的以下代码，并相应地替换数据库、表和分区的名称</p><pre class="je jf jg jh fd lk ll lm bn ln lo bi"><span id="4357" class="lp jm hi ll b be lq lr l ls lt">{<br/>  "commitMode": "transactional",<br/>  "maxParallelism": 2,<br/>  "objects": [<br/>    {<br/>      "database": "EnhancedRefresh",<br/>      "table": "Products"<br/>    },<br/>    {<br/>      "database": "EnhancedRefresh",<br/>      "table": "Customers"<br/>    },<br/>    {<br/>      "database": "EnhancedRefresh",<br/>      "partition": "product_sales-1",<br/>      "table": "product_sales"<br/>    }<br/>  ],<br/>  "retryCount": 2,<br/>  "type": "Full"<br/>}</span></pre><p id="39e8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">12.在本节中，我们仅刷新数据集中总共4个表中的3个表，对于product_sales，我们仅刷新最新的分区(而不是整个表)</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lx"><img src="../Images/aa58d0530170a222aca8c82891e51fb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:402/format:webp/1*NHv5DqLV8jX_nw98x06Dyw.png"/></div></figure><p id="4c05" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">13.保存逻辑应用程序并触发它</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ly"><img src="../Images/c7e3b73f051e54dbc9b9e201a701e90d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1294/format:webp/1*pFIaSqyEuqTLZKe8X14wtw.png"/></div></figure><p id="cb0b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">14.逻辑应用成功运行并刷新了所选的表和分区</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lz"><img src="../Images/83d20b7effd41ce32f74c938a443f347.png" data-original-src="https://miro.medium.com/v2/resize:fit:1250/format:webp/1*1dlCmjeIEWtweYnve7gFSQ.png"/></div></figure><h1 id="0e42" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">2.重启时批量提交</h1><p id="d4c6" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated">在上面的例子中，我们使用了“<strong class="ih hj"> <em class="la">事务性</em> </strong>”提交模式，这意味着，它将整个数据集的刷新作为单个事务来提交，如果由于某种原因刷新失败，我们必须再次刷新整个数据集。</p><ol class=""><li id="5858" class="ko kp hi ih b ii ij im in iq kq iu kr iy ks jc kt ku kv kw bi translated"><strong class="ih hj"> <em class="la">事务性</em> </strong>提交模式可能与每日完全刷新的大型数据集无关。</li><li id="cb98" class="ko kp hi ih b ii ma im mb iq mc iu md iy me jc kt ku kv kw bi translated"><strong class="ih hj"> <em class="la"> PartialBatch </em> </strong>提交模式<strong class="ih hj"> <em class="la"> </em> </strong>适用于每日完整刷新的大型数据集。</li><li id="d98f" class="ko kp hi ih b ii ma im mb iq mc iu md iy me jc kt ku kv kw bi translated">因此，如果您想以部分批处理模式刷新数据集，请在脚本中进行修改</li></ol><pre class="je jf jg jh fd lk ll lm bn ln lo bi"><span id="60ac" class="lp jm hi ll b be lq lr l ls lt">{<br/>  "commitMode": "PartialBatch",<br/>  "objects": [<br/>    {<br/>      "database": "EnhancedRefresh",<br/>      "table": "Products"<br/>    },<br/>    {<br/>      "database": "EnhancedRefresh",<br/>      "table": "Customers"<br/>    },<br/>    {<br/>      "database": "EnhancedRefresh",<br/>      "table": "product_sales"<br/>    }<br/>  ],<br/>  "retryCount": 2,<br/>  "type": "Full"<br/>}</span></pre><h1 id="a717" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">3.获取刷新操作详细信息</h1><p id="bde0" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated">在第1步中，我们创建了一个逻辑应用程序来触发Power BI数据集刷新，但它没有为我们提供任何有关刷新的状态，该任务只是启动数据集刷新并成功退出逻辑应用程序，但如果您想要获得有关数据集刷新的常规状态(失败、进行中、已完成)呢..等等)</p><ol class=""><li id="0299" class="ko kp hi ih b ii ij im in iq kq iu kr iy ks jc kt ku kv kw bi translated">让我们回到逻辑应用程序，再添加一个任务来获取刷新的状态</li></ol><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mf"><img src="../Images/23eaf0276ed88c76f9dc108c2d1d750c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1050/format:webp/1*JsF4cBkF4526l9DdZ9_Isw.png"/></div></figure><p id="096b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.初始化一个变量以存储状态，然后循环检查定期(15、30或60秒)的状态</p><p id="c056" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3.循环将继续，直到在更改限制中设置的时间限制内满足条件</p><p id="6941" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4.使用GET方法获取刷新的状态</p><p id="5ddb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">5.在URI中，使用以下表达式从之前的HTTP任务中获取位置id</p><pre class="je jf jg jh fd lk ll lm bn ln lo bi"><span id="b45b" class="lp jm hi ll b be lq lr l ls lt">@{outputs('HTTP')['headers']['location']}</span></pre><p id="7eab" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">6.添加身份验证方法和其他细节，与HTTP任务相同</p><p id="38ad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">7.添加一个设置变量操作，并将值设置为</p><pre class="je jf jg jh fd lk ll lm bn ln lo bi"><span id="7b63" class="lp jm hi ll b be lq lr l ls lt">@{body('HTTP')['status']}</span></pre><p id="8514" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">8.最后，添加一个电子邮件任务，向您的团队通知数据集刷新的状态</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mg"><img src="../Images/18445f6bb4dfc4dacceae62098a28da1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1144/format:webp/1*AzGksZnQFVRYoSRM2mCq7Q.png"/></div></figure><h1 id="3944" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">4.取消正在进行的刷新操作</h1><p id="641c" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated">在某些情况下，我们可能需要取消刷新。使用DELETE方法取消正在进行的刷新操作。</p><ol class=""><li id="4e81" class="ko kp hi ih b ii ij im in iq kq iu kr iy ks jc kt ku kv kw bi translated">在我们的示例中，如果刷新没有在给定的时间限制内完成，那么操作将从until循环中退出</li><li id="304b" class="ko kp hi ih b ii ma im mb iq mc iu md iy me jc kt ku kv kw bi translated">但在后端，刷新仍在运行，在这种情况下，如果您想取消刷新，请再添加一个任务</li></ol><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mh"><img src="../Images/1bf040cf6fc5caa069345cd3708af578.png" data-original-src="https://miro.medium.com/v2/resize:fit:1150/format:webp/1*3_NAmtr955lolcYBs2glmA.png"/></div></figure><p id="4966" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3.添加一个条件来检查刷新状态，如果正在进行(TRUE ),则添加一个HTTP任务，否则(FALSE)添加一个电子邮件任务</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mi"><img src="../Images/96dfe6c750539b675ac2500a1926896f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1172/format:webp/1*ThVmN74fVoO78t-i2cC6eA.png"/></div></figure><p id="b1ae" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4.使用DELETE方法取消刷新</p><p id="57c3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">5.在URI中，使用以下表达式从之前的HTTP任务中获取位置id</p><pre class="je jf jg jh fd lk ll lm bn ln lo bi"><span id="44bf" class="lp jm hi ll b be lq lr l ls lt">@{outputs('HTTP')['headers']['location']}</span></pre><p id="5727" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">6.添加身份验证方法和其他细节，与HTTP任务相同</p><p id="5338" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">7.如前一步所述，将发送电子邮件任务移动到FALSE</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es mj"><img src="../Images/be3d7faf5d15c305280cb85b523600df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6jy6C-en24tCNfFkLukdFw.png"/></div></div></figure><p id="157c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">8.最终的逻辑应用程序看起来像上面所有的步骤，你可以根据你的需要添加更多的动作</p><h1 id="2c10" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">5.应用增量刷新策略</h1><p id="1dbb" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated">对于增量刷新，我们要做的第一件事是对表应用刷新策略</p><ol class=""><li id="c087" class="ko kp hi ih b ii ij im in iq kq iu kr iy ks jc kt ku kv kw bi translated">您可以在表格编辑器中设置表格的刷新策略，<a class="ae mk" href="https://docs.tabulareditor.com/te2/incremental-refresh.html#setting-up-incremental-refresh-from-scratch-with-tabular-editor" rel="noopener ugc nofollow" target="_blank">单击此处</a>了解更多详细信息。</li><li id="31dd" class="ko kp hi ih b ii ma im mb iq mc iu md iy me jc kt ku kv kw bi translated">设置策略后，您可以使用下面的脚本来刷新数据集</li></ol><pre class="je jf jg jh fd lk ll lm bn ln lo bi"><span id="9669" class="lp jm hi ll b be lq lr l ls lt">    {<br/>    "commitMode": "transactional",<br/>    "applyRefreshPolicy": true,<br/>    "effectiveDate": "01/01/2020",<br/>  "objects": [<br/>    {<br/>      "database": "EnhancedRefresh",<br/>      "table": "Products"<br/>    },<br/>    {<br/>      "database": "EnhancedRefresh",<br/>      "table": "Customers"<br/>    },<br/>    {<br/>      "database": "EnhancedRefresh",<br/>      "table": "product_sales"<br/>    }<br/>  ],<br/>  "retryCount": 2,<br/>  "type": "Full"<br/>}</span></pre><p id="4b85" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3.这个主题需要有自己的页面，所以我将在另一篇文章中逐步介绍这个过程。</p><blockquote class="kx ky kz"><p id="180e" class="if ig la ih b ii ij ik il im in io ip lb ir is it lc iv iw ix ld iz ja jb jc hb bi translated"><strong class="ih hj">注意:</strong> <br/> →增强刷新仅适用于Power BI Premium、Premium per user和Power BI Embedded中的数据集。<br/> →根据专业版和高级版数据集基于API的刷新的一般限制，刷新次数有限。</p></blockquote><p id="244c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我希望你喜欢读这篇文章，在我的下一篇文章中再见，然后享受国际足联和美国国家橄榄球联盟的比赛😄😄😄😄</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es ml"><img src="../Images/eb3bbc3d56933daede0389fe4561b30e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EhGz_0gmajJwjoJ5W2Oaow.png"/></div></div></figure></div></div>    
</body>
</html>