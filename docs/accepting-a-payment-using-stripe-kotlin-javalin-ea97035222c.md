# ä½¿ç”¨ Stripe (Kotlin/Javalin)æ¥å—ä»˜æ¬¾

> åŸæ–‡ï¼š<https://medium.com/codex/accepting-a-payment-using-stripe-kotlin-javalin-ea97035222c?source=collection_archive---------6----------------------->

## Stripe æ˜¯ä¸€ç§åŸºäºäº‘çš„æœåŠ¡ï¼Œæ”¯æŒå‘å®¢æˆ·æ”¶å–äº§å“æˆ–æœåŠ¡è´¹ç”¨ã€‚ä½¿ç”¨ Stripe APIï¼Œæ‚¨ä¸ä¼šåƒç®¡ç†ä¿¡ç”¨å¡é‚£æ ·ç®¡ç†æ•æ„Ÿä¿¡æ¯ã€‚è®©æˆ‘ä»¬å­¦ä¹ å¦‚ä½•ä½¿ç”¨å®ƒã€‚

# 1.è®¾ç½®

1.  [æ³¨å†Œä¸€ä¸ª Stripe è´¦æˆ·](https://dashboard.stripe.com/register)å¦‚æœä½ è¿˜æ²¡æœ‰ã€‚
2.  [åˆ›å»ºæ–°çš„ Kotlin é¡¹ç›®ã€‚](https://lsoares.medium.com/kotlin-gradle-junit-starter-project-a113a2cc9cbb)

# 2.Web å¤„ç†ç¨‹åº

1.  å°† Javalin (web æ¡†æ¶)å’Œ Stripe client æ·»åŠ åˆ°æ‚¨çš„`build.gradle.kts`ä¾èµ–å…³ç³»ä¸­:

```
implementation(â€œcom.stripe:stripe-java:20.+â€)
implementation(â€œorg.slf4j:slf4j-simple:1.+â€)
implementation(â€œio.javalin:javalin:4.+â€)
```

2.*æˆ‘ä»¬éœ€è¦è®¾ç½® web è¯·æ±‚å¤„ç†ç¨‹åºã€‚*åˆ›å»ºä¸€ä¸ªåŒ…å«ä»¥ä¸‹å†…å®¹çš„`src/kotlin/Main.kt`:

è¯·æ³¨æ„ï¼Œæ‚¨éœ€è¦æ›¿æ¢ä¸¤ä¸ªå€¼:

*   `**STRIPE_API_KEY**`:ç¡®ä¿ä½ çš„[æ¡çº¹ä»ªè¡¨ç›˜](https://dashboard.stripe.com/)å¤„äºâ€œæµ‹è¯•æ¨¡å¼â€(å³ä¸Šè§’)ã€‚å‰å¾€â€œ[å¼€å‘è€…](https://dashboard.stripe.com/developers)â€(å³ä¸Š)â†’â€œ[API å¯†é’¥](https://dashboard.stripe.com/developers)â€(å·¦ä¾§èœå•)â†’â€œæ ‡å‡†å¯†é’¥â€â†’â€œå¯å‘å¸ƒå¯†é’¥â€(è¿™æ˜¯ä¸€ä¸ªæ¼”ç¤ºå¯†é’¥)ã€‚æ³¨æ„ï¼Œä½ åº”è¯¥ç”¨å®ƒæ¥è®¾ç½®ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œè€Œä¸æ˜¯æŠŠå®ƒç•™åœ¨ä»£ç ä¸­ï¼Œä»è€Œç•™åœ¨æºä»£ç æ§åˆ¶ä¸­ã€‚
*   `**PRICE_ID**`:åœ¨[æ¡çº¹ä»ªè¡¨ç›˜](https://dashboard.stripe.com/)ä¸­æ‰¾åˆ°å¹¶ç‚¹å‡»[äº§å“](https://dashboard.stripe.com/products?active=true)ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªæ–°äº§å“ã€‚ç¡®è®¤äº§å“åˆ›å»ºï¼Œå¹¶åœ¨æ–°åˆ›å»ºçš„äº§å“ä¸­ï¼Œæ»šåŠ¨åˆ°â€œå®šä»·â€éƒ¨åˆ†ã€‚åœ¨é‚£é‡Œï¼Œæ‚¨å¯ä»¥å¤åˆ¶æ‰€éœ€ä»·æ ¼çš„â€œAPI IDâ€ã€‚

![](img/ac497a95d8282e58e95784f37f9fed50.png)

ğŸ“*æ‚¨å¯ä»¥é€šè¿‡* `*Product.retrieve(PROD_ID)*` *è·å–äº§å“è¯¦æƒ…(å¦‚æ ‡é¢˜ã€å›¾ç‰‡ç½‘å€)ã€‚*

# 3.ç½‘é¡µ

æˆ‘ä»¬éœ€è¦ç”¨æˆ·å°†çœ‹åˆ°çš„ HTML é¡µé¢ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç¡¬ç¼–ç çš„ HTMLã€‚ä½†æ˜¯ï¼Œè®©æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªæœåŠ¡å™¨ç«¯æ¨¡æ¿åº“ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æ˜¾ç¤ºä» Stripe API è·å¾—çš„ä»·æ ¼ç»†èŠ‚ã€‚å¢åŠ  [jte](https://jte.gg/) è‡³`build.gradle.kts`:

```
implementation(â€œgg.jte:jte:1.+â€)
```

æˆ‘ä»¬éœ€è¦ä¸€ä¸ªç»“å¸é¡µé¢æ¥è¡¨ç¤ºè´­ç‰©è½¦çš„ç»“å¸ï¼›å®ƒåŒ…å«å®¢æˆ·æ·»åŠ çš„æ‰€æœ‰äº§å“ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œå®ƒåŒ…å«å•ä¸€äº§å“ã€‚åœ¨å®é™…æƒ…å†µä¸‹ï¼Œå®ƒå¯èƒ½åŒ…å«å­˜å‚¨åœ¨ä¼šè¯ä¸­çš„äº§å“ã€‚å¢åŠ `src/main/jte/checkout.jte`ï¼Œå†…å®¹å¦‚ä¸‹:

*æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæˆåŠŸçš„é¡µé¢ï¼Œä»£è¡¨æ”¯ä»˜æˆåŠŸæ—¶ä»æ¡çº¹å›è°ƒã€‚*å¢åŠ `src/main/jte/success.jte`ï¼Œå†…å®¹å¦‚ä¸‹:

*å–æ¶ˆé¡µé¢å¤„ç†ç”¨æˆ·å–æ¶ˆæ”¯ä»˜ã€‚*å¢åŠ `src/main/jte/cancel.jte`ï¼Œå†…å®¹å¦‚ä¸‹:

# 4.æµ‹è¯•ä»˜æ¬¾

è®©æˆ‘ä»¬åœ¨ localhost ä¸­è¿›è¡Œä¸€æ¬¡å‡æ”¯ä»˜:

1.  è·‘`Main.kt`ï¼Œå»`http://localhost:7000/checkout`ã€‚
2.  ç‚¹å‡»â€œç»“å¸â€æŒ‰é’®è¿›å…¥æ¡çº¹æ”¯ä»˜é¡µé¢ã€‚
3.  ç°åœ¨å¯ä»¥ä½¿ç”¨[çš„ä¼ªå¡](https://stripe.com/docs/testing)T5(å…¶ä½™ç»†èŠ‚å¯ä»¥éšæ„è®¾ç½®)ã€‚ä»–çš„å‡å¡å·æ¨¡æ‹Ÿäº†ä¸€æ¬¡å‡çš„æˆåŠŸæ”¯ä»˜ï¼Œè¿™æ ·ä½ å°±å¯ä»¥æµ‹è¯•æ•´ä¸ªæµç¨‹ã€‚

![](img/14ca24243140bd22b113dbcb32b1f95a.png)

# äº†è§£æ›´å¤šä¿¡æ¯

[](https://stripe.com/docs/payments/accept-a-payment?platform=web&ui=checkout) [## æ¥å—ä»˜æ¬¾

### å‘æ‚¨çš„ç½‘ç«™æ·»åŠ ä¸€ä¸ªç»“å¸æŒ‰é’®ï¼Œè¯¥æŒ‰é’®è°ƒç”¨æœåŠ¡å™¨ç«¯ç«¯ç‚¹æ¥åˆ›å»ºç»“å¸ä¼šè¯ã€‚ç»“å¸â€¦

stripe.com](https://stripe.com/docs/payments/accept-a-payment?platform=web&ui=checkout) [](https://javalin.io/tutorials/jte) [## åœ¨ Javalin - Javalin -ä¸€ä¸ªè½»é‡çº§ Java å’Œ Kotlin web æ¡†æ¶ä¸­å‘ˆç° jte æ¨¡æ¿ã€‚åˆ›å»ºâ€¦

### jte æ˜¯ä¸€ä¸ªç°ä»£çš„ã€ç±»å‹å®‰å…¨çš„æ¨¡æ¿å¼•æ“ï¼Œå®ƒç”¨å°½å¯èƒ½å°‘çš„é¢å¤–è¯­æ³•å°† HTML å’Œ Java ç»“åˆåœ¨ä¸€èµ·ã€‚åœ¨è¿™ä¸ªâ€¦

javalin.io](https://javalin.io/tutorials/jte)