<html>
<head>
<title>What are Dump Files?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">什么是转储文件？</h1>
<blockquote>原文：<a href="https://medium.com/codex/what-are-dump-files-8f290b1abd0c?source=collection_archive---------15-----------------------#2021-09-21">https://medium.com/codex/what-are-dump-files-8f290b1abd0c?source=collection_archive---------15-----------------------#2021-09-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/6d79ca88b609d3a6d2caaf723070d102.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MglzgRsUiofm4Q8OVGo6CA.png"/></div></div></figure><p id="cb03" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对于软件工程师来说，了解如何评估和处理转储以找出他们的程序失败或行为异常的原因是非常重要的。然而，决定从哪里开始这个过程可能是困难的。</p><p id="62f6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当您在Windows操作系统上运行a.NET应用程序时，这篇文章可以作为调试故障转储文件的良好起点。</p><p id="7d04" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">目录</strong></p><ol class=""><li id="302c" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn jt ju jv jw bi translated">什么是转储文件？</li><li id="7513" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">转储文件的类型</li><li id="7dc9" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">如何自动捕捉转储文件的崩溃过程？</li><li id="525e" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">如何创建转储？</li><li id="a2c7" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">使用Visual studio调查转储</li><li id="af5c" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">使用Windbg调查转储</li><li id="a0e2" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">结论</li></ol><h1 id="2582" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">什么是转储文件？</h1><p id="de14" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">内存转储文件(。dmp文件)是在某个时间点(例如在崩溃期间)拍摄的程序内存快照。你可以看到-</p><ul class=""><li id="3d2c" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn lf ju jv jw bi translated">当前正在执行的代码行</li><li id="9bb2" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn lf ju jv jw bi translated">本地价值观的价值</li><li id="1c00" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn lf ju jv jw bi translated">转储文件中所有堆对象的值。</li></ul><p id="1d8a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">换句话说，转储文件包含程序被捕获时的完整状态。</p><p id="9bc2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">转储通常用于故障排除(崩溃转储)，但它们也可以用于其他目的。以下是它们的用法(按最常见到最不常见的顺序)</p><ul class=""><li id="1ed2" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn lf ju jv jw bi translated">调试崩溃的程序</li><li id="9688" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn lf ju jv jw bi translated">调试挂起的程序</li><li id="7120" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn lf ju jv jw bi translated">查找内存泄漏</li><li id="8abb" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn lf ju jv jw bi translated">在不同的机器上调试，甚至在不同的时间调试</li><li id="fd13" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn lf ju jv jw bi translated">调试不能附加到调试器的程序</li><li id="28c1" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn lf ju jv jw bi translated">用WinDbg调试</li></ul><h1 id="f081" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">转储文件的类型</h1><p id="d534" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">全内存转储和小型转储是转储文件的两种形式。完整的内存转储包括程序的整个内存。就空间而言，它通常会变得很大。</p><p id="fc50" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">“小型转储”一词具有欺骗性。这是一种可以定制的转储格式。它可以包含所有内存，占用与完整内存转储一样多的空间(可能更多),也可以只包含每个配置的一部分内存。</p><p id="e815" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们通常将转储与整个RAM for.NET一起使用，以获得完整的调试体验。它可以是完整的内存转储，也可以是包含整个内存区域的小型转储。</p><h1 id="5b44" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">如何自动捕捉转储文件的崩溃过程？</h1><p id="b7ac" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">您必须调整注册表设置以启用转储文件，因为它不是默认创建的。要启用捕获，您有两种选择。第一个选项是设置事后调试器设置。</p><p id="a2df" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在第一个选项中，首先选择一个调试器应用程序，如Visual Studio、ProcDump、WinDbg或ADPlus，然后命令切换程序以创建转储文件或附加到进程进行实时调试(如果它们支持的话)。</p><p id="8b4a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">第二个选项是设置WER为您的程序创建一个转储文件，以防它崩溃。如果您不需要现场调试，只需要在光盘上创建转储文件以供以后分析，这是一条可行的途径。因为此功能内置于Windows中，所以不需要额外的软件来进行转储。以下是WER转储的注册表设置:</p><ul class=""><li id="168c" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn lf ju jv jw bi translated">如果不存在，构建基本的WER本地转储注册表项。</li><li id="55f9" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn lf ju jv jw bi translated">HKLM:\ SOFTWARE \ Microsoft \ Windows \ Windows错误报告\本地转储</li><li id="d57a" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn lf ju jv jw bi translated">然后，为特定于应用程序的转储文件设置创建密钥。</li><li id="31ce" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn lf ju jv jw bi translated">如果HelloWorldCrasher.exe是要保存转储的应用程序，请执行以下操作:</li><li id="173e" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn lf ju jv jw bi translated">新密钥:HKLM:\ SOFTWARE \ Microsoft \ Windows \ Windows错误报告\ local dumps \ hello world crasher . exe</li><li id="08e2" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn lf ju jv jw bi translated">该项下的注册表值:</li><li id="ce2e" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn lf ju jv jw bi translated"><strong class="is hj">dump folder</strong>:[REG _ EXPAND _ SZ]存储转储文件的文件夹路径。</li><li id="fe9b" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn lf ju jv jw bi translated"><strong class="is hj">转储类型</strong> : [REG_DWORD]为完全转储指定值<strong class="is hj"> 2 </strong>。<strong class="is hj"> 1 </strong>用于小型转储(较小，但不是整个进程内存空间)。</li><li id="010c" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn lf ju jv jw bi translated"><strong class="is hj"> DumpCount </strong> : [REG_DWORD]在覆盖旧的转储文件之前要保存的转储数量。默认值为10。</li></ul><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lg"><img src="../Images/e58af07d3c8a4322f17b91ddbfd2f166.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-HIGt6tl1EpyVz5s"/></div></div></figure><p id="3d72" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在注册表中配置完这些设置后，重新运行hello world崩溃应用程序的可执行文件。当这次崩溃时，转储文件应该被写入到我们指定的文件夹中。</p><h1 id="8e79" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">如何创建转储？</h1><p id="2d57" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">可以通过多种方式创建转储。以下是几个最受欢迎和推荐的:</p><p id="c86c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">调试时转到调试|将转储另存为…。</p><p id="2a9a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">使用Heap，您将能够保存一个包含整个内存空间的小型转储。</p><p id="cc98" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">右键单击所需的进程，并从任务管理器的详细信息菜单中选择创建转储文件。这将导致完全的内存转储。</p><p id="98dd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">ProcDump是SysInternal toolkit的一个组件，这是一组非常有用的Windows开发工具。命令行实用程序ProcDump用于创建转储。它可以按需创建转储，或者监视一个程序并在它崩溃或挂起时生成转储。</p><p id="4e8a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">SysInternal工具集中的另一个工具是Process Explorer。它是一个高一级的任务管理器。您可以检查活动线程、注册表项，当然，还可以构建转储来查看哪些进程加载了特定的DLL或句柄。</p><p id="7eb9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">从任何进程的上下文菜单中选择创建转储|创建完全转储。</p><h1 id="220e" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">使用Visual Studio调试转储</h1><p id="38e8" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">浏览转储文件最直接的方法是打开转储文件(。dmp)。如果您能够匹配符号(.pdb文件)和源文件。也就是说，代码对您来说就像是站在一个断点上。如果是崩溃转储，您会注意到导致崩溃的异常。线程、调用栈、局部变量、加载的模块等等都应该是可见的。</p><p id="27f3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">使用Visual Studio进行调试的步骤:</p><ul class=""><li id="c471" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn lf ju jv jw bi translated">在Visual Studio中，打开。dmp文件。</li><li id="ed0f" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn lf ju jv jw bi translated">从出现的下拉菜单中选择“仅使用托管调试”或“使用混合调试”。</li><li id="f829" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn lf ju jv jw bi translated">等待Visual Studio尝试加载符号并将它们与源代码进行比较。</li><li id="1aff" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn lf ju jv jw bi translated">如果加载了符号，代码将会出现。否则，调用堆栈、异常信息(如果是在异常时收集的)以及可能的本地值应该是可见的。</li><li id="4d0c" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn lf ju jv jw bi translated">像在Visual Studio中调试一样调查异常或问题。</li></ul><h1 id="665c" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">使用Windbg调查转储</h1><p id="2e53" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">在研究转储文件时，WinDbg是大多数人的首选工具。</p><p id="0cb5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">视觉工作室在功能方面仍在追赶。WinDbg可以检查对象堆、提取模块、定位死锁，还可以做很多其他VS做不到的事情。</p><p id="da92" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你不熟悉WinDbg，它是一个Windows调试工具，主要使用命令行。有了SOS调试扩展，WinDbg可以用于本地程序和managed.NET程序。</p><h1 id="ac4d" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">结论</h1><p id="5af9" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">在2021年，你有太多的工具供你使用，让调试变得相当容易。Visual Studio、DumpMiner、SuperDump和WinDbg Preview只是目前可供您使用的工具中的一部分。你可以找到许多其他的工具来给你一个360度的程序视图。</p></div><div class="ab cl ll lm gp ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="hb hc hd he hf"><p id="d6ee" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="ls">原载于</em><a class="ae lt" href="https://www.partech.nl/en/publications/2021/09/what-are-dump-files" rel="noopener ugc nofollow" target="_blank"><em class="ls">https://www . partech . nl</em></a><em class="ls">。</em></p></div></div>    
</body>
</html>