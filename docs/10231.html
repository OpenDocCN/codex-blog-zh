<html>
<head>
<title>Tryhackme: Pickle Rick</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">泡菜里克</h1>
<blockquote>原文：<a href="https://medium.com/codex/tryhackme-pickle-rick-69e8acd795fa?source=collection_archive---------17-----------------------#2022-12-13">https://medium.com/codex/tryhackme-pickle-rick-69e8acd795fa?source=collection_archive---------17-----------------------#2022-12-13</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/2dfb3452e9b7c590021f4893c5a96d74.png" data-original-src="https://miro.medium.com/v2/resize:fit:540/format:webp/1*GZfVHPnRAyjxd6KMEILp2Q.png"/></div></figure><p id="5a3b" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">Pickle Rick是一个TryHackMe easy机器，其中我们必须枚举一个web服务，并使用一些泄漏的凭据来访问它。最后，我们将利用命令执行来获得机器上的外壳。</p></div><div class="ab cl jk jl gp jm" role="separator"><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp"/></div><div class="hb hc hd he hf"><p id="a8d4" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">像往常一样，在TryHackMe中，我们必须连接到VPN或使用攻击箱。我会选择VPN。我们按下启动机器按钮，一分钟后，他们给我们显示IP地址。现在，我们继续使用Nmap进行初始识别:</p><pre class="jr js jt ju fd jv jw jx bn jy jz bi"><span id="24ad" class="ka kb hi jw b be kc kd l ke kf">nmap -p- -sV -Pn $IP</span></pre><p id="90eb" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">带连字符的-p参数表示扫描所有端口,-sV参数表示对使用的版本进行指纹识别，而-Pn参数表示扫描机器，即使它不响应ping。</p><figure class="jr js jt ju fd ij er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es kg"><img src="../Images/0e292f449f88c3db81d889be8373df9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iaqUsQ0_FHS_U6fgjsojow.png"/></div></div></figure><p id="8a45" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们可以看到机器上几乎没有打开的服务，只有SSH和一个web服务器。让我们深入研究一下web服务器。</p><p id="1536" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">网络服务器枚举</strong></p><p id="07ca" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在网站的主页上，我们可以看到一条泄露用户名的评论。</p><figure class="jr js jt ju fd ij er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es kl"><img src="../Images/4d8b1a34fd879603dbdc65d83fecdb84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p7j-GsAzXJpc6QXmKjcv_g.png"/></div></div></figure><p id="3829" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">此外，我们可以看到一个奇怪的机器人。txt。也许这可能是一个密码，但这是一个小猜测…</p><figure class="jr js jt ju fd ij er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es km"><img src="../Images/94a801c4da8af6d3fa2e95dad1c74c27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gxFI_NsL3G-EP4hFReeVIA.png"/></div></div></figure><p id="3243" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">通过模糊化目录和文件，我们发现了许多端点。</p><figure class="jr js jt ju fd ij er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es kn"><img src="../Images/daf8b3b19747b8347ca1e987e6d16b3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7gC-6iMowj6K4EmNFMgvgw.png"/></div></div></figure><p id="81ae" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们可以从登录门户上的robots.txt文件中测试用户和猜测的密码。</p><figure class="jr js jt ju fd ij er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es ko"><img src="../Images/31d63de5c19624b21128f1cbcbc96677.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oZhfEkwuPoQppc20P9nfEw.png"/></div></div></figure><p id="5ac1" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">一旦登录到应用程序中，我们就可以访问一个允许我们执行命令的面板，但有一个黑名单，尽管我们可以使用base64或使用less命令来绕过它。如果我们看到代码，我们可以看到黑名单是硬编码的。</p><pre class="jr js jt ju fd jv jw jx bn jy jz bi"><span id="2a01" class="ka kb hi jw b be kc kd l ke kf">&lt;?php<br/>session_start();<br/><br/>if($_SESSION["login"] == false) {<br/>   header("Location: /login.php"); die();<br/>}<br/><br/>?&gt;<br/>&lt;!DOCTYPE html&gt;<br/>&lt;html lang="en"&gt;<br/>&lt;head&gt;<br/>  &lt;title&gt;Rick is sup4r cool&lt;/title&gt;<br/>  &lt;meta charset="utf-8"&gt;<br/>  &lt;meta name="viewport" content="width=device-width, initial-scale=1"&gt;<br/>  &lt;link rel="stylesheet" href="assets/bootstrap.min.css"&gt;<br/>  &lt;script src="assets/jquery.min.js"&gt;&lt;/script&gt;<br/>  &lt;script src="assets/bootstrap.min.js"&gt;&lt;/script&gt;<br/>&lt;/head&gt;<br/>&lt;body&gt;<br/>  &lt;nav class="navbar navbar-inverse"&gt;<br/>    &lt;div class="container"&gt;<br/>      &lt;div class="navbar-header"&gt;<br/>        &lt;a class="navbar-brand" href="#"&gt;Rick Portal&lt;/a&gt;<br/>      &lt;/div&gt;<br/>      &lt;ul class="nav navbar-nav"&gt;<br/>        &lt;li class="active"&gt;&lt;a href="#"&gt;Commands&lt;/a&gt;&lt;/li&gt;<br/>        &lt;li&gt;&lt;a href="/denied.php"&gt;Potions&lt;/a&gt;&lt;/li&gt;<br/>        &lt;li&gt;&lt;a href="/denied.php"&gt;Creatures&lt;/a&gt;&lt;/li&gt;<br/>        &lt;li&gt;&lt;a href="/denied.php"&gt;Potions&lt;/a&gt;&lt;/li&gt;<br/>        &lt;li&gt;&lt;a href="/denied.php"&gt;Beth Clone Notes&lt;/a&gt;&lt;/li&gt;<br/>      &lt;/ul&gt;<br/>    &lt;/div&gt;<br/>  &lt;/nav&gt;<br/><br/>  &lt;div class="container"&gt;<br/>    &lt;form name="input" action="" method="post"&gt;<br/>      &lt;h3&gt;Command Panel&lt;/h3&gt;&lt;/br&gt;<br/>      &lt;input type="text" class="form-control" name="command" placeholder="Commands"/&gt;&lt;/br&gt;<br/>      &lt;input type="submit" value="Execute" class="btn btn-success" name="sub"/&gt;<br/>    &lt;/form&gt;<br/>    &lt;?php<br/>      function contains($str, array $arr)<br/>      {<br/>          foreach($arr as $a) {<br/>              if (stripos($str,$a) !== false) return true;<br/>          }<br/>          return false;<br/>      }<br/>      // Cant use cat<br/>      $cmds = array("cat", "head", "more", "tail", "nano", "vim", "vi");<br/>      if(isset($_POST["command"])) {<br/>        if(contains($_POST["command"], $cmds)) {<br/>          echo "&lt;/br&gt;&lt;p&gt;&lt;u&gt;Command disabled&lt;/u&gt; to make it hard for future &lt;b&gt;PICKLEEEE RICCCKKKK&lt;/b&gt;.&lt;/p&gt;&lt;img src='assets/fail.gif'&gt;";<br/>        } else {<br/>          $output = shell_exec($_POST["command"]);<br/>          echo "&lt;/br&gt;&lt;pre&gt;$output&lt;/pre&gt;";<br/>        }<br/>      }<br/><br/>    ?&gt;<br/>  &lt;/div&gt;<br/>&lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="2fc7" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">据我们所知，黑名单只是阻止读取fihceros，所以我们可以得到一个反向外壳没有太大的麻烦。</p><figure class="jr js jt ju fd ij er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es kp"><img src="../Images/cde4af4454b492d55a8b5ec5bbd521f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XyHrvs0xd_LITkAB3yiBgQ.png"/></div></div></figure><p id="54da" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">枚举，我们可以发现，我们可以执行任何命令作为根无需使用密码，然后提升特权是微不足道的。</p><figure class="jr js jt ju fd ij er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es kq"><img src="../Images/684140c347ca286197a04101ca4b2936.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wKD5TV33lmNdRSwSGtdD3A.png"/></div></div></figure><p id="3c70" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">最后，我们可以简单地以root用户身份执行bash，并获得一个具有特权的shell。</p><figure class="jr js jt ju fd ij er es paragraph-image"><div class="er es kr"><img src="../Images/8d05dfe1240703c7a7ebb4ccc25dbe3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1032/format:webp/1*tU0SXv0NYr07rbLp9PRY6w.png"/></div><figcaption class="ks kt et er es ku kv bd b be z dx translated">该读取所有标志了！</figcaption></figure></div><div class="ab cl jk jl gp jm" role="separator"><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp"/></div><div class="hb hc hd he hf"><p id="3d05" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我希望你喜欢我的文章，并发现我的内容有用。下一篇文章再见。</p></div></div>    
</body>
</html>