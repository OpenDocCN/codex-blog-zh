<html>
<head>
<title>SQL — Usage and cool Use cases of CASE Statement</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SQL—CASE语句的用法和酷用例</h1>
<blockquote>原文：<a href="https://medium.com/codex/sql-advanced-usage-of-case-statement-4e5a9528a317?source=collection_archive---------2-----------------------#2022-07-25">https://medium.com/codex/sql-advanced-usage-of-case-statement-4e5a9528a317?source=collection_archive---------2-----------------------#2022-07-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/9b31ce5b8d60d24f444373944a84b83d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*DdRbPmiK4fzbemne"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">卡斯帕·卡米尔·鲁宾在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="4117" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">数据清理、宁滨和灵活排序都可以通过使用CASE语句来完成。我将向您展示如何使用它，以及如何实现这些用例。但是在我们开始之前，让我们从基础开始。</p><h1 id="6c3a" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">如何使用CASE</h1><p id="2700" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">Case是SQL实现if else逻辑的方式。基本上，你可以根据布尔表达式定义逻辑。所以，当某事为真时，这个值就是结果。在代码中，它看起来像这样:</p><figure class="kw kx ky kz fd ij"><div class="bz dy l di"><div class="la lb l"/></div></figure><p id="ff96" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这里我们看到了CASE子句的基本实现。CASE和END包含一系列WHEN THEN语句和一个可选的ELSE语句。请记住，您返回的值必须是同一类型的。在本例中，我们只返回类似“Good Customer”的字符串。CASE语句可以相互嵌套，也可以使用逻辑连接和+ OR。</p><h2 id="2e2d" class="lc ju hi bd jv ld le lf jz lg lh li kd jg lj lk kh jk ll lm kl jo ln lo kp lp bi translated">展示准备</h2><p id="3a80" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">我将使用一个非常小的数据集来展示以下示例中的所有内容。这将由我在SQL Server (Azure SQL)上完成，但如果您使用另一个数据库引擎，这没有问题，因为语法在任何地方都是相同的。</p><p id="ab89" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">DDL(创建表格)可以在<a class="ae iu" href="https://github.com/Graflinger/CaseMediumDemo.git" rel="noopener ugc nofollow" target="_blank">这里</a>找到，所以你可以很容易地自己摆弄数据。但是为了简化，我们有一个名为orders的表，包含以下几列:</p><ul class=""><li id="7234" class="lq lr hi ix b iy iz jc jd jg ls jk lt jo lu js lv lw lx ly bi translated">order_id (INT主键)</li><li id="b29c" class="lq lr hi ix b iy lz jc ma jg mb jk mc jo md js lv lw lx ly bi translated">客户名称(Varchar)</li><li id="497d" class="lq lr hi ix b iy lz jc ma jg mb jk mc jo md js lv lw lx ly bi translated">订单_国家(Varchar)</li><li id="f36b" class="lq lr hi ix b iy lz jc ma jg mb jk mc jo md js lv lw lx ly bi translated">order_price(浮点/小数)</li></ul><figure class="kw kx ky kz fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es me"><img src="../Images/4aed62130784659172671ddd6651d81b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dz0bO_eci5nZXJqVFy4SDw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">订单表</figcaption></figure><h2 id="cc7b" class="lc ju hi bd jv ld le lf jz lg lh li kd jg lj lk kh jk ll lm kl jo ln lo kp lp bi translated">数据清理</h2><p id="8164" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">如您所见，我们的order_country列中存在数据质量问题。一个订单来自“我们”，另一个来自“美国”。这将使分组和聚合变得困难。以下是如何用案例陈述来处理它:</p><figure class="kw kx ky kz fd ij"><div class="bz dy l di"><div class="la lb l"/></div></figure><p id="2ba3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这个查询将生成一个名为“order_country_cleaned”的新列，解决了我们的问题。现在我们两个行具有相同的值，这提高了我们的数据质量。也可以只使用1 WHEN，并将该逻辑与OR相结合。请记住，使用一个超级复杂的CASE语句来清理数据是没有意义的，如果您的数据超过10行，那么使用一个查找表可能会更好，因为它具有可重用性的好处。</p><p id="744c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">CASE是提高查询中数据质量的一个很好的方法，但是如果可能的话，请联系数据工程师/开发人员来提高源表中的数据质量。</p><h2 id="cd0f" class="lc ju hi bd jv ld le lf jz lg lh li kd jg lj lk kh jk ll lm kl jo ln lo kp lp bi translated">扔掉</h2><p id="d9b5" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">当你处理连续值时，宁滨在你的分析中真的很有价值。它使您能够创建存储桶，使分组和聚合对您可用。宁滨可以这样做:</p><figure class="kw kx ky kz fd ij"><div class="bz dy l di"><div class="la lb l"/></div></figure><p id="121c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这里，我们从连续列“order_price”创建了3个类别。现在使用这个分箱的列，例如，您可以分别对所有客户的类别进行计数。</p><h2 id="2f80" class="lc ju hi bd jv ld le lf jz lg lh li kd jg lj lk kh jk ll lm kl jo ln lo kp lp bi translated">灵活订购</h2><p id="d022" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">CASE语句还使您能够利用更复杂的ORDER BY实现。这可以从这里看出:</p><figure class="kw kx ky kz fd ij"><div class="bz dy l di"><div class="la lb l"/></div></figure><p id="0ebd" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这会产生以下输出:</p><figure class="kw kx ky kz fd ij er es paragraph-image"><div class="er es mg"><img src="../Images/8310f8e8fbae2b9b76e660bc4ec6780a.png" data-original-src="https://miro.medium.com/v2/resize:fit:522/format:webp/1*SkOB5MLX_GwQ86EJRcnn2A.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">灵活订单的输出依据</figcaption></figure><h1 id="1916" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">结论</h1><p id="5ce6" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">如果你只学了一门，那么希望你不总是需要SQL中最新奇的特性来实现一些很酷的想法。甚至像CASE语句这样古老而众所周知的东西也能为你提供超酷的能力，让你的生活变得更轻松。</p></div></div>    
</body>
</html>