<html>
<head>
<title>JavaScript text editor for SVG</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SVG的JavaScript文本编辑器</h1>
<blockquote>原文：<a href="https://medium.com/codex/javascript-text-editor-for-svg-6881f670d432?source=collection_archive---------2-----------------------#2022-04-22">https://medium.com/codex/javascript-text-editor-for-svg-6881f670d432?source=collection_archive---------2-----------------------#2022-04-22</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="f41f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" href="https://app.dgrm.net/" rel="noopener ugc nofollow" target="_blank">试玩</a> | <a class="ae jd" href="https://github.com/AlexeyBoiko/DgrmJS" rel="noopener ugc nofollow" target="_blank"> GitHub </a></p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es je"><img src="../Images/fbc98cde68722ec8bebd162b3d872ea6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/1*qh5Q2nCo3RZJF4r4rIqW8w.gif"/></div><figcaption class="jm jn et er es jo jp bd b be z dx translated"><em class="jq">图一。SVG文本编辑器，支持选择，复制，粘贴。适用于PC和移动设备。</em></figcaption></figure><p id="4bf1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这篇文章描述了如何制作一个文本编辑器。源代码附后。</p><h1 id="193a" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">SVG中的多行文本</h1><p id="b1f4" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">SVG没有换行符。对于多行文本，SVG使用<tspan>。</tspan></p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es je"><img src="../Images/0de179efa68f5fb015dd473c47ebc50b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*avl6VskyRBnuiiXm9X-QwQ.png"/></div><figcaption class="jm jn et er es jo jp bd b be z dx translated">图二。多行文本，第三行为空</figcaption></figure><pre class="jf jg jh ji fd ku kv kw kx aw ky bi"><span id="b444" class="kz js hi kv b fi la lb l lc ld">&lt;text x="0" y="0"&gt;<br/>   &lt;tspan x="0" y="0"&gt;Line 1&lt;/tspan&gt;<br/>   &lt;tspan x="0" y="20px"&gt;Line 2&lt;/tspan&gt;<br/>   &lt;!-- Line 3 is empty<br/>   &lt;tspan x="0" y="40px"&gt;&lt;/tspan&gt; --&gt;<br/>   &lt;tspan x="0" y="60px"&gt;Line 4&lt;/tspan&gt;<br/>&lt;/text&gt;</span></pre><p id="8ce0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="le">清单1。SVG中的多行文本。第三行是空的。行高20px。</em></p><p id="8c1e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><tspan>元件的位置相对于<text>的顶部边缘。必须计算“y”属性的值。</text></tspan></p><p id="a165" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">可以避免“y”属性的计算。清单2给出了相同的结果。“dy”属性与固定值一起使用。“dy”表示相对于前一个元素的位置。</p><pre class="jf jg jh ji fd ku kv kw kx aw ky bi"><span id="1702" class="kz js hi kv b fi la lb l lc ld">&lt;text x="0" y="0"&gt;<br/>    &lt;tspan x="0" dy="0"&gt;Line 1&lt;/tspan&gt;<br/>    &lt;tspan x="0" dy="20px"&gt;Line 2&lt;/tspan&gt;<br/>    &lt;tspan x="0" dy="20px" visibility="hidden"&gt;.&lt;/tspan&gt;<br/>    &lt;tspan x="0" dy="20px"&gt;Line 4&lt;/tspan&gt;<br/>&lt;/text&gt;</span></pre><p id="df64" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="le">清单2。SVG中的多行文本。第三行是空的。行高20px。缩进是相对于前一个元素设置的。</em></p><h1 id="90b5" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">用JavaScript形成多行标记</h1><p id="aaf0" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">下面的函数使用固定的“dy”属性呈现标记。标记如清单2所示。</p><pre class="jf jg jh ji fd ku kv kw kx aw ky bi"><span id="c9ef" class="kz js hi kv b fi la lb l lc ld">/**<br/> * create multiline tspan markup<br/> * <a class="ae jd" href="http://twitter.com/param" rel="noopener ugc nofollow" target="_blank">@param</a> {string} str<br/> * <a class="ae jd" href="http://twitter.com/param" rel="noopener ugc nofollow" target="_blank">@param</a> {number} lineHeight<br/> * <a class="ae jd" href="http://twitter.com/returns" rel="noopener ugc nofollow" target="_blank">@returns</a> {string}<br/> */<br/>function svgStrToTspan(str, lineHeight) {<br/>    return str.split('\n').map((t, i) =&gt; {<br/>        return `&lt;tspan<br/>            x="0"<br/>            dy="${i === 0 ? '0' : `${lineHeight}px`}"<br/>            ${t.length === 0 ? 'visibility="hidden"' : ''}&gt;<br/> <br/>                ${t.length === 0<br/>                    ? '.'<br/>                    : escapeHtml(t).replaceAll(' ', '&amp;nbsp;')}<br/> <br/>            &lt;/tspan&gt;`;<br/>    }).join('');<br/>}</span></pre><p id="b3ab" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="le">清单3。函数进行多行标记</em></p><p id="6da4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在图1中，当您添加一行时，文本向上移动。因此，文本总是在圆的中心。清单4展示了这是如何实现的:</p><pre class="jf jg jh ji fd ku kv kw kx aw ky bi"><span id="983b" class="kz js hi kv b fi la lb l lc ld">/**<br/> * <a class="ae jd" href="http://twitter.com/param" rel="noopener ugc nofollow" target="_blank">@param</a> {SVGTextElement} textEl target text element<br/> * <a class="ae jd" href="http://twitter.com/param" rel="noopener ugc nofollow" target="_blank">@param</a> {string} str<br/> * <a class="ae jd" href="http://twitter.com/param" rel="noopener ugc nofollow" target="_blank">@param</a> {{lineHeight:number, verticalMiddle?:number}} param<br/> * <a class="ae jd" href="http://twitter.com/returns" rel="noopener ugc nofollow" target="_blank">@returns</a> {void}<br/> */<br/>export function svgTextDraw(textEl, str, param) {<br/>    textEl.innerHTML = svgStrToTspan(str, param.lineHeight);<br/>    if (param.verticalMiddle != null) {<br/>        textEl.y.baseVal[0].value =<br/>            param.verticalMiddle - textEl.getBBox().height / 2;<br/>    }<br/>}</span></pre><p id="c811" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="le">清单4。该函数将文本插入SVG。当指定verticalMiddle时，文本垂直居中。</em></p><h1 id="ecdb" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">文字编辑器</h1><p id="8eab" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">编辑器必须支持所有标准功能:</p><ul class=""><li id="99a3" class="lf lg hi ih b ii ij im in iq lh iu li iy lj jc lk ll lm ln bi translated">文本导航、选择、插入、复制；</li><li id="a704" class="lf lg hi ih b ii lo im lp iq lq iu lr iy ls jc lk ll lm ln bi translated">自动更正，拼写检查。</li><li id="aae7" class="lf lg hi ih b ii lo im lp iq lq iu lr iy ls jc lk ll lm ln bi translated">在PC和移动设备上工作。</li></ul><p id="5a2b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于标准特征，有一个标准<textarea>。</textarea></p><p id="a64c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">编辑的算法:</p><ul class=""><li id="1df6" class="lf lg hi ih b ii ij im in iq lh iu li iy lj jc lk ll lm ln bi translated">透明的<textarea>位于文本上方。<br/>&lt;textarea&gt;字体也是透明的；</textarea></li><li id="2e4d" class="lf lg hi ih b ii lo im lp iq lq iu lr iy ls jc lk ll lm ln bi translated">在输入时，调用清单4中的svgTextDraw</li><li id="ea35" class="lf lg hi ih b ii lo im lp iq lq iu lr iy ls jc lk ll lm ln bi translated">重新计算<textarea>的尺寸和位置。</textarea></li></ul><p id="c2ff" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该算法在textareaCreate函数中实现。功能代码在<a class="ae jd" href="https://github.com/AlexeyBoiko/DgrmJS/blob/main/src/diagram-extensions/infrastructure/svg-textarea.js" rel="noopener ugc nofollow" target="_blank">GitHub</a>上的一个单独文件中。</p><p id="0cb3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">编辑器可以连接到任何<text>元素:</text></p><pre class="jf jg jh ji fd ku kv kw kx aw ky bi"><span id="6c8b" class="kz js hi kv b fi la lb l lc ld">const textEditor = textareaCreate(<br/>    // {SVGTextElement}<br/>    textEl,<br/>    // text params<br/>    { lineHeight: 20, verticalMiddle: 10 },<br/>    // init value<br/>    'init text',<br/>    // onchange<br/>    val =&gt; {...},<br/>    // onblur<br/>    val =&gt; {...});<br/>…<br/>// delete textarea<br/>textEditor.remove();</span></pre><p id="05bb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="le">清单5。为&lt;文本&gt;文本</em>创建文本编辑器</p><h1 id="6667" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">关于dgrm.net的其他文章</h1><ul class=""><li id="dcc8" class="lf lg hi ih b ii kp im kq iq lt iu lu iy lv jc lk ll lm ln bi translated"><a class="ae jd" rel="noopener" href="/codex/javascript-svg-diagram-editor-which-weighs-6-5-less-than-bootstrap-open-source-library-b753feaaf835"> JavaScript SVG图表编辑器3.9 KB(开源库)</a></li><li id="d98f" class="lf lg hi ih b ii lo im lp iq lq iu lr iy ls jc lk ll lm ln bi translated"><a class="ae jd" rel="noopener" href="/codex/javascript-diagram-editor-that-renders-diagrams-from-png-images-open-source-d1de0f053088"> JavaScript图表编辑器，从PNG图像(开源)呈现图表</a></li></ul><h1 id="877c" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">如何支持该项目</h1><ul class=""><li id="2824" class="lf lg hi ih b ii kp im kq iq lt iu lu iy lv jc lk ll lm ln bi translated">开始使用流程图编辑器<a class="ae jd" href="https://dgrm.net/" rel="noopener ugc nofollow" target="_blank">Dgrm.net</a>。<br/>告诉我你的想法。在<a class="ae jd" href="https://github.com/AlexeyBoiko/DgrmJS" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上的评论，私信。我什么都读，我会保留一份提案清单。</li><li id="d1f8" class="lf lg hi ih b ii lo im lp iq lq iu lr iy ls jc lk ll lm ln bi translated">告诉你的朋友。</li><li id="faaa" class="lf lg hi ih b ii lo im lp iq lq iu lr iy ls jc lk ll lm ln bi translated">在<a class="ae jd" href="https://github.com/AlexeyBoiko/DgrmJS" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上给一颗星。</li></ul></div></div>    
</body>
</html>