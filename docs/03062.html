<html>
<head>
<title>How to edit images with GANs? Controlling the Latent Space of GANs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用GANs编辑图像？控制GANs的潜在空间</h1>
<blockquote>原文：<a href="https://medium.com/codex/how-to-edit-images-with-gans-controlling-the-latent-space-of-gans-afde630e53d1?source=collection_archive---------2-----------------------#2021-08-17">https://medium.com/codex/how-to-edit-images-with-gans-controlling-the-latent-space-of-gans-afde630e53d1?source=collection_archive---------2-----------------------#2021-08-17</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/4e3d9c5685572d29943d485df2fd3263.png" data-original-src="https://miro.medium.com/v2/resize:fit:1132/format:webp/1*1jSecbS0P7Xy_JL0gsQ2fA.png"/></div></figure><p id="c132" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">StyleGAN和BigGAN等最近的图像生成作品能够生成真正高质量的图像。虽然这些关于GANs的工作非常令人兴奋，但我们必须更多地了解潜在的空间，以开发有趣的应用程序。我们希望能够控制我们想要生成的图像类型。</p><p id="5ba5" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在本帖中，我们将回顾一篇关于如何在GAN潜在空间中嵌入给定图像的论文。要理解这些论文，你首先需要理解GANs和StyleGAN，我们不会在这篇文章中解释。</p><p id="aad6" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这篇论文…</p><ul class=""><li id="1401" class="jk jl hi io b ip iq it iu ix jm jb jn jf jo jj jp jq jr js bi translated">研究GAN的潜在空间并提供相关见解。</li><li id="3a3a" class="jk jl hi io b ip jt it ju ix jv jb jw jf jx jj jp jq jr js bi translated">建议为StyleGAN嵌入一个“W+”扩展潜在空间。</li><li id="4ddf" class="jk jl hi io b ip jt it ju ix jv jb jw jf jx jj jp jq jr js bi translated">提出了一种将给定图像映射到潜像的嵌入算法。</li></ul><p id="58f9" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><a class="ae jy" href="https://arxiv.org/abs/1904.03189" rel="noopener ugc nofollow" target="_blank"> <em class="jz">原文:Image2StyleGAN:如何将图像嵌入StyleGAN潜空间？</em>T3】</a></p><h2 id="a9e1" class="ka kb hi bd kc kd ke kf kg kh ki kj kk ix kl km kn jb ko kp kq jf kr ks kt ku bi translated">将新图像嵌入潜在空间</h2><p id="57ed" class="pw-post-body-paragraph im in hi io b ip kv ir is it kw iv iw ix kx iz ja jb ky jd je jf kz jh ji jj hb bi translated">GANs中图像处理的第一步是能够将给定的图像映射到潜在空间。实现这一点的流行方法是训练编码器将图像映射到潜在空间。在使用GAN损失训练生成器之后，我们冻结生成器(解码器)权重并训练将图像映射到潜在空间的编码器。然后，生成器基于预测的潜像生成合成图像。通过将原始图像与发生器的输出进行比较，编码器网络像AE一样被训练。</p><figure class="lb lc ld le fd ij er es paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="er es la"><img src="../Images/2b2e60fc0ec0f8e05f6793de0038814b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*HvS8ojnUmfKNX65t.png"/></div></div><figcaption class="lj lk et er es ll lm bd b be z dx translated"><a class="ae jy" href="https://kaonashi-tyc.github.io/2017/04/06/zi2zi.html" rel="noopener ugc nofollow" target="_blank"> Zi2Zi </a>汉字生成的流水线，上面描述的过程的例子。</figcaption></figure><p id="7134" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">另一种方法是从潜在空间中的随机点开始，并通过梯度下降学习输入(潜在)，以便生成器的输出与给定图像匹配。通常使用第一种方法，因为它在测试时速度更快。</p><h2 id="8a55" class="ka kb hi bd kc kd ke kf kg kh ki kj kk ix kl km kn jb ko kp kq jf kr ks kt ku bi translated">GAN潜在空间</h2><p id="ad97" class="pw-post-body-paragraph im in hi io b ip kv ir is it kw iv iw ix kx iz ja jb ky jd je jf kz jh ji jj hb bi translated">本文提出了“梯度学习输入”的第二种方法的更一般和稳定的扩展。</p><figure class="lb lc ld le fd ij er es paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="er es ln"><img src="../Images/7a3ed35933be315b3eb41c78d9c33027.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oqUOk-eBjoMP-WJcdMhn8A.png"/></div></div><figcaption class="lj lk et er es ll lm bd b be z dx translated">顶行:输入图像。底行:将图像嵌入到StyleGAN潜在空间的结果。</figcaption></figure><p id="2ca5" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">甚至有可能在GAN潜空间中嵌入任意图像吗？实验在GAN空间中嵌入人脸、猫、狗、汽车、绘画5类25幅图像。虽然汽车等类别直观上与人脸没有结构相似性，但嵌入算法和生成器能够超越人脸。虽然与奥巴马的脸相比，其他类上有更多的缺陷，但这展示了生成器令人惊讶的嵌入能力。示例如上图所示。</p><figure class="lb lc ld le fd ij er es paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="er es lo"><img src="../Images/1e7ea66c930737fb2891fba532608fcd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dIx-npMx9whw8xbbTcGvnw.png"/></div></div><figcaption class="lj lk et er es ll lm bd b be z dx translated">顶行:输入图像。底行:将图像嵌入到StyleGAN潜在空间的结果。</figcaption></figure><p id="7db7" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">人脸图像的嵌入有多鲁棒？另一个实验测试了嵌入性能的鲁棒性，方法是尝试使用仿射变换嵌入图像，如上图所示。通常，与普通嵌入相比，会有模糊的图像和更多丢失的细节。然而，该模型对下图中的缺陷具有惊人的鲁棒性。这些结果意味着生成器依赖于空间变换，但是面部特征的嵌入是彼此独立的。</p><figure class="lb lc ld le fd ij er es paragraph-image"><div class="er es lp"><img src="../Images/2a1f808ac391e939128e90fa9f4a2e76.png" data-original-src="https://miro.medium.com/v2/resize:fit:740/format:webp/1*ZsEbX02UjLwBme1NnmCHYA.png"/></div><figcaption class="lj lk et er es ll lm bd b be z dx translated">顶行:输入图像。底行:将图像嵌入到StyleGAN潜在空间的结果。</figcaption></figure><h2 id="4300" class="ka kb hi bd kc kd ke kf kg kh ki kj kk ix kl km kn jb ko kp kq jf kr ks kt ku bi translated">W+潜在空间</h2><figure class="lb lc ld le fd ij er es paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="er es lq"><img src="../Images/6579cfe7779ce77a7df863d8d2aa8ded.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*We1fuyn_bau_rU7_69TTkw.png"/></div></div><figcaption class="lj lk et er es ll lm bd b be z dx translated">嵌入哪个空间？</figcaption></figure><p id="709d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">斯泰勒根有多个潜在空间可以嵌入。作者测试了各种潜在空间，并比较了上图中的结果。Z空间是初始潜在空间，W空间是全连通映射后的中间潜在空间。将图像嵌入到这些琐碎的空间中，结果很差，如图(c)(d)所示。早期阶段的嵌入似乎没有向生成器传达足够的关于给定图像的信息。为了解决这个问题，作者建议利用StyleGAN架构，并在扩展的潜在空间中嵌入图像。</p><figure class="lb lc ld le fd ij er es paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="er es lr"><img src="../Images/686a43f8b0a247bc9ff4d09fb180d3e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OUCbTTdTvI6eGWfiN5HdyQ.png"/></div></div><figcaption class="lj lk et er es ll lm bd b be z dx translated">左:原始StyleGAN，右:嵌入到W+应用到StyleGAN</figcaption></figure><p id="4e8a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">W+潜在空间是StyleGAN中AdaIn层的每个<em class="jz">样式</em>的18个不同的512维W向量的串联。本文提出在StyleGAN中处理每个AdaIn层的w输入。这样不会对网络干扰太大吗？在这种程度的干扰下，网络权重还重要吗？图(b)(e)显示了随机初始化模型上的嵌入图像。看起来W+潜在空间可以控制输出，即使在随机模型上也能生成给定的图像，但需要训练卷积进行质量重建，如图(e)所示。</p><h2 id="2cec" class="ka kb hi bd kc kd ke kf kg kh ki kj kk ix kl km kn jb ko kp kq jf kr ks kt ku bi translated">嵌入有多大意义？</h2><p id="11b8" class="pw-post-body-paragraph im in hi io b ip kv ir is it kw iv iw ix kx iz ja jb ky jd je jf kz jh ji jj hb bi translated">这一切都归结于关于嵌入W+空间是否有意义的讨论。这些作品的主要目标是应用于图像编辑。本文对对应于一些图像编辑应用的潜在代码进行操作，以测试潜在代码的有效性。</p><figure class="lb lc ld le fd ij er es paragraph-image"><div class="er es ls"><img src="../Images/adc5dd5742b65cac2821530d84edf72e.png" data-original-src="https://miro.medium.com/v2/resize:fit:896/format:webp/1*7eHHNSbuBgaYVZ5fMlWCQw.png"/></div><figcaption class="lj lk et er es ll lm bd b be z dx translated">变形</figcaption></figure><p id="b5a1" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">首先，作者在嵌入的潜影上执行两幅图像之间的变形。这是通过在两个图像的潜像之间生成计算为线性插值的潜像来实现的。在上图中，该算法能够在人脸图像之间生成高质量的变形(域内),但对于非人脸图像却不能。我们可以在插值过程中发现类似人脸的伪像。这表明内在的潜在空间是专门给人脸的。</p><p id="c78d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这使得两个给定的面之间的变形！这项工作确实令人惊叹。然而，域外数据的生成似乎是一种延伸，源于W+空间中的嵌入可能对最终输出造成的不自然的影响。</p><figure class="lb lc ld le fd ij er es paragraph-image"><div class="er es lt"><img src="../Images/1b3ab5c39b749a257f85cfbddfa754a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:900/format:webp/1*8CYhQ14bN-SJK5Q1T0vERA.png"/></div><figcaption class="lj lk et er es ll lm bd b be z dx translated">使用StyleGAN进行风格转移</figcaption></figure><p id="3082" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">StyleGAN的基本设计使其应用于风格转换。早期层的Te潜在代码影响空间和高级特征，例如面部形状和姿态，而较深层的姿态改变纹理和色彩方案。因此，例如，如果我们将奥巴马的潜在代码用于早期层，将一幅漫画的潜在代码用于更深的层，我们就会得到上面描述的风格转移效果。</p><p id="bb11" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">嵌入能够将低层次的特征转化为人脸(上图)，但不能保留非人脸图像的高层次内容(下图)。这进一步支持了内心潜在空间是专门给人脸的说法。</p><figure class="lb lc ld le fd ij er es paragraph-image"><div class="er es lu"><img src="../Images/8f7a8d27b721ac30d7ed04833f119fa0.png" data-original-src="https://miro.medium.com/v2/resize:fit:820/format:webp/1*r5QNRK5kpiZ3oCjdL2EyYg.png"/></div><figcaption class="lj lk et er es ll lm bd b be z dx translated">非人脸图像上的风格转移</figcaption></figure><p id="2b71" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">本文还提供了关于<em class="jz">表达转移</em>的实验，该实验也显示是成功的。在人脸上的总体实验被证明是非常成功的，表明在W+潜在空间上嵌入是合理的决定。生成的嵌入在语义上对许多图像编辑应用程序有意义。</p><p id="6ccb" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">虽然生成器能够充分地从嵌入在W+空间上的图像生成域外图像，但是实验表明非人脸图像的嵌入具有较少的语义意义。在操作过程中出现的人脸碎片暗示着内在的潜在空间是专用于人脸的。</p><h2 id="161e" class="ka kb hi bd kc kd ke kf kg kh ki kj kk ix kl km kn jb ko kp kq jf kr ks kt ku bi translated">嵌入算法</h2><p id="f003" class="pw-post-body-paragraph im in hi io b ip kv ir is it kw iv iw ix kx iz ja jb ky jd je jf kz jh ji jj hb bi translated">最后，我们将讨论将给定图像嵌入到预训练生成器的流形上的优化算法。该方法使用梯度下降在专用损失上优化初始嵌入w。</p><figure class="lb lc ld le fd ij er es paragraph-image"><div class="er es lv"><img src="../Images/3365cd2321056944a3990d2413d001d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:764/format:webp/1*_ABEYLdqYwpFzHUyIrxwTQ.png"/></div></figure><p id="3598" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">初始嵌入的一种方法是简单地从均匀分布中采样。然而，在StyleGAN设置中，AdaIN层的输入是一个复杂的分布，我们可以期望最终向量收敛到一个更接近平均潜在向量的向量w*。我们可以将嵌入初始化为平均潜在向量。这对嵌入人脸图像有效，但对非人脸图像无效。</p><p id="5eed" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">感知损失旨在测量图像之间的高级相似性。VGG图像分类模型的中间特征通常用于计算感知损失。具体来说，我们计算图像的特征(Conv层的输出)之间的差异。损失函数被定义为给定图像和发生器输出之间的感知损失和逐像素MSE损失的组合。</p><p id="c495" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">本文对原始论文中提供的各种损失、训练配置和超参数进行了烧蚀研究。</p><h2 id="c8e5" class="ka kb hi bd kc kd ke kf kg kh ki kj kk ix kl km kn jb ko kp kq jf kr ks kt ku bi translated">总结和意见</h2><ul class=""><li id="c930" class="jk jl hi io b ip kv it kw ix lw jb lx jf ly jj jp jq jr js bi translated">我们可以将任何给定的图像嵌入到StyleGAN潜在空间中。甚至是训练域之外的图像。</li><li id="ade7" class="jk jl hi io b ip jt it ju ix jv jb jw jf jx jj jp jq jr js bi translated">当在各种操作上进行实验时，人脸嵌入获得了良好的语义意义。</li><li id="8926" class="jk jl hi io b ip jt it ju ix jv jb jw jf jx jj jp jq jr js bi translated">非人脸嵌入在这样的实验中严重失败，这表明虽然StyleGAN可以生成这样的图像，但潜在空间主要是人脸。</li><li id="8865" class="jk jl hi io b ip jt it ju ix jv jb jw jf jx jj jp jq jr js bi translated">嵌入到W和Z空间不能为生成器提供足够的信息。W+ space就可以了。</li><li id="d07c" class="jk jl hi io b ip jt it ju ix jv jb jw jf jx jj jp jq jr js bi translated">我们可以将潜在向量初始化为平均潜在向量。</li></ul><p id="997a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">本文对GAN潜在空间(特别是StyleGAN)提供了有趣的见解，并建议通过选择足够复杂的潜在空间，我们可以将给定的图像映射到StyleGAN潜在空间，而信息损失很小。这篇论文的见解和改进是惊人的。</p><p id="5f0d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">论文中的许多实验都涉及到非人脸图像。非人脸图像的结果和超参数建议与人脸图像的大部分结果相矛盾。作者还指出，潜在空间专门用于人脸。直觉上，训练人脸的生成器不应该能够生成汽车的图像。我怀疑这些实验是否有意义。</p></div></div>    
</body>
</html>