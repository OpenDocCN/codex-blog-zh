<html>
<head>
<title>Using self-hosted Services with Flutter</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过Flutter使用自托管服务</h1>
<blockquote>原文：<a href="https://medium.com/codex/using-self-hosted-services-with-flutter-3d823e503778?source=collection_archive---------16-----------------------#2021-08-09">https://medium.com/codex/using-self-hosted-services-with-flutter-3d823e503778?source=collection_archive---------16-----------------------#2021-08-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/30c3cfd28fd810be9437ca62174b7897.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tWoBFy2JFJS28AeGp3bHKw.png"/></div></div></figure><p id="7af9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">有大量的教程告诉你如何使用<a class="ae jo" href="https://firebase.google.com/" rel="noopener ugc nofollow" target="_blank">谷歌Firebase </a>和<a class="ae jo" href="https://flutter.dev/" rel="noopener ugc nofollow" target="_blank"> Flutter </a>，但是如果你想为独立的电子邮件验证系统或评论过滤等提供自己的服务呢？</p><p id="8e59" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你可以使用Python和<a class="ae jo" href="https://flask.palletsprojects.com/" rel="noopener ugc nofollow" target="_blank"> Flask </a>，你必须将脚本和你的应用程序连接起来。让我们看看如何做到这一点。</p><h2 id="3d5b" class="jp jq hi bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated">首先，创建一个Python脚本。</h2><p id="e821" class="pw-post-body-paragraph iq ir hi is b it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj ko jl jm jn hb bi translated">所以你想创建自己的小系统来保存你的用户数据。你可以用Flask来创建一个web服务，用TinyDB来保存所有的用户数据。</p><h2 id="8ac6" class="jp jq hi bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated">装置</h2><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="4f8d" class="jp jq hi ku b fi ky kz l la lb">pip install Flask<br/>pip install tinydb</span></pre><h2 id="1790" class="jp jq hi bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated">初始化烧瓶</h2><p id="bb86" class="pw-post-body-paragraph iq ir hi is b it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj ko jl jm jn hb bi translated">我们必须创建Flask类的一个实例。然后，我们使用route decorator向Flask显示哪个路由将激活该函数。</p><figure class="kp kq kr ks fd ij"><div class="bz dy l di"><div class="lc ld l"/></div><figcaption class="le lf et er es lg lh bd b be z dx translated">在本文末尾，您已经有了完整的GitHub项目资源库！</figcaption></figure><h2 id="215b" class="jp jq hi bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated">正在初始化TinyDB</h2><figure class="kp kq kr ks fd ij"><div class="bz dy l di"><div class="lc ld l"/></div><figcaption class="le lf et er es lg lh bd b be z dx translated">在本文末尾，您已经有了完整的GitHub项目资源库！</figcaption></figure><h2 id="c40b" class="jp jq hi bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated">有用的功能</h2><p id="17b0" class="pw-post-body-paragraph iq ir hi is b it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj ko jl jm jn hb bi translated">这是一个错误消息生成器，它将帮助我们生成对错误的响应。</p><figure class="kp kq kr ks fd ij"><div class="bz dy l di"><div class="lc ld l"/></div><figcaption class="le lf et er es lg lh bd b be z dx translated">在本文末尾，您已经有了完整的GitHub项目资源库！</figcaption></figure><h2 id="8921" class="jp jq hi bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated">下一步</h2><p id="2f3c" class="pw-post-body-paragraph iq ir hi is b it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj ko jl jm jn hb bi translated">所以我们已经导入并初始化了两个主包。现在我们将创建我们的函数。</p><p id="5e03" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先，我们要上传用户的数据。为此，我们将创建两个函数，一个用于从我们的Flutter应用程序(或任何不必专门用Flutter开发的外部应用程序)获取用户数据，另一个用于将用户数据保存到数据库中。</p><h2 id="f556" class="jp jq hi bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated">从外部应用程序获取用户数据</h2><p id="c0ba" class="pw-post-body-paragraph iq ir hi is b it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj ko jl jm jn hb bi translated">我们首先创建一个名为“/api/v1/uploads/users”的路由，它使用POST方法从外部应用程序(在本例中是一个Flutter应用程序)获取用户数据。然后，我们验证每个字段都有数据，并保存数据。</p><figure class="kp kq kr ks fd ij"><div class="bz dy l di"><div class="lc ld l"/></div><figcaption class="le lf et er es lg lh bd b be z dx translated">在本文末尾，您已经有了完整的GitHub项目资源库！</figcaption></figure><h2 id="a544" class="jp jq hi bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated">保存用户数据</h2><p id="4e33" class="pw-post-body-paragraph iq ir hi is b it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj ko jl jm jn hb bi translated">接下来，我们创建一个函数，允许我们将接收到的数据保存到数据库中。这个函数创建一个查询，询问我们想要保存的用户名，这样我们可以确保该用户不存在。</p><figure class="kp kq kr ks fd ij"><div class="bz dy l di"><div class="lc ld l"/></div><figcaption class="le lf et er es lg lh bd b be z dx translated">在本文的最后，您已经有了完整的GitHub项目资源库！</figcaption></figure><h2 id="734f" class="jp jq hi bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated">正在检索用户数据</h2><p id="90d9" class="pw-post-body-paragraph iq ir hi is b it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj ko jl jm jn hb bi translated">我们将创建另一个允许我们请求用户数据的路径。</p><figure class="kp kq kr ks fd ij"><div class="bz dy l di"><div class="lc ld l"/></div><figcaption class="le lf et er es lg lh bd b be z dx translated">在本文末尾，您已经有了完整的GitHub项目资源库！</figcaption></figure><h2 id="7f59" class="jp jq hi bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated">从数据库获取用户数据</h2><p id="cc9a" class="pw-post-body-paragraph iq ir hi is b it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj ko jl jm jn hb bi translated">当我们询问用户名时，这段代码将返回用户的数据。</p><figure class="kp kq kr ks fd ij"><div class="bz dy l di"><div class="lc ld l"/></div><figcaption class="le lf et er es lg lh bd b be z dx translated">在本文末尾，您已经有了完整的GitHub项目资源库！</figcaption></figure><h2 id="c8f4" class="jp jq hi bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated">设置烧瓶环境</h2><p id="6934" class="pw-post-body-paragraph iq ir hi is b it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj ko jl jm jn hb bi translated">您必须执行这些命令才能运行您的python脚本。</p><p id="2025" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这个用于设置环境变量，其中“main”是python脚本的名称。</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="10cc" class="jp jq hi ku b fi ky kz l la lb">Linux | MacOS:<br/>$ export FLASK_APP=main</span><span id="37b0" class="jp jq hi ku b fi li kz l la lb">CMD:<br/>&gt; set FLASK_APP=main</span><span id="647e" class="jp jq hi ku b fi li kz l la lb">Windows Powershell:<br/>&gt; $env:FLASK_APP = "main"</span></pre><p id="51c8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后，为了运行您的应用程序，只需在控制台的脚本目录下运行该命令。</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="4ccf" class="jp jq hi ku b fi ky kz l la lb">flask run</span></pre><h2 id="898e" class="jp jq hi bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated">测试我们的脚本</h2><p id="2eb8" class="pw-post-body-paragraph iq ir hi is b it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj ko jl jm jn hb bi translated">为了测试这个脚本，你可以使用一个名为<a class="ae jo" href="https://www.talend.com/" rel="noopener ugc nofollow" target="_blank"> Taled API Tester </a>的Google Chrome扩展，它将允许你提出任何类型的请求来测试你的API。</p><figure class="kp kq kr ks fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lj"><img src="../Images/4bb9f1f1917c6a72691fd38ddc3e0586.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Eizs0A3K2Q7CYZiGy_NRZQ.png"/></div></div><figcaption class="le lf et er es lg lh bd b be z dx translated">使用Taled API测试器进行测试</figcaption></figure><h1 id="828f" class="lk jq hi bd jr ll lm ln jv lo lp lq jz lr ls lt kc lu lv lw kf lx ly lz ki ma bi translated">示例Flutter应用</h1><p id="8ed1" class="pw-post-body-paragraph iq ir hi is b it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj ko jl jm jn hb bi translated">现在，我们已经准备好python脚本来接收和检索用户数据。接下来我们要做的是我们的Flutter应用。</p><p id="6bd3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要创建一个新的Flutter应用程序，您只需编写下一个命令:</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="5217" class="jp jq hi ku b fi ky kz l la lb">&gt; flutter create appname</span></pre><p id="cf5f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">其中appname是您的应用程序的名称。在这种情况下，我将使用</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="bfb0" class="jp jq hi ku b fi ky kz l la lb">&gt; flutter create flutterapp</span></pre><p id="d56d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后，我们将删除所有默认的示例代码，我们将开始编写自己的应用程序。</p><h2 id="800a" class="jp jq hi bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated">所需的库</h2><p id="fa51" class="pw-post-body-paragraph iq ir hi is b it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj ko jl jm jn hb bi translated">您必须将dio库添加到您的pubspec.yaml文件中。这个库将用于服务器和应用程序之间的通信。</p><figure class="kp kq kr ks fd ij"><div class="bz dy l di"><div class="lc ld l"/></div></figure><h2 id="2d66" class="jp jq hi bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated">不安全的HTTP</h2><p id="14e9" class="pw-post-body-paragraph iq ir hi is b it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj ko jl jm jn hb bi translated">由于这是一个教程，我们将通过在我们的<em class="mb"> AndroidManifest.xml </em>中设置这个来允许HTTP请求，但是<strong class="is hj">我不建议在版本中这样做。</strong></p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="1b86" class="jp jq hi ku b fi ky kz l la lb">android:usesCleartextTraffic="true"</span></pre><h2 id="053e" class="jp jq hi bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated">用户级</h2><p id="ef8b" class="pw-post-body-paragraph iq ir hi is b it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj ko jl jm jn hb bi translated">首先，我们将创建一个“用户”类，它将是用户对象，这不是必需的，但可以让你舒适地工作。</p><figure class="kp kq kr ks fd ij"><div class="bz dy l di"><div class="lc ld l"/></div><figcaption class="le lf et er es lg lh bd b be z dx translated">在本文末尾，您已经有了完整的GitHub项目资源库！</figcaption></figure><h2 id="2751" class="jp jq hi bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated">主页</h2><p id="644d" class="pw-post-body-paragraph iq ir hi is b it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj ko jl jm jn hb bi translated">我们的应用程序将有一个主页，我们将分为两部分，第一个将用于上传用户，第二个将用于搜索用户。</p><p id="df98" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我假设您知道Flutter是什么，所以我将只解释如何从我们的api发送和检索数据。请记住，您已经在本文末尾获得了完整的项目GitHub资源库。</p><h2 id="ce20" class="jp jq hi bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated">添加新用户</h2><p id="ad4f" class="pw-post-body-paragraph iq ir hi is b it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj ko jl jm jn hb bi translated">我们创建一个Map类型的变量，我们将在其中插入我们的用户数据。然后，使用Dio库，我们创建一个Dio对象，它将被用作我们的应用程序之间的连接器。</p><p id="c265" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们检查响应代码，以检测是否有任何错误，如果一切正常，显示一个对话框。</p><figure class="kp kq kr ks fd ij"><div class="bz dy l di"><div class="lc ld l"/></div></figure><h2 id="f0f1" class="jp jq hi bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated">搜索用户</h2><p id="651b" class="pw-post-body-paragraph iq ir hi is b it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj ko jl jm jn hb bi translated">我们创建一个函数，它将一个字符串(用户名)作为参数，这将用于创建一个GET方法到我们的服务器，并从那里获取用户的数据。</p><figure class="kp kq kr ks fd ij"><div class="bz dy l di"><div class="lc ld l"/></div></figure><p id="7812" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae jo" href="https://github.com/augustt0/Flask_Flutter" rel="noopener ugc nofollow" target="_blank"> GitHub链接到这个项目</a></p><p id="c55b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae jo" href="https://www.buymeacoffee.com/augustt0" rel="noopener ugc nofollow" target="_blank">请我喝杯咖啡</a></p><p id="cd18" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae jo" href="https://www.youtube.com/c/AugustoCabrera" rel="noopener ugc nofollow" target="_blank">我的YouTube频道</a></p></div></div>    
</body>
</html>