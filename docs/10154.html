<html>
<head>
<title>OAuth and JWT — when to use and how to implement</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">OAuth和JWT —何时使用以及如何实施</h1>
<blockquote>原文：<a href="https://medium.com/codex/oauth-and-jwt-when-to-use-and-how-to-implement-525e26e0395a?source=collection_archive---------4-----------------------#2022-12-08">https://medium.com/codex/oauth-and-jwt-when-to-use-and-how-to-implement-525e26e0395a?source=collection_archive---------4-----------------------#2022-12-08</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/8ba37c7a150dab7572e29e5211e9d7cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GGqW2G1yk37wd5W8op7esA.jpeg"/></div></div></figure><p id="47fb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">授权，认证…谁知道区别，对不对？</p><p id="08b8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在深入OAuth和JWT的概念之前，您可以快速回顾一下，了解授权和身份验证之间的区别，</p><p id="913d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在计算机安全领域，认证和授权是两个相关但不同的概念。</p><p id="a6eb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">认证</strong>是验证用户或系统身份的过程。这通常需要用户提供用户名和密码，然后系统根据注册用户的数据库进行验证。如果用户名和密码与数据库中的条目匹配，则认为用户通过了身份验证，并被授予访问系统的权限。</p><p id="986e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">另一方面，授权</strong>是确定经过身份验证的用户是否有权执行特定操作或访问特定资源的过程。这通常涉及系统对照一组规则或策略检查经过身份验证的用户的访问权限或特权，以确定用户是否被授权执行所请求的操作。</p><p id="43a8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">总之，认证是验证用户身份的过程，而授权是验证用户权限的过程。这两个过程共同构成了计算机系统中安全访问控制的基础。</p><h1 id="d651" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">OAuth是什么？</h1><p id="f5ea" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">OAuth(开放授权)是一个<strong class="is hj">开放的访问授权标准，允许用户授权第三方应用程序访问他们的资源，而无需共享他们的密码</strong>。它为应用程序提供了一种<strong class="is hj">安全的方式</strong>来代表用户<strong class="is hj">访问资源，而不需要用户共享他们的凭证</strong>。</p><p id="d12f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">OAuth使用令牌和秘密的组合来认证用户和授权对资源的访问。它允许用户<strong class="is hj">通过提供一个令牌来授权对他们的资源的访问，这个令牌由OAuth服务器发出，并与访问请求一起传递</strong>。OAuth服务器随后验证令牌，如果令牌有效，则<strong class="is hj">授予对所请求资源的访问权</strong>。</p></div><div class="ab cl kr ks gp kt" role="separator"><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw"/></div><div class="hb hc hd he hf"><h1 id="8692" class="jo jp hi bd jq jr ky jt ju jv kz jx jy jz la kb kc kd lb kf kg kh lc kj kk kl bi translated">什么是JWT？</h1><p id="a6bb" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated"><strong class="is hj"> JWT (JSON Web Token) </strong>是一种简洁的、URL安全的方式来表示要在双方之间传输的声明。通常<strong class="is hj">用于授权请求</strong>和<strong class="is hj">在各方</strong>之间交换信息，例如<strong class="is hj">在服务器和客户端</strong>应用之间。</p><p id="50ee" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">JWT是一个<strong class="is hj">自包含的令牌</strong>，这意味着它在令牌本身内包含了<strong class="is hj">关于用户的所有必要信息。这种<strong class="is hj">消除了服务器查询数据库来验证用户凭证的需要</strong>。相反，服务器可以简单地解码JWT并提取用户的相关信息，比如他们的用户名、角色和其他声明。</strong></p><p id="34d7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">JWT<strong class="is hj">基于JSON(JavaScript Object Notation)</strong>数据格式，广泛用于应用程序之间的数据交换。它以一种紧凑和URL安全的方式进行编码，这使得各方之间的传输和交换变得容易。它还经过数字签名，这确保了它不能被篡改或伪造。</p><p id="9362" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">JWT通常与其他协议和技术(如OAuth和OpenID Connect)结合使用，以提供完整的身份验证和授权解决方案。<strong class="is hj">它被许多流行的网络和移动应用程序广泛使用，如脸书、谷歌和Twitter </strong>，用于安全地交换认证用户的信息。</p></div><div class="ab cl kr ks gp kt" role="separator"><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw"/></div><div class="hb hc hd he hf"><h1 id="f3d8" class="jo jp hi bd jq jr ky jt ju jv kz jx jy jz la kb kc kd lb kf kg kh lc kj kk kl bi translated">核心差异</h1><p id="134f" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">OAuth和JWT是处理认证和授权的两种不同的标准。OAuth(开放授权)是一种开放的访问授权标准，它允许用户授权第三方应用程序访问他们的资源，而无需共享他们的密码。它的工作原理是为应用程序提供一种安全的方式来代表用户访问资源，而不需要用户共享他们的凭据。</p></div><div class="ab cl kr ks gp kt" role="separator"><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw"/></div><div class="hb hc hd he hf"><h1 id="cf72" class="jo jp hi bd jq jr ky jt ju jv kz jx jy jz la kb kc kd lb kf kg kh lc kj kk kl bi translated">Node.js中的OAuth实现</h1><p id="f63f" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">要在Node.js应用程序中实现OAuth，可以使用第三方库，如Passport.js. Passport.js是Node.js的一个流行的身份验证中间件，它提供了一种简单灵活的方法来实现OAuth。</p><p id="2b13" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要使用<strong class="is hj"> Passport.js </strong>，首先需要将其安装在Node.js应用程序中。您可以使用以下命令来完成此操作:</p><pre class="ld le lf lg fd lh li lj bn lk ll bi"><span id="6b17" class="lm jp hi li b be ln lo l lp lq">npm install passport</span></pre><p id="c27f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">接下来，您需要配置<strong class="is hj"> Passport.js </strong>来使用<strong class="is hj"> OAuth </strong>认证策略。这包括指定OAuth提供者(如脸书或T21)并提供必要的凭证，如客户端ID和密码。</p><p id="842b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一旦配置了Passport.js，就可以用它来处理身份验证过程。这通常包括设置处理身份验证请求、回调和其他事件的路由。Passport.js将负责OAuth认证流程的细节，比如生成和验证令牌，以及向您的应用程序提供经过认证的用户的信息。</p><p id="a2b3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下面，您可以找到一个Node.js应用程序的示例，该应用程序使用<strong class="is hj"> Passport.js </strong>通过脸书实现OAuth:</p><pre class="ld le lf lg fd lh li lj bn lk ll bi"><span id="d228" class="lm jp hi li b be ln lo l lp lq">const express = require('express');<br/>const passport = require('passport');<br/>const FacebookStrategy = require('passport-facebook').Strategy;<br/>const app = express();<br/>// Configure Passport to use the Facebook strategy<br/>passport.use(new FacebookStrategy({<br/>  clientID: 'YOUR_CLIENT_ID',<br/>  clientSecret: 'YOUR_CLIENT_SECRET',<br/>  callbackURL: 'http://localhost:3000/auth/facebook/callback'<br/>}, (accessToken, refreshToken, profile, done) =&gt; {<br/>  // Save the authenticated user's information<br/>  done(null, profile);<br/>}));<br/>// Set up routes to handle the authentication flow<br/>app.get('/auth/facebook', passport.authenticate('facebook'));<br/>app.get('/auth/facebook/callback',<br/>  passport.authenticate('facebook', { failureRedirect: '/login' }),<br/>  (req, res) =&gt; {<br/>    // Successful authentication, redirect to the user's profile page<br/>    res.redirect('/profile');<br/>  }<br/>);<br/>app.listen(3000);</span></pre></div><div class="ab cl kr ks gp kt" role="separator"><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw"/></div><div class="hb hc hd he hf"><h1 id="cf2f" class="jo jp hi bd jq jr ky jt ju jv kz jx jy jz la kb kc kd lb kf kg kh lc kj kk kl bi translated">Node.js中的JWT实现</h1><p id="283b" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">JWT(JSON Web Token)是一种在双方之间安全传输信息的方式。在Node.js应用程序中，可以使用第三方库(如jsonwebtoken)轻松生成和验证JWT令牌。</p><p id="bc79" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要生成JWT令牌，<strong class="is hj">首先需要用想要传输的信息创建一个JSON对象，比如认证用户的用户名和角色</strong>。然后，您可以使用jsonwebtoken库来<strong class="is hj">使用秘密密钥</strong>对这个JSON对象进行签名。这将<strong class="is hj">生成一个JWT令牌，该令牌可以传输到客户端</strong>。</p><p id="de08" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要验证JWT令牌，可以使用jsonwebtoken库的<strong class="is hj"> verify </strong>方法。<strong class="is hj">该方法将令牌和密钥作为参数，如果令牌有效，则返回解码后的JSON对象</strong>。<strong class="is hj">这允许服务器根据JWT中包含的信息对用户进行身份验证并授权对受保护资源的访问。</strong></p><p id="4d58" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">总的来说，<strong class="is hj"> JWT提供了一种简单而安全的方式在各方之间传输信息</strong>，jsonwebtoken使得在Node.js应用程序中实现起来很容易。</p><p id="e114" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要在Node.js应用程序中使用JSON Web令牌(jwt ),您必须安装<code class="du lr ls lt li b">jsonwebtoken</code>包。</p><pre class="ld le lf lg fd lh li lj bn lk ll bi"><span id="d3c9" class="lm jp hi li b be ln lo l lp lq">npm install jsonwebtoken</span></pre><p id="d4da" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一旦安装了这个包，您就可以在Node.js代码中使用它来<strong class="is hj">创建和验证jwt</strong>。下面是一个示例，说明如何使用<code class="du lr ls lt li b">jsonwebtoken</code>包来创建一个JWT，断言一组关于与令牌相关联的用户身份的特定声明:</p><pre class="ld le lf lg fd lh li lj bn lk ll bi"><span id="543b" class="lm jp hi li b be ln lo l lp lq">const jwt = require('jsonwebtoken');<br/>// Set the secret that will be used to sign the JWT<br/>const jwtSecret = '&lt;your-jwt-secret&gt;';<br/>// Set the claims that the JWT will assert about the user<br/>const claims = {<br/>  userId: 12345,<br/>  isAdmin: true<br/>};<br/>// Use the JWT library to create a JWT using the claims and the secret<br/>const token = jwt.sign(claims, jwtSecret);</span></pre><p id="8034" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一旦您创建了一个JWT，<strong class="is hj">您就可以在您的API </strong>中使用它来验证用户。这就是你如何使用<code class="du lr ls lt li b">jsonwebtoken</code>包来<strong class="is hj">验证一个JWT并提取其中包含的声明</strong>:</p><pre class="ld le lf lg fd lh li lj bn lk ll bi"><span id="f7ef" class="lm jp hi li b be ln lo l lp lq">const jwt = require('jsonwebtoken');<br/>// Set the secret that will be used to verify the JWT<br/>const jwtSecret = '&lt;your-jwt-secret&gt;';<br/>app.get('/', (req, res) =&gt; {<br/>  // Get the JWT from the request headers<br/>  const token = req.headers.authorization;<br/>  // Use the JWT library to verify the JWT and extract the claims<br/>  const decoded = jwt.verify(token, jwtSecret);<br/>  // Use the claims to authenticate the user and provide access to the API<br/>  if (decoded.isAdmin) {<br/>    res.send('Access granted to admin user');<br/>  } else {<br/>    res.send('Access granted to regular user');<br/>  }<br/>});</span></pre></div><div class="ab cl kr ks gp kt" role="separator"><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw"/></div><div class="hb hc hd he hf"><h1 id="2df9" class="jo jp hi bd jq jr ky jt ju jv kz jx jy jz la kb kc kd lb kf kg kh lc kj kk kl bi translated">对JWT使用OAuth</h1><p id="428a" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">下面是一个示例，说明如何使用这些库来创建一个使用OAuth和JWT进行身份验证的简单服务器:</p><pre class="ld le lf lg fd lh li lj bn lk ll bi"><span id="46ed" class="lm jp hi li b be ln lo l lp lq">const express = require('express');<br/>const oauth = require('oauth');<br/>const jwt = require('jsonwebtoken');<br/>const app = express();<br/>// Create an OAuth client to make requests to the OAuth provider<br/>const oauthClient = new oauth.OAuth(<br/>  'https://&lt;OAuth-provider-URL&gt;/request_token',<br/>  'https://&lt;OAuth-provider-URL&gt;/access_token',<br/>  '&lt;consumer-key&gt;',<br/>  '&lt;consumer-secret&gt;',<br/>  '1.0',<br/>  '&lt;callback-URL&gt;',<br/>  'HMAC-SHA1'<br/>);<br/>// Use the OAuth client to make a request to the OAuth provider to get an access token<br/>oauthClient.getOAuthAccessToken(<br/>  '&lt;request-token&gt;',<br/>  '&lt;request-token-secret&gt;',<br/>  (error, accessToken, accessTokenSecret, results) =&gt; {<br/>    if (error) {<br/>      // Handle error<br/>    } else {<br/>      // Use the access token to make authenticated requests<br/>      const options = {<br/>        url: 'https://&lt;API-URL&gt;/protected_resource',<br/>        oauth: {<br/>          consumer_key: '&lt;consumer-key&gt;',<br/>          consumer_secret: '&lt;consumer-secret&gt;',<br/>          token: accessToken,<br/>          token_secret: accessTokenSecret<br/>        }<br/>      };<br/>      request.get(options, (error, response, body) =&gt; {<br/>        if (error) {<br/>          // Handle error<br/>        } else {<br/>          // Use the JWT library to create a JWT using the access token<br/>          const token = jwt.sign({ accessToken }, '&lt;jwt-secret&gt;');<br/>          // Use the JWT in your API calls to authenticate the user<br/>          app.get('/', (req, res) =&gt; {<br/>            const decoded = jwt.verify(req.headers.authorization, '&lt;jwt-secret&gt;');<br/>            res.send(decoded);<br/>          });<br/>        }<br/>      });<br/>    }<br/>  }<br/>);</span></pre><p id="fe21" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这是如何在Node.js应用程序中使用OAuth和JWT的一个非常基本的例子。在现实世界的应用程序中，您需要<strong class="is hj">处理错误情况，实现适当的安全措施，并提供一个用户友好的认证界面</strong>。</p></div><div class="ab cl kr ks gp kt" role="separator"><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw"/></div><div class="hb hc hd he hf"><h1 id="3883" class="jo jp hi bd jq jr ky jt ju jv kz jx jy jz la kb kc kd lb kf kg kh lc kj kk kl bi translated">结论</h1><p id="973e" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">总之，<strong class="is hj"> JSON Web令牌(jwt)</strong>和<strong class="is hj"> OAuth </strong>都是用于<strong class="is hj">认证和授权</strong>的行业标准协议。jwt用于创建访问令牌，这些令牌断言与令牌相关联的用户身份的一组特定声明。OAuth是一种开放的访问授权标准，它允许第三方服务授予对HTTP服务的有限访问权限。</p><p id="e540" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">jwt</strong>和<strong class="is hj"> OAuth </strong>可以一起使用，在Node.js应用程序中实现安全认证和授权。jwt可以用来创建访问令牌，这些令牌用一个秘密进行签名，并且可以由API进行验证，以对用户进行身份验证。OAuth可用于代表用户授予第三方服务对API的访问权限，而无需用户共享他们的凭证。</p><p id="b65a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">总的来说，JWTs和OAuth <strong class="is hj">是实现安全认证和授权</strong>的强大工具。</p></div></div>    
</body>
</html>