<html>
<head>
<title>Object Detection on Custom Dataset in 3 Simple Steps Using YOLOv5</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用YOLOv5通过3个简单的步骤对自定义数据集进行对象检测</h1>
<blockquote>原文：<a href="https://medium.com/codex/object-detection-on-custom-dataset-in-3-simple-steps-using-yolov5-e9d4940df16e?source=collection_archive---------2-----------------------#2022-02-27">https://medium.com/codex/object-detection-on-custom-dataset-in-3-simple-steps-using-yolov5-e9d4940df16e?source=collection_archive---------2-----------------------#2022-02-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="11ef" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">本文介绍了一个具有高性能指标的自定义标记数据的对象检测框架。</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/4c12fb0dce3011bb43524706904758c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x_roWqoGejW6meKh8iWC4Q.png"/></div></div></figure><p id="281f" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">本文将不提供关于对象检测和所有相关术语的细节。我希望你知道物体检测的理论以及它是如何工作的。在本文中，我将跳到实现部分，这是本文的主要目标。文章分为三个部分。</p><ol class=""><li id="5996" class="kf kg hi jl b jm jn jp jq js kh jw ki ka kj ke kk kl km kn bi translated"><strong class="jl hj">数据集创建:</strong>我将讨论我们输入数据的格式。</li><li id="eff3" class="kf kg hi jl b jm ko jp kp js kq jw kr ka ks ke kk kl km kn bi translated"><strong class="jl hj">培训:</strong>培训步骤、所需的依赖项和代码。</li><li id="91d4" class="kf kg hi jl b jm ko jp kp js kq jw kr ka ks ke kk kl km kn bi translated"><strong class="jl hj">测试:</strong>在给定的一组图像上测试训练好的模型。</li></ol><h1 id="7df2" class="kt ku hi bd kv kw kx ky kz la lb lc ld io le ip lf ir lg is lh iu li iv lj lk bi translated">A.数据集创建</h1><p id="b2ee" class="pw-post-body-paragraph jj jk hi jl b jm ll ij jo jp lm im jr js ln ju jv jw lo jy jz ka lp kc kd ke hb bi translated">首先，我们需要一个带标签的数据集来创建对象检测模型。我们可以使用RoboFlow [1]或LabelImg [2]等在线工具手动注释数据集。有必要以YOLO格式保存对应于每个图像的标签。在YOLO，我们有四个值来确定边界框<strong class="jl hj"><em class="lq">【x _ center，y_center，width，height】，</em> </strong>其中<strong class="jl hj"><em class="lq">'</em></strong><em class="lq">x _ center '</em>和<em class="lq"> 'y_center' </em>是边界框中心的归一化(在0和1之间)坐标。边界框的'<em class="lq">高度'</em>和'<em class="lq">宽度'</em>也在0和1之间标准化。</p><p id="a8af" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">目录结构如下所示。图像名称应该与标签名称相同。换句话说，如果我们在<em class="lq">'</em><strong class="jl hj"><em class="lq">train/images’</em></strong>文件夹中有一个图像<strong class="jl hj"><em class="lq">' 0001 . jpg’</em></strong>，那么我们在<strong class="jl hj"><em class="lq">' train/labels’</em></strong>文件夹中也必须有<strong class="jl hj"><em class="lq">' 0001 . txt’</em></strong>文件。</p><pre class="iy iz ja jb fd lr ls lt lu aw lv bi"><span id="db8a" class="lw ku hi ls b fi lx ly l lz ma"># <em class="lq">dataset folder structure</em></span><span id="d198" class="lw ku hi ls b fi mb ly l lz ma">dataset<br/>  |--- train<br/>  |      |--- images<br/>  |      |--- labels<br/>  |<br/>  |--- valid<br/>  |      |--- images<br/>  |      |--- labels</span></pre><h1 id="8baa" class="kt ku hi bd kv kw kx ky kz la lb lc ld io le ip lf ir lg is lh iu li iv lj lk bi translated"><strong class="ak"> B .培训</strong></h1><h2 id="7d25" class="lw ku hi bd kv mc md me kz mf mg mh ld js mi mj lf jw mk ml lh ka mm mn lj mo bi translated">1.创建一个. yaml文件</h2><p id="1039" class="pw-post-body-paragraph jj jk hi jl b jm ll ij jo jp lm im jr js ln ju jv jw lo jy jz ka lp kc kd ke hb bi translated">首先，我们将创建一个<strong class="jl hj"> <em class="lq"> data.yaml </em> </strong>文件，包含数据集的路径和要检测的类的详细信息。该文件将如下所示。</p><pre class="iy iz ja jb fd lr ls lt lu aw lv bi"><span id="1a79" class="lw ku hi ls b fi lx ly l lz ma">train: dataset/train/images<br/>val: dataset/valid/images</span><span id="57f6" class="lw ku hi ls b fi mb ly l lz ma">nc: 1<br/>names: ['flag']</span></pre><p id="ee41" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">其中，在第一行，我们将指定训练图像的路径。在第二行，我们将提到验证图像的路径。之后，我们将在一个列表中添加类的数量，后跟类标签。</p><h2 id="c7ae" class="lw ku hi bd kv mc md me kz mf mg mh ld js mi mj lf jw mk ml lh ka mm mn lj mo bi translated">2.指定模型架构</h2><p id="a4c0" class="pw-post-body-paragraph jj jk hi jl b jm ll ij jo jp lm im jr js ln ju jv jw lo jy jz ka lp kc kd ke hb bi translated">我们现在将定义YOLOv5模型架构和参数。为此，我们将创建一个<strong class="jl hj"> custom_yolo.yaml </strong>文件，该文件包含以下元素。</p><pre class="iy iz ja jb fd lr ls lt lu aw lv bi"><span id="e815" class="lw ku hi ls b fi lx ly l lz ma"># parameters<br/>nc: 1  # number of classes<br/>depth_multiple: 0.33  # model depth multiple<br/>width_multiple: 0.50  # layer channel multiple</span><span id="711e" class="lw ku hi ls b fi mb ly l lz ma"># anchors<br/>anchors:<br/>  - [10,13, 16,30, 33,23]  # P3/8<br/>  - [30,61, 62,45, 59,119]  # P4/16<br/>  - [116,90, 156,198, 373,326]  # P5/32</span><span id="824b" class="lw ku hi ls b fi mb ly l lz ma"># YOLOv5 backbone<br/>backbone:<br/>  # [from, number, module, args]<br/>  [[-1, 1, Focus, [64, 3]],  # 0-P1/2<br/>   [-1, 1, Conv, [128, 3, 2]],  # 1-P2/4<br/>   [-1, 3, BottleneckCSP, [128]],<br/>   [-1, 1, Conv, [256, 3, 2]],  # 3-P3/8<br/>   [-1, 9, BottleneckCSP, [256]],<br/>   [-1, 1, Conv, [512, 3, 2]],  # 5-P4/16<br/>   [-1, 9, BottleneckCSP, [512]],<br/>   [-1, 1, Conv, [1024, 3, 2]],  # 7-P5/32<br/>   [-1, 1, SPP, [1024, [5, 9, 13]]],<br/>   [-1, 3, BottleneckCSP, [1024, False]],  # 9<br/>  ]</span><span id="98a6" class="lw ku hi ls b fi mb ly l lz ma"># YOLOv5 head<br/>head:<br/>  [[-1, 1, Conv, [512, 1, 1]],<br/>   [-1, 1, nn.Upsample, [None, 2, 'nearest']],<br/>   [[-1, 6], 1, Concat, [1]],  # cat backbone P4<br/>   [-1, 3, BottleneckCSP, [512, False]],  # 13</span><span id="985b" class="lw ku hi ls b fi mb ly l lz ma">[-1, 1, Conv, [256, 1, 1]],<br/>   [-1, 1, nn.Upsample, [None, 2, 'nearest']],<br/>   [[-1, 4], 1, Concat, [1]],  # cat backbone P3<br/>   [-1, 3, BottleneckCSP, [256, False]],  # 17 (P3/8-small)</span><span id="3eca" class="lw ku hi ls b fi mb ly l lz ma">[-1, 1, Conv, [256, 3, 2]],<br/>   [[-1, 14], 1, Concat, [1]],  # cat head P4<br/>   [-1, 3, BottleneckCSP, [512, False]],  # 20 (P4/16-medium)</span><span id="40f7" class="lw ku hi ls b fi mb ly l lz ma">[-1, 1, Conv, [512, 3, 2]],<br/>   [[-1, 10], 1, Concat, [1]],  # cat head P5<br/>   [-1, 3, BottleneckCSP, [1024, False]],  # 23 (P5/32-large)</span><span id="65b4" class="lw ku hi ls b fi mb ly l lz ma">[[17, 20, 23], 1, Detect, [nc, anchors]],  # Detect(P3, P4, P5)<br/>  ]</span></pre><h2 id="ec3c" class="lw ku hi bd kv mc md me kz mf mg mh ld js mi mj lf jw mk ml lh ka mm mn lj mo bi translated">3.从GitHub下载代码。</h2><p id="115f" class="pw-post-body-paragraph jj jk hi jl b jm ll ij jo jp lm im jr js ln ju jv jw lo jy jz ka lp kc kd ke hb bi translated">我们将从GitHub克隆YOLOv5 repo，然后在虚拟环境中安装依赖项[3]。步骤如下。</p><pre class="iy iz ja jb fd lr ls lt lu aw lv bi"><span id="c7b7" class="lw ku hi ls b fi lx ly l lz ma">git clone <a class="ae mp" href="https://github.com/ultralytics/yolov5" rel="noopener ugc nofollow" target="_blank">https://github.com/ultralytics/yolov5</a><br/>cd yolov5<br/>pip install requirements.txt</span></pre><h2 id="5828" class="lw ku hi bd kv mc md me kz mf mg mh ld js mi mj lf jw mk ml lh ka mm mn lj mo bi translated">4.开始训练</h2><p id="c639" class="pw-post-body-paragraph jj jk hi jl b jm ll ij jo jp lm im jr js ln ju jv jw lo jy jz ka lp kc kd ke hb bi translated">完成代码和所需库的设置后，我们就可以运行培训部分了。为此，我们需要转到train.py所在的路径，然后运行以下命令。</p><pre class="iy iz ja jb fd lr ls lt lu aw lv bi"><span id="d5be" class="lw ku hi ls b fi lx ly l lz ma"><strong class="ls hj">python</strong> <strong class="ls hj">train.py</strong> <strong class="ls hj">--img</strong> 416 <strong class="ls hj">--batch</strong> 32 <strong class="ls hj">--epochs</strong> 10 <strong class="ls hj">--data</strong> &lt;path to data.yaml file&gt; <strong class="ls hj">--cfg</strong> &lt;path to custom_yolo.yaml file&gt; <strong class="ls hj">--name</strong> &lt;give name to your run&gt;</span></pre><p id="1689" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">训练完成后，体重将存储在<strong class="jl hj"><em class="lq">‘yolov 5/runs/train/&lt;您的跑步名称&gt;/weights/best . py’</em></strong>中</p><h1 id="b480" class="kt ku hi bd kv kw kx ky kz la lb lc ld io le ip lf ir lg is lh iu li iv lj lk bi translated">C.测试</h1><p id="b639" class="pw-post-body-paragraph jj jk hi jl b jm ll ij jo jp lm im jr js ln ju jv jw lo jy jz ka lp kc kd ke hb bi translated">使用保存的权重，我们可以对测试数据集进行推断。为此，我们需要在终端中运行以下命令。</p><pre class="iy iz ja jb fd lr ls lt lu aw lv bi"><span id="84a1" class="lw ku hi ls b fi lx ly l lz ma"><strong class="ls hj">python</strong> <strong class="ls hj">detect.py</strong> <strong class="ls hj">--weights</strong> &lt;best model weights&gt; <strong class="ls hj">--data</strong> &lt;path to data.yaml file&gt; <strong class="ls hj">--image</strong> 416 <strong class="ls hj">--conf</strong> 0.5 <strong class="ls hj">--source</strong> &lt;test images path&gt;</span></pre><p id="a202" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">测试过程完成后，输出将存储在<strong class="jl hj"><em class="lq">【yolov 5/runs/detect/exp/】</em></strong>中</p><h1 id="5159" class="kt ku hi bd kv kw kx ky kz la lb lc ld io le ip lf ir lg is lh iu li iv lj lk bi translated">结论</h1><p id="a3a6" class="pw-post-body-paragraph jj jk hi jl b jm ll ij jo jp lm im jr js ln ju jv jw lo jy jz ka lp kc kd ke hb bi translated">本文展示了一种使用YOLOv5方法训练自定义对象检测模型的快速而简单的方法。</p><h1 id="aeb9" class="kt ku hi bd kv kw kx ky kz la lb lc ld io le ip lf ir lg is lh iu li iv lj lk bi translated">参考</h1><div class="mq mr ez fb ms mt"><a href="https://roboflow.com/#annotate" rel="noopener  ugc nofollow" target="_blank"><div class="mu ab dw"><div class="mv ab mw cl cj mx"><h2 class="bd hj fi z dy my ea eb mz ed ef hh bi translated">1.Roboflow:让你的软件能够看到图像和视频中的物体</h2><div class="na l"><h3 class="bd b fi z dy my ea eb mz ed ef dx translated">标签使用任何操作系统，无需下载任何软件。使用最流行的注释格式，包括…</h3></div><div class="nb l"><p class="bd b fp z dy my ea eb mz ed ef dx translated">roboflow.com</p></div></div><div class="nc l"><div class="nd l ne nf ng nc nh jh mt"/></div></div></a></div><div class="mq mr ez fb ms mt"><a href="https://github.com/tzutalin/labelImg" rel="noopener  ugc nofollow" target="_blank"><div class="mu ab dw"><div class="mv ab mw cl cj mx"><h2 class="bd hj fi z dy my ea eb mz ed ef hh bi translated">2.github-Tzu talin/labelimg:🖍️labelimg是一个图形化的图像注释工具和标签对象…</h2><div class="na l"><h3 class="bd b fi z dy my ea eb mz ed ef dx translated">LabelImg是一个图形化的图像注释工具。它是用Python写的，使用Qt作为它的图形界面…</h3></div><div class="nb l"><p class="bd b fp z dy my ea eb mz ed ef dx translated">github.com</p></div></div><div class="nc l"><div class="ni l ne nf ng nc nh jh mt"/></div></div></a></div><div class="mq mr ez fb ms mt"><a href="https://github.com/ultralytics/yolov5" rel="noopener  ugc nofollow" target="_blank"><div class="mu ab dw"><div class="mv ab mw cl cj mx"><h2 class="bd hj fi z dy my ea eb mz ed ef hh bi translated">3.GitHub-ultralytics/yolov 5:yolov 5🚀在PyTorch &gt; ONNX &gt; CoreML &gt; TFLite中</h2><div class="na l"><h3 class="bd b fi z dy my ea eb mz ed ef dx translated">YOLOv5🚀是在COCO数据集上预先训练的一系列对象检测体系结构和模型，表示…</h3></div><div class="nb l"><p class="bd b fp z dy my ea eb mz ed ef dx translated">github.com</p></div></div><div class="nc l"><div class="nj l ne nf ng nc nh jh mt"/></div></div></a></div></div></div>    
</body>
</html>