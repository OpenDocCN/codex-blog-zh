<html>
<head>
<title>Sidecar Pattern</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">边车模式</h1>
<blockquote>原文：<a href="https://medium.com/codex/sidecar-pattern-4db37273398b?source=collection_archive---------5-----------------------#2021-09-09">https://medium.com/codex/sidecar-pattern-4db37273398b?source=collection_archive---------5-----------------------#2021-09-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="990d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">应用程序和服务通常需要相关的功能，例如监控、日志记录、配置和网络服务。这些任务独立于正在运行的应用程序，可以在并行组件或服务中实现。</p><p id="94a0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果将它们紧密集成到应用程序中，它们可以在与应用程序相同的进程中运行，从而有效地利用共享资源。但是，这也意味着它们并不是孤立的，由此导致的任何问题或中断都会影响整个应用程序。</p><p id="a5b7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此外，这些功能需要用应用程序使用的相同语言或技术来编写，这可能不适合这些功能。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/d09e8586f5fd7bd209ddcf5b8deebd92.png" data-original-src="https://miro.medium.com/v2/resize:fit:892/format:webp/0*j4ZkI1FsBMmAK7tz.jpg"/></div></figure><h1 id="cc6d" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">边车模式</h1><p id="a3d7" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated">单节点模式中的边车模式由两个容器组成。第一个是应用程序容器，它包含运行应用程序的所有逻辑，没有它，应用程序就毫无用处；第二个是边箱容器。</p><p id="2183" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">sidecar容器的作用是在大多数情况下添加一些功能，而应用程序容器并不知道它们在上面定义的场景中经常使用或不使用。</p><p id="70de" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Sidecar容器与主容器并行运行，可以使用Kubernetes中的pod对象来实现。因为它们运行在同一台机器上，所以它们可以共享资源、空间、文件系统、主机名、网络等。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="er es ko"><img src="../Images/ce644c78bd85bb8a1765b02f415a3dd1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*uGbJkYD4xgQBmz-A.png"/></div></div><figcaption class="kt ku et er es kv kw bd b be z dx translated">来源:微软文档</figcaption></figure><p id="f029" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在微服务领域，可能需要将相同类型的边车添加到多个pod。在一辆摩托车上，边车与一辆摩托车相连，每辆摩托车可以有自己的边车。以同样的方式，sidecar服务共享其父应用程序的命运。对于应用程序的每个实例，sidecar的一个实例被部署并托管在它旁边。</p><h1 id="7ee7" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">实现边车模式</h1><p id="fc95" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated">Sidecar和其他容器一样是一个应用程序容器，有特定的事情要处理。利用Kubernetes中一个pod可以有多个容器的事实，添加它变得更加容易。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="kx ky l"/></div></figure><p id="a63a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在示例中，我们可以看到容器是一个列表，可以将多个容器作为参数，在创建pod时，Kubernetes将为我们处理事情。</p><p id="e256" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先你可以有你的应用程序容器，其次可以是你的边车容器。</p><p id="ebb3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当我不得不处理多个容器的网络流量时，我使用过它。使用sidecar模式做这件事变得更容易，因为我不必接触运行的应用程序。</p><h2 id="60b1" class="kz jm hi bd jn la lb lc jr ld le lf jv iq lg lh jz iu li lj kd iy lk ll kh lm bi translated">现有示例</h2><p id="86a9" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated">市场上已经有一些著名的例子，使用sidecar模式作为内部实现来解决一些问题，如服务网格、网络流量和监控。</p><p id="ee2d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一个著名的例子就是<a class="ae ln" href="https://istio.io/" rel="noopener ugc nofollow" target="_blank"> Istio </a>:一个开源<a class="ae ln" href="https://www.redhat.com/en/topics/microservices/what-is-a-service-mesh" rel="noopener ugc nofollow" target="_blank">服务网格</a>平台，它提供了一种方法来控制<a class="ae ln" href="https://www.redhat.com/en/topics/microservices/what-are-microservices" rel="noopener ugc nofollow" target="_blank">微服务</a>如何彼此共享数据。如果我们阅读问题陈述或服务网格的概念，首先想到的解决方案是sidecar-pattern，可能不是直接的，但是以某种方式。Linkerd 可能是另一个类似于Istio的例子。</p><p id="db94" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="lo">想了解更多关于服务网格的信息— </em> <a class="ae ln" href="redhat.com/en/topics/microservices/what-is-a-service-mesh" rel="noopener ugc nofollow" target="_blank"> <em class="lo">什么是服务网格</em> </a></p><p id="03bb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">另一个著名的例子是<a class="ae ln" href="https://www.envoyproxy.io/docs" rel="noopener ugc nofollow" target="_blank"> Envoy </a>:为云原生应用设计的开源服务代理。</p><h1 id="d24b" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">优势</h1><ul class=""><li id="fcee" class="lp lq hi ih b ii kj im kk iq lr iu ls iy lt jc lu lv lw lx bi translated">就运行时环境和编程语言而言，sidecar独立于其主要应用程序，因此您不需要为每种语言开发一个sidecar。</li><li id="ca9d" class="lp lq hi ih b ii ly im lz iq ma iu mb iy mc jc lu lv lw lx bi translated">sidecar可以访问与主应用程序相同的资源。例如，sidecar可以监控sidecar和主应用程序使用的系统资源。</li><li id="573d" class="lp lq hi ih b ii ly im lz iq ma iu mb iy mc jc lu lv lw lx bi translated">因为它靠近主应用程序，所以在它们之间通信时没有明显的延迟。</li><li id="e65c" class="lp lq hi ih b ii ly im lz iq ma iu mb iy mc jc lu lv lw lx bi translated">即使对于不提供可扩展性机制的应用程序，您也可以使用sidecar来扩展功能，方法是将它作为自己的进程附加到与主应用程序相同的主机或子容器中。</li><li id="eb57" class="lp lq hi ih b ii ly im lz iq ma iu mb iy mc jc lu lv lw lx bi translated">即使sidecar关闭，应用程序容器也将照常工作。</li><li id="0952" class="lp lq hi ih b ii ly im lz iq ma iu mb iy mc jc lu lv lw lx bi translated">应用程序容器不需要担心边车容器。</li></ul><h1 id="f868" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">使用前的考虑</h1><ul class=""><li id="f2d2" class="lp lq hi ih b ii kj im kk iq lr iu ls iy lt jc lu lv lw lx bi translated">边车集装箱足够小，不会影响运行的集装箱。</li><li id="e748" class="lp lq hi ih b ii ly im lz iq ma iu mb iy mc jc lu lv lw lx bi translated">尝试看看您正在使用的部署技术是否真的支持这一点。</li><li id="f291" class="lp lq hi ih b ii ly im lz iq ma iu mb iy mc jc lu lv lw lx bi translated">尽量避免sidecar中的复杂逻辑，这可能会降低运行容器的速度。</li><li id="a610" class="lp lq hi ih b ii ly im lz iq ma iu mb iy mc jc lu lv lw lx bi translated">考虑使用sidecar的最小资源来保持应用程序容器像以前一样运行。</li><li id="9748" class="lp lq hi ih b ii ly im lz iq ma iu mb iy mc jc lu lv lw lx bi translated">还要考虑该功能是否可以实现为库或使用传统的扩展机制。特定于语言的库可能具有更深层次的集成和更少的网络开销。</li></ul><h1 id="1da5" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">何时使用边车模式</h1><ul class=""><li id="98d3" class="lp lq hi ih b ii kj im kk iq lr iu ls iy lt jc lu lv lw lx bi translated">语言或技术不支持您想要的边车功能。</li><li id="55a8" class="lp lq hi ih b ii ly im lz iq ma iu mb iy mc jc lu lv lw lx bi translated">类似的功能必须添加到多个pod中</li><li id="76ec" class="lp lq hi ih b ii ly im lz iq ma iu mb iy mc jc lu lv lw lx bi translated">sidecar中的新功能在特性方面与应用程序容器无关，sidecar只对来自网络或共享资源的一些日志或输出感兴趣。</li><li id="bbe9" class="lp lq hi ih b ii ly im lz iq ma iu mb iy mc jc lu lv lw lx bi translated">您需要一个共享您的主应用程序的整个生命周期，但可以独立更新的服务。</li><li id="9fe7" class="lp lq hi ih b ii ly im lz iq ma iu mb iy mc jc lu lv lw lx bi translated">组件或功能必须与应用程序位于同一主机上。</li><li id="fa59" class="lp lq hi ih b ii ly im lz iq ma iu mb iy mc jc lu lv lw lx bi translated">一个真实的例子是记录所有网络流量或类似的内容。</li></ul><p id="4b69" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这就是本文的结尾，如果您感兴趣，我强烈建议您亲自尝试一下，看看sidecar模式的其他可能的使用案例，或者提到您已经使用过的任何案例。</p></div></div>    
</body>
</html>