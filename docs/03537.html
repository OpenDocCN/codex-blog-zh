<html>
<head>
<title>Scan barcodes in Android using the ML Kit</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用ML套件扫描Android中的条形码</h1>
<blockquote>原文：<a href="https://medium.com/codex/scan-barcodes-in-android-using-the-ml-kit-30b2a03ccd50?source=collection_archive---------0-----------------------#2021-09-08">https://medium.com/codex/scan-barcodes-in-android-using-the-ml-kit-30b2a03ccd50?source=collection_archive---------0-----------------------#2021-09-08</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="84b4" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">如何借助Google APIs在Kotlin中实现实时条形码扫描仪</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/5ded94c14daa6b448e24ec2b2f28f1d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-UrUv2La4ESY5RhmLZRM1A.jpeg"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">照片由<a class="ae jn" href="https://unsplash.com/@alberthu?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">阿尔伯特·胡</a>在<a class="ae jn" href="https://unsplash.com/s/photos/qr-code?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="4fab" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">移动应用中要求的一个非常常见的功能是检测、扫描和分析条形码的能力。</p><p id="fbe5" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">Github上有很多适合需求的开源库。无论如何，我认为使用官方的Google APIs是一个更好的方法。<br/>官方图书馆通常得到更好的维护和优化。</p><p id="e84e" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">谷歌开发了一系列专用于移动开发者的API，这些开发者需要在他们的应用程序中添加机器学习功能。</p><p id="c49a" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">ML套件兼容iOS和Android。<br/>您可以在<a class="ae jn" href="https://developers.google.com/ml-kit" rel="noopener ugc nofollow" target="_blank">官方文档</a>中查看其所有功能。</p></div><div class="ab cl kk kl gp km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="hb hc hd he hf"><h1 id="ba31" class="kr ks hi bd kt ku kv kw kx ky kz la lb io lc ip ld ir le is lf iu lg iv lh li bi translated">必需的库</h1><p id="a69b" class="pw-post-body-paragraph jo jp hi jq b jr lj ij jt ju lk im jw jx ll jz ka kb lm kd ke kf ln kh ki kj hb bi translated">对于这个项目，您将需要使用两个库:</p><ol class=""><li id="4dcf" class="lo lp hi jq b jr js ju jv jx lq kb lr kf ls kj lt lu lv lw bi translated"><strong class="jq hj">条形码扫描API </strong> <br/>该库是ML Kit Vision API的一部分。<br/>顾名思义，它的功能是读取各种条形码格式的数据。<br/>你可以在<a class="ae jn" href="https://developers.google.com/ml-kit/vision/barcode-scanning" rel="noopener ugc nofollow" target="_blank">官方文档</a>中找到关于这个API的更多信息。</li><li id="fdbd" class="lo lp hi jq b jr lx ju ly jx lz kb ma kf mb kj lt lu lv lw bi translated"><strong class="jq hj"> CameraX <br/> </strong>这个支持库是<a class="ae jn" href="https://developer.android.com/jetpack" rel="noopener ugc nofollow" target="_blank"> Android Jetpack </a>套件的一部分。它提供了一个API，使得与相机相关的功能易于开发和实现。你可以在官方文档中了解更多关于这个库的信息。</li></ol><h1 id="e44b" class="kr ks hi bd kt ku mc kw kx ky md la lb io me ip ld ir mf is lf iu mg iv lh li bi translated">项目设置</h1><p id="1a27" class="pw-post-body-paragraph jo jp hi jq b jr lj ij jt ju lk im jw jx ll jz ka kb lm kd ke kf ln kh ki kj hb bi translated">开始的第一步是向项目添加所需的依赖项和权限。</p><ol class=""><li id="358c" class="lo lp hi jq b jr js ju jv jx lq kb lr kf ls kj lt lu lv lw bi translated">将<code class="du mh mi mj mk b">mavenCentral()</code>存储库包含到您的项目级<code class="du mh mi mj mk b">build.gradle</code>文件中。</li><li id="8d7e" class="lo lp hi jq b jr lx ju ly jx lz kb ma kf mb kj lt lu lv lw bi translated">将依赖项添加到您的应用程序级<code class="du mh mi mj mk b">build.gradle</code>文件中:</li></ol><pre class="iy iz ja jb fd ml mk mm mn aw mo bi"><span id="c0dd" class="mp ks hi mk b fi mq mr l ms mt">// Barcode scanning API<br/>implementation 'com.google.mlkit:barcode-scanning:17.0.0'</span><span id="b4af" class="mp ks hi mk b fi mu mr l ms mt">// CameraX library<br/>def camerax_version = "1.0.1"</span><span id="378a" class="mp ks hi mk b fi mu mr l ms mt">implementation "androidx.camera:camera-camera2:$camerax_version"<br/>implementation "androidx.camera:camera-lifecycle:$camerax_version"<br/>implementation "androidx.camera:camera-view:1.0.0-alpha28"</span></pre><p id="3b31" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">3.将所需的<code class="du mh mi mj mk b">CAMERA</code>权限添加到您的<code class="du mh mi mj mk b">AndroidManifest.xml</code>文件中:</p><pre class="iy iz ja jb fd ml mk mm mn aw mo bi"><span id="df8a" class="mp ks hi mk b fi mq mr l ms mt">&lt;uses-permission android:name="android.permission.CAMERA" /&gt;</span></pre><p id="0158" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">一旦完成了这些配置步骤并同步了所有的依赖项，就可以进入实现阶段了。</p><h1 id="5549" class="kr ks hi bd kt ku mc kw kx ky md la lb io me ip ld ir mf is lf iu mg iv lh li bi translated">项目执行</h1><p id="8dc4" class="pw-post-body-paragraph jo jp hi jq b jr lj ij jt ju lk im jw jx ll jz ka kb lm kd ke kf ln kh ki kj hb bi translated">让我们使用单个活动应用程序实现一个简单的条形码扫描器。</p><h2 id="8296" class="mp ks hi bd kt mv mw mx kx my mz na lb jx nb nc ld kb nd ne lf kf nf ng lh nh bi translated">1.创建<code class="du mh mi mj mk b">ImageAnalysis.Analyzer class</code>的子类</h2><p id="deb5" class="pw-post-body-paragraph jo jp hi jq b jr lj ij jt ju lk im jw jx ll jz ka kb lm kd ke kf ln kh ki kj hb bi translated">这个类将负责处理从摄像机接收到的所有帧。</p><p id="6e70" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">该类必须覆盖<code class="du mh mi mj mk b">analyze(image: ImageProxy)</code>方法。<br/>该方法将从摄像机捕捉的每一帧作为<code class="du mh mi mj mk b">ImageProxy</code>对象接收，并允许您对其进行处理。</p><p id="d078" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">要设置处理环境，您需要:</p><ol class=""><li id="4079" class="lo lp hi jq b jr js ju jv jx lq kb lr kf ls kj lt lu lv lw bi translated">通过<code class="du mh mi mj mk b">fromMediaImage</code>方法从接收到的图像中创建一个<code class="du mh mi mj mk b">InputImage</code>对象</li><li id="a322" class="lo lp hi jq b jr lx ju ly jx lz kb ma kf mb kj lt lu lv lw bi translated">创建一个将处理<code class="du mh mi mj mk b">InputImage</code>的<code class="du mh mi mj mk b">BarcodeScanner</code>对象。<br/>该对象将为其配置接收一个<code class="du mh mi mj mk b">BarcodeScannerOptions</code>参数。<br/>初始化后，您将能够处理收到的条形码或处理扫描阶段出现的错误。</li></ol><p id="053c" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">您可以通过使用<code class="du mh mi mj mk b">setBarcodeFormats</code>方法指定扫描仪接受的格式来优化扫描过程。</p><p id="c0dc" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">一旦分析终止，调用</strong> <code class="du mh mi mj mk b"><strong class="jq hj">image.close()</strong></code> <strong class="jq hj">方法</strong>是很重要的。<br/>这将为待处理的其他图像释放分析队列。</p><p id="e84c" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">下面是该类的完整实现:</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ni nj l"/></div></figure><h2 id="55dd" class="mp ks hi bd kt mv mw mx kx my mz na lb jx nb nc ld kb nd ne lf kf nf ng lh nh bi translated">2.创建BarcodeScanner活动</h2><p id="9f96" class="pw-post-body-paragraph jo jp hi jq b jr lj ij jt ju lk im jw jx ll jz ka kb lm kd ke kf ln kh ki kj hb bi translated">现在，是时候设置应用程序的主要活动了。</p><p id="577d" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在您的<code class="du mh mi mj mk b">/res/layout</code>文件夹中创建一个XML布局文件，姑且称之为<code class="du mh mi mj mk b">activity_barcode_scanner.xml</code></p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ni nj l"/></div></figure><p id="3514" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">如您所见，该布局仅包含<code class="du mh mi mj mk b">PreviewView</code>组件。这将负责在屏幕上显示相机预览。</p><p id="c068" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">然后，<strong class="jq hj">创建与布局相关联的活动</strong>，姑且称之为<code class="du mh mi mj mk b">BarcodeScannerActivity.kt</code></p><p id="1ff7" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在这个类中有3个基本特性需要实现:</p><ol class=""><li id="949a" class="lo lp hi jq b jr js ju jv jx lq kb lr kf ls kj lt lu lv lw bi translated">设置一个<code class="du mh mi mj mk b">ExecutorService</code>实例。</li><li id="5b70" class="lo lp hi jq b jr lx ju ly jx lz kb ma kf mb kj lt lu lv lw bi translated">处理<code class="du mh mi mj mk b">Android.manifest.CAMERA</code>权限的请求。</li><li id="bcbd" class="lo lp hi jq b jr lx ju ly jx lz kb ma kf mb kj lt lu lv lw bi translated">编写负责设置相机预览的代码，并将其绑定到之前创建的图像分析器。</li></ol><p id="e4fc" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">让我们从<strong class="jq hj">初始化</strong> <code class="du mh mi mj mk b"><strong class="jq hj">ExecutorService</strong></code>开始。</p><p id="3f2c" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这个类提供了产生一个<code class="du mh mi mj mk b">Future</code>的方法，它将负责跟踪摄像机生成的任务。<br/>你可以在<a class="ae jn" href="https://developer.android.com/reference/java/util/concurrent/ExecutorService" rel="noopener ugc nofollow" target="_blank">官方文档</a>上找到更多信息。</p><p id="ea3e" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我们声明一个<code class="du mh mi mj mk b">lateinit</code> var，它将在活动创建时初始化，并在活动被销毁后关闭。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ni nj l"/></div></figure><p id="407c" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">然后，是负责许可请求的<strong class="jq hj">代码的时候了。</strong></p><p id="931f" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">您需要实现<strong class="jq hj"> 3个方法</strong>:</p><ol class=""><li id="940b" class="lo lp hi jq b jr js ju jv jx lq kb lr kf ls kj lt lu lv lw bi translated">一个负责提示用户许可的功能，如果用户还没有被授予许可的话。</li><li id="847a" class="lo lp hi jq b jr lx ju ly jx lz kb ma kf mb kj lt lu lv lw bi translated">一种控制权限是否被授予的功能，如果不是，则提示用户。</li><li id="5486" class="lo lp hi jq b jr lx ju ly jx lz kb ma kf mb kj lt lu lv lw bi translated">分析用户对权限请求的响应的功能。</li></ol><p id="ec81" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">您可以在下面的代码中看到上述函数的实现。<br/>创建活动后，您可以通过调用<code class="du mh mi mj mk b">checkCameraPermission</code>请求用户的许可。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ni nj l"/></div></figure><p id="c591" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">正确管理权限后，让我们执行<strong class="jq hj">摄像机设置代码</strong>。</p><p id="928c" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">您需要声明一个方法。<br/>这种方法将需要:</p><ol class=""><li id="4899" class="lo lp hi jq b jr js ju jv jx lq kb lr kf ls kj lt lu lv lw bi translated">检索一个<code class="du mh mi mj mk b">ProcessCameraProvider</code>实例。<br/>该对象将相机生命周期绑定到应用程序。</li><li id="a13f" class="lo lp hi jq b jr lx ju ly jx lz kb ma kf mb kj lt lu lv lw bi translated">设置<code class="du mh mi mj mk b">Preview</code>对象，连接布局中声明的<code class="du mh mi mj mk b">PreviewView</code></li><li id="477d" class="lo lp hi jq b jr lx ju ly jx lz kb ma kf mb kj lt lu lv lw bi translated">设置<code class="du mh mi mj mk b">QrCodeAnalyzer</code>类。<br/>你应该指定<code class="du mh mi mj mk b">ImageAnalysis.STRATEGY_KEEP_ONLY_LATEST</code>用于优化目的。通过这样做，每次只有一个帧将被传送用于分析，避免处理队列的大小增长。</li><li id="210b" class="lo lp hi jq b jr lx ju ly jx lz kb ma kf mb kj lt lu lv lw bi translated">通过<code class="du mh mi mj mk b">CameraSelector</code>属性选择预览的首选摄像机</li><li id="87ab" class="lo lp hi jq b jr lx ju ly jx lz kb ma kf mb kj lt lu lv lw bi translated">使用<code class="du mh mi mj mk b">bindToLifecycle</code>方法用指定的配置设置摄像机会话。</li></ol><p id="8976" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">下面是一个实现这些步骤的函数。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ni nj l"/></div></figure><p id="67cb" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">现在，您应该能够使用您的应用程序扫描条形码了:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nk"><img src="../Images/266ae53d2c91cd1b96ae139f664a4cd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oG-Y8fZKfj9SYcHvAp2BEw.jpeg"/></div></div></figure><h2 id="c966" class="mp ks hi bd kt mv mw mx kx my mz na lb jx nb nc ld kb nd ne lf kf nf ng lh nh bi translated">3.(可选)在条形码上绘制一个图形轮廓</h2><p id="2d45" class="pw-post-body-paragraph jo jp hi jq b jr lj ij jt ju lk im jw jx ll jz ka kb lm kd ke kf ln kh ki kj hb bi translated">您可以在应用程序中实现的一个可选功能是在检测到的条形码周围添加一个边框。增加这个功能会给用户友好的反馈。</p><p id="c2b1" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">您可以通过以下两个步骤添加图形轮廓:</p><ol class=""><li id="cf91" class="lo lp hi jq b jr js ju jv jx lq kb lr kf ls kj lt lu lv lw bi translated">实现<code class="du mh mi mj mk b">View</code>类的一个子类。这个类将负责在屏幕上绘制矩形。</li><li id="1cdb" class="lo lp hi jq b jr lx ju ly jx lz kb ma kf mb kj lt lu lv lw bi translated">编辑您的<code class="du mh mi mj mk b">ImageAnalysis.Analyzer</code>类，以便在检测到条形码时处理<code class="du mh mi mj mk b">View</code>类的添加。</li></ol><p id="5bce" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">让我们从 <code class="du mh mi mj mk b"><strong class="jq hj">View</strong></code> <strong class="jq hj">子类</strong>的<strong class="jq hj">创建开始。<br/>新建一个文件，姑且称之为<code class="du mh mi mj mk b">BarcodeBoxView</code>。</strong></p><p id="f703" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这个类将接收一个符合<code class="du mh mi mj mk b">View</code>构造函数的<code class="du mh mi mj mk b">Context</code>参数。</p><p id="3b3b" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">此外，您将使用两个全局变量:</p><ol class=""><li id="a301" class="lo lp hi jq b jr js ju jv jx lq kb lr kf ls kj lt lu lv lw bi translated">一个<code class="du mh mi mj mk b">Paint</code>物体。<br/>这将负责存储包围盒的样式信息。</li><li id="5999" class="lo lp hi jq b jr lx ju ly jx lz kb ma kf mb kj lt lu lv lw bi translated">一个<code class="du mh mi mj mk b">RectF</code>物体。它将包含将要在屏幕上绘制的矩形的坐标。<br/>这个变量将有一个自定义的<code class="du mh mi mj mk b">setter</code>来更新它的值。</li></ol><p id="b5e1" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">该类的主要功能是<code class="du mh mi mj mk b">onDraw(canvas: Canvas?)</code>方法。<br/>它负责在每次调用<code class="du mh mi mj mk b">setRect</code>方法时在屏幕上显示所需的图形。</p><p id="104c" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">下面是该类的完整实现:</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ni nj l"/></div></figure><p id="5eb9" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">一旦你创建了这个类，你需要修改<code class="du mh mi mj mk b">QrCodeAnalyzer</code>类，以在每次新的条形码可视化时更新边界框。</p><p id="45a7" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">为此，您需要<strong class="jq hj">向类构造函数</strong>添加3个变量:</p><ol class=""><li id="81d3" class="lo lp hi jq b jr js ju jv jx lq kb lr kf ls kj lt lu lv lw bi translated">在<code class="du mh mi mj mk b">BarcodeScannerActivity</code>中初始化的<code class="du mh mi mj mk b">BarcodeBoxView</code>实例</li><li id="91ab" class="lo lp hi jq b jr lx ju ly jx lz kb ma kf mb kj lt lu lv lw bi translated"><code class="du mh mi mj mk b">PreviewView</code>的宽度</li><li id="4cbe" class="lo lp hi jq b jr lx ju ly jx lz kb ma kf mb kj lt lu lv lw bi translated"><code class="du mh mi mj mk b">PreviewView</code>的高度</li></ol><p id="87a7" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">最后两个参数将用于调整边界框相对于<code class="du mh mi mj mk b">PreviewView</code>大小的比例。</p><p id="db35" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">之后，你需要实现负责缩放边界框的代码，以适应<code class="du mh mi mj mk b">PreviewView</code>的尺寸。</p><p id="783c" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">您可以通过以下步骤实现这一点:</p><ol class=""><li id="b1e7" class="lo lp hi jq b jr js ju jv jx lq kb lr kf ls kj lt lu lv lw bi translated">声明水平和垂直比例因子，即<code class="du mh mi mj mk b">scaleX</code>和<code class="du mh mi mj mk b">scaleY</code>。</li><li id="d501" class="lo lp hi jq b jr lx ju ly jx lz kb ma kf mb kj lt lu lv lw bi translated">声明两个函数，负责参数的调整。将此功能称为<code class="du mh mi mj mk b">translateX</code>和<code class="du mh mi mj mk b">translateY</code>。</li><li id="0c64" class="lo lp hi jq b jr lx ju ly jx lz kb ma kf mb kj lt lu lv lw bi translated">声明一个函数，该函数将应用从<code class="du mh mi mj mk b">barcode.boundingBox</code>参数接收到的对<code class="du mh mi mj mk b">Rect</code>的调整。</li></ol><p id="64af" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在初始化阶段完成后，您可以通过使用<code class="du mh mi mj mk b">BarcodeBoxView</code>类的<code class="du mh mi mj mk b">setRect</code>方法来更新条形码的边界框。</p><p id="0b1c" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">下面是所讨论的类的完整实现:</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ni nj l"/></div></figure><p id="6760" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">最后，为了让它工作，您需要通过添加所需的参数来修改<code class="du mh mi mj mk b">startCamera</code>方法中的<code class="du mh mi mj mk b">QrCodeAnalyzer</code>构造函数:</p><pre class="iy iz ja jb fd ml mk mm mn aw mo bi"><span id="02ce" class="mp ks hi mk b fi mq mr l ms mt">QrCodeAnalyzer(<br/>    this,<br/>    barcodeBoxView,<br/>    binding.previewView.<em class="nl">width</em>.toFloat(),<br/>    binding.previewView.<em class="nl">height</em>.toFloat()<br/>)</span></pre><p id="e896" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">完成这些步骤后，您应该能够看到每次扫描条形码时都会显示一个边界框。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nk"><img src="../Images/b89a52deabc178e58a07a4960502a1ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8aKZTjD8eEJU2wMvWCmi-Q.jpeg"/></div></div></figure></div><div class="ab cl kk kl gp km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="hb hc hd he hf"><h1 id="260d" class="kr ks hi bd kt ku kv kw kx ky kz la lb io lc ip ld ir le is lf iu lg iv lh li bi translated">包扎</h1><p id="8441" class="pw-post-body-paragraph jo jp hi jq b jr lj ij jt ju lk im jw jx ll jz ka kb lm kd ke kf ln kh ki kj hb bi translated">这就是功能的实现。<br/>你可以在这个<a class="ae jn" href="https://github.com/lpizzinidev/android-barcode-scan-example" rel="noopener ugc nofollow" target="_blank"> GitHub repo </a>找到完整的示例项目。</p><p id="fe9d" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我希望这篇文章能帮助你构建令人惊叹的应用程序，并让你更清楚如何使用Android集成ML工具包库。</p><p id="e08c" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">编码快乐！</p></div></div>    
</body>
</html>