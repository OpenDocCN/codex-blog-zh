<html>
<head>
<title>What are C# Source Generators</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">什么是C#源代码生成器</h1>
<blockquote>原文：<a href="https://medium.com/codex/what-are-c-source-generators-b55e626e9e09?source=collection_archive---------14-----------------------#2021-07-21">https://medium.com/codex/what-are-c-source-generators-b55e626e9e09?source=collection_archive---------14-----------------------#2021-07-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/53fa9b54c608b6462317436ccf2fc0c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qkM_APY8tbcie4Ow7QkAhQ.png"/></div></div></figure><p id="4c43" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">全球的开发人员都在寻找C#编译器中的一种新功能，这种新功能允许他们评估用户代码并生成额外的C#源文件(这些源文件又可以包含在编译中)。</p><p id="90da" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当一种被称为源生成器的新型组件被创建时，他们的请求被批准了。</p><p id="e45d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这篇文章中，让我们了解你需要知道的关于C#源代码生成器的一切，以及它对这些开发人员的用处。</p><p id="89cc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">目录</strong></p><ol class=""><li id="957e" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn jt ju jv jw bi translated">什么是源生成器？</li><li id="5f07" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">受益于源生成器的场景</li><li id="9f7c" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">源生成器和提前(AOT)编译</li><li id="d01a" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">源发生器的下一步是什么？</li><li id="4782" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">结论</li></ol><h1 id="d24c" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">什么是源生成器？</h1><p id="7ea1" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">除非你已经仔细跟踪了与C#语言相关的每一个原型和提议，否则你现在可能会问自己，“什么是源代码生成器？”简单地说，源代码生成器是在编译期间运行的一段代码，它检查您的程序，以生成与其余代码一起编译的附加文件。</p><p id="f2d1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">源生成器允许他们实现两件事:</p><ul class=""><li id="8e3d" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn lf ju jv jw bi translated">获取表示所有正在编译的用户代码的编译对象。可以检查这个对象，并且可以编写代码，使用正在编译的代码的语法和语义模型，类似于今天分析器的工作方式。</li><li id="b91f" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn lf ju jv jw bi translated">生成可以在编译过程中插入到编译对象中的C#源文件。换句话说，在生成代码的同时，您可以提交一个新的源代码作为输入。</li></ul><p id="baa0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这两个因素结合起来，使源发生器非常有益。您可以使用编译器在编译期间生成的所有丰富元数据来检查用户代码，然后根据您分析的数据将C#代码发送回相同的编译中！源代码生成器与Roslyn分析器相似，都是可以生成C#源代码的分析器。</p><p id="aa10" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在编译步骤中使用源生成器，如下所示:</p><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lg"><img src="../Images/3c592412ff30ef5d2408bd8c88e6e1bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*o66z8jNyDiVBUzAo"/></div></div></figure><p id="8389" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">源生成器是a.NET标准2.0程序集，由编译器与任何分析器一起加载。它可用于支持加载和运行of.NET标准组件的情况。</p><h1 id="2fad" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">受益于源生成器的场景</h1><p id="146b" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">关于源生成器，最重要的是它能做什么，而不是它是什么。运行时反射、IL编织和杂耍MSBuild任务是评估用户代码和基于当今技术所利用的分析创建信息/代码的三种常见方式。源生成器有可能胜过所有其他方法。</p><p id="a8c1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">运行时反射是to.NET最近增加的一个强大功能。它可以用于各种情况。当一个应用程序启动时，一个常见的情况是分析用户代码，并使用结果来构建一些东西。</p><p id="c793" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">例如，当您的web服务最初运行时，ASP.NET核心使用反射来查找您定义的结构，这样它就可以“连接”像控制器和剃刀页这样的东西。虽然这允许您编写具有强大抽象的简单代码，但它在运行时会有性能损失:当您的web服务或应用程序首次启动时，它将无法接受任何请求，直到所有发现代码信息的运行时反射代码都已运行完毕！尽管性能损失并不显著，但它是一种沉没成本，您无法在软件中消除它。</p><p id="1a56" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">启动的控制器发现部分可能会在编译时使用源代码生成器进行，它会分析您的源代码并发出“连接”您的应用程序所需的代码。因为现在运行时发生的活动可能会转移到编译时，这可能会导致更快的启动时间。</p><p id="cf78" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">源生成器可以通过多种方法提高效率，包括使用运行时反射来查找类型。有些情况下需要重复调用MSBuild C#任务(名为CSC)来检查编译中的数据。正如您所料，多次使用编译器会对开发程序的总时间产生影响。</p><p id="f95c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">可以利用源代码生成器来消除像这样处理MSBuild作业的需要，因为源代码生成器不仅提高了性能，还允许工具在适当的抽象级别上工作。</p><p id="3957" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">源代码生成器的另一个优点是，它们可以消除对一些“字符串型”API的需求，比如ASP.NET核心中控制器和razor页面之间的路由。路由可以用源生成器强类型化，生成适当的字符串作为编译时细节。这将减少错误输入的字符串导致请求被发送到错误控制器的次数。</p><h1 id="e63c" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">源生成器和提前(AOT)编译</h1><p id="63f6" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">源代码生成器还可以帮助清除基于链接器和AOT(提前)编译改进的实质性障碍。许多框架和库，比如System，大量使用了反射或反射发射。</p><p id="8748" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">许多最流行的NuGet包严重依赖反射在运行时查找类型。因为most.NET项目需要包含这些包，所以代码的“可链接性”和利用AOT编译器优化的能力会受到严重损害。</p><h1 id="fc93" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">结论</h1><p id="f793" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">源代码生成器是一个重要的特性，它让开发人员的生活变得更好。您可以使用该功能以安全和高性能的方式现代化重复编码模式。我强烈建议你试一试。当您生成代码时，您可能会惊讶于您能取得的成就。</p></div><div class="ab cl ll lm gp ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="hb hc hd he hf"><p id="ee1c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="ls">原载于</em><a class="ae lt" href="https://www.partech.nl/nl/publicaties/2021/07/what-are-c-sharp-source-generators" rel="noopener ugc nofollow" target="_blank"><em class="ls">https://www . partech . nl</em></a><em class="ls">。</em></p></div></div>    
</body>
</html>