<html>
<head>
<title>DNS Resolution: Resolving a domain name to an IP address</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">DNS解析:将域名解析为IP地址</h1>
<blockquote>原文：<a href="https://medium.com/codex/dns-resolution-resolving-a-domain-name-to-an-ip-address-d270745cea29?source=collection_archive---------4-----------------------#2021-08-22">https://medium.com/codex/dns-resolution-resolving-a-domain-name-to-an-ip-address-d270745cea29?source=collection_archive---------4-----------------------#2021-08-22</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/1dccbb798bd564972e41a5f6d624b555.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_ORc96vVOAG6sOlwW9fPYQ.png"/></div></div></figure><p id="c0a8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当你在浏览器中输入域名时会发生什么？</p><p id="7c0f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们都知道计算机只懂IP地址不懂域名，那么域名是如何映射到IP地址的呢？</p><p id="7171" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">大多数人都知道有一个将域名转换成IP地址的DNS解析过程，但是这个过程是如何进行的呢？</p><p id="2184" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这篇文章将涵盖将域名解析成相应IP地址的每一个步骤。</p><h1 id="402e" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated"><strong class="ak">第一步:检查浏览器缓存</strong></h1><p id="bb8c" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">如果这不是你第一次访问一个网站，有可能你的浏览器已经缓存了该IP地址。</p><p id="6ef1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这是为了提高性能，避免花费时间寻找IP地址。</p><p id="667b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果是这种情况，那么该过程在此结束。</p><p id="0ca5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">但是如果你是第一次访问这个网站，或者可能是很久以后，我们将不会有浏览器缓存</p><h1 id="0389" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated"><strong class="ak">第二步:将解析转发给OS </strong></h1><p id="52c5" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">如果浏览器没有找到缓存，它会对操作系统进行系统调用。发出的系统调用是<a class="ae kr" href="https://man7.org/linux/man-pages/man3/gethostbyname.3.html" rel="noopener ugc nofollow" target="_blank"> gethostbyname </a>。</p><p id="4893" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一旦进行了这个调用，操作系统就会查看文件<a class="ae kr" href="https://man7.org/linux/man-pages/man5/nsswitch.conf.5.html" rel="noopener ugc nofollow" target="_blank"> /etc/nsswitch.conf </a>。</p><p id="f37f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这个文件很可能有一个类似于</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="3de8" class="lb jp hi kx b fi lc ld l le lf">hosts:    files dns</span></pre><p id="6ee8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这意味着它现在需要检查/etc/hosts文件</p><h1 id="1b19" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated"><strong class="ak">第三步:/etc/hosts and and/etc/resolv . conf</strong></h1><p id="9632" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">/etc/hosts文件包含以下格式的条目</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="d4fc" class="lb jp hi kx b fi lc ld l le lf">127.0.0.1 localhost.localdomain localhost<br/>::1 localhost.localdomain localhost</span></pre><p id="7a33" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">操作系统检查/etc/hosts文件中是否有请求域名的DNS条目。</p><p id="8c43" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果找到条目，则返回相应的IP地址。如果/etc/hosts文件中没有该域名的条目，它将对/etc/resolv.conf文件进行DNS调用。</p><p id="ac63" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果没有响应，将向该文件中的第一个IP地址发送DNS请求。</p><p id="056a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这通常是DNS解析器的IP地址。</p><h1 id="305f" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated"><strong class="ak">步骤4: DNS解析器</strong></h1><p id="60b8" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">一旦DNS解析器收到DNS请求，它就会在缓存中查找。也许其他主机也向它查询了域名的解析，并且它的缓存中存在该条目。</p><p id="960e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果是，它返回缓存的IP地址作为响应。</p><p id="5e8d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果没有条目，DNS解析器会将请求发送到根机构</p><h1 id="b19d" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated"><strong class="ak">第五步:根权限</strong></h1><p id="c220" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">DNS解析器拥有根权威名称服务器的IP地址。</p><p id="96e7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这些名称服务器包含域扩展的权威名称服务器的IP地址。</p><p id="7d90" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因此，对于我们的例子，如果我们正在解析medium.com，根权威服务器将查找<em class="lg"> com </em>扩展的权威域名服务器的IP地址。</p><h1 id="cfb0" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated"><strong class="ak">第六步:联系域名扩展的权威服务器</strong></h1><p id="d04b" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">根域名服务器返回<em class="lg"> com </em>权威域名服务器的IP地址。</p><p id="57d5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一旦我们的解析器(从第4步开始)得到这个IP地址，它就向<em class="lg"> com </em>权威服务器发送一个DNS请求。</p><p id="d4e4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这个权威服务器查找它的记录并返回medium.com域名服务器的IP地址</p><h1 id="cfc9" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated"><strong class="ak">第七步:获取最终的DNS记录</strong></h1><p id="6a26" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">一旦我们的解析器(来自步骤4)收到medium.com域名服务器的IP地址，它就向它发送DNS查询。</p><p id="119e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这一次，域名服务器查看其DNS记录，并获取映射到medium.com的记录。</p><p id="9ad9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这可能是一个A记录，CNAME或任何其他记录。</p><p id="f383" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后，这将作为响应发送给我们的DNS解析器。</p><p id="472b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果是A记录，解析器会缓存IP地址并发送给我们的操作系统，操作系统会将其转发给浏览器。然后浏览器也会缓存它。</p><p id="1abd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果是CNAME，则执行从步骤4到步骤7的完整过程，以将相应的CNAME解析为其IP地址。</p><h1 id="5e81" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated"><strong class="ak">一些基本要点</strong></h1><p id="e20a" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">现在我们知道了DNS解析的整个过程，让我们看看它有时会如何影响我们的日常生活。</p><p id="044f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因此，假设您的一个浏览器正在打开网站，而另一个浏览器显示一些错误。这很可能是因为IP地址已经改变，其中一个浏览器正在使用其缓存来解析IP地址。在这种情况下，只要缓存过期，一切都会恢复正常。</p><p id="7f11" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">假设你的一个朋友在不同的州可以访问一个网站，但是你在打开这个网站时会遇到错误。这是相同的缓存问题，但这一次是在解析器级别。</p><p id="5a0b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">虽然这些缓存问题很少发生，但是无论何时发生，我们都不知道发生了什么，它们似乎可以神奇地自我修复。</p><p id="b65a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">DNS解析过程也解释了为什么拥有CNAMEs是一个性能问题。因为现在要打开你的网站，DNS解析过程要进行两次(或者更多，如果CNAME指向另一个CNAME)。</p></div></div>    
</body>
</html>