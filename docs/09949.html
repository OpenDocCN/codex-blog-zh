<html>
<head>
<title>Deploying a Kotlin app to Railway (a Slack bot)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将Kotlin应用程序部署到铁路(一个Slack bot)</h1>
<blockquote>原文：<a href="https://medium.com/codex/deploying-a-kotlin-app-in-railway-a-slack-bot-f1d7a2386652?source=collection_archive---------1-----------------------#2022-11-22">https://medium.com/codex/deploying-a-kotlin-app-in-railway-a-slack-bot-f1d7a2386652?source=collection_archive---------1-----------------------#2022-11-22</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="96dc" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">我们将部署一个“Hello world”Slack bot到Railway，来源于GitHub(用Kotlin编写)。</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/10448d502890331d92b33ec0c1ce1e88.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ml7JTmmq-8djuB-2"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">照片由<a class="ae jn" href="https://unsplash.com/@ekrull?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">埃里克·克鲁尔</a>在<a class="ae jn" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="3405" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">既然Heroku不再有免费计划，是时候为我们的实验性JVM应用找到一个新家了。<a class="ae jn" href="https://railway.app/" rel="noopener ugc nofollow" target="_blank">铁路</a>做<a class="ae jn" href="https://nixpacks.com/docs/providers/java" rel="noopener ugc nofollow" target="_blank">的工作</a>。</p><h1 id="851b" class="kk kl hi bd km kn ko kp kq kr ks kt ku io kv ip kw ir kx is ky iu kz iv la lb bi translated">1.代码库</h1><ol class=""><li id="4586" class="lc ld hi jq b jr le ju lf jx lg kb lh kf li kj lj lk ll lm bi translated"><a class="ae jn" href="https://lsoares.medium.com/kotlin-gradle-junit-starter-project-a113a2cc9cbb" rel="noopener"> <strong class="jq hj">创建一个新的Kotlin项目</strong> </a> <strong class="jq hj">。</strong></li><li id="2e08" class="lc ld hi jq b jr ln ju lo jx lp kb lq kf lr kj lj lk ll lm bi translated">如果你还没有做<code class="du ls lt lu lv b">git init</code>，你应该现在就做。</li><li id="6862" class="lc ld hi jq b jr ln ju lo jx lp kb lq kf lr kj lj lk ll lm bi translated">确保在根目录下有一个<code class="du ls lt lu lv b">.gitignore</code>文件，包含:</li></ol><pre class="iy iz ja jb fd lw lv lx bn ly lz bi"><span id="35e2" class="ma kl hi lv b be mb mc l md me">/.gradle<br/>/.idea<br/>/build</span></pre><p id="8361" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">4.<em class="mf">我们将使用GitHub作为app代码库的来源；Railway将访问它，并从那里部署应用程序。创建一个新的GitHub库(可以是私有的或者公共的)，命名为<code class="du ls lt lu lv b">slack-hello-bot</code>或者类似的名字。</em></p><p id="c227" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">5.提交并推送至您的新存储库:</p><pre class="iy iz ja jb fd lw lv lx bn ly lz bi"><span id="5d1a" class="ma kl hi lv b be mb mc l md me">git remote add origin GITHUB_REPOSITORY_LINK<br/>git push -u origin main</span></pre><h1 id="77ae" class="kk kl hi bd km kn ko kp kq kr ks kt ku io kv ip kw ir kx is ky iu kz iv la lb bi translated">2.铁路项目</h1><p id="6d80" class="pw-post-body-paragraph jo jp hi jq b jr le ij jt ju lf im jw jx mg jz ka kb mh kd ke kf mi kh ki kj hb bi translated">我们需要建立一个铁路项目，为我们之前创建的Kotlin应用程序提供服务。</p><ol class=""><li id="6065" class="lc ld hi jq b jr js ju jv jx mj kb mk kf ml kj lj lk ll lm bi translated"><a class="ae jn" href="https://railway.app/" rel="noopener ugc nofollow" target="_blank">转到Railway</a>\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\</li><li id="c676" class="lc ld hi jq b jr ln ju lo jx lp kb lq kf lr kj lj lk ll lm bi translated">在Kotlin app的根文件夹下，创建<a class="ae jn" href="https://nixpacks.com/docs/configuration/procfile" rel="noopener ugc nofollow" target="_blank">一个名为</a> <code class="du ls lt lu lv b"><a class="ae jn" href="https://nixpacks.com/docs/configuration/procfile" rel="noopener ugc nofollow" target="_blank">Procfile</a></code>的文件，内容如下:<br/> <code class="du ls lt lu lv b">web: java -jar build/libs/<strong class="jq hj">PROJ_ID</strong>-1.0-SNAPSHOT-all.jar</code> <br/>(要获取<code class="du ls lt lu lv b"><strong class="jq hj">PROJ_ID</strong></code>，勾选<code class="du ls lt lu lv b">settings.gradle.kts</code>)。<br/> <em class="mf">这代表Railway运行启动web app的命令。</em></li><li id="429f" class="lc ld hi jq b jr ln ju lo jx lp kb lq kf lr kj lj lk ll lm bi translated"><em class="mf">铁路需要一个</em> <code class="du ls lt lu lv b"><em class="mf">stage</em></code> <em class="mf">目标。<br/> </em>在<code class="du ls lt lu lv b">build.gradle.kts</code>的末尾，添加:</li></ol><pre class="iy iz ja jb fd lw lv lx bn ly lz bi"><span id="1571" class="ma kl hi lv b be mb mc l md me">task("stage") {<br/>    dependsOn("shadowJar")<br/>}</span></pre><h1 id="bb89" class="kk kl hi bd km kn ko kp kq kr ks kt ku io kv ip kw ir kx is ky iu kz iv la lb bi translated">3.松弛螺栓应用程序</h1><ol class=""><li id="e9fa" class="lc ld hi jq b jr le ju lf jx lg kb lh kf li kj lj lk ll lm bi translated">将以下依赖项添加到<code class="du ls lt lu lv b">build.gradle.kts</code>:</li></ol><pre class="iy iz ja jb fd lw lv lx bn ly lz bi"><span id="de9c" class="ma kl hi lv b be mb mc l md me">dependencies {<br/>  implementation("org.slf4j:slf4j-simple:1.+") <br/>  implementation("com.slack.api:bolt:1.+")<br/>  implementation("com.slack.api:bolt-servlet:1.+")<br/>  implementation("com.slack.api:bolt-jetty:1.+")<br/>}</span></pre><p id="1ba7" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">2.添加渐变阴影<code class="du ls lt lu lv b">build.gradle.kts</code>。<em class="mf">这将允许创建一个单独的fat jar，稍后可以在Railway中运行。</em></p><pre class="iy iz ja jb fd lw lv lx bn ly lz bi"><span id="9d37" class="ma kl hi lv b be mb mc l md me">plugins {<br/>   id("com.github.johnrengelman.shadow") version "7.+"<br/>   application<br/>}<br/>// at the bottom:<br/>application {<br/>    mainClass.set("SlackMainKt")<br/>}</span></pre><p id="ee02" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">📝<em class="mf">您可能需要单击IDE中文件右上角的按钮来刷新Gradle。</em></p><p id="29a4" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">3.在<code class="du ls lt lu lv b">src/main/kotlin/SlackMain.kt</code>，放:</p><pre class="iy iz ja jb fd lw lv lx bn ly lz bi"><span id="4bc4" class="ma kl hi lv b be mb mc l md me">fun main() {<br/>   val app = App()<br/>   app.command("/hello") { _, _ -&gt;<br/>      Response.ok("world")<br/>   }<br/>   SlackAppServer(app, getenv("PORT")?.toInt() ?: 8080)<br/>       .start()<br/>}</span></pre><p id="4368" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">📝<code class="du ls lt lu lv b"><em class="mf">PORT</em></code> <em class="mf">是铁路提供的环境变量。它代表铁路暴露的港口。</em> <a class="ae jn" href="https://docs.railway.app/deploy/exposing-your-app" rel="noopener ugc nofollow" target="_blank"> <em class="mf">因此，我们需要从那个端口为我们的应用程序提供服务。</em>T25】</a></p><p id="caa7" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">4.提交并<strong class="jq hj">推送</strong>所有本地Git更改。<em class="mf">推送将自动触发铁路部署。您可以在</em> <a class="ae jn" href="https://railway.app/dashboard" rel="noopener ugc nofollow" target="_blank"> <em class="mf">铁路仪表盘</em> </a> <em class="mf">查看部署状态和日志。</em></p><h1 id="3abf" class="kk kl hi bd km kn ko kp kq kr ks kt ku io kv ip kw ir kx is ky iu kz iv la lb bi translated">4.松弛应用程序配置</h1><p id="81fd" class="pw-post-body-paragraph jo jp hi jq b jr le ij jt ju lf im jw jx mg jz ka kb mh kd ke kf mi kh ki kj hb bi translated"><em class="mf">基于官方文档:</em> <a class="ae jn" href="https://api.slack.com/start/building/bolt-java" rel="noopener ugc nofollow" target="_blank"> <em class="mf">用Bolt搭建app for Java</em></a><em class="mf"/><a class="ae jn" href="https://slack.dev/java-slack-sdk/guides/getting-started-with-bolt" rel="noopener ugc nofollow" target="_blank"><em class="mf">Bolt入门</em> </a> <em class="mf">。</em></p><ol class=""><li id="ed71" class="lc ld hi jq b jr js ju jv jx mj kb mk kf ml kj lj lk ll lm bi translated">进入<a class="ae jn" href="https://api.slack.com/apps" rel="noopener ugc nofollow" target="_blank"> <strong class="jq hj">时差应用</strong> </a>点击“创建新应用”。</li><li id="1666" class="lc ld hi jq b jr ln ju lo jx lp kb lq kf lr kj lj lk ll lm bi translated">选择“从头开始”,单击“下一步”,命名应用程序，将其分配到工作区。</li><li id="a86d" class="lc ld hi jq b jr ln ju lo jx lp kb lq kf lr kj lj lk ll lm bi translated">在左侧菜单中，转到“OAuth &amp; Permissions”，滚动到“Scopes”，添加<code class="du ls lt lu lv b">chat:write</code>。</li><li id="4091" class="lc ld hi jq b jr ln ju lo jx lp kb lq kf lr kj lj lk ll lm bi translated">在菜单上，单击“斜杠命令”υ“创建新命令”。</li><li id="dfd0" class="lc ld hi jq b jr ln ju lo jx lp kb lq kf lr kj lj lk ll lm bi translated">详细填写:<br/> <strong class="jq hj">命令</strong> : <code class="du ls lt lu lv b">hello<br/></code> <strong class="jq hj">请求网址</strong> : <code class="du ls lt lu lv b">BASE_APP_URL/slack/events<br/></code>获取<code class="du ls lt lu lv b">BASE_APP_URL</code>，<a class="ae jn" href="https://railway.app/dashboard" rel="noopener ugc nofollow" target="_blank">前往铁路仪表盘</a>↓挑选app▏web▏设置▏域。<br/> <strong class="jq hj">简短描述</strong> : <code class="du ls lt lu lv b">hello world<br/></code>保存修改。</li><li id="148e" class="lc ld hi jq b jr ln ju lo jx lp kb lq kf lr kj lj lk ll lm bi translated"><em class="mf">我们需要将Slack UI中的Slack环境变量复制到Railway: </em> <br/>进入“基本信息”υ“App凭据”υ“签约秘笈”υ点击“显示”υ复制即可。<a class="ae jn" href="https://railway.app/dashboard" rel="noopener ugc nofollow" target="_blank">进入铁路仪表板</a>│选择已创建的应用程序▏“web”Ⓡ“Variables”Ⓡ“New Variable”名为<code class="du ls lt lu lv b">SLACK_SIGNING_SECRET</code>，带有之前复制的值。</li><li id="760a" class="lc ld hi jq b jr ln ju lo jx lp kb lq kf lr kj lj lk ll lm bi translated">返回Slack UI，转到“OAuth &amp; Permissions”，单击“Install to Workspace”按钮，复制“Bot User OAuth Token”处的值。回到铁路创建另一个名为<code class="du ls lt lu lv b">SLACK_BOT_TOKEN</code>的环境变量，粘贴复制的值。</li><li id="c666" class="lc ld hi jq b jr ln ju lo jx lp kb lq kf lr kj lj lk ll lm bi translated"><em class="mf">该测试app了！</em>进入松弛状态在任意频道中键入<code class="du ls lt lu lv b">/hello</code>,按回车键。<em class="mf">你应该得到</em> <code class="du ls lt lu lv b"><em class="mf">world</em></code> <em class="mf">作为回复</em>。</li></ol><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mm"><img src="../Images/90728d81fa605c0657afd7569d9c9951.png" data-original-src="https://miro.medium.com/v2/resize:fit:388/format:webp/1*_u3TKlYAKfb36tICY-x95g.png"/></div></figure></div><div class="ab cl mn mo gp mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="hb hc hd he hf"><div class="iy iz ja jb fd mu"><a href="https://github.com/lsoares/slack-bot-kotlin-sample" rel="noopener  ugc nofollow" target="_blank"><div class="mv ab dw"><div class="mw ab mx cl cj my"><h2 class="bd hj fi z dy mz ea eb na ed ef hh bi translated">GitHub-iso ares/slack-bot-kot Lin-sample</h2><div class="nb l"><h3 class="bd b fi z dy mz ea eb na ed ef dx translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="nc l"><p class="bd b fp z dy mz ea eb na ed ef dx translated">github.com</p></div></div><div class="nd l"><div class="ne l nf ng nh nd ni jh mu"/></div></div></a></div></div></div>    
</body>
</html>