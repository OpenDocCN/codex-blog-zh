<html>
<head>
<title>TryHackMe: LazyAdmin</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">TryHackMe: LazyAdmin</h1>
<blockquote>原文：<a href="https://medium.com/codex/tryhackme-lazyadmin-5ac45fcb3cd4?source=collection_archive---------4-----------------------#2022-12-18">https://medium.com/codex/tryhackme-lazyadmin-5ac45fcb3cd4?source=collection_archive---------4-----------------------#2022-12-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/4543a1330eb397ae144f9be88e304e95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1274/format:webp/1*7Q6AxOn9LWsVdY7mDf1Jaw.jpeg"/></div></figure><p id="a3a0" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">LazyAdmin是TryHackMe平台的一个easy machine，在它里面，我们会利用一个任意上传文件和泄露凭证的漏洞来获取系统中的一个外壳。稍后，我们将利用执行脚本的可能性，该脚本可由我们的用户作为系统的任何用户来修改，以提升权限。</p></div><div class="ab cl jk jl gp jm" role="separator"><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp"/></div><div class="hb hc hd he hf"><p id="5fbc" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">像往常一样，在TryHackMe中，我们必须连接到VPN或使用攻击箱。我会选择VPN。我们按下启动机器按钮，一分钟后，他们给我们显示IP地址。现在，我们继续使用Nmap进行初始识别:</p><pre class="jr js jt ju fd jv jw jx bn jy jz bi"><span id="ae8d" class="ka kb hi jw b be kc kd l ke kf">nmap -p- -sV -Pn $IP</span></pre><p id="4978" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">带连字符的-p参数表示扫描所有端口,-sV参数表示对使用的版本进行指纹识别，而-Pn参数表示扫描机器，即使它不响应ping。</p><figure class="jr js jt ju fd ij er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es kg"><img src="../Images/951dbcb07e417d072d0140ddd1639f72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q0cgrjR7C2nptN_-5hCfTA.png"/></div></div></figure><p id="bd65" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们可以看到机器上几乎没有打开的服务，只有SSH和一个web服务器。让我们深入研究一下web服务器。</p><p id="a3aa" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">网络服务器枚举</strong></p><p id="b22c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">模糊化目录后，我们发现了几个有趣的条目:</p><figure class="jr js jt ju fd ij er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es kl"><img src="../Images/fa6d45f449885ac54387574f62a42141.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K6AJVNgTa-imtp_us61X8A.png"/></div></div></figure><p id="e60e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们发现了一个基本CMS SweetRice的安装。</p><figure class="jr js jt ju fd ij er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es km"><img src="../Images/1923329e8e53237b1b6ede10fd3846aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_TEcXBJuj8rQJiKjo8e23A.png"/></div></div></figure><p id="de0c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">快速的Google搜索显示了一些CVE和1.5.1以前版本的漏洞</p><figure class="jr js jt ju fd ij er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es kn"><img src="../Images/54179ffe8c110b7b673f4de6b6da04bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tReDatMeIVUKbedYvHpEMA.png"/></div></div></figure><p id="5fc9" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在内容文件夹中，我们发现了几个有趣的端点，其中之一是as目录中的登录面板和inc目录中的目录列表。</p><figure class="jr js jt ju fd ij er es paragraph-image"><div class="er es ko"><img src="../Images/06b8663bc1239e830fcd63a352f5f9a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:978/format:webp/1*plp1_h9FgtZ_ZdtFtIDSXA.png"/></div></figure><p id="8a59" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在inc目录内，我们找到了latest.txt文件中使用的CMS版本(恰好是1.5.1，存在已验证的任意文件上传漏洞)。我们还找到了一个文件夹，里面有mysql备份。让我们来看看这个凭据备份。</p><figure class="jr js jt ju fd ij er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es kp"><img src="../Images/4cca316e9f6d0528259fe9f4ffa745a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SmBuCZhOBhdxKdoVGgRI3w.png"/></div></div></figure><p id="678a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">事实上，我们找到了具有管理员权限的管理员用户的凭证，只是我们必须破解密钥的散列才能进行访问。</p><figure class="jr js jt ju fd ij er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es kq"><img src="../Images/a0e469b7914c76b45fb9ae5a0e051ed9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ydmLWfvoAxAEKojQ8Un0VA.png"/></div></div></figure><p id="5bcc" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">一旦我们破解了散列，我们就可以用刚刚获得的凭证访问CMS。</p><figure class="jr js jt ju fd ij er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es kr"><img src="../Images/8bf354fc8be63f7f9f1071a08c134a94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YxdlDjvPLXnCQhlCbxsqsg.png"/></div></div></figure><p id="fe08" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">是时候看看我们是否能重现漏洞的任意文件上传了。阅读exploitdb的漏洞，我们看到易受攻击的形式位于/as/？type =媒体中心</p><figure class="jr js jt ju fd ij er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es ks"><img src="../Images/5d863459e1c3ae6025295326ab967ad6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i9XdbOWQ5ZBD9L8hja3xyw.png"/></div></div></figure><p id="fb1d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">测试，我们看到有一些过滤的形式，如果我们上传。php文件，它们不被存储。我们可以通过使用. php5之类的其他扩展来绕过过滤。一旦我们知道如何绕过它，我们就可以上传一个反向shell，并在系统上获得一个shell。</p><figure class="jr js jt ju fd ij er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es kt"><img src="../Images/a72f4b2301dfb57f0a96ae09d55c70d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mUFaGNAjOMlEuvmoiUKZOg.png"/></div></div></figure><p id="5b95" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">权限升级</strong></p><p id="d083" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">通过基本枚举，我们可以在itguy主文件夹中找到一些有趣的文件</p><figure class="jr js jt ju fd ij er es paragraph-image"><div class="er es ku"><img src="../Images/502c28dd2972860768d879ba686d81c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1018/format:webp/1*5nFfL4e9TUT0NDjZbZ2tSA.png"/></div></figure><p id="8a94" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">MySQL凭证虽然有效，但似乎将我们引入了一个死胡同。另一方面，我们可以看到之前看到的备份脚本可以被我们作为root执行。</p><figure class="jr js jt ju fd ij er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es kv"><img src="../Images/319b1a97d042963dce6c77f0fff2e371.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pBPmPqVeG6LFQHzUYkNVGg.png"/></div></div></figure><p id="5815" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">让我们仔细看看这个脚本是做什么的。</p><figure class="jr js jt ju fd ij er es paragraph-image"><div class="er es kw"><img src="../Images/22af2af79ed766584aab271d9781abea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1370/format:webp/1*zr7zruHKNj4ZT946NqDSAA.png"/></div></figure><p id="d727" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">似乎/etc/copy.sh脚本已经被修改为启动反向shell。让我们看看是否可以修改它来获得我们的shell作为root。</p><figure class="jr js jt ju fd ij er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es kx"><img src="../Images/668c34abb83c3ff8a68daa79452f6e89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qFo8CH8HNs41fV4fw61__w.png"/></div></div></figure><p id="b0f7" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">最后，我们将shell作为root:</p><figure class="jr js jt ju fd ij er es paragraph-image"><div class="er es ky"><img src="../Images/aa609af015ff16b8e462201d68ce3ff1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1268/format:webp/1*e8u5AegGxuAqo9KCUuz2RQ.png"/></div><figcaption class="kz la et er es lb lc bd b be z dx translated"><strong class="bd ld"> PWNed！</strong></figcaption></figure></div><div class="ab cl jk jl gp jm" role="separator"><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp"/></div><div class="hb hc hd he hf"><p id="744f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我希望你喜欢我的文章，并发现我的内容有用。下一篇文章再见。</p></div></div>    
</body>
</html>