# ä½¿ç”¨ YOLOv5 é€šè¿‡ 3 ä¸ªç®€å•çš„æ­¥éª¤å¯¹è‡ªå®šä¹‰æ•°æ®é›†è¿›è¡Œå¯¹è±¡æ£€æµ‹

> åŸæ–‡ï¼š<https://medium.com/codex/object-detection-on-custom-dataset-in-3-simple-steps-using-yolov5-e9d4940df16e?source=collection_archive---------2----------------------->

## æœ¬æ–‡ä»‹ç»äº†ä¸€ä¸ªå…·æœ‰é«˜æ€§èƒ½æŒ‡æ ‡çš„è‡ªå®šä¹‰æ ‡è®°æ•°æ®çš„å¯¹è±¡æ£€æµ‹æ¡†æ¶ã€‚

![](img/4c12fb0dce3011bb43524706904758c2.png)

æœ¬æ–‡å°†ä¸æä¾›å…³äºå¯¹è±¡æ£€æµ‹å’Œæ‰€æœ‰ç›¸å…³æœ¯è¯­çš„ç»†èŠ‚ã€‚æˆ‘å¸Œæœ›ä½ çŸ¥é“ç‰©ä½“æ£€æµ‹çš„ç†è®ºä»¥åŠå®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†è·³åˆ°å®ç°éƒ¨åˆ†ï¼Œè¿™æ˜¯æœ¬æ–‡çš„ä¸»è¦ç›®æ ‡ã€‚æ–‡ç« åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ã€‚

1.  **æ•°æ®é›†åˆ›å»º:**æˆ‘å°†è®¨è®ºæˆ‘ä»¬è¾“å…¥æ•°æ®çš„æ ¼å¼ã€‚
2.  **åŸ¹è®­:**åŸ¹è®­æ­¥éª¤ã€æ‰€éœ€çš„ä¾èµ–é¡¹å’Œä»£ç ã€‚
3.  **æµ‹è¯•:**åœ¨ç»™å®šçš„ä¸€ç»„å›¾åƒä¸Šæµ‹è¯•è®­ç»ƒå¥½çš„æ¨¡å‹ã€‚

# A.æ•°æ®é›†åˆ›å»º

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå¸¦æ ‡ç­¾çš„æ•°æ®é›†æ¥åˆ›å»ºå¯¹è±¡æ£€æµ‹æ¨¡å‹ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ RoboFlow [1]æˆ– LabelImg [2]ç­‰åœ¨çº¿å·¥å…·æ‰‹åŠ¨æ³¨é‡Šæ•°æ®é›†ã€‚æœ‰å¿…è¦ä»¥ YOLO æ ¼å¼ä¿å­˜å¯¹åº”äºæ¯ä¸ªå›¾åƒçš„æ ‡ç­¾ã€‚åœ¨ YOLOï¼Œæˆ‘ä»¬æœ‰å››ä¸ªå€¼æ¥ç¡®å®šè¾¹ç•Œæ¡†***ã€x _ centerï¼Œy_centerï¼Œwidthï¼Œheightã€‘ï¼Œ*** å…¶ä¸­***'****x _ center '*å’Œ *'y_center'* æ˜¯è¾¹ç•Œæ¡†ä¸­å¿ƒçš„å½’ä¸€åŒ–(åœ¨ 0 å’Œ 1 ä¹‹é—´)åæ ‡ã€‚è¾¹ç•Œæ¡†çš„'*é«˜åº¦'*å’Œ'*å®½åº¦'*ä¹Ÿåœ¨ 0 å’Œ 1 ä¹‹é—´æ ‡å‡†åŒ–ã€‚

ç›®å½•ç»“æ„å¦‚ä¸‹æ‰€ç¤ºã€‚å›¾åƒåç§°åº”è¯¥ä¸æ ‡ç­¾åç§°ç›¸åŒã€‚æ¢å¥è¯è¯´ï¼Œå¦‚æœæˆ‘ä»¬åœ¨*'****train/imagesâ€™***æ–‡ä»¶å¤¹ä¸­æœ‰ä¸€ä¸ªå›¾åƒ***' 0001 . jpgâ€™***ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨***' train/labelsâ€™***æ–‡ä»¶å¤¹ä¸­ä¹Ÿå¿…é¡»æœ‰***' 0001 . txtâ€™***æ–‡ä»¶ã€‚

```
# *dataset folder structure*dataset
  |--- train
  |      |--- images
  |      |--- labels
  |
  |--- valid
  |      |--- images
  |      |--- labels
```

# **B .åŸ¹è®­**

## 1.åˆ›å»ºä¸€ä¸ª. yaml æ–‡ä»¶

é¦–å…ˆï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ª ***data.yaml*** æ–‡ä»¶ï¼ŒåŒ…å«æ•°æ®é›†çš„è·¯å¾„å’Œè¦æ£€æµ‹çš„ç±»çš„è¯¦ç»†ä¿¡æ¯ã€‚è¯¥æ–‡ä»¶å°†å¦‚ä¸‹æ‰€ç¤ºã€‚

```
train: dataset/train/images
val: dataset/valid/imagesnc: 1
names: ['flag']
```

å…¶ä¸­ï¼Œåœ¨ç¬¬ä¸€è¡Œï¼Œæˆ‘ä»¬å°†æŒ‡å®šè®­ç»ƒå›¾åƒçš„è·¯å¾„ã€‚åœ¨ç¬¬äºŒè¡Œï¼Œæˆ‘ä»¬å°†æåˆ°éªŒè¯å›¾åƒçš„è·¯å¾„ã€‚ä¹‹åï¼Œæˆ‘ä»¬å°†åœ¨ä¸€ä¸ªåˆ—è¡¨ä¸­æ·»åŠ ç±»çš„æ•°é‡ï¼Œåè·Ÿç±»æ ‡ç­¾ã€‚

## 2.æŒ‡å®šæ¨¡å‹æ¶æ„

æˆ‘ä»¬ç°åœ¨å°†å®šä¹‰ YOLOv5 æ¨¡å‹æ¶æ„å’Œå‚æ•°ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ª **custom_yolo.yaml** æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«ä»¥ä¸‹å…ƒç´ ã€‚

```
# parameters
nc: 1  # number of classes
depth_multiple: 0.33  # model depth multiple
width_multiple: 0.50  # layer channel multiple# anchors
anchors:
  - [10,13, 16,30, 33,23]  # P3/8
  - [30,61, 62,45, 59,119]  # P4/16
  - [116,90, 156,198, 373,326]  # P5/32# YOLOv5 backbone
backbone:
  # [from, number, module, args]
  [[-1, 1, Focus, [64, 3]],  # 0-P1/2
   [-1, 1, Conv, [128, 3, 2]],  # 1-P2/4
   [-1, 3, BottleneckCSP, [128]],
   [-1, 1, Conv, [256, 3, 2]],  # 3-P3/8
   [-1, 9, BottleneckCSP, [256]],
   [-1, 1, Conv, [512, 3, 2]],  # 5-P4/16
   [-1, 9, BottleneckCSP, [512]],
   [-1, 1, Conv, [1024, 3, 2]],  # 7-P5/32
   [-1, 1, SPP, [1024, [5, 9, 13]]],
   [-1, 3, BottleneckCSP, [1024, False]],  # 9
  ]# YOLOv5 head
head:
  [[-1, 1, Conv, [512, 1, 1]],
   [-1, 1, nn.Upsample, [None, 2, 'nearest']],
   [[-1, 6], 1, Concat, [1]],  # cat backbone P4
   [-1, 3, BottleneckCSP, [512, False]],  # 13[-1, 1, Conv, [256, 1, 1]],
   [-1, 1, nn.Upsample, [None, 2, 'nearest']],
   [[-1, 4], 1, Concat, [1]],  # cat backbone P3
   [-1, 3, BottleneckCSP, [256, False]],  # 17 (P3/8-small)[-1, 1, Conv, [256, 3, 2]],
   [[-1, 14], 1, Concat, [1]],  # cat head P4
   [-1, 3, BottleneckCSP, [512, False]],  # 20 (P4/16-medium)[-1, 1, Conv, [512, 3, 2]],
   [[-1, 10], 1, Concat, [1]],  # cat head P5
   [-1, 3, BottleneckCSP, [1024, False]],  # 23 (P5/32-large)[[17, 20, 23], 1, Detect, [nc, anchors]],  # Detect(P3, P4, P5)
  ]
```

## 3.ä» GitHub ä¸‹è½½ä»£ç ã€‚

æˆ‘ä»¬å°†ä» GitHub å…‹éš† YOLOv5 repoï¼Œç„¶ååœ¨è™šæ‹Ÿç¯å¢ƒä¸­å®‰è£…ä¾èµ–é¡¹[3]ã€‚æ­¥éª¤å¦‚ä¸‹ã€‚

```
git clone [https://github.com/ultralytics/yolov5](https://github.com/ultralytics/yolov5)
cd yolov5
pip install requirements.txt
```

## 4.å¼€å§‹è®­ç»ƒ

å®Œæˆä»£ç å’Œæ‰€éœ€åº“çš„è®¾ç½®åï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿è¡ŒåŸ¹è®­éƒ¨åˆ†äº†ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦è½¬åˆ° train.py æ‰€åœ¨çš„è·¯å¾„ï¼Œç„¶åè¿è¡Œä»¥ä¸‹å‘½ä»¤ã€‚

```
**python** **train.py** **--img** 416 **--batch** 32 **--epochs** 10 **--data** <path to data.yaml file> **--cfg** <path to custom_yolo.yaml file> **--name** <give name to your run>
```

è®­ç»ƒå®Œæˆåï¼Œä½“é‡å°†å­˜å‚¨åœ¨***â€˜yolov 5/runs/train/<æ‚¨çš„è·‘æ­¥åç§°>/weights/best . pyâ€™***ä¸­

# C.æµ‹è¯•

ä½¿ç”¨ä¿å­˜çš„æƒé‡ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹æµ‹è¯•æ•°æ®é›†è¿›è¡Œæ¨æ–­ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ç»ˆç«¯ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤ã€‚

```
**python** **detect.py** **--weights** <best model weights> **--data** <path to data.yaml file> **--image** 416 **--conf** 0.5 **--source** <test images path>
```

æµ‹è¯•è¿‡ç¨‹å®Œæˆåï¼Œè¾“å‡ºå°†å­˜å‚¨åœ¨***ã€yolov 5/runs/detect/exp/ã€‘***ä¸­

# ç»“è®º

æœ¬æ–‡å±•ç¤ºäº†ä¸€ç§ä½¿ç”¨ YOLOv5 æ–¹æ³•è®­ç»ƒè‡ªå®šä¹‰å¯¹è±¡æ£€æµ‹æ¨¡å‹çš„å¿«é€Ÿè€Œç®€å•çš„æ–¹æ³•ã€‚

# å‚è€ƒ

[](https://roboflow.com/#annotate) [## 1.Roboflow:è®©ä½ çš„è½¯ä»¶èƒ½å¤Ÿçœ‹åˆ°å›¾åƒå’Œè§†é¢‘ä¸­çš„ç‰©ä½“

### æ ‡ç­¾ä½¿ç”¨ä»»ä½•æ“ä½œç³»ç»Ÿï¼Œæ— éœ€ä¸‹è½½ä»»ä½•è½¯ä»¶ã€‚ä½¿ç”¨æœ€æµè¡Œçš„æ³¨é‡Šæ ¼å¼ï¼ŒåŒ…æ‹¬â€¦

roboflow.com](https://roboflow.com/#annotate) [](https://github.com/tzutalin/labelImg) [## 2.github-Tzu talin/labelimg:ğŸ–ï¸labelimg æ˜¯ä¸€ä¸ªå›¾å½¢åŒ–çš„å›¾åƒæ³¨é‡Šå·¥å…·å’Œæ ‡ç­¾å¯¹è±¡â€¦

### LabelImg æ˜¯ä¸€ä¸ªå›¾å½¢åŒ–çš„å›¾åƒæ³¨é‡Šå·¥å…·ã€‚å®ƒæ˜¯ç”¨ Python å†™çš„ï¼Œä½¿ç”¨ Qt ä½œä¸ºå®ƒçš„å›¾å½¢ç•Œé¢â€¦

github.com](https://github.com/tzutalin/labelImg) [](https://github.com/ultralytics/yolov5) [## 3.GitHub-ultralytics/yolov 5:yolov 5ğŸš€åœ¨ PyTorch > ONNX > CoreML > TFLite ä¸­

### YOLOv5ğŸš€æ˜¯åœ¨ COCO æ•°æ®é›†ä¸Šé¢„å…ˆè®­ç»ƒçš„ä¸€ç³»åˆ—å¯¹è±¡æ£€æµ‹ä½“ç³»ç»“æ„å’Œæ¨¡å‹ï¼Œè¡¨ç¤ºâ€¦

github.com](https://github.com/ultralytics/yolov5)