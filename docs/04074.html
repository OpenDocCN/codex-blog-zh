<html>
<head>
<title>Data masking with sqlcmdcli</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用sqlcmdcli进行数据屏蔽</h1>
<blockquote>原文：<a href="https://medium.com/codex/data-masking-with-sqlcmdcli-975924f2935d?source=collection_archive---------5-----------------------#2021-10-23">https://medium.com/codex/data-masking-with-sqlcmdcli-975924f2935d?source=collection_archive---------5-----------------------#2021-10-23</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="e33f" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">sqlcmdcli实用工具是一个命令行实用工具，用于在SQL Server上以特定的交互式方式执行命令，以模拟特定的工作负载、匿名敏感数据等！</h2></div><p id="6bd6" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">开发复杂应用程序(如ERP、物流管理解决方案、CRM或其他需要OLTP数据库的软件)的人，迟早需要在真实数据上验证应用程序的特性。可能有必要使用生产数据库的备份，通过开发环境提供的调试工具来验证应用程序。有些bug是您无法在测试环境中重现的！可能需要生产数据库的副本来进行故障排除或验证查询是如何在具有数百万条记录的表上的真实数据上执行的。</p><p id="cb9b" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您是否曾经问过您最重要的客户之一:“我可以备份生产数据库来执行测试吗？”</p><p id="2cf1" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">他/她回答了什么？考虑到关于个人数据保护的新<a class="ae jt" href="https://www.eugdpr.org/" rel="noopener ugc nofollow" target="_blank">欧洲法规679/2016 </a>(被称为GDPR)，他/她会如何回答？在最好的情况下，答案将是:“你可以根据法律进行备份，但数据必须是匿名的！”。</p><p id="11e6" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">它包括在生产数据库的备份中屏蔽数据，并要求客户在获得最终授权进行处理之前进行适当的检查。SQL Server的最新版本提供了有趣的<a class="ae jt" href="https://docs.microsoft.com/it-it/sql/relational-databases/security/dynamic-data-masking?WT.mc_id=DP-MVP-4029181" rel="noopener ugc nofollow" target="_blank">数据屏蔽服务</a>，但是它们必须被启用，并且不是在SQL Server的所有版本中都可用。</p><p id="c2b9" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我有这个需求，我不能使用SQL Server的数据屏蔽服务，所以我在<strong class="iz hj"> sqlcmdcli </strong>中实现了一个特定的命令，这个命令行实用程序可以在<a class="ae jt" href="https://github.com/segovoni/sqlcmdcli" rel="noopener ugc nofollow" target="_blank">这个GitHub存储库</a>中找到。</p><p id="6540" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae jt" href="https://github.com/segovoni/sqlcmdcli/wiki#anonymizedb-anondb" rel="noopener ugc nofollow" target="_blank"> anonymizedb </a>命令匿名化数据库中作为参数传递的长度超过两个字符的所有文本列(char、nchar、varchar、nvarchar、text、ntext );它执行以下步骤:</p><ul class=""><li id="976d" class="ju jv hi iz b ja jb jd je jg jw jk jx jo jy js jz ka kb kc bi translated">数据库模式分析</li><li id="264b" class="ju jv hi iz b ja kd jd ke jg kf jk kg jo kh js jz ka kb kc bi translated">禁用文本列上的活动外键</li><li id="6f25" class="ju jv hi iz b ja kd jd ke jg kf jk kg jo kh js jz ka kb kc bi translated">禁用文本列上的活动检查约束</li><li id="4143" class="ju jv hi iz b ja kd jd ke jg kf jk kg jo kh js jz ka kb kc bi translated">禁用活动触发器</li><li id="cb07" class="ju jv hi iz b ja kd jd ke jg kf jk kg jo kh js jz ka kb kc bi translated">执行数据屏蔽算法</li><li id="a68e" class="ju jv hi iz b ja kd jd ke jg kf jk kg jo kh js jz ka kb kc bi translated">启用外键(以前被禁用)</li><li id="8235" class="ju jv hi iz b ja kd jd ke jg kf jk kg jo kh js jz ka kb kc bi translated">启用检查约束(以前已禁用)</li><li id="34d0" class="ju jv hi iz b ja kd jd ke jg kf jk kg jo kh js jz ka kb kc bi translated">启用触发器(之前已禁用)</li></ul><p id="0893" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">最后，您将得到一个数据库，其中的文本列已被匿名化。</p><p id="95fb" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">数据屏蔽算法的第一个实现非常简单；对于少于或等于2000个字符的文本列，每个字符移动一个范围内的随机数量的字符。对于大于2000个字符的文本列，执行相反的功能。未来发布的<a class="ae jt" href="https://github.com/segovoni/sqlcmdcli" rel="noopener ugc nofollow" target="_blank"> sqlcmdcli </a>将实现更复杂的算法。</p><p id="d128" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">以下是对AdventureWorks2017数据库调用anonymizedb命令的示例:</p><pre class="ki kj kk kl fd km kn ko kp aw kq bi"><span id="233b" class="kr ks hi kn b fi kt ku l kv kw">sqlcmdcli.exe anonymizedb -servername:YourTestServer -databasename:AdventureWorks2017 -username:YourSQLLogin -password:YourPassword -verbose</span></pre><p id="42dc" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">该执行将产生类似于下图所示的输出。</p><figure class="ki kj kk kl fd ky er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es kx"><img src="../Images/01ce814da233c5852814fbe3522f03ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kJRQywPZl0p6e4GHSaqoUA.jpeg"/></div></div></figure><p id="7957" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">sqlcmdcli是用Delphi编写的，它是一个开源项目，欢迎任何人贡献自己的力量，sqlcmdcli.exe可以在资源库的<a class="ae jt" href="https://github.com/segovoni/sqlcmdcli/releases" rel="noopener ugc nofollow" target="_blank">版本</a>部分获得。</p><p id="e1c6" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这个项目的官方维基可以在<a class="ae jt" href="https://github.com/segovoni/sqlcmdcli/wiki" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="58fc" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">尽情享受吧！</p></div></div>    
</body>
</html>