<html>
<head>
<title>Data Integrity in Database Design</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">数据库设计中的数据完整性</h1>
<blockquote>原文：<a href="https://medium.com/codex/data-integrity-in-database-design-2f581807ac18?source=collection_archive---------12-----------------------#2022-06-26">https://medium.com/codex/data-integrity-in-database-design-2f581807ac18?source=collection_archive---------12-----------------------#2022-06-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="6ebc" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">基础知识，使用SQLite</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/0bab5fa2d5c5750a75295e7932093c8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JOoga42iuLkWxj_tKIzYYg.jpeg"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">詹姆斯·哈里逊在<a class="ae jn" href="https://unsplash.com/s/photos/programming?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="f67d" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">动手操作SQL项目很有趣，但学习数据库设计背后的理论和概念也很有趣。今天，我将简单地谈谈数据完整性，以及我在学习SQL的初学者之旅中所学到的东西。</p><p id="0537" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">今天的帖子将基于下面的YouTube视频，我强烈建议你先去看看:</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="kk kl l"/></div></figure><p id="20e7" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我是凯莱布·库里的超级粉丝，因为他用直观、日常用语和超级简单易懂的方式打破了所有这些概念。他只是让学习数据库设计变得有趣，这篇文章将主要是我自己基于他的这一课的笔记(加上我自己的一些进一步研究)。对于未来关于基本数据库设计概念的帖子，我可能会以他的视频为基础来写。</p><p id="d36f" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">不管怎样，我们继续吧。</p><p id="bd48" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">数据完整性基本上意味着确保数据库设计中的数据是“正确的”，并且表之间的关系是完整的。通常分为三种类型:</p><ol class=""><li id="548e" class="km kn hi jq b jr js ju jv jx ko kb kp kf kq kj kr ks kt ku bi translated"><strong class="jq hj">实体完整性:</strong>每行必须唯一标识。例如，在一个<em class="kv"> users </em>表中，您经常会遇到两个或更多的人有相同的名字(甚至是姓氏)，为了确保每一行都被唯一地标识，您必须包含一些唯一的标识符，使行作为一个整体是唯一的。在SQLite中，一种方法是添加一个ID列，并将其设置为主键</li><li id="cbb2" class="km kn hi jq b jr kw ju kx jx ky kb kz kf la kj kr ks kt ku bi translated"><strong class="jq hj">参照完整性:</strong>对于相互之间有关系的表，您必须确保这种特定的关系被明确定义。回到我们的用户表示例，如果我们有另一个表来存储用户评论，那么每一行(即每条评论)都必须指向用户表中存在的特定用户。在SQLite中，我们可以通过使用外键约束来实现这一点，例如在<em class="kv"> comments </em>表中包含一个<em class="kv"> user_id </em>列，该列指向<em class="kv"> users </em>表中的一个特定的<em class="kv"> user_id </em>。</li><li id="3006" class="km kn hi jq b jr kw ju kx jx ky kb kz kf la kj kr ks kt ku bi translated"><strong class="jq hj">域完整性:</strong>每一列中的值必须被定义并保持一致。我们不想要空值，也不想要，比方说，电话号码列中的字符串值。在SQLite中，我们可以使用CHECK和NOT NULL来实现这一点。</li></ol><p id="9f07" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">让我们用一个简单的例子来演示以上内容，让我们实际制作<em class="kv">用户</em>和<em class="kv">用户评论</em>表。<em class="kv">用户</em>表将包含用户id、用户名和电话号码信息，而<em class="kv">用户评论</em>将包含评论id、评论本身以及与该评论相关联的用户(作为指向<em class="kv">用户</em>表的外键):</p><pre class="iy iz ja jb fd lb lc ld le aw lf bi"><span id="1320" class="lg lh hi lc b fi li lj l lk ll">CREATE TABLE users (user_id INTEGER PRIMARY KEY AUTOINCREMENT, <br/> user_name TEXT, <br/> phone_number INTEGER);</span><span id="1c71" class="lg lh hi lc b fi lm lj l lk ll">CREATE TABLE userComments (<br/> comment_id INTEGER PRIMARY KEY AUTOINCREMENT,<br/> comment TEXT,<br/> user_id INTEGER,<br/> FOREIGN KEY (user_id) REFERENCES users (user_id)<br/> );</span></pre><p id="fbfc" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在我看来很简单。现在让我们填充这两个表:</p><pre class="iy iz ja jb fd lb lc ld le aw lf bi"><span id="8d42" class="lg lh hi lc b fi li lj l lk ll">INSERT INTO users (user_name, phone_number) VALUES ("Bob", 12345678900);<br/>INSERT INTO userComments (comment, user_id) VALUES ("I like this video!", 1);</span><span id="0334" class="lg lh hi lc b fi lm lj l lk ll">INSERT INTO users (user_name, phone_number) VALUES ("Joe", 12345678912);<br/>INSERT INTO userComments (comment, user_id) VALUES ("Me too!", 2);</span></pre><p id="6ada" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">让我们通过对两个表进行简单的选择来快速检查，并得出以下结果:</p><pre class="iy iz ja jb fd lb lc ld le aw lf bi"><span id="a91d" class="lg lh hi lc b fi li lj l lk ll">-- SELECT * FROM users;<br/>1|Bob|12345678900<br/>2|Joe|12345678912</span><span id="347b" class="lg lh hi lc b fi lm lj l lk ll">-- SELECT * FROM userComments;<br/>1|I like this video!|1<br/>2|Me too!|2</span></pre><p id="2fc2" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在这里，我们看到了上述三种完整性的元素。我们有实体完整性，因为每个用户和评论都由某个user_id和comment_id标识；我们有引用完整性，因为<em class="kv"> userComments </em>表中的每一行都指向<em class="kv"> users </em>表中的一个现有用户；我们有域完整性(目前而言),因为我们在定义文本值和整数值的地方有它们。</p><p id="3b8e" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">酷，让我们试试:</p><pre class="iy iz ja jb fd lb lc ld le aw lf bi"><span id="ce06" class="lg lh hi lc b fi li lj l lk ll">INSERT INTO users (user_name, phone_number) VALUES (123456, "Hi, My name is Peter!");</span><span id="fa61" class="lg lh hi lc b fi lm lj l lk ll">INSERT INTO userComments (comment, user_id) VALUES (246810, 3);</span></pre><p id="e505" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">还有…..成功了。事实上，我们可以在两个表上再次调用SELECT并看到它:</p><pre class="iy iz ja jb fd lb lc ld le aw lf bi"><span id="2ddd" class="lg lh hi lc b fi li lj l lk ll">-- SELECT * FROM users;<br/>1|Bob|12345678900<br/>2|Joe|12345678912<br/>3|123456|Hi, My name is Peter!</span><span id="4c3a" class="lg lh hi lc b fi lm lj l lk ll">-- SELECT * FROM userComments;<br/>1|I like this video!|1<br/>2|Me too!|2<br/>3|246810|3</span></pre><p id="1c10" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><em class="kv">为什么？</em></p><p id="986f" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">如果你想进一步阅读，我会留下下面的链接，但基本上SQLite将这视为一个功能，而不是一个错误，具体称为<em class="kv">动态类型</em>，这基本上意味着你可以将任何数据类型插入任何列，即使你在列中分配了一个。它还具有<em class="kv">型亲和力。</em>例如，如果你声明一个列为INT并插入文本，在插入到你的表中之前，它将首先尝试转换为INT，否则如果它不能这样做，它将存储为文本，或者至少我是这样理解的。</p><p id="5e00" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">那么，我们如何在我们的列中实施我们的数据类型呢？我们可以使用检查约束来做到这一点。基于同一个示例，我想使用以下约束重新创建表:</p><ul class=""><li id="48b4" class="km kn hi jq b jr js ju jv jx ko kb kp kf kq kj ln ks kt ku bi translated">用户名只能是3个字母</li><li id="b081" class="km kn hi jq b jr kw ju kx jx ky kb kz kf la kj ln ks kt ku bi translated">电话号码必须是数字，且不超过11位</li><li id="eb26" class="km kn hi jq b jr kw ju kx jx ky kb kz kf la kj ln ks kt ku bi translated">注释必须≤ 20个字符</li></ul><p id="1670" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">让我们将其转换成SQL:</p><pre class="iy iz ja jb fd lb lc ld le aw lf bi"><span id="1a43" class="lg lh hi lc b fi li lj l lk ll">CREATE TABLE users (user_id INTEGER PRIMARY KEY AUTOINCREMENT, <br/> user_name TEXT CHECK (LENGTH(user_name) &lt;= 3), <br/> phone_number INTEGER CHECK (phone_number BETWEEN 0 AND 99999999999));</span><span id="cccb" class="lg lh hi lc b fi lm lj l lk ll">CREATE TABLE userComments (<br/> comment_id INTEGER PRIMARY KEY AUTOINCREMENT,<br/> comment TEXT CHECK (LENGTH(comment) &lt;= 20),<br/> user_id INTEGER,<br/> FOREIGN KEY (user_id) REFERENCES users (user_id)</span></pre><p id="1a18" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">并插入一些数据(第三个不遵循定义的约束):</p><pre class="iy iz ja jb fd lb lc ld le aw lf bi"><span id="d370" class="lg lh hi lc b fi li lj l lk ll">INSERT INTO users_two (user_name, phone_number) VALUES ("Bob", 12345678900);<br/>INSERT INTO userComments_two (comment, user_id) VALUES ("I like this video!", 1);</span><span id="40a6" class="lg lh hi lc b fi lm lj l lk ll">INSERT INTO users_two (user_name, phone_number) VALUES ("Joe", 12345678912);<br/>INSERT INTO userComments_two (comment, user_id) VALUES ("Me too!", 2);</span><span id="12af" class="lg lh hi lc b fi lm lj l lk ll">INSERT INTO users_two (user_name, phone_number) VALUES (123456, "Hi, My name is Peter!");<br/>INSERT INTO userComments_two (comment, user_id) VALUES ("I like apple pies and nuts and rice", 3);</span></pre><p id="fb02" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这一次，您将得到如下类似的错误:</p><pre class="iy iz ja jb fd lb lc ld le aw lf bi"><span id="191c" class="lg lh hi lc b fi li lj l lk ll">Error: near line 43: CHECK constraint failed: LENGTH(user_name) &lt;= 3<br/>Error: near line 44: CHECK constraint failed: LENGTH(comment) &lt;= 20</span></pre><p id="9399" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">如果您选择两个表，您将得到:</p><pre class="iy iz ja jb fd lb lc ld le aw lf bi"><span id="7ab6" class="lg lh hi lc b fi li lj l lk ll">-- SELECT * FROM users_two;<br/>1|Bob|12345678900<br/>2|Joe|12345678912</span><span id="c289" class="lg lh hi lc b fi lm lj l lk ll">-- SELECT * FROM userComments_two;<br/>1|I like this video!|1<br/>2|Me too!|2</span></pre><p id="b44a" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这意味着两个表的第三行条目都无法插入。</p><p id="aef1" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我的帖子到此结束，希望对你也有帮助！</p><p id="9009" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">使用的参考:</p><div class="lo lp ez fb lq lr"><a href="https://www.tutlane.com/tutorial/sqlite/sqlite-constraints" rel="noopener  ugc nofollow" target="_blank"><div class="ls ab dw"><div class="lt ab lu cl cj lv"><h2 class="bd hj fi z dy lw ea eb lx ed ef hh bi translated">SQLite约束- Tutlane</h2><div class="ly l"><h3 class="bd b fi z dy lw ea eb lx ed ef dx translated">在这里，我们将通过示例学习sqlite约束和不同类型的SQLite约束(主键、外键…</h3></div><div class="lz l"><p class="bd b fp z dy lw ea eb lx ed ef dx translated">www.tutlane.com</p></div></div><div class="ma l"><div class="mb l mc md me ma mf jh lr"/></div></div></a></div><div class="lo lp ez fb lq lr"><a href="https://www.sqlite.org/faq.html#q3" rel="noopener  ugc nofollow" target="_blank"><div class="ls ab dw"><div class="lt ab lu cl cj lv"><h2 class="bd hj fi z dy lw ea eb lx ed ef hh bi translated">SQLite常见问题</h2><div class="ly l"><h3 class="bd b fi z dy lw ea eb lx ed ef dx translated">小。很快。可靠。任选三个。如何创建自动增量字段？SQLite支持哪些数据类型…</h3></div><div class="lz l"><p class="bd b fp z dy lw ea eb lx ed ef dx translated">www.sqlite.org</p></div></div><div class="ma l"><div class="mg l mc md me ma mf jh lr"/></div></div></a></div><div class="lo lp ez fb lq lr"><a href="https://www.sqlite.org/datatype3.html#affinity" rel="noopener  ugc nofollow" target="_blank"><div class="ls ab dw"><div class="lt ab lu cl cj lv"><h2 class="bd hj fi z dy lw ea eb lx ed ef hh bi translated">SQLite中的数据类型</h2><div class="ly l"><h3 class="bd b fi z dy lw ea eb lx ed ef dx translated">大多数SQL数据库引擎(据我们所知，除了SQLite之外的所有SQL数据库引擎)都使用静态的、严格的类型…</h3></div><div class="lz l"><p class="bd b fp z dy lw ea eb lx ed ef dx translated">www.sqlite.org</p></div></div><div class="ma l"><div class="mh l mc md me ma mf jh lr"/></div></div></a></div></div></div>    
</body>
</html>