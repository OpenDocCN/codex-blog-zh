<html>
<head>
<title>How to build an Android video chat app with Sendbird Calls</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Sendbird呼叫建立一个Android视频聊天应用程序</h1>
<blockquote>原文：<a href="https://medium.com/codex/android-video-chat-sendbird-calls-57e917f6047b?source=collection_archive---------5-----------------------#2022-01-20">https://medium.com/codex/android-video-chat-sendbird-calls-57e917f6047b?source=collection_archive---------5-----------------------#2022-01-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/cb698622bc748d42d492e57e0a59991f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ct9JDY4YP4QnU16k.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">仙鸟2022。</figcaption></figure><div class=""/><p id="ddab" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">解决方案工程师| <a class="ae js" href="https://www.sendbird.com" rel="noopener ugc nofollow" target="_blank"> Sendbird </a></p><p id="7581" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><em class="jt">你可能会发现查看一个通话应用的</em> <a class="ae js" href="https://github.com/sendbird-community/SendbirdCallsTutorial" rel="noopener ugc nofollow" target="_blank"> <em class="jt">样本代码</em> </a> <em class="jt">很有用。如需进一步指导，请参考我们的</em> <a class="ae js" href="https://sendbird.com/docs/calls/v1/android/guides/direct-call" rel="noopener ugc nofollow" target="_blank"> <em class="jt">文档</em> </a> <em class="jt">。要了解更多关于Sendbird调用API的信息，请访问</em> <a class="ae js" href="https://sendbird.com/features/voice-and-video" rel="noopener ugc nofollow" target="_blank"> <em class="jt">本页</em> </a> <em class="jt">。</em></p><p id="6e6e" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><em class="jt">更多有用的教程，查看我们的</em> <a class="ae js" href="https://sendbird.com/developer" rel="noopener ugc nofollow" target="_blank"> <em class="jt">开发者门户</em> </a> <em class="jt">。</em></p><h1 id="dba4" class="ju jv hx bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">介绍</h1><p id="6eff" class="pw-post-body-paragraph iu iv hx iw b ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn kw jp jq jr hb bi translated">在本教程中，我们将讨论如何使用<a class="ae js" href="https://sendbird.com/features/voice-and-video" rel="noopener ugc nofollow" target="_blank"> Sendbird Calls </a>来构建一个Android视频通话应用程序。本教程结束时，您将了解如何在Sendbird仪表盘上创建应用程序、构建UI、创建用户以及在应用程序中拨打和接听视频电话。在本教程中，我们将使用Android Studio和Firebase。</p><p id="2a80" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">请注意，这是一个由两部分组成的指南。第一部分展示了如何在Sendbird中设置调用，<a class="ae js" href="https://sendbird.com/developer/tutorials/screen-sharing-android" rel="noopener ugc nofollow" target="_blank"> <strong class="iw hy">第二部分</strong> </a>展示了如何在对实现进行最小改动的情况下实现屏幕共享功能。</p><p id="8644" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hy">注意:</strong>为了本教程的简单，我们将在我们的<strong class="iw hy"> gradle </strong>文件中使用<strong class="iw hy"> targetSdkVersion 28 </strong>，因此如果您使用版本29或更旧版本，我们不必实现Google要求的服务。</p><p id="9a97" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我们开始吧！</p><h1 id="188e" class="ju jv hx bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">第一步。创建一个Sendbird帐户</h1><ol class=""><li id="bd18" class="kx ky hx iw b ix ks jb kt jf kz jj la jn lb jr lc ld le lf bi translated">注册一个<a class="ae js" href="https://dashboard.sendbird.com/auth/signup" rel="noopener ugc nofollow" target="_blank">免费Sendbird账户</a>。<br/> 1。使用您的电子邮件id或“继续使用Google”创建一个帐户。<br/> 2。通过输入“组织名称”和“电话号码”来设置您的组织。<br/> 3。在离您所在地最近的地区创建一个新的“聊天+通话”应用程序。</li></ol><figure class="lh li lj lk fd hk er es paragraph-image"><div class="er es lg"><img src="../Images/35b9105135438f5f83a0ca5f6c7718f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/0*0NoshaK2mnvQhI87.gif"/></div></figure><ul class=""><li id="42fa" class="kx ky hx iw b ix iy jb jc jf ll jj lm jn ln jr lo ld le lf bi translated">在屏幕的左侧，您应该会看到一个“通话”菜单；进入“工作室”并创建一个新的“电话亭”用户。</li><li id="c205" class="kx ky hx iw b ix lp jb lq jf lr jj ls jn lt jr lo ld le lf bi translated">定义要呼叫的用户ID。我们版主的ID是789298。你想叫它什么都可以。</li></ul><figure class="lh li lj lk fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lu"><img src="../Images/932b7eb3baa18279677dc98e485cee16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*4jTEaMA7qIFu6DeT.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">带有呼叫工作室的Sendbird仪表板</figcaption></figure><h1 id="df7c" class="ju jv hx bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">第二步。创建新项目</h1><ol class=""><li id="3108" class="kx ky hx iw b ix ks jb kt jf kz jj la jn lb jr lc ld le lf bi translated">让我们从使用Android Studio创建一个空白项目开始。选择空活动。</li></ol><figure class="lh li lj lk fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lu"><img src="../Images/cade65d42ed5c283ef1725ff5f9bd7d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*KR5kCDgOah3ibrxz.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">创建新的Android项目</figcaption></figure><p id="42ea" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">2.下一步是提供一个名称。我们将称之为SendbirdScreenShare，因为本指南的第二部分涵盖了屏幕共享以完成我们的教程。</p><figure class="lh li lj lk fd hk er es paragraph-image"><div class="er es lg"><img src="../Images/58158540dec138407dee06d66ddc891c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/0*IRGO2pWJ52FNmizr.png"/></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">为我们的Android项目命名。</figcaption></figure><p id="cde3" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">3.找到您的<code class="du lv lw lx ly b">build.gradle</code>文件(用于您的模块的文件)并包含Sendbird调用的实现(您的版本可能比本教程中显示的版本高)</p><figure class="lh li lj lk fd hk er es paragraph-image"><div class="er es lg"><img src="../Images/a5a4c6ab82b9ef6bc761d5b28a09c61d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/0*g-mIbdVNmrVoesnU.png"/></div></figure><p id="2ae0" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">为我们的模块设置Gradle文件。</p><figure class="lh li lj lk fd hk"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="5bde" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">4.您需要对此文件进行另一项更改。确保这些值如下所示:</p><p id="6632" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">21世纪</p><p id="f530" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">目标版本28</p><p id="11fd" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如前所述，这些值允许我们在没有前台服务的情况下实现媒体投影。这将是指南第二部分所需要的。</p><h2 id="0db6" class="mb jv hx bd jw mc md me ka mf mg mh ke jf mi mj ki jj mk ml km jn mm mn kq mo bi translated">Android清单</h2><p id="8802" class="pw-post-body-paragraph iu iv hx iw b ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn kw jp jq jr hb bi translated">1.打开您的<code class="du lv lw lx ly b">AndroidManifest.xml</code>文件并添加以下权限:</p><figure class="lh li lj lk fd hk"><div class="bz dy l di"><div class="lz ma l"/></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">向Android清单添加权限</figcaption></figure><p id="8018" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">2.我们告诉Android，我们将可以访问:</p><ul class=""><li id="9981" class="kx ky hx iw b ix iy jb jc jf ll jj lm jn ln jr lo ld le lf bi translated">此设备的摄像头</li><li id="aa4a" class="kx ky hx iw b ix lp jb lq jf lr jj ls jn lt jr lo ld le lf bi translated">修改音频设置</li><li id="72dd" class="kx ky hx iw b ix lp jb lq jf lr jj ls jn lt jr lo ld le lf bi translated">录制音频</li><li id="884c" class="kx ky hx iw b ix lp jb lq jf lr jj ls jn lt jr lo ld le lf bi translated">接入蓝牙</li><li id="7c88" class="kx ky hx iw b ix lp jb lq jf lr jj ls jn lt jr lo ld le lf bi translated">访问互联网</li><li id="b9e5" class="kx ky hx iw b ix lp jb lq jf lr jj ls jn lt jr lo ld le lf bi translated">对网络状态的访问</li></ul><h1 id="bb2b" class="ju jv hx bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">第三步。创建用户界面</h1><p id="d5d3" class="pw-post-body-paragraph iu iv hx iw b ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn kw jp jq jr hb bi translated">1.为了使本教程简单，我们将只使用一个屏幕。我们将展示:</p><ul class=""><li id="c729" class="kx ky hx iw b ix iy jb jc jf ll jj lm jn ln jr lo ld le lf bi translated">连接到Sendbird的按钮</li><li id="e643" class="kx ky hx iw b ix lp jb lq jf lr jj ls jn lt jr lo ld le lf bi translated">打电话的按钮</li><li id="6b1e" class="kx ky hx iw b ix lp jb lq jf lr jj ls jn lt jr lo ld le lf bi translated">两个视频元素(一个用于我的摄像机，另一个用于远程用户)</li></ul><p id="6b6f" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我们建议添加一个“结束”按钮来结束通话，但在本教程中我们将跳过这一步。</p><p id="239c" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">2.打开您的<code class="du lv lw lx ly b">activity_main.xml</code>布局文件，并添加以下内容:</p><figure class="lh li lj lk fd hk"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="c0ed" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">3.请阅读评论(灰色)以了解每个元素是什么。它们将在屏幕上一个接一个。通话建立后，Sendbird视频元素会自动调整，所以不必担心移动这些元素。</p><figure class="lh li lj lk fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lu"><img src="../Images/7f4eec0bdb380cd13a178b2fb61a8cb6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*5qs_v2Vu3AHu9_ij.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">我们呼叫屏幕的布局</figcaption></figure><h1 id="8208" class="ju jv hx bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">第四步。实施</h1><p id="5a54" class="pw-post-body-paragraph iu iv hx iw b ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn kw jp jq jr hb bi translated">为了简化这个例子，我们将把这个屏幕的所有逻辑添加到MainActivity.java的<strong class="iw hy">文件中。</strong></p><h2 id="3925" class="mb jv hx bd jw mc md me ka mf mg mh ke jf mi mj ki jj mk ml km jn mm mn kq mo bi translated">全局变量</h2><p id="9bbb" class="pw-post-body-paragraph iu iv hx iw b ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn kw jp jq jr hb bi translated">定义连接到Sendbird的信息:您的应用程序ID、任何用户ID以及用户的访问令牌(如果需要的话)。</p><figure class="lh li lj lk fd hk"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="087a" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">接下来，指定CALLEE_ID。这个Id是您要呼叫的人的用户ID。对于这个例子，我们将引用我们在第1部分中创建的用户。</p><figure class="lh li lj lk fd hk"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="2a12" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">对于Sendbird调用，我们需要一个惟一的处理程序ID(可以是您想要的任何东西)。</p><figure class="lh li lj lk fd hk"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="c199" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">保持全局的一个重要对象是<code class="du lv lw lx ly b">DirectCall</code>。这个元素是由Sendbird提供的，它将保存我们与另一个远程用户建立的呼叫的引用。更多信息请参考<a class="ae js" href="https://sendbird.com/docs/calls/v1/android/ref/index.html" rel="noopener ugc nofollow" target="_blank">我们的API </a>:</p><figure class="lh li lj lk fd hk"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="cdd3" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我们还引用了屏幕上的对象(按钮和视频元素)。</p><figure class="lh li lj lk fd hk"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="943d" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">Android还要求我们在运行时向用户请求权限:</p><figure class="lh li lj lk fd hk"><div class="bz dy l di"><div class="lz ma l"/></div></figure><h2 id="8696" class="mb jv hx bd jw mc md me ka mf mg mh ke jf mi mj ki jj mk ml km jn mm mn kq mo bi translated">onCreate</h2><p id="2f1e" class="pw-post-body-paragraph iu iv hx iw b ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn kw jp jq jr hb bi translated">在Android中，一切都从<strong class="iw hy"> onCreate </strong>方法开始。在这里，我们初始化屏幕上的元素(按钮和显示给用户的视频元素)。</p><figure class="lh li lj lk fd hk"><div class="bz dy l di"><div class="lz ma l"/></div></figure><h2 id="f963" class="mb jv hx bd jw mc md me ka mf mg mh ke jf mi mj ki jj mk ml km jn mm mn kq mo bi translated">连接到Sendbird</h2><p id="a1f0" class="pw-post-body-paragraph iu iv hx iw b ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn kw jp jq jr hb bi translated">一旦按下了<strong class="iw hy"> Connect </strong>按钮，我们就调用<strong class="iw hy"> connect() </strong>方法来用Sendbird验证我们的信息。我们还需要建立一个WebSocket连接来接收和发出调用。</p><figure class="lh li lj lk fd hk"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="b2e5" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">验证您的用户ID(如有必要，发送访问令牌)并验证:</p><figure class="lh li lj lk fd hk"><div class="bz dy l di"><div class="lz ma l"/></div></figure><h2 id="9258" class="mb jv hx bd jw mc md me ka mf mg mh ke jf mi mj ki jj mk ml km jn mm mn kq mo bi translated">检查相机权限</h2><p id="343a" class="pw-post-body-paragraph iu iv hx iw b ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn kw jp jq jr hb bi translated">Android要求我们在运行时请求访问该设备的摄像头的权限(用户应该只批准一次)。</p><figure class="lh li lj lk fd hk"><div class="bz dy l di"><div class="lz ma l"/></div></figure><h2 id="8b8c" class="mb jv hx bd jw mc md me ka mf mg mh ke jf mi mj ki jj mk ml km jn mm mn kq mo bi translated">到</h2><p id="5305" class="pw-post-body-paragraph iu iv hx iw b ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn kw jp jq jr hb bi translated">一旦连接并通过验证，我们就可以打电话了。点击屏幕上的<strong class="iw hy">拨打电话</strong>按钮。</p><figure class="lh li lj lk fd hk er es paragraph-image"><div class="er es mp"><img src="../Images/68427183f7e0da934d051995a8b53d46.png" data-original-src="https://miro.medium.com/v2/resize:fit:870/format:webp/1*ahiBuofnWTOXdnD6F_LNIg.png"/></div></figure><p id="df93" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">将调用此方法:</p><figure class="lh li lj lk fd hk"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="8340" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在这个方法中，我们将:</p><ol class=""><li id="9ccc" class="kx ky hx iw b ix iy jb jc jf ll jj lm jn ln jr lc ld le lf bi translated">设置一些基本选项:<br/> a .我们将用于摄像机的视频元素<br/> b .我们将用于远程摄像机的视频元素<br/> c .是否启用音频(true) <br/> d .是否启用视频(true)</li><li id="aa40" class="kx ky hx iw b ix lp jb lq jf lr jj ls jn lt jr lc ld le lf bi translated">我们还设置拨号参数:<br/> a .发送我们的授权用户ID <br/> b .如果这将是一个视频呼叫(真)<br/> c .我们通过上面的<code class="du lv lw lx ly b">CallOptions</code></li></ol><figure class="lh li lj lk fd hk"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="de18" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">下一步是<strong class="iw hy">拨</strong>。这个拨号过程有一个处理程序，我们将使用它来验证是否有任何错误发生。</p><figure class="lh li lj lk fd hk"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="97a8" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">成功连接后，我们立即为以下事件设置了一些侦听器:</p><ol class=""><li id="73fb" class="kx ky hx iw b ix iy jb jc jf ll jj lm jn ln jr lc ld le lf bi translated"><code class="du lv lw lx ly b">onConnected</code>:我们的设备连接到远程设备。</li><li id="318f" class="kx ky hx iw b ix lp jb lq jf lr jj ls jn lt jr lc ld le lf bi translated"><code class="du lv lw lx ly b">onEstablished</code>:远程用户接受呼叫。</li><li id="679b" class="kx ky hx iw b ix lp jb lq jf lr jj ls jn lt jr lc ld le lf bi translated"><code class="du lv lw lx ly b">onEnded</code>:通话结束。</li></ol><figure class="lh li lj lk fd hk"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="d657" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">您还可以定义通话建立后本地和远程摄像机将使用的视频元素:</p><figure class="lh li lj lk fd hk"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="98a0" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">此时，您正在连接仪表板。</p><figure class="lh li lj lk fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mq"><img src="../Images/0dafd764fd20fc72351e2da5d8f62397.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*-oHb2qfaooR9n9Wp.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">从仪表板呼叫</figcaption></figure><h1 id="f74e" class="ju jv hx bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">接待</h1><p id="dcde" class="pw-post-body-paragraph iu iv hx iw b ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn kw jp jq jr hb bi translated">如果您想使用另一个Android设备(而不是您的仪表板)来测试这个示例，那么您应该实现以下方法:</p><figure class="lh li lj lk fd hk"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="786e" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">但是，在这样做之前，我们需要做一些<strong class="iw hy">的基础工作。Sendbird与<strong class="iw hy"> FCM </strong>协同工作，在另一个设备需要呼叫时发送通知。</strong></p><h2 id="eee4" class="mb jv hx bd jw mc md me ka mf mg mh ke jf mi mj ki jj mk ml km jn mm mn kq mo bi translated">创建您的Firebase应用程序</h2><p id="71b8" class="pw-post-body-paragraph iu iv hx iw b ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn kw jp jq jr hb bi translated">这些步骤是谷歌Firebase的一部分。如果你不能按照这些步骤或某些东西不工作，请与谷歌Firebase支持取得联系。</p><p id="b165" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">完成这些步骤后，您将拥有:</p><ol class=""><li id="10c9" class="kx ky hx iw b ix iy jb jc jf ll jj lm jn ln jr lc ld le lf bi translated">一个新的Firebase Android应用程序</li><li id="e740" class="kx ky hx iw b ix lp jb lq jf lr jj ls jn lt jr lc ld le lf bi translated">您的私人服务器密钥</li><li id="1177" class="kx ky hx iw b ix lp jb lq jf lr jj ls jn lt jr lc ld le lf bi translated">一个google-services.json文件</li><li id="0882" class="kx ky hx iw b ix lp jb lq jf lr jj ls jn lt jr lc ld le lf bi translated">进入<a class="ae js" href="https://console.firebase.google.com/" rel="noopener ugc nofollow" target="_blank">火焰基座控制台</a>。如果您的客户端应用程序没有Firebase项目，请创建一个新的</li></ol><figure class="lh li lj lk fd hk er es paragraph-image"><div class="er es lg"><img src="../Images/a219422582572a010375f7fbd2c4f099.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/0*hRVpwhdg7A11ymPx.png"/></div></figure><p id="535a" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">创建Firebase项目。</p><ol class=""><li id="829f" class="kx ky hx iw b ix iy jb jc jf ll jj lm jn ln jr lc ld le lf bi translated">选择您的项目卡，移至<strong class="iw hy">项目概述</strong>。</li><li id="f1f4" class="kx ky hx iw b ix lp jb lq jf lr jj ls jn lt jr lc ld le lf bi translated">点击左上角的齿轮图标，选择<strong class="iw hy">项目设置。</strong></li></ol><figure class="lh li lj lk fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mr"><img src="../Images/16022dc3e14c9bb987b3e7175c50e349.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*WoPaw1uy9K8GInLX.png"/></div></div></figure><p id="4b6d" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在Firebase中访问项目设置:</p><ol class=""><li id="f2a8" class="kx ky hx iw b ix iy jb jc jf ll jj lm jn ln jr lc ld le lf bi translated">转到<strong class="iw hy">云消息</strong> &gt; <strong class="iw hy">项目凭证</strong>并复制您的<strong class="iw hy">服务器密钥</strong>。</li></ol><figure class="lh li lj lk fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ms"><img src="../Images/11959e7f44b43bea0f493d0b1f3518db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*oUsJXtYsbOHPPvdb.png"/></div></div></figure><p id="8d88" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">服务器密钥:</p><ol class=""><li id="3e91" class="kx ky hx iw b ix iy jb jc jf ll jj lm jn ln jr lc ld le lf bi translated">转到<strong class="iw hy">常规</strong>选项卡，选择您的Android应用程序以添加Firebase。输入你的包名，下载<code class="du lv lw lx ly b">google-services.json </code>文件，在注册过程中放在你的Android app模块根目录下。</li></ol><figure class="lh li lj lk fd hk er es paragraph-image"><div class="er es mt"><img src="../Images/d953b2ed05d1696a1cd6ccc4cc706726.png" data-original-src="https://miro.medium.com/v2/resize:fit:1018/format:webp/0*spUNLEdRvcAQGNE8.png"/></div></figure><p id="eb9e" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">下载设置文件并将其放入项目中。</p><h2 id="3097" class="mb jv hx bd jw mc md me ka mf mg mh ke jf mi mj ki jj mk ml km jn mm mn kq mo bi translated">在Sendbird仪表板中注册您的服务器密钥</h2><p id="4cb6" class="pw-post-body-paragraph iu iv hx iw b ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn kw jp jq jr hb bi translated">您需要将步骤5中复制的服务器密钥添加到Sendbird仪表板中，以允许Sendbird向您的客户端发送消息。</p><ol class=""><li id="ccd2" class="kx ky hx iw b ix iy jb jc jf ll jj lm jn ln jr lc ld le lf bi translated">登录到您的<a class="ae js" href="https://dashboard.sendbird.com/?_ga=2.144466229.1282152018.1618837337-1478885345.1614618493" rel="noopener ugc nofollow" target="_blank">仪表盘</a>，进入<strong class="iw hy">设置</strong> &gt; <strong class="iw hy">通话</strong> &gt; <strong class="iw hy">通知</strong>。</li><li id="0296" class="kx ky hx iw b ix lp jb lq jf lr jj ls jn lt jr lc ld le lf bi translated">点击<strong class="iw hy">添加凭证</strong>按钮，注册您的服务器密钥。</li></ol><figure class="lh li lj lk fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lu"><img src="../Images/013c66db325c22621438caa64d6d13ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*pwjAeEZYGpFFmYCR.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">添加您的服务器密钥</figcaption></figure><h2 id="3eb1" class="mb jv hx bd jw mc md me ka mf mg mh ke jf mi mj ki jj mk ml km jn mm mn kq mo bi translated">更新你的档案</h2><p id="d931" class="pw-post-body-paragraph iu iv hx iw b ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn kw jp jq jr hb bi translated">你需要进入你的<strong class="iw hy"> build.gradle </strong>文件(对于项目和应用程序)并添加一些行来包含Firebase。这是你的<strong class="iw hy">项目级</strong>的<strong class="iw hy"> build.gradle </strong>文件应该是这样的:</p><figure class="lh li lj lk fd hk"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="0cf6" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这是你的<code class="du lv lw lx ly b">build.gradle</code>文件应该看起来的样子(在<strong class="iw hy">应用级</strong>):</p><figure class="lh li lj lk fd hk"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="68f7" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">记得再次点击<strong class="iw hy">立即同步</strong>按钮下载新文件。</p><figure class="lh li lj lk fd hk er es paragraph-image"><div class="er es mu"><img src="../Images/ae11c997d70bc70f034ab0196bc3c5b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:826/format:webp/1*ykiW2wCnx7ukOyeFskdIww.png"/></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">立即同步按钮</figcaption></figure><h2 id="c55d" class="mb jv hx bd jw mc md me ka mf mg mh ke jf mi mj ki jj mk ml km jn mm mn kq mo bi translated">从Firebase获取令牌</h2><p id="1d93" class="pw-post-body-paragraph iu iv hx iw b ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn kw jp jq jr hb bi translated">一旦完成，您就可以使用Firebase中的所有类和方法了。我们将使用它们获得一个令牌，并在Sendbird上注册它。</p><p id="b121" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">Sendbird最终将使用这个令牌向这个设备发送消息。</p><p id="1921" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">打开你的<code class="du lv lw lx ly b">MainActivity.java</code>，添加这个新方法:</p><figure class="lh li lj lk fd hk"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="3b11" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在这个<code class="du lv lw lx ly b">MainActivity.java</code>中修改<code class="du lv lw lx ly b">waitForCalls()</code> { … }方法:</p><figure class="lh li lj lk fd hk"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="ec35" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">再次运行您的应用程序，让这些新方法从Firebase获得一个令牌，然后将它们发送给Sendbird。</p><p id="5901" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">您可以从Sendbird仪表板验证这一点。找到您的用户并检查<strong class="iw hy"> Android </strong>的<strong class="iw hy">推送令牌</strong>值。</p><figure class="lh li lj lk fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lu"><img src="../Images/99bb65b00a87e6537464e3c1abfa1042.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*oTDFBep21GldKwY3.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">具有从应用程序分配的推送令牌的用户。</figcaption></figure><p id="5faf" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">正如你在上面看到的(在顶部)，我的用户ID是<strong class="iw hy"> test10 </strong>。在屏幕底部，您可以看到该用户的<strong class="iw hy">推送令牌</strong>。</p><p id="a021" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">您必须看到类似的内容才能收到Sendbird的呼叫通知。</p><h1 id="3a91" class="ju jv hx bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">结论</h1><p id="9df0" class="pw-post-body-paragraph iu iv hx iw b ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn kw jp jq jr hb bi translated">这就是一切！本指南介绍了如何在仪表板上创建新的应用程序、创建用户以及创建能够拨打和接听视频电话的示例应用程序。</p><p id="742b" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">正如开始提到的，这是一个两部分的指南，我们的下一部分将展示如何实现<a class="ae js" href="https://sendbird.com/developer/tutorials/screen-sharing-android" rel="noopener ugc nofollow" target="_blank"> <strong class="iw hy">屏幕共享</strong> </a>。</p><p id="e39c" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">看看吧，快乐的应用内通话建设！</p></div></div>    
</body>
</html>