<html>
<head>
<title>How to add screen sharing to your Android app with Sendbird Calls</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何通过Sendbird呼叫将屏幕共享添加到您的Android应用程序</h1>
<blockquote>原文：<a href="https://medium.com/codex/how-to-add-screen-sharing-to-your-android-app-with-sendbird-calls-7824655fa57c?source=collection_archive---------3-----------------------#2022-06-28">https://medium.com/codex/how-to-add-screen-sharing-to-your-android-app-with-sendbird-calls-7824655fa57c?source=collection_archive---------3-----------------------#2022-06-28</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/cd7266c341f0bb2bf42fbb889351def0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*tP88RZScmSSsrnRd.jpg"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">仙鸟2022</figcaption></figure><div class=""/><div class=""><h2 id="4c8a" class="pw-subtitle-paragraph iu hw hx bd b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl dx translated">使用Sendbird调用实现屏幕共享的2部分指南的第2部分</h2></div><p id="3251" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">解决方案工程师| <a class="ae ki" href="https://www.sendbird.com/" rel="noopener ugc nofollow" target="_blank"> Sendbird </a></p><p id="b373" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated"><em class="kj">我们建议您查看</em> <a class="ae ki" href="https://github.com/warodri-sendbird/tutorial-share-screen-android" rel="noopener ugc nofollow" target="_blank"> <em class="kj">示例应用</em> </a> <em class="kj">获取您可能需要的代码。如需更多指导，请访问我们的</em> <a class="ae ki" href="https://sendbird.com/docs/calls/v1/android/guides/direct-call#2-share-screen" rel="noopener ugc nofollow" target="_blank"> <em class="kj">文档</em> </a> <em class="kj">。请访问我们的</em> <a class="ae ki" href="https://sendbird.com/features/voice-and-video" rel="noopener ugc nofollow" target="_blank"> <em class="kj">网站</em> </a> <em class="kj">了解更多关于Sendbird Calls可以提供的服务。</em></p><blockquote class="kk kl km"><p id="3c56" class="jm jn kj jo b jp jq iy jr js jt jb ju kn jw jx jy ko ka kb kc kp ke kf kg kh hb bi translated"><em class="hx">成为第一个了解新教程、开发者相关聊天/电话发布以及其他重要更新的人，</em> <a class="ae ki" href="https://get.sendbird.com/dev-newsletter-subscription.html" rel="noopener ugc nofollow" target="_blank"> <em class="hx">注册</em> </a> <em class="hx">我们的开发者简讯。</em></p></blockquote><h1 id="6412" class="kq kr hx bd ks kt ku kv kw kx ky kz la jd lb je lc jg ld jh le jj lf jk lg lh bi translated">介绍</h1><p id="26ab" class="pw-post-body-paragraph jm jn hx jo b jp li iy jr js lj jb ju jv lk jx jy jz ll kb kc kd lm kf kg kh hb bi translated">本指南由两部分组成。在<a class="ae ki" href="https://sendbird.com/developer/tutorials/android-video-chat-sendbird-calls" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy"> Part 1 </strong> </a>中，我们向大家展示了如何用视频实现通话。在第2部分中，我们将向您展示如何实现一个简单的屏幕共享功能。Android Sendbird Calls Share屏幕示例的官方Github存储库可从<a class="ae ki" href="https://github.com/sendbird/examples-calls-android/tree/main/DirectCall" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy">这里</strong> </a>获得。</p><p id="60e4" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated"><strong class="jo hy">注:</strong></p><ul class=""><li id="98a0" class="ln lo hx jo b jp jq js jt jv lp jz lq kd lr kh ls lt lu lv bi translated">为了本教程的简单，我们将在我们的<strong class="jo hy"> gradle </strong>文件中使用targetSdkVersion 28，这样如果你使用版本29或更旧的版本，我们就不必实现Google要求的服务。</li><li id="570a" class="ln lo hx jo b jp lw js lx jv ly jz lz kd ma kh ls lt lu lv bi translated">本指南假设您已经完成了第1部分。</li></ul><h1 id="a42e" class="kq kr hx bd ks kt ku kv kw kx ky kz la jd lb je lc jg ld jh le jj lf jk lg lh bi translated">步骤1:修改权限</h1><figure class="mb mc md me fd hk"><div class="bz dy l di"><div class="mf mg l"/></div></figure><p id="28f8" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">在第一部分中，我们添加了成功进行视频通话所需的所有权限。现在在第2部分中，我们需要用额外的权限修改原始清单。FOREGROUND_SERVICE权限允许屏幕共享。</p><p id="ddcb" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">接下来，在应用程序标签<strong class="jo hy"> &lt;应用程序&gt;…&lt;/应用程序&gt;，</strong>中，将以下内容添加到您的清单中，以定义前台服务:</p><figure class="mb mc md me fd hk"><div class="bz dy l di"><div class="mf mg l"/></div></figure><h1 id="f58a" class="kq kr hx bd ks kt ku kv kw kx ky kz la jd lb je lc jg ld jh le jj lf jk lg lh bi translated">第二步。修改用户界面</h1><p id="4105" class="pw-post-body-paragraph jm jn hx jo b jp li iy jr js lj jb ju jv lk jx jy jz ll kb kc kd lm kf kg kh hb bi translated">既然我们已经向清单添加了适当的权限/服务，那么让我们修改我们在第1部分中创建的activity_main.xml布局。我们要添加一个按钮，允许共享我们的屏幕。</p><figure class="mb mc md me fd hk"><div class="bz dy l di"><div class="mf mg l"/></div></figure><figure class="mb mc md me fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mh"><img src="../Images/9c0549859589f0c3e946dbaf8915ff2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*apSn1C1omTx2rA9z.png"/></div></div></figure><p id="cb6d" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">我们独特屏幕的布局</p><p id="c4ca" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">添加按钮后，您的xml看起来将如上所示。</p><h1 id="a19b" class="kq kr hx bd ks kt ku kv kw kx ky kz la jd lb je lc jg ld jh le jj lf jk lg lh bi translated">第三步。修改实现</h1><p id="9315" class="pw-post-body-paragraph jm jn hx jo b jp li iy jr js lj jb ju jv lk jx jy jz ll kb kc kd lm kf kg kh hb bi translated">现在我们需要修改我们的实现。首先，去你的MainActivity.java。在第1部分中，我们为按钮、视频视图和另一个屏幕共享按钮创建了一个全局变量列表。</p><figure class="mb mc md me fd hk"><div class="bz dy l di"><div class="mf mg l"/></div></figure><p id="32f9" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">然后添加一个全局变量来请求进行屏幕录制的权限(设置任何大于零的数字)</p><figure class="mb mc md me fd hk"><div class="bz dy l di"><div class="mf mg l"/></div></figure><p id="60a3" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">现在，在我们的initElementsOnScreen方法中，您将希望初始化butShareScreen并设置onClickListener。</p><figure class="mb mc md me fd hk"><div class="bz dy l di"><div class="mf mg l"/></div></figure><h2 id="5324" class="mi kr hx bd ks mj mk ml kw mm mn mo la jv mp mq lc jz mr ms le kd mt mu lg mv bi translated">共享您的屏幕</h2><p id="8774" class="pw-post-body-paragraph jm jn hx jo b jp li iy jr js lj jb ju jv lk jx jy jz ll kb kc kd lm kf kg kh hb bi translated">为了分享你的屏幕，Android使用了<strong class="jo hy">媒体投影仪管理器</strong>。您需要为您的用户请求许可才能这样做。</p><p id="639e" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">如前所述，如果您的<strong class="jo hy"> targetSdkVersion </strong>是<strong class="jo hy"> 29 </strong>或更高版本，您将需要实现一个<strong class="jo hy">前台服务</strong>(根据Android请求)。为了简单起见，我们将使用版本28。</p><p id="60e2" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">当您单击屏幕上的<strong class="jo hy">共享屏幕</strong>按钮时，startScreenShare()方法将会执行。</p><figure class="mb mc md me fd hk"><div class="bz dy l di"><div class="mf mg l"/></div></figure><p id="9394" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">该函数将向用户请求<strong class="jo hy"> MediaProjectionManager </strong>权限。</p><figure class="mb mc md me fd hk er es paragraph-image"><div class="er es mw"><img src="../Images/ef2abfb8ed52c59914e9b98869546c7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:928/format:webp/0*OK3A9D1g0vewaXch.png"/></div></figure><p id="16a5" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">请求许可录制(和共享)屏幕</p><p id="7287" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">一旦用户接受，<strong class="jo hy"> onActivityResult(…) </strong>将自动执行:</p><figure class="mb mc md me fd hk"><div class="bz dy l di"><div class="mf mg l"/></div></figure><p id="fa60" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">我们的最后一个调用是Sendbird Calls中的<strong class="jo hy"> startScreenShare(…) </strong>方法。下面的代码将为我们完成所有的工作。</p><figure class="mb mc md me fd hk"><div class="bz dy l di"><div class="mf mg l"/></div></figure><h2 id="1e48" class="mi kr hx bd ks mj mk ml kw mm mn mo la jv mp mq lc jz mr ms le kd mt mu lg mv bi translated">停止屏幕共享</h2><p id="1412" class="pw-post-body-paragraph jm jn hx jo b jp li iy jr js lj jb ju jv lk jx jy jz ll kb kc kd lm kf kg kh hb bi translated">要停止共享您的屏幕，您需要从我们的全局<strong class="jo hy"> mCurrentCall </strong>调用<strong class="jo hy"> stopScreenShare </strong>方法。</p><figure class="mb mc md me fd hk"><div class="bz dy l di"><div class="mf mg l"/></div></figure><p id="3faf" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">确保首先检查有效的对象。一旦屏幕共享过程完成，将调用<strong class="jo hy"> CompletionHandler </strong>。不管有没有错误，继续执行您的代码。在本指南中，为了关注本质，我们选择不添加UI元素来结束屏幕共享。</p><h1 id="889e" class="kq kr hx bd ks kt ku kv kw kx ky kz la jd lb je lc jg ld jh le jj lf jk lg lh bi translated">结论</h1><p id="458a" class="pw-post-body-paragraph jm jn hx jo b jp li iy jr js lj jb ju jv lk jx jy jz ll kb kc kd lm kf kg kh hb bi translated">我们已经完成了本教程。在第1部分中，我们实现了打电话的功能，现在在第2部分中，我们添加了共享屏幕的功能。</p></div></div>    
</body>
</html>