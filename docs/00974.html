<html>
<head>
<title>The Little Tool To Run K8S In Docker Easily</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Docker中轻松运行K8S的小工具</h1>
<blockquote>原文：<a href="https://medium.com/codex/easy-kubernetes-integration-in-your-ci-a546556d7da5?source=collection_archive---------7-----------------------#2021-03-28">https://medium.com/codex/easy-kubernetes-integration-in-your-ci-a546556d7da5?source=collection_archive---------7-----------------------#2021-03-28</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><h2 id="619d" class="hg hh hi bd b fp hj hk hl hm hn ho dx hp translated" aria-label="kicker paragraph"><a class="ae ge" href="http://medium.com/codex" rel="noopener">法典</a></h2><div class=""/><div class=""><h2 id="aa26" class="pw-subtitle-paragraph io hr hi bd b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf dx translated">想要动态部署Kubernetes集群吗？是的，可以直接在Docker下运行Kubernetes！</h2></div><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es jg"><img src="../Images/009b6803cba663d978514b29d26718ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*T18SdZGYqq7qgqMO"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx translated">照片由西蒙·维亚尼 / <a class="ae jw" href="https://unsplash.com/?utm_source=ghost&amp;utm_medium=referral&amp;utm_campaign=api-credit" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</figcaption></figure><p id="b310" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">要在本地部署Kubernetes，目前的解决方案是安装<a class="ae jw" href="https://www.docker.com/products/docker-desktop" rel="noopener ugc nofollow" target="_blank"> Docker Desktop </a>或<a class="ae jw" href="https://minikube.sigs.k8s.io/" rel="noopener ugc nofollow" target="_blank"> minikube </a>。我们将在这里看到如何使用一个叫做<a class="ae jw" href="https://kind.sigs.k8s.io/docs/user/quick-start/" rel="noopener ugc nofollow" target="_blank"> kind </a>的伟大工具在Docker中部署Kubernetes。我们将看到如何将其安装在您的笔记本电脑上，并使用Travis CI在CI端进行一点推动。</p><p id="1780" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">对于CI，我们来看下面的场景:您有一个应用程序的YAML清单，您想在不同版本的Kubernetes上测试它。为有重大变化的每个版本创建一个真正的集群会很复杂。</p></div><div class="ab cl kt ku gp kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="hb hc hd he hf"><h1 id="d746" class="la lb hi bd lc ld le lf lg lh li lj lk ix ll iy lm ja ln jb lo jd lp je lq lr bi translated">为什么不是Minikube？</h1><p id="5084" class="pw-post-body-paragraph jx jy hi jz b ka ls is kc kd lt iv kf kg lu ki kj kk lv km kn ko lw kq kr ks hb bi translated">Minikube是在本地部署Kubernetes集群进行测试的最初方式。可以使用虚拟机配置一个主节点和多个节点。每个虚拟机嵌入一个运行时容器:</p><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es lx"><img src="../Images/8b6d72ebc8bce8b052a0202544e77286.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZdRuoc71DnMBJYe54hJFhw.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx translated">Minikube架构图</figcaption></figure><p id="3d48" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">虚拟机需要更长时间才能启动。这在一个CI环境中尤为重要，因为在这个环境中有几个作业必须在一个链中运行。作业的执行时间越短越好！最后，如果我们用容器化层替换虚拟化层会怎么样？</p></div><div class="ab cl kt ku gp kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="hb hc hd he hf"><h1 id="d416" class="la lb hi bd lc ld le lf lg lh li lj lk ix ll iy lm ja ln jb lo jd lp je lq lr bi translated">码头上的Kubernetes</h1><blockquote class="ly lz ma"><p id="2f4b" class="jx jy mb jz b ka kb is kc kd ke iv kf mc kh ki kj md kl km kn me kp kq kr ks hb bi translated">“kind是一个使用Docker容器节点运行本地Kubernetes集群的工具。kind主要是为测试Kubernetes本身而设计的，但也可能用于本地开发或CI。来自<a class="ae jw" href="https://kind.sigs.k8s.io/" rel="noopener ugc nofollow" target="_blank">https://kind.sigs.k8s.io/</a></p></blockquote><p id="f774" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">Kind是一个与docker守护进程交互的CLI。它创建一个“节点”容器，为Kubernetes创建必要的组件，如etcd、kubelet、addons:</p><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es mf"><img src="../Images/e8c8ef676909915cab5d6a948fa28edb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3tWHZpBcrNlxEp_rYK2rkg.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx translated">https://kind.sigs.k8s.io/docs/design/initial/<a class="ae jw" href="https://kind.sigs.k8s.io/docs/design/initial/" rel="noopener ugc nofollow" target="_blank">的实物设计图</a></figcaption></figure><p id="0173" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">在这一部分，我们将看到如何在本地安装<code class="du mg mh mi mj b">kind</code>，然后创建一个集群。然后，我们将配方导出到Travis CI配置中。</p><h2 id="b56c" class="mk lb hi bd lc ml mm mn lg mo mp mq lk kg mr ms lm kk mt mu lo ko mv mw lq ho bi translated">安装</h2><p id="f181" class="pw-post-body-paragraph jx jy hi jz b ka ls is kc kd lt iv kf kg lu ki kj kk lv km kn ko lw kq kr ks hb bi translated">首先安装golang:</p><pre class="jh ji jj jk fd mx mj my mz aw na bi"><span id="6bf9" class="mk lb hi mj b fi nb nc l nd ne">$ brew install golang<br/>$ go version                                                                                                                                                                                                                     <br/>go version go1.16 darwin/amd64</span></pre><p id="8549" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">然后kind超级容易安装:</p><pre class="jh ji jj jk fd mx mj my mz aw na bi"><span id="0f11" class="mk lb hi mj b fi nb nc l nd ne">$ GO111MODULE="on" go get sigs.k8s.io/kind@v0.10.0                                                                                                                                                                             </span></pre><h2 id="fba8" class="mk lb hi bd lc ml mm mn lg mo mp mq lk kg mr ms lm kk mt mu lo ko mv mw lq ho bi translated">创建具有种类的集群</h2><pre class="jh ji jj jk fd mx mj my mz aw na bi"><span id="ee0d" class="mk lb hi mj b fi nb nc l nd ne">$ kind create cluster<br/>Creating cluster "kind" ...<br/> ✓ Ensuring node image (kindest/node:v1.20.2) 🖼<br/> ✓ Preparing nodes 📦<br/> ✓ Writing configuration 📜<br/> ✓ Starting control-plane 🕹️<br/> ✓ Installing CNI 🔌<br/> ✓ Installing StorageClass 💾<br/>Set kubectl context to "kind-kind"<br/>You can now use your cluster with:</span><span id="81b5" class="mk lb hi mj b fi nf nc l nd ne">kubectl cluster-info --context kind-kind</span><span id="d02f" class="mk lb hi mj b fi nf nc l nd ne">Thanks for using kind! 😊</span><span id="412b" class="mk lb hi mj b fi nf nc l nd ne">$ kubectl cluster-info --context kind-kind                                                                                                                                                                                     <br/>Kubernetes control plane is running at <a class="ae jw" href="https://127.0.0.1:50968" rel="noopener ugc nofollow" target="_blank">https://127.0.0.1:50968</a><br/>KubeDNS is running at <a class="ae jw" href="https://127.0.0.1:50968/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy" rel="noopener ugc nofollow" target="_blank">https://127.0.0.1:50968/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy</a></span><span id="ae8c" class="mk lb hi mj b fi nf nc l nd ne">To further debug and diagnose cluster problems, use 'kubectl cluster-info dump'.</span><span id="92eb" class="mk lb hi mj b fi nf nc l nd ne">$ kubectl run busybox --context kind-kind --image=busybox<br/>pod/busybox created<br/>$ kubectl get pods<br/>NAME      READY   STATUS      RESTARTS   AGE<br/>busybox   0/1     Completed   0          7s</span></pre></div><div class="ab cl kt ku gp kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="hb hc hd he hf"><h1 id="74a7" class="la lb hi bd lc ld le lf lg lh li lj lk ix ll iy lm ja ln jb lo jd lp je lq lr bi translated">崔维斯词中的亲切</h1><p id="b828" class="pw-post-body-paragraph jx jy hi jz b ka ls is kc kd lt iv kf kg lu ki kj kk lv km kn ko lw kq kr ks hb bi translated">配置使用golang语言，并重复使用之前在本地执行的手动步骤:</p><figure class="jh ji jj jk fd jl"><div class="bz dy l di"><div class="ng nh l"/></div><figcaption class="js jt et er es ju jv bd b be z dx translated">具有种类的Travis CI配置文件</figcaption></figure><p id="5c44" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">一切都运转良好:</p><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es ni"><img src="../Images/55ffb5892f54f5496c7eaf375a2a3d26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vbx1XyqC4ySbUnl9g3_hew.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx translated">先前配置文件的Travis CI输出</figcaption></figure></div><div class="ab cl kt ku gp kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="hb hc hd he hf"><h1 id="cea0" class="la lb hi bd lc ld le lf lg lh li lj lk ix ll iy lm ja ln jb lo jd lp je lq lr bi translated">结论</h1><p id="b0fb" class="pw-post-body-paragraph jx jy hi jz b ka ls is kc kd lt iv kf kg lu ki kj kk lv km kn ko lw kq kr ks hb bi translated">Kind的启动速度比Minikube快得多。安装和创建Kubernetes集群非常简单。鉴于所有这些，它非常适合CI实践。如果你正在寻找一个最小的解决方案，你也可以用它来代替Docker for Desktop的Kubernetes特性。</p></div><div class="ab cl kt ku gp kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="hb hc hd he hf"><h1 id="fd7a" class="la lb hi bd lc ld le lf lg lh li lj lk ix ll iy lm ja ln jb lo jd lp je lq lr bi translated">资源</h1><div class="nj nk ez fb nl nm"><a href="https://kind.sigs.k8s.io/" rel="noopener  ugc nofollow" target="_blank"><div class="nn ab dw"><div class="no ab np cl cj nq"><h2 class="bd hs fi z dy nr ea eb ns ed ef hr bi translated">种类</h2><div class="nt l"><h3 class="bd b fi z dy nr ea eb ns ed ef dx translated">kind是一个使用Docker容器“节点”运行本地Kubernetes集群的工具。kind主要是为…</h3></div><div class="nu l"><p class="bd b fp z dy nr ea eb ns ed ef dx translated">kind.sigs.k8s.io</p></div></div><div class="nv l"><div class="nw l nx ny nz nv oa jq nm"/></div></div></a></div></div></div>    
</body>
</html>