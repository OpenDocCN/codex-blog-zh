<html>
<head>
<title>How to build a Flutter chat app with Sendbird and 3rd-party UIs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Sendbird和第三方ui构建一个Flutter聊天应用</h1>
<blockquote>原文：<a href="https://medium.com/codex/how-to-build-a-flutter-chat-app-with-sendbird-and-3rd-party-uis-e1c9a68fd88d?source=collection_archive---------2-----------------------#2021-11-18">https://medium.com/codex/how-to-build-a-flutter-chat-app-with-sendbird-and-3rd-party-uis-e1c9a68fd88d?source=collection_archive---------2-----------------------#2021-11-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/4b30121368c322293cf733d0ba1f16e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*S1kCn7h6ocetSdq6.jpg"/></div></div></figure><div class=""/><p id="16c1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">由谷嘉诚<br/>开发商代言| <a class="ae jo" href="https://www.sendbird.com" rel="noopener ugc nofollow" target="_blank">仙鸟</a></p><p id="ef6b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="jp">查看一个颤振聊天app的</em> <a class="ae jo" href="https://github.com/sendbirdcommunity/sendbird-flutter-dashchat-demo" rel="noopener ugc nofollow" target="_blank"> <em class="jp">样本代码</em> </a> <em class="jp">，我们的</em> <a class="ae jo" href="https://sendbird.com/docs/chat/v3/flutter/quickstart/send-first-message" rel="noopener ugc nofollow" target="_blank"> <em class="jp">颤振聊天文档</em> </a> <em class="jp">，以及一个应用内聊天的</em> <a class="ae jo" href="https://sendbird.com/features/chat-messaging" rel="noopener ugc nofollow" target="_blank"> <em class="jp">演示</em> </a> <em class="jp">。</em></p><h1 id="9f33" class="jq jr ht bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">介绍</h1><p id="bfae" class="pw-post-body-paragraph iq ir ht is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hb bi translated">本教程将演示如何集成新的Sendbird Flutter SDK和DashChat UI插件。它将提供一个基本的聊天体验，以纳入您的应用程序。</p><p id="d4b3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Sendbird和DashChat有许多特性，但是我们将限制我们的范围以保持本教程的基本性。本教程结束时，您将能够:</p><ul class=""><li id="5fa2" class="kt ku ht is b it iu ix iy jb kv jf kw jj kx jn ky kz la lb bi translated">将Sendbird Flutter SDK添加、初始化并连接到Flutter应用程序</li><li id="9853" class="kt ku ht is b it lc ix ld jb le jf lf jj lg jn ky kz la lb bi translated">显示用户所属的聊天频道列表</li><li id="bfc6" class="kt ku ht is b it lc ix ld jb le jf lf jj lg jn ky kz la lb bi translated">创建新的聊天频道</li><li id="c519" class="kt ku ht is b it lc ix ld jb le jf lf jj lg jn ky kz la lb bi translated">将Sendbird与DashChat集成以显示一个交互式聊天频道</li></ul><p id="09fa" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了让本教程尽可能容易理解，我们将使用Flutter的默认继承窗口小部件进行状态管理，并将每个视图的逻辑组合在同一个视图中。dart文件。</p><p id="c71a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们开始吧！</p><h1 id="da85" class="jq jr ht bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">什么是颤振？</h1><p id="456f" class="pw-post-body-paragraph iq ir ht is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hb bi translated"><a class="ae jo" href="https://flutter.dev/" rel="noopener ugc nofollow" target="_blank"> Flutter </a>是一个用<a class="ae jo" href="https://dart.dev/" rel="noopener ugc nofollow" target="_blank"> Dart </a>编写的开源跨平台开发框架，Dart是一种旨在开发高性能web应用的C风格语言。使用Flutter，可以为iOS、Android、macOS、Windows和Linux开发应用程序。你也可以在Chrome、Firefox、Safari、Edge以及物联网或智能设备上构建web应用。</p><h1 id="0d44" class="jq jr ht bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">什么是Sendbird Flutter SDK？</h1><p id="192c" class="pw-post-body-paragraph iq ir ht is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hb bi translated">通过<a class="ae jo" href="https://pub.dev/packages/sendbird_sdk" rel="noopener ugc nofollow" target="_blank"><strong class="is hu">Sendbird SDK for Flutter</strong></a>，您可以高效地将实时聊天集成到您的iOS和Android部署应用中。该SDK支持<a class="ae jo" href="https://sendbird.com/docs/chat/v3/flutter/guides/open-channel" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu">开放通道</strong> </a>，<a class="ae jo" href="https://sendbird.com/docs/chat/v3/flutter/guides/group-channel" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu">组</strong> </a>，<a class="ae jo" href="https://sendbird.com/docs/chat/v3/flutter/tutorials/supergroup-channel#1-supergroup-channel" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu">超组</strong> </a>通道。本教程将重点放在组通道。</p><h1 id="9f73" class="jq jr ht bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">为什么要使用第三方聊天界面？</h1><p id="664a" class="pw-post-body-paragraph iq ir ht is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hb bi translated">重用预先存在的聊天UI代码或库可以比从头开始构建更快地启动和运行聊天。</p><h1 id="5807" class="jq jr ht bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">什么是DashChat？</h1><p id="19e8" class="pw-post-body-paragraph iq ir ht is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hb bi translated"><a class="ae jo" href="https://pub.dev/packages/dash_chat" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu"> DashChat </strong> </a>是由<a class="ae jo" href="https://github.com/fayeed" rel="noopener ugc nofollow" target="_blank"><strong class="is hu">fayed Pawaskar</strong></a>开发的一个流行的聊天UI库。这个可扩展的库为两个或更多个人之间的小组对话提供了一个您通常期望的接口。DashChat的插件包括个人资料图像头像、众多界面触发器、自定义颜色的能力以及消息渲染。</p><p id="72c7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">既然我们已经解释了上下文，让我们直接进入代码构建。</p><h1 id="37aa" class="jq jr ht bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">第一步。添加依赖关系</h1><p id="f30f" class="pw-post-body-paragraph iq ir ht is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hb bi translated">在您的Flutter项目的pubspec.yaml文件中，添加Sendbird和DashChat依赖项:</p><figure class="lh li lj lk fd hk"><div class="bz dy l di"><div class="ll lm l"/></div></figure><p id="cecd" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">接下来，单击保存或手动运行CLI命令<code class="du ln lo lp lq b">flutter pub get</code></p><p id="b8f3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您遇到任何问题，请参见Flutter的官方文档中关于添加包的内容。</p><h1 id="2b62" class="jq jr ht bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">第二步。设置</h1><p id="4e5b" class="pw-post-body-paragraph iq ir ht is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hb bi translated">我们要做的第一件事是创建一个新的空的Flutter项目。如果您使用的是Flutter CLI，请运行以下命令:</p><p id="fe62" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du ln lo lp lq b">flutter create sendbird_flutter_dashchat</code></p><p id="99a8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您使用的是Visual Studio代码，新的空白项目将如下所示:</p><figure class="lh li lj lk fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lr"><img src="../Images/b0546bfb77ec1323bea3a141cdf2a207.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*_MYQHHBxwy3xAb-4.png"/></div></div></figure><p id="ff29" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们最终将需要四个额外的视图，所以我们将在这里剔除它们，以便在构建时运行应用程序。要在Visual Studio代码中添加文件，右键单击<strong class="is hu"> lib </strong>文件夹，选择<strong class="is hu">新文件</strong>并将其命名为<strong class="is hu"> login_view.dart </strong>。</p><p id="d6b1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后添加以下代码:</p><figure class="lh li lj lk fd hk"><div class="bz dy l di"><div class="ll lm l"/></div></figure><p id="2578" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对这些附加文件重复此过程:</p><ul class=""><li id="339a" class="kt ku ht is b it iu ix iy jb kv jf kw jj kx jn ky kz la lb bi translated"><strong class="is hu"> channel_list_view.dart </strong></li><li id="e65e" class="kt ku ht is b it lc ix ld jb le jf lf jj lg jn ky kz la lb bi translated"><strong class="is hu">create _ channel _ view . dart</strong></li><li id="caf0" class="kt ku ht is b it lc ix ld jb le jf lf jj lg jn ky kz la lb bi translated"><strong class="is hu"> group_channel_view.dart </strong></li></ul><p id="ed43" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后用以下MaterialApp选项替换<strong class="is hu"> main.dart </strong>文件的全部内容，以利用这些类:</p><figure class="lh li lj lk fd hk"><div class="bz dy l di"><div class="ll lm l"/></div></figure><p id="2f4f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Visual Studio代码中的项目窗格现在应该如下所示:</p><figure class="lh li lj lk fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lr"><img src="../Images/601aeba9e7706436bf491893ac53cd6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*s6iqHVMWxTfJOr62.png"/></div></div></figure><h1 id="6101" class="jq jr ht bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">第三步。正在初始化Sendbird</h1><p id="bfb6" class="pw-post-body-paragraph iq ir ht is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hb bi translated">在使用Sendbird插件进行任何调用之前，请确保使用</p><p id="296e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du ln lo lp lq b">import 'package:sendbird_sdk/sendbird_sdk.dart';</code></p><p id="baa7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要使用上述别名初始化库，请将您的应用程序ID传递给singleton构造函数:</p><p id="3ecf" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du ln lo lp lq b">final sendbird = SendbirdSdk(appId: "your_app_id");</code></p><p id="d4ab" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">选择一个项目后，可以在<a class="ae jo" href="https://dashboard.sendbird.com" rel="noopener ugc nofollow" target="_blank">仪表盘</a>上找到您的应用ID:</p><figure class="lh li lj lk fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ls"><img src="../Images/58754ae9f0ac57f55e7e3b90165bd9d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*cJSOmDGpYWVfn_47.jpg"/></div></div></figure><h1 id="59bc" class="jq jr ht bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">第四步。正在连接到Sendbird</h1><p id="0099" class="pw-post-body-paragraph iq ir ht is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hb bi translated">需要Sendbird用户id来区分不同的用户。这些用户id可以是您的身份验证系统使用的任何唯一的字符串。使用此ID连接你的应用的当前用户:</p><p id="8cd8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du ln lo lp lq b">final user = await sendbird.connect("unique_user_id");</code></p><p id="9e19" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这可以与前面的init语句合并成一个函数:</p><figure class="lh li lj lk fd hk"><div class="bz dy l di"><div class="ll lm l"/></div></figure><p id="c43f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这可以添加到对<strong class="is hu"> login_view.dart </strong>类的覆盖中，然后在成功时推送<strong class="is hu"> channel_list_view.dart </strong>。</p><p id="a295" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了方便和加快速度，为登录视图复制并粘贴最后的<a class="ae jo" href="https://github.com/SendbirdCommunity/sendbird-flutter-dashchat-demo/blob/main/lib/login_view.dart" rel="noopener ugc nofollow" target="_blank">代码</a>。</p><p id="e93b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">该法规定:</p><ul class=""><li id="8891" class="kt ku ht is b it iu ix iy jb kv jf kw jj kx jn ky kz la lb bi translated">用于输入Sendbird应用程序ID*的文本字段</li><li id="5572" class="kt ku ht is b it lc ix ld jb le jf lf jj lg jn ky kz la lb bi translated">用于手动输入Sendbird用户ID*的文本字段</li><li id="cdcb" class="kt ku ht is b it lc ix ld jb le jf lf jj lg jn ky kz la lb bi translated">“登录”按钮启动上面的初始化和连接功能</li></ul><figure class="lh li lj lk fd hk er es paragraph-image"><div class="er es lt"><img src="../Images/2c17bb545f743a8b05aa3f7b29234978.png" data-original-src="https://miro.medium.com/v2/resize:fit:1136/format:webp/0*Jlqfrq7F-NJI1xWO.png"/></div></figure><p id="959d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">*注:要创建查找您的应用程序ID或通过Sendbird仪表板设置用户，请参见<a class="ae jo" href="https://youtu.be/QCS0eyO2Q3U" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu">此Sendbird一分钟视频</strong> </a>。</p><h1 id="60e2" class="jq jr ht bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">第五步。显示频道</h1><p id="444b" class="pw-post-body-paragraph iq ir ht is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hb bi translated">既然SDK已经初始化并连接到Sendbird，让我们填写<strong class="is hu"> channel_list_view.dart </strong>，这样它就可以:</p><ul class=""><li id="9d0c" class="kt ku ht is b it iu ix iy jb kv jf kw jj kx jn ky kz la lb bi translated">显示用户所属的所有<a class="ae jo" href="https://sendbird.com/docs/chat/v3/flutter/guides/group-channel" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu">群组频道</strong> </a>的列表</li><li id="f840" class="kt ku ht is b it lc ix ld jb le jf lf jj lg jn ky kz la lb bi translated">触发对<strong class="is hu">create _ channel _ view . dart</strong>的推送</li><li id="665d" class="kt ku ht is b it lc ix ld jb le jf lf jj lg jn ky kz la lb bi translated">选择其中一个频道，按下<strong class="is hu"> channel_view.dart </strong></li></ul><p id="2e7f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">完成后，我们应该会看到类似这样的视图:</p><figure class="lh li lj lk fd hk er es paragraph-image"><div class="er es lt"><img src="../Images/4790b53820fb0c2aa31b7c4868a2b917.png" data-original-src="https://miro.medium.com/v2/resize:fit:1136/format:webp/0*mRb1PF77qoTDese5.png"/></div></figure><p id="a3bb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将通过以下方式设置类文件:</p><ol class=""><li id="4f74" class="kt ku ht is b it iu ix iy jb kv jf kw jj kx jn lu kz la lb bi translated">添加<code class="du ln lo lp lq b">import "package:sendbird_sdk/sendbird_sdk.dart";</code></li><li id="bbfd" class="kt ku ht is b it lc ix ld jb le jf lf jj lg jn lu kz la lb bi translated">用<a class="ae jo" href="https://sendbird.com/docs/chat/v3/flutter/ref/handlers_channel_event_handler/ChannelEventHandler-class.html" rel="noopener ugc nofollow" target="_blank"><strong class="is hu">channel eventhandler</strong></a>mixin扩展视图状态。</li><li id="bab8" class="kt ku ht is b it lc ix ld jb le jf lf jj lg jn lu kz la lb bi translated">在<strong class="is hu"> initState() </strong>函数的覆盖中连接一个Sendbird<a class="ae jo" href="https://sendbird.com/docs/chat/v3/flutter/ref/sdk_sendbird_sdk_api/SendbirdSdk/addChannelEventHandler.html" rel="noopener ugc nofollow" target="_blank"><strong class="is hu">addChannelEventHandler</strong></a>。</li></ol><p id="dbfb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">初始的类文件如下所示:</p><figure class="lh li lj lk fd hk"><div class="bz dy l di"><div class="ll lm l"/></div></figure><p id="56cd" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">获取当前用户所属的所有频道列表的最快方法是使用Sendbird<a class="ae jo" href="https://sendbird.com/docs/chat/v3/flutter/guides/group-channel#2-retrieve-a-list-of-channels" rel="noopener ugc nofollow" target="_blank"><strong class="is hu">groupchannelistquery</strong></a>。</p><p id="9f7c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这个查询可以打包成一个异步函数，如下所示:</p><figure class="lh li lj lk fd hk"><div class="bz dy l di"><div class="ll lm l"/></div></figure><p id="8627" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">可以从FutureBuilder中调用它来构建ListView:</p><figure class="lh li lj lk fd hk"><div class="bz dy l di"><div class="ll lm l"/></div></figure><p id="bca2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">创建新的频道需要从列表中选择用户，所以接下来我们将创建另一个类来显示和处理它。现在，我们将添加一个appBar，它带有一个推送视图的动作:</p><figure class="lh li lj lk fd hk"><div class="bz dy l di"><div class="ll lm l"/></div></figure><p id="bd42" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们现在可以用上面创建的FutureBuilder和appBar小部件来更新我们的scaffold存根了:</p><figure class="lh li lj lk fd hk"><div class="bz dy l di"><div class="ll lm l"/></div></figure><p id="4bcc" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">查看该类的<a class="ae jo" href="https://github.com/SendbirdCommunity/sendbird-flutter-dashchat-demo/blob/main/lib/channel_list_view.dart" rel="noopener ugc nofollow" target="_blank">最终代码</a>。</p><h1 id="e029" class="jq jr ht bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">第六步。创建新频道</h1><p id="cbd0" class="pw-post-body-paragraph iq ir ht is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hb bi translated">现在，让我们完成<strong class="is hu">create _ channel _ view . dart</strong>以便它:</p><ul class=""><li id="f9c4" class="kt ku ht is b it iu ix iy jb kv jf kw jj kx jn ky kz la lb bi translated">检索并显示Sendbird用户列表</li><li id="55c6" class="kt ku ht is b it lc ix ld jb le jf lf jj lg jn ky kz la lb bi translated">允许选择或取消选择用户</li><li id="e763" class="kt ku ht is b it lc ix ld jb le jf lf jj lg jn ky kz la lb bi translated">创建包含所选用户的新群组频道</li></ul><p id="73f0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">完成后，视图应呈现如下:</p><figure class="lh li lj lk fd hk er es paragraph-image"><div class="er es lt"><img src="../Images/867a9d0e80649049b13b246f2c0658a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1136/format:webp/0*UPyURAlaMnnIxHVp.png"/></div></figure><p id="df6b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先将以下属性添加到<strong class="is hu">Class _ CreateChannelViewState扩展状态{} </strong>块中:</p><p id="5034" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du ln lo lp lq b">final Set _selectedUsers = {};<br/> final List _availableUsers = [];</code></p><p id="9fda" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这些属性将存储我们可以从中选择的用户列表以及用户选择的用户列表。</p><p id="e80d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了获得可用用户的列表，我们将使用<a class="ae jo" href="https://sendbird.com/docs/chat/v3/flutter/ref/query_user_list_query/ApplicationUserListQuery-class.html" rel="noopener ugc nofollow" target="_blank"><strong class="is hu">ApplicationUserListQuery()</strong></a>返回一个Sendbird<a class="ae jo" href="https://sendbird.com/docs/chat/v3/flutter/ref/core_models_user/User-class.html" rel="noopener ugc nofollow" target="_blank"><strong class="is hu"/></a>用户的列表，我们将从<strong class="is hu"> initState() </strong>调用这些用户来预填充我们的列表。</p><figure class="lh li lj lk fd hk"><div class="bz dy l di"><div class="ll lm l"/></div></figure><p id="8d3f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">使用<a class="ae jo" href="https://api.flutter.dev/flutter/material/CheckboxListTile-class.html" rel="noopener ugc nofollow" target="_blank"><strong class="is hu">CheckboxListTiles</strong></a>用列表视图显示用户列表，这样我们就有了一个可视的切换，用户将被添加到新频道。</p><figure class="lh li lj lk fd hk"><div class="bz dy l di"><div class="ll lm l"/></div></figure><p id="5f65" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要创建新的聊天频道，请使用<a class="ae jo" href="https://sendbird.com/docs/chat/v3/flutter/ref/core_channel_group_group_channel/GroupChannel/createChannel.html" rel="noopener ugc nofollow" target="_blank"><strong class="is hu">group channel . create channel()</strong></a>函数，方法是传入一个用用户ID字符串列表填充的<a class="ae jo" href="https://sendbird.com/docs/chat/v3/flutter/ref/params_group_channel_params/GroupChannelParams-class.html" rel="noopener ugc nofollow" target="_blank"><strong class="is hu">GroupChannelParams</strong></a>对象。让我们将它放入自己的函数中，稍后我们可以通过appBar操作调用它:</p><figure class="lh li lj lk fd hk"><div class="bz dy l di"><div class="ll lm l"/></div></figure><p id="b8ee" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在添加一个触发这个<strong class="is hu"> createChannel() </strong>函数的appBar:</p><figure class="lh li lj lk fd hk"><div class="bz dy l di"><div class="ll lm l"/></div></figure><p id="01dd" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">注意，我们将一组<strong class="is hu"> _selectedUsers </strong>转换成了一个用户id列表。<strong class="is hu">【for(最终用户in _ selected users . to list())user . userid】</strong></p><p id="ae5b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">像前面一样，我们现在可以在<strong class="is hu"> build() </strong>函数中更新支架存根:</p><figure class="lh li lj lk fd hk"><div class="bz dy l di"><div class="ll lm l"/></div></figure><p id="3ec1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你可以查看这个类的最终代码。</p><h1 id="b935" class="jq jr ht bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">第七步。与DashChat集成</h1><p id="6193" class="pw-post-body-paragraph iq ir ht is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hb bi translated">最后更新的文件是<strong class="is hu">group _ channel _ view . dart</strong>。完成后，我们将能够:</p><ul class=""><li id="e709" class="kt ku ht is b it iu ix iy jb kv jf kw jj kx jn ky kz la lb bi translated">两个或更多用户之间的实时聊天</li><li id="711c" class="kt ku ht is b it lc ix ld jb le jf lf jj lg jn ky kz la lb bi translated">显示头像图像(如果图像已分配给用户)</li></ul><p id="313b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">完成后，该视图应该如下所示:</p><figure class="lh li lj lk fd hk er es paragraph-image"><div class="er es lt"><img src="../Images/c4200a5ee6306b1a29925180e5c3bcbd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1136/format:webp/0*x7YsfplCfeSoN7lt.png"/></div></figure><p id="d76c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">通过以下方式设置此文件:</p><ol class=""><li id="b946" class="kt ku ht is b it iu ix iy jb kv jf kw jj kx jn lu kz la lb bi translated">添加<code class="du ln lo lp lq b">import "package:sendbird_sdk/sendbird_sdk.dart";</code></li><li id="ff1a" class="kt ku ht is b it lc ix ld jb le jf lf jj lg jn lu kz la lb bi translated">添加<code class="du ln lo lp lq b">import "package:dash_chat/dash_chat.dart"</code></li><li id="eaac" class="kt ku ht is b it lc ix ld jb le jf lf jj lg jn lu kz la lb bi translated">添加一个<strong class="is hu"> GroupChannel </strong>属性和一个初始化器，以便在构造函数中填充该属性</li><li id="ca00" class="kt ku ht is b it lc ix ld jb le jf lf jj lg jn lu kz la lb bi translated">用<a class="ae jo" href="https://sendbird.com/docs/chat/v3/flutter/ref/handlers_channel_event_handler/ChannelEventHandler-class.html" rel="noopener ugc nofollow" target="_blank"><strong class="is hu">channel event handler</strong></a>mixin扩展视图状态。</li><li id="d36d" class="kt ku ht is b it lc ix ld jb le jf lf jj lg jn lu kz la lb bi translated">在<strong class="is hu"> initState() </strong>函数的覆盖中连接一个Sendbird<a class="ae jo" href="https://sendbird.com/docs/chat/v3/flutter/ref/sdk_sendbird_sdk_api/SendbirdSdk/addChannelEventHandler.html" rel="noopener ugc nofollow" target="_blank"><strong class="is hu">addChannelEventHandler</strong></a></li><li id="61b7" class="kt ku ht is b it lc ix ld jb le jf lf jj lg jn lu kz la lb bi translated">向<strong class="is hu"> _GroupChannelViewState </strong>添加一个<strong class="is hu"> List _messages = [] </strong>属性来存储消息</li><li id="28cc" class="kt ku ht is b it lc ix ld jb le jf lf jj lg jn lu kz la lb bi translated">添加<strong class="is hu"> onMessageReceived() </strong>覆盖函数，以在检测到新消息时更新<strong class="is hu"> _messages </strong>属性</li></ol><p id="e78a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先，通过调用<a class="ae jo" href="https://sendbird.com/docs/chat/v3/flutter/ref/core_channel_base_base_channel/Messages/getMessagesByTimestamp.html" rel="noopener ugc nofollow" target="_blank"><strong class="is hu">getMessagesByTimestamp()</strong></a>函数，对传入的GroupChannel对象中的现有消息进行解包。这需要两个参数:</p><ol class=""><li id="882d" class="kt ku ht is b it iu ix iy jb kv jf kw jj kx jn lu kz la lb bi translated">unix纪元的int形式的时间戳</li><li id="95ec" class="kt ku ht is b it lc ix ld jb le jf lf jj lg jn lu kz la lb bi translated"><a class="ae jo" href="https://sendbird.com/docs/chat/v3/flutter/ref/params_message_list_params/MessageListParams-class.html" rel="noopener ugc nofollow" target="_blank"><strong class="is hu">messagelist params</strong></a>对象</li></ol><p id="9ec3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">MessageListParam允许您自定义要返回的消息的范围。我们现在将使用缺省值。一旦我们有了消息，我们将在一个方便的函数中更新我们的<strong class="is hu"> _messages </strong>属性，我们可以在初始化期间调用这个函数。该类现在应该如下所示:</p><figure class="lh li lj lk fd hk"><div class="bz dy l di"><div class="ll lm l"/></div></figure><p id="6a4c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要使用DashChat小部件，当前Sendbird用户和Sendbird消息都需要转换为DashChat用户和DashChat消息。包括这些便利功能。</p><figure class="lh li lj lk fd hk"><div class="bz dy l di"><div class="ll lm l"/></div></figure><p id="e5c4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们可以创建一个DashChat小部件:</p><figure class="lh li lj lk fd hk"><div class="bz dy l di"><div class="ll lm l"/></div></figure><p id="7b2c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">注意，在<strong class="is hu"> onSend </strong> DashChat属性中，我们调用Sendbird的group channel<a class="ae jo" href="https://sendbird.com/docs/chat/v3/flutter/ref/core_channel_base_base_channel/Messages/sendUserMessageWithText.html" rel="noopener ugc nofollow" target="_blank"><strong class="is hu">sendUserMessageWithText()</strong></a>函数来实际传递消息。</p><p id="4a1c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们现在可以用这个和一个显示所有通道成员名称的默认appBar来替换scaffold存根:</p><figure class="lh li lj lk fd hk"><div class="bz dy l di"><div class="ll lm l"/></div></figure><p id="dedb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这是这个班级的最终代码。</p><h1 id="a638" class="jq jr ht bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">结论</h1><p id="1598" class="pw-post-body-paragraph iq ir ht is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hb bi translated">本教程演示了如何将Sendbird Flutter SDK与DashChat集成，并将聊天功能构建到您的应用程序中。请记住，还有更多Sendbird和DashChat功能可以添加到您的应用程序中，例如:</p><ul class=""><li id="5720" class="kt ku ht is b it iu ix iy jb kv jf kw jj kx jn ky kz la lb bi translated">长时间新闻事件</li><li id="042e" class="kt ku ht is b it lc ix ld jb le jf lf jj lg jn ky kz la lb bi translated">头像触摸事件</li><li id="52b5" class="kt ku ht is b it lc ix ld jb le jf lf jj lg jn ky kz la lb bi translated">头像长按事件</li><li id="e912" class="kt ku ht is b it lc ix ld jb le jf lf jj lg jn ky kz la lb bi translated">自定义输入</li><li id="6863" class="kt ku ht is b it lc ix ld jb le jf lf jj lg jn ky kz la lb bi translated">反应</li><li id="6f09" class="kt ku ht is b it lc ix ld jb le jf lf jj lg jn ky kz la lb bi translated">图像和文件处理</li><li id="c9e7" class="kt ku ht is b it lc ix ld jb le jf lf jj lg jn ky kz la lb bi translated">打字指示器</li></ul><p id="3aa7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">有关我们的SDK支持的Sendbird功能的完整摘要，以及对您的旅程有所帮助的其他资源，请查看我们的<a class="ae jo" href="https://sendbird.com/docs/chat/v3/flutter/quickstart/send-first-message" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu">官方文档</strong> </a>。</p><p id="0cf0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">恭喜你！您正在为您的Flutter应用程序添加功能丰富的聊天功能。</p><p id="043a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">编码快乐！💻</p></div></div>    
</body>
</html>