<html>
<head>
<title>Record vs Class vs Struct and more, C# 9</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">记录对类对结构等等，C# 9</h1>
<blockquote>原文：<a href="https://medium.com/codex/record-vs-class-vs-struct-and-more-c-9-ff0b7b8265bc?source=collection_archive---------1-----------------------#2022-10-24">https://medium.com/codex/record-vs-class-vs-struct-and-more-c-9-ff0b7b8265bc?source=collection_archive---------1-----------------------#2022-10-24</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="c264" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" href="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/builtin-types/value-types?source=recommendations" rel="noopener ugc nofollow" target="_blank">值类型</a>和<a class="ae jd" href="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/reference-types" rel="noopener ugc nofollow" target="_blank">引用类型</a>是C#类型的两个主要类别。A <strong class="ih hj"> <em class="je">类</em> </strong>是C#中声明引用类型的关键字之一。<strong class="ih hj"> <em class="je"> Struct </em> </strong>是一种可以封装数据和相关功能的值类型。</p><p id="a0a5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我不会开始深入解释值类型和引用类型之间的区别，但是其中一个区别是关于<strong class="ih hj">值相等。</strong></p><h2 id="7938" class="jf jg hi bd jh ji jj jk jl jm jn jo jp iq jq jr js iu jt ju jv iy jw jx jy jz bi translated"><strong class="ak">值相等</strong></h2><blockquote class="ka kb kc"><p id="7de4" class="if ig je ih b ii ij ik il im in io ip kd ir is it ke iv iw ix kf iz ja jb jc hb bi translated">值相等意味着两个对象包含相同的值。</p></blockquote><p id="2fe1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">类</strong></p><p id="33ee" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当谈到<code class="du kg kh ki kj b">Class</code>时，我们可以使用方法<code class="du kg kh ki kj b">Object.Equals</code>来确定两个对象实例是否相等。<code class="du kg kh ki kj b">Equals</code>的默认实现支持引用类型的<strong class="ih hj">引用相等。</strong>引用相等意味着被比较的对象引用指向同一个对象，也就是说它们指向堆上的同一个地址。</p><p id="8d53" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">结构</strong></p><p id="fe02" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当涉及到一个<code class="du kg kh ki kj b">Struct</code>时，我们可以使用<code class="du kg kh ki kj b">ValueType.Equals(object? obj)</code>方法，如果<code class="du kg kh ki kj b">obj</code>和这个实例是相同的类型并且表示相同的值，则返回<code class="du kg kh ki kj b">true</code>。这个实现使用反射来检查所有的字段和属性。</p><p id="1e49" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在下面的例子中，我们有一个<code class="du kg kh ki kj b">CProduct class</code>和一个<code class="du kg kh ki kj b">SProduct struct</code>都有相同的属性。</p><figure class="kk kl km kn fd ko"><div class="bz dy l di"><div class="kp kq l"/></div></figure><figure class="kk kl km kn fd ko"><div class="bz dy l di"><div class="kp kq l"/></div></figure><p id="2551" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当我们创建两个相同的(通过属性值)实例时，我们可以看到<code class="du kg kh ki kj b">Equals</code>为<code class="du kg kh ki kj b">struct</code>实例返回<code class="du kg kh ki kj b">true</code>，为<code class="du kg kh ki kj b">class</code>实例返回<code class="du kg kh ki kj b">false</code>，正如我们解释的那样。</p><figure class="kk kl km kn fd ko"><div class="bz dy l di"><div class="kp kq l"/></div></figure><figure class="kk kl km kn fd ko er es paragraph-image"><div class="er es kr"><img src="../Images/645978c58266dbb2f06f6415e6c5485b.png" data-original-src="https://miro.medium.com/v2/resize:fit:488/format:webp/1*W6y2Hf184mzw540pMOsZbw.png"/></div></figure><p id="9917" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您应该注意的另外两件事是:</p><ol class=""><li id="7bee" class="ku kv hi ih b ii ij im in iq kw iu kx iy ky jc kz la lb lc bi translated">两个相同(按属性值)实例的<strong class="ih hj"> <em class="je"> hashCode </em> </strong>值对于<code class="du kg kh ki kj b">struct</code>是相同的，而对于<code class="du kg kh ki kj b">class</code>是不同的。</li><li id="0fe8" class="ku kv hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated"><strong class="ih hj">接线员:</strong> ==还有！=运算符不能在<code class="du kg kh ki kj b">struct</code>上运算，除非该结构显式重载它们。</li></ol><h2 id="75d5" class="jf jg hi bd jh ji jj jk jl jm jn jo jp iq jq jr js iu jt ju jv iy jw jx jy jz bi translated">记录</h2><blockquote class="ka kb kc"><p id="d834" class="if ig je ih b ii ij ik il im in io ip kd ir is it ke iv iw ix kf iz ja jb jc hb bi translated">C# 9.0引入了<em class="hi">记录类型</em></p></blockquote><p id="409e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在C# 9中，我们引入了一个新的类型:<code class="du kg kh ki kj b">record</code>。它是一个引用类型，提供了一些特性，比如<a class="ae jd" rel="noopener" href="/codex/immutable-objects-in-c-9-4b934e7755a7">不变性</a>。</p><p id="2fba" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以这样声明一个记录:</p><pre class="kk kl km kn fd li kj lj lk aw ll bi"><span id="2431" class="jf jg hi kj b fi lm ln l lo lp">public record RProduct(int Price, string name);</span></pre><p id="fee6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当涉及到<strong class="ih hj">值相等</strong>时，记录的行为类似于值类型:</p><figure class="kk kl km kn fd ko"><div class="bz dy l di"><div class="kp kq l"/></div></figure><figure class="kk kl km kn fd ko er es paragraph-image"><div class="er es lq"><img src="../Images/d292af9f29551bac4f11b3babeb4a130.png" data-original-src="https://miro.medium.com/v2/resize:fit:512/format:webp/1*hBuZAGdOFJYZriNdmgLhMA.png"/></div></figure><p id="418c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可以看到，不仅方法<code class="du kg kh ki kj b">Equals</code>的行为与<code class="du kg kh ki kj b">struct</code>相同，而且我们还可以选择使用== and！=运算符。</p><p id="7d30" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">另外，<strong class="ih hj"> <em class="je"> hashCode </em> </strong>值对于两个相同的(按属性值)实例是相同的。</p><p id="8ca4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">用于显示的内置格式</strong></p><p id="9bf7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">与<code class="du kg kh ki kj b">classes</code>和<code class="du kg kh ki kj b">structs</code>中<code class="du kg kh ki kj b">ToString()</code>的默认实现相反，它只返回以下内容:</p><p id="fdeb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du kg kh ki kj b">namespae.object-type</code></p><p id="8563" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">记录类型有一个编译器生成的<code class="du kg kh ki kj b">ToString()</code>，它显示公共属性和字段的名称和值。<code class="du kg kh ki kj b">ToString()</code>返回以下格式的字符串:</p><p id="b176" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du kg kh ki kj b">&lt;record type name&gt; { &lt;property name&gt; = &lt;value&gt;, &lt;property name&gt; = &lt;value&gt;, …}</code></p><figure class="kk kl km kn fd ko"><div class="bz dy l di"><div class="kp kq l"/></div></figure><figure class="kk kl km kn fd ko er es paragraph-image"><div class="er es lr"><img src="../Images/349fdadcda0cc4470d8b8263ceb6731a.png" data-original-src="https://miro.medium.com/v2/resize:fit:952/format:webp/1*Mjc42--Fn-U71wFrP6ezFg.png"/></div></figure><p id="8945" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">解构方法</strong></p><p id="f35c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建记录时，编译器为记录声明中提供的每个位置参数创建一个带有<code class="du kg kh ki kj b">out</code>参数的<code class="du kg kh ki kj b">Deconstruct</code>方法。</p><figure class="kk kl km kn fd ko"><div class="bz dy l di"><div class="kp kq l"/></div></figure><p id="5ca5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是该方法的外观:</p><figure class="kk kl km kn fd ko"><div class="bz dy l di"><div class="kp kq l"/></div></figure><p id="d951" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正如你所看到的,<code class="du kg kh ki kj b">record</code>是一个非常好的特性，可能并不总是正确的选择，但它绝对是C#的一个亮点。它使我们能够拥有一个“值类型”对象，它实际上是一个引用类型，作为其不变性的一部分，它也是线程安全的。</p></div></div>    
</body>
</html>