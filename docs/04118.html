<html>
<head>
<title>💪How to run Magento in Azure using Bicep</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">💪如何使用Bicep在Azure中运行Magento</h1>
<blockquote>原文：<a href="https://medium.com/codex/how-to-run-magento-in-azure-using-bicep-c685feedd7c3?source=collection_archive---------5-----------------------#2021-10-27">https://medium.com/codex/how-to-run-magento-in-azure-using-bicep-c685feedd7c3?source=collection_archive---------5-----------------------#2021-10-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="971f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个示例场景展示了使用基础设施即代码将Magento部署到Azure中的Linux VM。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/5b41ba184d9c7bd10ce0f3b37b6ec728.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fdPoddXiseIUOwxHrTM3KA.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">如何使用Bicep在Azure中运行Magento</figcaption></figure></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><p id="2306" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">本文将回顾如何使用Bicep在Linux虚拟机中部署Magento，Bicep是一种用于声明式部署Azure资源的领域特定语言(DSL)。</p><p id="b6b3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Magento是一个用PHP编写的开源电子商务平台。它使用多种其他PHP框架，如Laminas和Symfony。</p><h1 id="07e7" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">先决条件</h1><ul class=""><li id="8aff" class="ky kz hi ih b ii la im lb iq lc iu ld iy le jc lf lg lh li bi translated">一个活跃的Azure账户:你可以<a class="ae lj" href="https://azure.microsoft.com/free/" rel="noopener ugc nofollow" target="_blank">免费</a>创建一个账户。</li><li id="2346" class="ky kz hi ih b ii lk im ll iq lm iu ln iy lo jc lf lg lh li bi translated"><a class="ae lj" href="https://github.com/azure/bicep" rel="noopener ugc nofollow" target="_blank"> Azure二头肌</a>安装在你的本地机器上。</li><li id="70b4" class="ky kz hi ih b ii lk im ll iq lm iu ln iy lo jc lf lg lh li bi translated">Azure PowerShell。参见:<a class="ae lj" href="https://docs.microsoft.com/en-us/powershell/azure/install-az-ps" rel="noopener ugc nofollow" target="_blank">安装Azure PowerShell </a>。</li><li id="1955" class="ky kz hi ih b ii lk im ll iq lm iu ln iy lo jc lf lg lh li bi translated">Azure订阅中的资源组</li></ul><p id="dcb8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们开始吧！</p><h1 id="91a3" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">解决方案概述</h1><p id="2faf" class="pw-post-body-paragraph if ig hi ih b ii la ik il im lb io ip iq lp is it iu lq iw ix iy lr ja jb jc hb bi translated">我们将创作一个Bicep模板，在Azure中基于Linux的虚拟机上创建一个Magento实例。</p><p id="bf8c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将处理两个文件:</p><ul class=""><li id="4186" class="ky kz hi ih b ii ij im in iq ls iu lt iy lu jc lf lg lh li bi translated"><em class="lv"> main.bicep </em>:这是二头肌模板</li><li id="8088" class="ky kz hi ih b ii lk im ll iq lm iu ln iy lo jc lf lg lh li bi translated"><em class="lv">azure deploy . parameters . JSON</em>:这个参数文件包含用于部署Bicep模板的值</li></ul><p id="6c75" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在部署此解决方案之前，我们必须接受虚拟机映像的法律条款。要阅读并接受法律条款，您可以使用PowerShell通过下面的cmdlet接受条款和条件:</p><pre class="je jf jg jh fd lw lx ly lz aw ma bi"><span id="9dce" class="mb kb hi lx b fi mc md l me mf">Get-AzMarketplaceTerms `<br/>-Publisher 'bitnami' `<br/>-Product 'moodle' `<br/>-Name '3-0' |<br/>Set-AzMarketplaceTerms -Accept</span></pre><h1 id="bef8" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">部署的资源</h1><ul class=""><li id="7a9f" class="ky kz hi ih b ii la im lb iq lc iu ld iy le jc lf lg lh li bi translated">Linux Debian 10.10虚拟机</li><li id="bcd1" class="ky kz hi ih b ii lk im ll iq lm iu ln iy lo jc lf lg lh li bi translated">IP地址(公有和私有)</li><li id="9c60" class="ky kz hi ih b ii lk im ll iq lm iu ln iy lo jc lf lg lh li bi translated">虚拟网络和子网</li><li id="b173" class="ky kz hi ih b ii lk im ll iq lm iu ln iy lo jc lf lg lh li bi translated">唱片</li><li id="ed9b" class="ky kz hi ih b ii lk im ll iq lm iu ln iy lo jc lf lg lh li bi translated">网络安全配置</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mg"><img src="../Images/d9664afa703070916cf3e4cd43c5c9d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LE70imzF2Bz0cSUghs2UJA.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">Magento —部署的资源</figcaption></figure><p id="4fe5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在让我们使用Bicep模板在Azure上部署Moodle。</p><h1 id="fea3" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">1.Azure二头肌模板-参数</h1><p id="9c8e" class="pw-post-body-paragraph if ig hi ih b ii la ik il im lb io ip iq lp is it iu lq iw ix iy lr ja jb jc hb bi translated">我们将定义以下参数:</p><pre class="je jf jg jh fd lw lx ly lz aw ma bi"><span id="693c" class="mb kb hi lx b fi mc md l me mf">param location string<br/>param networkInterfaceName string<br/>param networkSecurityGroupName string<br/>param networkSecurityGroupRules array<br/>param subnetName string<br/>param virtualNetworkName string<br/>param addressPrefixes array<br/>param subnets array<br/>param publicIpAddressName string<br/>param publicIpAddressType string<br/>param publicIpAddressSku string<br/>param virtualMachineName string<br/>param virtualMachineComputerName string<br/>param osDiskType string<br/>param virtualMachineSize string<br/>param adminUsername string</span><span id="bba4" class="mb kb hi lx b fi mh md l me mf">@secure()<br/>param adminPassword string</span></pre><h1 id="3511" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">2.Azure二头肌模板-变量</h1><p id="be41" class="pw-post-body-paragraph if ig hi ih b ii la ik il im lb io ip iq lp is it iu lq iw ix iy lr ja jb jc hb bi translated">我们将定义以下变量:</p><pre class="je jf jg jh fd lw lx ly lz aw ma bi"><span id="e4c6" class="mb kb hi lx b fi mc md l me mf">var nsgId = resourceId(resourceGroup().name, 'Microsoft.Network/networkSecurityGroups', networkSecurityGroupName)<br/>var vnetId = resourceId(resourceGroup().name, 'Microsoft.Network/virtualNetworks', virtualNetworkName)<br/>var subnetRef = '${vnetId}/subnets/${subnetName}'</span></pre><h1 id="f9be" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">3.Azure二头肌模板—资源</h1><p id="fd23" class="pw-post-body-paragraph if ig hi ih b ii la ik il im lb io ip iq lp is it iu lq iw ix iy lr ja jb jc hb bi translated">我们将定义以下资源:</p><pre class="je jf jg jh fd lw lx ly lz aw ma bi"><span id="875c" class="mb kb hi lx b fi mc md l me mf">resource networkInterfaceName_resource 'Microsoft.Network/networkInterfaces@2021-03-01' = {<br/>  name: networkInterfaceName<br/>  location: location<br/>  properties: {<br/>    ipConfigurations: [<br/>      {<br/>        name: 'ipconfig1'<br/>        properties: {<br/>          subnet: {<br/>            id: subnetRef<br/>          }<br/>          privateIPAllocationMethod: 'Dynamic'<br/>          publicIPAddress: {<br/>            id: pip.id<br/>          }<br/>        }<br/>      }<br/>    ]<br/>    networkSecurityGroup: {<br/>      id: nsgId<br/>    }<br/>  }<br/>  dependsOn: [<br/>    networkSecurityGroupName_resource<br/>    virtualNetworkName_resource<br/>    pip<br/>  ]<br/>}</span><span id="9261" class="mb kb hi lx b fi mh md l me mf">resource networkSecurityGroupName_resource 'Microsoft.Network/networkSecurityGroups@2019-02-01' = {<br/>  name: networkSecurityGroupName<br/>  location: location<br/>  properties: {<br/>    securityRules: networkSecurityGroupRules<br/>  }<br/>}</span><span id="f109" class="mb kb hi lx b fi mh md l me mf">resource virtualNetworkName_resource 'Microsoft.Network/virtualNetworks@2020-11-01' = {<br/>  name: virtualNetworkName<br/>  location: location<br/>  properties: {<br/>    addressSpace: {<br/>      addressPrefixes: addressPrefixes<br/>    }<br/>    subnets: subnets<br/>  }<br/>}</span><span id="a177" class="mb kb hi lx b fi mh md l me mf">resource pip 'Microsoft.Network/publicIpAddresses@2019-02-01' = {<br/>  name: publicIpAddressName<br/>  location: location<br/>  properties: {<br/>    publicIPAllocationMethod: publicIpAddressType<br/>  }<br/>  sku: {<br/>    name: publicIpAddressSku<br/>  }<br/>}</span><span id="8cc9" class="mb kb hi lx b fi mh md l me mf">resource virtualMachineName_resource 'Microsoft.Compute/virtualMachines@2021-03-01' = {<br/>  name: virtualMachineName<br/>  location: location<br/>  properties: {<br/>    hardwareProfile: {<br/>      vmSize: virtualMachineSize<br/>    }<br/>    storageProfile: {<br/>      osDisk: {<br/>        createOption: 'FromImage'<br/>        managedDisk: {<br/>          storageAccountType: osDiskType<br/>        }<br/>      }<br/>      imageReference: {<br/>        publisher: 'bitnami'<br/>        offer: 'magento'<br/>        sku: '2-0'<br/>        version: 'latest'<br/>      }<br/>    }<br/>    networkProfile: {<br/>      networkInterfaces: [<br/>        {<br/>          id: networkInterfaceName_resource.id<br/>        }<br/>      ]<br/>    }<br/>    osProfile: {<br/>      computerName: virtualMachineComputerName<br/>      adminUsername: adminUsername<br/>      adminPassword: adminPassword<br/>      linuxConfiguration: {<br/>        patchSettings: {<br/>          patchMode: 'ImageDefault'<br/>        }<br/>      }<br/>    }<br/>    diagnosticsProfile: {<br/>      bootDiagnostics: {<br/>        enabled: true<br/>      }<br/>    }<br/>  }<br/>  plan: {<br/>    name: '2-0'<br/>    publisher: 'bitnami'<br/>    product: 'magento'<br/>  }<br/>}</span></pre><h1 id="58b0" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">4.Azure二头肌模板—输出(可选)</h1><p id="b309" class="pw-post-body-paragraph if ig hi ih b ii la ik il im lb io ip iq lp is it iu lq iw ix iy lr ja jb jc hb bi translated">我们将定义以下输出:</p><pre class="je jf jg jh fd lw lx ly lz aw ma bi"><span id="c53b" class="mb kb hi lx b fi mc md l me mf">output adminUsername string = adminUsername</span></pre><h1 id="38ca" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">5.参数文件</h1><p id="8ff7" class="pw-post-body-paragraph if ig hi ih b ii la ik il im lb io ip iq lp is it iu lq iw ix iy lr ja jb jc hb bi translated">下面的代码显示了参数文件的定义:</p><pre class="je jf jg jh fd lw lx ly lz aw ma bi"><span id="7128" class="mb kb hi lx b fi mc md l me mf">{<br/>    "$schema": "<a class="ae lj" href="https://schema.management.azure.com/schemas/2015-01-01/deploymentParameters.json#" rel="noopener ugc nofollow" target="_blank">https://schema.management.azure.com/schemas/2015-01-01/deploymentParameters.json#</a>",<br/>    "contentVersion": "1.0.0.0",<br/>    "parameters": {<br/>        "location": {<br/>            "value": "eastus"<br/>        },<br/>        "networkInterfaceName": {<br/>            "value": "vm-magento684"<br/>        },<br/>        "networkSecurityGroupName": {<br/>            "value": "vm-magento-nsg"<br/>        },<br/>        "networkSecurityGroupRules": {<br/>            "value": [<br/>                {<br/>                    "name": "HTTP",<br/>                    "properties": {<br/>                        "priority": 1010,<br/>                        "protocol": "TCP",<br/>                        "access": "Allow",<br/>                        "direction": "Inbound",<br/>                        "sourceApplicationSecurityGroups": [],<br/>                        "destinationApplicationSecurityGroups": [],<br/>                        "sourceAddressPrefix": "*",<br/>                        "sourcePortRange": "*",<br/>                        "destinationAddressPrefix": "*",<br/>                        "destinationPortRange": "80"<br/>                    }<br/>                },<br/>                {<br/>                    "name": "HTTPS",<br/>                    "properties": {<br/>                        "priority": 1020,<br/>                        "protocol": "TCP",<br/>                        "access": "Allow",<br/>                        "direction": "Inbound",<br/>                        "sourceApplicationSecurityGroups": [],<br/>                        "destinationApplicationSecurityGroups": [],<br/>                        "sourceAddressPrefix": "*",<br/>                        "sourcePortRange": "*",<br/>                        "destinationAddressPrefix": "*",<br/>                        "destinationPortRange": "443"<br/>                    }<br/>                },<br/>                {<br/>                    "name": "SSH",<br/>                    "properties": {<br/>                        "priority": 1030,<br/>                        "protocol": "TCP",<br/>                        "access": "Allow",<br/>                        "direction": "Inbound",<br/>                        "sourceApplicationSecurityGroups": [],<br/>                        "destinationApplicationSecurityGroups": [],<br/>                        "sourceAddressPrefix": "*",<br/>                        "sourcePortRange": "*",<br/>                        "destinationAddressPrefix": "*",<br/>                        "destinationPortRange": "22"<br/>                    }<br/>                }<br/>            ]<br/>        },<br/>        "subnetName": {<br/>            "value": "default"<br/>        },<br/>        "virtualNetworkName": {<br/>            "value": "magento-vnet"<br/>        },<br/>        "addressPrefixes": {<br/>            "value": [<br/>                "10.0.0.0/16"<br/>            ]<br/>        },<br/>        "subnets": {<br/>            "value": [<br/>                {<br/>                    "name": "default",<br/>                    "properties": {<br/>                        "addressPrefix": "10.0.0.0/24"<br/>                    }<br/>                }<br/>            ]<br/>        },<br/>        "publicIpAddressName": {<br/>            "value": "vm-magento-ip"<br/>        },<br/>        "publicIpAddressType": {<br/>            "value": "Dynamic"<br/>        },<br/>        "publicIpAddressSku": {<br/>            "value": "Basic"<br/>        },<br/>        "virtualMachineName": {<br/>            "value": "vm-magento"<br/>        },<br/>        "virtualMachineComputerName": {<br/>            "value": "vm-magento"<br/>        },<br/>        "osDiskType": {<br/>            "value": "StandardSSD_LRS"<br/>        },<br/>        "virtualMachineSize": {<br/>            "value": "Standard_D2as_v4"<br/>        },<br/>        "adminUsername": {<br/>            "value": "your-admin-username"<br/>        },<br/>        "adminPassword": {<br/>            "value": null<br/>        }<br/>    }<br/>}</span></pre><h1 id="5584" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">6.Azure Bicep模板-部署</h1><p id="981f" class="pw-post-body-paragraph if ig hi ih b ii la ik il im lb io ip iq lp is it iu lq iw ix iy lr ja jb jc hb bi translated">我们将使用下面的命令来部署我们的二头肌模板:</p><pre class="je jf jg jh fd lw lx ly lz aw ma bi"><span id="e3f2" class="mb kb hi lx b fi mc md l me mf">$date = Get-Date -Format "MM-dd-yyyy"<br/>$deploymentName = "AzInsiderDeployment"+"$date"</span><span id="81e7" class="mb kb hi lx b fi mh md l me mf">New-AzResourceGroupDeployment -Name $deploymentName -ResourceGroupName azinsider-magento -TemplateFile .\main.bicep -TemplateParameterFile .\azuredeploy.parameters.json -c</span></pre><p id="8025" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下图显示了部署的预览:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mi"><img src="../Images/62dbcc91d887295b3b0beaa901b006b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uVSzTD9qo7NB9C9YHgCn0Q.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">部署预览</figcaption></figure><p id="f10a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后我们将执行部署。下图显示了部署输出:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mj"><img src="../Images/c1db6bf1e917b29516bc54e9c7b49e2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c9OEks8U4S6bbQ9hd1eIog.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">部署输出</figcaption></figure><p id="6ae3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，您可以从Azure门户获取公共IP和私有IP，并浏览到Magento实例:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mk"><img src="../Images/abc7ba65e247b949c3342907ce76ff12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x2aqUrE3wwggSsambPXLMQ.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">Magento在Azure使用二头肌</figcaption></figure><p id="969a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该解决方案的完整代码可以在以下URL中找到。请随意投稿！</p><div class="ml mm ez fb mn mo"><a href="https://github.com/daveRendon/azinsider/tree/main/application-workloads/magento" rel="noopener  ugc nofollow" target="_blank"><div class="mp ab dw"><div class="mq ab mr cl cj ms"><h2 class="bd hj fi z dy mt ea eb mu ed ef hh bi translated">主daveRendon/azinsider上的azin sider/应用程序工作负载/magento</h2><div class="mv l"><h3 class="bd b fi z dy mt ea eb mu ed ef dx translated">在GitHub上创建一个帐户，为daveRendon/azinsider开发做出贡献。</h3></div><div class="mw l"><p class="bd b fp z dy mt ea eb mu ed ef dx translated">github.com</p></div></div><div class="mx l"><div class="my l mz na nb mx nc jn mo"/></div></div></a></div><p id="c0d2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">👉<a class="ae lj" href="http://eepurl.com/gKmLdf" rel="noopener ugc nofollow" target="_blank"> <em class="lv">在此加入</em><strong class="ih hj"><em class="lv">azin sider</em></strong><em class="lv">邮箱列表。</em>T9】</a></p><p id="5635" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="lv">-戴夫·r·</em></p></div></div>    
</body>
</html>