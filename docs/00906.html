<html>
<head>
<title>Scraping and Analyzing News Articles with Scrapy and Selenium</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Scrapy和Selenium分析新闻文章</h1>
<blockquote>原文：<a href="https://medium.com/codex/scraping-and-analyzing-news-articles-with-scrapy-and-selenium-cbbd94381d78?source=collection_archive---------5-----------------------#2021-03-25">https://medium.com/codex/scraping-and-analyzing-news-articles-with-scrapy-and-selenium-cbbd94381d78?source=collection_archive---------5-----------------------#2021-03-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><h2 id="5e45" class="hg hh hi bd b fp hj hk hl hm hn ho dx hp translated" aria-label="kicker paragraph"><a class="ae ge" href="http://medium.com/codex" rel="noopener">法典</a></h2><div class=""/><p id="d533" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">当我在Udemy 上<a class="ae jm" href="https://www.udemy.com/course/web-scraping-in-python-using-scrapy-and-splash" rel="noopener ugc nofollow" target="_blank">这门课的时候，我亲爱的朋友Sruthi给了我一个令人惊讶的相关挑战:从两个不同的新闻出版物中抓取一些与移民相关的文章，并比较它们使用的关键词。这听起来非常有趣，所以这是献给她的进度报告！</a></p><p id="0489" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">虽然这听起来像是一个直截了当的问题，但其中有几个棘手的部分，具体如下:</p><ol class=""><li id="2cb5" class="jn jo hi iq b ir is iv iw iz jp jd jq jh jr jl js jt ju jv bi translated"><em class="jw">如何找到与某个话题相关的文章？</em></li><li id="dfa2" class="jn jo hi iq b ir jx iv jy iz jz jd ka jh kb jl js jt ju jv bi translated"><em class="jw">如果使用搜索，如何处理全部用JavaScript编写的搜索结果？</em></li><li id="58b1" class="jn jo hi iq b ir jx iv jy iz jz jd ka jh kb jl js jt ju jv bi translated"><em class="jw">如何定义和提取「关键词」？</em></li></ol><p id="a2cf" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">如果我有一个比Sruthi更严格的客户，当然，我必须确定最佳时间段和最合适的出版物。谢天谢地，在这方面我有充分的自主权。</p><p id="ba44" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">所以计划是这样的:我决定把重点放在CNN和福克斯新闻频道，在CNN上使用简单的搜索查询“移民”,同时利用福克斯新闻频道下预先存在的“移民”部分(这部分是因为我似乎只能从福克斯新闻频道获得最多100个搜索结果)。至于时间段，为了避免让这个小项目过于庞大，我将缩小到选举前和选举期间的4个月以及选举后的4个月——因此从2020年8月到2021年3月(考虑到写作时间，不考虑几天)。</p><h1 id="cf6f" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">擦</h1><p id="7843" class="pw-post-body-paragraph io ip hi iq b ir la it iu iv lb ix iy iz lc jb jc jd ld jf jg jh le jj jk jl hb bi translated">在我写“任务简介”的时候，我刚刚接触到那门课程中的“抓取JavaScript网站”部分，所以这对我来说很切题。</p><p id="c052" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">与我在<a class="ae jm" rel="noopener" href="/nerd-for-tech/mining-fanfics-on-ao3-part-1-data-collection-eac8b5d7a7fa">上一篇文章</a>中谈到的不同，简单地使用urllib或requests不适合大量使用JavaScript的网站，Scrapy也是如此。这就是硒发挥作用的方式。</p><p id="dfd8" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">Selenium最初是作为web测试工具创建的。对于一个以前从未做过web测试的人来说，我发现玩起来相当有趣——当你坐着看着你的浏览器被控制——不，是被编程控制——做各种事情，同时用双手喝咖啡。</p><p id="0413" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">我不会进入设置的细节。除了安装<a class="ae jm" href="https://docs.scrapy.org/en/latest/intro/overview.html" rel="noopener ugc nofollow" target="_blank"> Scrapy </a>和<a class="ae jm" href="https://selenium-python.readthedocs.io/installation.html" rel="noopener ugc nofollow" target="_blank"> Selenium </a>之外，还需要一个<a class="ae jm" href="https://selenium-python.readthedocs.io/installation.html#drivers" rel="noopener ugc nofollow" target="_blank">网络驱动</a>来让Selenium与浏览器交互，并且它必须与你的浏览器版本相匹配。</p><p id="8098" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">下面是在终端中键入的命令:</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="2c41" class="lo kd hi lk b fi lp lq l lr ls">scrapy startproject [project name]<br/>cd [project name] <br/>scrapy genspider [spider name]</span></pre><p id="9144" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">请注意，web驱动程序需要位于项目文件夹下的第一层—即与“scrapy.cfg”文件相同的层，该文件起初欺骗了我。</p></div><div class="ab cl lt lu gp lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="hb hc hd he hf"><h2 id="5e71" class="lo kd hi bd ke ma mb mc ki md me mf km iz mg mh kq jd mi mj ku jh mk ml ky ho bi translated">美国有线新闻网；卷积神经网络</h2><p id="fc8c" class="pw-post-body-paragraph io ip hi iq b ir la it iu iv lb ix iy iz lc jb jc jd ld jf jg jh le jj jk jl hb bi translated">在CNN上，如果没有JavaScript，搜索词甚至不会出现，我们会收到一个空白页—</p><figure class="lf lg lh li fd mn er es paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="er es mm"><img src="../Images/b118b472c297458a911afbe10cd8b63d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1lk1mCyccavmdtcF6Ew5dA.png"/></div></div></figure><p id="bf90" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">相比之下，这显示了JavaScript的神奇(和麻烦)</p><figure class="lf lg lh li fd mn er es paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="er es mu"><img src="../Images/752b04a6fb69b9d36a6c6289e0531719.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Vx3fLy0yp0UaHsQ7I8jmzA.png"/></div></div></figure><p id="9288" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">因此，我们首先需要模拟发送搜索请求的过程(只需使用“search？q =中的string也可以，但下面是为了展示从主页运行Selenium的更完整的过程)。然后我们会处理分页——</p><figure class="lf lg lh li fd mn er es paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="er es mv"><img src="../Images/0913827875df09a78d9e3b95920be2ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*27RofdhZ1-Mnj2M-ztLGmQ.png"/></div></div></figure><p id="bd69" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">另一方面，“日期”按钮只给出了按日期或相关性排序的选项，而不是指定搜索日期范围的方法。</p><p id="0674" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">下面是抓取CNN的代码，注释中添加了解释。</p><figure class="lf lg lh li fd mn"><div class="bz dy l di"><div class="mw mx l"/></div></figure></div><div class="ab cl lt lu gp lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="hb hc hd he hf"><h2 id="0760" class="lo kd hi bd ke ma mb mc ki md me mf km iz mg mh kq jd mi mj ku jh mk ml ky ho bi translated">福克斯新闻频道</h2><p id="90fb" class="pw-post-body-paragraph io ip hi iq b ir la it iu iv lb ix iy iz lc jb jc jd ld jf jg jh le jj jk jl hb bi translated">抓取福克斯新闻频道非常相似，但是我们在这里处理的是显示更多按钮，而不是传统的分页</p><figure class="lf lg lh li fd mn er es paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="er es my"><img src="../Images/b4765a70568232f87cee54cb559008d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SnzIAy8PIudp0ePWkRBOPg.png"/></div></div></figure><p id="4221" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">这一次，只评论与CNN蜘蛛相比的显著差异。</p><figure class="lf lg lh li fd mn"><div class="bz dy l di"><div class="mw mx l"/></div></figure><p id="78cf" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">为了运行这些蜘蛛，只需在终端中键入:</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="ecda" class="lo kd hi lk b fi lp lq l lr ls">scrapy crawl [spider name] [-o fileName.csv/.json/.xml] <br/># Saving the output to a file is optional<br/># only these three file types are allowed by Scrapy</span></pre><h1 id="fa58" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">分析</h1><p id="5d70" class="pw-post-body-paragraph io ip hi iq b ir la it iu iv lb ix iy iz lc jb jc jd ld jf jg jh le jj jk jl hb bi translated">我们收集的数据会有一个奇怪的顺序，因为Scrapy不会按顺序处理它们<a class="ae jm" href="https://doc.scrapy.org/en/latest/faq.html#does-scrapy-crawl-in-breadth-first-or-depth-first-order" rel="noopener ugc nofollow" target="_blank">。请求被并发发送以加速该过程。</a></p><p id="2980" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">我们在这一部分需要的包包括:</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="93eb" class="lo kd hi lk b fi lp lq l lr ls"># for standard data wrangling<br/>import pandas as pd<br/>import numpy as np</span><span id="901e" class="lo kd hi lk b fi mz lq l lr ls"># for plotting<br/>import matplotlib.pyplot as plt</span><span id="3e0d" class="lo kd hi lk b fi mz lq l lr ls"># for pattern matching during cleaning<br/>import re</span><span id="0000" class="lo kd hi lk b fi mz lq l lr ls"># for frequency counts<br/>from collections import Counter</span><span id="a429" class="lo kd hi lk b fi mz lq l lr ls"># for bigrams, conditional frequency distribution and beyond<br/>import nltk</span><span id="b5a7" class="lo kd hi lk b fi mz lq l lr ls"># for word cloud<br/>from wordcloud import WordCloud, STOPWORDS, ImageColorGenerator<br/>from PIL import Image</span><span id="58d1" class="lo kd hi lk b fi mz lq l lr ls"># for (one way of) keyword extraction<br/>from sklearn import feature_extraction<br/>from nltk.stem.snowball import SnowballStemmer<br/>from sklearn.feature_extraction.text import TfidfVectorizer</span></pre><p id="7c04" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">以下是CNN和福克斯新闻频道数据的预览:</p><figure class="lf lg lh li fd mn er es paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="er es na"><img src="../Images/385e743a42a22f5c79a69b83b677f2cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ctS23nv4Ii29N2HK4_Bp0g.png"/></div></div></figure><figure class="lf lg lh li fd mn er es paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="er es nb"><img src="../Images/84f0e17b2a72ee9323e7ae3addd8bdff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wuVVomj1wWs4VLEx0G6tnA.png"/></div></div></figure><p id="8a46" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">有几个标准的清洁步骤需要考虑，这最终取决于我们想要实现的目标。例如，如果只是我们想看的内容，我们可以完全忽略其他专栏中的混乱。出于我的目的，我执行了以下步骤:</p><ol class=""><li id="f579" class="jn jo hi iq b ir is iv iw iz jp jd jq jh jr jl js jt ju jv bi translated">扔掉非传统格式的文章，比如幻灯片(导致NA)</li></ol><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="7683" class="lo kd hi lk b fi lp lq l lr ls">df = df.dropna(subset=['column to consider']).reset_index(drop=True)</span></pre><p id="3c22" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">2.格式化日期</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="c893" class="lo kd hi lk b fi lp lq l lr ls"># for CNN<br/>df['date'] = df['time'].apply(lambda x: x.split('ET,')[1][4:].strip())<br/>df.date = pd.to_datetime(df.date, format = '%B %d, %Y')</span><span id="bc80" class="lo kd hi lk b fi mz lq l lr ls"># for Fox News<br/>for _, row in df.iterrows():<br/>    if 'hour' in row['time']:<br/>        row['time'] = ('March 24, 2021')<br/>    elif 'day' in row['time']:<br/>        day_offset = int(row['time'].split()[0])<br/>        row['time'] = 'March {}, 2021'.format(24 - day_offset)<br/>    elif ('March' in row['time']) or ('February' in row['time']) or ('January' in row['time']):<br/>        row['time'] += ', 2021'<br/>    else:<br/>        row['time'] += ', 2020'<br/>df = df.rename(columns = {'time':'date'})<br/>df.date = df.date.apply(lambda x: x.strip())<br/>df.date = pd.to_datetime(fn.date, format = '%B %d, %Y')</span></pre><p id="2762" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">我还创建了一个新的月-年列，用于以后的汇总汇总。这也有助于删除7月份发表的不需要的文章(之前是粗略的页数)。</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="af79" class="lo kd hi lk b fi lp lq l lr ls">df['month_year'] = pd.to_datetime(df['date']).dt.to_period('M')<br/>df_cleaned = df[df['month_year']!=pd.Period('2020-07', 'M')].copy()</span></pre><p id="44a9" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">经过修整，我们现在得到了CNN的644篇文章和福克斯新闻频道的738篇文章。看起来两家新闻机构每月发表的移民相关文章的数量都在上升，福克斯在3月份的兴趣明显增加。</p><figure class="lf lg lh li fd mn er es paragraph-image"><div class="er es nc"><img src="../Images/5ed89c79763d121db41199690f3e4caf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1352/format:webp/1*fsivsaL-usFy7lyUw9kygQ.png"/></div></figure><figure class="lf lg lh li fd mn er es paragraph-image"><div class="er es nd"><img src="../Images/877eef47bb912749f394a5328fa144c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1288/format:webp/1*Y9XM7wDkrLbfBunp8Tkb3w.png"/></div></figure><p id="dcdc" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">3.干净的物品</p><p id="c682" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">我们可以在清理文章正文方面做得更好，因为抓取阶段已经不加区分地包含了所有不必要的内容，比如广告横幅、媒体源和“宽度”或“视频关闭”等标记。但是其中一些很难破坏我们的内容分析。</p><p id="7ded" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">然而，绝对需要我们注意的是嵌入的JavaScript代码(大部分来自页面上的视频)。如果我在处理原始HTML时嵌入一个“更干净”的函数可能会更好，但幸运的是，这些函数中的大多数都很容易识别。经过一番检查后，我把大部分都拿走了——</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="bb6a" class="lo kd hi lk b fi lp lq l lr ls">df['content'] = df['content'].apply(lambda x: x.lower())<br/>cnn.content = cnn.content.apply(lambda x: re.sub(r'use\sstrict.*?env=prod"}', '', x))</span></pre></div><div class="ab cl lt lu gp lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="hb hc hd he hf"><h2 id="641f" class="lo kd hi bd ke ma mb mc ki md me mf km iz mg mh kq jd mi mj ku jh mk ml ky ho bi translated">词云</h2><p id="935f" class="pw-post-body-paragraph io ip hi iq b ir la it iu iv lb ix iy iz lc jb jc jd ld jf jg jh le jj jk jl hb bi translated">我从标题开始，以了解这两种出版物之间的区别。一种可视化文本数据的方法是word cloud。</p><figure class="lf lg lh li fd mn"><div class="bz dy l di"><div class="mw mx l"/></div></figure><p id="29a3" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">以下是几个月来CNN头条新闻中的关键词:</p><figure class="lf lg lh li fd mn er es paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="er es ne"><img src="../Images/434185e9ca4300a5a51d88962113104a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L2SJn-bYlRayYv4hftkaBg.png"/></div></div></figure><p id="4c93" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">注意，所有的单词都是小写的，所以这里的“us”是“我们”的意思，“ice”是“ICE”(移民和海关执法)等等。</p><p id="ce30" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">福克斯新闻频道:</p><figure class="lf lg lh li fd mn er es paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="er es nf"><img src="../Images/37836a0a0e15ff66ce6b29b57703a982.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GHuYxGPSUhzABJniBBeVDw.png"/></div></div></figure><p id="0e0c" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">虽然CNN给予拜登和川普同等的关注，但在移民政策方面，福克斯新闻频道似乎对拜登和他的政府更感兴趣。一些在CNN头条新闻中不存在的关键词，如“非法移民”和“边境危机”，却经常出现在福克斯新闻频道的头条新闻中。</p><p id="336a" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">我们还可以并排查看每个月的word cloud。</p><figure class="lf lg lh li fd mn er es paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="er es nf"><img src="../Images/5c649ca6ce6a25a626fd134e0f8da23a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_pagWrt8TxLmpXn2wC3wsA.png"/></div></div></figure><figure class="lf lg lh li fd mn er es paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="er es ng"><img src="../Images/b9a18d7e79f3391bb3550944b4ec4ffc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0ePXI072ETpdHLGmcBZOew.png"/></div></div></figure><p id="6d9b" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">例如，今年3月，这两份出版物对移民问题给予了越来越多的关注。当CNN(左上)仍然关注科维德时，福克斯新闻频道(左下)正在警告一场汹涌的“边境危机”</p><p id="8f91" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">当谈到移民时，COVID肯定是两人经常谈论的话题，但经常在相当不同的上下文中提及。在美国有线电视新闻网，例子包括“拉丁美洲人正在克服新冠肺炎疫苗接种的障碍，专家说这归结于获取”和“Covid救济对无证重要工人至关重要。”另一方面，我们可以看到福克斯新闻频道的头条新闻，如“拜登政府通过不保护边境将冠状病毒'输入'得克萨斯州:州长阿博特”，事实上，“COVID阳性”只在福克斯新闻频道出现，如“官员说，在得克萨斯州释放的COVID阳性移民人数激增”和“汉尼提:拜登允许COVID阳性移民进入美国是实际的'穴居人思维'。”</p></div><div class="ab cl lt lu gp lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="hb hc hd he hf"><h2 id="ce21" class="lo kd hi bd ke ma mb mc ki md me mf km iz mg mh kq jd mi mj ku jh mk ml ky ho bi translated">二元模型</h2><p id="43b8" class="pw-post-body-paragraph io ip hi iq b ir la it iu iv lb ix iy iz lc jb jc jd ld jf jg jh le jj jk jl hb bi translated">我们可以看的另一件事是二元模型。</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="b78f" class="lo kd hi lk b fi lp lq l lr ls">out = []<br/>for title in list(df['title']):<br/>    out.append(nltk.word_tokenize(title))</span><span id="76e0" class="lo kd hi lk b fi mz lq l lr ls">bi = []<br/>for title_words in out:<br/>    bi += nltk.bigrams(title_words)</span><span id="72df" class="lo kd hi lk b fi mz lq l lr ls">Counter(bi).most_common()</span></pre><p id="cecf" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">除了像“拜登政府”和“特朗普政府”这样的预期热门人物外，还有几个奇怪的人。</p><figure class="lf lg lh li fd mn er es paragraph-image"><div class="er es nh"><img src="../Images/6a7336b95af7a3fdef14aba55b5f5963.png" data-original-src="https://miro.medium.com/v2/resize:fit:1228/format:webp/1*N6ZYmHdeWBhXO2UA3lt5Fw.png"/></div></figure><p id="36a2" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">例如，我发现福克斯新闻频道的bigram“slams Biden”和CNN的“Joe Biden”有相似的计数。显然拜登已经被不同的人员“抨击”了很多次(左)，这确实是一些值得观察的场景…</p><p id="de52" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">有了二元列表，我们可以进一步搜索具有条件频率分布的特定关键字对。比如说—</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="b7fb" class="lo kd hi lk b fi lp lq l lr ls">cfd = nltk.ConditionalFreqDist(bi)</span><span id="e3c7" class="lo kd hi lk b fi mz lq l lr ls">cfd['Covid']<br/># CNN: FreqDist({'relief': 8, ',': 6, 'law': 1})<br/>cfd['coronavirus']<br/># Fox News: FreqDist({'pandemic': 4, 'death': 2, 'vaccine': 1, 'relief': 1, 'records': 1, 'travel': 1, 'is': 1, 'rules': 1, 'canceled': 1, ',': 1, ...})</span><span id="b92d" class="lo kd hi lk b fi mz lq l lr ls">cfd['border']<br/># CNN: FreqDist({'wall': 7, 'crisis': 3, 'is': 3, '.': 2, ',': 2, 'alone': 2, 'surge': 1, 'closed': 1, 'problem': 1, 'encounters': 1, ...})<br/># Fox News: FreqDist({'crisis': 50, 'wall': 19, ',': 14, 'surge': 13, ':': 8, 'as': 7, 'policy': 7, 'crossings': 6, "'crisis": 5, 'situation': 5, ...})</span></pre></div><div class="ab cl lt lu gp lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="hb hc hd he hf"><h2 id="8b2c" class="lo kd hi bd ke ma mb mc ki md me mf km iz mg mh kq jd mi mj ku jh mk ml ky ho bi translated">随时间变化</h2><p id="4ca8" class="pw-post-body-paragraph io ip hi iq b ir la it iu iv lb ix iy iz lc jb jc jd ld jf jg jh le jj jk jl hb bi translated">观察词频在八个月中的变化可能会很有趣，所以我建立了一个新的数据集，其中包含每月的字数:</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="12cd" class="lo kd hi lk b fi lp lq l lr ls">bag = df['title'].str.cat(sep = ' ')<br/>tokens = process(bag)<br/>word_df = pd.DataFrame.from_dict(dict(Counter(tokens)), orient='index', columns=['overall'])</span><span id="e7f9" class="lo kd hi lk b fi mz lq l lr ls"># create a custom merge<br/>def merge(original_df, frames):<br/>    out = original_df<br/>    for df in frames:<br/>        out = out.merge(df, how='left', left_index=True, right_index=True)<br/>    return out</span><span id="0fc6" class="lo kd hi lk b fi mz lq l lr ls">frames = []<br/>for time in df['month_year'].unique()[::-1]: # in reverse (chronological) order<br/>    df_subset = foxnews[foxnews['month_year']==time].copy()<br/>    bag = df_subset['title'].str.cat(sep = ' ')<br/>    tokens = process(bag)<br/>    frames.append(pd.DataFrame.from_dict(dict(Counter(tokens)), orient='index', columns=[str(time)]))</span><span id="2119" class="lo kd hi lk b fi mz lq l lr ls">end_df = merge(word_df, frames)<br/>end_df = end_df.fillna(0)</span></pre><figure class="lf lg lh li fd mn er es paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="er es ni"><img src="../Images/3df4068675f3d9cd9fbd2cda1df91b17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R7iq8ljMMsxhHrMLEdMZVA.png"/></div></div><figcaption class="nj nk et er es nl nm bd b be z dx translated">输出范围</figcaption></figure><p id="1e7d" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">虽然这样的数据集适合逐月比较，但在Tableau中可视化和动画化变化时，长格式会更方便—因此转换为:</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="ad7d" class="lo kd hi lk b fi lp lq l lr ls">df_long_temp = end_df.drop(columns='overall').reset_index()<br/>df_long = pd.melt(df_long_temp,id_vars=['index'],var_name='year', value_name='frequency')</span></pre><figure class="lf lg lh li fd mn er es paragraph-image"><div class="er es nn"><img src="../Images/20d73300e83c2b735f8229eb8a89cd2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:884/format:webp/1*V5ddRpgcm5xxm3lyJZ2zMg.png"/></div><figcaption class="nj nk et er es nl nm bd b be z dx translated">输出—长型</figcaption></figure><p id="82cc" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">这里有一个关于如何在Tableau 中制作可视化动画的有用资源。</p><figure class="lf lg lh li fd mn er es paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="er es no"><img src="../Images/e62131959847ccf0e48bc8da12a71dd3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*ZpiSJIXka6ljDuurXJlXDg.gif"/></div></div><figcaption class="nj nk et er es nl nm bd b be z dx translated">时间的动画变化(我希望它为你而动)</figcaption></figure><p id="d60f" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">我们看到，从选举月开始，拜登的提及率迅速攀升，“特朗普”在3月份完全退出了名单，而对移民儿童的关注随着“边境”而激增。</p><figure class="lf lg lh li fd mn er es paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="er es no"><img src="../Images/5ed86f87406e56269758618379a72754.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*Ao3KBLlaLlL_QBUlx1NT_A.gif"/></div></div><figcaption class="nj nk et er es nl nm bd b be z dx translated">时间的动画变化(我希望它为你而动)</figcaption></figure><p id="7d94" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">像CNN一样，“拜登”自选举以来一直领先，但直到2021年初，随着“危机”和“增兵”开始占据头条，人们的兴趣才开始增加。</p></div><div class="ab cl lt lu gp lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="hb hc hd he hf"><h2 id="39ef" class="lo kd hi bd ke ma mb mc ki md me mf km iz mg mh kq jd mi mj ku jh mk ml ky ho bi translated">文章中的关键词</h2><p id="83d9" class="pw-post-body-paragraph io ip hi iq b ir la it iu iv lb ix iy iz lc jb jc jd ld jf jg jh le jj jk jl hb bi translated">为了查看哪些词在文章中可能承载更多的含义，我再次使用了TF-IDF，它以鸟瞰的方式考虑了一个术语在文档中的重要性(在本例中是一篇特定的新闻文章)及其在整个语料库中的重要性，太常见的词权重较小。我还加入了词干。</p><p id="2ffd" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">当然，有许多不同的方法可以做到这一点，但在这里，我试图汇集所有文章中的前十个关键词(根据其TF-IDF权重排序)，以比较每个出版物的总体词汇的差异。</p><figure class="lf lg lh li fd mn"><div class="bz dy l di"><div class="mw mx l"/></div></figure><p id="21fb" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">由此，我们可以看出关键词的共性:</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="5c92" class="lo kd hi lk b fi lp lq l lr ls">set(fn_content_words).intersection(set(cnn_content_words))</span><span id="9d8b" class="lo kd hi lk b fi mz lq l lr ls"># word endings altered due to stemming<br/>{'administr', #administration<br/> 'biden',<br/> 'bill',<br/> 'children',<br/> 'democrat',<br/> 'facil', # facilities<br/> 'ice',<br/> 'mayorka',<br/> 'mexico',<br/> 'migrant',<br/> 'polic', # policy<br/> 'polici', # policies<br/> 'presid', # president<br/> 'republican',<br/> 'senat', # senate<br/> 'trump',<br/> 'unaccompani', # unaccompanied<br/> 'wolf'} # Chad Wolf</span></pre><p id="b5f3" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">要看到一个人采用而另一个人没有采用的单词，我们可以使用—</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="adbd" class="lo kd hi lk b fi lp lq l lr ls">set(fn_content_words).difference(set(cnn_content_words))<br/>set(cnn_content_words).difference(set(fn_content_words))</span></pre><p id="08f3" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">从上面的分析中可以看出，福克斯新闻频道独有的关键词包括逮捕、大篷车、非法、华尔街、墨西哥以及亚利桑那州和得克萨斯州等多个州，而CNN经常使用美国人、黑人、中国人、白人、拉丁美洲人、妇女、运动、抗议和工人，这些词没有出现在福克斯新闻频道的热门词汇中。</p><p id="009c" class="pw-post-body-paragraph io ip hi iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl hb bi translated">下一步，可以尝试情感分析、主题建模或更详细的内容分析，如比较实体/专有名词、情态动词、引语或词汇多样性。让乐趣继续！</p></div></div>    
</body>
</html>