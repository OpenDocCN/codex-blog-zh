<html>
<head>
<title>Pressure Stall Information on CentOS7</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">CentOS7上的压力失速信息</h1>
<blockquote>原文：<a href="https://medium.com/codex/pressure-stall-information-on-centos7-a286fe23adea?source=collection_archive---------9-----------------------#2021-08-26">https://medium.com/codex/pressure-stall-information-on-centos7-a286fe23adea?source=collection_archive---------9-----------------------#2021-08-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/e545097154b827c6b4220d4873c8d663.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Dw7Jm6BTUUNy7cOU"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">照片由<a class="ae iu" href="https://unsplash.com/@clark_fransa?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">阿诺德·弗朗西斯卡</a>在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</figcaption></figure><p id="c98c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我正在运行数据库，知道压力是在CPU、RAM还是I/O上至关重要，这并不容易从CloudWatch或操作系统日常监控中提供的指标中推断出来。最近的Linux内核为此提供了PSI(压力失速信息),所以让我们启用它。</p><p id="0ebf" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我有从<br/>AWS-market place/CentOS Linux 7映像供应的EC2实例，但CentOS运行速度不快，而且内核较旧:</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="ddde" class="kc kd hi jy b fi ke kf l kg kh">[yugabyte]$ cat /etc/system-release</span><span id="ff53" class="kc kd hi jy b fi ki kf l kg kh">CentOS Linux release 7.4.1708 (Core)</span><span id="0e5a" class="kc kd hi jy b fi ki kf l kg kh">[yugabyte]$ uname --kernel-release</span><span id="3908" class="kc kd hi jy b fi ki kf l kg kh">3.10.0-693.5.2.el7.x86_64</span></pre><p id="8080" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我需要一个更新的版本，我将从<a class="ae iu" href="http://elrepo.org/tiki/HomePage" rel="noopener ugc nofollow" target="_blank"> ELRepo </a>安装</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="381c" class="kc kd hi jy b fi ke kf l kg kh">[yugabyte]$ sudo yum update -y</span><span id="5917" class="kc kd hi jy b fi ki kf l kg kh">No packages marked for update</span><span id="c60f" class="kc kd hi jy b fi ki kf l kg kh">[yugabyte]$ sudo yum install -y <a class="ae iu" href="https://www.elrepo.org/elrepo-release-7.el7.elrepo.noarch.rpm" rel="noopener ugc nofollow" target="_blank">https://www.elrepo.org/elrepo-release-7.el7.elrepo.noarch.rpm</a></span></pre><p id="685c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在列出主线内核(“ml”是长期“lt”的反义词):</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="bdc4" class="kc kd hi jy b fi ke kf l kg kh">[yugabyte]$ yum list available --disablerepo='*' --enablerepo=elrepo-kernel kernel-ml.x86_64</span><span id="3ca4" class="kc kd hi jy b fi ki kf l kg kh">Loaded plugins: fastestmirror<br/>Loading mirror speeds from cached hostfile<br/> * elrepo-kernel: mirrors.coreix.net<br/>Available Packages<br/>kernel-ml.x86_64                                                5.13.12-1.el7.elrepo                                                 elrepo-kernel</span></pre><p id="23ee" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">并安装它:</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="0f8e" class="kc kd hi jy b fi ke kf l kg kh">[yugabyte]$ sudo yum --enablerepo=elrepo-kernel install -y kernel-ml</span></pre><p id="ef0b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这是grub的第一个菜单项:</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="44c6" class="kc kd hi jy b fi ke kf l kg kh">[centos]$ sudo grep ^menuentry /boot/grub2/grub.cfg</span><span id="90ba" class="kc kd hi jy b fi ki kf l kg kh">menuentry 'CentOS Linux (5.13.12-1.el7.elrepo.x86_64) 7 (Core)' --class centos --class gnu-linux --class gnu --class os --unrestricted $menuentry_id_option 'gnulinux-3.10.0-693.5.2.el7.x86_64-advanced-6f15c206-f516-4ee8-a4b7-89ad880647db' {<br/>menuentry 'CentOS Linux (3.10.0-1160.36.2.el7.x86_64) 7 (Core)' --class centos --class gnu-linux --class gnu --class os --unrestricted $menuentry_id_option 'gnulinux-3.10.0-693.5.2.el7.x86_64-advanced-6f15c206-f516-4ee8-a4b7-89ad880647db' {<br/>menuentry 'CentOS Linux (3.10.0-693.5.2.el7.x86_64) 7 (Core)' --class centos --class gnu-linux --class gnu --class os --unrestricted $menuentry_id_option 'gnulinux-3.10.0-693.5.2.el7.x86_64-advanced-6f15c206-f516-4ee8-a4b7-89ad880647db' {<br/>menuentry 'CentOS Linux (0-rescue-f073c429a7456b53ec3e2c53460c5c8f) 7 (Core)' --class centos --class gnu-linux --class gnu --class os --unrestricted $menuentry_id_option 'gnulinux-0-rescue-f073c429a7456b53ec3e2c53460c5c8f-advanced-6f15c206-f516-4ee8-a4b7-89ad880647db' {</span></pre><p id="7dee" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我将它设为默认设置(menuentry 0):</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="a3e0" class="kc kd hi jy b fi ke kf l kg kh">[yugabyte]$ sudo sed -e '/^GRUB_DEFAULT=saved/s/=.*/=0/' -i /etc/default/grub</span></pre><p id="a763" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我需要在内核命令行中添加<code class="du kj kk kl jy b">psi</code>:</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="0e2b" class="kc kd hi jy b fi ke kf l kg kh">[yugabyte]$ sudo mkdir -p /etc/tuned/psi &amp;&amp; sudo tee /etc/tuned/psi/tuned.conf &lt;&lt;'TAC'</span><span id="d6ad" class="kc kd hi jy b fi ki kf l kg kh">[main]<br/>  summary=Enable Pressure Stall Information as in https://dev.to/aws-heroes/pressure-stall-information-on-ec2-centos-7-2nbb-temp-slug-5559720<br/>[bootloader]<br/>cmdline=psi=1</span><span id="77cf" class="kc kd hi jy b fi ki kf l kg kh">TAC</span></pre><p id="4ad3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">正在检查当前配置文件:</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="53b4" class="kc kd hi jy b fi ke kf l kg kh">[yugabyte]$ tuned-adm profile<br/>Current active profile: virtual-guest</span></pre><p id="9892" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">添加新的:</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="3381" class="kc kd hi jy b fi ke kf l kg kh">[yugabyte]$ sudo tuned-adm profile virtual-guest psi</span></pre><p id="7f75" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">启用所有这些GRUB更改:</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="81aa" class="kc kd hi jy b fi ke kf l kg kh">[yugabyte]$ sudo grub2-mkconfig -o /boot/grub2/grub.cfg</span></pre><p id="bc1d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在准备重新启动节点。这就是我欣赏运行分布式数据库的地方(YugabyteDB🚀)因为我可以在不中断应用程序的情况下滚动重启节点。</p><p id="4c01" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">正在检查:</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="f704" class="kc kd hi jy b fi ke kf l kg kh">[yugabyte]$ tail /proc/pressure/*</span><span id="c816" class="kc kd hi jy b fi ki kf l kg kh">==&gt; /proc/pressure/cpu &lt;==<br/>some avg10=27.80 avg60=25.88 avg300=16.13 total=77572758<br/>full avg10=0.98 avg60=0.94 avg300=0.55 total=4422080</span><span id="28b8" class="kc kd hi jy b fi ki kf l kg kh">==&gt; /proc/pressure/io &lt;==<br/>some avg10=12.03 avg60=13.02 avg300=7.36 total=32530366<br/>full avg10=4.73 avg60=5.33 avg300=3.08 total=15034660</span><span id="d9a7" class="kc kd hi jy b fi ki kf l kg kh">==&gt; /proc/pressure/memory &lt;==<br/>some avg10=0.12 avg60=0.02 avg300=0.00 total=309168<br/>full avg10=0.12 avg60=0.02 avg300=0.00 total=307455</span></pre><p id="935a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在还有待解释。我在过去的博客文章中解释了一点，在关于www.kernel.org的<a class="ae iu" href="https://www.kernel.org/doc/html/latest/accounting/psi.html" rel="noopener ugc nofollow" target="_blank">和</a>中有完整的描述。基本上,“some”行显示了在过去的10秒、1分钟和5分钟内，一个任务被停止的时间百分比，以及当所有非空闲任务都在等待时的“full”。所以如果你觉得某个东西很慢，应该更快，不要盲目伸缩。您知道哪个资源负责响应时间。</p></div></div>    
</body>
</html>