# SANS Top 25 软件错误(第 2 部分，共 25 部分):CWE-79 在网页生成(跨站点脚本)期间不正确地消除输入

> 原文：<https://medium.com/codex/sans-top-25-software-errors-part-2-of-25-cwe-79-improper-neutralization-of-input-during-web-page-65917586e2a6?source=collection_archive---------8----------------------->

![](img/eb9d04bfec46d6188384ed2740b8520e.png)

# 介绍

攻击者使用跨站点脚本(XSS)将恶意代码注入受害者的 web 浏览器。通过在合法网页或应用程序中包含恶意代码，攻击者试图在受害者的 web 浏览器上执行恶意脚本。一旦受害者访问恶意网页或 web 应用程序，攻击就会发生。脚本通过网页或 web 应用程序传送到浏览器。允许评论的论坛、留言板和网页通常被用作跨站点脚本攻击的载体。

如果网页或 web 应用程序的输出包含未组织的用户输入，则容易受到 XSS 的影响。受害者的浏览器必须解析这个用户输入。除了 JavaScript、ActiveX、Flash 和 CSS 之外，XSS 攻击在这些应用程序中也是可能的。然而，由于 JavaScript 在大多数浏览体验中的重要性，最常见的 XSS 攻击发生在 JavaScript 中。

# 对用户的影响

如果攻击者能够利用该网站或易受攻击的 web 应用程序上的 XSS 漏洞来执行任意 JavaScript，那么该易受攻击的网站或易受攻击的 web 应用程序及其用户的安全性就会受到损害。像 XSS 这样的安全漏洞不是用户的错。如果它影响了你的用户，它也会影响你。攻击者还可能使用跨站点脚本来破坏网站，而不是针对用户。通过注入脚本，他们可以改变网站的内容，甚至将用户流量重定向到恶意网站。

# 跨站点脚本的类型

## 1.存储的 XSS

将恶意内容(称为有效负载)注入目标应用程序(称为存储的 XSS)是最具破坏性的一种 XSS。通常，JavaScript 代码被用作有效负载。如果不执行输入验证，目标应用程序会将该恶意代码存储在数据库中(持久化)。

例如，攻击者可能将恶意脚本插入用户输入字段，如博客或论坛帖子上的评论。作为 HTML 代码的一部分(就像合法的注释一样)，当受影响的网页在受害者的浏览器中被查看时，攻击有效载荷被提供给受害者的浏览器。一旦恶意脚本在受害者的浏览器中执行，就会被执行。

## 2.反映了 XSS

当恶意脚本从网站反射到受害者的浏览器上时，它们被称为反射 XSS 攻击，也称为非持续性攻击。通过单击该链接，恶意脚本将在具有允许执行恶意脚本的漏洞的网站上执行。当传入的请求没有得到充分的净化时，web 应用程序就容易受到攻击，这就有可能操纵其功能并激活恶意脚本。

犯罪者通常会在电子邮件或第三方网站(如评论区或社交媒体)中嵌入恶意链接进行分发。当用户点击锚文本中嵌入的链接时，就会暴露在 XSS 攻击之下，这会导致 XSS 请求被发送到被利用的网站。

## 3.基于 DOM 的 XSS

基于 DOM 的 XSS 是 XSS 的高级形式。如果用户向 DOM 提供数据，web 应用程序的客户端脚本可以访问 DOM(文档对象模型)。数据随后由 web 应用程序读取，并从 DOM 输出到浏览器。由于不正确的数据处理，攻击者可以注入一个有效载荷，该载荷将被合并到 DOM 中，并在被读回时执行。

基于 DOM 的 XSS 攻击中的恶意负载很少发送到服务器，这使得 Web 应用程序防火墙(WAF)更难检测，安全工程师更难分析服务器日志来识别攻击。文档。URL、location.hash 和 document.referrer 是最常操作的 DOM 对象。

# XSS 的测试

XSS 漏洞有多种类型，其中 90%以上可以使用 web 漏洞扫描器发现。通过确定 XSS 的上下文，您可以选择合适的有效负载来利用它。然而，还有许多其他类型的多姆 XSS 可用。通常，对反射 XSS 的测试包括向应用程序的所有入口点提交一些独特的输入(如简短的字母数字字符串)，识别 HTTP 响应中返回输入的每个位置，并单独测试所有这些位置，以查看适当制作的输入是否可以执行任意 JavaScript。

基于 DOM 的 XSS 也可以手动测试，方法是在 URL 参数中放置一些文本，在 DOM 中搜索这些文本，然后测试每个位置以确定它是否可以被利用。如果您想在不使用 URL 的输入或接收(如 document.cookie)或不使用 HTML 的接收(如 setTimeout)中找到基于 DOM 的漏洞，那么没有什么可以替代审查 JavaScript 代码。通过静态和动态 JavaScript 分析，web 漏洞扫描程序可以可靠地自动检测基于 DOM 的漏洞。

# 预防

跨站点脚本(XSS)很难防止。您可以根据漏洞的类型、发生的环境和编程框架来防止 XSS。为了保证 web 应用程序的安全，您应该遵循一些通用的策略原则。

## 步骤 1:通过培训和维护来保持意识

XSS 漏洞应该让每个在 web 应用程序上工作的人都知道，以确保它的安全。开发人员、QA 人员、开发人员和系统管理员应该接受适当的安全培训。

## 第二步:用户的输入不应该被信任

经过身份验证的输入和/或内部输入应与公共输入同等对待。如果使用任何用户输入来创建 HTML 输出，请使用一对一的方法。

## 步骤 3:建议使用转义/编码

可以使用 HTML 转义、JavaScript 转义、CSS 转义、URL 转义等。，这取决于用户输入的使用位置。避免编写自己的转义库。

## 步骤 4: HTML 应该被净化

您不能对包含 HTML 的用户输入进行转义/编码，因为这会破坏有效的标签。要在这种情况下解析和清理 HTML，请选择一个可信且经过验证的库。您可以将 HtmlSanitizer 用于。NET 或 SanitizeHelper for Ruby on Rails，这取决于您的开发语言。

## 步骤 5:应该设置 HttpOnly 标志

为 cookies 设置 HttpOnly 标志，以减轻可能的 XSS 漏洞的影响。通过这样做，JavaScript 客户端将无法访问此类 cookies。

## 步骤 6:应该对内容使用安全策略

您还可以使用内容安全策略(CSP)来减轻 XSS 漏洞的后果。CSP 是 HTTP 响应头，它根据请求源声明可以加载哪些动态资源。

## 步骤 7:维护定期扫描计划

web 漏洞扫描器应该定期在您的 web 应用程序上运行。如果你使用 Jenkins，它应该作为插件安装，这样每个版本都会被自动扫描。如果您使用外部库、模块和软件，XSS 漏洞也可能由您的开发人员引入。