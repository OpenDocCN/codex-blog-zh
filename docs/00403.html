<html>
<head>
<title>Using Optional’s map with Void functions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将可选的贴图与空函数一起使用</h1>
<blockquote>原文：<a href="https://medium.com/codex/using-optional-map-with-void-functions-2c758f5cbf19?source=collection_archive---------4-----------------------#2021-01-28">https://medium.com/codex/using-optional-map-with-void-functions-2c758f5cbf19?source=collection_archive---------4-----------------------#2021-01-28</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="9426" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">许多swift开发人员都知道，任何没有明确指定返回类型的函数都将返回<code class="du jd je jf jg b">Void</code>。</p><p id="07d3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通常，忽略返回类型会产生以下警告:</p><figure class="ji jj jk jl fd jm er es paragraph-image"><div role="button" tabindex="0" class="jn jo di jp bf jq"><div class="er es jh"><img src="../Images/75315afb3c68569f7adf81ad45e4a676.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_GA_n8agRVJTj2O-kkKKpQ.png"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx translated">忽略函数的返回类型</figcaption></figure><p id="4eb3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然而，对于返回<code class="du jd je jf jg b">Void</code>的函数来说就不是这样了(否则我们会到处都是警告！)使用<code class="du jd je jf jg b">@discardableResult</code>注释时，这一点变得很明显:</p><figure class="ji jj jk jl fd jm er es paragraph-image"><div role="button" tabindex="0" class="jn jo di jp bf jq"><div class="er es jx"><img src="../Images/f2cc70e05281824528ea8e6ca5e5e15f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UkrG1QoWVq6Gm3wWNmm7gA.png"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx translated">默认情况下，可以放弃无效结果</figcaption></figure><p id="f4a1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这最终意味着以下两个函数是等价的:</p><pre class="ji jj jk jl fd jy jg jz ka aw kb bi"><span id="dbc5" class="kc kd hi jg b fi ke kf l kg kh">func doSomething() -&gt; Void {<br/>    ...<br/>}</span><span id="3254" class="kc kd hi jg b fi ki kf l kg kh">func doSomething() { <br/>    ...<br/>}</span></pre><p id="99f7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">另一个有趣的事实是<code class="du jd je jf jg b">Void?</code>也不会产生任何警告。这对于可选链接是必要的，因为可选链接的<code class="du jd je jf jg b">Void</code>功能是<code class="du jd je jf jg b">Void?</code>。如果不是这种情况，下面将出现一个错误:</p><pre class="ji jj jk jl fd jy jg jz ka aw kb bi"><span id="4a03" class="kc kd hi jg b fi ke kf l kg kh">let myType: MyType? = MyType()</span><span id="b65b" class="kc kd hi jg b fi ki kf l kg kh">myType?.doSomething()</span></pre><p id="6dfb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du jd je jf jg b">Void</code>的这些特性结合起来提供了<code class="du jd je jf jg b">Optional.map(_:)</code>的一种不寻常但却很方便的用法。当我们检查<code class="du jd je jf jg b">map</code>函数时，我们看到返回类型与<code class="du jd je jf jg b">transform</code>闭包的返回类型相同，只是包装在一个<code class="du jd je jf jg b">Optional</code>中。</p><pre class="ji jj jk jl fd jy jg jz ka aw kb bi"><span id="2ac0" class="kc kd hi jg b fi ke kf l kg kh">func map&lt;U&gt;(_ transform: (Wrapped) throws -&gt; U) rethrows -&gt; U?</span></pre><p id="1fca" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们知道，如果transform函数返回<code class="du jd je jf jg b">Void</code>，那么<code class="du jd je jf jg b">map</code>将返回<code class="du jd je jf jg b">Void?</code>，可以安全地忽略它。因此，下面的代码完全有效，并且不显示任何警告:</p><pre class="ji jj jk jl fd jy jg jz ka aw kb bi"><span id="5451" class="kc kd hi jg b fi ke kf l kg kh">func doSomething(_ message: String) {<br/>    ...<br/>}</span><span id="94fe" class="kc kd hi jg b fi ki kf l kg kh">let message: String? = "Hello, World!"</span><span id="ce91" class="kc kd hi jg b fi ki kf l kg kh">message.map(doSomething)</span></pre><p id="e019" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这比如下所示的替代方案节省了几行代码:</p><pre class="ji jj jk jl fd jy jg jz ka aw kb bi"><span id="ba09" class="kc kd hi jg b fi ke kf l kg kh">func doSomething(_ message: String) {<br/>    ...<br/>}</span><span id="e433" class="kc kd hi jg b fi ki kf l kg kh">let message: String? = "Hello, World!"</span><span id="c57b" class="kc kd hi jg b fi ki kf l kg kh">if let message = message {<br/>    doSomething(value: message)<br/>}</span></pre></div></div>    
</body>
</html>