<html>
<head>
<title>Checking and Booking of Internet services. Automatically.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">互联网服务的检查和预订。自动地。</h1>
<blockquote>原文：<a href="https://medium.com/codex/checking-and-booking-of-internet-services-automatically-a5163395aec9?source=collection_archive---------5-----------------------#2021-06-19">https://medium.com/codex/checking-and-booking-of-internet-services-automatically-a5163395aec9?source=collection_archive---------5-----------------------#2021-06-19</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ih ii ij ik er es paragraph-image"><div role="button" tabindex="0" class="il im di in bf io"><div class="er es ig"><img src="../Images/a220fd21c5276c8461a69b51111297fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*10mKhKKeCozmLZv3RkAKLg.jpeg"/></div></div></figure><pre class="ir is it iu fd iv iw ix iy aw iz bi"><span id="7c39" class="ja jb hi iw b fi jc jd l je jf"><strong class="iw hj">Table of Contents</strong><br/>-<a class="ae jg" href="#b5cc" rel="noopener ugc nofollow">Motivation</a><br/>-<a class="ae jg" href="#71b2" rel="noopener ugc nofollow">Technique Design</a><br/>---<a class="ae jg" href="#e7ec" rel="noopener ugc nofollow">Checking for available slots</a><br/>---<a class="ae jg" href="#3f79" rel="noopener ugc nofollow">Booking the slot automatically</a><br/>-<a class="ae jg" href="#a538" rel="noopener ugc nofollow">Features</a><br/>-<a class="ae jg" href="#ad53" rel="noopener ugc nofollow">Limitations</a><br/>-<a class="ae jg" href="#5d70" rel="noopener ugc nofollow">Conclusion</a></span></pre><h1 id="b5cc" class="jh jb hi bd ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd bi translated">动机</h1><p id="d5f2" class="pw-post-body-paragraph ke kf hi kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">如果在德国居住的时间比游客停留的时间长，我们很快就会意识到，我们将需要访问一个德国机构，如<a class="ae jg" href="https://de.wikipedia.org/wiki/Bürgeramt" rel="noopener ugc nofollow" target="_blank"><em class="lc">bürger AMT</em></a><em class="lc"/>(“公民办公室”)，办理类似<a class="ae jg" href="https://allaboutberlin.com/glossary/Anmeldung" rel="noopener ugc nofollow" target="_blank"><em class="lc">Anmeldung</em></a><em class="lc"/>(居住地登记)的文书工作。许多地方要求我们在网上预约，通常情况下，几个月之后才有空位，而你仍然必须在<a class="ae jg" href="https://www.gesetze-im-internet.de/englisch_bmg/englisch_bmg.html#p0184" rel="noopener ugc nofollow" target="_blank">前两周</a>注册。然而，好消息是在白天，一些机构开放一些新的位置；或者某人，已经有一个时间段，不能去，所以他们必须取消约会；因此，相应的空位可再次预订。</p><p id="da52" class="pw-post-body-paragraph ke kf hi kg b kh ld kj kk kl le kn ko kp lf kr ks kt lg kv kw kx lh kz la lb hb bi translated">问题是你不知道如此宝贵的时间窗口何时会出现，而且必须在其他人之前立即预订。如果有一个机器人持续查看预约网站<em class="lc"> 24/7 </em>并开始快速预约时段<em class="lc">就好了</em> : <em class="lc">先看</em>和<em class="lc">先预约</em>。没有人愿意浪费时间去做这种无聊的任务。</p><p id="4846" class="pw-post-body-paragraph ke kf hi kg b kh ld kj kk kl le kn ko kp lf kr ks kt lg kv kw kx lh kz la lb hb bi translated">然后Python和<a class="ae jg" href="https://en.wikipedia.org/wiki/Selenium_(software)" rel="noopener ugc nofollow" target="_blank"> Selenium </a>出现在我的脑海里，提出了一个可能的解决方案。我们开始吧！</p><h1 id="71b2" class="jh jb hi bd ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd bi translated">技术设计</h1><p id="90ab" class="pw-post-body-paragraph ke kf hi kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">任何网站应用程序都可以被分解到前端——用户在浏览器中看到的；后端——接收来自前端javascript的Restful API调用，并提供数据或执行命令。我们会<strong class="kg hj"> <em class="lc">多半是</em> </strong>尽量模仿用户的典型动作:<strong class="kg hj">打开一个浏览器，在网站上看到X，相应地做y </strong>。这种重复的步骤会一直重复，直到用户满意为止。(尽管有一种<em class="lc">更有效的方法</em>，例如拦截并理解<em class="lc">正确的</em> Restful API调用，但这种方法被认为容易出错，因为这些调用背后的逻辑很复杂，而且可能会频繁更改。尽管如此，我们还是有选择地使用<em class="lc">这一招</em>。)</p><p id="4a52" class="pw-post-body-paragraph ke kf hi kg b kh ld kj kk kl le kn ko kp lf kr ks kt lg kv kw kx lh kz la lb hb bi translated">我将在这个网站上演示这个实验，而不是为安梅尔登预约一个时间段:https://web.daslab.app/和T2，在这里可以预约一个检验或疫苗接种。在我的<em class="lc">个人案例</em>中，特定一天的特定时间，接种槽快速可用；然后“<a class="ae jg" href="https://www.merriam-webster.com/dictionary/first%20come%2C%20first%20served" rel="noopener ugc nofollow" target="_blank">先到先得</a>”。不用多说，槽位可惜有限！</p><p id="53f5" class="pw-post-body-paragraph ke kf hi kg b kh ld kj kk kl le kn ko kp lf kr ks kt lg kv kw kx lh kz la lb hb bi translated">我的Github代码可以在这里<a class="ae jg" href="https://github.com/ThachNgocTran/AutomaticWebsiteBooking" rel="noopener ugc nofollow" target="_blank">查看</a>。</p><h2 id="e7ec" class="ja jb hi bd ji li lj lk jm ll lm ln jq kp lo lp ju kt lq lr jy kx ls lt kc lu bi translated">正在检查可用的插槽</h2><p id="cd2e" class="pw-post-body-paragraph ke kf hi kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">我们来考虑一下订票站:<a class="ae jg" href="https://web.daslab.app/book/location/1181" rel="noopener ugc nofollow" target="_blank">法兰克福电晕测试站</a>。</p><figure class="ir is it iu fd ik er es paragraph-image"><div role="button" tabindex="0" class="il im di in bf io"><div class="er es lv"><img src="../Images/6fac92b2f69737d4a184999592e013fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5QqfxDKlgWJJNk7KJ7j68g.jpeg"/></div></div></figure><p id="1268" class="pw-post-body-paragraph ke kf hi kg b kh ld kj kk kl le kn ko kp lf kr ks kt lg kv kw kx lh kz la lb hb bi translated">当访问这个网站时，在Chrome开发者工具的网络标签中，一个Restful API被调用来获取可用的日期和日期的预定时段。所以理论上，<em class="lc">每隔10秒定期调用这个API，我们就知道是否有可用的槽</em>。<strong class="kg hj">注意</strong>:在<a class="ae jg" href="https://en.wikipedia.org/wiki/Web_scraping" rel="noopener ugc nofollow" target="_blank">刮网</a>时要有礼貌；否则，冒着你的IP被禁的风险！我觉得1秒太咄咄逼人，而60秒可能太长了。</p><h2 id="3f79" class="ja jb hi bd ji li lj lk jm ll lm ln jq kp lo lp ju kt lq lr jy kx ls lt kc lu bi translated">自动预约时段</h2><p id="cd2d" class="pw-post-body-paragraph ke kf hi kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">在一个网站上，我们如何知道这是我们想要访问的网站？我们经常寻找“签名”——在特定网站上独一无二的东西，比如标题，或者特定Web元素的外观。例如，在这个网站上，这个标题表示页面内容:</p><figure class="ir is it iu fd ik er es paragraph-image"><div role="button" tabindex="0" class="il im di in bf io"><div class="er es lw"><img src="../Images/ed82e1282f93f6bedd18fbb634e6fa0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_E0rqAyASVGyllvXR6aOCQ.jpeg"/></div></div></figure><p id="839b" class="pw-post-body-paragraph ke kf hi kg b kh ld kj kk kl le kn ko kp lf kr ks kt lg kv kw kx lh kz la lb hb bi translated">“检查”这个web元素，我们希望通过使用<a class="ae jg" href="https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Selectors" rel="noopener ugc nofollow" target="_blank"> CSS选择器</a>来识别这个独特的元素。这通常要求我们使用CSS选择器，并使用开发人员工具控制台仔细检查:</p><figure class="ir is it iu fd ik er es paragraph-image"><div role="button" tabindex="0" class="il im di in bf io"><div class="er es lx"><img src="../Images/698c588408f982204db5c97841546292.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Jc3TAfh9SiliG0wtZqhqCA.jpeg"/></div></div></figure><p id="4c63" class="pw-post-body-paragraph ke kf hi kg b kh ld kj kk kl le kn ko kp lf kr ks kt lg kv kw kx lh kz la lb hb bi translated">有时，我们无法找出一个CSS选择器来精确定位Web元素；相反，只有一个相关Web元素的列表，<em class="lc">其中一个</em>是我们的目标元素。在这种情况下，需要进一步的用户定义操作来缩小到一个Web元素。(代码中是<code class="du ly lz ma iw b">action_filter</code>参数)。</p><p id="2a70" class="pw-post-body-paragraph ke kf hi kg b kh ld kj kk kl le kn ko kp lf kr ks kt lg kv kw kx lh kz la lb hb bi translated">在识别出想要的页面后，我们进入<em class="lc">查看-这-做-那步骤</em>。例如，用这个CSS选择器找到一个Web元素，然后单击。</p><pre class="ir is it iu fd iv iw ix iy aw iz bi"><span id="262a" class="ja jb hi iw b fi jc jd l je jf">{<br/>    "css_expected": "div[data-cy='confirm-and-pay-button'] &gt; a",<br/>    "action": "click"<br/>}</span></pre><p id="0cf5" class="pw-post-body-paragraph ke kf hi kg b kh ld kj kk kl le kn ko kp lf kr ks kt lg kv kw kx lh kz la lb hb bi translated">另一个例子，用这个CSS选择器找到一个Web元素，然后输入。</p><pre class="ir is it iu fd iv iw ix iy aw iz bi"><span id="fbbb" class="ja jb hi iw b fi jc jd l je jf">{<br/>    "css_expected": "input[type='text']",<br/>    "action": "enter",<br/>    "enter_what": "UYUHFHFSU75"<br/>}</span></pre><p id="cb36" class="pw-post-body-paragraph ke kf hi kg b kh ld kj kk kl le kn ko kp lf kr ks kt lg kv kw kx lh kz la lb hb bi translated">这意味着在前进的道路上不应该有未知的一步。一个登录对话框通常做<em class="lc">一次</em>；所以最好提前登录网站<em class="lc"/>。所以下一次，当浏览器访问网站时，一切都以直截了当和预期的方式顺利进行。</p><p id="b1d6" class="pw-post-body-paragraph ke kf hi kg b kh ld kj kk kl le kn ko kp lf kr ks kt lg kv kw kx lh kz la lb hb bi translated">最后但并非最不重要的一点是，假设可用插槽的检查是一个长时间的持续过程，需要日夜运行。相比之下，预订一个可用的位置是一次性的，这意味着当在最后按下“确认”按钮时，如果有人已经预订了该位置怎么办？程序不会自动<em class="lc"/>开始预订<em class="lc">另一个可用的</em>空位。用户必须停止脚本并重新启动。</p><h1 id="a538" class="jh jb hi bd ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd bi translated">特征</h1><ul class=""><li id="878b" class="mb mc hi kg b kh ki kl km kp md kt me kx mf lb mg mh mi mj bi translated">该计划捕捉屏幕截图时，错误和完成。</li><li id="a84a" class="mb mc hi kg b kh mk kl ml kp mm kt mn kx mo lb mg mh mi mj bi translated">出错和完成时，程序会发出声音。当事情出乎意料时尤其有用，它会立刻引起你的注意。</li><li id="bfa2" class="mb mc hi kg b kh mk kl ml kp mm kt mn kx mo lb mg mh mi mj bi translated">自动化就像人类互动一样:<em class="lc">打开一个(Chrome)浏览器，访问一个网站，看这个，做那个，重复</em>。然而，整个过程很快，<em class="lc">轻松超过任何真实的人类互动</em>。</li></ul><h1 id="ad53" class="jh jb hi bd ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd bi translated">限制</h1><ul class=""><li id="0e39" class="mb mc hi kg b kh ki kl km kp md kt me kx mf lb mg mh mi mj bi translated">没有复杂的<a class="ae jg" href="https://en.wikipedia.org/wiki/Control_flow" rel="noopener ugc nofollow" target="_blank">流量控制</a>逻辑if-then-else。</li><li id="ca26" class="mb mc hi kg b kh mk kl ml kp mm kt mn kx mo lb mg mh mi mj bi translated">用户必须掌握一些关于HTML/Javascript和Python的知识。</li><li id="90ee" class="mb mc hi kg b kh mk kl ml kp mm kt mn kx mo lb mg mh mi mj bi translated">这不是面向未来的。也许后来，网站设计者决定改变他们的HTML代码，例如，网页元素id，网页元素层次结构。</li><li id="dd0e" class="mb mc hi kg b kh mk kl ml kp mm kt mn kx mo lb mg mh mi mj bi translated">不支持<a class="ae jg" href="https://en.wikipedia.org/wiki/CAPTCHA" rel="noopener ugc nofollow" target="_blank">验证码</a>。但这种情况可以通过定义一个新的动作来解决，除了“点击”和“输入”，例如“获取_人类_注意”，它会发出警报，显示一个消息框，等待人类手动完成该动作，然后继续。</li><li id="8076" class="mb mc hi kg b kh mk kl ml kp mm kt mn kx mo lb mg mh mi mj bi translated">插槽可用性检查是持久的；预约是一次性的。</li></ul><h1 id="5d70" class="jh jb hi bd ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd bi translated">结论</h1><p id="9345" class="pw-post-body-paragraph ke kf hi kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">该计划帮助我预订了一个Covid疫苗接种的可用位置，而没有让我从日常工作中分心。我知道这有点不公平。但这种做法并不新鲜，股票交易机器人就是一个例子。在日常生活中，我们越来越多地将许多事情自动化，最终提高了我们的整体生产力；只有在绝对必要的时候，人类才会介入。</p><p id="a837" class="pw-post-body-paragraph ke kf hi kg b kh ld kj kk kl le kn ko kp lf kr ks kt lg kv kw kx lh kz la lb hb bi translated">然而，让我夜不能寐的是“机器的战争”。事情可能发生得如此之快，以至于人在回路中可能是一种负担，而不是一种优势。在这一点上，我们只是让机器做它们应该做的事情，记住它们可能会造成灾难。</p></div></div>    
</body>
</html>