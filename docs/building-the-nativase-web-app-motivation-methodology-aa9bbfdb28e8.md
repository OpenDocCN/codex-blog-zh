# 构建 Nativase Web 应用程序——动机和方法

> 原文：<https://medium.com/codex/building-the-nativase-web-app-motivation-methodology-aa9bbfdb28e8?source=collection_archive---------10----------------------->

## [法典](http://medium.com/codex)

![](img/c9c53e72e44ad4198c351b4ca63955c2.png)

2021 年 2 月初，维基媒体数据中心收到的所有[请求](https://phabricator.wikimedia.org/T273741)中，有 20%是为了这张纽约紫菀(symphyotrichum novi-belgii)的原图，这是一种加拿大东部和美国东北部特有的开花植物。罪魁祸首:一个总部位于印度的手机应用程序请求了图片，但没有显示出来。来源:维基共享资源

> 然而，在我们带着我们的工具去陌生的地方之前，我们必须努力确定它不断变化的天气和风的情绪，了解那个地方的生活方式和习惯——在那里什么肯定会繁荣，什么会失败。
> 因为在这里你会发现一片庄稼，那里的葡萄长得密密麻麻，那边的小树茁壮成长，青草也自行变绿。
> 
> **——维吉尔的第二册*格奥尔基斯*(彼得·法伦译)**

**更新的 App:**[**https://nativore.shinyapps.io/main/**](https://nativore.shinyapps.io/main/)

**老年 App:**[**https://nativase.shinyapps.io/Nativase/**](https://nativase.shinyapps.io/Nativase/)

**Github:**[**https://github.com/liamtrotzuk/nativase**](https://github.com/liamtrotzuk/nativase)

在花了 6 个月的时间开发了一个 web 应用程序之后，我觉得是时候停下来反思一下我所学到的东西了——作为一个没有接受过正式软件开发培训或界面设计背景的人来说。总之:创建 web 应用程序是一个非常有趣的过程，我会向几乎所有人推荐它。选择正确的数据集和正确的演示，应用程序的实际构造基本上会自行解决，因为你会如此专注于你的项目，以至于任何障碍都可以通过足够的谷歌搜索和思考以最快的方式解决你面临的任何问题来克服。这是消磨空闲时间的好方法。

以下是我最初开发这个应用的动机的简短总结，以及我在开发过程中提炼的一个简单的 web 应用开发方法。

## 动机

像 2020 年的许多人一样，我一年中大部分时间都呆在室内。像许多人一样，我开始思考如何改善我突然开始花费大量时间的空间。一块新地毯也许不错；也许是墙上新刷的一层油漆；或许可以挂一件有趣的艺术品。但是当我考虑各种方法来照亮我的空间时，一个特别的选择开始支配我的想象力:有生命的家具。植物——绿色的、生长的东西填满了我的生活空间。花的分形让[舒缓了眼睛](https://around.uoregon.edu/content/study-finds-age-3-kids-prefer-natures-fractal-patterns)。走向[太阳能电池板](https://en.wikipedia.org/wiki/Solarpunk)的步骤。

不止我一个人。2020 年的疫情生活以及随之而来的美国大部分地区的社会距离导致了园艺和植物护理的空前繁荣。园艺中心和种子供应商经历了需求的急剧上升。由于担心 3 月/4 月杂货店的长队和空货架，未来的梭罗在疫情种植了“胜利花园”,至少为自己种植了一点食物，从而与现代超市的即时供应链稍微分离了一下。华尔街日报发表了一篇关于珍稀植物[火热交易的文章](https://www.wsj.com/articles/forget-the-stock-market-the-rare-plant-market-has-gone-bonkers-11600437284)。

像许多疫情的新植物父母一样，在我 2020 年之前的日子里，我从来没有成为一个超级“植物人”。我一直认为买植物(茎/叶/叶很脆弱)、种植(土壤很脏)和照料(室内植物需要小心浇水和晒太阳)都是不必要的琐事。但是，在过去的 12000 年里，种植东西一直是人类与生俱来的权利，并且在生命中以一种全新的、天真的眼光，比其他人晚一点接触一种爱好有一定的优势。对我来说，我开始仔细权衡不同类型园艺的成本和收益，从头开始规划。我会把植物种在花盆里还是窗户外面的盒子里？我会买成熟的植物还是从种子中生长？我考虑过在厨房里种植药草——罗勒、百里香、月桂叶。我曾想过种植中世纪时被用来制作强效药水的植物——鼠尾草、月桂树、致命的茄属植物。我考虑过购买或建造一个自动化的水培系统来种植圣女果或辣椒。

然后我开始思考美国榆树。

美国榆树是一种原产于美洲的榆树，特别是从佛罗里达到纽芬兰的北美东海岸。它们是能存活数百年的坚韧的树。它们也很漂亮:一片成熟的美国榆树林遮蔽了中央公园的林荫道，这是一条可爱的散步道，就在贝塞斯达喷泉的南面和绵羊草地的东面，在那里人们可以在那些古老的大树的阴影下愉快地散步。中央公园的这一部分被曼哈顿中城的摩天大楼所环绕，这给步行的人带来了一种独特的效果:周围都是雄伟的树木，步行者可能会忘记——哪怕只是一瞬间——他们是在一个巨大城市的核心，这个城市是大都会区 2000 万人的家园。但是，穿过环绕它们的美国榆树的有机树枝，步行者不可避免地会再次瞥见环绕公园的摩天大楼的高大整体形状，它们垂直切入四周的天空。这是一个很好的对比。

不幸的是，美洲榆也是一种濒临灭绝的物种，它曾经生长在从大西洋到密西西比的大片森林中，现在几乎无法在本土生存。罪魁祸首:荷兰榆树病，这是一种由榆树皮甲虫传播的真菌，起源于欧亚大陆，美国榆树对其没有自然防御。荷兰榆树病从一棵榆树蔓延到另一棵榆树，以惊人的速度烧毁了原生树木的森林。到 20 世纪末，曾经蔓延的美国榆树林已经减少到屈指可数的几片，主要集中在美国和加拿大城市的城市小树林里，在那里，在森林中肆虐的荷兰榆树病不容易传播。一片这样的小树林——世界上现存最大的美国榆树林之一——笼罩在纽约中央公园的林荫道上。

![](img/fb610bba09f5b0a4776583ced716f622.png)

纽约中央公园购物中心的美国榆树林。来源:维基共享资源

只要想一想这个事实，就会意识到它是多么的荒谬。现存的最大的美国榆树林之一并不在阿巴拉契亚山脉、密歇根上半岛或新斯科舍省的大片未开发的野生森林中，而是在美国最大的都市中心人口稠密的城市岛屿的正中心。

就像美国榆树一样，许多其他美国本土植物——以及依赖这些植物为食物的美国本土食草动物，以及依赖食草动物为食物的美国本土食肉动物——都受到严重威胁。

野马(*欧洲马)在广阔的西部草原上放牧。葛藤(*野葛*，来自亚洲)扼杀东部森林。狮子鱼(*翼龙*，来自印度太平洋)缠绕着加勒比海的暗礁。最近，日本杀人黄蜂在 2020 年春天抵达太平洋西北部，引起了生态领域以外的涟漪，因为人们担心这些入侵的黄蜂对蜂巢的毁灭性影响——这是公平的，除了普通蜜蜂本身不是本地的。北美的大部分蜂蜜是由欧洲蜜蜂生产的(尽管有几种特有的美国蜜蜂也生产蜂蜜——除了少数养蜂人之外，它们仍然没有被充分利用)。虽然欧洲蜜蜂面临着相当大的威胁——包括谋杀黄蜂和杀虫剂导致的蜂群衰竭失调——但本土蜜蜂物种面临着更可怕的威胁。阿根廷国立 Comahue 大学研究人员的一份报告强调，在所有记录在案的蜜蜂物种中，有整整 1/4 的物种在最近几年没有见过，这表明这些物种的数量急剧下降，甚至在某些情况下彻底灭绝。*

随着非本地生物的扩散，像美国榆树这样的本地生物也在扩散。道格拉斯·塔拉米是特拉华大学的生态学教授，也是生态文学领域的知名人物，他提倡种植本土物种，他在他的畅销书《纽约时报》中写道:“鸟类、植物和动物的数量——比如柯特兰莺和金颊莺、佛罗里达黑豹、大理石蝾螈、云杉松鸡、温克尔氏毯螈、卡尔纳蓝蝴蝶、猞猁、美洲山鸡、湖鲟、鸣鹤、加州秃鹰 西洋参、靛蓝蛇、whip-poor-will、Catesby's lily、佛罗里达灌木松鸦、数十种鱼类和贻贝物种以及许多许多其他物种的数量变得太少，无法发挥其重要的生态作用或抵御正常的环境挑战。” 大多数生态学家认为，本地动物的减少与本地植物的减少直接相关。

在更个人的层面上，纽约市——我的家乡——是生物多样性崩溃的舞台，在当地也是如此。马克·库尔兰斯基(Mark Kurlansky)在他的非虚构历史作品《大牡蛎》(The Big Oyster)中描述了欧洲人第一次来到这片水域时莱纳佩领地上的这颗宝石:一个以纽约上湾和下湾为中心的丰富、多产的生态系统，河流中充满了可以用手从水中捞出的鱼，成群的野生火鸡挡住了阳光，以及大量的陆地、海洋和鸟类捕食者——包括鲸鱼、狼和鹰——以本地的聚宝盆为食。在这一切的中心——促进了生命，反过来又被生命促进了——是该地区巨大的牡蛎养殖场，通过过滤丰富的水来喂养，从而允许海湾其他居民的持续健康。库尔兰斯基写道:“根据一些生物学家的估计，纽约港容纳了世界上整整一半的牡蛎。”

当然，这一切都过去了。虽然座头鲸偶尔会因在哈德逊河逆流而上而成为头条新闻，而且[十亿牡蛎项目](https://www.billionoysterproject.org/)致力于恢复至少一部分曾经生活在这里的巨大牡蛎种群(以及该地区许多其他有前途的环境倡议)，但这些天来，我们通常认为纽约市是城市第一，生态系统第二。

![](img/ae2453e285a8b054d93f76ca99fb7929.png)

来源:维基共享资源

在纽约和整个美国，这种情况开始改变了吗？如果这些生态问题都发生在几十年或几个世纪前，我们可能会认为，美国人应该已经学会做得更好，并相应地调整他们的可持续饮食方式，减少污染，当然，种植本地植物，希望本地物种应该开始反弹。但是塔拉米已经出版了几本书，倡导回归种植本土物种而不是外来物种，他哀叹持续的问题:尽管有所有的证据，美国人继续种植和繁殖非本土物种。这种持续的做法所带来的潜在损害越来越大。如上所述，入侵物种是一个令人担忧的问题，塔拉米提到，我们经常在自己的花园里种植、浇水和施肥这些潜在的入侵者:“在美国，大约 85%的入侵木本植物物种是从我们的花园里逃出来的(Kaufman and Kaufman 2007)。”另一个问题是:非本土植物通常很难适应它们的环境，需要大量的水和肥料才能茁壮成长，这进一步加重了当地生态系统的负担。最微妙的(但也可能是最有害的)是非本地人居住在本地人可以使用的空间的*机会成本*。每一英亩用于平坦、美丽但最终不育的种子草坪的土地都是另一英亩不能用于肥沃的原生草田的土地。每一个种植银杏树而不是本土树木的城市街区都是另一个城市树冠层，毛毛虫不会生长，鸟类不会觅食。

绝对公平地说:显然，非本土植物在原产地之外种植会有巨大的价值，假装不是这样是荒谬的。以农业为例。数百年来，抗虫害的非洲水稻品种一直滋养着美洲沿海地区。[冯小燕，一位被称为“土豆姐妹”的中国民间表演者](https://www.vice.com/en/article/595xek/chinas-push-for-potatoes)，在一场由中国政府赞助的旨在提高中国农作物产量的食品宣传活动中，演唱了土豆的神奇之处。如果没有某种红色蔬菜——番茄，这种原产于中美洲的茄属植物会是什么样子呢？更重要的是，这些例子只存在于农业世界。跨越国界、沙漠和海洋的植物物质交换带来了其他行业的巨大进步，如纺织、建筑和制药等。

而且，单靠特有植物显然不是保护生物多样性的灵丹妙药。玉米是美洲特有的一种植物，这种东西的大量单一栽培覆盖了中西部的整个州，从长远来看，这种热量产量的无情优化很可能不如美洲土著人曾经种植的那种可持续、多样化的混种——甚至可能是包括一些非本地植物的混种。

但是那些濒临灭绝的美国榆树却被保存在中央公园里——它们真的让你思考。气候变化、污染和对我们周围自然世界的掠夺将需要我们生活中的大规模调整，特别是在工业化的西方国家，它们在过去几个世纪中排放了大部分的废气，因此必须承担解决问题的大部分责任。没有一步到位的解决方案——有 1000 多个步骤，企业和个人都必须采取这些步骤。但是这 1000 步中的每一步迟早都要走，而且那些本地榆树在市中心生长得很好，如果我要种植(而且我已经决定要种植)——难道我不应该继续种植本地榆树吗？

我照做了。蝴蝶乳草、纽约蕨、瓶龙胆、香蒲和老人的胡须(又名草原烟)开始，今年和明年还会有更多。这是一个令人兴奋的旅程，我才刚刚开始。我并没有完全排除非本土植物，因为即使它们生长在远离其原产地的地方，它们也有着重要的作用，如果精心管理，它们应该会继续为人类、动物、植物和地球上其他形式的生命的持续生存和成功带来巨大的好处。但在可预见的未来，我将种植本地植物——这些物种可以利用这种帮助，而且可能在未来一段时间内会如此。

尽管如此——感觉还不够。我很快意识到我公寓窗户上的植物对生态的影响有限。一些昆虫可能会给它们的花授粉，一些鸟可能会啄它们的浆果，这样就更好了。但是我没有土地可以利用——没有草坪可以种植本地草，没有后院可以种植当地的野花，没有起伏的土地可以种植美国榆树。城市中还有其他的公共空间可以使用——防火梯、屋顶、后院、社区花园和公园。我会继续研究这些，尽我所能参与和学习更多，但这需要耐心和长期的努力。

所以，与此同时，我开始考虑其他的帮助方式。我的想法很快就转向了帮助简化过程的工具。已经有一些很棒的现有应用程序可以找到你所在地区特有的植物——Lady Bird Johnson wild flower Center 的[本地植物数据库](https://www.wildflower.org/plants/),美国国家野生动物基金会的[本地植物搜索器【the Audobon Society 的](https://www.nwf.org/nativeplantfinder/plants)[本地植物数据库](https://www.audubon.org/native-plants),以及其他我可能错过的应用程序。我强烈鼓励任何对本地种植感兴趣的人探索所有这 3 个顶级应用程序(以及我错过的任何应用程序)——每一个都有其优势和劣势。但是他们都觉得缺少了些什么。

缺少的要素是简单。这些现有的应用程序是惊人的，但它们产生了一长串相对无序的本地植物——数百个结果，无疑对专业的园丁/景观设计师极其有用，但对像我这样刚刚开始探索可能性的新手来说，感觉势不可挡。对于新手来说，从小处着手，一次种几株植物，有什么可行的建议吗？在我公寓的范围内，我可以在花盆或窗盒里放些什么植物？如果我在我的植物中寻找特定的特征呢？我应该什么时候种植它们？

对于这个领域的新手来说，一个简单的数据库，一个年历和易于使用的可视化工具怎么样？这是我最想要的。但是在网上搜了这么一个工具，也找不到。正如托尼·莫里森曾在谈到写书的技巧时说的那样:“如果你发现一本书你真的很想读，但它还没有被写出来，那么你必须写出来。”

网络应用也是如此。

## 方法学

这个应用从头到尾都是一个 R 项目:我混合使用 HTML 抓取和 FTP 服务的 R 包收集所有底层数据，主要使用 Tidyverse 生态系统中的库清理数据，并使用闪亮的 web 框架构建应用。在闪亮的应用程序中，我大量使用了 Plotly 和 Leaflet R 库。我不会细说细节——这些大多包含在应用本身或 Github 文档中——但应该注意到，应用的结构受到了 [CRAN Explorer](https://gallery.shinyapps.io/cran-explorer/) 的严重影响，这是一款出色的闪亮应用，是 2019 年 Shiny 大赛的亚军之一。该应用程序大量使用定制的 HTML/CSS 模板，其中只输入了选定的 R-to-HTML 闪亮元素，而不是初学者闪亮应用程序中常见的从底层 R 完整生成所有网页元素，从而实现了我所需要的美学灵活性。CRAN Explorer 也是一个很棒的面向用户的应用程序，不仅可以查看 CRAN 元数据，还可以发现新的 R 包！

我从这个过程中学到了很多东西，但是回顾我学到的所有小教训会很乏味，所以我将重点放在一个更大的见解上，这个见解是我在项目开始几个月时领悟到的，并且从那以后一直困扰着我。这是一个有点方便的叙述，一个有点过于简洁的总结应用程序经验的方式，但我可以真诚地说，这是一个我将在任何后续的 web 开发项目中使用的规则。

总之:正如通过将定性数据(字符串)转换为定量数据(数字、布尔值)来简化后端任务一样，通过将面向用户的信息(文本)简化为符号(图像、迷你图、图标)来简化前端通信。或者说:**只要有可能，把一切都简化成符号。**

这个原理很简单，在后端就可以理解，如果说数字技术在数字上起作用，那基本上是同义反复。自从人类在过去的一个世纪里开始让机器用算法来做这件事以来，将不可能复杂的模拟现实世界转化为大量精心计算的数字，以形成一个不完美但相当好的物理世界的数学表示，一直工作得很好(尽管许多比我聪明得多的人做了大量极其艰苦的工作)。这是计算机如何在最低级别的位和字节上运行的，但在编写像 R 这样的高级抽象编程语言时，这也是一个有用的原则；即使像我这样的相对新手也很快认识到，数据争论和随后的计算在数字或布尔值上运行比在一堆杂乱的文本数据上运行更好。在后端，数字化一切(在可能的情况下)通常是最佳实践——在使用 R 几年后，当我开始开发我闪亮的应用程序时，我已经内化了这个教训。所以我从 1/2 的指导原则开始，足以开始一个笨重但功能正常的后端。

但是在 web 应用的前端，我完全迷失了。这种经验的缺乏不仅体现在我的代码的可读性(向任何试图扫描我的 Javascript 的人道歉)或性能(我害怕检查任何网站速度指标)上，还体现在最终产品本身、用户界面的美观和响应能力——网站的美感上。我没有视觉眼睛——我不是设计师。前端总是对我来说是最大的挑战，除了让网站看起来漂亮的一般愿望之外，我没有任何指导原则。

但我知道我想以一种简洁、打包的方式传达大量信息——这是与现有的原生植物应用程序的区别，后者包含大量强大的数据，但却一次性地向用户提供一长串数据。这个项目进行了几个月，面对一个正在改善但仍然顽固混乱和充满文字的前端，我有了这样的想法，前端的符号可以帮助清晰和有效的交流，就像数字在后端帮助一样。

以一个简单的类别(如耐火性)为例，它有两个可能的值:“是”和“否”。与耐火性等其他类别不同，耐火性是以对火的耐受程度来衡量的(“低”、“高”等)，美国农业部只收集了植物是否具有耐火性的二元数据:它们有或没有，“是”或“否”。将这些值呈现给用户会立即产生一个问题:从“是”中突出出来的“s”。如果任何列的值为正，它会立即增加该列的宽度。因此，面临的挑战是:如何使呈现给最终用户的布尔值的长度相等，这样就可以设计出无论正值/负值都一样宽的列界面？“真”和“假”提出了与“是”和“否”相同的问题。您不能向用户显示 1 和 0，即使您希望这样做。大多数人可能会理解“Y”和“N”，但无疑其他人会感到困惑。“是”和“不是”长度相等，所以可能有用，但是你的用户不太可能是 17 世纪的贵族。对于不懂英语的用户来说，没有一个是好的。

但是两个尺寸相同的*符号*——在这种情况下，勾号图案和 x 图案——在界面设计中完美地实现了长度和高度的可预测性。对于那些有前端设计经验的人来说，这似乎是显而易见的，但在我获得这种洞察力之前，我花了一个月的时间以不同的方式徒劳地格式化 carousel，实现它花了几个小时，并且极大地提高了 carousel 的可读性和视觉整洁性。为用户提供的正/负分类数据的紧凑块，没有被从正值突出的额外“s”标记:非常整齐，具有类似乐高积木的能力，可以相互堆叠并整齐地并排放置，而不用担心列可能不均匀。

在布尔数据之后，很快实现了迷你图来符号化植物特征的分类程度数据；“低”、“中”、“高”都有不同的长度，但动态生成的 HTML 内联图表没有。图表一目了然，可读性更强。文字到符号转换的最终效果是一个更干净、更漂亮的界面，在向用户快速传递数据时也更有效。

最好的部分是:这两种方法——主要是数字后端和主要是符号前端——相辅相成。例如，R 迷你图包不能很好地处理非数字数据。您可以通过篡改底层 Javascript 来修改它，但是如果您对 Javascript 了解不多，这很快就会变得令人沮丧。最好直接从后端给它提供它想要的数字。

![](img/a1ef73c7bba0da583afb3dbdb06b4675.png)

这个图表中的每个符号都可以被封装在一个大小一致的正方形中，但是你不能对它们的完整单词对等物做同样的事情。来源:维基共享资源

最终，任何在软件或用户设计方面稍有经验的人都会欢迎我的建议，把一切都简化成象征性的——是的，这是简化。这不是一个不可违反的规则，显然有些地方文字是不可替代的。但对于这个网络应用和其他任何应用，我可能会在前端和后端都强调符号——这是一个体面的开始原则。

## 动力

还有大量的工作要做。下一步是自动化应用程序的输入——我目前正在设置一个谷歌云虚拟机来自动运行 R 脚本，这些脚本收集/提取各种美国农业部/美国国家海洋与大气管理局/NCSS 植物、土壤和天气输入，并将它们转换成可供 web 应用程序使用的可用形式。我需要创建改进的天气模型，以更好地预测每种特殊的地方植物茁壮成长的条件——洋葱在较干燥的条件下生长，普通柿子在较潮湿的条件下生长。我需要找到夏威夷、波多黎各、美属维尔京群岛和美国其他海外领地的气候数据集。所有这些挑战以及更多的挑战依然存在。

在技术层面上，我可能需要开始将 R 以外的东西作为面向用户的 web 应用程序的基础，尽管 Shiny 背后的聪明人做出了最勇敢的努力，但这种语言似乎没有以真正可伸缩、持久的方式进行优化。当然，这部分源于我作为一个 R 用户的弱点。他们说，当你只有一把锤子时，一切都开始看起来像钉子——当你所有(或大部分)的东西都变得杂乱时，一切都开始看起来像数据框。一切都是关于将矢量化函数应用于 2D 矩阵。这并不一定是一件坏事——作为一个从业务分析师背景进入 R 的人，在那里电子表格至高无上，Excel 与 2D 矩阵管理工具如 Access 和 SQL 相邻，数据框架几乎是任何逻辑起点。 [2D 网格是一个强大的心智模型](https://www.notboring.co/p/excel-never-dies)，几乎任何人都可以通过很少的培训直观地理解它，它们对 Tidyverse R 的重要性是像我这样的新手能够首先努力学习一点 R 语言的原因之一(以及——正如任何 Tidyverse 爱好者会告诉你的那样——神奇的语法糖，即% > %方法和它所培养的编码线性)。然而，高效的编程依赖于比数据框架更大的数据结构库，web 应用程序可能需要更灵活的编码方法。更广泛地说，尽管 Shiny 是一个很棒的工具，但它是目前最轻的 web 框架之一，缺乏 Python 或 Ruby 框架常见的一些强大功能，这些功能可能对应用程序的未来改进有用，包括电子邮件功能。

或者，也许我会继续使用 R:优化我现有的代码，而不是用一种新的语言从头开始重新编写，利用更多闪亮的功能，并自动化我项目的后端。只要能保持网站正常运行并不断改进就行。这是从一个强大的动机(比如帮助人们种植当地植物的愿望)开始，然后找出方法的伟大之处——你会不断调整、修补、发展。简而言之，让它发挥作用。

所以，找一个好的动机，一个爱好，一项技能——然后找到一种方法来扩展它。如果你碰巧是个园艺新手，就种本地的吧！如果你刚好是一个开发新手，那就建一个 web app。如果你两者都是呢？双管齐下。