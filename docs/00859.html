<html>
<head>
<title>Downcasting in Java</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Java中的向下转换</h1>
<blockquote>原文：<a href="https://medium.com/codex/downcasting-in-java-2c42d5fd9fef?source=collection_archive---------11-----------------------#2021-03-22">https://medium.com/codex/downcasting-in-java-2c42d5fd9fef?source=collection_archive---------11-----------------------#2021-03-22</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/d8df6ebdf0f1480b8f8a933a01440e22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*kxmslQDp0HnJkL7T"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">伊利亚·巴甫洛夫在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="7fea" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Java中的向上转换是隐式完成的。考虑一个基类动物和子类狗和猫。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="55c2" class="kc kd hi jy b fi ke kf l kg kh">public class Animal {<br/>    public void move()<br/>    {<br/>        System.out.println("Animals can move");<br/>    }</span><span id="c82a" class="kc kd hi jy b fi ki kf l kg kh">public void sleep()<br/>    {<br/>        System.out.println("Animals can sleep");<br/>    }<br/>}</span></pre><p id="5503" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">狗是动物的一个亚纲</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="975f" class="kc kd hi jy b fi ke kf l kg kh">public class Dog extends Animal {</span><span id="a357" class="kc kd hi jy b fi ki kf l kg kh">public void move()<br/>    {<br/>        System.out.println("Dogs can move");<br/>    }<br/>    public void bark()<br/>    {<br/>        System.out.println("Dogs can bark");<br/>    }<br/>}</span></pre><p id="6bf0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">猫类是动物的一个亚纲</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="f7a5" class="kc kd hi jy b fi ke kf l kg kh">public class Cat extends Animal {</span><span id="41c3" class="kc kd hi jy b fi ki kf l kg kh">public void move()<br/>    {<br/>        System.out.println("Cats can move");<br/>    }<br/>    public void meow()<br/>    {<br/>        System.out.println("Cats can meow");<br/>    }<br/>}</span></pre><p id="2053" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">使用下面这段代码，我们可以直接访问父类成员和子类的重写方法。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="716b" class="kc kd hi jy b fi ke kf l kg kh">Animal animal = new Dog();</span><span id="158b" class="kc kd hi jy b fi ki kf l kg kh">animal.move();</span><span id="431f" class="kc kd hi jy b fi ki kf l kg kh">animal.sleep();</span></pre><p id="6db5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">上面代码的输出:</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="c36e" class="kc kd hi jy b fi ke kf l kg kh">Dogs can move<br/>Animals can sleep</span></pre><p id="5514" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">但是如果我们想使用动物类型的变量来调用一个只对狗类可用的方法呢？<strong class="ix hj">降档</strong>来了。这是从超类到子类的转换。</p><p id="244a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果我们直接执行向下转换，编译器会给出一个编译错误。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="9216" class="kc kd hi jy b fi ke kf l kg kh">Dog dog = new Animal();  // Incompatible types error</span></pre><p id="31ba" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果我们通过<a class="ae iu" href="https://www.geeksforgeeks.org/class-type-casting-in-java/" rel="noopener ugc nofollow" target="_blank">类型转换</a>执行向下转换，就会在运行时抛出ClassCastException。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="3eaa" class="kc kd hi jy b fi ke kf l kg kh">Dog dog = (Dog)new Animal(); //ClassCastException at runtime</span></pre><p id="d110" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">下面是正确的做法。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="0d26" class="kc kd hi jy b fi ke kf l kg kh">Animal animal = new Dog();</span><span id="7c8d" class="kc kd hi jy b fi ki kf l kg kh">Dog dog = (Dog)animal;</span><span id="f644" class="kc kd hi jy b fi ki kf l kg kh">dog.bark();  //method specific to subclass is accessible</span></pre><h1 id="0836" class="kj kd hi bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated"><strong class="ak">安全铸造</strong></h1><p id="18ee" class="pw-post-body-paragraph iv iw hi ix b iy lg ja jb jc lh je jf jg li ji jj jk lj jm jn jo lk jq jr js hb bi translated">在显式强制转换的情况下，强烈建议在尝试使用  <strong class="ix hj">的<a class="ae iu" href="https://www.baeldung.com/java-instanceof" rel="noopener ugc nofollow" target="_blank"> <em class="ll">实例强制转换</em></a></strong>之前<strong class="ix hj">检查类型的兼容性。</strong>Java语言提供了instanceof关键字，用于在造型前检查对象的类型。例如:</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="0807" class="kc kd hi jy b fi ke kf l kg kh">if (animal instanceof Cat) {</span><span id="64d3" class="kc kd hi jy b fi ki kf l kg kh">Cat cat = (Cat) anim;</span><span id="6343" class="kc kd hi jy b fi ki kf l kg kh">cat.meow();</span><span id="6ffb" class="kc kd hi jy b fi ki kf l kg kh">} else if (animal instanceof Dog) {</span><span id="d067" class="kc kd hi jy b fi ki kf l kg kh">Dog dog = (Dog) anim;</span><span id="d906" class="kc kd hi jy b fi ki kf l kg kh">dog.bark();</span><span id="947e" class="kc kd hi jy b fi ki kf l kg kh">}</span></pre><p id="46c2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">因此，如果您不确定原始对象类型，请在转换前使用instanceof运算符检查类型。这消除了抛出的风险。</p></div></div>    
</body>
</html>