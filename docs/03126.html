<html>
<head>
<title>Introducing WebSockets — Building Real-time Apps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">WebSockets简介—构建实时应用</h1>
<blockquote>原文：<a href="https://medium.com/codex/introducing-websockets-building-real-time-apps-8ce1575cd69d?source=collection_archive---------9-----------------------#2021-08-19">https://medium.com/codex/introducing-websockets-building-real-time-apps-8ce1575cd69d?source=collection_archive---------9-----------------------#2021-08-19</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="af4b" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">什么是WebSockets，它们是用来做什么的？</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/4ef736d0d66fa339289f371f5f75cb20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Wg2KVuuJVoL1M2O0GqgFGw.jpeg"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">照片由<a class="ae jn" href="https://unsplash.com/@cebbbinghaus" rel="noopener ugc nofollow" target="_blank">克里斯托弗·罗宾·艾宾浩斯</a>在<a class="ae jn" href="https://unsplash.com/" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><h1 id="5dff" class="jo jp hi bd jq jr js jt ju jv jw jx jy io jz ip ka ir kb is kc iu kd iv ke kf bi translated"><strong class="ak">实时网络应用的简史</strong></h1><p id="60ee" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">web是围绕着客户机的请求和服务器的回答而构建的。2005年左右，AJAX引入后，人们开始在客户端和服务器之间建立<strong class="ki hj"> <em class="lc">双向</em> </strong>连接。</p><h2 id="8a03" class="ld jp hi bd jq le lf lg ju lh li lj jy kp lk ll ka kt lm ln kc kx lo lp ke lq bi translated">什么是HTTP？</h2><p id="1cef" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">在超文本传输协议(HTTP)中使用的传统请求-响应模型中，客户端请求资源，服务器进行响应。如果您想在浏览器中查看某个页面，则需要通过HTTP请求从服务器中检索数据。因为客户端总是发起这种交换，所以没有客户端的请求，服务器不能发送任何数据。当客户偶尔发出请求时，这种模式在万维网上工作得很好，但是随着内容的快速变化，这种模式的局限性变得越来越重要。为了克服客户端发起的事务，设计了几种不同的策略来允许服务器将数据推送到客户端。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es lr"><img src="../Images/36c74bc8953db5211e7cea25771b11ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2JWOKTzWlaTo1gz2DIx0dQ.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">由<a class="ae jn" href="https://www.flaticon.com/authors/dinosoftlabs" rel="noopener ugc nofollow" target="_blank"> DinosoftLab </a>从<a class="ae jn" href="https://www.flaticon.com/" rel="noopener ugc nofollow" target="_blank"> flaticon </a>制作的图标</figcaption></figure><h2 id="461c" class="ld jp hi bd jq le lf lg ju lh li lj jy kp lk ll ka kt lm ln kc kx lo lp ke lq bi translated">HTTP的问题</h2><p id="865f" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">然而，所有这些使用HTTP的方法都有一个共同的问题:它们必须是低延迟的应用程序，能够支持由客户机或服务器发起的事务。这正是WebSockets所提供的，在这篇文章中，我们将看到它们做什么以及如何在实时web应用程序中使用它们。</p><h2 id="a343" class="ld jp hi bd jq le lf lg ju lh li lj jy kp lk ll ka kt lm ln kc kx lo lp ke lq bi translated"><strong class="ak">什么是WebSockets？</strong></h2><p id="bfe1" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">WebSocket是一种计算机通信协议，它提供客户端和服务器之间的全双工通信，以便双方可以随时开始发送数据。WebSockets是一个建立在TCP/IP协议栈之上的瘦传输层。</p><h2 id="e4c5" class="ld jp hi bd jq le lf lg ju lh li lj jy kp lk ll ka kt lm ln kc kx lo lp ke lq bi translated">WebSockets是如何工作的？</h2><p id="e067" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">WebSocket是另一种发送和接收消息的协议。要建立与服务器的WebSocket连接，客户端应该发送一个HTTP“握手”请求。请求被发送到一个<strong class="ki hj"> ws: </strong>或<strong class="ki hj"> wss: </strong> URI，如果连接成功，服务器发送一个成功的握手响应。一旦连接升级，协议从HTTP切换到WebSocket，这是一个全双工协议，客户端和服务器都可以同时发送消息。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ls"><img src="../Images/464c16899defcc3d1e6caa1d1ea5df8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0w3tMXm7jr174bqOprcdOg.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated"><a class="ae jn" href="https://www.cleanpng.com/users/@tunike.html" rel="noopener ugc nofollow" target="_blank">图尼克</a>在<a class="ae jn" href="https://www.cleanpng.com/" rel="noopener ugc nofollow" target="_blank">清洁</a>时拍摄的照片</figcaption></figure><h1 id="404f" class="jo jp hi bd jq jr js jt ju jv jw jx jy io jz ip ka ir kb is kc iu kd iv ke kf bi translated">【WebSocket入门</h1><p id="84d7" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">通过调用WebSocket构造函数，可以简单地打开WebSocket连接:</p><p id="facd" class="pw-post-body-paragraph kg kh hi ki b kj lt ij kl km lu im ko kp lv kr ks kt lw kv kw kx lx kz la lb hb bi translated">这个简单的例子创建了一个新的WebSocket，在<code class="du ly lz ma mb b">wss://example.com/socketserer</code>连接到服务器。在这个例子中，在对套接字的请求中命名了一个定制协议“protocolOne ”,尽管这可以省略。</p><pre class="iy iz ja jb fd mc mb md me aw mf bi"><span id="f537" class="ld jp hi mb b fi mg mh l mi mj">const websocket = new WebSocket(“wss://www.example.com/socketserver", “protocolOne”);</span></pre><p id="83bb" class="pw-post-body-paragraph kg kh hi ki b kj lt ij kl km lu im ko kp lv kr ks kt lw kv kw kx lx kz la lb hb bi translated">如果您想要打开一个连接并使其在协议方面更加灵活，您可以指定一组协议:</p><pre class="iy iz ja jb fd mc mb md me aw mf bi"><span id="7389" class="ld jp hi mb b fi mg mh l mi mj">const <!-- -->websocket <!-- -->= new WebSocket("wss://www.example.com/socketserver", ["protocolOne", "protocolTwo"]);</span></pre><h2 id="9552" class="ld jp hi bd jq le lf lg ju lh li lj jy kp lk ll ka kt lm ln kc kx lo lp ke lq bi translated">向服务器发送数据</h2><p id="06e0" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">一旦打开连接，就可以开始向服务器传输数据。要做到这一点，所有的<code class="du ly lz ma mb b">WebSocket</code>对象的<code class="du ly lz ma mb b">send()</code>方法为你想要发送的每条消息:</p><pre class="iy iz ja jb fd mc mb md me aw mf bi"><span id="3201" class="ld jp hi mb b fi mg mh l mi mj">websocket<!-- -->.send("This is some text!");</span></pre><p id="e840" class="pw-post-body-paragraph kg kh hi ki b kj lt ij kl km lu im ko kp lv kr ks kt lw kv kw kx lx kz la lb hb bi translated">我们可以通过定义一个<code class="du ly lz ma mb b">onopen</code>事件处理程序来完成这项工作，从而确保仅在连接建立后才尝试发送数据:</p><pre class="iy iz ja jb fd mc mb md me aw mf bi"><span id="dbea" class="ld jp hi mb b fi mg mh l mi mj">websocket<!-- -->.onopen = function (event) {<br/>  <!-- -->websocket<!-- -->.send("This is some text!");<br/>};</span></pre><h2 id="74cf" class="ld jp hi bd jq le lf lg ju lh li lj jy kp lk ll ka kt lm ln kc kx lo lp ke lq bi translated">从服务器接收消息</h2><p id="4085" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">WebSockets是一个事件驱动的API。当收到消息时，一个消息事件被发送到<code class="du ly lz ma mb b">WebSocket</code>对象。为了处理它，为消息事件添加一个事件监听器，或者我们可以使用<code class="du ly lz ma mb b">onmessage</code>事件处理程序。</p><pre class="iy iz ja jb fd mc mb md me aw mf bi"><span id="d00b" class="ld jp hi mb b fi mg mh l mi mj">websocket<!-- -->.onmessage = function (event) {<br/>  console.log(event.data);<br/>}</span></pre><p id="2803" class="pw-post-body-paragraph kg kh hi ki b kj lt ij kl km lu im ko kp lv kr ks kt lw kv kw kx lx kz la lb hb bi translated">由于<code class="du ly lz ma mb b">event.data</code>是一个JSON对象，我们可以使用<code class="du ly lz ma mb b">JSON.parse()</code>将JSON对象转换回原始对象。</p><h2 id="4361" class="ld jp hi bd jq le lf lg ju lh li lj jy kp lk ll ka kt lm ln kc kx lo lp ke lq bi translated">关闭连接</h2><p id="d2b4" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">当您使用完WebSocket后，调用WebSocket方法<code class="du ly lz ma mb b">close()</code>来关闭连接。</p><pre class="iy iz ja jb fd mc mb md me aw mf bi"><span id="5a68" class="ld jp hi mb b fi mg mh l mi mj">websocket<!-- -->.close();</span></pre><h1 id="cd06" class="jo jp hi bd jq jr js jt ju jv jw jx jy io jz ip ka ir kb is kc iu kd iv ke kf bi translated">有哪些流行的WS库？</h1><p id="108a" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">有一些流行的WS库，有很多框架。</p><ul class=""><li id="2ce0" class="mk ml hi ki b kj lt km lu kp mm kt mn kx mo lb mp mq mr ms bi translated">节点。JS: <a class="ae jn" href="http://socket.io/" rel="noopener ugc nofollow" target="_blank">插座。IO </a>，<a class="ae jn" href="https://github.com/Worlize/WebSocket-Node" rel="noopener ugc nofollow" target="_blank"> WebSocket-Node </a>，<a class="ae jn" href="https://github.com/einaros/ws" rel="noopener ugc nofollow" target="_blank"> ws </a></li><li id="57f3" class="mk ml hi ki b kj mt km mu kp mv kt mw kx mx lb mp mq mr ms bi translated">爪哇:<a class="ae jn" href="http://www.eclipse.org/jetty/" rel="noopener ugc nofollow" target="_blank">码头</a></li><li id="4af6" class="mk ml hi ki b kj mt km mu kp mv kt mw kx mx lb mp mq mr ms bi translated">Ruby: <a class="ae jn" href="http://github.com/igrigorik/em-websocket" rel="noopener ugc nofollow" target="_blank"> EventMachine </a></li><li id="962a" class="mk ml hi ki b kj mt km mu kp mv kt mw kx mx lb mp mq mr ms bi translated">Python: <a class="ae jn" href="http://code.google.com/p/pywebsocket/" rel="noopener ugc nofollow" target="_blank"> pywebsocket </a>，<a class="ae jn" href="https://github.com/facebook/tornado" rel="noopener ugc nofollow" target="_blank">龙卷风</a></li><li id="12d5" class="mk ml hi ki b kj mt km mu kp mv kt mw kx mx lb mp mq mr ms bi translated">二郎:<a class="ae jn" href="https://github.com/michilu/shirasu" rel="noopener ugc nofollow" target="_blank">白苏</a></li><li id="b690" class="mk ml hi ki b kj mt km mu kp mv kt mw kx mx lb mp mq mr ms bi translated">C++: <a class="ae jn" href="http://git.warmcat.com/cgi-bin/cgit/libwebsockets/" rel="noopener ugc nofollow" target="_blank"> libwebsockets </a></li><li id="c3ad" class="mk ml hi ki b kj mt km mu kp mv kt mw kx mx lb mp mq mr ms bi translated">。NET: <a class="ae jn" href="http://superwebsocket.codeplex.com/" rel="noopener ugc nofollow" target="_blank"> SuperWebSocket </a></li></ul><h1 id="731a" class="jo jp hi bd jq jr js jt ju jv jw jx jy io jz ip ka ir kb is kc iu kd iv ke kf bi translated">插座。超正析象管(Image Orthicon)</h1><p id="3d79" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">在本帖中，我们将看看Socket.IO. Socket。IO支持基于事件的实时双向通信。它包括:</p><ul class=""><li id="11f7" class="mk ml hi ki b kj lt km lu kp mm kt mn kx mo lb mp mq mr ms bi translated">一个<a class="ae jn" href="https://nodejs.org/" rel="noopener ugc nofollow" target="_blank"> Node.js </a>服务器</li><li id="2491" class="mk ml hi ki b kj mt km mu kp mv kt mw kx mx lb mp mq mr ms bi translated">浏览器的一个<a class="ae jn" href="https://github.com/socketio/socket.io-client" rel="noopener ugc nofollow" target="_blank"> Javascript客户端库</a>(或者一个Node.js客户端)</li></ul><h2 id="99c8" class="ld jp hi bd jq le lf lg ju lh li lj jy kp lk ll ka kt lm ln kc kx lo lp ke lq bi translated">装置</h2><pre class="iy iz ja jb fd mc mb md me aw mf bi"><span id="74d7" class="ld jp hi mb b fi mg mh l mi mj">// with npm<br/>npm install socket.io<br/><br/>// with yarn<br/>yarn add socket.io</span></pre><h2 id="42be" class="ld jp hi bd jq le lf lg ju lh li lj jy kp lk ll ka kt lm ln kc kx lo lp ke lq bi translated">如何使用</h2><pre class="iy iz ja jb fd mc mb md me aw mf bi"><span id="4407" class="ld jp hi mb b fi mg mh l mi mj">const server = require('http').createServer();<br/>const io = require('socket.io')(server);<br/>io.on('connection', client =&gt; {<br/>  client.on('event', data =&gt; { /* Here is your code */ });<br/>  client.on('disconnect', () =&gt; { /* Here is your code */ });<br/>});<br/>server.listen(3000);</span></pre><h2 id="7c23" class="ld jp hi bd jq le lf lg ju lh li lj jy kp lk ll ka kt lm ln kc kx lo lp ke lq bi translated">与Express一起使用</h2><p id="9448" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">在3.0版本之后，<code class="du ly lz ma mb b">express</code>应用程序已经成为请求处理器函数。你需要通过<code class="du ly lz ma mb b">server</code>到<code class="du ly lz ma mb b">socket.io</code>，而不是<code class="du ly lz ma mb b">express</code>申请。</p><pre class="iy iz ja jb fd mc mb md me aw mf bi"><span id="5b01" class="ld jp hi mb b fi mg mh l mi mj">const app = require('express')();<br/>const server = require('http').createServer(app);<br/>const io = require('socket.io')(server);<br/>io.on('connection', () =&gt; { /* Here is your code */ });<br/>server.listen(3000);</span></pre><h1 id="b5b1" class="jo jp hi bd jq jr js jt ju jv jw jx jy io jz ip ka ir kb is kc iu kd iv ke kf bi translated">WebSocket的托管解决方案</h1><p id="0cd6" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">除了socket.io这样的WebSocket开源软件，还有付费和托管的解决方案。最受欢迎的管理解决方案之一是<a class="ae jn" href="https://www.pusher.com/" rel="noopener ugc nofollow" target="_blank">推送器</a>。Pusher是一个托管的API服务，可以向应用程序添加实时数据和功能。与WebSockets的唯一区别是Pusher是一个托管的服务/API，它需要更少的工作来开始。Pusher很好用，不需要写很多代码就能实现实时应用。</p><h1 id="b1df" class="jo jp hi bd jq jr js jt ju jv jw jx jy io jz ip ka ir kb is kc iu kd iv ke kf bi translated">参考资料和进一步阅读</h1><ul class=""><li id="57cd" class="mk ml hi ki b kj kk km kn kp my kt mz kx na lb mp mq mr ms bi translated"><a class="ae jn" href="https://en.wikipedia.org/wiki/WebSocket" rel="noopener ugc nofollow" target="_blank"> WebSockets维基百科</a></li><li id="5894" class="mk ml hi ki b kj mt km mu kp mv kt mw kx mx lb mp mq mr ms bi translated"><a class="ae jn" href="https://blog.teamtreehouse.com/an-introduction-to-websockets" rel="noopener ugc nofollow" target="_blank"> WebSocket基础知识:简介</a></li><li id="8dcd" class="mk ml hi ki b kj mt km mu kp mv kt mw kx mx lb mp mq mr ms bi translated"><a class="ae jn" href="https://www.html5rocks.com/en/tutorials/websockets/basics/" rel="noopener ugc nofollow" target="_blank">介绍WebSockets:将套接字引入Web </a></li><li id="655b" class="mk ml hi ki b kj mt km mu kp mv kt mw kx mx lb mp mq mr ms bi translated">编写WebSocket客户端应用程序</li><li id="85a8" class="mk ml hi ki b kj mt km mu kp mv kt mw kx mx lb mp mq mr ms bi translated"><a class="ae jn" href="https://github.com/socketio/socket.io" rel="noopener ugc nofollow" target="_blank">插座。IO </a></li></ul></div></div>    
</body>
</html>