<html>
<head>
<title>How to implement chat push notifications on a web application using Firebase</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Firebase在web应用程序上实现聊天推送通知</h1>
<blockquote>原文：<a href="https://medium.com/codex/how-to-implement-chat-push-notifications-on-a-web-application-using-firebase-f6a8b52bce31?source=collection_archive---------7-----------------------#2022-05-31">https://medium.com/codex/how-to-implement-chat-push-notifications-on-a-web-application-using-firebase-f6a8b52bce31?source=collection_archive---------7-----------------------#2022-05-31</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/5a31dd1f248161fc24a399be16913282.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*TSw58GfHtKqnYI4N.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">仙鸟2022</figcaption></figure><div class=""/><div class=""><h2 id="96bc" class="pw-subtitle-paragraph iu hw hx bd b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl dx translated">推送通知仅适用于移动设备吗？不再是了！以下是如何在您的web应用程序中实现它们</h2></div><p id="0fb7" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">杰森·奥尔肖恩<br/>解决方案工程师| <a class="ae ki" href="https://www.sendbird.com/" rel="noopener ugc nofollow" target="_blank">仙鸟</a></p><p id="e63b" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated"><em class="kj">我们建议您查看</em> <a class="ae ki" href="https://github.com/SendbirdCommunity/sendbird-pwa-push-example" rel="noopener ugc nofollow" target="_blank"> <em class="kj">示例应用</em> </a> <em class="kj">获取您可能需要的代码。如需更多指导，请访问我们的</em> <a class="ae ki" href="https://sendbird.com/docs/chat/v4/javascript/guides/push-notifications" rel="noopener ugc nofollow" target="_blank"> <em class="kj">文档</em> </a> <em class="kj">。别忘了查看应用内聊天的</em> <a class="ae ki" href="https://sendbird.com/demos/in-app-chat" rel="noopener ugc nofollow" target="_blank"> <em class="kj">演示</em> </a> <em class="kj">，并访问我们的</em> <a class="ae ki" href="https://sendbird.com/features/chat-messaging" rel="noopener ugc nofollow" target="_blank"> <em class="kj">网站</em> </a> <em class="kj">了解更多关于Sendbird Chat可以提供的服务。</em></p><blockquote class="kk kl km"><p id="a5df" class="jm jn kj jo b jp jq iy jr js jt jb ju kn jw jx jy ko ka kb kc kp ke kf kg kh hb bi translated"><em class="hx">为了第一个了解新教程、开发者相关聊天/电话发布以及其他重要更新，</em> <a class="ae ki" href="https://get.sendbird.com/dev-newsletter-subscription.html" rel="noopener ugc nofollow" target="_blank"> <em class="hx">注册</em> </a> <em class="hx">获取我们的开发者简讯。</em></p></blockquote><h1 id="7cca" class="kq kr hx bd ks kt ku kv kw kx ky kz la jd lb je lc jg ld jh le jj lf jk lg lh bi translated">介绍</h1><p id="8249" class="pw-post-body-paragraph jm jn hx jo b jp li iy jr js lj jb ju jv lk jx jy jz ll kb kc kd lm kf kg kh hb bi translated">如果你的网络应用可以像你的移动应用一样接收推送通知，那不是很好吗？当您想到推送通知时，您可能只会想到您的移动设备；幸运的是，您还可以在桌面和移动设备上使用web应用程序的推送通知。事实上，现在许多网络应用程序都是PWAs(渐进式网络应用程序)，允许在桌面和移动设备上进行离线访问和推送通知等功能。</p><p id="fdc6" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">在本教程中，我们将讨论如何使用Firebase为您的web应用程序实现推送通知。在奠定了一些PWA概念的基础之后，我们将解释如何设置Firebase、接收推送通知以及测试您的推送通知实现。本教程结束时，您将知道如何使用Sendbird Chat和Firebase发送web推送通知。</p><p id="b72e" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">对于本教程，我们将使用Mozilla的:</p><ol class=""><li id="eda2" class="ln lo hx jo b jp jq js jt jv lp jz lq kd lr kh ls lt lu lv bi translated"><a class="ae ki" href="https://developer.mozilla.org/en-US/docs/Web/API/notification" rel="noopener ugc nofollow" target="_blank">通知API </a></li><li id="79df" class="ln lo hx jo b jp lw js lx jv ly jz lz kd ma kh ls lt lu lv bi translated"><a class="ae ki" href="https://developer.mozilla.org/en-US/docs/Web/API/Push_API" rel="noopener ugc nofollow" target="_blank">推送API </a></li></ol><p id="3f88" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">为了从本教程中获得最大收益，你可能想下载这个非常简单的<a class="ae ki" href="https://github.com/SendbirdCommunity/sendbird-pwa-push-example" rel="noopener ugc nofollow" target="_blank">应用</a>。</p><p id="0a22" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">请注意，您需要运行“npm安装”和“npm启动”。您还需要更改:</p><ul class=""><li id="b584" class="ln lo hx jo b jp jq js jt jv lp jz lq kd lr kh mb lt lu lv bi translated">火基配置</li><li id="9b33" class="ln lo hx jo b jp lw js lx jv ly jz lz kd ma kh mb lt lu lv bi translated">乏味的</li><li id="6ed0" class="ln lo hx jo b jp lw js lx jv ly jz lz kd ma kh mb lt lu lv bi translated">Sendbird凭据</li></ul><p id="7758" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">让我们开始吧！</p><h1 id="ce8b" class="kq kr hx bd ks kt ku kv kw kx ky kz la jd lb je lc jg ld jh le jj lf jk lg lh bi translated">什么是PWA？</h1><p id="0f27" class="pw-post-body-paragraph jm jn hx jo b jp li iy jr js lj jb ju jv lk jx jy jz ll kb kc kd lm kf kg kh hb bi translated"><a class="ae ki" href="https://web.dev/progressive-web-apps/" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy">渐进式web应用</strong> </a>是一种外观和行为都像本地应用的web应用。例如，如果您的PWA在移动设备上访问，它可以在离线时安装和使用，也可以在后台接收推送通知。</p><h2 id="933f" class="mc kr hx bd ks md me mf kw mg mh mi la jv mj mk lc jz ml mm le kd mn mo lg mp bi translated">我需要PWA吗？</h2><p id="9519" class="pw-post-body-paragraph jm jn hx jo b jp li iy jr js lj jb ju jv lk jx jy jz ll kb kc kd lm kf kg kh hb bi translated">要从Sendbird服务器接收推送通知，您的web应用程序必须是PWA。如今，大多数网络应用程序都可以在桌面和移动浏览器上访问；然而，即使你的应用只打算在桌面浏览器中使用，桌面PWA仍然有<a class="ae ki" href="https://developers.google.com/web/progressive-web-apps/desktop" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy">个好处</strong> </a>。</p><p id="9cae" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">如果您不喜欢PWAs，您仍然可以使用<a class="ae ki" href="https://developer.mozilla.org/en-US/docs/Web/API/notification" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy">通知API </strong> </a>在应用程序打开并调用Sendbird事件处理程序时向用户显示通知，但这些不是真正的推送通知。</p><p id="7bff" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">现在让我们来讨论一下推送通知在web应用程序上的实现细节。我们要做的第一件事是设置一个服务人员。</p><h1 id="502d" class="kq kr hx bd ks kt ku kv kw kx ky kz la jd lb je lc jg ld jh le jj lf jk lg lh bi translated">设置您的服务人员</h1><p id="c867" class="pw-post-body-paragraph jm jn hx jo b jp li iy jr js lj jb ju jv lk jx jy jz ll kb kc kd lm kf kg kh hb bi translated">无论您的应用程序是用普通JavaScript编写的，还是使用React、Angular、Vue或其他特定框架，您都应该能够创建PWA。但是，如果使用框架，您可能需要将一些代码移动到稍微不同的位置。如果你使用React Native，参考我们的<a class="ae ki" href="https://docs.sendbird.com/javascript/push_notifications" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy">文档</strong> </a>。</p><p id="f9a8" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">记住你的PWA的关键是服务人员。这个worker在后台运行，允许您接收推送通知，以及本教程中没有介绍的其他PWA功能。</p><p id="8fe8" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">首先，在项目根目录下创建一个名为firebase-messaging-sw.js的空文件。</p><p id="c298" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">在index.js中，注册firebase-messaging-sw.js文件。这将确保浏览器在注册之前支持服务人员。如果已经有了，就省略第一行。</p><figure class="mq mr ms mt fd hk"><div class="bz dy l di"><div class="mu mv l"/></div></figure><h1 id="45e8" class="kq kr hx bd ks kt ku kv kw kx ky kz la jd lb je lc jg ld jh le jj lf jk lg lh bi translated">设置Firebase</h1><p id="c233" class="pw-post-body-paragraph jm jn hx jo b jp li iy jr js lj jb ju jv lk jx jy jz ll kb kc kd lm kf kg kh hb bi translated">现在，我们将<a class="ae ki" href="https://firebase.google.com/docs/web/setup" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy">通过创建一个新的Firebase应用程序来配置Firebase </strong> </a>，然后向Firebase注册您的web应用程序，添加您将使用的Firebase SDKs，并在您的应用程序中初始化Firebase。</p><p id="ec49" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">在使用<a class="ae ki" href="https://console.firebase.google.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy"> Firebase控制台</strong> </a>创建您的Firebase应用程序后，通过单击Firebase控制台中的web图标向Firebase注册您的应用程序。输入应用程序的名称，然后单击注册按钮。</p><p id="0227" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">有几个选项可以将Firebase SDK添加到您的应用程序中。在本指南中，我们将使用npm将Firebase SDKs添加到index.js文件和服务工作器中。</p><p id="6421" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">要在我们的index.js文件中导入Firebase的SDK，请安装Firebase包NPM install–save Firebase。</p><p id="cf9b" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">要在应用程序中初始化Firebase，请使用在Firebase控制台中注册应用程序时提供的详细信息。确保使用您自己的配置详细信息。</p><p id="ab03" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">将以下内容添加到index.js文件中。</p><figure class="mq mr ms mt fd hk"><div class="bz dy l di"><div class="mu mv l"/></div></figure><p id="7d60" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">接下来，将以下内容添加到您的根文件夹中的firebase-messaging-sw.js中，以便在service worker中配置firebase。这将允许我们稍后配置后台通知。确保从Firebase控制台使用messagingSenderId。</p><p id="bbc2" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">另外，一定要更新下面的代码片段，以使用最新的<a class="ae ki" href="https://firebase.google.com/docs/web/setup#additional_setup_options" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy"> Firebase JS版本</strong> </a>。</p><figure class="mq mr ms mt fd hk"><div class="bz dy l di"><div class="mu mv l"/></div></figure><h1 id="c83b" class="kq kr hx bd ks kt ku kv kw kx ky kz la jd lb je lc jg ld jh le jj lf jk lg lh bi translated">设置Firebase消息传递</h1><p id="5e4a" class="pw-post-body-paragraph jm jn hx jo b jp li iy jr js lj jb ju jv lk jx jy jz ll kb kc kd lm kf kg kh hb bi translated">接下来，我们将<a class="ae ki" href="https://firebase.google.com/docs/cloud-messaging/js/client#configure_web_credentials_in_your_app" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy">配置我们的应用</strong> </a>来使用Firebase云消息传递。</p><p id="cb56" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">如果没有，在根目录下创建一个manifest.json文件，并添加以下内容。不要更改gcm_sender_id。</p><pre class="mq mr ms mt fd mw mx my mz aw na bi"><span id="6fab" class="mc kr hx mx b fi nb nc l nd ne">{<br/> "gcm_sender_id": "103953800507"<br/>}</span></pre><p id="a784" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">在你的Firebase控制台中生成一个<a class="ae ki" href="https://firebase.google.com/docs/cloud-messaging/js/client#generate_a_new_key_pair" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy">乏味的密钥对</strong> </a>。在index.js文件中，在Firebase初始化下面添加以下内容。这可以在Firebase控制台中找到:</p><p id="4f23" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">Firebase__console →项目概述→项目设置→云消息传递→ Web推送证书</p><ul class=""><li id="71ff" class="ln lo hx jo b jp jq js jt jv lp jz lq kd lr kh mb lt lu lv bi translated">连接到Sendbird。</li><li id="a2b9" class="ln lo hx jo b jp lw js lx jv ly jz lz kd ma kh mb lt lu lv bi translated">请求向用户显示通知的权限。</li><li id="37ec" class="ln lo hx jo b jp lw js lx jv ly jz lz kd ma kh mb lt lu lv bi translated">获取设备推送令牌。</li><li id="88e3" class="ln lo hx jo b jp lw js lx jv ly jz lz kd ma kh mb lt lu lv bi translated">向Sendbird注册设备推送令牌。</li><li id="7d5f" class="ln lo hx jo b jp lw js lx jv ly jz lz kd ma kh mb lt lu lv bi translated">在<a class="ae ki" href="https://dashboard.sendbird.com/auth/signin" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy"> Sendbird仪表板</strong> </a>中检查令牌是否已经为当前用户注册。</li></ul><blockquote class="kk kl km"><p id="d29f" class="jm jn kj jo b jp jq iy jr js jt jb ju kn jw jx jy ko ka kb kc kp ke kf kg kh hb bi translated">转到:Sendbird仪表板→用户→查找目标用户→推送令牌→ Android</p></blockquote><ul class=""><li id="45dc" class="ln lo hx jo b jp jq js jt jv lp jz lq kd lr kh mb lt lu lv bi translated">不要忘记在Sendbird仪表板中打开推送通知，并注册您的FCM凭据。</li></ul><blockquote class="kk kl km"><p id="4ed2" class="jm jn kj jo b jp jq iy jr js jt jb ju kn jw jx jy ko ka kb kc kp ke kf kg kh hb bi translated">转到:Sendbird仪表板→设置→通知→ FCM →添加凭据</p></blockquote><figure class="mq mr ms mt fd hk"><div class="bz dy l di"><div class="mu mv l"/></div></figure><p id="755e" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated"><a class="ae ki" href="https://firebase.google.com/docs/cloud-messaging/manage-tokens#update-tokens-on-a-regular-basis" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy">关于检查令牌变化，FCM推荐以下</strong> </a>:</p><p id="42fb" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">“无论您遵循什么样的计时模式，都要确保定期更新令牌。每月一次的更新频率可能会在电池影响与检测非活动注册令牌之间取得良好的平衡。通过进行刷新，您还可以确保任何变为非活动状态的设备在再次变为活动状态时都会刷新其注册。比每周更新更频繁没有任何好处。”</p><h1 id="a382" class="kq kr hx bd ks kt ku kv kw kx ky kz la jd lb je lc jg ld jh le jj lf jk lg lh bi translated">接收推送通知</h1><p id="bf7d" class="pw-post-body-paragraph jm jn hx jo b jp li iy jr js lj jb ju jv lk jx jy jz ll kb kc kd lm kf kg kh hb bi translated">默认情况下，Sendbird只会向离线用户发送推送通知，并在群组频道中接收消息。浏览器必须打开才能接收推送通知，但您的应用程序不必处于活动状态或前台。</p><p id="54ff" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">当用户在线时，有两种方式接收通知。如果您希望在用户连接时发送通知，最好使用channelEventListener的<a class="ae ki" href="https://docs.sendbird.com/javascript/event_handler#2_event_handler" rel="noopener ugc nofollow" target="_blank"><strong class="jo hy">on message received</strong></a>事件。</p><p id="34f2" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">可以在实例化新的Sendbird实例后立即添加处理程序。从onMessageReceived回调中，考虑您可以通过浏览器推送服务使用的相同的<a class="ae ki" href="https://developer.mozilla.org/en-US/docs/Web/API/notification" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy">通知</strong> </a>方法显示新消息的指示。</p><figure class="mq mr ms mt fd hk"><div class="bz dy l di"><div class="mu mv l"/></div></figure><p id="7ee4" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">或者，在Sendbird仪表板中:</p><p id="c5c9" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">进入设置→通知→选中“发送到离线和在线设备”。这意味着无论用户的在线状态如何，每条消息都将发送推送通知。</p><figure class="mq mr ms mt fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es nf"><img src="../Images/b3b538c7e8820e63eea05ae6b7be4dac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*VZNRojTfgkvl1kK6.png"/></div></div></figure><p id="68f8" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">代价是，如果用户碰巧在线，将有两条相同的消息到达设备。也就是说，经由FCM的一个推送通知将到达，并且经由websocket的一个实时消息也将到达。</p><h1 id="3e11" class="kq kr hx bd ks kt ku kv kw kx ky kz la jd lb je lc jg ld jh le jj lf jk lg lh bi translated">Sendbird Dashboard的推送通知工具</h1><p id="f56d" class="pw-post-body-paragraph jm jn hx jo b jp li iy jr js lj jb ju jv lk jx jy jz ll kb kc kd lm kf kg kh hb bi translated">推送通知工具内置在Sendbird仪表板中，将向专用通道发送消息。</p><ol class=""><li id="2aef" class="ln lo hx jo b jp jq js jt jv lp jz lq kd lr kh ls lt lu lv bi translated">如果尚未添加，请添加您的FCM服务器密钥。</li></ol><figure class="mq mr ms mt fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ng"><img src="../Images/89930efa9e701c8204d8c67694fa6eb6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*NPOUKmchiyHBmcQA.png"/></div></div></figure><p id="19b8" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">2.选择您的目标用户并发送推送通知。</p><figure class="mq mr ms mt fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es nh"><img src="../Images/5ced26e9e8ef8b3a048024c70602344f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*EoRJJOqmj2Dycwsj.png"/></div></div></figure><p id="14d7" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">3.点击“发送”</p><p id="8aa3" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">4.Sendbird仪表板上的通知将指示推送通知是否被正确发送。</p><h1 id="53de" class="kq kr hx bd ks kt ku kv kw kx ky kz la jd lb je lc jg ld jh le jj lf jk lg lh bi translated">监听FCM数据消息(推送通知)</h1><p id="d720" class="pw-post-body-paragraph jm jn hx jo b jp li iy jr js lj jb ju jv lk jx jy jz ll kb kc kd lm kf kg kh hb bi translated">要设置我们的消息处理程序来处理推送通知的FCM数据消息，请将以下内容添加到firebase-messaging-sw.js文件中。</p><figure class="mq mr ms mt fd hk"><div class="bz dy l di"><div class="mu mv l"/></div></figure><p id="1e06" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">就是这样！现在，您应该能够在应用程序处于后台和/或前台时接收推送通知，这取决于您的Sendbird仪表板首选项。</p><h1 id="5963" class="kq kr hx bd ks kt ku kv kw kx ky kz la jd lb je lc jg ld jh le jj lf jk lg lh bi translated">可选项:不使用Sendbird进行测试</h1><p id="0c7a" class="pw-post-body-paragraph jm jn hx jo b jp li iy jr js lj jb ju jv lk jx jy jz ll kb kc kd lm kf kg kh hb bi translated">您可以检查推送通知设置是否在没有Sendbird的情况下工作。</p><ul class=""><li id="1e38" class="ln lo hx jo b jp jq js jt jv lp jz lq kd lr kh mb lt lu lv bi translated">Firebase团队还没有开发出向你的设备发送数据信息的用户界面。Sendbird只使用FCM数据消息。这意味着，毫无例外，没有办法使用Firebase控制台来测试与Sendbird相关的PWA推送通知。</li><li id="5881" class="ln lo hx jo b jp lw js lx jv ly jz lz kd ma kh mb lt lu lv bi translated">要测试FCM数据消息，请使用Postman并关闭应用程序中的所有选项卡:</li></ul><p id="745d" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated"><strong class="jo hy">a)</strong>POST→<a class="ae ki" href="https://firebase.google.com/docs/cloud-messaging/http-server-ref" rel="noopener ugc nofollow" target="_blank">T3】FCMT5】</a></p><p id="1453" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated"><strong class="jo hy"> b) </strong>标题:</p><p id="747d" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">i) <strong class="jo hy">键</strong>:内容类型，<strong class="jo hy">值</strong>:应用/json</p><p id="8dac" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">ii) <strong class="jo hy"> Key </strong>:授权，<strong class="jo hy">Value</strong>:<strong class="jo hy">Key =</strong>&lt;your-FCM-server-Key&gt;</p><p id="e960" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">-&gt; Your-FCM-Server-key→<a class="ae ki" href="https://console.firebase.google.com/" rel="noopener ugc nofollow" target="_blank"><strong class="jo hy">Firebase Console</strong></a>→您的项目→项目概述Cog →项目设置→云消息传递→服务器Key</p><p id="7c9c" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">收集设备令牌。</p><p id="3382" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">I)查看上面的index.js代码以获取设备令牌的日志，或者检查您是否已经从仪表板获取了设备令牌。</p><p id="edfb" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated"><strong class="jo hy"> d) </strong>身体</p><figure class="mq mr ms mt fd hk"><div class="bz dy l di"><div class="mu mv l"/></div></figure><h1 id="0fc7" class="kq kr hx bd ks kt ku kv kw kx ky kz la jd lb je lc jg ld jh le jj lf jk lg lh bi translated">图表:发送推送通知</h1><p id="551b" class="pw-post-body-paragraph jm jn hx jo b jp li iy jr js lj jb ju jv lk jx jy jz ll kb kc kd lm kf kg kh hb bi translated">请参考下表，查看根据连接状态、后台状态以及应用程序的选项卡是否处于活动状态而生成的通知类型:</p><p id="e8f9" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">默认:当所有设备脱机时发送。</p><figure class="mq mr ms mt fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ni"><img src="../Images/428f48924ca62de3730371cdea177f6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iLUOPkCaAZ4z4QAJKWEdGw.png"/></div></div></figure><p id="bd5a" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">发送到所有在线和离线设备:(仪表板→设置→通知)</p><figure class="mq mr ms mt fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es nj"><img src="../Images/def6cde27cbd913cc56b6f17421b965a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TohSYwZP6x9QAs4u3_6qdQ.png"/></div></div></figure><h1 id="47bd" class="kq kr hx bd ks kt ku kv kw kx ky kz la jd lb je lc jg ld jh le jj lf jk lg lh bi translated">结论</h1><p id="d5c2" class="pw-post-body-paragraph jm jn hx jo b jp li iy jr js lj jb ju jv lk jx jy jz ll kb kc kd lm kf kg kh hb bi translated">您的web应用程序现在可以使用Firebase从Sendbird发送聊天通知了！现在，您知道了如何向PWA发送推送通知来吸引用户。如有任何疑问，在Sendbird <a class="ae ki" href="http://community.sendbird.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy">社区</strong> </a>找我们。</p><p id="f2e0" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">万事如意！还有快乐的app搭建！💻 🚀</p></div></div>    
</body>
</html>