<html>
<head>
<title>Deploying a Kotlin app to Heroku (a Slack bot)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将Kotlin应用程序部署到Heroku(一个Slack机器人)</h1>
<blockquote>原文：<a href="https://medium.com/codex/creating-a-slack-bot-kotlin-and-deploying-it-in-heroku-32f884e39bea?source=collection_archive---------8-----------------------#2022-05-19">https://medium.com/codex/creating-a-slack-bot-kotlin-and-deploying-it-in-heroku-32f884e39bea?source=collection_archive---------8-----------------------#2022-05-19</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="96dc" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">这是创建和部署回复Slack命令的应用程序所需的最低要求。</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/f5a26f273f6225f50773636c1c9cbab6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VM9P4DjjNwwcVyKx"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">照片由<a class="ae jn" href="https://unsplash.com/es/@brett_jordan?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">布雷特·乔丹</a>在<a class="ae jn" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="5201" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">📝<em class="kk">您可能还想学习如何将Kotlin应用程序部署到Railway </em>  <em class="kk">。</em></p><h1 id="851b" class="kl km hi bd kn ko kp kq kr ks kt ku kv io kw ip kx ir ky is kz iu la iv lb lc bi translated">1.初始化项目</h1><ol class=""><li id="4586" class="ld le hi jq b jr lf ju lg jx lh kb li kf lj kj lk ll lm ln bi translated"><a class="ae jn" href="https://lsoares.medium.com/kotlin-gradle-junit-starter-project-a113a2cc9cbb" rel="noopener"> <strong class="jq hj">创建新的Kotlin项目</strong> </a> <strong class="jq hj">。</strong></li><li id="2e08" class="ld le hi jq b jr lo ju lp jx lq kb lr kf ls kj lk ll lm ln bi translated">如果你还没有做<code class="du lt lu lv lw b">git init</code>，你应该现在就做。Heroku需要Git，这样你就可以轻松地将它部署到Heroku。</li><li id="6862" class="ld le hi jq b jr lo ju lp jx lq kb lr kf ls kj lk ll lm ln bi translated">确保在根目录下有一个<code class="du lt lu lv lw b">.gitignore</code>文件，包含:</li></ol><pre class="iy iz ja jb fd lx lw ly lz aw ma bi"><span id="35e2" class="mb km hi lw b fi mc md l me mf">/.gradle<br/>/.idea<br/>/build</span></pre><h1 id="77ae" class="kl km hi bd kn ko kp kq kr ks kt ku kv io kw ip kx ir ky is kz iu la iv lb lc bi translated">2.Heroku应用程序</h1><p id="6d80" class="pw-post-body-paragraph jo jp hi jq b jr lf ij jt ju lg im jw jx mg jz ka kb mh kd ke kf mi kh ki kj hb bi translated">我们需要创建一个Heroku应用程序，为之前创建的Kotlin应用程序提供服务。这是基于官方的英雄文献。</p><ol class=""><li id="3807" class="ld le hi jq b jr js ju jv jx mj kb mk kf ml kj lk ll lm ln bi translated">安装Heroku CLI 。这提供了一种与Heroku互动的快捷方式——使用终端。</li><li id="2e60" class="ld le hi jq b jr lo ju lp jx lq kb lr kf ls kj lk ll lm ln bi translated">通过运行创建一个Heroku APP:<br/><code class="du lt lu lv lw b">heroku apps:create <strong class="jq hj">HEROKU_APP_NAME</strong></code><br/><em class="kk">Heroku _ APP _ NAME需要唯一。这将把当前的Git存储库绑定到Heroku应用程序。可以在</em> <a class="ae jn" href="https://dashboard.heroku.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="jq hj"> <em class="kk"> Heroku仪表盘</em> </strong> </a> <em class="kk">确认app存在。您可以通过在终端中运行</em> <code class="du lt lu lv lw b"><em class="kk">git remote -v</em></code> <em class="kk">来检查Git的设置。</em></li><li id="c676" class="ld le hi jq b jr lo ju lp jx lq kb lr kf ls kj lk ll lm ln bi translated">在Kotlin app的根文件夹下，创建一个名为<code class="du lt lu lv lw b">Procfile</code>的文件，内容如下:<br/> <code class="du lt lu lv lw b">web: java -jar build/libs/<strong class="jq hj">PROJ_ID</strong>-1.0-SNAPSHOT-all.jar</code> <br/>(要获取<code class="du lt lu lv lw b">PROJ_ID</code>，勾选<code class="du lt lu lv lw b">settings.gradle.kts</code>)。<br/> <em class="kk">这代表Heroku运行以启动web应用程序的命令。</em></li><li id="429f" class="ld le hi jq b jr lo ju lp jx lq kb lr kf ls kj lk ll lm ln bi translated"><em class="kk"> Heroku需要一个</em> <code class="du lt lu lv lw b"><em class="kk">stage</em></code> <em class="kk">目标。</em>在<code class="du lt lu lv lw b">build.gradle.kts</code>的底部，添加:</li></ol><pre class="iy iz ja jb fd lx lw mm bn mn mo bi"><span id="1571" class="mp km hi lw b be mq mr l ms mf">task("stage") {<br/>    dependsOn("shadowJar")<br/>}</span></pre><h1 id="bb89" class="kl km hi bd kn ko kp kq kr ks kt ku kv io kw ip kx ir ky is kz iu la iv lb lc bi translated">3.松弛螺栓应用程序</h1><ol class=""><li id="e9fa" class="ld le hi jq b jr lf ju lg jx lh kb li kf lj kj lk ll lm ln bi translated">将以下依赖项添加到<code class="du lt lu lv lw b">build.gradle.kts</code>:</li></ol><pre class="iy iz ja jb fd lx lw mm bn mn mo bi"><span id="de9c" class="mp km hi lw b be mq mr l ms mf">dependencies {<br/>  implementation("org.slf4j:slf4j-simple:1.+") <br/>  implementation("com.slack.api:bolt:1.+")<br/>  implementation("com.slack.api:bolt-servlet:1.+")<br/>  implementation("com.slack.api:bolt-jetty:1.+")<br/>}</span></pre><p id="1ba7" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">2.添加Gradle Shadow <code class="du lt lu lv lw b">build.gradle.kts</code> ( <em class="kk">这将允许创建一个单独的fat jar，稍后可以在Heroku </em>中运行):</p><pre class="iy iz ja jb fd lx lw mm bn mn mo bi"><span id="9d37" class="mp km hi lw b be mq mr l ms mf">plugins {<br/>   id("com.github.johnrengelman.shadow") version "7.+"<br/>   application<br/>}<br/>// at the bottom:<br/>application {<br/>    mainClass.set("SlackMainKt")<br/>}</span></pre><p id="ee02" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">📝<em class="kk">您可能需要单击IDE中文件右上角的按钮来刷新Gradle。</em></p><p id="29a4" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">3.在<code class="du lt lu lv lw b">src/main/kotlin/SlackMain.kt</code>，放:</p><pre class="iy iz ja jb fd lx lw mm bn mn mo bi"><span id="4bc4" class="mp km hi lw b be mq mr l ms mf">fun main() {<br/>   val app = App()<br/>   app.command("/hello") { _, _ -&gt;<br/>      Response.ok("world")<br/>   }<br/>   SlackAppServer(app, getenv("PORT")?.toInt() ?: 8080)<br/>       .start()<br/>}</span></pre><p id="4368" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">📝<code class="du lt lu lv lw b"><em class="kk">PORT</em></code> <em class="kk">是Heroku提供的环境变量。它代表Heroku公开的端口。因此，我们需要在该端口提供我们的应用程序。</em></p><p id="caa7" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">4.提交所有本地Git更改。</p><p id="f5d1" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">5.运行<code class="du lt lu lv lw b">git push heroku</code>将app部署到Heroku中(<em class="kk">其实第一次推送需要另外一个命令，但是消息会告诉是哪个</em>)。</p><h1 id="3abf" class="kl km hi bd kn ko kp kq kr ks kt ku kv io kw ip kx ir ky is kz iu la iv lb lc bi translated">4.松弛应用程序配置</h1><p id="81fd" class="pw-post-body-paragraph jo jp hi jq b jr lf ij jt ju lg im jw jx mg jz ka kb mh kd ke kf mi kh ki kj hb bi translated"><em class="kk">基于官方文档:</em> <a class="ae jn" href="https://api.slack.com/start/building/bolt-java" rel="noopener ugc nofollow" target="_blank"> <em class="kk">用Bolt搭建app for Java</em></a><em class="kk"/><a class="ae jn" href="https://slack.dev/java-slack-sdk/guides/getting-started-with-bolt" rel="noopener ugc nofollow" target="_blank"><em class="kk">入门Bolt </em> </a> <em class="kk">。</em></p><ol class=""><li id="ed71" class="ld le hi jq b jr js ju jv jx mj kb mk kf ml kj lk ll lm ln bi translated">进入<a class="ae jn" href="https://api.slack.com/apps" rel="noopener ugc nofollow" target="_blank"> <strong class="jq hj">松弛应用</strong> </a>点击“创建新应用”。</li><li id="1666" class="ld le hi jq b jr lo ju lp jx lq kb lr kf ls kj lk ll lm ln bi translated">选择“从头开始”,单击“下一步”,命名应用程序，将其分配到工作区。</li><li id="a86d" class="ld le hi jq b jr lo ju lp jx lq kb lr kf ls kj lk ll lm ln bi translated">在左侧菜单中，转到“OAuth &amp; Permissions”，滚动到“Scopes”，添加<code class="du lt lu lv lw b">chat:write</code>。</li><li id="4091" class="ld le hi jq b jr lo ju lp jx lq kb lr kf ls kj lk ll lm ln bi translated">在菜单中，单击“斜杠命令”υ“创建新命令”。</li><li id="dfd0" class="ld le hi jq b jr lo ju lp jx lq kb lr kf ls kj lk ll lm ln bi translated">用<br/> <strong class="jq hj">命令</strong> : <code class="du lt lu lv lw b">hello<br/></code> <strong class="jq hj">请求URL </strong> : <code class="du lt lu lv lw b">BASE_APP_URL/slack/events<br/></code>获取<code class="du lt lu lv lw b">BASE_APP_URL</code>，在终端运行<code class="du lt lu lv lw b">heroku apps:info</code>(就是<code class="du lt lu lv lw b">Web URL</code>)。<br/> <strong class="jq hj">简短描述</strong> : <code class="du lt lu lv lw b">hello world<br/></code>保存更改。</li><li id="148e" class="ld le hi jq b jr lo ju lp jx lq kb lr kf ls kj lk ll lm ln bi translated"><em class="kk">我们需要将Slack环境变量从Slack UI复制到Heroku。</em>要做到:进入“基本信息”υ“App凭据”υ“签约秘笈”υ点击“显示”υ复制即可。进入<a class="ae jn" href="https://dashboard.heroku.com/" rel="noopener ugc nofollow" target="_blank"> Heroku Dashboard </a>选择已创建的应用程序▽“Settings”▽“Reveal Config Vars”▽添加一个名为<code class="du lt lu lv lw b">SLACK_SIGNING_SECRET</code>的新应用程序，使用之前复制的值。</li><li id="760a" class="ld le hi jq b jr lo ju lp jx lq kb lr kf ls kj lk ll lm ln bi translated">返回Slack UI，转到“OAuth &amp; Permissions”，单击“Install to Workspace”按钮，复制“Bot User OAuth Token”处的值。返回Heroku创建另一个名为<code class="du lt lu lv lw b">SLACK_BOT_TOKEN</code>的环境变量，粘贴复制的值。</li><li id="c666" class="ld le hi jq b jr lo ju lp jx lq kb lr kf ls kj lk ll lm ln bi translated"><em class="kk">该测试app了！</em>转到松弛本身▶在任意频道键入<code class="du lt lu lv lw b">/hello</code>按回车键；你应该得到<code class="du lt lu lv lw b">world</code>作为回复。</li></ol><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mt"><img src="../Images/90728d81fa605c0657afd7569d9c9951.png" data-original-src="https://miro.medium.com/v2/resize:fit:388/format:webp/1*_u3TKlYAKfb36tICY-x95g.png"/></div></figure><p id="601e" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">📝<em class="kk">如果有问题，可以在终端中调用</em> <code class="du lt lu lv lw b"><em class="kk">heroku logs --tail</em></code> <em class="kk">。</em></p></div><div class="ab cl mu mv gp mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="hb hc hd he hf"><div class="iy iz ja jb fd nb"><a href="https://github.com/lsoares/slack-bot-kotlin-sample" rel="noopener  ugc nofollow" target="_blank"><div class="nc ab dw"><div class="nd ab ne cl cj nf"><h2 class="bd hj fi z dy ng ea eb nh ed ef hh bi translated">GitHub-lsoares/slack-bot-kot Lin-sample</h2><div class="ni l"><h3 class="bd b fi z dy ng ea eb nh ed ef dx translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="nj l"><p class="bd b fp z dy ng ea eb nh ed ef dx translated">github.com</p></div></div><div class="nk l"><div class="nl l nm nn no nk np jh nb"/></div></div></a></div></div></div>    
</body>
</html>