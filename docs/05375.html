<html>
<head>
<title>Creating a GraphQL API with NextJS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用NextJS创建GraphQL API</h1>
<blockquote>原文：<a href="https://medium.com/codex/creating-a-graphql-api-with-nextjs-ef51a0f6e6ed?source=collection_archive---------1-----------------------#2022-02-23">https://medium.com/codex/creating-a-graphql-api-with-nextjs-ef51a0f6e6ed?source=collection_archive---------1-----------------------#2022-02-23</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="195e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">可以用GraphQL为什么要用REST？</em></p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/bf603a930ac5504f43a9f5a6accf1c8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T4x-7hDVPZs2wG59gB7yVg.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">来自<a class="ae ju" href="https://graphql.org/" rel="noopener ugc nofollow" target="_blank">官方网站</a>的GraphQL标志。</figcaption></figure><p id="33ce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">REST是几年前发明的，它可能会过时，但是，我们仍然有更现代的替代品，每天都有成百上千的贡献者在工作。GraphQL最初由脸书内部使用，几年前就已经公开了，现在用它创建一个好的API比以往任何时候都容易。</p><p id="8c03" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，我们正在构建一个与GraphQL协同工作的简单API。我们将在NextJS中构建我们的示例，这是一个很好的框架，可以快速制作像这样的测试应用程序。它使用React进行渲染。除了一些基础知识，我不会讲太多。让我们开始吧。</p></div><div class="ab cl jv jw gp jx" role="separator"><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka"/></div><div class="hb hc hd he hf"><h1 id="6247" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">安装</h1><p id="0689" class="pw-post-body-paragraph if ig hi ih b ii la ik il im lb io ip iq lc is it iu ld iw ix iy le ja jb jc hb bi translated">首先，我们需要建立我们的项目。我们将从创建一个简单的NextJS网页和一个简单的NextJS API路由开始。这两件事都很简单，我将在这里解释如何做。</p><p id="1b6c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们需要初始化NPM，并为一个简单的NextJS项目添加所需的包。我将<strong class="ih hj">而不是</strong>使用Next的create-app命令。</p><pre class="jf jg jh ji fd lf lg lh li aw lj bi"><span id="1d22" class="lk kd hi lg b fi ll lm l ln lo">npm init -y<br/>npm i next react react-dom</span></pre><p id="4ada" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，我们需要创建一个名为<code class="du lp lq lr lg b">pages</code>的新文件夹和一个名为<code class="du lp lq lr lg b">index.js</code>的页面。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="ls lt l"/></div></figure><p id="b3b9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后我们需要更新<code class="du lp lq lr lg b">package.json</code>来包含下面的脚本。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="ls lt l"/></div></figure><p id="62e2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，您可以通过在控制台中运行以下命令来运行基本网页。</p><pre class="jf jg jh ji fd lf lg lh li aw lj bi"><span id="2d3c" class="lk kd hi lg b fi ll lm l ln lo">npm run dev</span></pre><p id="99fc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它将在<code class="du lp lq lr lg b">localhost:3000</code>上运行服务器。</p></div><div class="ab cl jv jw gp jx" role="separator"><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka"/></div><div class="hb hc hd he hf"><h1 id="fdd8" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">添加基本API</h1><p id="cf52" class="pw-post-body-paragraph if ig hi ih b ii la ik il im lb io ip iq lc is it iu ld iw ix iy le ja jb jc hb bi translated">要为NextJS创建一个基础API，我们需要在<code class="du lp lq lr lg b">pages</code>中添加一个名为<code class="du lp lq lr lg b">api</code>的文件夹，并为一个基础API添加另一个文件。我们称之为<code class="du lp lq lr lg b">books.js</code>。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="ls lt l"/></div></figure><p id="ea30" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当您再次使用<code class="du lp lq lr lg b">npm run dev</code>运行这段代码，并浏览到<code class="du lp lq lr lg b">localhost:3000/api/books</code>时，您将看到我们返回的JSON。现在是时候添加更多的功能，并真正添加GraphQL了。这将在另一个名为<code class="du lp lq lr lg b">graphql.js</code>的文件中完成。</p></div><div class="ab cl jv jw gp jx" role="separator"><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka"/></div><div class="hb hc hd he hf"><h1 id="791f" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">添加GraphQL API</h1><p id="cde2" class="pw-post-body-paragraph if ig hi ih b ii la ik il im lb io ip iq lc is it iu ld iw ix iy le ja jb jc hb bi translated">我们将大致按照NextJS的<a class="ae ju" href="https://github.com/vercel/next.js/blob/canary/examples/api-routes-graphql/" rel="noopener ugc nofollow" target="_blank">示例</a>进行一些小的调整。接下来我们将使用<code class="du lp lq lr lg b">micro</code>和<code class="du lp lq lr lg b">apollo-server-micro</code>来设置一个简单的GraphQL服务器作为API路由。我们将使用<code class="du lp lq lr lg b">apollo-server-core</code>作为一个有用的小GraphQL平台。</p><pre class="jf jg jh ji fd lf lg lh li aw lj bi"><span id="e185" class="lk kd hi lg b fi ll lm l ln lo">npm i micro apollo-server-micro graphql apollo-server-core</span></pre><p id="ece8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在<code class="du lp lq lr lg b">api</code>文件夹中，创建名为<code class="du lp lq lr lg b">graphql.js</code>的新文件。我们将在其中使用这些包，并添加我们的模式和其他与GraphQL相关的代码。</p><p id="0865" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">由于这不是一篇关于GraphQL本身的文章，我将回顾一下基础知识，但不会展示太多与API无关的内容。对于API，我们需要创建一个简单的图书列表、该列表的模式和一个我们可以调用的解析器。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="ls lt l"/></div></figure><p id="fd2a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们首先定义一个图书列表并设置<code class="du lp lq lr lg b">typeDefs</code>。我们定义了<code class="du lp lq lr lg b">Book</code>类型，并设置了一个返回所有书籍的查询。我们现在也可以为这个<code class="du lp lq lr lg b">getBooks</code>函数编写解析器，这样GraphQL也可以使用它。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="ls lt l"/></div></figure><p id="3e7c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这种情况下，它只是返回我们的列表。如果需要，我们可以进行更高级的查询，但这对于本文来说不是必需的。让我们通过添加适当的Apollo服务器代码来结束<code class="du lp lq lr lg b">graphql.js</code>。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="ls lt l"/></div></figure><p id="30d7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当我们运行<code class="du lp lq lr lg b">npm run dev</code>并浏览到<code class="du lp lq lr lg b">localhost:3000/api/graphql</code>时，您将看到我们在文档中输入的所有数据。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lu"><img src="../Images/83fbecd0a06700081084fd8b4f87d0cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J4oAk9b6CGo-agxQmFVTcQ.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">打开文档的GraphQL操场。</figcaption></figure><p id="0df2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，您可以像上面设置的那样运行一个查询来获取每本书的所有名称。</p><h2 id="e817" class="lk kd hi bd ke lv lw lx ki ly lz ma km iq mb mc kq iu md me ku iy mf mg ky mh bi translated">如何从网页调用GraphQL？</h2><p id="da81" class="pw-post-body-paragraph if ig hi ih b ii la ik il im lb io ip iq lc is it iu ld iw ix iy le ja jb jc hb bi translated">为此，我们将使用Axios。我们先装Axios，之后再看代码。</p><pre class="jf jg jh ji fd lf lg lh li aw lj bi"><span id="3798" class="lk kd hi lg b fi ll lm l ln lo">npm i axios</span></pre><p id="ccac" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我写了一些关于Axios的文章，所以我不会详细讨论它是如何工作的，但它本质上是一个基于Promise的HTTP请求库。我们在POST请求的<code class="du lp lq lr lg b">data</code>中设置GraphQL查询。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="ls lt l"/></div></figure><p id="b99f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是在我们网站的主页<code class="du lp lq lr lg b">index.js</code>内。当您运行这个程序时，您将从屏幕上显示的GraphQL API中获取数据。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mi"><img src="../Images/8e2cf6ce75ab104c43e6743ad45d71c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7wjh8Ss6dE9qLabh1uB-gw.png"/></div></div></figure><p id="c7a7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当然，您现在可以根据需要以任何方式使用这些数据。但是我们现在有一个可用的API。阅读所有代码，尤其是GraphQL的解析器、模式和文档，看看这有多强大。</p></div><div class="ab cl jv jw gp jx" role="separator"><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka"/></div><div class="hb hc hd he hf"><h1 id="621a" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">结论</h1><p id="a076" class="pw-post-body-paragraph if ig hi ih b ii la ik il im lb io ip iq lc is it iu ld iw ix iy le ja jb jc hb bi translated">GraphQL在大型应用程序中确实非常强大，但是必须为您想做的任何事情更新模式和解析器会非常烦人。不过，我现在肯定会更经常地使用它。</p><p id="ab86" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">非常感谢您的阅读，祝您度过美好的一天。</p><p id="af63" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae ju" href="https://mbvissers.medium.com/membership" rel="noopener">支持我支持介质，成为会员</a>。它帮了我很大的忙，它不会额外花费你，你可以阅读尽可能多的中等文章！</p><p id="d60e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在<a class="ae ju" href="https://twitter.com/0xmbvissers" rel="noopener ugc nofollow" target="_blank"> Twitter </a>和<a class="ae ju" href="https://gm.xyz/u/mbvissers.eth" rel="noopener ugc nofollow" target="_blank"> gm.xyz </a>上关注我。</p><p id="4e27" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在此查看我是<a class="ae ju" href="https://kangaroomob.io/" rel="noopener ugc nofollow" target="_blank">的开发人员的项目。</a></p><p id="2172" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在Polygon上查看我最新的<a class="ae ju" href="https://www.pixel-pizzas.com/" rel="noopener ugc nofollow" target="_blank"> NFT收藏</a>。</p></div></div>    
</body>
</html>