<html>
<head>
<title>Creating a basic dApp with Web3 and NextJS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Web3和NextJS创建一个基本的dApp</h1>
<blockquote>原文：<a href="https://medium.com/codex/creating-a-basic-dapp-with-web3-and-nextjs-2ee94af06517?source=collection_archive---------0-----------------------#2021-09-12">https://medium.com/codex/creating-a-basic-dapp-with-web3-and-nextjs-2ee94af06517?source=collection_archive---------0-----------------------#2021-09-12</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="9b3f" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated"><em class="ix">将去中心化与JAMstack相结合，实现快速dApp。</em></h2></div><figure class="iz ja jb jc fd jd er es paragraph-image"><div role="button" tabindex="0" class="je jf di jg bf jh"><div class="er es iy"><img src="../Images/8ed5ba97f7f4319b89a2e909317814bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Bl1AN2aXS3Er5kIIaQmUgw.jpeg"/></div></div><figcaption class="jk jl et er es jm jn bd b be z dx translated"><a class="ae jo" href="https://unsplash.com/@executium?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">行政</a>在<a class="ae jo" href="https://unsplash.com/s/photos/ethereum?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</figcaption></figure><p id="a279" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">分散式应用程序有各种形状和大小。我们有分散的做市商、闪贷、加密游戏和简单的NFT网站。猜猜我们要做哪个？没错，简单的NFT。</p><p id="6e6f" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">本文将快速介绍设置NextJS、下载Web3和MetaMask，并且我们将回顾从区块链获取数据和发送铸造或购买NFT的简单事务的基础知识。</p></div><div class="ab cl kl km gp kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="hb hc hd he hf"><h1 id="de43" class="ks kt hi bd ku kv kw kx ky kz la lb lc io ld ip le ir lf is lg iu lh iv li lj bi translated">安装</h1><p id="96bc" class="pw-post-body-paragraph jp jq hi jr b js lk ij ju jv ll im jx jy lm ka kb kc ln ke kf kg lo ki kj kk hb bi translated">让我们为我们的dApp准备好一切。我们需要一个简单的区块链合同和一个MetaMask钱包。</p><h2 id="0711" class="lp kt hi bd ku lq lr ls ky lt lu lv lc jy lw lx le kc ly lz lg kg ma mb li mc bi translated">元掩码</h2><p id="f00b" class="pw-post-body-paragraph jp jq hi jr b js lk ij ju jv ll im jx jy lm ka kb kc ln ke kf kg lo ki kj kk hb bi translated">我们将使用元掩码连接到我们的dApp。我写了一篇关于制作新钱包的文章<a class="ae jo" rel="noopener" href="/quick-programming/opening-a-metamask-wallet-for-cryptocurrencies-the-quick-guide-f28bdd8d6c00">这里</a>。如果你像我一样使用Polygon，我已经写了另一篇关于在Polygon <a class="ae jo" rel="noopener" href="/codex/setting-up-metamask-for-polygon-blockchain-development-af058d0fab2e">这里</a>设置你的钱包进行开发的文章。</p><h2 id="3337" class="lp kt hi bd ku lq lr ls ky lt lu lv lc jy lw lx le kc ly lz lg kg ma mb li mc bi translated">智能合同</h2><p id="90f5" class="pw-post-body-paragraph jp jq hi jr b js lk ij ju jv ll im jx jy lm ka kb kc ln ke kf kg lo ki kj kk hb bi translated">我将使用部署在Polygon Mumbai testnet上的智能合约。合同将符合<a class="ae jo" href="https://docs.openzeppelin.com/contracts/4.x/api/token/erc721" rel="noopener ugc nofollow" target="_blank"> ERC721标准</a>。因为这篇文章不是关于可靠性和智能合同的，所以我不会深入讨论细节。我将调用标准的ERC721函数。如果你想了解更多，你可以点击这里查看这篇文章。</p><h2 id="dc1a" class="lp kt hi bd ku lq lr ls ky lt lu lv lc jy lw lx le kc ly lz lg kg ma mb li mc bi translated">Web3和NextJS</h2><p id="80f4" class="pw-post-body-paragraph jp jq hi jr b js lk ij ju jv ll im jx jy lm ka kb kc ln ke kf kg lo ki kj kk hb bi translated">我们需要使用NPM安装Web3和Next。您可以通过运行以下命令来实现这一点:</p><pre class="iz ja jb jc fd md me mf mg aw mh bi"><span id="2de2" class="lp kt hi me b fi mi mj l mk ml"><strong class="me hj">npm i web3 next react react-dom</strong></span></pre><p id="92d4" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">Web3是一个连接钱包的工具，还有其他一些有用的功能，比如计算来自ETH的Wei，NextJS是一个网站建设的框架。</p><p id="f690" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">创建一个名为<code class="du mm mn mo me b">pages</code>的文件夹，并在其中创建<code class="du mm mn mo me b">index.js</code>。这是我们NextJS的主页。</p><figure class="iz ja jb jc fd jd"><div class="bz dy l di"><div class="mp mq l"/></div></figure><p id="7e12" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">我们将导入React以及<code class="du mm mn mo me b">useState</code>和<code class="du mm mn mo me b">useEffect</code>，稍后我们将使用它们。我们还导入了Web3并创建了一个简单的页面。您可以使用以下命令运行代码:</p><pre class="iz ja jb jc fd md me mf mg aw mh bi"><span id="2667" class="lp kt hi me b fi mi mj l mk ml"><strong class="me hj">next dev</strong></span></pre></div><div class="ab cl kl km gp kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="hb hc hd he hf"><h1 id="355c" class="ks kt hi bd ku kv kw kx ky kz la lb lc io ld ip le ir lf is lg iu lh iv li lj bi translated">寻找Web3</h1><p id="8719" class="pw-post-body-paragraph jp jq hi jr b js lk ij ju jv ll im jx jy lm ka kb kc ln ke kf kg lo ki kj kk hb bi translated">每当扩展安装并激活时，MetaMask就将<code class="du mm mn mo me b">window.ethereum</code>对象注入到我们的浏览器中。当我们的页面加载到一个<code class="du mm mn mo me b">useEffect</code>钩子中，并把它放入我们的状态以备后用时，我们就这样做。</p><figure class="iz ja jb jc fd jd"><div class="bz dy l di"><div class="mp mq l"/></div></figure><p id="bbf3" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">这段代码应该在<code class="du mm mn mo me b">return</code>语句之前的<code class="du mm mn mo me b">Index()</code>函数中。当我们的页面被加载时，它将调用我们的<code class="du mm mn mo me b">useEffect</code>函数，在这个函数中，我们使用一个<a class="ae jo" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Conditional_Operator" rel="noopener ugc nofollow" target="_blank">三元运算符</a>来检查<code class="du mm mn mo me b">window.ethereum</code>对象。</p><p id="2e1e" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">如果找到了对象，我们将Web3对象设置为React状态，并从元掩码中设置登录地址，我们稍后需要使用它。如果运行这段代码，您应该会看到一个元掩码弹出窗口，要求您进行连接。</p><p id="f01e" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">尝试添加<code class="du mm mn mo me b">console.log</code>函数来记录控制台中的地址和Web3对象，这样您就可以检查它们的设置了。</p></div><div class="ab cl kl km gp kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="hb hc hd he hf"><h1 id="ebf8" class="ks kt hi bd ku kv kw kx ky kz la lb lc io ld ip le ir lf is lg iu lh iv li lj bi translated">ABI和调用合约函数</h1><p id="5ddd" class="pw-post-body-paragraph jp jq hi jr b js lk ij ju jv ll im jx jy lm ka kb kc ln ke kf kg lo ki kj kk hb bi translated">为了能够用我们新创建的<code class="du mm mn mo me b">web3</code>对象调用函数，我们需要在代码中添加智能契约的ABI。我们需要ABI将一个契约对象添加到我们的状态中，我们可以从中调用函数。</p><h2 id="c8db" class="lp kt hi bd ku lq lr ls ky lt lu lv lc jy lw lx le kc ly lz lg kg ma mb li mc bi translated">获得ABI奖</h2><p id="4688" class="pw-post-body-paragraph jp jq hi jr b js lk ij ju jv ll im jx jy lm ka kb kc ln ke kf kg lo ki kj kk hb bi translated">我知道我的ABI正在使用<a class="ae jo" href="http://remix.ethereum.org/" rel="noopener ugc nofollow" target="_blank"> Remix </a>，一个在线Solidity IDE和编译器。添加一个新文件，并将您的智能合约代码粘贴到编辑器中。右键单击Remix中的新文件，然后单击编译。转到左边的编译标签，点击小小的<code class="du mm mn mo me b">ABI</code>按钮来复制你的ABI。将它粘贴到我们代码中states下的一个新变量中。</p><figure class="iz ja jb jc fd jd er es paragraph-image"><div class="er es mr"><img src="../Images/1c7ee2ebb5cf31d471e5ef2fe4548340.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*W2HatfoHCSEFMHvLFjLhkQ.png"/></div><figcaption class="jk jl et er es jm jn bd b be z dx translated">在复制ABI之前，请确保选择您自己的合同</figcaption></figure><p id="28e2" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">现在，我们可以将它添加到现有代码之间的代码中。</p><figure class="iz ja jb jc fd jd"><div class="bz dy l di"><div class="mp mq l"/></div></figure><p id="107b" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">ABI是我们在JSON中的可靠性代码的表示，因此Web3知道它可以调用什么，以及期望从代码中得到什么。</p><h2 id="f5dc" class="lp kt hi bd ku lq lr ls ky lt lu lv lc jy lw lx le kc ly lz lg kg ma mb li mc bi translated">调用合同视图功能</h2><p id="36ce" class="pw-post-body-paragraph jp jq hi jr b js lk ij ju jv ll im jx jy lm ka kb kc ln ke kf kg lo ki kj kk hb bi translated">从Web3调用契约函数有两种方法。要看函数的类型才知道用哪个。对于<code class="du mm mn mo me b">view</code>函数，以及不需要加油费的函数，我们可以使用我们新的<code class="du mm mn mo me b">contract</code>状态来调用</p><pre class="iz ja jb jc fd md me mf mg aw mh bi"><span id="02af" class="lp kt hi me b fi mi mj l mk ml"><strong class="me hj">contract.methods.your_contract_function().call()</strong></span></pre><p id="ccbe" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">这将返回一个JavaScript <code class="du mm mn mo me b">Promise</code>，我们可以使用<code class="du mm mn mo me b">then()</code>来解析它。</p><figure class="iz ja jb jc fd jd"><div class="bz dy l di"><div class="mp mq l"/></div></figure><p id="9110" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">您现在可以在<code class="du mm mn mo me b">return</code>语句中添加一个变量来显示我们的令牌的总供应量。</p><p id="efb3" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated"><em class="ms">我最初遇到的一个问题是，</em> <code class="du mm mn mo me b"><em class="ms">useEffect</em></code> <em class="ms">中的</em> <code class="du mm mn mo me b"><em class="ms">contract</em></code> <em class="ms">而不是</em> <code class="du mm mn mo me b"><em class="ms">c</em></code> <em class="ms">调用没有返回任何内容。请注意，更新状态可能需要很短的时间，如果可以，请从源而不是状态调用它。</em></p><h2 id="a52d" class="lp kt hi bd ku lq lr ls ky lt lu lv lc jy lw lx le kc ly lz lg kg ma mb li mc bi translated">调用消耗汽油的合同函数</h2><p id="fa35" class="pw-post-body-paragraph jp jq hi jr b js lk ij ju jv ll im jx jy lm ka kb kc ln ke kf kg lo ki kj kk hb bi translated">一个合同可以有一个<code class="du mm mn mo me b">payable</code>功能。如果我们想的话，我们可以从那里得到报酬。其他功能如<code class="du mm mn mo me b">mint</code>也将收取用户燃气费。这些功能需要以不同的方式调用，以便我们的用户可以接受费用和付款。</p><figure class="iz ja jb jc fd jd"><div class="bz dy l di"><div class="mp mq l"/></div></figure><p id="2fde" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">我们需要<code class="du mm mn mo me b">request</code>一笔交易。这将从MetaMask弹出一个窗口提示用户接受付款和汽油费。在这种情况下，付款将是1 ETH，或1 MATIC，如果你在多边形。<strong class="jr hj">价格需要在魏而不是ETH </strong>发送。</p><p id="fdb7" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated"><em class="ms">标准的ERC721合约不需要价格，也没有</em> <code class="du mm mn mo me b"><em class="ms">payable</em></code> <em class="ms">的造币功能。我认为了解如何去做是很重要的，所以我把它包括在内，就好像它会被写进合同一样。</em></p><p id="6bfa" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">我们请求交易，如果交易被接受，我们将提醒用户交易散列，他或她可以在Etherscan或Polygonscan上检查。</p></div><div class="ab cl kl km gp kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="hb hc hd he hf"><h1 id="085f" class="ks kt hi bd ku kv kw kx ky kz la lb lc io ld ip le ir lf is lg iu lh iv li lj bi translated">结论</h1><p id="1bd4" class="pw-post-body-paragraph jp jq hi jr b js lk ij ju jv ll im jx jy lm ka kb kc ln ke kf kg lo ki kj kk hb bi translated">这看起来好像教程遗漏了一些信息，但事实并非如此。除了HTML和CSS，我的第一个NFT项目没有比这更多的代码。我得到总供应量，我得到用户的地址，如果用户想铸造一个，他会得到如上的提示。</p><p id="64de" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">完整的(粗略的和未经测试的)代码可以在<a class="ae jo" href="https://gist.github.com/mbvissers/ad96c21706d25194be6f30b076eb25c1" rel="noopener ugc nofollow" target="_blank">这里找到</a>来帮助把代码片段拼凑在一起。</p><p id="973b" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">非常感谢您的阅读，祝您有美好的一天，并祝您自己的项目好运。</p><p id="40a1" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated"><em class="ms">在</em> <a class="ae jo" href="https://twitter.com/MVissers4" rel="noopener ugc nofollow" target="_blank"> <em class="ms"> Twitter上查看我的</em> </a> <em class="ms">在多边形网上查看我的</em> <a class="ae jo" href="https://www.cryptoconcoctions.com/" rel="noopener ugc nofollow" target="_blank"> <em class="ms"> NFT收藏</em> </a> <em class="ms">！</em></p><p id="2f44" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated"><a class="ae jo" href="https://mbvissers.medium.com/membership" rel="noopener"> <em class="ms">成为中等会员</em> </a> <em class="ms">享受万千博主的内容。</em></p></div></div>    
</body>
</html>