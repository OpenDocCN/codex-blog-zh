<html>
<head>
<title>Whose Tweet Was It Originally?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">最初是谁的推文？</h1>
<blockquote>原文：<a href="https://medium.com/codex/whose-tweet-was-it-originally-f746d4058e6f?source=collection_archive---------5-----------------------#2022-03-15">https://medium.com/codex/whose-tweet-was-it-originally-f746d4058e6f?source=collection_archive---------5-----------------------#2022-03-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="7734" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">使用Tweepy (Twitter API v2)分析原始推文和转发，并使用Squarify可视化它们</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/54989e7ef40dcdd69a377fdb78edccdd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*L_eOC6BKpBMifudJ"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">Souvik Banerjee 在<a class="ae jn" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="97a4" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">Twitter，这个名字你应该很熟悉。拥有超过<a class="ae jn" href="https://backlinko.com/twitter-users" rel="noopener ugc nofollow" target="_blank"> 3亿总用户</a>和超过2亿日活跃用户，是世界上最大的社交媒体平台之一。Twitter的功能之一是Retweet(RT)——用户可以在自己的feed上分享他人的推文，同时保留原始来源的信用。</p><p id="1360" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">但是，一个Twitter账户上原创推文和转发推文的实际比例是多少呢？我最初的猜测是，一个账户应该有更多的原创推文，而不是转发。说实话，我以前从来没有真正想过。但是有一天一个我很亲近的人来找我，说乌普萨拉大学的媒体和通信系(<a class="ae jn" href="https://twitter.com/uu_media_comms" rel="noopener ugc nofollow" target="_blank"> @uu_media_comms </a>)的转发量可能比原始推文还多。这次谈话让我想到了Tweepy的推特分析。</p></div><div class="ab cl kk kl gp km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="hb hc hd he hf"><p id="dbfd" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">根据其<a class="ae jn" href="https://www.tweepy.org/" rel="noopener ugc nofollow" target="_blank">文档</a>，Tweepy是一个易于使用的Python库，用于访问Twitter API。要开始使用Tweepy，我们首先必须创建一个Twitter开发人员帐户来访问它的API。幸运的是，这很容易在Twitter开发者页面上完成，并且有可能免费获得。免费选项为每个项目提供1个环境，每个项目每月提供50万条tweets，这在这种情况下已经足够了。</p><p id="bdef" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">一旦我们可以访问Twitter API，让我们从安装Tweepy开始。</p><pre class="iy iz ja jb fd kr ks kt ku aw kv bi"><span id="a98d" class="kw kx hi ks b fi ky kz l la lb">pip install tweepy</span></pre><p id="cc47" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">安装完成后，我们可以导入它并创建一个客户机对象。创建对象的所有参数都可以从您的Twitter开发人员帐户获得。</p><pre class="iy iz ja jb fd kr ks kt ku aw kv bi"><span id="c775" class="kw kx hi ks b fi ky kz l la lb">import tweepy</span><span id="086d" class="kw kx hi ks b fi lc kz l la lb"># create Client object</span><span id="16b2" class="kw kx hi ks b fi lc kz l la lb">client = tweepy.Client(bearer_token, consumer_key, consumer_secret, access_token, access_token_secret)</span></pre><p id="0b21" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">然后我们使用这个函数从一个Twitter帐户获取所有的tweets。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ld le l"/></div></figure><p id="5d01" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我将解释这个函数的主要操作。首先，我们需要获取用户ID(数字)作为获取推文的输入。因为我们知道用户名，所以我们可以使用这行代码获取用户id。</p><pre class="iy iz ja jb fd kr ks kt ku aw kv bi"><span id="10ca" class="kw kx hi ks b fi ky kz l la lb">user_id = client.get_user(username=username)[0].id</span></pre><p id="97f2" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">然后，我们可以用这行代码获取推文。</p><pre class="iy iz ja jb fd kr ks kt ku aw kv bi"><span id="4d70" class="kw kx hi ks b fi ky kz l la lb">tweets = client.get_users_tweets(user_id, max_results=100, pagination_token=tweets.meta.get('next_token'))</span></pre><p id="8b83" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">请注意，Twitter API只允许我们一次获取100条推文。为了获取下面的页面，定义<em class="lf"> pagination_token </em>参数很重要。</p><p id="fe36" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">然后，我们把它放在一个pandas dataframe中，用<em class="lf"> tweets.data中的<em class="lf"> id </em>属性作为tweet ID，用<em class="lf"> text </em>属性作为tweet内容。</em></p><p id="d061" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这是函数的结果。我们已经看到一些即时战略，但我们还不能确定。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lg"><img src="../Images/dd704732deda4a86cbcc9001c398d198.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*siQXGy43upZqKqFjpjA7cA.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">从@uu_media_comms获取推文(图片由作者提供)</figcaption></figure><p id="e780" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">为了进一步分析它是否是一个转发，我们使用这个函数。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ld le l"/></div></figure><p id="9ca6" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在这个函数中，我们在数据帧中添加了2列。第一列<em class="lf"> isRT </em>将显示该推文是否被转发。第二列<em class="lf"> RT_from </em>将显示发布该推文的原始帐户。</p><p id="a3ab" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这是函数的结果。我还检查了这个账户的转发次数，现在我们可以得出结论，这个账户的转发次数比原来的多。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lh"><img src="../Images/f12c0c5ab3877ad8d0aa080251775358.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c64mc-pqNhrxGlGfidcyRw.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">展示来自@uu_media_comms的RTs(图片由作者提供)</figcaption></figure><p id="f70b" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">虽然我们已经知道了第一个问题的答案，但如果我们挖掘得更深，可能会有更多有趣的见解。让我们来看看这个账户是谁使用这个功能转发的。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ld le l"/></div></figure><p id="9b34" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在这个函数中，我们使用这行代码显示了tweet的原始来源。</p><pre class="iy iz ja jb fd kr ks kt ku aw kv bi"><span id="19e0" class="kw kx hi ks b fi ky kz l la lb">df_plot = df['RT_from'].value_counts(dropna=False).rename_axis('username').reset_index(name='counts')</span></pre><p id="3a5d" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我们使用<em class="lf"> dropna=False </em>来计算None值。这很重要，因为没有值意味着这是一条原创推文。</p><p id="50d4" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这是函数的结果。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es li"><img src="../Images/aae570814691512bfe5743880cef4f68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CV0zGiT84xFYtauq5jWKWg.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">显示来自@uu_media_comms的RT计数(图片由作者提供)</figcaption></figure><p id="d8c6" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">看起来@mwkrzyzanowski占据了所有推文中高达56%的份额。从表面上看，这个人一定是@uu_media_comms的重要人物，因为超过一半的推文是他们转发的。在Twitter上快速浏览一下，显示此人是该部门的主席。我们也看到原创推文只占所有推文的不到四分之一。我还发现了一个小细节，这个账号转发了3次。</p><p id="fdc4" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我们已经发现了一个有趣的见解，但是将它可视化可能会让它更加引人注目。这一次，我将用<a class="ae jn" href="https://github.com/laserson/squarify" rel="noopener ugc nofollow" target="_blank"> Squarify </a>将数据绘制成树形图。像往常一样，首先我们需要安装Squarify。</p><pre class="iy iz ja jb fd kr ks kt ku aw kv bi"><span id="7609" class="kw kx hi ks b fi ky kz l la lb">pip install squarify</span></pre><p id="d33a" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">然后我们用这个函数来绘制数据。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ld le l"/></div></figure><p id="5deb" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我用各种Twitter账户测试了很多，这意味着我找到了我修复的各种边缘情况。但这里是主要部分。就像Seaborn一样，Squarify构建在Matplotlib之上，所以我们有通常的<em class="lf"> plt </em>语法。为了使用Squarify绘图，我们使用下面的代码。我还在<em class="lf"> color </em>参数上为原创推文多于转发推文的账户设置了不同的调色板。</p><pre class="iy iz ja jb fd kr ks kt ku aw kv bi"><span id="9f1c" class="kw kx hi ks b fi ky kz l la lb">ax = squarify.plot(sizes=df['counts'], label=ax_label, alpha=0.5, color=ax_color, text_kwargs={'size': 9})</span></pre><p id="4348" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">由于我还没有找到使标签的字体大小与矩形大小成比例的方法，所以我决定试验一下图例。当<em class="lf"> auto_legend </em>参数设置为<em class="lf"> True </em>时，我们只显示转发率超过2%的矩形上的标签。如果<em class="lf"> auto_legend </em>被设置为<em class="lf"> False </em>，那么我们使用<em class="lf"> num_show </em>参数来手动决定我们将要显示多少个带标签的矩形。</p><p id="b73c" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">事不宜迟，下面是@uu_media_comms的树形图。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lj"><img src="../Images/de7e22338e60b94cd4569805f640acc0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nhx8KkBXoHuqwA7zYv7UAw.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">@uu_media_comms的树形图(图片由作者提供)</figcaption></figure><p id="7a26" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">正如你从树形图中看到的，这是非常有趣的观察。我想知道它在其他账户上看起来如何，所以我把它与其他几个教育机构进行了比较(@HyperIsland、@KTHUniversity、@UppsalaUni)。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lk"><img src="../Images/eb6828aba080e685b74b52433553512a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2gezOx21NZ2428IY6Lar4g.jpeg"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">教育机构的树形图(图片由作者提供)</figcaption></figure><p id="74d8" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">好吧，好像其他教育机构的推文大多是原创。再来找一些不相关的账号比如乐队@酷玩，演员@RobertDowneyJr，美国总统@POTUS。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lk"><img src="../Images/e8b4b396a41b2ca228c46d6eb3d3dc93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5PI2Q_pALbW4cpNoXXHT2Q.jpeg"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">各种Twitter账户的树形图(图片由作者提供)</figcaption></figure><p id="efd8" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">好吧，正如我最初怀疑的那样，看起来更多的账户拥有原创推文而不是转发推文。虽然，有一组推特账号的转发量比原始推文还多。是的，那就是推特机器人。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ll"><img src="../Images/509eba2ac10b4cb51febdc601ba31e3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PvW8z_oMn9ixxrP0A4tbIw.jpeg"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">bot帐户的树形图(图片由作者提供)</figcaption></figure></div><div class="ab cl kk kl gp km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="hb hc hd he hf"><p id="c2b5" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我喜欢Tweepy让访问Twitter数据变得容易。这一次，我只掌握了Tweepy所能做的很小一部分。希望以后能深入挖掘Tweepy的其他功能。不过，你可以在我的GitHub上找到完整的代码。</p><p id="4f5a" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">干杯！</p></div></div>    
</body>
</html>