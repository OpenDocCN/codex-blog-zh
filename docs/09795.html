<html>
<head>
<title>How I Built a Real Self-Driving Car from Scratch</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我如何从零开始建造一辆真正的自动驾驶汽车</h1>
<blockquote>原文：<a href="https://medium.com/codex/how-i-built-a-real-self-driving-car-from-scratch-409998d708a?source=collection_archive---------1-----------------------#2022-11-10">https://medium.com/codex/how-i-built-a-real-self-driving-car-from-scratch-409998d708a?source=collection_archive---------1-----------------------#2022-11-10</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/06229ca105b35b5385d9ccd264c17bdc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gSm6UkIxIK15WUPIhyDaWA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">来源:图片由作者提供。</figcaption></figure><p id="cbe1" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">2021年夏天大学二年级结束后，我决定从事当时最先进的项目之一——从零开始开发一款自动驾驶软件，并在实车中实现。在公开了我的<a class="ae js" href="https://github.com/mateomd-dev/maeve-autopilot" rel="noopener ugc nofollow" target="_blank">代码</a>的一些主要部分并发布了一个<a class="ae js" href="https://youtu.be/h1Wg7Cn1D-E" rel="noopener ugc nofollow" target="_blank">演示视频</a>之后，我收到了许多关于这个项目的问题。所以，我决定分享一下开发过程背后的故事。</p><p id="9047" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我一直对任何与AI和机器学习相关的东西都很着迷。计算机能够学习的想法和软件开发中的一个完整的范式转变，对我来说是非常鼓舞人心的。然而，我完全无法理解<em class="jt">。2021年2月左右，我开始上可以说是最受欢迎的Coursera相关主题的课程——<a class="ae js" href="https://www.coursera.org/learn/machine-learning?utm_source=gg&amp;utm_medium=sem&amp;utm_campaign=07-StanfordML-ROW&amp;utm_content=07-StanfordML-ROW&amp;campaignid=2070742271&amp;adgroupid=80109820241&amp;device=c&amp;keyword=machine%20learning%20mooc&amp;matchtype=b&amp;network=g&amp;devicemodel=&amp;adpostion=&amp;creativeid=516962315003&amp;hide_mobile_promo&amp;gclid=CjwKCAiAksyNBhAPEiwAlDBeLHvf3K9Jfjs77yy7pFjfqGtLrzN0UMYYtcw3WhhsBxfEMC1IsaQuahoCqmEQAvD_BwE" rel="noopener ugc nofollow" target="_blank">机器学习</a>、<a class="ae js" href="https://www.coursera.org/specializations/deep-learning?utm_source=gg&amp;utm_medium=sem&amp;utm_campaign=17-DeepLearning-ROW&amp;utm_content=17-DeepLearning-ROW&amp;campaignid=6465471773&amp;adgroupid=77656689495&amp;device=c&amp;keyword=coursera%20deep%20learning%20specialization&amp;matchtype=b&amp;network=g&amp;devicemodel=&amp;adpostion=&amp;creativeid=506750650449&amp;hide_mobile_promo&amp;gclid=CjwKCAiAksyNBhAPEiwAlDBeLPUYNmgNJuRtZNZUMIzj0njAzstXWVMLouSp1283hz5N_FCnUUr4kRoCGmUQAvD_BwE" rel="noopener ugc nofollow" target="_blank">深度学习专业化</a>和<a class="ae js" href="https://www.coursera.org/professional-certificates/tensorflow-in-practice" rel="noopener ugc nofollow" target="_blank"> TensorFlow职业证书</a>的一部分。<br/>我非常支持实践学习，所以我想在我感兴趣的领域选择一个项目，这样我就可以应用我的知识。作为特斯拉的忠实粉丝，我从一开始就被自动驾驶汽车和计算机视觉的世界所吸引——然而，我想超越仅仅在例如GTA汽车中实现神经网络，所以我将这个想法提升到了一个新的水平。</em></p><p id="3b6f" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">经过初步研究，由于时间和预算的限制，我“解决”了一个自主转向机制。很快就发现，即使是单独驾驶也是一项非常具有挑战性的任务。我从可以说是更传统的显式分解问题的方法开始，研究了用于车道检测和路径规划等任务的各种算法。然而，由于这个项目旨在加深我对深度学习仍然有些浅薄的知识，我更倾向于使用神经网络的端到端方法。很快，我看到了2016年NVIDIA的一篇论文,其中讨论了CNN的一种实现，该实现将视频输入的原始像素映射到转向命令，结果令人惊讶地好。也有相当多的实现可用，这激发了我创建自己的实现。<br/>系统的高级概述非常简单:</p><ul class=""><li id="cbcf" class="ju jv hi iw b ix iy jb jc jf jw jj jx jn jy jr jz ka kb kc bi translated">在汽车前部安装一个摄像系统</li><li id="63a9" class="ju jv hi iw b ix kd jb ke jf kf jj kg jn kh jr jz ka kb kc bi translated">获取任何给定时间的转向角度值</li><li id="1862" class="ju jv hi iw b ix kd jb ke jf kf jj kg jn kh jr jz ka kb kc bi translated">将这两个配对，并通过神经网络传递</li><li id="fd4d" class="ju jv hi iw b ix kd jb ke jf kf jj kg jn kh jr jz ka kb kc bi translated">构建一个在方向盘上执行转向命令的系统</li><li id="8c76" class="ju jv hi iw b ix kd jb ke jf kf jj kg jn kh jr jz ka kb kc bi translated">使系统适应实时执行，即拍摄前方道路的图像，预测转向角度并在转向单元上执行</li></ul><h1 id="afaa" class="ki kj hi bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">选择汽车</h1><p id="ffda" class="pw-post-body-paragraph iu iv hi iw b ix lg iz ja jb lh jd je jf li jh ji jj lj jl jm jn lk jp jq jr hb bi translated">鉴于这个项目的高度实验性和潜在的破坏性，我买了我能找到的最便宜的车——具体地说，是斯柯达法比亚的第一款。在这个阶段，我没有一个详细的实施计划，所以我对汽车的唯一要求是动力转向，这使得它可以在不需要对转向柱进行大量和昂贵的调整的情况下建立转向机制。</p><p id="6107" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">自然，我做的第一件也是最重要的一件事就是印上一个特斯拉的标志，并把它拍在汽车的前面。有一次，我差点开错车走了…</p><figure class="lm ln lo lp fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ll"><img src="../Images/e975a52cef7b553ef6b38adf792d4b5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*PhUnz82OSegtpa8I.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">特斯拉Model 3(左)在我的车(右)旁边，有特斯拉的标志。来源:图片由作者提供。</figcaption></figure><h1 id="3d34" class="ki kj hi bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">收集预算数据</h1><p id="8b4d" class="pw-post-body-paragraph iu iv hi iw b ix lg iz ja jb lh jd je jf li jh ji jj lj jl jm jn lk jp jq jr hb bi translated">为了坚持这个项目的“端到端”方面，我想产生自己的数据集。在尝试了一堆网络摄像头之后，我把一部旧iPhone 6S安装在前窗后面，用它来代替视频输入。<br/>测量转向角度是一个更大的挑战。现代汽车通常要么有CAN总线，可以在任何给定时间接入以获得精确的转向角度，要么有直接内置在方向盘内的独立转向角度传感器。我的车两者都没有，所以我不得不从头开始建造自己的传感器。</p><p id="bdcc" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我的设计背后的主要思想是使用由转向引起的动态变化的阻力，并将其映射到转向角度值。我面临的第一个问题是方向盘转动超过360度，所以我需要考虑这些“额外的转动”我最初的解决方案是在转向柱周围使用一个线圈，并在转向柱上安装一个电刷，电刷可以滑过线圈，改变导线的电阻。<br/>更简单(对大多数人来说，更明显……)的解决方案是基于齿轮和一个电位计:我计算齿轮比，将转向角度值映射到安装在转向柱下方的电位计的360°范围内，打印齿轮，然后<em class="jt">瞧，</em>:</p><figure class="lm ln lo lp fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ll"><img src="../Images/ca014e8f679373f3016dfe23b8c5bb79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*eqVaaY8D3sDxlzUs.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">齿轮式转向角传感器的原型。来源:图片由作者提供。</figcaption></figure><p id="5a48" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">电位计连接到Arduino板，然后连接到运行代码的笔记本电脑，以读取和匹配来自iPhone的视频输入的转向角度。虽然脚本本身并不太复杂，但是这种设置的难点在于同步Arduino和笔记本电脑之间的串行通信，因为驱动任务的延迟要求有些严格。<br/>从那以后，以莱克斯·弗里德曼的播客为背景，在我的镇上开上几个小时的车成了我的休闲活动。</p><h1 id="8ee7" class="ki kj hi bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">数据预处理</h1><p id="2203" class="pw-post-body-paragraph iu iv hi iw b ix lg iz ja jb lh jd je jf li jh ji jj lj jl jm jn lk jp jq jr hb bi translated">在不同模型的训练过程中，我尝试了几种技术，但只有一些产生了显著的效果。来自视频输入的图像被调整为100x100的大小，并被裁剪以删除那些会扰乱网络的不必要的特征，尤其是在光线不好的情况下(主要是天空曝光过度)。所有图像都被转换为单通道颜色。除了这些方法之外，我尝试应用低数值的高斯模糊和其他滤镜——这在某些情况下产生了微小的差异，但我无法完全分析相关性。</p><h1 id="a1bb" class="ki kj hi bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">神经网络体系结构</h1><p id="b8e2" class="pw-post-body-paragraph iu iv hi iw b ix lg iz ja jb lh jd je jf li jh ji jj lj jl jm jn lk jp jq jr hb bi translated">有了像样的数据集，就该设计和训练神经网络了。正如我提到的，最初的架构是基于NVIDIA的文件，但是，我已经试验了许多模型和调整，特别是在演示中，整个系统是非常不同的。</p><p id="d539" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">本文中描述的主要架构也是公共存储库的一部分，如下所示:</p><ul class=""><li id="241b" class="ju jv hi iw b ix iy jb jc jf jw jj jx jn jy jr jz ka kb kc bi translated">标准化层</li><li id="7d10" class="ju jv hi iw b ix kd jb ke jf kf jj kg jn kh jr jz ka kb kc bi translated">六个卷积层(ReLU激活)，后跟一个最大池层</li><li id="3992" class="ju jv hi iw b ix kd jb ke jf kf jj kg jn kh jr jz ka kb kc bi translated">变平层</li><li id="05cf" class="ju jv hi iw b ix kd jb ke jf kf jj kg jn kh jr jz ka kb kc bi translated">四个完全连接的层，后面是一个输出神经元</li></ul><figure class="lm ln lo lp fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lq"><img src="../Images/aaf11302b51270ada5cc272565107aee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*lskGAK5c70QMsoWE.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">神经网络的原始结构。来源:图片由作者提供。</figcaption></figure><p id="2f3b" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">该网络最小化网络输出和实际转向角之间的MSE。我在TensorFlow中编写了这个模型，对于大多数部分，我都是使用我的旧笔记本电脑来训练它(是的，迭代需要很长时间)。在训练期间，我使用了Adam优化器和Dropout来获得其他数据集上的更好结果。这个模型对于测试数据集上的慢速行驶来说是足够的，只有在复杂或者不重复的场景下才会失败。正如所料，网络的激活主要突出车道和路边。</p><figure class="lm ln lo lp fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ll"><img src="../Images/bfe56ca5e110d94cdb9c49b0ee3d2599.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*r5FsSd81SfCpz_SI.jpg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">激活突出道路特征的神经网络。来源:图片由作者提供。</figcaption></figure><h1 id="2e18" class="ki kj hi bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">转向机构</h1><p id="78e6" class="pw-post-body-paragraph iu iv hi iw b ix lg iz ja jb lh jd je jf li jh ji jj lj jl jm jn lk jp jq jr hb bi translated">在我通过对上一步收集的数据进行测试来最终确定模型之后，下一步(可能也是最具挑战性的一步)是设计和实现负责实际控制汽车的执行单元。</p><p id="db69" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">基于我之前在gears和Arduino上的成功，我最初的想法是使用单个DC/步进电机通过H桥IC连接到电路板来转动轮子。我拆除了后雨刮器，以获得DC电机，但它不够强大，无法可靠地转动方向盘，即使有很高的齿轮比。</p><figure class="lm ln lo lp fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ll"><img src="../Images/b678b6c78fa9e53b5ff61b1514a0737c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*YB1GfUKPhGlSs03J.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">转向机构的两个原型。来源:图片由作者提供。</figcaption></figure><p id="37c1" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在测试了我周围的其他几个电机后，这让我对我需要什么有了更好的想法，我买了一个更强大的电机(32安培，380瓦)，将其安装到我的设置中，将其连接到电路板，然后…立即烧毁了600安培H桥:)<br/>嗯，我主要是一个软件家伙，所以我向所有对电子产品更有经验的人道歉。使用H桥成为一个问题，因为对于电路来说足够强的H桥会非常昂贵；冷却机制也是如此，它必须用来保持较小的H桥存活。</p><p id="45f0" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">因此，就像之前的转向角传感器一样，我通过使用两个继电器构建自己的“H桥”来克服这一障碍，从而在物理上分离控制器Arduino电路和连接到汽车电池的耗电DC电机。在那之后，我又花了几个小时修复bug，再次测试数据集上的设置，并在一个空停车场开车。</p><figure class="lm ln lo lp fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lr"><img src="../Images/6edcd0fdd5a771579ac7b07a32d00f25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*yrvzvKk6F4ulbkp_.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">使用继电器替代H桥的电路图。来源:图片由作者提供。</figcaption></figure><h1 id="66b3" class="ki kj hi bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">最终测试和结果</h1><p id="6923" class="pw-post-body-paragraph iu iv hi iw b ix lg iz ja jb lh jd je jf li jh ji jj lj jl jm jn lk jp jq jr hb bi translated">第一次真正的测试失败得很惨。汽车在行驶几分钟后开始漂移，或者它会做出奇怪的自发决定，通常是为了弥补系统中某个地方的累积错误。我最喜欢的一次是在恶劣天气条件下的测试，当时汽车决定在附近的湖里快速游一会儿。<br/><em class="jt"/>花费了大量的时间和不眠之夜来修复错误，实现跟踪错误的机制，并可能覆盖自主系统，进一步分析模型，等等。在所有这些之后，我最终得到了一个系统，它产生了令人印象深刻的结果，并可以在大多数情况下很好地推广，在这些情况下，决策不依赖于其他方面，如识别、检测或导航。尽管整个管道的设计有些简单，但所有可能出错的地方都出错了。一路上有太多的挑战，例如保持电机稳定，处理转向角度的精度以避免车轮在两个值之间无休止地振荡，调整序列频率等等，很难相信这一切最终真的成功了。但确实如此。</p><figure class="lm ln lo lp fd ij er es paragraph-image"><div class="er es ls"><img src="../Images/321de222335a9fdf5b5bb4b335522b98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1080/1*m5azLwK5FNZprQsHlGZ2oA.gif"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">行动中的自主转向机制。来源:图片由作者提供。</figcaption></figure></div><div class="ab cl lt lu gp lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="hb hc hd he hf"><h1 id="27ab" class="ki kj hi bd kk kl ma kn ko kp mb kr ks kt mc kv kw kx md kz la lb me ld le lf bi translated">结论</h1><p id="3da4" class="pw-post-body-paragraph iu iv hi iw b ix lg iz ja jb lh jd je jf li jh ji jj lj jl jm jn lk jp jq jr hb bi translated">这篇文章描述了我作为软件和硬件初学者参与一个高级项目的经历。从学习和巩固知识的角度来看，建立一个端到端的数据收集、处理管道，实现自动驾驶的神经网络，以及从零开始制造所有主要硬件组件的过程无疑是我所建立的最雄心勃勃和最有价值的项目。回顾一路走来所做的决定，今天有很多事情我会以不同的方式去做——但毕竟，这就是学习和进步的意义所在。这个项目向我打开了自动驾驶汽车、深度学习和计算机视觉的世界，我希望未来继续朝着这个方向前进。</p><p id="c532" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">欢迎在评论中提出任何问题！</p></div></div>    
</body>
</html>