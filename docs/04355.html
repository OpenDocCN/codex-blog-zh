<html>
<head>
<title>Exploring Excelize with Go</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用围棋探索极限</h1>
<blockquote>原文：<a href="https://medium.com/codex/exploring-excelize-with-go-88ce3712a5?source=collection_archive---------2-----------------------#2021-11-24">https://medium.com/codex/exploring-excelize-with-go-88ce3712a5?source=collection_archive---------2-----------------------#2021-11-24</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/16a880b4999d8128c2a89d1c33e12c27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PMoxUccC0Zny4KErj2NgrQ.png"/></div></div></figure><div class=""/><p id="fffb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一旦数据是CSV或XLSX格式，公式、数据透视表和插件都提供了转换或操作数据的方法。但是，如果您对将数据持续加载到共享报告中感兴趣，而其他团队成员可以更容易地在Excel或Google Sheets中利用这些数据，该怎么办呢？</p><p id="4fca" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Excelize是一个Go库，用于生成与Excel兼容的电子表格，支持嵌入公式、样式、图表等。我最近一直在做一个自动化项目，在这个项目中，我利用Go和Excelize对目录结构进行编目，并将这些信息转换成自动更新的电子表格。</p><p id="94d4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">利用Go处理这种轻量级“ETL式”工作负载是一种令人兴奋的体验，我想分享一些我在使用Excelize时获得的见解。</p><h1 id="fb98" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">风格定义</h1><p id="f942" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">毫不奇怪，当您更改单元格的背景、文本或边框属性时，Excel会在电子表格中嵌入一个样式系统。理解Excelize如何处理样式花了我不愿意承认的时间。具体来说，许多文档示例都以JSON字符串的形式提供了一个样式对象。</p><figure class="ks kt ku kv fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es kr"><img src="../Images/d4a44a0f584f2265e645e264d75a3ab4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BMpPUt5ibVzu-wuN1dfJIg.png"/></div></div></figure><p id="edee" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这不是您想要的样式结构，因为您会失去所有的类型检查，并且必须手动处理转义字符和JSON格式。原来，<code class="du kw kx ky kz b">NewStyle</code>函数支持一个<code class="du kw kx ky kz b">interface{} </code>参数，当你拉开盖子时，这个函数只是将你的字符串解组成一个<code class="du kw kx ky kz b">Style</code>对象。</p><figure class="ks kt ku kv fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es la"><img src="../Images/53c4825d11fec99f4d79e99056fa0594.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UN2EoppKdD6J7_pkIqj_4w.png"/></div></div></figure><p id="e55e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果我们在上面的例子中更进一步，你可以内联定义<code class="du kw kx ky kz b">Style</code>结构。现在，您不必担心手动编写JSON或弄乱单个属性的类型。</p><figure class="ks kt ku kv fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lb"><img src="../Images/f0b9ca82c45f2e83d89a1ba9821509ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D-1DIQnyzAjz9VEduVxC5Q.png"/></div></div></figure><p id="54b7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">关于样式的最后一个注意事项是，一些属性(如边框)被输入以接受一部分字符串。如果你像我一样，这看起来好像你可以有任何数量的边框样式定义，这是没有意义的。</p><p id="9d72" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">事实证明，与CSS类似，期望为单元格的四个边(上、左、右、下)定义四个边界结构。在左边的例子中，你会注意到你通过设置一个<code class="du kw kx ky kz b">Type</code>属性来指定每一边。</p><p id="976b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对于这种数据结构，利用地图上的切片似乎是一个有趣的选择，但可能有一些隐藏的好处。如果你对此有任何想法，我很乐意在评论中听到。</p><h1 id="1c3e" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">样式索引</h1><p id="0774" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">Excelize构建嵌入电子表格的样式索引；不幸的是，它只通过一个增量id来公开索引。我假设这是Excel内部处理跟踪这些信息的方式，但是我发现随着我添加更多的样式，这有点容易出错。我选择通过预先注册来建立这些风格的集中索引，然后利用一个<code class="du kw kx ky kz b">map[string]int</code>将一个名称附加到一个风格的内部ID上。</p><figure class="ks kt ku kv fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lc"><img src="../Images/f78f977253f964fa00d07a76ceea531f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eymh1BgddUAXN2PWMjBSMg.png"/></div></div></figure><p id="46ef" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这让我可以将样式索引注入到各种函数中，并通过名称检索样式。我还在<code class="du kw kx ky kz b">StyleIndex</code>结构上编写了包装器方法，以提供更好的自动完成功能，并在将来需要更改时抽象出底层键。</p><figure class="ks kt ku kv fd hk er es paragraph-image"><div class="er es ld"><img src="../Images/de81f218a0e4aaabdafcce95b544a5d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1228/format:webp/1*Ni1KGPHcPPIU6d_39FrxEg.png"/></div></figure><h1 id="82f7" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">单元形状</h1><p id="21d0" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">Excelize提供了单独设置单元属性的函数，但缺少将标准配置组合在一起的高级函数。对于整个库来说，这可能是正确的调用，但是导致了很多重复的代码，每次都执行相同的动作。我写了几个助手函数，如下例所示，在这个例子中，我对合并多个单元格进行了分组，并设置了样式和值。</p><figure class="ks kt ku kv fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es le"><img src="../Images/7fdbc80f1272e0168ba8c22872c31833.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LeKKSJ-WB8Yng1tAflD1UA.png"/></div></div></figure><p id="6da5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您还应该注意到被注入到函数中的<code class="du kw kx ky kz b">StyleIndex</code>结构。我来回考虑是传递索引还是从上一层传入样式ID。我不确定我更喜欢哪个选项，因为每个选项在可重用性方面都有自己的权衡。</p><ul class=""><li id="62e8" class="lf lg ht is b it iu ix iy jb lh jf li jj lj jn lk ll lm ln bi translated">让每个函数调用都指定自己的样式ID使它更加通用和可重用。</li><li id="2697" class="lf lg ht is b it lo ix lp jb lq jf lr jj ls jn lk ll lm ln bi translated">为每种风格定义一个独立的功能意味着最终用户不需要了解所使用的底层风格。</li></ul><p id="3581" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你对这个权衡有什么想法吗？也许，你在另一个造型系统中遇到过这个问题。</p><h1 id="42b2" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">迭代数据时生成单元格和行偏移量</h1><p id="4913" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">在某些时候，您需要以编程方式确定需要将一段数据写入哪一行和哪一列。下面是我如何通过利用<code class="du kw kx ky kz b">ColumnNumberToName</code>函数和一个偏移值来实现这一点的例子。这允许我计算多条数据的列位置，而不用做任何ASCII计算来计算列<code class="du kw kx ky kz b">AX1</code>之后的内容。</p><figure class="ks kt ku kv fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lt"><img src="../Images/379ea6dcc41bec703e423b6f3bfbc33f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rahGfx1Vp8Mv-mzMdwyO3g.png"/></div></div></figure><h1 id="037d" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">结论</h1><p id="f614" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">我喜欢利用Excelize来自动生成嵌入了丰富内容的电子表格。这很像是Excel文件格式之上的一个低级API，这意味着您必须花一些时间为自己创建高级函数。你以前使用过Excelize或者其他不同语言的excel库吗？</p><p id="80d2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在下面留言或在<a class="ae lu" href="https://twitter.com/peytoncasper" rel="noopener ugc nofollow" target="_blank"> Twitter </a>上联系我；我很乐意继续这个话题。</p></div></div>    
</body>
</html>