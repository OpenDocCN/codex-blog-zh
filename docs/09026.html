<html>
<head>
<title>Solving Data Analysis Challenges using SQL with every step explained (Part 1)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用SQL解决数据分析挑战，并解释每一步(第1部分)</h1>
<blockquote>原文：<a href="https://medium.com/codex/solving-data-analysis-using-sql-queries-with-every-step-explained-part-1-94ea447eb0be?source=collection_archive---------7-----------------------#2022-09-20">https://medium.com/codex/solving-data-analysis-using-sql-queries-with-every-step-explained-part-1-94ea447eb0be?source=collection_archive---------7-----------------------#2022-09-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/e36f888e7a3a944db0e14ab6ce49872b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*FSVGHrLV4NEZNvjA"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">凯文·Ku在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="94b3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为了理解一些概念是如何工作的，观察其他开发人员的思维过程通常是非常有益的。这正是我想在这里做的。以有趣的SQL挑战为例，解释它，我是如何解决这些挑战的，以及我为什么要以这种方式解决。希望这能帮助你更深入地理解SQL。请记住，没有人是完美的，如果你看到一个问题或有更好的解决方案，非常欢迎你在评论中纠正我。</p><p id="1826" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">此外，我将始终使用某种示例数据，而不是我所面临的这些问题的真实数据。所以，如果数据看起来有点奇怪，不要感到困惑，但是所使用的查询背后的逻辑仍然是相同的。现在我们开始吧！我从一个简单的例子开始。</p><h2 id="87b1" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn bi translated">对数据的调查</h2><p id="d700" class="pw-post-body-paragraph iv iw hi ix b iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo ks jq jr js hb bi translated">首先，让我们来看看本次展示的数据:</p><figure class="ku kv kw kx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kt"><img src="../Images/565a28c1f14a7c4656ee14c16b54f34a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7mA1Ze4B9iJ2PbAfQ_W8hA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">表的快照</figcaption></figure><p id="94a2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这里我们看到我们的表叫做orders，这是一个来自某个比萨饼店的订单集合的超级基本的例子。我们将customerId作为我们的客户标识符，一个保存订购的比萨饼的order列和orderDate。</p><p id="b8b4" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我必须解决的问题是找到顾客，他们至少点了一些特定的披萨(玛格丽塔和意大利熏火腿)。只有这些客户有资格进行进一步处理。</p><p id="3c6d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">那么我们该如何解决这个问题呢？难道我们不能像这样使用where语句吗:</p><figure class="ku kv kw kx fd ij"><div class="bz dy l di"><div class="ky kz l"/></div></figure><p id="8451" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这当然会过滤掉每一行，只留下正确的订单，但是我们仍然不能说这个查询中的所有客户都是正确的。因为例如客户3只购买了熏火腿，因此不符合进一步处理的条件，但将是该查询结果的一部分。我们必须想办法同时查看更多的行。</p><p id="1400" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为了解决这个问题，我想出了两个主意:</p><p id="2068" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">解决同时查看两行的问题的一个方法是简单地旋转这个表，将我们不同的订单作为列。这将使我们能够为每个客户使用一个简单的WHERE子句来检查他是否订购了正确的披萨。如果你需要一个关于旋转的快速回顾，你可以看看这个博客:</p><div class="la lb ez fb lc ld"><a href="https://graflinger.medium.com/sql-case-vs-pivot-586402c6979f" rel="noopener follow" target="_blank"><div class="le ab dw"><div class="lf ab lg cl cj lh"><h2 class="bd hj fi z dy li ea eb lj ed ef hh bi translated">SQL —案例与透视</h2><div class="lk l"><h3 class="bd b fi z dy li ea eb lj ed ef dx translated">数据透视表通常为您的分析提供巨大的价值。在这篇博客中，我将向您展示如何使用SQL创建它们…</h3></div><div class="ll l"><p class="bd b fp z dy li ea eb lj ed ef dx translated">graflinger.medium.com</p></div></div><div class="lm l"><div class="ln l lo lp lq lm lr io ld"/></div></div></a></div><p id="d922" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">对于这样一个简单的例子，一种快速透视我们的表的方法是使用如下的CASE语句:</p><figure class="ku kv kw kx fd ij"><div class="bz dy l di"><div class="ky kz l"/></div></figure><p id="1537" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这将导致以下输出:</p><figure class="ku kv kw kx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ls"><img src="../Images/e070a1d5c183ac34044b16f4113316c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wd5jC5Wk_kegWLz50vdQpw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">由旋转产生</figcaption></figure><p id="b0a8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这个表使我们能够使用WHERE条件进行简单的过滤，找到每个选择了正确比萨饼的顾客。在我们的示例中，这将是客户1、4和5。让我们使用CTE轻松集成我们的解决方案，并筛选这些客户:</p><figure class="ku kv kw kx fd ij"><div class="bz dy l di"><div class="ky kz l"/></div></figure><p id="2649" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">但是我们真的需要改变数据吗？我想到的一个更好的解决方案是，如果两个条件都满足的话，聚合这些行来获得信息。这可以通过COUNT(*)轻松完成。如果在我们的过滤查询中有我们的两个比萨饼，我们将从我们的计数中收到结果2。这可以用在HAVING语句中，我们所有的问题都解决了。这可能看起来像这样:</p><figure class="ku kv kw kx fd ij"><div class="bz dy l di"><div class="ky kz l"/></div></figure><h2 id="405e" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn bi translated">额外问题</h2><p id="50ef" class="pw-post-body-paragraph iv iw hi ix b iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo ks jq jr js hb bi translated">现在解决了这个问题，对于我进一步的工作来说，拥有一个从过滤掉的客户那里订购的所有比萨饼的列表真的很有好处。为了在T-SQL中实现这一点，我使用了STRING_AGG:</p><figure class="ku kv kw kx fd ij"><div class="bz dy l di"><div class="ky kz l"/></div></figure><p id="069f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">结果看起来像这样:</p><figure class="ku kv kw kx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lt"><img src="../Images/39a751cb46fb4b995a1733b2d017d0e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9ekEb7dnMvBXdKH--cNwLQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">订单列表</figcaption></figure><p id="1054" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我希望你喜欢这个博客，并且能够学到一两件事。欢迎任何反馈！</p></div></div>    
</body>
</html>