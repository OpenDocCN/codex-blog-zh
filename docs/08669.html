<html>
<head>
<title>How to migrate SVN to Git</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将SVN迁移到Git</h1>
<blockquote>原文：<a href="https://medium.com/codex/how-to-migrate-svn-to-git-b625a21575b2?source=collection_archive---------5-----------------------#2022-08-25">https://medium.com/codex/how-to-migrate-svn-to-git-b625a21575b2?source=collection_archive---------5-----------------------#2022-08-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/e0d8ea181fb67cea2a16a3c9df51b808.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*vi_Hqppb9ryTh7wP"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">马库斯·温克勒在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="f825" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我最近在做一个迁移项目，包括将我们的代码库从SVN迁移到GitHub。经过几次尝试和错误，花了大量时间在网上搜索最佳实践，我终于成功开发了一个系统，在这个过程中不会引起任何问题，我想与你分享它会很好。</p><p id="1aca" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我将这个迁移过程分为4个简单的步骤:</p><ol class=""><li id="1504" class="jt ju hi ix b iy iz jc jd jg jv jk jw jo jx js jy jz ka kb bi translated">准备您的环境</li><li id="c466" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated">将您的SVN存储库转换为本地git存储库</li><li id="bde4" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated">将任何大文件转换为lfs对象(如果需要)</li><li id="d5f5" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated">将新的git存储库推送到GitHub</li></ol></div><div class="ab cl kh ki gp kj" role="separator"><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km"/></div><div class="hb hc hd he hf"><h1 id="8296" class="ko kp hi bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">准备您的环境</h1><p id="0d86" class="pw-post-body-paragraph iv iw hi ix b iy lm ja jb jc ln je jf jg lo ji jj jk lp jm jn jo lq jq jr js hb bi translated">在您的本地机器上创建一个GitMigration文件夹，它将存放您的新git repo: <code class="du lr ls lt lu b">mkdir -p ~/GitMigration</code></p><p id="be59" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在另一个命令行更新SVN回购，以确保您有最新的修订。明智的做法是通知您的团队，您正在开始迁移，在迁移过程完成之前，不允许将更多的提交推送到SVN。</p><p id="5ff8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">完成后，您需要创建一个authors.txt文件。这将把SVN用户名映射到所需的Git用户名，格式如下:</p><pre class="lv lw lx ly fd lz lu ma mb aw mc bi"><span id="ec7c" class="md kp hi lu b fi me mf l mg mh">jdoe = John Doe &lt;john.doe@gmail.com&gt;<br/>esmith = Emma Smith &lt;emma.smith@gmail.com&gt;</span></pre><p id="ea4e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果您不想手动查找SVN中的所有作者，您可以使用以下命令从SVN存储库中提取数据，只要确保最终格式遵循与上面相同的结构即可:</p><pre class="lv lw lx ly fd lz lu ma mb aw mc bi"><span id="48ff" class="md kp hi lu b fi me mf l mg mh">svn log -q | awk -F '|' '/^r/ {gsub(/ /, "", $2); sub(" $", "", $2); print $2" = "$2" &lt;"$2"&gt;"}' | sort -u &gt; authors.txt</span></pre></div><div class="ab cl kh ki gp kj" role="separator"><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km"/></div><div class="hb hc hd he hf"><h1 id="380d" class="ko kp hi bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">将您的SVN存储库转换为本地git存储库</h1><p id="a93f" class="pw-post-body-paragraph iv iw hi ix b iy lm ja jb jc ln je jf jg lo ji jj jk lp jm jn jo lq jq jr js hb bi translated">如果您只想迁移某个时间段的提交，您需要在SVN repo中找到修订号。为此，请在svn repo文件夹中执行以下命令:</p><pre class="lv lw lx ly fd lz lu ma mb aw mc bi"><span id="a66a" class="md kp hi lu b fi me mf l mg mh">svn log -r {YYYY-DD-MM}:HEAD --limit 1</span></pre><p id="9fe2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在GitMigration文件夹中，执行以下命令:</p><pre class="lv lw lx ly fd lz lu ma mb aw mc bi"><span id="31c8" class="md kp hi lu b fi me mf l mg mh">git svn clone &lt;svn-repo&gt;/&lt;project&gt; &lt;git-repo-name&gt; --authors-file=authors.txt -r &lt;revision-number&gt;:HEAD</span></pre><p id="7437" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">其中<strong class="ix hj"> <svn-repo> </svn-repo></strong>是您想要迁移的svn存储库的URI，<strong class="ix hj"> &lt; project&gt; </strong>是您想要导入的项目的名称，<strong class="ix hj">&lt;revisions-number&gt;</strong>是您想要迁移的版本号(如果需要的话)。<strong class="ix hj"> <git-repo-name> </git-repo-name></strong>是新git存储库的目录名。这个过程可能需要一段时间，具体取决于SVN提交的大小。</p><p id="4df1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在是清理的时候了，将标签和任何远程refs转移到本地分支。要将标记移动到正确的Git标记，请在git repo目录中执行以下操作:</p><pre class="lv lw lx ly fd lz lu ma mb aw mc bi"><span id="a2e7" class="md kp hi lu b fi me mf l mg mh">for t in $(git for-each-ref --format='%(refname:short)' refs/remotes/tags); do git tag ${t/tags\//} $t &amp;&amp; git branch -D -r $t; done</span></pre><p id="dab4" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">接下来，移动refs/remote下的任何引用，并将它们转到本地分支</p><pre class="lv lw lx ly fd lz lu ma mb aw mc bi"><span id="7302" class="md kp hi lu b fi me mf l mg mh">for b in $(git for-each-ref --format='%(refname:short)' refs/remotes); do git branch $b refs/remotes/$b &amp;&amp; git branch -D -r $b; done;</span><span id="f4f2" class="md kp hi lu b fi mi mf l mg mh">for p in $(git for-each-ref --format='%(refname:short)' | grep @); do git branch -D $p; done;</span></pre></div><div class="ab cl kh ki gp kj" role="separator"><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km"/></div><div class="hb hc hd he hf"><h1 id="add5" class="ko kp hi bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">将任何大文件转换为LFS对象</h1><p id="1ff8" class="pw-post-body-paragraph iv iw hi ix b iy lm ja jb jc ln je jf jg lo ji jj jk lp jm jn jo lq jq jr js hb bi translated">GitHub有一个100MB的文件限制，超过这个大小的文件将被拒绝放入GitHub。这就是<a class="ae iu" href="https://git-lfs.github.com/" rel="noopener ugc nofollow" target="_blank"> Git大文件存储(LFS) </a>的用武之地。Git LFS在Git内部用文本指针替换任何大文件，同时将文件内容存储在远程服务器上。使用LFS有许多好处，例如</p><ul class=""><li id="6eec" class="jt ju hi ix b iy iz jc jd jg jv jk jw jo jx js mj jz ka kb bi translated">大型文件版本控制</li><li id="426c" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js mj jz ka kb bi translated">更多存储空间</li><li id="49a9" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js mj jz ka kb bi translated">更快的克隆和获取</li><li id="e62f" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js mj jz ka kb bi translated">相同的Git工作流程</li><li id="7d6b" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js mj jz ka kb bi translated">相同的访问控制和权限</li></ul><p id="4e27" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">要找出超过100MB限制的文件数量，请运行以下命令:</p><pre class="lv lw lx ly fd lz lu ma mb aw mc bi"><span id="5c98" class="md kp hi lu b fi me mf l mg mh">git lfs migrate info --everything --above=99MB</span></pre><p id="485b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这将打印出您的回购中高于99MB标记的不同文件类型的信息(如下所示)。</p><figure class="lv lw lx ly fd ij er es paragraph-image"><div class="er es mk"><img src="../Images/9b6f6df6b8bf799fd394f459f72b5a59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1344/0*41NKJRHJcmuzKZPy"/></div></figure><p id="e16e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">要将文件转换为LFS文件对象，请运行以下命令:</p><pre class="lv lw lx ly fd lz lu ma mb aw mc bi"><span id="8890" class="md kp hi lu b fi me mf l mg mh">git lfs migrate import --everything --above=99MB</span></pre><p id="06b6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这将重写包含任何大于99MB的文件的git repo的历史，并将它们转换为LSF对象。</p></div><div class="ab cl kh ki gp kj" role="separator"><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km"/></div><div class="hb hc hd he hf"><h1 id="9c67" class="ko kp hi bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">将新的git存储库推送到GitHub</h1><p id="6b0f" class="pw-post-body-paragraph iv iw hi ix b iy lm ja jb jc ln je jf jg lo ji jj jk lp jm jn jo lq jq jr js hb bi translated">最后一步是添加远程git服务器并推送更改。</p><pre class="lv lw lx ly fd lz lu ma mb aw mc bi"><span id="d61f" class="md kp hi lu b fi me mf l mg mh">git remote add origin git@my-git-server:myrepository.git</span><span id="4416" class="md kp hi lu b fi mi mf l mg mh">git push origin --all;</span><span id="0201" class="md kp hi lu b fi mi mf l mg mh">git push origin --tags;</span></pre><p id="d937" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">就是这样！恭喜，您已经将您的SVN repo迁移到Git中了。下一步是通知您的团队迁移已经完成，并为他们提供对新的远程git服务器的访问。</p></div></div>    
</body>
</html>