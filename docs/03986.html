<html>
<head>
<title>💪Using Infrastructure-As-Code to deploy Azure Sentinel + Watchlists to lower IP false positives</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">💪使用基础设施即代码来部署Azure Sentinel +观察列表以降低IP误报</h1>
<blockquote>原文：<a href="https://medium.com/codex/using-infrastructure-as-code-to-deploy-azure-sentinel-watchlists-to-lower-ip-false-positives-e78e3adba9f3?source=collection_archive---------2-----------------------#2021-10-14">https://medium.com/codex/using-infrastructure-as-code-to-deploy-azure-sentinel-watchlists-to-lower-ip-false-positives-e78e3adba9f3?source=collection_archive---------2-----------------------#2021-10-14</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="cca3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用此解决方案调查Azure环境中的活动。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/251d8d7105408a16d3b2c58ec23e27f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Jy8bnxSWsLk40R2iDMezdA.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">使用基础设施即代码来部署Azure Sentinel +观察列表以降低IP误报</figcaption></figure></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><p id="8f23" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">本文旨在向您展示如何使用基础设施即代码来部署部署Azure Sentinel和观察列表所需的资源，以便您可以调查威胁和响应事件。</p><h1 id="1ed0" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">什么是Azure Sentinel？</h1><p id="983a" class="pw-post-body-paragraph if ig hi ih b ii ky ik il im kz io ip iq la is it iu lb iw ix iy lc ja jb jc hb bi translated"><strong class="ih hj"> Azure Sentinel是一个云原生安全信息和事件管理器(SIEM)平台</strong>，它使用内置人工智能来帮助分析整个企业的大量数据，并从多个来源收集数据。它支持开放的标准格式，如CEF和系统日志。</p><p id="49c4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Azure Sentinal是部署在Azure中的PaaS解决方案；您可以从多个来源收集数据，包括内部数据源或多个云提供商。</p><p id="5b29" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要部署此解决方案，您需要一个日志分析工作区。然后，在该工作区上启用Azure Sentinel。</p><p id="a6e2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦Azure Sentinel启用，您就可以开始使用Azure提供的一些连接器连接多个数据源，或者执行手动集成。</p><p id="eb63" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们将讨论一下<strong class="ih hj">观察列表</strong>。</p><h1 id="eb82" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">Azure Sentinel观察列表？🤔</h1><p id="b03a" class="pw-post-body-paragraph if ig hi ih b ii ky ik il im kz io ip iq la is it iu lb iw ix iy lc ja jb jc hb bi translated">将观察列表视为一个组件，它将帮助您从外部数据源收集数据，以便与Azure Sentinel环境中的事件相关联。</p><p id="30c0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过观察列表，您可以从外部来源构建自己的数据，这些数据可以导入Azure Sentinel，然后用于与分析或搜索规则相关联。</p><p id="4fd2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">观察列表可以包含一个详细信息列表，然后转换成Azure Sentinel中使用的日志格式。</p><p id="e1a7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在以下示例中，我们将执行以下操作:</p><ol class=""><li id="c1c6" class="ld le hi ih b ii ij im in iq lf iu lg iy lh jc li lj lk ll bi translated"><em class="lm">使用Bicep部署新的日志分析工作区和Azure Sentinel。</em></li><li id="53fe" class="ld le hi ih b ii ln im lo iq lp iu lq iy lr jc li lj lk ll bi translated"><em class="lm">部署包含Azure公共IP列表的Azure Sentinel观察列表。</em></li></ol><h2 id="bd51" class="ls kb hi bd kc lt lu lv kg lw lx ly kk iq lz ma ko iu mb mc ks iy md me kw mf bi translated">先决条件</h2><ul class=""><li id="9235" class="ld le hi ih b ii ky im kz iq mg iu mh iy mi jc mj lj lk ll bi translated">Azure订阅和资源组</li><li id="a75a" class="ld le hi ih b ii ln im lo iq lp iu lq iy lr jc mj lj lk ll bi translated">对资源组拥有所有者/参与者权限的用户</li><li id="4088" class="ld le hi ih b ii ln im lo iq lp iu lq iy lr jc mj lj lk ll bi translated">Bicep安装在您的本地机器上</li><li id="16bb" class="ld le hi ih b ii ln im lo iq lp iu lq iy lr jc mj lj lk ll bi translated">Azure PowerShell</li><li id="14ef" class="ld le hi ih b ii ln im lo iq lp iu lq iy lr jc mj lj lk ll bi translated">Visual Studio代码</li></ul><p id="b805" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在让我们使用Bicep部署一个新的日志分析工作区和Azure Sentinel。</p><h1 id="998f" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">1.使用Bicep部署新的日志分析工作区和Azure Sentinel。</h1><p id="07fa" class="pw-post-body-paragraph if ig hi ih b ii ky ik il im kz io ip iq la is it iu lb iw ix iy lc ja jb jc hb bi translated">我们将使用下面的Bicep文件来部署新的日志分析工作区并启用Azure Sentinel:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="mk ml l"/></div></figure><p id="7af9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将使用下面的代码来部署上面的Bicep文件:</p><pre class="je jf jg jh fd mm mn mo mp aw mq bi"><span id="e815" class="ls kb hi mn b fi mr ms l mt mu">$date = Get-Date -Format "MM-dd-yyyy"<br/>$deploymentName = "AzInsiderDeployment"+"$date"</span><span id="8362" class="ls kb hi mn b fi mv ms l mt mu">New-AzResourceGroupDeployment -Name $deploymentName -ResourceGroupName sentinel -TemplateFile .\sentinel.bicep</span></pre><p id="f33f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">部署完成后，您应该会在资源组中看到日志分析工作区和Sentinel，如下所示:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mw"><img src="../Images/5747c1ecac18838ba6f6a2a3505ae580.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NRJyf5wryoaCsKjzPiIHcQ.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">Azure日志分析工作区和哨兵</figcaption></figure><p id="6481" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下一步是部署包含Azure公共IP列表的Azure Sentinel观察列表。</p><h1 id="42c5" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">2.部署包含Azure公共IP列表的Azure Sentinel观察列表</h1><p id="dce2" class="pw-post-body-paragraph if ig hi ih b ii ky ik il im kz io ip iq la is it iu lb iw ix iy lc ja jb jc hb bi translated">我们将使用以下ARM模板执行Azure Sentinel观察列表的部署。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="mk ml l"/></div></figure><p id="a0fe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上面的ARM模板包含列出Azure公共IP的观察列表。您可以在以下URL中找到Azure IP范围和服务标签:</p><div class="mx my ez fb mz na"><a href="https://www.microsoft.com/en-us/download/details.aspx?id=56519" rel="noopener  ugc nofollow" target="_blank"><div class="nb ab dw"><div class="nc ab nd cl cj ne"><h2 class="bd hj fi z dy nf ea eb ng ed ef hh bi translated">Azure IP范围和服务标签-公共云</h2><div class="nh l"><h3 class="bd b fi z dy nf ea eb ng ed ef dx translated">Azure IP范围和服务标签-公共云</h3></div><div class="ni l"><p class="bd b fp z dy nf ea eb ng ed ef dx translated">Azure IP范围和服务标签-公共Cloudwww.microsoft.com</p></div></div><div class="nj l"><div class="nk l nl nm nn nj no jn na"/></div></div></a></div><p id="92e6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们将使用下面的命令部署ARM模板，并将Azure Sentinel所在的相同资源组作为目标:</p><pre class="je jf jg jh fd mm mn mo mp aw mq bi"><span id="f73e" class="ls kb hi mn b fi mr ms l mt mu">New-AzResourceGroupDeployment -Name $deploymentName -ResourceGroupName sentinel -TemplateFile .\listIP.json</span></pre><p id="c3cd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在部署期间，您需要传递工作区的名称。下图显示了部署输出:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es np"><img src="../Images/2ba18c4684002dd500ff3cb8d5b3dd94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hEx9Mvd7YYyoSaZOLItyfg.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">部署输出</figcaption></figure><p id="ba48" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在你可以导航到Azure门户，在Azure Sentinel解决方案中，你会看到观察列表。选择Watchlists选项，您将看到最近部署的新观察列表。现在，您可以在日志分析中查看它。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es nq"><img src="../Images/9d4f926a74e465f8af90f166e079c19f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*miqTMqv7fDNO9E00kcu34Q.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">Azure哨兵观察列表</figcaption></figure><p id="e8b5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您选择“在日志分析中查看”选项，您将查询所有列表，结果将显示在工作区中，如下所示:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es nr"><img src="../Images/5d08a0b3e1b8bf6f87f1aba7aacfe0cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w3zDOeoaPGbbmgmb-wFq7w.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">Azure公共IP列表</figcaption></figure><p id="acf2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，您可以使用此观察列表来降低获得Azure IP地址的检测的误报率，或者丰富数据来调查您环境中的活动。</p><p id="b9a9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae ns" href="http://eepurl.com/gKmLdf" rel="noopener ugc nofollow" target="_blank"> <em class="lm">在此加入</em><strong class="ih hj"><em class="lm">azin sider</em></strong><em class="lm">邮箱列表。</em>T9】</a></p><p id="0d61" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="lm">-戴夫·r·</em></p></div></div>    
</body>
</html>