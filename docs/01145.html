<html>
<head>
<title>The Best Way to Learn Forms in Rails — Create Some Manually</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">学习Rails中表单的最好方法是手动创建一些表单</h1>
<blockquote>原文：<a href="https://medium.com/codex/the-best-way-to-learn-form-in-rails-create-some-manually-7db6271dca96?source=collection_archive---------3-----------------------#2021-04-07">https://medium.com/codex/the-best-way-to-learn-form-in-rails-create-some-manually-7db6271dca96?source=collection_archive---------3-----------------------#2021-04-07</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/c6f19be3166902098895d3de617bb2d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ylHFb8VlB1r-YQrUr2vn3w.jpeg"/></div></div></figure><p id="dae6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">有很多方法可以在rails中创建表单。您可以安装许多表单创建工具中的一个来帮助您完成这个过程，或者只是简单地使用一个内置的Rails helper方法。仔细想想，rails就是<em class="jo">所有关于表单的东西</em> …它让rails应用成为Rails应用，并让用户与我们的网页互动。</p><p id="236e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因此，了解表单的来龙去脉是构建高质量Rails应用程序的基本技能。</p><p id="05f2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在本指南中，我们将使用HTML从头开始构建表单。随着您在Rails之旅中的进步，本练习的一些学习成果将对您有所帮助:</p><ul class=""><li id="f446" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated">熟悉Rails使用的MVC模型和文件结构</li><li id="0075" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">手动设置一个rails应用程序来创建一个新用户</li><li id="05af" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">确保表格填写正确</li><li id="bdbd" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">建立一个简单的数据库，又名“模型”</li><li id="7752" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">创建和添加适当的</li><li id="26ec" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">使用<code class="du kd ke kf kg b">presence</code>在Rails中验证我们的表单</li></ul><p id="8954" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">注意，Rails使用助手方法使得创建这些文件变得非常简单。在某些方面……它太<em class="jo">容易了，所以手动浏览这个过程将帮助我们更好地理解什么成分一起制作美味的Rails蛋糕……呃……应用程序。</em></p><h2 id="4ba3" class="kh ki hi bd kj kk kl km kn ko kp kq kr jb ks kt ku jf kv kw kx jj ky kz la lb bi translated">先决条件</h2><ul class=""><li id="0c8b" class="jp jq hi is b it lc ix ld jb le jf lf jj lg jn ju jv jw jx bi translated">我假设你有很少的创建Rails应用程序的经验——如果没有，不要太担心，因为如果你已经成功安装了Ruby和Rails，你仍然可以跟着做</li><li id="9f98" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">有大量的指南可以帮助您进行设置</li><li id="1701" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">如果您以前创建过Rails应用程序，那么您已经使用过电脑的终端应用程序，并且不能在命令行上导航文件夹。</li><li id="ed43" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">熟悉HTML是有帮助的</li></ul><h2 id="01b6" class="kh ki hi bd kj kk kl km kn ko kp kq kr jb ks kt ku jf kv kw kx jj ky kz la lb bi translated">我在写作时使用的版本</h2><ul class=""><li id="6a64" class="jp jq hi is b it lc ix ld jb le jf lf jj lg jn ju jv jw jx bi translated">Ruby v. 3.0.0</li><li id="b81e" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">Rails诉6.1.3.1</li><li id="a496" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">MacOS 11</li></ul><h2 id="84b3" class="kh ki hi bd kj kk kl km kn ko kp kq kr jb ks kt ku jf kv kw kx jj ky kz la lb bi translated">第一部分:手动设置我们的应用程序</h2><h2 id="3d75" class="kh ki hi bd kj kk kl km kn ko kp kq kr jb ks kt ku jf kv kw kx jj ky kz la lb bi translated">设置:生成一个新的rails应用程序</h2><p id="0fde" class="pw-post-body-paragraph iq ir hi is b it lc iv iw ix ld iz ja jb lh jd je jf li jh ji jj lj jl jm jn hb bi translated">让我们为表单项目创建一个名为“强大”的新Rails应用程序</p><ol class=""><li id="326e" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn lk jv jw jx bi translated">在您的终端应用程序中，导航到您想要创建项目的文件夹，然后输入<code class="du kd ke kf kg b">rails new formidable</code>,观察rails构建您的项目时一行行代码飞快地掠过</li><li id="68b6" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn lk jv jw jx bi translated">如果您想跟踪您正在做的事情(以及在遇到一些看似不可逆转的难看的红色错误消息之前回滚到项目版本的能力),现在是用<em class="jo"> git </em>设置您的项目的好时机</li><li id="f631" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn lk jv jw jx bi translated">在您的终端中，导航(<code class="du kd ke kf kg b">cd</code>进入您的新应用<code class="du kd ke kf kg b">cd formidable</code></li><li id="cdaa" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn lk jv jw jx bi translated">在代码编辑器中打开项目。我正在使用VS代码，所以我将使用<code class="du kd ke kf kg b">code .</code>从命令行打开我的项目。如果对你来说更有意义的话，你也可以使用图形用户界面。</li></ol><h2 id="4f33" class="kh ki hi bd kj kk kl km kn ko kp kq kr jb ks kt ku jf kv kw kx jj ky kz la lb bi translated">创建一个“用户”模型</h2><p id="c389" class="pw-post-body-paragraph iq ir hi is b it lc iv iw ix ld iz ja jb lh jd je jf li jh ji jj lj jl jm jn hb bi translated">好了，现在我们要开始使用我们的数据库来建立模型，以接收和输出信息。幸运的是，我们不需要多年使用SQL的经验就能做到这一点。Rails中的过程非常简单。</p><p id="09cb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">注意</strong>在命令行中键入命令时，Rails就像快捷方式一样——我们将使用几次<code class="du kd ke kf kg b">generate</code>命令。我喜欢快捷方式，Rails让我们使用<code class="du kd ke kf kg b">g</code>来代替generate，所以我会使用它。只要记住它的意思，它做同样的事情。</p><ol class=""><li id="c058" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn lk jv jw jx bi translated">在你的终端，输入<code class="du kd ke kf kg b">rails g model User username:string email:string password:string</code></li><li id="434f" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn lk jv jw jx bi translated">好的。不错！你会在你的终端上看到几行… <code class="du kd ke kf kg b">invoke</code>和一些<code class="du kd ke kf kg b">create</code>行，告诉我们我们的命令告诉rails创建一些新的东西。</li><li id="0402" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn lk jv jw jx bi translated">在代码编辑器中，去看看创建了什么。当我们运行这个命令时，我们构建了第一个<em class="jo">迁移</em>。迁移本质上是一个文件，它向数据库传达应该向其中输入什么以及如何输入。</li><li id="00ab" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn lk jv jw jx bi translated">在代码编辑器中转至该路径查看文件<code class="du kd ke kf kg b">db/migrate/</code></li></ol><pre class="ll lm ln lo fd lp kg lq lr aw ls bi"><span id="d170" class="kh ki hi kg b fi lt lu l lv lw">class CreateUsers &lt; ActiveRecord::Migration[6.1]<br/>  def change<br/>	create_table :users do |t|<br/>	  t.string :username<br/>	  t.string :email<br/>	  t.string :password<br/>			<br/>	  t.timestamps<br/>    end<br/>  end<br/>end</span></pre><p id="dc32" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这是我的档案的样子。注意说<code class="du kd ke kf kg b">create_table</code>的部分，后面跟着几个输入位——啊哈！这是我们在终端命令中定义的东西— <code class="du kd ke kf kg b">:username</code>、<code class="du kd ke kf kg b">:email</code>和<code class="du kd ke kf kg b">:password</code></p><ol class=""><li id="dba8" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn lk jv jw jx bi translated">好了，这个迁移文件就是我们想要告诉我们的数据库的样子。我们实际上还没有将数据发送到数据库…所以…这是否意味着它只是…基础？明白了吗？<br/>好，让我们使用这个迁移文件……嗯，将其迁移到终端中的数据库，输入<code class="du kd ke kf kg b">rails db:migrate</code> -如果你好奇，请返回到代码编辑器中的<code class="du kd ke kf kg b">migrate</code>文件夹，现在你会看到一个<code class="du kd ke kf kg b">schema.rb</code> -不要编辑那个人。我们将坚持用“迁移”来编辑数据库。</li></ol><h2 id="a90e" class="kh ki hi bd kj kk kl km kn ko kp kq kr jb ks kt ku jf kv kw kx jj ky kz la lb bi translated">添加表单验证</h2><p id="ea8b" class="pw-post-body-paragraph iq ir hi is b it lc iv iw ix ld iz ja jb lh jd je jf li jh ji jj lj jl jm jn hb bi translated">很可能您想要限制用户发送到数据库的内容类型。你真的不希望用户提交一个空白字段。我们希望确保“用户名”有所填写，并且可能希望确保他们已经设置了密码。让我们这样做</p><ol class=""><li id="ec27" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn lk jv jw jx bi translated">在你的编辑器里，转到<code class="du kd ke kf kg b">app/models/user.rb</code> <br/>应该是蛮光秃秃的。编辑该文件，如下所示:</li></ol><pre class="ll lm ln lo fd lp kg lq lr aw ls bi"><span id="d476" class="kh ki hi kg b fi lt lu l lv lw">class User &lt; ApplicationRecord<br/>	validates :username, :email, :password, presence: true<br/>end</span></pre><p id="e54f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们模型中的这个小编辑对Rails说，“嘿，检查(验证)这些东西，以确保当有人提交表单时它们存在。”</p><h2 id="ec92" class="kh ki hi bd kj kk kl km kn ko kp kq kr jb ks kt ku jf kv kw kx jj ky kz la lb bi translated">控制器:生成我们的第一个控制器</h2><p id="cbb0" class="pw-post-body-paragraph iq ir hi is b it lc iv iw ix ld iz ja jb lh jd je jf li jh ji jj lj jl jm jn hb bi translated">我们已经解决了Rails MVC结构中的M,“模型”或数据库。现在让我们敲掉C部分。我们需要告诉Rails如何处理我们提供给我们创建的用户模型的那些数据。现在，我们简单地为我们想要执行的每个动作创建一个“空方法”——在本例中是<code class="du kd ke kf kg b">:create</code>和<code class="du kd ke kf kg b">:new</code></p><ol class=""><li id="bd96" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn lk jv jw jx bi translated">前往<code class="du kd ke kf kg b">app/controllers/user_controllers.rb</code>。它看起来会像这样:</li></ol><pre class="ll lm ln lo fd lp kg lq lr aw ls bi"><span id="7308" class="kh ki hi kg b fi lt lu l lv lw">class UserController &lt; ApplicationController<br/>end</span></pre><p id="0923" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这里没什么事。让我们添加我们的“空方法”。为什么是“空的”——因为我们不打算在这些方法中写任何东西。我们只是告诉控制器“嘿，这些东西是存在的，所以当你做事情时，只要知道它们在那里，mmmk？”将此文件更改为:</p><pre class="ll lm ln lo fd lp kg lq lr aw ls bi"><span id="3401" class="kh ki hi kg b fi lt lu l lv lw">class UserController &lt; ApplicationController<br/>	def new<br/>	end<br/>	<br/>	def create<br/>	end<br/>end</span></pre><p id="eda4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">简单。现在Rails知道这些存在，我们离真正有趣的部分更近了一步。表格！！！但是首先，我们需要确保任何使用“新建”或“创建”的请求都被路由到正确的路径。否则…嗯..错误。</p><h2 id="3302" class="kh ki hi bd kj kk kl km kn ko kp kq kr jb ks kt ku jf kv kw kx jj ky kz la lb bi translated">路线</h2><p id="bcaf" class="pw-post-body-paragraph iq ir hi is b it lc iv iw ix ld iz ja jb lh jd je jf li jh ji jj lj jl jm jn hb bi translated">我们需要能够正确地引导任何传入的请求。在我们的例子中，我们关心的是“创建”一个新用户。让我们的用户模型能够接收<code class="du kd ke kf kg b">create</code>和<code class="du kd ke kf kg b">new</code>请求。“咦，那些不都是一样的东西吗？”算是吧，也不算。</p><p id="20f2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这可能会让我们陷入困境，但简单的答案是<code class="du kd ke kf kg b">new</code>创建一个新的对象实例，而<code class="du kd ke kf kg b">create</code>是将其保存到数据库所必需的。</p><p id="b884" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">关于“资源”的一个简短说明——它们本质上是我们可以使用表单执行的所有操作，遵循CRUD原则(创建、读取、更新、销毁)。这包括创建新用户、编辑用户或内容、删除用户、查看用户信息等。</p><ol class=""><li id="f4d6" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn lk jv jw jx bi translated">转至<code class="du kd ke kf kg b">routes.rb</code>文件，编辑我们表格的可用方法<code class="du kd ke kf kg b">config/routes.rb</code> <br/>为我们的用户模型添加资源行</li></ol><pre class="ll lm ln lo fd lp kg lq lr aw ls bi"><span id="5705" class="kh ki hi kg b fi lt lu l lv lw">Rails.application.routes.draw do <br/>	resources :users, only: [:new, :create]<br/>end</span></pre><h2 id="cb68" class="kh ki hi bd kj kk kl km kn ko kp kq kr jb ks kt ku jf kv kw kx jj ky kz la lb bi translated">查看—让我们看看我们有什么！</h2><p id="8340" class="pw-post-body-paragraph iq ir hi is b it lc iv iw ix ld iz ja jb lh jd je jf li jh ji jj lj jl jm jn hb bi translated">好吧，我们实际上还看不到任何东西。在看到任何东西之前，我们需要开始构建一些表单。现在让我们只创建我们的第一个视图(又名页面)并在那里放一点东西，这样我们就知道一切都在工作。</p><ol class=""><li id="f8c1" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn lk jv jw jx bi translated">在您的编辑器中，转到<code class="du kd ke kf kg b">app/views/users</code>。右键单击users文件夹，创建一个名为<code class="du kd ke kf kg b">new.html.erb</code>的新文件</li><li id="38cc" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn lk jv jw jx bi translated">让我们输入一个标题进行渲染，这样我们就可以在新制作的页面上看到一些东西<code class="du kd ke kf kg b">&lt;h1&gt; This Site is Formidable! &lt;/h1&gt;</code></li><li id="31ad" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn lk jv jw jx bi translated">关键时刻到了。在您的终端中，通过运行<code class="du kd ke kf kg b">rails server</code>或<code class="du kd ke kf kg b">rails s</code>启动您的rails服务器(又是这些可爱的快捷方式)。</li><li id="8b98" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn lk jv jw jx bi translated">输出应该说它启动了您的服务器。在你的浏览器中点击这个网址:<code class="du kd ke kf kg b">http://localhost:3000/users/new</code>或<a class="ae lx" href="http://127.0.0.1:3000/users/new" rel="noopener ugc nofollow" target="_blank">http://127 . 0 . 0 . 1:3000/users/new</a>将会把你带到同一个地方。嘣！您应该会看到您的标题出现。</li></ol><h2 id="97eb" class="kh ki hi bd kj kk kl km kn ko kp kq kr jb ks kt ku jf kv kw kx jj ky kz la lb bi translated">第二部分—构建HTML表单</h2><p id="4660" class="pw-post-body-paragraph iq ir hi is b it lc iv iw ix ld iz ja jb lh jd je jf li jh ji jj lj jl jm jn hb bi translated">这是我一开始就答应你的部分。它应该作为表单的复习工具，加深您对表单如何让Rails应用程序运行的理解。戴上你的HTML帽子，让我们构建一些丑陋但有用的表单。哦，我说过我们做的东西很丑吗？是的，这里没有CSS。我很想美化它们，但这本指南已经够长了。</p><p id="e2cf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">请记住，rails有助手为我们完成大部分工作，但我们是手动完成的，目标是在表单方面做得更好。</p><h2 id="fc9d" class="kh ki hi bd kj kk kl km kn ko kp kq kr jb ks kt ku jf kv kw kx jj ky kz la lb bi translated">手动创建新的用户表单</h2><p id="5967" class="pw-post-body-paragraph iq ir hi is b it lc iv iw ix ld iz ja jb lh jd je jf li jh ji jj lj jl jm jn hb bi translated">当我们构建表单时，在Rails中工作时，我们需要记住几件事情——<code class="du kd ke kf kg b">method</code>和<code class="du kd ke kf kg b">action</code>,还有<code class="du kd ke kf kg b">name</code>。这个(<code class="du kd ke kf kg b">name</code>)特别重要，我们以后会看到。</p><ol class=""><li id="8796" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn lk jv jw jx bi translated">打开您的<code class="du kd ke kf kg b">&lt;form&gt;</code>标签，输入我们的每个模型属性- <code class="du kd ke kf kg b">username</code>、<code class="du kd ke kf kg b">email</code>和<code class="du kd ke kf kg b">password</code>。</li><li id="1181" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn lk jv jw jx bi translated">记住表单标签上的动作和方法，使密码类型<code class="du kd ke kf kg b">type='password</code>。</li><li id="6bc8" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn lk jv jw jx bi translated">在复制我下面得到的之前，看看你是否能创建表单。不要忘记提交输入，这样我们的用户在准备好的时候就有一个按钮可以进行mash。</li></ol><p id="1e34" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi">…………</p><p id="e0df" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">好了，您的<code class="du kd ke kf kg b">app/views/new.html.erb</code>文件中应该有这样的内容:</p><pre class="ll lm ln lo fd lp kg lq lr aw ls bi"><span id="a276" class="kh ki hi kg b fi lt lu l lv lw">&lt;form action='/users' method='post' accept-charset="UTF-8"&gt;<br/>  &lt;label for='username'&gt;Username&lt;label&gt;<br/>  &lt;input type="text" id="username" name="username"&gt; &lt;br&gt;<br/><br/>  &lt;label for="email"&gt;Email Address&lt;/label&gt;<br/>  &lt;input type="text" id="email" name="email" &gt; &lt;br&gt;<br/><br/>  &lt;label for="password"&gt;Password&lt;/label&gt;<br/>  &lt;input type="password" id="password" name="password"&gt; &lt;br&gt;<br/><br/>  &lt;input type="hidden" name="authenticity_token" value="&lt;%= form_authenticity_token%&gt;" &gt;<br/><br/>  &lt;input type="submit" value="Submit"&gt;<br/>&lt;/form&gt;</span></pre><p id="17d9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你明白了，那就拍拍自己的背，喝杯啤酒吧。如果没有，也不用担心。我没有给你提供一些关键信息。</p><h2 id="1a60" class="kh ki hi bd kj kk kl km kn ko kp kq kr jb ks kt ku jf kv kw kx jj ky kz la lb bi translated">动作和方法一<code class="du kd ke kf kg b">&lt;form&gt;</code>标签</h2><p id="6ce1" class="pw-post-body-paragraph iq ir hi is b it lc iv iw ix ld iz ja jb lh jd je jf li jh ji jj lj jl jm jn hb bi translated">如果您在终端中运行<code class="du kd ke kf kg b">rails routes</code>，就可以找到<code class="du kd ke kf kg b">action='/users'</code>和<code class="du kd ke kf kg b">method='post'</code>。它会返回一大堆不同的路线。既然我们已经生成了控制器并添加了<code class="du kd ke kf kg b">:new</code>和<code class="du kd ke kf kg b">:create</code>资源，我们应该会看到与之对应的可用路径列表</p><p id="9501" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">它将为每个选项列出合适的路径和方法。</p><h2 id="a7a5" class="kh ki hi bd kj kk kl km kn ko kp kq kr jb ks kt ku jf kv kw kx jj ky kz la lb bi translated">鉴定</h2><p id="7d9f" class="pw-post-body-paragraph iq ir hi is b it lc iv iw ix ld iz ja jb lh jd je jf li jh ji jj lj jl jm jn hb bi translated">我没有提到的另一件事是隐藏真实性标记的隐藏输入。这对于安全性非常重要，可以确保您的应用程序不会提交不良或恶意数据，并且只有来自您正确表单的数据才能通过。</p><ul class=""><li id="831f" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated">这是目前为止文件中唯一嵌入的ruby代码。看一下上面的代码块，注意隐藏输入的<code class="du kd ke kf kg b">value</code><code class="du kd ke kf kg b">&lt;%= form_authenticity_token%</code></li></ul><p id="6ddf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Fd Rails为我们提供了这个令牌，我们只需要在这里实现它</p><p id="ce6d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你做的一切都正确，你的表格应该提交。当您单击submit按钮时，您可以通过查看终端输出来判断。它应该是这样的:</p><pre class="ll lm ln lo fd lp kg lq lr aw ls bi"><span id="7c3a" class="kh ki hi kg b fi lt lu l lv lw">Started POST "/users" for 127.0.0.1 at 2021-04-06 12:37:59 -0400<br/>Processing by UsersController#create as HTML<br/>  Parameters: {"username"=&gt;"bryan", "email"=&gt;"bryangoertz@gmail.com", "password"=&gt;"[FILTERED]", "authenticity_token"=&gt;"[FILTERED]"}<br/>No template found for UsersController#create, rendering head :no_content<br/>Completed 204 No Content in 1ms (Allocations: 325)</span></pre><p id="79f2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">酷，它有我们所有提交的信息！太棒了，但是等等,“找不到模板”是什么问题？</p><p id="94e0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们成功提交了表单，但是我们没有告诉Rails之后会发生什么。</p><p id="681e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们有了一个新用户，但是我们还没有将它保存到数据库中。让我们建立<code class="du kd ke kf kg b">#create</code>行动来为我们的下一步做准备:</p><ol class=""><li id="20be" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn lk jv jw jx bi translated">转到<code class="du kd ke kf kg b">app/controllers</code>目录中的<code class="du kd ke kf kg b">UsersController</code>，在那里我们有<code class="du kd ke kf kg b">#create</code>和<code class="du kd ke kf kg b">#new</code>的两个空白方法</li><li id="cf32" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn lk jv jw jx bi translated">是时候给我们的create方法添加一点逻辑了。目标是成功的用户创建重定向回新的用户表单，空白并准备好另一个新的用户创建。如果它由于某种原因失败了，我们想用现有的信息重新呈现同一个<code class="du kd ke kf kg b">:new</code>表单——有一个错误，我们可以稍后构建错误消息。</li><li id="2e4b" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn lk jv jw jx bi translated">我们的<code class="du kd ke kf kg b">users_controller</code>现在应该是这样的</li></ol><pre class="ll lm ln lo fd lp kg lq lr aw ls bi"><span id="1926" class="kh ki hi kg b fi lt lu l lv lw"># app/controller/user_controller.rb <br/>def new<br/>end<br/><br/>def create <br/>  @user = User.new(username: params[:username], email: params[:email], password: params[:password])<br/><br/>  if @user.save<br/>    redirect_to new_user_path<br/>  else<br/>    render: :new<br/>  end<br/>end</span></pre><p id="b99d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果一切都做得正确，我们的服务器终端应该输出一些关于某种<code class="du kd ke kf kg b">INSERT INTO "users" ...</code>之类的信息。那就好！这是一个将数据插入表中的SQL命令。</p><ol class=""><li id="69a2" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn lk jv jw jx bi translated">让我们简化一下<code class="du kd ke kf kg b">create</code>方法中的params参数——这有点难以控制。如果我们使用帮助器方法<code class="du kd ke kf kg b">form_with</code>，我们会为用户参数存储一个属性散列<br/> <em class="jo">这就是表单中</em> <code class="du kd ke kf kg b"><em class="jo">name</em></code> <em class="jo">属性发挥作用的地方</em></li><li id="b352" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn lk jv jw jx bi translated">使用硬括号将用户字段(用户名、电子邮件、密码)<em class="jo">嵌套在</em> <code class="du kd ke kf kg b"><em class="jo">name</em></code> <em class="jo">属性内，例如<code class="du kd ke kf kg b">name="user[email]"</code></em></li><li id="c0f0" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn lk jv jw jx bi translated">现在就做。转到您的<code class="du kd ke kf kg b">app/views/new.html.erb</code>文件，并适当地更改每个字段的表单<code class="du kd ke kf kg b">name</code>属性。完成后，它应该是这样的:</li></ol><pre class="ll lm ln lo fd lp kg lq lr aw ls bi"><span id="6822" class="kh ki hi kg b fi lt lu l lv lw">&lt;form action='/users' method='post' accept-charset="UTF-8"&gt;<br/>  &lt;label for="username"&gt;Username&lt;/label&gt;<br/>  &lt;input type="text" id="username" name="user[username]"&gt; &lt;br&gt;<br/><br/>  &lt;label for="email"&gt;Email Address&lt;/label&gt;<br/>  &lt;input type="text" id="email" name="user[email]" &gt; &lt;br&gt;<br/><br/>  &lt;label for="password"&gt;Password&lt;/label&gt;<br/>  &lt;input type="password" id="password" name="user[password]"&gt; &lt;br&gt;<br/><br/>  &lt;input type="hidden" name="authenticity_token" value="&lt;%= form_authenticity_token%&gt;" &gt;<br/><br/>  &lt;input type="submit" value="Submit"&gt;<br/><br/>&lt;/form&gt;</span></pre><p id="23c5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">好极了。现在让我们往回走一点。</p><ol class=""><li id="26dd" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn lk jv jw jx bi translated">回到您的<code class="du kd ke kf kg b">app/controllers/users_controller.rb</code>中，在create方法中注释掉您的新用户行。它以用户实例变量<code class="du kd ke kf kg b">@user ...</code>开始，并包含了我们所有的个体变量<code class="du kd ke kf kg b">params</code>。</li><li id="d0e7" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn lk jv jw jx bi translated">为我们的参数创建一个<code class="du kd ke kf kg b">private</code>方法。保安！！<br/>转到文件底部，就在最后一个<code class="du kd ke kf kg b">end</code>的<em class="jo">上面，添加下面的代码来完成我们刚刚注释掉的行的工作，但是安全地使用<code class="du kd ke kf kg b">permit</code>和<code class="du kd ke kf kg b">require</code>:</em></li></ol><pre class="ll lm ln lo fd lp kg lq lr aw ls bi"><span id="3241" class="kh ki hi kg b fi lt lu l lv lw">...<br/>  private<br/><br/>  def user_params<br/> params.require(:user).permit(:username, :email, :password)<br/>  end<br/>end</span></pre><p id="f803" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们需要告诉我们的<code class="du kd ke kf kg b">:new</code>方法在哪里可以找到<code class="du kd ke kf kg b">private</code>区域中的参数。我们通过将新的私有方法传递给<code class="du kd ke kf kg b">new</code>方法来实现，在我们注释掉它们之前，我们的参数曾经住在这个方法中。</p><ol class=""><li id="1115" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn lk jv jw jx bi translated">转到上面的注释行，更改为:</li><li id="923e" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn lk jv jw jx bi translated">@user = User.new(user_params)</li><li id="50c5" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn lk jv jw jx bi translated">整个<code class="du kd ke kf kg b">users_controller.rb</code>现在看起来像这样:</li></ol><pre class="ll lm ln lo fd lp kg lq lr aw ls bi"><span id="eb4b" class="kh ki hi kg b fi lt lu l lv lw">class UsersController &lt; ApplicationController<br/>  def new<br/>  end<br/><br/>  def create<br/>	@user = User.new(user_params)<br/><br/>	if @user.save<br/>	  redirect_to new_user_path<br/>	else<br/>	  render :new<br/>	end <br/>  end<br/><br/><br/>  private<br/><br/>  def user_params<br/>	params.require(:user).permit(:username, :email, :password)<br/>  end<br/>end</span></pre><p id="ee8a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">好的..这基本上就是我们所需要的。继续向数据库提交一个新用户，并注意输出。</p><p id="b73b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我不知道你是否注意到了，但之前当我们提交用户数据时，它吐回了我们所有的信息，就像是在赠送免费披萨一样。你的名字、电子邮件和密码被暴露给任何人偷看，让你变得脆弱、害怕，并可能成为一些恶意活动的受害者。</p><p id="9637" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，随着我们的私有方法被传递到我们的<code class="du kd ke kf kg b">:new</code>方法中，我们的信息被隐藏并且是安全的。这就是我们想要的！</p><p id="7468" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">关于我们刚刚学到的所有东西，最好的部分是我们应该知道它，但是如果我们选择使用<code class="du kd ke kf kg b">form_with</code> helper方法，我们真的不需要把它都写出来。</p><p id="2065" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">请继续关注关于在Rails表单中使用助手方法的指南。他们非常有趣。</p><h2 id="a9cc" class="kh ki hi bd kj kk kl km kn ko kp kq kr jb ks kt ku jf kv kw kx jj ky kz la lb bi translated">TL；博士，如果您只需要这些步骤，这里有一个我们在上面所做工作的快速步骤列表:</h2><p id="111a" class="pw-post-body-paragraph iq ir hi is b it lc iv iw ix ld iz ja jb lh jd je jf li jh ji jj lj jl jm jn hb bi translated">第一部分</p><ol class=""><li id="4b94" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn lk jv jw jx bi translated"><code class="du kd ke kf kg b">rails new formidable</code></li><li id="a426" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn lk jv jw jx bi translated">启动git并开始控制您的版本</li><li id="e60e" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn lk jv jw jx bi translated">移动到您的项目文件夹<code class="du kd ke kf kg b">cd formidable</code></li><li id="d79e" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn lk jv jw jx bi translated">在VS代码中打开<code class="du kd ke kf kg b">code .</code></li></ol><p id="5a1b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">第二部分—创建用户模型和表单验证</p><ul class=""><li id="a2f7" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated">在终端中，使用命令<code class="du kd ke kf kg b">rails g model User username:string email:string password:string</code>生成一个新的数据库模型</li><li id="af33" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">导航到刚刚创建的迁移文件，确保它创建正确— <code class="du kd ke kf kg b">db/migrations/crazynumberfile</code>如果正确，继续。如果不是，请将其删除并重试。</li><li id="d73a" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">运行<code class="du kd ke kf kg b">rails db:migrate</code></li><li id="84f3" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">导航到<code class="du kd ke kf kg b">app/models/users.rb</code>并添加您的验证。在红宝石<code class="du kd ke kf kg b">class</code>里面加上<code class="du kd ke kf kg b">validates :username, :email, :password, presence: true</code></li></ul><p id="47cd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">第三部分—生成控制器并添加路由资源</p><ul class=""><li id="2bc1" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated">将我们的方法添加到UserController中。我们只是为该指南创建一个用户，所以我们将添加<code class="du kd ke kf kg b">#new</code>和<code class="du kd ke kf kg b">#create</code>操作。在<code class="du kd ke kf kg b">app/controllers/users_controller.rb</code> -它们将暂时空着。</li><li id="1e66" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">您的<code class="du kd ke kf kg b">users_controller.rb</code>文件应该是这样的</li></ul><pre class="ll lm ln lo fd lp kg lq lr aw ls bi"><span id="1e8f" class="kh ki hi kg b fi lt lu l lv lw">class UserController &lt; ApplicationController<br/>	def new<br/>	end<br/>	<br/>	def create<br/>	end<br/>end</span></pre><ul class=""><li id="680e" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated">当发出<code class="du kd ke kf kg b">new</code>或<code class="du kd ke kf kg b">create</code>请求时，告诉rails去哪里:在您的<code class="du kd ke kf kg b">config/routes.rb</code>中添加我们想要授予用户对象的资源。</li></ul><pre class="ll lm ln lo fd lp kg lq lr aw ls bi"><span id="1918" class="kh ki hi kg b fi lt lu l lv lw">Rails.application.routes.draw do <br/>		resources :users, only: [:new, :create]<br/>	end</span></pre><p id="ed61" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">第四部分——视图和表单时间</p><ul class=""><li id="5111" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated">在<code class="du kd ke kf kg b">app/views/users</code>目录中创建一个名为<code class="du kd ke kf kg b">new.html.erb</code>的文件</li><li id="10b8" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">添加一个<code class="du kd ke kf kg b">&lt;h1&gt;</code>或其他内容来确保你的页面被渲染。</li><li id="babb" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">启动您的服务器— <code class="du kd ke kf kg b">rails s</code></li><li id="ef7e" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">将浏览器导航到您的“新”页面<code class="du kd ke kf kg b">localhost:3000/users/new</code>，您应该会看到您新创建的测试内容</li><li id="9038" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">为我们的3个数据库/模型项目— <code class="du kd ke kf kg b">username</code>、<code class="du kd ke kf kg b">email</code>和<code class="du kd ke kf kg b">password</code>—创建带有字段和标签的表单，确保为您的表单提供一个动作(路径)和方法(用于提交我们使用POST的表单)。</li><li id="22f3" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">添加一个rails认证令牌，使用Rails提供的<code class="du kd ke kf kg b">&lt;%= form_authenticity_token %&gt;</code>为我们的表单建立安全性——我们把它放在一个隐藏的输入中。<em class="jo">参见本节后的完整代码块以供参考。</em></li><li id="9f9e" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">因为我们的控制器接管了部分表单提交过程，我们需要为我们的字段赋予适当的<code class="du kd ke kf kg b">name</code>属性，包括我们的型号名称和适当的属性，例如<code class="du kd ke kf kg b">name="user[email]"</code>。对所有需要名称的表单域执行此操作。<code class="du kd ke kf kg b">authenticity_token</code>和<code class="du kd ke kf kg b">submit</code>输入不会遵循这种格式。</li><li id="aa08" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">你的完整表格应该是这样的:</li></ul><pre class="ll lm ln lo fd lp kg lq lr aw ls bi"><span id="b418" class="kh ki hi kg b fi lt lu l lv lw">&lt;h1&gt;This App is Formidable! &lt;/h1&gt;<br/><br/>&lt;form action='/users' method='post' accept-charset="UTF-8"&gt;<br/>  &lt;label for="username"&gt;Username&lt;/label&gt;<br/>  &lt;input type="text" id="username" name="user[username]"&gt; &lt;br&gt;<br/><br/>  &lt;label for="email"&gt;Email Address&lt;/label&gt;<br/>  &lt;input type="text" id="email" name="user[email]" &gt; &lt;br&gt;<br/><br/>  &lt;label for="password"&gt;Password&lt;/label&gt;<br/>  &lt;input type="password" id="password" name="user[password]"&gt; &lt;br&gt;<br/><br/>  &lt;input type="hidden" name="authenticity_token" value="&lt;%= form_authenticity_token%&gt;" &gt;<br/><br/>  &lt;input type="submit" value="Submit"&gt;<br/><br/>&lt;/form&gt;</span></pre><ul class=""><li id="0214" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated">转到<code class="du kd ke kf kg b">app/controllers</code>目录中的<code class="du kd ke kf kg b">UsersController</code>,在那里我们有两个用于<code class="du kd ke kf kg b">#create</code>和<code class="du kd ke kf kg b">#new</code>的空白方法</li><li id="6eab" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">我们希望使用<code class="du kd ke kf kg b">@user = User.new</code>创建用户实例，后跟我们正在寻找的参数，但我们需要保持我们的数据私有。因此，与其在<code class="du kd ke kf kg b">@user = User.new</code>之后的<code class="du kd ke kf kg b">create</code>方法中直接传入我们的参数，不如在最后一个<code class="du kd ke kf kg b">end</code>之上添加一个<code class="du kd ke kf kg b">private</code>方法，如下所示:</li></ul><pre class="ll lm ln lo fd lp kg lq lr aw ls bi"><span id="e7b0" class="kh ki hi kg b fi lt lu l lv lw">...<br/>  private<br/><br/>  def user_params<br/> params.require(:user).permit(:username, :email, :password)<br/>  end<br/>end</span></pre><ul class=""><li id="7661" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated">我们现在可以将这个<code class="du kd ke kf kg b">user_params</code>方法传递给上面的<code class="du kd ke kf kg b">#create</code>动作，结果是我们的<code class="du kd ke kf kg b">params</code>(也就是我们允许的)保持安全。<code class="du kd ke kf kg b">users_controller.rb</code>将看起来像这样:</li></ul><pre class="ll lm ln lo fd lp kg lq lr aw ls bi"><span id="f5e6" class="kh ki hi kg b fi lt lu l lv lw">class UsersController &lt; ApplicationController<br/>  def new<br/>  end<br/><br/>  def create<br/>	@user = User.new(user_params)<br/><br/>	if @user.save<br/>	  redirect_to new_user_path<br/>	else<br/>	  render :new<br/>	end <br/>  end<br/>  <br/>  private<br/>  def user_params<br/>	params.require(:user).permit(:username, :email, :password)<br/>  end<br/>end</span></pre><ul class=""><li id="f7df" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated">注意，我们添加了一些条件逻辑，以便在成功或出错时重定向到适当的页面。</li></ul><p id="bae6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这是简短的版本。如果你在那里卡住了，看看我在哪里更详细地经历这个过程。</p><p id="8d7a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">派对！</p></div></div>    
</body>
</html>