# 在 Flutter 中使用 BLOC 实现搜索特性来过滤列表的正确方法

> 原文：<https://medium.com/codex/the-right-way-to-implement-a-search-feature-to-filter-a-list-using-bloc-in-flutter-799969781fdb?source=collection_archive---------2----------------------->

![](img/0efe322cebe0e9135ead38903eef442a.png)

你好，在这篇文章中，你将了解 Flutter Bloc 如何在优化我们的资源消耗方面发挥巨大作用，以便我们可以有更好的用户体验，并更合理地使用我们现有的资源。

这篇文章还会告诉你 bloc 和 cubit 的区别，并且会回答你更多的问题，比如为什么两者都在一个叫做 Bloc 的库中，什么时候使用它们。

我就直截了当了，所以，我直接从一个例子开始。假设您想要构建一个包含文本字段和按钮的页面，该页面允许用户输入文本并单击按钮来执行搜索操作。当用户单击按钮时，包含输入的关键字的 GET 请求将被发送到服务器，最后一个请求将过滤完整的项目列表，并返回包含与用户希望看到的内容相对应的列表项目的响应。

假设您选择使用 cubit 来实现这一切，您创建了一个 cubit，并在其中放置了一个名为 search 的方法，该方法接收一个字符串并发送一个请求以接收一个包含列表的响应，最后发出一个包含我们希望向用户显示的数据的状态。UI 部分要简单得多，您可以从 search 按钮的 onPressed 回调中调用 search 方法，并传递我们从作为辅助控制器的文本字段中获得的 search 关键字。到目前为止，一切都很简单，我们只是创建了一个 cubit，它有一个方法，用户可以调用并传递一些输入来接收状态。状态在被认为是数据流的流中传输。

为了显示我们从服务器获得的数据，我们创建了一个 listview 并封装在一个 blocBuilder 小部件中，这个小部件使我们能够订阅一个流并等待我们需要更新 UI 的状态。祝贺您，您已经完成了搜索功能的实现。

有一天，你觉得有必要去掉搜索按钮，这个想法是在你使用脸书的时候产生的，你发现去掉搜索按钮会让用户感觉更舒服。因此，您删除了它，并稍微调整了文本字段代码，以便在输入的关键字发生变化时调用 cubit 的搜索方法，当然，您将使用 onChanged 回调函数，如下所示:

![](img/5c98fd69fefaaffa4c3e4518f51153ba.png)

你感觉很好，你认为一切都很完美，突然你的后端人员打电话来，他告诉你他发现了一个大问题，他注意到许多不必要的请求来自与搜索功能相关的应用程序。你的朋友抓起一张纸，开始向你解释这个问题，他直接把一个例子付诸行动，埃隆·马斯克也参与了进来:)。

这个例子是关于输入“Elon musk”作为搜索词，他键入“Elon”，你会注意到应用程序向服务器发送了 4 个请求，每个请求对应一个字符串:“E”、“El”、“Elo”和“Elon”。此外，这个问题发生在你删除一个字母时，你会看到应用程序将发送另一个请求，例如，如果你从“Elon”中删除“n”，那么另一个请求将被发送到服务器，你会得到新的数据作为对单词“Elo”的响应，想象一下，如果你正在使用 Firebase Firestore，你将根据你执行的请求量收费:)。

这就是 Bloc 派上用场的地方，与 cubit 不同，Bloc 接收事件作为输入，而不是函数，这些事件将在事件流中传输，这样我们可以控制函数的执行时间，因为我们控制流中发送的事件。

我们如何解决这个问题？你要做的第一件事是将你的 cubit 转换成一个 bloc，并创建一个名为 searchEvent 的新事件，这样你在 Changed 回调中的文本字段将如下所示:

![](img/2e0c817017e5dde509036f90053df51b.png)

之后，您设置您的块在搜索事件到来时执行搜索功能，它可以这样完成:

![](img/7ccbc09b79d02d86ae0174afd378f7ce.png)

最后，您可以通过应用 depounceTime 来使用 RxDart 的功能，以便忽略在我们定义的时间范围内发生的任何事件。代码应该是这样的:

![](img/d8d6b61bc342541167be42ad6ff9935a.png)

您可以修改代码以添加更多约束。这就是了。

我想通过回答一些问题来结束这篇文章，例如:

*   为什么 Bloc 和 Cubit 在一个库中？
*   我们可以在同一个项目中使用这两个吗？
*   什么时候用什么？

答案是:

*   它们来自同一个库，因为它们共享几乎相同的工作机制，它们共享流来更新 UI。
*   是的，我们可以在同一个项目中使用这两者，但是我们根据用例来应用它们。
*   当我们有不需要很多事件的屏幕时，我们可以使用 cubit，这取决于开发者选择什么更适合他/她。

感谢你阅读这篇文章，❤

在 [Linkedin](https://www.linkedin.com/in/younes-belouche-641bb3197/) 、 [Instagram](https://www.instagram.com/younes_belouche/) 和 [Github](https://github.com/dombroks) 上和我联系。