<html>
<head>
<title>How to implement push notifications in a React Native app using Sendbird Chat</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Sendbird Chat在React本机应用程序中实现推送通知</h1>
<blockquote>原文：<a href="https://medium.com/codex/how-to-implement-push-notifications-in-a-react-native-app-using-sendbird-chat-a828f0aaca6f?source=collection_archive---------2-----------------------#2022-05-17">https://medium.com/codex/how-to-implement-push-notifications-in-a-react-native-app-using-sendbird-chat-a828f0aaca6f?source=collection_archive---------2-----------------------#2022-05-17</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/f85edf89aa6d9ddc2251ab1aaee58e4c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*0ytTHHv_KI1JP6zC.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">仙鸟2022</figcaption></figure><div class=""/><div class=""><h2 id="21d8" class="pw-subtitle-paragraph iu hw hx bd b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl dx translated">关于如何使用React Native for Android和iOS及时发送推送通知的分步教程</h2></div><p id="6abc" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">由塔哈·萨吉尔<br/>解决方案工程师| <a class="ae ki" href="https://www.sendbird.com/" rel="noopener ugc nofollow" target="_blank"> Sendbird </a></p><p id="889a" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated"><em class="kj">我们建议您查看</em> <a class="ae ki" href="https://github.com/sendbird/sendbird-chat-sdk-javascript" rel="noopener ugc nofollow" target="_blank"> <em class="kj">样本app </em> </a> <em class="kj">获取您可能需要的代码。如果您需要更多指导，请访问我们的</em> <a class="ae ki" href="https://sendbird.com/docs/chat/v4/javascript/guides/push-notifications#1-push-notifications" rel="noopener ugc nofollow" target="_blank"> <em class="kj">文档</em> </a> <em class="kj">。不要忘记查看应用内聊天的</em> <a class="ae ki" href="https://sendbird.com/demos/in-app-chat" rel="noopener ugc nofollow" target="_blank"> <em class="kj">演示</em> </a> <em class="kj">，并访问我们的</em> <a class="ae ki" href="https://sendbird.com/features/chat-messaging" rel="noopener ugc nofollow" target="_blank"> <em class="kj">网站</em> </a> <em class="kj">了解更多关于Sendbird Chat可以提供的服务。</em></p><blockquote class="kk kl km"><p id="373c" class="jm jn kj jo b jp jq iy jr js jt jb ju kn jw jx jy ko ka kb kc kp ke kf kg kh hb bi translated"><em class="hx">为了第一个了解新教程、开发者相关聊天/电话发布以及其他重要更新，</em> <a class="ae ki" href="https://get.sendbird.com/dev-newsletter-subscription.html" rel="noopener ugc nofollow" target="_blank"> <em class="hx">注册</em> </a> <em class="hx">获取我们的开发者简讯。</em></p></blockquote><h1 id="3c36" class="kq kr hx bd ks kt ku kv kw kx ky kz la jd lb je lc jg ld jh le jj lf jk lg lh bi translated">简介:什么是推送通知，为什么它们很重要？</h1><p id="05bd" class="pw-post-body-paragraph jm jn hx jo b jp li iy jr js lj jb ju jv lk jx jy jz ll kb kc kd lm kf kg kh hb bi translated">推送通知是由应用程序向其用户发送的自动、可点击的弹出消息。当设备空闲或在后台运行应用程序时，消息会立即发送到设备。推送通知非常重要，因为它们:</p><ul class=""><li id="ea6d" class="ln lo hx jo b jp jq js jt jv lp jz lq kd lr kh ls lt lu lv bi translated">传递与用户活动或兴趣相关的重要信息、提醒和新闻</li><li id="8486" class="ln lo hx jo b jp lw js lx jv ly jz lz kd ma kh ls lt lu lv bi translated">鼓励用户参与你的应用</li><li id="f71e" class="ln lo hx jo b jp lw js lx jv ly jz lz kd ma kh ls lt lu lv bi translated">展示特色内容</li><li id="8278" class="ln lo hx jo b jp lw js lx jv ly jz lz kd ma kh ls lt lu lv bi translated">推动有针对性的相关流量，提高转化率</li><li id="2a83" class="ln lo hx jo b jp lw js lx jv ly jz lz kd ma kh ls lt lu lv bi translated">使用个性化、适时、相关的内容创建无缝的用户体验</li></ul><p id="7aef" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">值得注意的是，美国智能手机用户平均每天会收到<a class="ae ki" href="https://www.businessofapps.com/marketplace/push-notifications/research/push-notifications-statistics/" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy"> 45条推送通知</strong> </a>！根据<a class="ae ki" href="https://rubygarage.org/blog/benefits-of-push-notifications" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy"> RubyGarage </strong> </a>的数据，实施推送通知的组织比没有实施的组织拥有高3倍的客户保持率和88%的参与度。虽然基于行业、位置、<a class="ae ki" href="https://www.braze.com/docs/user_guide/message_building_by_channel/push/types" rel="noopener ugc nofollow" target="_blank"><strong class="jo hy"/></a>类型和许多其他因素，推送通知选择加入和点击率存在<a class="ae ki" href="https://www.businessofapps.com/marketplace/push-notifications/research/push-notifications-statistics/" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy">变化</strong> </a>，但显然实现推送通知的理由很充分。</p><p id="ff95" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">本教程提供了实现React本机推送通知的分步说明。但首先，让我们来看看一些先决条件。</p><h1 id="4927" class="kq kr hx bd ks kt ku kv kw kx ky kz la jd lb je lc jg ld jh le jj lf jk lg lh bi translated">先决条件</h1><ol class=""><li id="44b9" class="ln lo hx jo b jp li js lj jv mb jz mc kd md kh me lt lu lv bi translated">创建一个<a class="ae ki" href="https://dashboard.sendbird.com/auth/signup" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy"> Sendbird账号</strong> </a>。</li><li id="5e90" class="ln lo hx jo b jp lw js lx jv ly jz lz kd ma kh me lt lu lv bi translated">确保<a class="ae ki" href="https://sendbird.com/features/chat-messaging" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy">仙鸟聊天</strong> </a>在你的React原生应用中运行良好。</li></ol><p id="0238" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">请记住，当从应用程序向Sendbird服务器发送消息时(通过JavaScript的<a class="ae ki" href="https://github.com/sendbird/sendbird-chat-sdk-javascript" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy">聊天SDK</strong></a>),服务器与FCM进行通信。然后，FCM向Android设备发送推送通知，或者与APN通信，向iOS设备发送推送通知。</p><h1 id="74ed" class="kq kr hx bd ks kt ku kv kw kx ky kz la jd lb je lc jg ld jh le jj lf jk lg lh bi translated">React本机应用程序的推送通知</h1><p id="9e3d" class="pw-post-body-paragraph jm jn hx jo b jp li iy jr js lj jb ju jv lk jx jy jz ll kb kc kd lm kf kg kh hb bi translated">可以使用用于JavaScript的<a class="ae ki" href="https://github.com/sendbird/sendbird-chat-sdk-javascript" rel="noopener ugc nofollow" target="_blank"><strong class="jo hy">Sendbird Chat SDK</strong></a>向混合移动应用用户(Android和iOS)发送推送通知。目前，JavaScript SDK的推送通知功能仅与React Native兼容。本教程提供了使用Firebase Cloud Messaging (FCM)和Sendbird Chat SDK在React本机应用程序中启用推送通知的详细信息。</p><p id="dc1d" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">在深入实现细节之前，我们先来谈谈<a class="ae ki" href="https://firebase.google.com/docs/cloud-messaging/concept-options" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy"> FCM消息</strong> </a>。有两种类型的FCM消息:通知消息和数据消息。根据<a class="ae ki" href="https://firebase.google.com/docs/cloud-messaging/concept-options" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy"> Firebase文档</strong> </a>，“通知消息有一组预定义的用户可见的键和一个可选的自定义键-值对的数据负载。”数据消息只包含用户定义的键值对。Sendbird使用数据消息，允许客户端应用程序创建由这些自定义键值对组成的自定义消息有效负载。</p><p id="4527" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">web应用程序不支持推送通知。如果您需要为web应用程序实现推送通知，我们建议使用webhook事件来为web应用程序实现推送通知。</p><p id="4d33" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">开始之前，请确保您可以访问<a class="ae ki" href="https://console.firebase.google.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy"> Firebase控制台</strong> </a>。让我们开始吧！💻</p><h1 id="e516" class="kq kr hx bd ks kt ku kv kw kx ky kz la jd lb je lc jg ld jh le jj lf jk lg lh bi translated">步骤1:向Sendbird仪表板注册FCM凭证和APNs证书</h1><p id="220b" class="pw-post-body-paragraph jm jn hx jo b jp li iy jr js lj jb ju jv lk jx jy jz ll kb kc kd lm kf kg kh hb bi translated">Sendbird服务器需要用于Android的FCM服务器密钥和用于iOS的APNs证书来传送推送通知。</p><p id="ab58" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">按照本<a class="ae ki" href="https://sendbird.com/developer/tutorials/implement-android-push-notifications" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy">教程</strong> </a>中的步骤1和2注册FCM凭证，并按照<a class="ae ki" href="https://sendbird.com/docs/chat/v3/ios/guides/push-notifications#2-how-to-register-push-notification-credentials" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy">文档</strong> </a>中的说明将APNs证书注册到Sendbird仪表板。</p><h1 id="6a9b" class="kq kr hx bd ks kt ku kv kw kx ky kz la jd lb je lc jg ld jh le jj lf jk lg lh bi translated">步骤2:安装React Native Firebase模块并添加配置文件</h1><p id="ed13" class="pw-post-body-paragraph jm jn hx jo b jp li iy jr js lj jb ju jv lk jx jy jz ll kb kc kd lm kf kg kh hb bi translated"><a class="ae ki" href="https://rnfirebase.io/" rel="noopener ugc nofollow" target="_blank"><strong class="jo hy">React Native Firebase</strong></a>是官方推荐的软件包集合，为Android和iOS应用程序上的所有Firebase服务带来React原生支持。按照<a class="ae ki" href="https://rnfirebase.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy">官方文档</strong> </a>中的说明，在React原生项目中为Android配置FCM，为iOS配置APNs。到这一步结束时，您应该已经将Android和iOS应用程序添加到Firebase项目中，并将各自的配置文件添加到React原生项目中。</p><p id="dd2b" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">请参考React Native Firebase <a class="ae ki" href="https://rnfirebase.io/messaging/notifications" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy">通知</strong> </a>页面，了解有关显示和处理来自FCM的通知的更多信息。</p><h1 id="1543" class="kq kr hx bd ks kt ku kv kw kx ky kz la jd lb je lc jg ld jh le jj lf jk lg lh bi translated">步骤3:向Sendbird服务器注册推送令牌</h1><p id="f10b" class="pw-post-body-paragraph jm jn hx jo b jp li iy jr js lj jb ju jv lk jx jy jz ll kb kc kd lm kf kg kh hb bi translated">要向特定的客户端应用程序发送通知消息，FCM需要由客户端应用程序实例颁发的用于Android设备的FCM注册令牌和用于iOS设备的APNs设备令牌。因此，Sendbird服务器还需要每个客户端应用程序实例的注册令牌来代表您向FCM发送通知请求。Chat SDK提供了一个接口，用于向Sendbird服务器注册和注销这两种类型的令牌。</p><p id="58bd" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">下面的代码片段显示了设备令牌注册。</p><figure class="mf mg mh mi fd hk"><div class="bz dy l di"><div class="mj mk l"/></div></figure><p id="76f7" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">注册的推送令牌出现在仪表板中的“用户&gt;用户id &gt;聊天”下:</p><figure class="mf mg mh mi fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ml"><img src="../Images/7084c3f97b839ec18c6ff9206290a36c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*20Wtxn0_pouj-Hi2.png"/></div></div></figure><h1 id="ddef" class="kq kr hx bd ks kt ku kv kw kx ky kz la jd lb je lc jg ld jh le jj lf jk lg lh bi translated">步骤4:接收推送通知消息</h1><p id="decc" class="pw-post-body-paragraph jm jn hx jo b jp li iy jr js lj jb ju jv lk jx jy jz ll kb kc kd lm kf kg kh hb bi translated">一旦注册了设备令牌，客户端应用程序实例就可以接收和处理FCM通知消息，而不管是iOS还是Android平台。参考React Native Firebase文档的<a class="ae ki" href="https://rnfirebase.io/messaging/usage#usage" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy">用法</strong> </a>页面，了解更多关于实现的信息。</p><p id="79cf" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">Sendbird Chat SDK for JavaScript不会自动检测应用程序的状态，因此需要显式调用Sendbird SDK提供的<strong class="jo hy"> setForegroundState </strong>()和<strong class="jo hy"> setBackgroundState </strong>()方法。</p><p id="da77" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">查看React Native Firebase文档，了解<a class="ae ki" href="https://rnfirebase.io/messaging/usage#receiving-messages" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy">接收消息</strong> </a>的可用事件处理程序。下面的代码片段显示了接收到的FCM消息的解析。</p><p id="6779" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">注意:频道是Android独有的概念，用于分类并允许用户控制如何在他们的设备上处理通知。</p><figure class="mf mg mh mi fd hk"><div class="bz dy l di"><div class="mj mk l"/></div></figure><p id="d5e9" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">从FCM数据消息解析的数据对象包含一组键值项目，如下面的JSON代码所示。</p><figure class="mf mg mh mi fd hk"><div class="bz dy l di"><div class="mj mk l"/></div></figure><h1 id="e3dc" class="kq kr hx bd ks kt ku kv kw kx ky kz la jd lb je lc jg ld jh le jj lf jk lg lh bi translated">推送通知的故障排除提示</h1><p id="99d9" class="pw-post-body-paragraph jm jn hx jo b jp li iy jr js lj jb ju jv lk jx jy jz ll kb kc kd lm kf kg kh hb bi translated">推送通知的故障排除可能很复杂；这里有一些做这件事的技巧。</p><ol class=""><li id="530d" class="ln lo hx jo b jp jq js jt jv lp jz lq kd lr kh me lt lu lv bi translated">为了让开发人员更容易调试和排除推送通知的故障，我们构建了一个测试工具，您可能会发现它很有用。请参见本<a class="ae ki" href="https://sendbird.com/developer/tutorials/mobile-push-notifications-tester" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy">教程</strong> </a>以了解如何使用该工具，您可以通过<a class="ae ki" href="https://dashboard.sendbird.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy"> Sendbird仪表盘</strong> </a>访问该工具。</li><li id="b239" class="ln lo hx jo b jp lw js lx jv ly jz lz kd ma kh me lt lu lv bi translated">查看这份全面的<a class="ae ki" href="https://sendbird.com/developer/tutorials/troubleshooting-android-chat-push-notifications" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy">指南</strong> </a>对Android聊天推送通知进行故障诊断。</li><li id="46b3" class="ln lo hx jo b jp lw js lx jv ly jz lz kd ma kh me lt lu lv bi translated">如果要调试故障条件，请参考<a class="ae ki" href="https://firebase.google.com/docs/reference/fcm/rest/v1/ErrorCode" rel="noopener ugc nofollow" target="_blank">中的<strong class="jo hy"> FCM错误代码。</strong> </a></li></ol><h1 id="30c6" class="kq kr hx bd ks kt ku kv kw kx ky kz la jd lb je lc jg ld jh le jj lf jk lg lh bi translated">结论</h1><p id="f741" class="pw-post-body-paragraph jm jn hx jo b jp li iy jr js lj jb ju jv lk jx jy jz ll kb kc kd lm kf kg kh hb bi translated">就这样结束了！现在，您已经知道如何使用Sendbird Chat为React本地应用程序发送推送通知。有了本教程和<a class="ae ki" href="https://sendbird.com/docs/chat/v3/android/quickstart/send-first-message" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy">文档</strong> </a>的指导，你马上就可以发送及时、相关、吸引人的推送通知了！</p><p id="67d0" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">我们总是在这里提供帮助；<a class="ae ki" href="https://sendbird.com/contact-us" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy">如果您有任何问题、意见或顾虑，请联系我们</strong> </a>。</p><p id="19e9" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">快乐推送通知大厦！💻</p></div></div>    
</body>
</html>