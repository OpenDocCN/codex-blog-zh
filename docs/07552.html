<html>
<head>
<title>Riverpod + StateNotifier + Freezed + DDD in Flutter — Fetching Data from the API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">river pod+state notifier+Freezed+Flutter中的DDD—从API获取数据</h1>
<blockquote>原文：<a href="https://medium.com/codex/riverpod-statenotifier-freezed-ddd-in-flutter-fetching-data-from-the-api-ba232c7d1144?source=collection_archive---------2-----------------------#2022-06-18">https://medium.com/codex/riverpod-statenotifier-freezed-ddd-in-flutter-fetching-data-from-the-api-ba232c7d1144?source=collection_archive---------2-----------------------#2022-06-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/698097c7823aa7021d0e6ee31a6ce6e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fLxNO4uHDaYtdhr_K-2F9w.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">极小的</figcaption></figure><p id="630f" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">你好，我的朋友们。在本文中，我将教你如何从API中获取一些数据(我将使用“rickandmortyapi ”,因为它很好)。</p><p id="6af3" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我强烈建议你阅读我的第一篇文章，在那里，我展示了Riverpod，所以你可能需要它。<a class="ae js" href="https://youtu.be/hc7zZTEqFyA" rel="noopener ugc nofollow" target="_blank"> <em class="jt">如果你读的时候不明白，那么你也可以查看我的YouTube频道</em>上的视频教程。</a>有好看的视频非常了解Riverpod。另外，你可以查看上面这篇文章的视频教程。现在，我们可以开始我们的主要话题了。</p></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><p id="5904" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">首先，对您的<strong class="iw hj">public spec . YAML</strong>文件实现必要的包:</p><figure class="kb kc kd ke fd ij"><div class="bz dy l di"><div class="kf kg l"/></div></figure><p id="e10d" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">添加包后，让我们移动代码部分…</p></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><h1 id="5e9a" class="kh ki hi bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">文件夹结构</h1><p id="eb62" class="pw-post-body-paragraph iu iv hi iw b ix lf iz ja jb lg jd je jf lh jh ji jj li jl jm jn lj jp jq jr hb bi translated">对于这个项目，我们将再次使用DDD建筑。我喜欢这个建筑，因为它很整洁。在这里，您可以看到文件夹结构:</p><figure class="kb kc kd ke fd ij er es paragraph-image"><div class="er es lk"><img src="../Images/6bbd4a1d46d62f35352e7f02ba2b626d.png" data-original-src="https://miro.medium.com/v2/resize:fit:928/format:webp/1*rKX16a6akwEryxUnvtfNNg.png"/></div></figure><blockquote class="ll lm ln"><p id="0580" class="iu iv jt iw b ix iy iz ja jb jc jd je lo jg jh ji lp jk jl jm lq jo jp jq jr hb bi translated">注意:我们现在有一个基础设施文件夹，在我的第一篇文章中没有基础设施文件夹，因为我们没有使用它。</p></blockquote><p id="2378" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">让我们从基础结构文件夹开始。</p><h1 id="d315" class="kh ki hi bd kj kk lr km kn ko ls kq kr ks lt ku kv kw lu ky kz la lv lc ld le bi translated">基础设施文件夹</h1><p id="a6ad" class="pw-post-body-paragraph iu iv hi iw b ix lf iz ja jb lg jd je jf lh jh ji jj li jl jm jn lj jp jq jr hb bi translated">在这个文件夹中，我们还有api_service文件夹。</p><figure class="kb kc kd ke fd ij"><div class="bz dy l di"><div class="kf kg l"/></div></figure><p id="2132" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这里我们只创建了ApiService类，以及一个从API获取数据的函数。这个文件的目的只是获取数据(我不使用toJson或fromJson，因为我使用“Dio”包。</p><p id="a008" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在基础设施文件夹之后，我们可以移动到我们的<strong class="iw hj"> Providers </strong>文件夹，我们将为ApiService类创建必要的提供者。</p><h1 id="c05b" class="kh ki hi bd kj kk lr km kn ko ls kq kr ks lt ku kv kw lu ky kz la lv lc ld le bi translated">提供商文件夹</h1><p id="886c" class="pw-post-body-paragraph iu iv hi iw b ix lf iz ja jb lg jd je jf lh jh ji jj li jl jm jn lj jp jq jr hb bi translated">首先，我需要在这里说，我将显示提供者只属于ApiService类。因此，对于这个标题，我将只显示<strong class="iw hj"> api_provider.dart </strong>文件和<strong class="iw hj">characters _ datas _ provider . dart</strong>文件。</p><figure class="kb kc kd ke fd ij"><div class="bz dy l di"><div class="kf kg l"/></div></figure><p id="5c95" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这是我们的<em class="jt"> api_provider.dart </em>文件。它只有一行代码。我们使用普通的提供者，因为我们只想得到ApiService类，仅此而已。</p><blockquote class="lw"><p id="2462" class="lx ly hi bd lz ma mb mc md me mf jr dx translated">只需将Provider用于上述简单的事情。</p></blockquote><figure class="mg mh mi mj mk ij"><div class="bz dy l di"><div class="kf kg l"/></div></figure><p id="c4a7" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">接下来，我们有了<em class="jt">characters _ datas _ provider . dart</em>文件。这里我们使用FutureProvider，因为我们想获取数据，它是异步代码。它的类型是字符模型列表。我们很快就会知道它是什么。它在<strong class="iw hj">域</strong>文件夹中。</p><p id="b397" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我们使用<em class="jt"> ref.read </em>而不是<em class="jt"> ref.watch </em>函数，因为它是未来函数，而不是流函数。我创建了一个空列表，因为在从API获取字符或数据后，我只是将数据添加到列表中的类型<strong class="iw hj"> CharacterModel </strong>。最后，添加完数据后，我只是返回我的列表，就这样。</p><blockquote class="lw"><p id="238e" class="lx ly hi bd lz ma mb mc md me mf jr dx translated">将FutureProvider用于未来流程。我还使用了autoDispose方法，因为我不想手动处理它。</p></blockquote><p id="7682" class="pw-post-body-paragraph iu iv hi iw b ix ml iz ja jb mm jd je jf mn jh ji jj mo jl jm jn mp jp jq jr hb bi translated">我在上面告诉过你，我们还有一个提供者，实际上是<strong class="iw hj"> search_provider.dart </strong>文件，我会在必要的时候解释它。</p></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><h1 id="3147" class="kh ki hi bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated"><strong class="ak">域文件夹</strong></h1><p id="f7da" class="pw-post-body-paragraph iu iv hi iw b ix lf iz ja jb lg jd je jf lh jh ji jj li jl jm jn lj jp jq jr hb bi translated">在启动应用程序文件夹之前，我们需要创建一个域文件夹。我确信你的代码会给出一些错误，比如没有CharcaterModel类等等。所以，让我们来解决它。此外，我们将在应用程序文件夹中使用它。</p><figure class="kb kc kd ke fd ij"><div class="bz dy l di"><div class="kf kg l"/></div></figure><p id="1e00" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">创建模型之后，让我们运行构建运行程序的代码。</p><blockquote class="ll lm ln"><p id="1cc8" class="iu iv jt iw b ix iy iz ja jb jc jd je lo jg jh ji lp jk jl jm lq jo jp jq jr hb bi translated">颤振包pub run build_runner watch —删除—冲突—输出</p></blockquote><p id="dc2a" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">运行这段代码后，它会为我们创建一个冻结的文件。</p><h1 id="a97d" class="kh ki hi bd kj kk lr km kn ko ls kq kr ks lt ku kv kw lu ky kz la lv lc ld le bi translated">应用程序文件夹</h1><p id="b2d7" class="pw-post-body-paragraph iu iv hi iw b ix lf iz ja jb lg jd je jf lh jh ji jj li jl jm jn lj jp jq jr hb bi translated">要开始创建业务逻辑，我们需要3样东西:状态、事件和状态通知程序。</p><p id="d214" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">让我们从创建一个国家开始。</p><figure class="kb kc kd ke fd ij"><div class="bz dy l di"><div class="kf kg l"/></div></figure><p id="0d94" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这里是我们的州。在创建了一个<em class="jt">事件</em>文件之后，我们将运行构建运行程序的代码，所以请耐心等待。</p><figure class="kb kc kd ke fd ij"><div class="bz dy l di"><div class="kf kg l"/></div></figure><p id="52b8" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这也是我们的事件文件。我们只有2个事件，当我们搜索某些东西时，我们需要它，当我们单击搜索按钮时，我们也需要另一个名为<em class="jt"> updateListItems </em>的事件。现在，运行下面的代码来创建<em class="jt">冻结的</em>文件。</p><blockquote class="ll lm ln"><p id="1678" class="iu iv jt iw b ix iy iz ja jb jc jd je lo jg jh ji lp jk jl jm lq jo jp jq jr hb bi translated">颤振包pub run build_runner watch —删除—冲突—输出</p></blockquote><p id="be57" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">所以对于应用程序文件夹的最后一件事，我们还需要创建我们的<em class="jt"> StateNotifier，</em>然后我们可以更新状态。</p><figure class="kb kc kd ke fd ij"><div class="bz dy l di"><div class="kf kg l"/></div></figure><p id="eda9" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">就这样了，伙计们。现在我们可以移动到最后一个文件夹，它位于演示文件夹中。我们还需要创建search_provider，以访问上述文件(搜索状态、事件、通知等。)</p><h2 id="fd58" class="mq ki hi bd kj mr ms mt kn mu mv mw kr jf mx my kv jj mz na kz jn nb nc ld nd bi translated">搜索提供商</h2><figure class="kb kc kd ke fd ij"><div class="bz dy l di"><div class="kf kg l"/></div></figure><p id="4f31" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在这里，我们再次将<em class="jt"> StateNotifierProvider </em>用于特定的状态。此外，我们使用手表而不是读数，因为我们的网速可能很慢，所以这意味着，当我们等待时，它可能是空的。此外，你可能意识到我不仅仅返回了<em class="jt"> SearchNotifier </em>，我还返回了<em class="jt"> SearchNotifier </em>的具体函数及其事件。</p><p id="2eab" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">当我调用<em class="jt"> searchProvider </em>时，我想获取数据。所以，我们来举个例子:</p><p id="a898" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">想象你关闭了应用程序。第一次打开后，你会去取。另一个例子是:假设你的应用程序中有3页。第一页是主页，就像我的Rick和Morty应用程序一样。其他的例如与用户的简档相关。因此，您将转到个人资料页面。之后，你想回到主页。现在，您可能想要更新来自API的数据。所以，在设置好一切之后，我们也可以使用两个点来创建我们的StateNotifier，然后调用一个特定的函数。</p><h1 id="9b2d" class="kh ki hi bd kj kk lr km kn ko ls kq kr ks lt ku kv kw lu ky kz la lv lc ld le bi translated">演示文件夹</h1><p id="1911" class="pw-post-body-paragraph iu iv hi iw b ix lf iz ja jb lg jd je jf lh jh ji jj li jl jm jn lj jp jq jr hb bi translated">实际上，这里我只想处理Consumer、ConsumerWidget和ProviderScope小部件，因为本教程的目的不是小部件。它与Riverpod有关。所以，我们开始编码吧。</p><h2 id="30a9" class="mq ki hi bd kj mr ms mt kn mu mv mw kr jf mx my kv jj mz na kz jn nb nc ld nd bi translated">main.dart文件</h2><figure class="kb kc kd ke fd ij"><div class="bz dy l di"><div class="kf kg l"/></div></figure><blockquote class="lw"><p id="be3c" class="lx ly hi bd lz ma ne nf ng nh ni jr dx translated">如果您使用Riverpod，那么您必须用ProviderScope包装所有的小部件。不要忘记。</p></blockquote><h2 id="e639" class="mq ki hi bd kj mr nj mt kn mu nk mw kr jf nl my kv jj nm na kz jn nn nc ld nd bi translated">搜索_bar.dart文件</h2><p id="0c33" class="pw-post-body-paragraph iu iv hi iw b ix lf iz ja jb lg jd je jf lh jh ji jj li jl jm jn lj jp jq jr hb bi translated">这里你可能意识到我们没有使用ConsumerWidget。我们只是用消费者。两个都可以用。</p><p id="5d50" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这是我们的搜索栏小部件的<em class="jt">消费者部分。</em></p><figure class="kb kc kd ke fd ij"><div class="bz dy l di"><div class="kf kg l"/></div></figure><p id="adc2" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">此外，您可以使用ref.refresh(PROVIDER)方法来刷新状态。我在教程视频中解释了更多的细节。</p><h2 id="0d54" class="mq ki hi bd kj mr ms mt kn mu mv mw kr jf mx my kv jj mz na kz jn nb nc ld nd bi translated">瑞克_和_莫蒂_物品.镖文件</h2><figure class="kb kc kd ke fd ij"><div class="bz dy l di"><div class="kf kg l"/></div></figure><p id="1b7d" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在这个文件中，我们用<em class="jt"> ConsumerWidget </em>扩展了我们的类。我们没有使用<em class="jt"> StatelessWidget </em>，因为我们想在构建之上观察我们的状态。上面我说了，<strong class="iw hj">可以为null </strong>，那么当它为null的时候，那么我们展示具体的文字:<em class="jt">“没有任何字符”</em>比如。</p></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><figure class="kb kc kd ke fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es no"><img src="../Images/2dea41d0a0c5745341d8b8da8e9d7bf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6qqhcU_ZkhZe0K6dJcN5dg.jpeg"/></div></div></figure><p id="b080" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这就是我的全部。欢迎在评论区提问。此外，你可以从<a class="ae js" href="https://github.com/alperefesahin?tab=repositories" rel="noopener ugc nofollow" target="_blank">这里</a>浏览我用Riverpod创建的应用程序。我强烈建议从<a class="ae js" href="https://youtu.be/hc7zZTEqFyA" rel="noopener ugc nofollow" target="_blank">这里</a>看这个教程的视频。</p><p id="beaf" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">感谢您的阅读，敬请关注！</p></div></div>    
</body>
</html>