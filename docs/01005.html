<html>
<head>
<title>Configure HAProxy and dynamically update the Configuration file using Ansible</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Ansible配置HAProxy并动态更新配置文件</h1>
<blockquote>原文：<a href="https://medium.com/codex/configure-haproxy-and-dynamically-update-the-configuration-file-using-ansible-2d32c3dfba13?source=collection_archive---------8-----------------------#2021-03-30">https://medium.com/codex/configure-haproxy-and-dynamically-update-the-configuration-file-using-ansible-2d32c3dfba13?source=collection_archive---------8-----------------------#2021-03-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="e417" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">HAProxy是一个负载平衡器，它通过以循环方式将负载分布在复制的服务器上来平衡服务器上的负载。</p><p id="147a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">本文演示了如何设置haproxy，并在复制服务器的IP加入到<em class="jd"> webserver </em>列表时动态添加它们。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/c1cbb01986daf9c12cbc4ff4f514409f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u-LFUTR520wNmD_E8ZtZeQ.png"/></div></div></figure><p id="c358" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">这个演示包括什么？</strong></p><p id="b31e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 1。</strong>在一列主机上安装httpd、PHP等软件，配置web服务器</p><p id="bd88" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 2。</strong>在服务器的文档根目录中复制一个简单的PHP脚本</p><p id="692f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 3。</strong>启动web服务</p><p id="7ca8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 4。</strong>安装haproxy软件</p><p id="6c50" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 5。</strong>更新配置文件以添加后端服务器(我们配置为web服务器的服务器)</p><p id="3b65" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 6。</strong>如果需要，重新启动服务</p><p id="d29b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">主机文件最初看起来像这样:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es jq"><img src="../Images/9b8bdef9080e30a50e12f217cbc4f4e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:648/format:webp/1*pxw-xb2Cu_qOkZ8p63j8lA.png"/></div></figure><p id="b290" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这意味着我们在两台主机上配置web服务器，它们的IP地址分别是192.168.0.107和192.168.0.108。</p><p id="f7c5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Haproxy负载平衡器配置在本地主机的端口号5000上。</p><p id="e189" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">步骤1:安装httpd和PHP软件</p><p id="de38" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为此，我们将使用如下所示的包模块，</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="jr js l"/></div></figure><p id="60c7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">步骤2:将PHP脚本复制到文档根目录</p><p id="0080" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">步骤3:启动web服务并配置防火墙</p><p id="a8f8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用copy模块，可以将一个运行ifconfig命令并显示输出的简单PHP脚本复制到Web服务器的文档根目录中。</p><p id="8efd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">随后，服务被启动，防火墙被配置为允许端口80上的请求。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="jr js l"/></div></figure><p id="0ee9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">步骤4:安装haproxy软件</p><p id="f143" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因为，我们希望在本地主机上配置负载平衡器，这不同于我们配置web服务器的主机；Haproxy的这种配置是在不同的剧本中完成的，但在同一剧本中。HAProxy监听端口5000，并以循环方式将请求转发到后端web服务器。这意味着，负载平衡器是公开的。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="jr js l"/></div></figure><p id="ba0d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">步骤5:编辑Haproxy配置文件，并将该文件更新/复制到配置为负载平衡器的主机上</p><p id="c0f3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">步骤6:重新启动haproxy服务</p><p id="1c46" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，随着时间的推移，我们可能需要添加更多的web服务器副本。因此，为了动态地更新HAProxy的配置以在新的一组服务器之间实现负载平衡，我们使用模板模块来复制更新后的配置文件。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="jr js l"/></div></figure><p id="979f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这就是我们更新配置文件的方式——循环遍历<em class="jd"> webservers </em>主机组，并将服务器添加到配置文件中。</p><p id="076b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，每当清单中出现新服务器时，都会运行行动手册，并且负载平衡器配置会动态更新。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es jt"><img src="../Images/c27171b9ba6e5c99a5af6a8ddb20b566.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f16Z8D611m9g82ELN0bQaQ.png"/></div></div></figure><p id="c86b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我希望这篇文章能帮助你学到一些新东西。</p></div></div>    
</body>
</html>