<html>
<head>
<title>💪Deploy Jenkins server on Azure using Infrastructure-As-Code (Bicep)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">💪使用基础设施即代码(Bicep)在Azure上部署Jenkins服务器</h1>
<blockquote>原文：<a href="https://medium.com/codex/deploy-jenkins-server-on-azure-using-infrastructure-as-code-bicep-d7781f90d957?source=collection_archive---------5-----------------------#2021-11-04">https://medium.com/codex/deploy-jenkins-server-on-azure-using-infrastructure-as-code-bicep-d7781f90d957?source=collection_archive---------5-----------------------#2021-11-04</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="9cf1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">了解如何使用Azure Bicep部署Jenkins服务器。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/a84eddfc0beb105ef6a567ae62d353c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V6NX0wL8zPUdkJSW9sXnig.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">使用基础设施即代码在Azure上部署Jenkins服务器。</figcaption></figure></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><p id="b6b1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">本文将展示如何通过Azure Bicep使用基础设施即代码来部署Jenkins，Azure Bicep是一种用于以声明方式部署Azure资源的领域特定语言(DSL)。</p><p id="622c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Jenkins是一个开源的自动化服务器，可以帮助您跨多个平台自动构建、测试和部署任何项目。</p><p id="d5e0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Jenkins有助于避免破坏性的更改，以便您可以节省时间并确保交付高质量的软件。它的web界面提供了一种在将应用程序投入生产之前管理和测试应用程序的简单方法。</p><p id="17fc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个Bicep模板包含了社区推荐的插件的最新版本，包括管道和Git集成。</p><h1 id="8583" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">先决条件</h1><p id="5037" class="pw-post-body-paragraph if ig hi ih b ii ky ik il im kz io ip iq la is it iu lb iw ix iy lc ja jb jc hb bi translated">要部署该解决方案，您需要以下各项:</p><ul class=""><li id="62b1" class="ld le hi ih b ii ij im in iq lf iu lg iy lh jc li lj lk ll bi translated">一个活跃的Azure账户:你可以<a class="ae lm" href="https://azure.microsoft.com/free/" rel="noopener ugc nofollow" target="_blank">免费</a>创建一个账户。</li><li id="ed6c" class="ld le hi ih b ii ln im lo iq lp iu lq iy lr jc li lj lk ll bi translated"><a class="ae lm" href="https://github.com/azure/bicep" rel="noopener ugc nofollow" target="_blank"> Azure二头肌</a>安装在你的本地机器上。</li><li id="ab8e" class="ld le hi ih b ii ln im lo iq lp iu lq iy lr jc li lj lk ll bi translated">Azure PowerShell。参见:<a class="ae lm" href="https://docs.microsoft.com/en-us/powershell/azure/install-az-ps" rel="noopener ugc nofollow" target="_blank">安装Azure PowerShell </a>。</li><li id="b45a" class="ld le hi ih b ii ln im lo iq lp iu lq iy lr jc li lj lk ll bi translated">Azure订阅中的资源组</li></ul><p id="a2fd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们开始吧！</p><ul class=""><li id="3819" class="ld le hi ih b ii ij im in iq lf iu lg iy lh jc li lj lk ll bi translated">注意:在部署此解决方案之前，我们必须接受虚拟机映像的法律条款。要阅读并接受法律条款，您可以使用PowerShell通过下面的cmdlet接受条款和条件:</li></ul><pre class="je jf jg jh fd ls lt lu lv aw lw bi"><span id="cc77" class="lx kb hi lt b fi ly lz l ma mb">Get-AzMarketplaceTerms `<br/>-Publisher 'bitnami' `<br/>-Product 'jenkins' `<br/>-Name '1-650' |<br/>Set-AzMarketplaceTerms -Accept</span></pre><h1 id="827a" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">解决方案概述</h1><p id="50bf" class="pw-post-body-paragraph if ig hi ih b ii ky ik il im kz io ip iq la is it iu lb iw ix iy lc ja jb jc hb bi translated">我们将创作一个创建Jenkin服务器的Bicep模板。</p><p id="af76" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该解决方案将包括以下文件:</p><ul class=""><li id="4e27" class="ld le hi ih b ii ij im in iq lf iu lg iy lh jc li lj lk ll bi translated"><strong class="ih hj"> <em class="mc"> main.bicep </em> </strong>:这是二头肌模板</li><li id="0b3d" class="ld le hi ih b ii ln im lo iq lp iu lq iy lr jc li lj lk ll bi translated"><strong class="ih hj"><em class="mc">azure deploy . parameters . JSON</em></strong>:该参数文件包含用于部署Bicep模板的值。</li></ul><p id="4613" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该模板提供安装所需的存储帐户、虚拟网络、可用性集、公共IP地址和网络接口。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es md"><img src="../Images/80940f73c80dd3cc50732044a48acc75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Tu4REZtx7Qtf8RQyOQxdAg.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">詹金斯部署</figcaption></figure><p id="8db9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在让我们开始制作二头肌模板。</p><h1 id="3754" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">1.Azure二头肌模板-参数</h1><p id="3b13" class="pw-post-body-paragraph if ig hi ih b ii ky ik il im kz io ip iq la is it iu lb iw ix iy lc ja jb jc hb bi translated">在您的工作目录中创建一个新文件，并将其命名为'<em class="mc"> main.bicep </em>'。我们将定义以下参数:</p><pre class="je jf jg jh fd ls lt lu lv aw lw bi"><span id="8fd8" class="lx kb hi lt b fi ly lz l ma mb">param location string<br/>param networkInterfaceName string<br/>param networkSecurityGroupName string<br/>param networkSecurityGroupRules array<br/>param subnetName string<br/>param virtualNetworkName string<br/>param addressPrefixes array<br/>param subnets array<br/>param publicIpAddressName string<br/>param publicIpAddressType string<br/>param publicIpAddressSku string<br/>param virtualMachineName string<br/>param virtualMachineComputerName string<br/>param osDiskType string<br/>param virtualMachineSize string<br/>param adminUsername string</span><span id="f5d0" class="lx kb hi lt b fi me lz l ma mb"><a class="ae lm" href="http://twitter.com/secure" rel="noopener ugc nofollow" target="_blank">@secure</a>()<br/>param adminPassword string</span></pre><h1 id="c3a6" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">2.Azure二头肌模板-变量</h1><p id="5253" class="pw-post-body-paragraph if ig hi ih b ii ky ik il im kz io ip iq la is it iu lb iw ix iy lc ja jb jc hb bi translated">我们将定义以下变量:</p><pre class="je jf jg jh fd ls lt lu lv aw lw bi"><span id="e1c2" class="lx kb hi lt b fi ly lz l ma mb">var nsgId = resourceId(resourceGroup().name, 'Microsoft.Network/networkSecurityGroups', networkSecurityGroupName)<br/>var vnetId = resourceId(resourceGroup().name, 'Microsoft.Network/virtualNetworks', virtualNetworkName)<br/>var subnetRef = '${vnetId}/subnets/${subnetName}'</span></pre><h1 id="84b2" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">3.Azure二头肌模板—资源</h1><p id="ccc9" class="pw-post-body-paragraph if ig hi ih b ii ky ik il im kz io ip iq la is it iu lb iw ix iy lc ja jb jc hb bi translated">我们将定义以下资源:</p><pre class="je jf jg jh fd ls lt lu lv aw lw bi"><span id="fe61" class="lx kb hi lt b fi ly lz l ma mb">resource networkInterfaceName_resource 'Microsoft.Network/networkInterfaces@2021-03-01' = {<br/>  name: networkInterfaceName<br/>  location: location<br/>  properties: {<br/>    ipConfigurations: [<br/>      {<br/>        name: 'ipconfig1'<br/>        properties: {<br/>          subnet: {<br/>            id: subnetRef<br/>          }<br/>          privateIPAllocationMethod: 'Dynamic'<br/>          publicIPAddress: {<br/>            id: pip.id<br/>          }<br/>        }<br/>      }<br/>    ]<br/>    networkSecurityGroup: {<br/>      id: nsgId<br/>    }<br/>  }<br/>  dependsOn: [<br/>    networkSecurityGroupName_resource<br/>    virtualNetworkName_resource<br/>    pip<br/>  ]<br/>}</span><span id="5998" class="lx kb hi lt b fi me lz l ma mb">resource networkSecurityGroupName_resource 'Microsoft.Network/networkSecurityGroups@2019-02-01' = {<br/>  name: networkSecurityGroupName<br/>  location: location<br/>  properties: {<br/>    securityRules: networkSecurityGroupRules<br/>  }<br/>}</span><span id="7069" class="lx kb hi lt b fi me lz l ma mb">resource virtualNetworkName_resource 'Microsoft.Network/virtualNetworks@2020-11-01' = {<br/>  name: virtualNetworkName<br/>  location: location<br/>  properties: {<br/>    addressSpace: {<br/>      addressPrefixes: addressPrefixes<br/>    }<br/>    subnets: subnets<br/>  }<br/>}</span><span id="9768" class="lx kb hi lt b fi me lz l ma mb">resource pip 'Microsoft.Network/publicIpAddresses@2019-02-01' = {<br/>  name: publicIpAddressName<br/>  location: location<br/>  properties: {<br/>    publicIPAllocationMethod: publicIpAddressType<br/>  }<br/>  sku: {<br/>    name: publicIpAddressSku<br/>  }<br/>}</span><span id="8e64" class="lx kb hi lt b fi me lz l ma mb">resource virtualMachineName_resource 'Microsoft.Compute/virtualMachines@2021-03-01' = {<br/>  name: virtualMachineName<br/>  location: location<br/>  properties: {<br/>    hardwareProfile: {<br/>      vmSize: virtualMachineSize<br/>    }<br/>    storageProfile: {<br/>      osDisk: {<br/>        createOption: 'FromImage'<br/>        managedDisk: {<br/>          storageAccountType: osDiskType<br/>        }<br/>      }<br/>      imageReference: {<br/>        publisher: 'bitnami'<br/>        offer: 'jenkins'<br/>        sku: '1-650'<br/>        version: 'latest'<br/>      }<br/>    }<br/>    networkProfile: {<br/>      networkInterfaces: [<br/>        {<br/>          id: networkInterfaceName_resource.id<br/>        }<br/>      ]<br/>    }<br/>    osProfile: {<br/>      computerName: virtualMachineComputerName<br/>      adminUsername: adminUsername<br/>      adminPassword: adminPassword<br/>      linuxConfiguration: {<br/>        patchSettings: {<br/>          patchMode: 'ImageDefault'<br/>        }<br/>      }<br/>    }<br/>    diagnosticsProfile: {<br/>      bootDiagnostics: {<br/>        enabled: true<br/>      }<br/>    }<br/>  }<br/>  plan: {<br/>    name: '1-650'<br/>    publisher: 'bitnami'<br/>    product: 'jenkins'<br/>  }<br/>}</span></pre><h1 id="32ec" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">4.参数文件</h1><p id="ddb7" class="pw-post-body-paragraph if ig hi ih b ii ky ik il im kz io ip iq la is it iu lb iw ix iy lc ja jb jc hb bi translated">创建一个名为“<em class="mc">azure deploy . parameters . JSON</em>”的新文件。下面的代码显示了参数文件的定义:</p><pre class="je jf jg jh fd ls lt lu lv aw lw bi"><span id="6535" class="lx kb hi lt b fi ly lz l ma mb">{<br/>    "$schema": "<a class="ae lm" href="https://schema.management.azure.com/schemas/2015-01-01/deploymentParameters.json#" rel="noopener ugc nofollow" target="_blank">https://schema.management.azure.com/schemas/2015-01-01/deploymentParameters.json#</a>",<br/>    "contentVersion": "1.0.0.0",<br/>    "parameters": {<br/>        "location": {<br/>            "value": "eastus"<br/>        },<br/>        "networkInterfaceName": {<br/>            "value": "jenkinsvm109"<br/>        },<br/>        "networkSecurityGroupName": {<br/>            "value": "jenkinsvm-nsg"<br/>        },<br/>        "networkSecurityGroupRules": {<br/>            "value": [<br/>                {<br/>                    "name": "HTTP",<br/>                    "properties": {<br/>                        "priority": 1010,<br/>                        "protocol": "TCP",<br/>                        "access": "Allow",<br/>                        "direction": "Inbound",<br/>                        "sourceApplicationSecurityGroups": [],<br/>                        "destinationApplicationSecurityGroups": [],<br/>                        "sourceAddressPrefix": "*",<br/>                        "sourcePortRange": "*",<br/>                        "destinationAddressPrefix": "*",<br/>                        "destinationPortRange": "80"<br/>                    }<br/>                },<br/>                {<br/>                    "name": "HTTPS",<br/>                    "properties": {<br/>                        "priority": 1020,<br/>                        "protocol": "TCP",<br/>                        "access": "Allow",<br/>                        "direction": "Inbound",<br/>                        "sourceApplicationSecurityGroups": [],<br/>                        "destinationApplicationSecurityGroups": [],<br/>                        "sourceAddressPrefix": "*",<br/>                        "sourcePortRange": "*",<br/>                        "destinationAddressPrefix": "*",<br/>                        "destinationPortRange": "443"<br/>                    }<br/>                },<br/>                {<br/>                    "name": "SSH",<br/>                    "properties": {<br/>                        "priority": 1030,<br/>                        "protocol": "TCP",<br/>                        "access": "Allow",<br/>                        "direction": "Inbound",<br/>                        "sourceApplicationSecurityGroups": [],<br/>                        "destinationApplicationSecurityGroups": [],<br/>                        "sourceAddressPrefix": "*",<br/>                        "sourcePortRange": "*",<br/>                        "destinationAddressPrefix": "*",<br/>                        "destinationPortRange": "22"<br/>                    }<br/>                }<br/>            ]<br/>        },<br/>        "subnetName": {<br/>            "value": "default"<br/>        },<br/>        "virtualNetworkName": {<br/>            "value": "YOUR-VNET-NAME"<br/>        },<br/>        "addressPrefixes": {<br/>            "value": [<br/>                "10.0.0.0/16"<br/>            ]<br/>        },<br/>        "subnets": {<br/>            "value": [<br/>                {<br/>                    "name": "default",<br/>                    "properties": {<br/>                        "addressPrefix": "10.0.0.0/24"<br/>                    }<br/>                }<br/>            ]<br/>        },<br/>        "publicIpAddressName": {<br/>            "value": "PUBLIC-IP-NAME"<br/>        },<br/>        "publicIpAddressType": {<br/>            "value": "Dynamic"<br/>        },<br/>        "publicIpAddressSku": {<br/>            "value": "Basic"<br/>        },<br/>        "virtualMachineName": {<br/>            "value": "VM-NAME"<br/>        },<br/>        "virtualMachineComputerName": {<br/>            "value": "YOUR-VM-COMPUTER-NAME"<br/>        },<br/>        "osDiskType": {<br/>            "value": "Premium_LRS"<br/>        },<br/>        "virtualMachineSize": {<br/>            "value": "Standard_D2as_v4"<br/>        },<br/>        "adminUsername": {<br/>            "value": "YOUR-ADMIN-USERNAME"<br/>        },<br/>        "adminPassword": {<br/>            "value": "YOUR-PASSWORD"<br/>        }<br/>    }<br/>}</span></pre><h1 id="dcf7" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">5.Azure Bicep模板-部署</h1><p id="fb92" class="pw-post-body-paragraph if ig hi ih b ii ky ik il im kz io ip iq la is it iu lb iw ix iy lc ja jb jc hb bi translated">我们将使用下面的命令来部署我们的二头肌模板:</p><pre class="je jf jg jh fd ls lt lu lv aw lw bi"><span id="4095" class="lx kb hi lt b fi ly lz l ma mb">$date = Get-Date -Format "MM-dd-yyyy"<br/>$deploymentName = "AzInsiderDeployment"+"$date"</span><span id="0757" class="lx kb hi lt b fi me lz l ma mb">New-AzResourceGroupDeployment -Name $deploymentName -ResourceGroupName azinsider_demo -TemplateFile .\main.bicep -TemplateParameterFile .\azuredeploy.parameters.json -c</span></pre><p id="94e8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下图显示了部署的预览:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mf"><img src="../Images/2595e36b8e8621912fd556f092b8c09f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5uUIy2B_dFFjLYib-Jr2nw.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">部署预览</figcaption></figure><p id="c3a4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后我们将执行部署。下图显示了部署输出:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mg"><img src="../Images/0fafb9154df40c4b01dbde63017373be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mdbcPLePdwaIoAXkv6LfNg.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">部署输出</figcaption></figure><p id="ebe9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在让我们验证一下詹金斯的状态。您可以使用虚拟机的公共IP地址，并通过使用端口443的浏览器访问Jenkins:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mh"><img src="../Images/4b089d6c21c21d6abce2f5ef554c3004.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3GUeEcEHul7Aa1eYxvMn_g.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">詹金斯</figcaption></figure><p id="4aed" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此解决方案的完整代码可在此处找到:</p><div class="mi mj ez fb mk ml"><a href="https://github.com/daveRendon/azinsider/tree/main/application-workloads/jenkins-server" rel="noopener  ugc nofollow" target="_blank"><div class="mm ab dw"><div class="mn ab mo cl cj mp"><h2 class="bd hj fi z dy mq ea eb mr ed ef hh bi translated">azin sider/应用程序-工作负载/Jenkins-位于主daveRendon/azinsider的服务器</h2><div class="ms l"><h3 class="bd b fi z dy mq ea eb mr ed ef dx translated">在GitHub上创建一个帐户，为daveRendon/azinsider开发做出贡献。</h3></div><div class="mt l"><p class="bd b fp z dy mq ea eb mr ed ef dx translated">github.com</p></div></div><div class="mu l"><div class="mv l mw mx my mu mz jn ml"/></div></div></a></div><p id="3548" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">👉<a class="ae lm" href="http://eepurl.com/gKmLdf" rel="noopener ugc nofollow" target="_blank"> <em class="mc">在此加入</em><strong class="ih hj"><em class="mc">azin sider</em></strong><em class="mc">邮箱列表。</em>T9】</a></p><p id="c8b0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="mc">-戴夫·r·</em></p></div></div>    
</body>
</html>