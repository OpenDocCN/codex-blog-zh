<html>
<head>
<title>Let’s Demystify That 20-Digit Utility Token-Part 4</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">让我们揭开20位实用令牌的神秘面纱——第4部分</h1>
<blockquote>原文：<a href="https://medium.com/codex/lets-demystify-that-20-digit-utility-token-part-4-9143c1c0792c?source=collection_archive---------5-----------------------#2022-07-02">https://medium.com/codex/lets-demystify-that-20-digit-utility-token-part-4-9143c1c0792c?source=collection_archive---------5-----------------------#2022-07-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="91d4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我记得我承诺过涵盖加密算法11 (EA 11)和解码器密钥生成算法4 (DKGA04)。没有比现在更好的时机了。我深信是前三篇文章把你带到了这里。如果没有，不用担心。点击链接可以进入<a class="ae jd" href="https://mwangi-patrick.medium.com/lets-demystify-that-20-digit-utility-token-part-1-74c85eebbac4" rel="noopener"> Part1 </a>、<a class="ae jd" rel="noopener" href="/codex/lets-demystify-that-20-digit-utility-token-part-2-64ca45f4b88b"> Part2 </a>和<a class="ae jd" rel="noopener" href="/codex/lets-demystify-that-20-digit-utility-token-part-3-d05002dbdf71"> Part3 </a>。</p><p id="bc7e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你还记得的话，我们在之前的帖子里讨论过DKGA02和EA07。两组密钥生成和加密算法的主要区别在于密钥大小以及所使用的加密算法。</p><p id="06d2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于DKGA02，密钥大小只有64位，而DKGA04的密钥大小是可变的。您可以使用DKGA04生成64位和128位解码器密钥。EA07使用自定义的DES加密算法。另一方面，EA11使用<a class="ae jd" href="https://en.wikipedia.org/wiki/MISTY1" rel="noopener ugc nofollow" target="_blank"> MISTY1 </a>加密算法。在本帖中，我们将介绍使用算法版本4的解码器密钥生成技术，使用Misty1加密和解密令牌有效载荷。我希望你能像我一样兴奋地投入进去。</p><h2 id="f090" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">解码器密钥生成</h2><p id="f3e2" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">假设使用算法版本4生成的解码器密钥是128位，用于EA11，很明显它包含更多的信息。然而，与DKGA02相比，该算法非常简单，因为它涉及计算HMAC-SHA256哈希，然后选择最左边的<strong class="ih hj"> n </strong>位。看看下面的图表。</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div class="er es ke"><img src="../Images/e232d02ea0fdd8450f372474cb3e97ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:802/format:webp/1*YeR6v5cUuGp9q65GOz6zOA.png"/></div><figcaption class="km kn et er es ko kp bd b be z dx translated">图1。DKGA04流量</figcaption></figure><p id="a3b5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">49字节的数据块以十六进制格式构建，由以下数据元素组成。</p><pre class="kf kg kh ki fd kq kr ks kt aw ku bi"><span id="8997" class="je jf hi kr b fi kv kw l kx ky">+=====================+==================+=======+<br/>|        <strong class="kr hj">Field</strong>        |      <strong class="kr hj">Value</strong>       | <strong class="kr hj">Bytes</strong> |<br/>+=====================+==================+=======+<br/>| Separator           | 0402(hex)        |     2 |<br/>+---------------------+------------------+-------+<br/>| DKGA                | 2 ASCII digits   |     2 |<br/>+---------------------+------------------+-------+<br/>| Separator           | 02 (hex)         |     1 |<br/>+---------------------+------------------+-------+<br/>| BaseDate            | 2 ASCII digits   |     2 |<br/>+---------------------+------------------+-------+<br/>| Separator           | 02 (hex)         |     1 |<br/>+---------------------+------------------+-------+<br/>| EA                  | 2 ASCII digits   |     2 |<br/>+---------------------+------------------+-------+<br/>| Separator           | 02 (hex)         |     1 |<br/>+---------------------+------------------+-------+<br/>| Tariff Index        | 2 ASCII digits   |     2 |<br/>+---------------------+------------------+-------+<br/>| Separator           | 000406 (hex)     |     3 |<br/>+---------------------+------------------+-------+<br/>| Supply Group Code   | 6 ASCII digits   |     6 |<br/>+---------------------+------------------+-------+<br/>| Separator           | 01 (hex)         |     1 |<br/>+---------------------+------------------+-------+<br/>| Key Type            | 1 ASCII digit    |     1 |<br/>+---------------------+------------------+-------+<br/>| Separator           | 01 (hex)         |     1 |<br/>+---------------------+------------------+-------+<br/>| Key Revision Number | 1 ASCII digit    |     1 |<br/>+---------------------+------------------+-------+<br/>| Separator           | 12 (hex)         |     1 |<br/>+---------------------+------------------+-------+<br/>| Meter PAN           | 18 ASCII digits  |    18 |<br/>+---------------------+------------------+-------+<br/>| Decoder Key Length  | 32-bit Integer   |     4 |<br/>+---------------------+------------------+-------+<br/>| -                   | <strong class="kr hj">Total</strong>            |    <strong class="kr hj">49</strong> |<br/>+---------------------+------------------+-------+</span></pre><p id="f241" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个场景中的仪表台是一个有趣的点。在DKGA02中，PAN的最大长度为16位。18位仪表面板中的2个额外数字在最左端容纳一个额外的IIN(发行人识别号)数字，在另一端容纳一个校验位。</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es kz"><img src="../Images/8c5328c91c1fe76cf617fe8f5f7ef5e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mkU2t3ZpomZKqQ22xR5VRg.png"/></div></div><figcaption class="km kn et er es ko kp bd b be z dx translated">图二。仪表盘(主账号)</figcaption></figure><p id="01ca" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在上图中，I表示IIN数字所占据的位置。I/D表示IIN或解码器注册号(DRN)数字可能占用的空间，具体取决于DRN的长度。c是通过使用IIN和DRN数字作为输入，使用<a class="ae jd" href="https://www.geeksforgeeks.org/luhn-algorithm/" rel="noopener ugc nofollow" target="_blank"> Luhn </a>算法计算的校验位。使用我们的例子DRN 56728389216，电度表将是<strong class="ih hj"> 600727567283892161 </strong>。您可以使用<a class="ae jd" href="https://simplycalc.com/luhn-calculate.php" rel="noopener ugc nofollow" target="_blank"> SimplyCalc </a>等在线工具确认校验位的有效性。</p><h2 id="1867" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">代码示例</h2><p id="5ff4" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">出售密钥生成。</p><figure class="kf kg kh ki fd kj"><div class="bz dy l di"><div class="le lf l"/></div></figure><p id="cfb5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">解码器密钥生成</p><figure class="kf kg kh ki fd kj"><div class="bz dy l di"><div class="le lf l"/></div></figure><p id="404a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">运行上面的代码将产生类似下图的输出</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es lg"><img src="../Images/58720682ed45eb61c062f0b9aad8718c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n4n_qkEuBxl3MKYnoEdEFA.png"/></div></div><figcaption class="km kn et er es ko kp bd b be z dx translated">图3。DKGA04程序输出</figcaption></figure><h2 id="560d" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">令牌加密和解密</h2><p id="42a9" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">加密算法11使用MISTY1，它是一种对称分组密码。该算法接收64位输入，并使用128位密钥进行加密和解密。MISTY1是一种获得专利的分组密码，但可以免费用于教育目的。EA07和EA11的令牌块准备是相似的，因为两种算法都需要64位输入。附上与本系列第2部分类似的图表以供参考。</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div class="er es lh"><img src="../Images/4695ff06feb711f130272eec2619fbbf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*QHUkLwR7XFevJasY.png"/></div><figcaption class="km kn et er es ko kp bd b be z dx translated">图4。令牌块准备</figcaption></figure><h2 id="c2a1" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">代码示例</h2><p id="5ea7" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">下面的类扩展了本系列第三部分中演示的<a class="ae jd" href="https://gist.github.com/CodeLover254/8c41fbb1b645a42641f2bb47cba5cc68" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> TokenEncryptor </strong> </a>类，并利用Misty1加密令牌块。</p><figure class="kf kg kh ki fd kj"><div class="bz dy l di"><div class="le lf l"/></div></figure><p id="8689" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Misty1实现最初是从<a class="ae jd" href="https://github.com/besom/bbossgroups-mvn" rel="noopener ugc nofollow" target="_blank">besom/bbossgroups-mvn</a>Github存储库中获得的，并根据演示的需要进行了修改。你可以在这里访问实现<a class="ae jd" href="https://gist.github.com/CodeLover254/b6a1ce5296dbd23178804d5122910bbf" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="3749" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面的类扩展了<a class="ae jd" href="https://gist.github.com/CodeLover254/629b99b8bdee39cd5b06ee6679d3dccc" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> TokenMeter </strong> </a>类，并演示了使用Misty1块密码对令牌块进行解密。</p><figure class="kf kg kh ki fd kj"><div class="bz dy l di"><div class="le lf l"/></div></figure><p id="b447" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要运行加密和解密示例，请随意单击下面的嵌入链接。</p><div class="li lj ez fb lk ll"><a href="https://replit.com/@AplusProgrammer/StandardTransferSpecification-DKGA04-and-EA11" rel="noopener  ugc nofollow" target="_blank"><div class="lm ab dw"><div class="ln ab lo cl cj lp"><h2 class="bd hj fi z dy lq ea eb lr ed ef hh bi translated">标准转换规范-DKGA04和EA11</h2><div class="ls l"><h3 class="bd b fi z dy lq ea eb lr ed ef dx translated">演示STS加密算法11</h3></div><div class="lt l"><p class="bd b fp z dy lq ea eb lr ed ef dx translated">replit.com</p></div></div><div class="lu l"><div class="lv l lw lx ly lu lz kk ll"/></div></div></a></div><p id="98b8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您应该会得到类似下图的输出。</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es ma"><img src="../Images/5ddf4685024f4b18431b1264c185f4df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EkFlEmctcYjDwZS8F1980w.png"/></div></div><figcaption class="km kn et er es ko kp bd b be z dx translated">图5。程序输出</figcaption></figure><h2 id="9c1d" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">结论</h2><p id="e355" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">这篇文章是专门针对DKGA04和EA11的，是对前三篇文章的补充。它标志着标准传输规范系列的最后一章。期待将来有更多的帖子涉及其他有趣的领域。感谢您的阅读，祝您愉快！</p></div></div>    
</body>
</html>