<html>
<head>
<title>Testing Phoenix and Elixir: Centralize Data Creation in the Factory.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">测试Phoenix和Elixir:在工厂中集中创建数据。</h1>
<blockquote>原文：<a href="https://medium.com/codex/testing-phoenix-and-elixir-centralize-data-creation-in-the-factory-8c6d4faa996d?source=collection_archive---------7-----------------------#2021-08-06">https://medium.com/codex/testing-phoenix-and-elixir-centralize-data-creation-in-the-factory-8c6d4faa996d?source=collection_archive---------7-----------------------#2021-08-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="9602" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">举例说明如何在您的工厂中集中创建数据。</h2></div><blockquote class="ix iy iz"><p id="f533" class="ja jb jc jd b je jf ij jg jh ji im jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">杰弗里·马提亚斯与安德里亚·莱奥帕尔迪合著了《测试灵药:灵药及其生态系统的有效且稳健的测试》一书，他最近主持了一个关于建立可维护测试工厂的讲座，我很高兴参加了这个讲座。</p><p id="1461" class="ja jb jc jd b je jf ij jg jh ji im jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">本文扩展了我上一篇文章中最初讨论的一点:<a class="ae jx" href="https://brooklinmyers.medium.com/how-to-build-maintainable-test-factories-in-elixir-and-phoenix-84312998f7e7" rel="noopener">如何在Elixir和Phoenix中构建可维护的测试工厂。</a></p></blockquote><figure class="jz ka kb kc fd kd er es paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="er es jy"><img src="../Images/fad2d9bc77eb57c872b5e3c4d10afeec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XsVH-C-VdE1y6p8knuOKsA.jpeg"/></div></div><figcaption class="kk kl et er es km kn bd b be z dx translated">照片由<a class="ae jx" href="https://unsplash.com/@hharritt?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">亨特·哈里特</a>在<a class="ae jx" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</figcaption></figure><h1 id="e918" class="ko kp hi bd kq kr ks kt ku kv kw kx ky io kz ip la ir lb is lc iu ld iv le lf bi translated">什么是工厂？</h1><p id="de73" class="pw-post-body-paragraph ja jb hi jd b je lg ij jg jh lh im jj li lj jm jn lk ll jq jr lm ln ju jv jw hb bi translated">Elixir中的工厂是处理向数据库插入数据的模块。他们还可以负责处理任何测试相关数据的生成。Ex玛奇纳是一个创建工厂的流行库。但是，您也可以从头开始构建自己的。</p><p id="bcb8" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj li jl jm jn lk jp jq jr lm jt ju jv jw hb bi translated">本文假设你有一些在工厂测试Phoenix和/或Elixir的知识。如果您想对Elixir中的工厂有一个简要的了解，我在phoenix中写过关于<a class="ae jx" rel="noopener" href="/geekculture/phoenix-understanding-how-to-seed-data-c2be863ddd1d">工厂和其他播种数据的方法。</a></p><h1 id="3416" class="ko kp hi bd kq kr ks kt ku kv kw kx ky io kz ip la ir lb is lc iu ld iv le lf bi translated">什么是集中式数据创建？</h1><p id="6172" class="pw-post-body-paragraph ja jb hi jd b je lg ij jg jh lh im jj li lj jm jn lk ll jq jr lm ln ju jv jw hb bi translated">通过将所有为测试生成相关数据的方法放在您的工厂中，而不是放在代码库中的任何地方，您可以将所有的数据创建集中在一个地方。</p><h1 id="3be7" class="ko kp hi bd kq kr ks kt ku kv kw kx ky io kz ip la ir lb is lc iu ld iv le lf bi translated">为什么要集中数据创建？</h1><p id="8fad" class="pw-post-body-paragraph ja jb hi jd b je lg ij jg jh lh im jj li lj jm jn lk ll jq jr lm ln ju jv jw hb bi translated">通过在工厂中集中数据创建，您提供了一个单一的、方便的界面，所有的测试数据都是在这个界面中创建的。因此，举例来说，如果您需要为您的测试生成电子邮件、姓名、地址，甚至布尔值，您在工厂中只有一个地方可以生成电子邮件，而不是在代码库中分布多个不同的方法。</p><p id="1983" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj li jl jm jn lk jp jq jr lm jt ju jv jw hb bi translated">您的工厂可以公开用于生成数据的公共方法，这些数据可以在整个代码库中使用。这样，如果数据发生变化，只需要在一个地方进行更新。</p><h1 id="7489" class="ko kp hi bd kq kr ks kt ku kv kw kx ky io kz ip la ir lb is lc iu ld iv le lf bi translated">偶然数据与有意数据。</h1><p id="a9df" class="pw-post-body-paragraph ja jb hi jd b je lg ij jg jh lh im jj li lj jm jn lk ll jq jr lm ln ju jv jw hb bi translated">意向数据是您的测试所依赖的数据。您应该显式地将有意的数据传递到您的工厂方法中，而不是依赖隐藏的值。相反，偶然数据是具体值无关紧要的数据，只要该值是有效的。考虑将附带数据随机化，这样你的测试就不会依赖于隐藏的假设并捕捉潜在的副作用。</p><h1 id="9349" class="ko kp hi bd kq kr ks kt ku kv kw kx ky io kz ip la ir lb is lc iu ld iv le lf bi translated">如何集中创建数据？</h1><p id="e4b6" class="pw-post-body-paragraph ja jb hi jd b je lg ij jg jh lh im jj li lj jm jn lk ll jq jr lm ln ju jv jw hb bi translated">如果您正在处理一个Phoenix或Elixir项目并使用工厂，那么您可能会在多个地方以不同方式生成相同类型的数据。</p><figure class="jz ka kb kc fd kd er es paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="er es lo"><img src="../Images/98e835adac456ab74c518b877dbb07b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YECeOxlko9KoOJNw8RNm3A.jpeg"/></div></div><figcaption class="kk kl et er es km kn bd b be z dx translated">艾莉娜·格鲁布尼亚克在<a class="ae jx" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><h2 id="5ca4" class="lp kp hi bd kq lq lr ls ku lt lu lv ky li lw lx la lk ly lz lc lm ma mb le mc bi translated">在工厂中创建一个公共方法。</h2><p id="5c8b" class="pw-post-body-paragraph ja jb hi jd b je lg ij jg jh lh im jj li lj jm jn lk ll jq jr lm ln ju jv jw hb bi translated">大多数应用程序需要的一些常见数据是电子邮件、电话号码、姓名和地址。在您的应用程序中可能有多种方法来生成这些值。</p><p id="26b1" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj li jl jm jn lk jp jq jr lm jt ju jv jw hb bi translated">例如，在我目前的项目中，我们工厂有多种创建电子邮件的方式。</p><p id="f858" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj li jl jm jn lk jp jq jr lm jt ju jv jw hb bi translated">通常我们使用ExMachina的序列方法来创建(email-1@test.com、email-2@test.com等电子邮件列表。)按顺序。</p><figure class="jz ka kb kc fd kd er es paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="er es md"><img src="../Images/1618776e1399c100dc0f18dea58e67fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PUgge7y1Ohk2fNPnWhuEaw.png"/></div></div></figure><p id="bbb6" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj li jl jm jn lk jp jq jr lm jt ju jv jw hb bi translated">在同一个项目中，我们有时也会用Faker发邮件。Faker是一个库，它提供了生成假数据的实用方法。</p><figure class="jz ka kb kc fd kd er es paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="er es me"><img src="../Images/7c4a74e1a9fff13d139a08f205497740.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k4oOsaH4D-l0T_iVsfawjA.png"/></div></div></figure><p id="a569" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj li jl jm jn lk jp jq jr lm jt ju jv jw hb bi translated">我们有时也会对电子邮件使用静态值。</p><figure class="jz ka kb kc fd kd er es paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="er es mf"><img src="../Images/bc59f30d4d5a3900685bedffb0006aa8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4ps4dNHcD2YDdPJq45gyKQ.png"/></div></div></figure><p id="ba2d" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj li jl jm jn lk jp jq jr lm jt ju jv jw hb bi translated">然而，为了集中数据生成，理想情况下，您需要一种方法来生成一种类型的数据。在这种情况下，电子邮件。</p><p id="b90f" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj li jl jm jn lk jp jq jr lm jt ju jv jw hb bi translated">首先，我向我们的工厂添加了以下方法。我选择使用Faker的电子邮件，而不是序列，因为它提供了更多的随机化。</p><figure class="jz ka kb kc fd kd er es paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="er es mg"><img src="../Images/8c6536e9b4cbb5b2eb129bab8ae1892b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pfsj0h8DVJlqWycSxiERcA.png"/></div></div></figure><p id="a34d" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj li jl jm jn lk jp jq jr lm jt ju jv jw hb bi translated">现在，每当我们需要生成电子邮件时，我们都可以使用这种方法。这是之前的相同用户代码，但是使用了工厂方法。</p><blockquote class="ix iy iz"><p id="8219" class="ja jb jc jd b je jf ij jg jh ji im jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">旁注:我还没有提取姓名值，只提取了邮件。</p></blockquote><figure class="jz ka kb kc fd kd er es paragraph-image"><div class="er es mh"><img src="../Images/acae095c33795a1678ba2328afbc32c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/1*r6PvKI-PnoHi1qL0tRb9Gw.png"/></div></figure><p id="1463" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj li jl jm jn lk jp jq jr lm jt ju jv jw hb bi translated">现在，我们创建电子邮件的方式在整个应用程序中是一致的。如果我们对有效和无效电子邮件的理解发生变化，那么我们只需要在一个地方而不是许多地方改变数据生成方法。</p><p id="da8f" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj li jl jm jn lk jp jq jr lm jt ju jv jw hb bi translated">以电子邮件为例，您可以对应用程序中使用的任何常见数据进行同样的操作。</p><h1 id="c003" class="ko kp hi bd kq kr ks kt ku kv kw kx ky io kz ip la ir lb is lc iu ld iv le lf bi translated">工厂模板。</h1><p id="371e" class="pw-post-body-paragraph ja jb hi jd b je lg ij jg jh lh im jj li lj jm jn lk ll jq jr lm ln ju jv jw hb bi translated">如果您的应用程序中有多个工厂，您可以考虑将您的数据生成方法提取到单个工厂模板模块中，以便您的工厂可以共享该代码。</p><figure class="jz ka kb kc fd kd er es paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="er es mi"><img src="../Images/2b9e1701709c8509d019d5f0714f3c07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N-ZPiTUGV0MBRlCayfLrWQ.jpeg"/></div></div><figcaption class="kk kl et er es km kn bd b be z dx translated">照片由<a class="ae jx" href="https://unsplash.com/@alanveob?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">阿列克谢·博夫</a>在<a class="ae jx" href="https://unsplash.com/s/photos/stamp?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="a295" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj li jl jm jn lk jp jq jr lm jt ju jv jw hb bi translated">我们目前在我们的应用程序中使用一个工厂，但是随着我们的发展，我们将把我们的大工厂分成更小的工厂。</p><p id="ee14" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj li jl jm jn lk jp jq jr lm jt ju jv jw hb bi translated">如果您发现自己处于这种情况，您可能会考虑用您的公共数据生成函数创建一个工厂模板模块，您可以在您的单独工厂模块中使用它。</p><h1 id="eefa" class="ko kp hi bd kq kr ks kt ku kv kw kx ky io kz ip la ir lb is lc iu ld iv le lf bi translated">未来的计划。</h1><p id="9545" class="pw-post-body-paragraph ja jb hi jd b je lg ij jg jh lh im jj li lj jm jn lk ll jq jr lm ln ju jv jw hb bi translated">我想实践我从Jeffrey的演讲中学到的东西，所以我计划从集中数据创建开始。从那里，下一步是随机化附带数据。我们仍然有很多地方使用静态数据而不是随机数据。</p><p id="3500" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj li jl jm jn lk jp jq jr lm jt ju jv jw hb bi translated">我希望您能从我在当前项目中尝试集中数据生成的经历中学到一些东西！此外，我希望在将来分享更多关于为elixir应用程序编写可维护工厂的经验。</p></div></div>    
</body>
</html>