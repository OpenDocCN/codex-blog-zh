<html>
<head>
<title>Pulling Stock Data from IEX Cloud with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python从IEX云中提取股票数据</h1>
<blockquote>原文：<a href="https://medium.com/codex/pulling-stock-data-from-iex-cloud-with-python-d44f63bb82e0?source=collection_archive---------0-----------------------#2021-03-14">https://medium.com/codex/pulling-stock-data-from-iex-cloud-with-python-d44f63bb82e0?source=collection_archive---------0-----------------------#2021-03-14</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><h2 id="fe77" class="hg hh hi bd b fp hj hk hl hm hn ho dx hp translated" aria-label="kicker paragraph"><a class="ae ge" href="http://medium.com/codex" rel="noopener">法典</a></h2><div class=""/><div class=""><h2 id="0c56" class="pw-subtitle-paragraph io hr hi bd b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf dx translated">用几行代码访问市场数据的简单方法</h2></div><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es jg"><img src="../Images/c8b5b30ed41f95aad5ea60bb3370413a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OyK_P_1ISoOedPwF"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx translated">照片由<a class="ae jw" href="https://unsplash.com/@jamie452?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">杰米街</a>在<a class="ae jw" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</figcaption></figure><p id="ba51" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">每次从网上下载股市数据都不是一件愉快的工作。此外，从互联网手动下载数据时，不可能获得实时价格。这就是云和API发挥作用的时候。</p><p id="00bd" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">在进入编码部分之前，让我们理解使用API从云中提取股票数据的机制。假设有一家名为IEX云的公司直接从交易所拥有或购买实时股票市场数据。该公司将数据存储在自己的数据库中，并通过云托管平台进行托管，即分散数据。现在，数据是公开的，但仍然不能就这样提取出来。这就是API变得有用的时候。即使用户不拥有云，使用API，他们也可以与云交互并从云中提取数据。</p><p id="bef8" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">这就是我们将要做的。需要记住的一点是，为了用API访问数据，用户必须有一个API密匙(类似于密码，不应该泄露)。如果没有API密钥，用户访问数据的请求将被拒绝，并显示400响应(错误或否定响应)。</p><p id="dac2" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">在本文中，我们将:</p><pre class="jh ji jj jk fd kt ku kv kw aw kx bi"><span id="6b92" class="ky kz hi ku b fi la lb l lc ld"><strong class="ku hs">- </strong><a class="ae jw" href="#38d0" rel="noopener ugc nofollow"><strong class="ku hs">Creating an IEX Cloud account</strong></a></span><span id="61df" class="ky kz hi ku b fi le lb l lc ld"><strong class="ku hs">- </strong><a class="ae jw" href="#f333" rel="noopener ugc nofollow"><strong class="ku hs">Importing packages into the python environment</strong></a></span><span id="cecc" class="ky kz hi ku b fi le lb l lc ld"><strong class="ku hs">- </strong><a class="ae jw" href="#9b7c" rel="noopener ugc nofollow"><strong class="ku hs">Getting the latest updates of stocks</strong></a></span><span id="8dfd" class="ky kz hi ku b fi le lb l lc ld"><strong class="ku hs">- </strong><a class="ae jw" href="#5d4a" rel="noopener ugc nofollow"><strong class="ku hs">Extracting historical prices of a stock</strong></a></span><span id="17f9" class="ky kz hi ku b fi le lb l lc ld"><strong class="ku hs">- </strong><a class="ae jw" href="#c80d" rel="noopener ugc nofollow"><strong class="ku hs">Pulling intraday prices of a stock</strong></a></span></pre><h1 id="38d0" class="lf kz hi bd lg lh li lj lk ll lm ln lo ix lp iy lq ja lr jb ls jd lt je lu lv bi translated">创建IEX云帐户</h1><p id="d0b2" class="pw-post-body-paragraph jx jy hi jz b ka lw is kc kd lx iv kf kg ly ki kj kk lz km kn ko ma kq kr ks hb bi translated">拥有一个IEX云账户是非常重要的，因为只有这样我们才能拥有自己的秘密API密钥和访问数据。若要创建帐户，请首先访问IEX云网站。悬停在右上角的“登录”按钮，找到“创建帐户”选项。输入所需的详细信息并创建您自己的帐户。创建帐户后，导航到控制台页面(<a class="ae jw" href="https://iexcloud.io/console/" rel="noopener ugc nofollow" target="_blank">iexcloud.io/console</a>)。你会看到这样一个页面(我隐藏了个人信息):</p><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es mb"><img src="../Images/1aaec01b06a29d78bf47f9ef565acecb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3UxhduBnLv4879oESsgcXw.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx translated">控制台页面</figcaption></figure><p id="a085" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">在“API令牌”部分，选择“转到API令牌”按钮。按下按钮后，您将被引导至如下页面:</p><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es mc"><img src="../Images/ce8f2b27bbaed955672a167f3aae09cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*83ZFnN4bUvba-pXuDEGDcw.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx translated">API页面</figcaption></figure><p id="f142" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">正如您所看到的，有两种类型的API令牌，它们是秘密的和可发布的令牌。您可以使用这两种API标记，但是当您向公众展示您的代码时，您不应该泄露您的秘密标记。在本文中，我将只在代码中使用可发布的令牌。希望你们都已经在IEX云上创建了一个账户，并且熟悉了API环境。我们来编码吧！</p><h1 id="f333" class="lf kz hi bd lg lh li lj lk ll lm ln lo ix lp iy lq ja lr jb ls jd lt je lu lv bi translated">导入包</h1><p id="bab8" class="pw-post-body-paragraph jx jy hi jz b ka lw is kc kd lx iv kf kg ly ki kj kk lz km kn ko ma kq kr ks hb bi translated">每个python程序都从导入所需的包开始。在本文中，我们将使用Pandas、Requests和Matplotlib作为主要的包。让我们将包导入到python环境中。</p><p id="d723" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated"><strong class="jz hs"> Python实现:</strong></p><figure class="jh ji jj jk fd jl"><div class="bz dy l di"><div class="md me l"/></div></figure><p id="b6e0" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">除了导入主包，我们还导入了Termcolor包来定制字体，并更改了Matplotlib上的一些设置。</p><h1 id="9b7c" class="lf kz hi bd lg lh li lj lk ll lm ln lo ix lp iy lq ja lr jb ls jd lt je lu lv bi translated">获取股票的最新动态</h1><p id="c3ba" class="pw-post-body-paragraph jx jy hi jz b ka lw is kc kd lx iv kf kg ly ki kj kk lz km kn ko ma kq kr ks hb bi translated">现在让我们用python定义一个函数来获取股票的最新更新。</p><p id="e616" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated"><strong class="jz hs"> Python实现:</strong></p><figure class="jh ji jj jk fd jl"><div class="bz dy l di"><div class="md me l"/></div></figure><p id="e335" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated"><strong class="jz hs">输出:</strong></p><pre class="jh ji jj jk fd kt ku kv kw aw kx bi"><span id="c462" class="ky kz hi ku b fi la lb l lc ld"><strong class="ku hs">Latest Updates of FB<br/>--------------</strong><br/><strong class="ku hs">symbol :</strong> FB<br/><strong class="ku hs">latestPrice :</strong> 268.4<br/><strong class="ku hs">marketCap :</strong> 766013634355<br/><strong class="ku hs">peRatio :</strong> 26.6<br/><strong class="ku hs">--------------<br/></strong><br/><strong class="ku hs">Latest Updates of AAPL<br/>--------------</strong><br/><strong class="ku hs">symbol :</strong> AAPL<br/><strong class="ku hs">latestPrice :</strong> 121.03<br/><strong class="ku hs">marketCap :</strong> 2031863258880<br/><strong class="ku hs">peRatio :</strong> 32.89<br/><strong class="ku hs">--------------<br/></strong><br/><strong class="ku hs">Latest Updates of AMZN<br/>--------------</strong><br/><strong class="ku hs">symbol :</strong> AMZN<br/><strong class="ku hs">latestPrice :</strong> 3089.49<br/><strong class="ku hs">marketCap :</strong> 1555758237851<br/><strong class="ku hs">peRatio :</strong> 73.86<br/><strong class="ku hs">--------------<br/></strong><br/><strong class="ku hs">Latest Updates of NFLX<br/>--------------</strong><br/><strong class="ku hs">symbol :</strong> NFLX<br/><strong class="ku hs">latestPrice :</strong> 518.02<br/><strong class="ku hs">marketCap :</strong> 228858650044<br/><strong class="ku hs">peRatio :</strong> 85.2<br/><strong class="ku hs">--------------<br/></strong><br/><strong class="ku hs">Latest Updates of GOOGL<br/>--------------</strong><br/><strong class="ku hs">symbol :</strong> GOOGL<br/><strong class="ku hs">latestPrice :</strong> 2050<br/><strong class="ku hs">marketCap :</strong> 1392148604815<br/><strong class="ku hs">peRatio :</strong> 34.98<br/><strong class="ku hs">--------------</strong></span></pre><p id="8628" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated"><strong class="jz hs">代码解释:</strong>首先我们定义一个名为‘get _ latest _ updates’的函数。我们定义这个函数的方式是，将尽可能多的股票代码作为参数。在函数内部，我们传递一个for循环来遍历作为参数传递的tickers列表。当深入研究for循环时，我们将api键(可发布键)存储到“iex_api_key”变量中，并将API的URL存储到“api_url”变量中。</p><p id="c39a" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">在进一步研究代码之前，有一件事需要记住。有四种与API交互的主要方法，即GET、POST、PUT和DELETE方法。GET方法用于从数据库中提取数据，POST方法用于向数据库中添加数据。PUT方法用于添加或覆盖数据，DELETE方法用于从数据库中删除数据。记住这一点，让我们继续前进！</p><p id="8bab" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">在将API键和URL存储到它们各自的变量中之后，我们使用Requests包提供的GET请求来提取数据。我们将这些数据以JSON格式存储到‘df’变量中。接下来，我们将进行一些数据处理，以便更清楚地显示结果。最后，我们用FAANG(脸书，苹果，亚马逊，网飞，谷歌)股票的报价器作为参数来调用这个函数，瞧！很酷，对吧？！</p><p id="fea6" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">请记住，许多属性会随数据一起出现，但是在我们的代码中，我们只使用了四个属性来显示结果(symbol、latestPrice、marketCap、peRatio)。</p><h1 id="5d4a" class="lf kz hi bd lg lh li lj lk ll lm ln lo ix lp iy lq ja lr jb ls jd lt je lu lv bi translated">提取股票的历史价格</h1><p id="a37c" class="pw-post-body-paragraph jx jy hi jz b ka lw is kc kd lx iv kf kg ly ki kj kk lz km kn ko ma kq kr ks hb bi translated">现在让我们定义一个函数来提取股票上市时的市场数据。</p><p id="14f1" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated"><strong class="jz hs"> Python实现:</strong></p><figure class="jh ji jj jk fd jl"><div class="bz dy l di"><div class="md me l"/></div></figure><p id="baa1" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated"><strong class="jz hs">输出:</strong></p><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es mf"><img src="../Images/253b1a304ea51518431efa4caa0dfef9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mQS-s2sVSDMd5tVvKNR8wA.png"/></div></div></figure><figure class="jh ji jj jk fd jl er es paragraph-image"><div class="er es mg"><img src="../Images/0b6baa18e67a7087c175c32aa244dcc1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1234/format:webp/1*NKkTGrYXkpdCsDOER00WOA.png"/></div><figcaption class="js jt et er es ju jv bd b be z dx translated">作者提供的图片</figcaption></figure><p id="bc52" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated"><strong class="jz hs">代码解释:</strong>首先，我们定义一个名为“get _ historic _ data”的函数，该函数将股票代码作为参数。在函数内部，它几乎类似于我们在上一个函数中所做的，但是API的URL有所不同。在将可发布的API键和URL存储到它们各自的变量中之后，我们调用GET request方法来提取数据，并将其作为JSON格式存储在‘df’变量中。之后是一个漫长的数据处理过程，以更精确地显示最终的数据帧。接下来，我们使用Matplotlib生成一个图，以更有意义的方式表示数据。最后，我们调用以“AAPL”为参数的函数，看看它是如何工作的。</p><h1 id="c80d" class="lf kz hi bd lg lh li lj lk ll lm ln lo ix lp iy lq ja lr jb ls jd lt je lu lv bi translated">拉一只股票的当天价格</h1><p id="d360" class="pw-post-body-paragraph jx jy hi jz b ka lw is kc kd lx iv kf kg ly ki kj kk lz km kn ko ma kq kr ks hb bi translated">让我们定义一个函数，使我们能够获得给定股票的当天价格。</p><p id="1479" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated"><strong class="jz hs"> Python实现:</strong></p><figure class="jh ji jj jk fd jl"><div class="bz dy l di"><div class="md me l"/></div></figure><p id="2514" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated"><strong class="jz hs">输出:</strong></p><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es mh"><img src="../Images/4d90d8648ba51dc8f01c77f4328ad266.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eBCHPwNV2xcrtM-pv7Elsg.png"/></div></div></figure><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es mi"><img src="../Images/f849a2936644e454ff292d2e73d9af53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M-s3_R6lX5OBEMJ-Ek7i4A.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx translated">作者提供的图片</figcaption></figure><p id="f242" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated"><strong class="jz hs">代码解释:</strong>首先，我们定义一个名为“get_intraday_prices”的函数，它将股票的代码作为参数。正如我之前所说的，这个函数的结构与前面的几乎相似，但是API的URL有所不同。在以JSON格式提取和存储数据之后，我们正在进行一些数据操作，以便更清楚地清理和表示数据。在函数的最后，我们使用Matplotlib生成一个日内价格的折线图。最后，我们返回并调用函数来测试它。</p><h1 id="3abf" class="lf kz hi bd lg lh li lj lk ll lm ln lo ix lp iy lq ja lr jb ls jd lt je lu lv bi translated">结论</h1><p id="a0c5" class="pw-post-body-paragraph jx jy hi jz b ka lw is kc kd lx iv kf kg ly ki kj kk lz km kn ko ma kq kr ks hb bi translated">在本文中，我们使用API从云服务器中提取不同种类的数据，并做了一些数据操作，以便更清楚地显示结果。作为一名数据科学家，使用API从云中提取数据是一项非常有用且重要的任务。随着数据量的日益增长，公司希望数据科学家使用云存储而不是传统的数据库来简化工作流程和提高效率。在本文中，我们仅仅介绍了使用API提取数据的基础知识，但是还有很多内容有待探索。就这样，我们到达了文章的结尾。希望你找到了一些好东西！</p></div></div>    
</body>
</html>