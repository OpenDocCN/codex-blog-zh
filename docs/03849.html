<html>
<head>
<title>Create a Fraud Detection Microservice in .NET and Vonage</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在中创建欺诈检测微服务。NET和Vonage</h1>
<blockquote>原文：<a href="https://medium.com/codex/create-a-fraud-detection-microservice-in-net-and-vonage-ec685cb0540a?source=collection_archive---------5-----------------------#2021-10-01">https://medium.com/codex/create-a-fraud-detection-microservice-in-net-and-vonage-ec685cb0540a?source=collection_archive---------5-----------------------#2021-10-01</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/ed3c245ba4028965e798c21d0037d2c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lHubyHFlT3NoPN7oLTx5xg.png"/></div></div></figure><p id="16c5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当你注册保险政策、抵押贷款等金融资产，甚至手机计划等服务时，你申请的公司需要确保你是一个真实的人。最重要的是，对于这些公司来说，有一种方法可以验证潜在客户给他们的电话号码是否是一个真实的、活跃的号码，以便在未来可以联系到。</p><p id="6982" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Vonage有一个神奇的电话<a class="ae jo" href="https://developer.vonage.com/api/number-insight" rel="noopener ugc nofollow" target="_blank">号码洞察API </a>可以帮助支持这种情况。作为一名开发人员，您可能需要构建一个独立的内部微服务来处理这个用例。</p><p id="7786" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在本文中，您将学习如何使用Vonage Number Insights API和。NET来构建一个可以提供这种功能的小型分布式服务。</p><h1 id="e73c" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">密码</h1><p id="0ae1" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">如果你想跳过，你可以在GitHub上查看本教程的<a class="ae jo" href="https://github.com/nexmo-community/vonage-api-dotnet-fraud-service" rel="noopener ugc nofollow" target="_blank">代码。</a></p><h1 id="f07a" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">先决条件</h1><p id="8308" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">要开始，您需要:</p><ul class=""><li id="9921" class="ks kt hi is b it iu ix iy jb ku jf kv jj kw jn kx ky kz la bi translated">的IDE。NET开发，如Visual Studio、Visual Studio代码或JetBrains Rider</li><li id="cb18" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated">的最新版本。NET 已安装</li></ul><h1 id="8aa4" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">Vonage API帐户</h1><p id="3427" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">要完成本教程，您将需要一个<a class="ae jo" href="http://developer.nexmo.com/ed?c=blog_text&amp;ct=2021-08-17-create-an-anti-fraud-detection-microservice-in-net-and-vonage" rel="noopener ugc nofollow" target="_blank"> Vonage API帐户</a>。如果您还没有，您可以今天就<a class="ae jo" href="http://developer.nexmo.com/ed?c=blog_text&amp;ct=2021-08-17-create-an-anti-fraud-detection-microservice-in-net-and-vonage" rel="noopener ugc nofollow" target="_blank">注册</a>并开始使用免费积分进行构建。一旦你有了一个帐户，你可以在<a class="ae jo" href="http://developer.nexmo.com/ed?c=blog_text&amp;ct=2021-08-17-create-an-anti-fraud-detection-microservice-in-net-and-vonage" rel="noopener ugc nofollow" target="_blank"> Vonage API仪表板</a>的顶部找到你的API密匙和API秘密。</p><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/941d1ebad7252085aa9c1e88f9dc18f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9RUNrmWVrhuK9uZKQ1igZA.png"/></div></div></figure><h1 id="771c" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">开始你的。网络工人服务</h1><p id="bd1d" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">英寸NET中，工作服务类似于后台进程，通常会订阅消息总线/队列或轮询其他服务。在本教程中，您将构建一个微服务，它接受来自消息队列的消息，通过调用Vonage API处理它们，然后将响应消息发送回队列。</p><p id="17ea" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们通过在终端中执行以下命令来创建一个. NET worker服务:</p><p id="86c4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du lk ll lm ln b">dotnet new worker -o FraudService</code></p><p id="2085" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">接下来，执行<code class="du lk ll lm ln b">cd ./FraudService</code>导航到<code class="du lk ll lm ln b">dotnet</code>命令为你创建的文件夹。</p><p id="5698" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您需要安装<a class="ae jo" href="https://github.com/jamesmh/coravel" rel="noopener ugc nofollow" target="_blank"> Coravel </a>，这将有助于在我们的工人服务中安排作业:</p><p id="a76f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du lk ll lm ln b">dotnet add package Coravel</code></p><p id="fdd9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您还需要安装<a class="ae jo" href="https://github.com/Vonage/vonage-dotnet-sdk" rel="noopener ugc nofollow" target="_blank"> Vonage C# SDK客户端</a>:</p><p id="65a5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du lk ll lm ln b">dotnet add package Vonage</code></p><p id="6e43" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最后，从项目中删除文件<code class="du lk ll lm ln b">Worker.cs</code>，因为你不再需要它了。</p><h1 id="89a5" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">构建主要的欺诈检测逻辑</h1><p id="2751" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">您将构建的小型(微型)服务将模拟通过事件总线或队列与输入和输出进行交互。通过REST API或另一个RPC方法直接公开功能可能会导致像<a class="ae jo" href="https://docs.aws.amazon.com/whitepapers/latest/microservices-on-aws/chattiness.html" rel="noopener ugc nofollow" target="_blank">喋喋不休的服务</a>、弹性较差的系统等问题。</p><p id="6b82" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了简单起见，本教程将使用文件系统存储消息/事件。</p><p id="2ca8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">创建一个名为<code class="du lk ll lm ln b">MockEventBus.cs</code>的文件，并用以下代码替换它:</p><figure class="lg lh li lj fd ij"><div class="bz dy l di"><div class="lo lp l"/></div></figure><p id="ff9f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这个类将给我们提供模拟发送和接收模拟分布式消息的能力。它有两个公共方法:一个将消息“发送”到特定的队列——实现为文件——另一个从给定的队列/文件中删除所有消息。</p><p id="d2fa" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">接下来，您将创建一个名为<code class="du lk ll lm ln b">Constants.cs</code>的文件，并用以下内容填充它:</p><figure class="lg lh li lj fd ij"><div class="bz dy l di"><div class="lo lp l"/></div></figure><p id="a7b5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这是我们需要向其发送/接收消息的两个队列的名称。</p><p id="77a6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">接下来，创建一个文件<code class="du lk ll lm ln b">CheckPhoneNumberInvocable.cs</code>。这个文件是我们应用程序的主体。从我们的队列中提取消息、调用<a class="ae jo" href="https://developer.vonage.com/number-insight/overview" rel="noopener ugc nofollow" target="_blank"> Vonage Number Insight API </a>以及存储结果的逻辑都将封装在这里。</p><p id="5974" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">用以下内容替换<code class="du lk ll lm ln b">CheckPhoneNumberInvocable.cs</code>的内容:</p><figure class="lg lh li lj fd ij"><div class="bz dy l di"><div class="lo lp l"/></div></figure><p id="08e2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这个虚假的场景中，其他服务可能想知道给定的电话号码是否有合法的运营商，并验证该号码是在哪个国家注册的。掌握这些信息有助于针对欺诈账户、客户等做出决策。</p><p id="e971" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们仔细看看代码！它从队列中提取消息/事件，其中每条消息都是要验证的电话号码。Numbers Insight API为该数字发送的结果随后存储在另一个队列中。</p><p id="e15a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这在分布式系统中很常见:微服务会将其最终结果发布到异步消息队列中。其他系统可以订阅这个队列，接收这些结果，并做他们需要做的任何事情。</p><p id="b00c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这种方法允许每个服务是自治的和有弹性的。例如，如果某个特定的服务停止运行，它可以在恢复运行后开始处理它停止运行时放入队列中的消息。对于典型的REST/RPC方法，当服务关闭时，它根本无法接收消息或请求——这使得异步消息驱动方法更具弹性。</p><p id="9d97" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">回到代码，您需要配置并将这个应用程序的不同部分粘在一起。将<code class="du lk ll lm ln b">Program.cs</code>替换为以下内容:</p><figure class="lg lh li lj fd ij"><div class="bz dy l di"><div class="lo lp l"/></div></figure><p id="bb07" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">本教程使用<a class="ae jo" href="https://github.com/jamesmh/coravel" rel="noopener ugc nofollow" target="_blank"> Coravel </a>来配置一种简单的方法，每十秒钟运行一次我们的<code class="du lk ll lm ln b">CheckPhoneNumberInvocable</code>类。它模拟轮询或订阅消息队列，您马上就会看到这一点。</p><h1 id="eb63" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">测试您的微服务</h1><p id="e730" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">在<code class="du lk ll lm ln b">Program.cs</code>中替换了API密钥和密码后，在终端中执行以下命令来运行应用程序:</p><p id="3702" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当程序运行时，您将看到应用程序生成的两个新的<code class="du lk ll lm ln b">.json</code>文件。您可以查看<code class="du lk ll lm ln b">mock_event_bus_validated_phone_numbers.json</code>，查看所有已验证电话号码的信息。</p><p id="7974" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在<code class="du lk ll lm ln b">Program.cs</code>中，有一种叫做<code class="du lk ll lm ln b">ConfigureTestPhoneNumbers()</code>的方法，你可以硬编码一些电话号码，以便在应用程序启动时立即进行测试。然而，在应用程序运行时，您也可以修改<code class="du lk ll lm ln b">mock_event_bus_phone_numbers_to_validate.json</code>并动态添加新的数字。这样做可以刺激新消息从队列中进入。</p><p id="397e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您可以用以下内容替换<code class="du lk ll lm ln b">mock_event_bus_phone_numbers_to_validate.json</code>的内容:</p><figure class="lg lh li lj fd ij"><div class="bz dy l di"><div class="lo lp l"/></div></figure><p id="7512" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">几秒钟后，看一看<code class="du lk ll lm ln b">mock_event_bus_validated_phone_numbers.json</code>来查看您选择验证的任何电话号码的结果！</p><h1 id="4af3" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">结论</h1><p id="44bd" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">您已经成功创建了一个. NET微服务，它可以验证电话号码并将该信息发送回多个消费者/服务。每个消费者可以自己决定如何使用这些结果。您还理解了使用事件驱动的方法如何保持系统的各个部分的解耦和自治。</p><p id="f340" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Numbers Insight的API还有许多其他奇妙的功能。虽然本教程使用了“标准的”Numbers Insights API，但是还有一个更高级的特性<a class="ae jo" href="https://developer.vonage.com/api/number-insight?theme=dark#getNumberInsightAsync" rel="noopener ugc nofollow" target="_blank">可以让您获得更多关于给定电话号码的信息。有时间试试吧！</a></p></div><div class="ab cl lq lr gp ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="hb hc hd he hf"><p id="9237" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="lx">最初发表于</em><a class="ae jo" href="https://gist.github.com/23060d5226eeb3379076247daaa32c2c" rel="noopener ugc nofollow" target="_blank"><em class="lx">【http://github.com】</em></a><em class="lx">。</em></p></div></div>    
</body>
</html>