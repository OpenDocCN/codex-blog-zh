<html>
<head>
<title>How to Hide an API Key in Rails and Pass it To Heroku</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Rails中隐藏一个API密钥并将其传递给Heroku</h1>
<blockquote>原文：<a href="https://medium.com/codex/how-to-hide-an-api-key-in-rails-and-pass-it-to-heroku-28f9bf7edbe7?source=collection_archive---------9-----------------------#2021-08-06">https://medium.com/codex/how-to-hide-an-api-key-in-rails-and-pass-it-to-heroku-28f9bf7edbe7?source=collection_archive---------9-----------------------#2021-08-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/03f283ef473d6a7bb7d824eea88ac6a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Yx6Knqhkqqf9vKzBZJa6SA.jpeg"/></div></div></figure><p id="e996" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这篇博客中，我们将看看如何在Rails中隐藏面向公众的API密钥，以及如何将它们传递给Heroku上部署的Rails应用程序。</p><p id="c731" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">使用外部API是创建有用且有趣的应用程序的好方法。对于许多高质量的外部API，将需要一个授权密钥。甚至许多免费的API都需要一个密钥。许多API只会给你每月分配的API调用数量，否则，你将不得不付钱来获得更多。如果你将你的代码存储在任何类型的在线公共回购中，比如GitHub，最重要的是你要隐藏你的API密匙，这样就没有人能从你的在线回购中窃取它并为自己所用。如果您的应用程序被部署到Heroku，您还需要将保存的密钥传递给Heroku，以便您的项目进行正确的调用。让我们开始吧！</p><p id="023c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在本教程中，您需要做的第一件事就是获取API的密钥。API应该有关于如何获得唯一密钥的文档。一旦你有了这个，想法就是把它保存为Rails中的一个环境变量。我们将使用包含API键的环境变量，而不是将API键直接插入API调用。这将允许我们在代码中对API密匙保密。</p><h2 id="19ec" class="jo jp hi bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki bi translated">Rails Gem Dotenv</h2><p id="9236" class="pw-post-body-paragraph iq ir hi is b it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj kn jl jm jn hb bi translated">下一步是打开您的Rails项目并将<a class="ae ko" href="https://github.com/bkeepers/dotenv" rel="noopener ugc nofollow" target="_blank"> gem </a> <code class="du kp kq kr ks b">'dotenv-rails'</code>安装到您的gem文件中。您可以通过手动将<code class="du kp kq kr ks b">gem 'dotenv-rails'</code>添加到您的Gemfile中，然后在终端中运行<code class="du kp kq kr ks b">$ bundle install</code>，或者您可以简单地在终端中运行<code class="du kp kq kr ks b">$ gem install dotenv</code>来实现这一点。</p><h2 id="0e97" class="jo jp hi bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki bi translated">创建环境变量</h2><p id="cc20" class="pw-post-body-paragraph iq ir hi is b it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj kn jl jm jn hb bi translated">安装完成后，我们可以通过在项目中创建一个名为<code class="du kp kq kr ks b">.env</code>的新文件，将我们唯一的API密匙作为环境变量传递。让我们为我们的键起一个名字，我们称之为<code class="du kp kq kr ks b">MY_API_KEY</code>，让我们假设我们的API键是<code class="du kp kq kr ks b">1234567</code>。在新的<code class="du kp kq kr ks b">.env </code>文件中，我们可以像这样保存我们的API密钥:</p><pre class="kt ku kv kw fd kx ks ky kz aw la bi"><span id="4e32" class="jo jp hi ks b fi lb lc l ld le">MY_API_KEY=1234567 </span></pre><p id="c708" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这个变量可以在Rails应用程序中的任何地方使用，如下所示:</p><pre class="kt ku kv kw fd kx ks ky kz aw la bi"><span id="6ff3" class="jo jp hi ks b fi lb lc l ld le">ENV[“MY_API_KEY”]</span></pre><p id="a7de" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因此，要在我们的代码中的API调用中使用这个新变量，它可能看起来像这样:</p><pre class="kt ku kv kw fd kx ks ky kz aw la bi"><span id="7d4c" class="jo jp hi ks b fi lb lc l ld le">key = ENV[“MY_API_KEY”]</span><span id="41da" class="jo jp hi ks b fi lf lc l ld le">url = “https://api.rawg.io/api/games/7153?key=#{key}"</span></pre><h2 id="216c" class="jo jp hi bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki bi translated">。gitignore</h2><p id="7d22" class="pw-post-body-paragraph iq ir hi is b it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj kn jl jm jn hb bi translated">下一步超级重要。我们需要将<code class="du kp kq kr ks b">.env</code>文件添加到<code class="du kp kq kr ks b">.gitignore</code>文件中，以确保与我们唯一的API键相关的文件不会与我们的代码一起被推送到任何在线存储库中。</p><p id="ac3c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您希望其他人能够克隆您的repo并在他们自己的机器上运行您的项目，请确保在自述文件中包含文档，说明他们将需要自己用名为<code class="du kp kq kr ks b">MY_API_KEY</code>的环境变量创建一个新的<code class="du kp kq kr ks b">.env</code>文件，并将他们自己的密钥插入其中。</p><h2 id="68b8" class="jo jp hi bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki bi translated">将API密钥传递给Heroku</h2><p id="e3f1" class="pw-post-body-paragraph iq ir hi is b it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj kn jl jm jn hb bi translated">现在我们的密匙在本地被安全地使用，在我们的在线存储库中没有被窃取的危险，让我们看看如何将它放入我们在Heroku上部署的代码中。</p><p id="3094" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">先决条件:我假设您已经在Heroku上部署了一个Rails应用程序，并且对Heroku CLI有些熟悉。</p><p id="bbcf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因为我们的<code class="du kp kq kr ks b">.env</code>在我们的<code class="du kp kq kr ks b">.gitignore</code>文件中，所以当我们推送包含环境变量用法的新代码时，它不会被发送到Heroku。所以我们代码中任何使用<code class="du kp kq kr ks b">ENV[“My_API_KEY”]</code>的地方都找不到那个变量的值。</p><p id="0985" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了解决这个问题，我们可以在部署的Heroku repo中创建一个<a class="ae ko" href="https://devcenter.heroku.com/articles/config-vars" rel="noopener ugc nofollow" target="_blank">配置变量</a>。</p><p id="8cd5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先，登录你的Heroku账户。接下来，在命令行中输入以下内容:</p><pre class="kt ku kv kw fd kx ks ky kz aw la bi"><span id="0f47" class="jo jp hi ks b fi lb lc l ld le">$ heroku config:set MY_API_KEY=1234567</span></pre><p id="086b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这应该将API键保存为一个配置变量。为了验证密钥是否正确保存，我们可以使用以下命令进行检查:</p><pre class="kt ku kv kw fd kx ks ky kz aw la bi"><span id="c09f" class="jo jp hi ks b fi lb lc l ld le">$ heroku config:get MY_API_KEY</span></pre><p id="e11e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们应该会在终端看到<code class="du kp kq kr ks b">1234567</code>。</p><p id="df81" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在Heroku上的代码中将使用Config变量，就像本地机器上的环境变量一样。所以给它们取相同的名字是非常重要的！</p><p id="2f87" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="lg">如果您不想使用命令行方法，也可以从Heroku仪表板的</em> <code class="du kp kq kr ks b">Settings</code> <em class="lg">选项卡将配置变量传递给Heroku。</em></p><p id="e068" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">就是这样！让那些API密匙安全快乐的建造吧！</p></div></div>    
</body>
</html>