# ç°ä»£æ•°æ®ä»“åº“å·¥å…·:dbt &åˆ†æå·¥ç¨‹å¯¼è®º

> åŸæ–‡ï¼š<https://medium.com/codex/a-modern-data-warehousing-tool-dbt-introduction-to-analytics-engineering-d4245d868e3c?source=collection_archive---------1----------------------->

## åˆ©ç”¨ Docker åˆ›å»ºè‡ªå·±çš„å®éªŒå®¤æ¨¡æ‹Ÿè‹±è¯­æ•™å­¦ã€‚ä»€ä¹ˆæ˜¯åˆ†æå·¥ç¨‹ã€‚dbt ç®€ä»‹ã€‚ETL å’Œ ELT æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

# ä»‹ç»

æˆ‘å·²ç»ç”¨æ–°å·¥å…·å¼€ä¼šä¸‰ä¸ªæ˜ŸæœŸäº†ã€‚åœ¨ä»¥æ–°çš„å·¥ä½œèŒƒå›´å¼€å§‹æ–°çš„å·¥ä½œåï¼Œæˆ‘éœ€è¦å­¦ä¹ æ–°çš„æŠ€æœ¯ã€‚æˆ‘å·²ç»çŸ¥é“äº†ä¸€äº›å·¥å…·ï¼Œä½†åœ¨è¿™æ®µæ—¶é—´é‡Œï¼Œæˆ‘å¯¹å®ƒä»¬æ›´åŠ ç†Ÿæ‚‰äº†ã€‚ä¾‹å¦‚ï¼Œæˆ‘åœ¨å¼€å§‹å·¥ä½œä¹‹å‰å°±çŸ¥é“ Dockerï¼Œä½†åœ¨æ­¤ä¹‹å‰æˆ‘å¹¶æ²¡æœ‰æ€ä¹ˆä½¿ç”¨å®ƒã€‚ç„¶åï¼Œæˆ‘ä¹ æƒ¯äº† Dockerï¼Œå¹¶å¼€å§‹ç”¨å®ƒåšæ‰€æœ‰çš„äº‹æƒ…ğŸ˜‹

åœ¨è¿™ä¸ªæ•…äº‹ä¸­ï¼Œæˆ‘ä»¬å°†åŸºäº Docker åˆ›å»ºè‡ªå·±çš„å®éªŒå®éªŒå®¤æ¥æ¨¡æ‹Ÿ ELT è¿‡ç¨‹ã€‚æˆ‘å°†ä½¿ç”¨ dbt çš„[å®˜æ–¹åŸ¹è®­é¡¹ç›®ä¸­ä½¿ç”¨çš„ç›¸åŒæ•°æ®ã€‚ä½†æ˜¯ä¼šæœ‰åŒºåˆ«ï¼Œæˆ‘ä¼šç”¨ PostgreSQL ä»£æ›¿çº¢ç§»ï¼Œé›ªèŠ±ç­‰ã€‚å› ä¸ºæˆ‘ä¸æƒ³èŠ±å¤ªå¤šæ—¶é—´è§£é‡Šå®ƒä»¬æ˜¯ä»€ä¹ˆï¼Œä»¥åŠæˆ‘ä»¬å¦‚ä½•åˆ›å»ºå¸æˆ·ç­‰ã€‚å…¶å®æˆ‘ä»¬çš„å®éªŒå®¤ä¼šç®€å•ä¸€ç‚¹ã€‚æˆ‘ä»¬å°†ä»æº AWS S3 è¯»å–æ•°æ®ï¼Œç„¶åå°†æ•°æ®åŠ è½½åˆ°æˆ‘ä»¬çš„ PostgreSQL æ•°æ®ä»“åº“ä¸­ï¼Œè¯¥æ•°æ®ä»“åº“æ˜¯æˆ‘ä»¬åœ¨å®éªŒå®¤ä¸­ä½¿ç”¨ Docker åˆ›å»ºçš„ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å°†èƒ½å¤Ÿåœ¨æœ¬åœ°æ•°æ®ä»“åº“ä¸­ä½¿ç”¨ DBTã€‚æ­¤å¤–ï¼Œæˆ‘å¼€å§‹å‡†å¤‡å›è´­æ”¶é›†æˆ‘çš„ dbt ç¬”è®°ã€‚æ‚¨å¯ä»¥é€šè¿‡ä¸‹é¢çš„é“¾æ¥è®¿é—®å®ƒã€‚æˆ‘ç›¸ä¿¡æˆ‘ä¼šåŠ å¼ºå›è´­ï¼Œä½†æˆ‘ä¸çŸ¥é“æˆ‘æ˜¯å¦ä¼šä¸ºæˆ‘å­¦ä¹ çš„æ¯ä¸ª dbt æ¨¡å—å†™ä¸€ç¯‡è®ºæ–‡ã€‚](https://courses.getdbt.com/courses/fundamentals)

[](https://github.com/mebaysan/DBT-Training) [## GitHub - mebaysan/DBT-Training:æˆ‘åˆ›å»ºäº†è¿™ä¸ª repo æ¥éµå¾ª DBT çš„å®˜æ–¹åŸ¹è®­è·¯å¾„

### æˆ‘åˆ›å»ºäº†è¿™ä¸ªå›è´­éµå¾ª DBT dbt åŸºç¡€ 1-dbt-åŸºç¡€æ–‡ä»¶å¤¹çš„å®˜æ–¹åŸ¹è®­è·¯å¾„æ˜¯ä¸ºâ€¦

github.com](https://github.com/mebaysan/DBT-Training) 

å¥½çš„ï¼Œé¦–å…ˆè®©æˆ‘ä»¬è°ˆè°ˆæ ¸å¿ƒæœ¯è¯­ã€‚æˆ‘ä¼šæŠŠè‡ªå·±é€šè¿‡é˜…è¯»ç†è§£çš„è§‚ç‚¹å†™å‡ºæ¥ã€‚æ‰€ä»¥è¯·ä¸è¦è¯„ä»·æˆ‘ï¼Œå¦‚æœä½ ä¸åŒæ„æˆ‘çš„è§‚ç‚¹ï¼Œè¯·è®°ä½ï¼›æˆ‘ä¸æ˜¯è¯´æˆ‘çŸ¥é“æœ€å¥½çš„æˆ–è€…æˆ‘çš„è§‚ç‚¹æ˜¯ä¸å¯è®¨è®ºçš„ç­‰ç­‰ã€‚ğŸ˜‡

![](img/51f8cdb941ef6256bdb3e5f764412ca9.png)

[å›¾ç‰‡æ¥è‡ª DBT](https://blog.getdbt.com/)

# ä»€ä¹ˆæ˜¯ ELTï¼ŒELT å’Œ ETL æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

é¦–å…ˆï¼Œè®©æˆ‘ä»¬ä»è§£é‡Šä»€ä¹ˆæ˜¯ ETL å¼€å§‹ã€‚ETL æ˜¯æå–ã€è½¬æ¢å’ŒåŠ è½½æ•°æ®çš„è¿‡ç¨‹ã€‚å®ƒä»ä»æ•°æ®æºæå–æ•°æ®å¼€å§‹ï¼Œç»§ç»­å°†æ•°æ®åŠ è½½åˆ°å¦ä¸€ä¸ªæ•°æ®æºè¿›è¡Œè½¬æ¢ï¼Œç„¶åè½¬æ¢åŠ è½½çš„æ•°æ®ã€‚ELT ä¸ ETL åªæ˜¯ç•¥æœ‰ä¸åŒã€‚ELT çš„æ„æ€æ˜¯æå–ã€åŠ è½½ã€è½¬æ¢ã€‚æˆ‘ä»¬é¦–å…ˆå°†æ•°æ®ä»æºæ•°æ®åº“åŠ è½½åˆ°æˆ‘ä»¬çš„æ•°æ®ä»“åº“ï¼Œç„¶åå¯¹å…¶è¿›è¡Œè½¬æ¢ä»¥ä¾›æœ€ç»ˆä½¿ç”¨ã€‚æˆ‘çŸ¥é“ ETL æ˜¯ä¸€ä¸ªä¼ ç»Ÿçš„è¿‡ç¨‹ï¼ŒELT æ¯” ETL æ›´ç°ä»£ä¸€ç‚¹ï¼Œç°åœ¨åº”ç”¨å¾—æ›´å¤šã€‚

ELT é€šè¿‡è½¬æ¢æ•°æ®ä»“åº“ä¸­åŠ è½½çš„æ•°æ®æ¥å‡å°‘æˆ‘ä»¬çš„æš‚å­˜æ­¥éª¤ï¼Œè€Œä¸æ˜¯ ETLã€‚

# ä»€ä¹ˆæ˜¯åˆ†æå·¥ç¨‹ï¼Ÿ

æˆ‘æƒ³æˆ‘å¯ä»¥æŠŠåˆ†æå·¥ç¨‹æè¿°ä¸ºæ•°æ®å·¥ç¨‹å¸ˆå’Œæ•°æ®åˆ†æå¸ˆä¹‹é—´çš„æ¡¥æ¢ã€‚åŸºæœ¬ä¸Šï¼Œä»–ä»¬åœ¨æ•°æ®ä»“åº“ä¸­å¯¹æ•°æ®é›†å»ºæ¨¡ï¼Œä¸ºæ•°æ®åˆ†æå¸ˆç­‰æœ€ç»ˆç”¨æˆ·æä¾›å¹²å‡€çš„æ•°æ®é›†ã€‚åœ¨å°å‹å›¢é˜Ÿä¸­ï¼Œåˆ†æå·¥ç¨‹å¸ˆçš„èŒè´£ç”±æ•°æ®åˆ†æå¸ˆå’Œæ•°æ®å·¥ç¨‹å¸ˆå…±åŒæ‰¿æ‹…ã€‚å¦‚ä»Šï¼Œç°ä»£æ•°æ®å›¢é˜Ÿé›‡ä½£åˆ†æå·¥ç¨‹å¸ˆã€‚

![](img/8e7fdb02b0b4cd3ed840c57caf71d3ee.png)

[å›¾ç‰‡æ¥è‡ª dbt](https://www.getdbt.com/what-is-analytics-engineering/)

å¦‚æœä½ æƒ³æ·±å…¥äº†è§£åˆ†æå·¥ç¨‹ï¼Œä½ åº”è¯¥æŸ¥çœ‹ä¸‹é¢çš„é“¾æ¥ã€‚

[](https://www.getdbt.com/what-is-analytics-engineering/) [## ä»€ä¹ˆæ˜¯åˆ†æå·¥ç¨‹ï¼Ÿ

### åˆ†æå·¥ç¨‹å¸ˆå‘æœ€ç»ˆç”¨æˆ·æä¾›å¹²å‡€çš„æ•°æ®é›†ï¼Œä»¥ä¸€ç§è®©æœ€ç»ˆç”¨æˆ·èƒ½å¤Ÿå›ç­”ä»¥ä¸‹é—®é¢˜çš„æ–¹å¼å¯¹æ•°æ®è¿›è¡Œå»ºæ¨¡â€¦

www.getdbt.com](https://www.getdbt.com/what-is-analytics-engineering/) 

# ç°ä»£æ•°æ®ä»“åº“å·¥å…·:dbt

dbt è®©æˆ‘ä»¬æœ‰æœºä¼šå°†è½¯ä»¶å·¥ç¨‹æœ€ä½³å®è·µåº”ç”¨åˆ°æˆ‘ä»¬çš„æ•°æ®å»ºæ¨¡è¿‡ç¨‹ä¸­ã€‚æˆ‘ä»¬å¯ä»¥å¯¹æ•°æ®è½¬æ¢è¿‡ç¨‹è¿›è¡Œç‰ˆæœ¬æ§åˆ¶ã€‚

[](https://www.getdbt.com/) [## dbt -è½¬æ¢ä»“åº“ä¸­çš„æ•°æ®

### dbt æ˜¯ä¸€ä¸ªæ•°æ®è½¬æ¢å·¥å…·ï¼Œä½¿æ•°æ®åˆ†æå¸ˆå’Œå·¥ç¨‹å¸ˆèƒ½å¤Ÿè½¬æ¢ï¼Œæµ‹è¯•å’Œè®°å½•æ•°æ®åœ¨â€¦

www.getdbt.com](https://www.getdbt.com/) 

æˆ‘ä»¬å¯ä»¥é€šè¿‡`select`è¯­å¥è½¬æ¢æ•°æ®ä»“åº“ä¸­çš„æ•°æ®ã€‚

> [dbt æ‰§è¡Œ](https://docs.getdbt.com/docs/introduction) `[ELT](https://docs.getdbt.com/docs/introduction)` [ä¸­çš„](https://docs.getdbt.com/docs/introduction) `[T](https://docs.getdbt.com/docs/introduction)` [(æå–ã€åŠ è½½ã€è½¬æ¢)è¿‡ç¨‹â€”â€”å®ƒä¸æå–æˆ–åŠ è½½æ•°æ®ï¼Œä½†å®ƒéå¸¸æ“…é•¿è½¬æ¢å·²ç»åŠ è½½åˆ°æ‚¨çš„ä»“åº“ä¸­çš„æ•°æ®ã€‚](https://docs.getdbt.com/docs/introduction)
> 
> -å®˜æ–¹ dbt æ–‡ä»¶

å¼€å§‹å°è¯• dbt å§ï¼

# åˆ›å»ºå®éªŒç å¤´å®éªŒå®¤

å®é™…ä¸Šï¼Œæˆ‘ä¸ä¼šä¸€æ­¥ä¸€æ­¥åœ°è§£é‡Šè¿™ä¸€éƒ¨åˆ†ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„é“¾æ¥è®¿é—®å®éªŒå®¤èµ„æºã€‚æˆ‘æ›´æ„¿æ„è§£é‡Šå®éªŒå®¤çš„ä¸»è¦é€»è¾‘å’Œè¿™ä¸ªé¡¹ç›®çš„ä¸»è¦ç»„æˆéƒ¨åˆ†ã€‚

[](https://github.com/mebaysan/DBT-Training/tree/main/1-dbt-Fundamentals) [## DBT-åŸ¹è®­/1-dbt-main mebaysan/DBT åŸºç¡€-åŸ¹è®­

### åœ¨å­¦ä¹ æœ¬è¯¾ç¨‹æ—¶ï¼Œæˆ‘ä½¿ç”¨äº† dbt CLI è€Œä¸æ˜¯ dbt Cloudã€‚æˆ‘é€‰æ‹© PostgreSQL ä½œä¸ºä»“åº“ï¼Œè€Œä¸æ˜¯â€¦

github.com](https://github.com/mebaysan/DBT-Training/tree/main/1-dbt-Fundamentals) 

æœ¬å®éªŒå®¤æœ‰ 4 ä¸ªæ ¸å¿ƒæ–‡ä»¶:`loader_script.py`ã€`requirements.txt`ã€`Dockerfile`å’Œ`docker-compose.yml`ã€‚

æ–‡ä»¶æ­£åœ¨ä¸ºæˆ‘ä»¬çš„å®éªŒå®¤æ‰§è¡Œ ELã€æå–å’ŒåŠ è½½è¿‡ç¨‹ã€‚åŸºæœ¬ä¸Šï¼Œå®ƒä» CSV æ–‡ä»¶ä¸­è¯»å–æ•°æ®ï¼Œç„¶åå°†æ•°æ®åŠ è½½åˆ°æˆ‘ä»¬å·²ç»åœ¨`docker-compose.yml`æ–‡ä»¶ä¸­åˆ›å»ºçš„æ•°æ®ä»“åº“ä¸­ã€‚

[](https://github.com/mebaysan/DBT-Training/blob/main/1-dbt-Fundamentals/lab/loader_script.py) [## DBT-åŸ¹è®­/loader_script.py åœ¨æ¢…è´æ¡‘/DBT-åŸ¹è®­

### æ­¤æ–‡ä»¶åŒ…å«åŒå‘ Unicode æ–‡æœ¬ï¼Œå…¶è§£é‡Šæˆ–ç¼–è¯‘å¯èƒ½ä¸ä¸‹é¢æ˜¾ç¤ºçš„ä¸åŒâ€¦

github.com](https://github.com/mebaysan/DBT-Training/blob/main/1-dbt-Fundamentals/lab/loader_script.py) 

åœ¨`docker-compose.yml`æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å‡†å¤‡äº†å®éªŒå®¤ã€‚Docker é¦–å…ˆåˆ›å»ºä¸€ä¸ªåä¸º`WarehouseDB`çš„ PostgreSQL æ•°æ®åº“ã€‚ç„¶åå¯åŠ¨`loader`æœåŠ¡ï¼Œå°†æ•°æ®åŠ è½½åˆ°`WarehouseDB`ä¸­ã€‚

[](https://github.com/mebaysan/DBT-Training/blob/main/1-dbt-Fundamentals/lab/docker-compose.yml) [## DBT-Training/docker-compose . yml at main mebaysan/DBT-åŸ¹è®­

### æ­¤æ–‡ä»¶åŒ…å«åŒå‘ Unicode æ–‡æœ¬ï¼Œå…¶è§£é‡Šæˆ–ç¼–è¯‘å¯èƒ½ä¸ä¸‹é¢æ˜¾ç¤ºçš„ä¸åŒâ€¦

github.com](https://github.com/mebaysan/DBT-Training/blob/main/1-dbt-Fundamentals/lab/docker-compose.yml) 

`loader`æœåŠ¡ä»`Dockerfile`å¼€å§‹æ„å»ºã€‚é¦–å…ˆï¼Œå®ƒå®‰è£…éœ€æ±‚ï¼Œç„¶åå¯åŠ¨åˆ°`WarehouseDB`çš„åŠ è½½è¿‡ç¨‹ã€‚æœ€åï¼Œå®ƒåˆ›å»ºäº† 3 ä¸ªæ¨¡å¼ï¼›`transformed`ã€`jaffle_shop`å’Œ`stripe`ã€‚ç„¶åï¼Œå°†æ•°æ®åŠ è½½åˆ°`jaffle_shop`å’Œ`stripe`ä¸­ã€‚

[](https://github.com/mebaysan/DBT-Training/blob/main/1-dbt-Fundamentals/lab/Dockerfile) [## DBT ----åœ¨æ¢…å› æ¢…æ‹œæ¡‘/DBT çš„åŸ¹è®­/æ¡£æ¡ˆ----åŸ¹è®­

### æ­¤æ–‡ä»¶åŒ…å«åŒå‘ Unicode æ–‡æœ¬ï¼Œå…¶è§£é‡Šæˆ–ç¼–è¯‘å¯èƒ½ä¸ä¸‹é¢æ˜¾ç¤ºçš„ä¸åŒâ€¦

github.com](https://github.com/mebaysan/DBT-Training/blob/main/1-dbt-Fundamentals/lab/Dockerfile) 

æˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨ Docker åˆ›å»ºçš„å®éªŒå®¤æ¥æ¨¡æ‹Ÿæˆ‘ä»¬çš„ ELT ç¨‹åºã€‚ä¸ºæ­¤ï¼Œæˆ‘åœ¨`lab`æ–‡ä»¶å¤¹ä¸­å®šä½æˆ‘çš„ç»ˆç«¯ã€‚

![](img/7065c466cb3b9b2d46701d97bc61a7d8.png)

ä½œè€…å›¾ç‰‡

æˆ‘å¯ä»¥æ‰§è¡Œä¸‹é¢çš„ä»£ç æ¥è¿è¡Œå®éªŒå®¤ã€‚

```
docker-compose up -d
```

![](img/1df0a24f1ecc0f3f06ebd4bf031802eb.png)

ä½œè€…å›¾ç‰‡

ç°åœ¨ï¼Œå¦‚æœæˆ‘è¿æ¥åˆ°`WarehouseDB`æ•°æ®åº“ï¼Œæˆ‘å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„åŠ è½½å™¨æœåŠ¡åˆ›å»ºçš„æ¨¡å¼ã€‚

![](img/2f614a669be4201efe833c5182734a99.png)

ä½œè€…å›¾ç‰‡

ç°åœ¨ï¼Œè®©æˆ‘ä»¬å¼€å§‹ä¸ dbt ä¼šé¢ã€‚

# dbt çš„ç¬¬ä¸€æ­¥

æœ‰å‡ ç§[å®‰è£… dbt çš„æ–¹æ³•](https://docs.getdbt.com/dbt-cli/install/overview)ã€‚æˆ‘é€‰æ‹©ä½¿ç”¨ pip æ¥å®‰è£…å®ƒã€‚ç„¶åï¼Œæˆ‘å¯ä»¥ä½¿ç”¨ dbt CLI åˆ›å»ºä¸€ä¸ªç©ºçš„ dbt é¡¹ç›®ã€‚

```
dbt init
```

![](img/1d11e15e8ca4026c528a90f6a041ac1b.png)

ä½œè€…å›¾ç‰‡

æˆ‘ä»¬åœ¨ä¸‹å›¾ä¸­çœ‹åˆ°ç”±`dbt init`å‘½ä»¤åˆ›å»ºçš„é»˜è®¤æ–‡ä»¶ã€‚

![](img/19b73764890eabeea0a6714a506e52be.png)

ä½œè€…å›¾ç‰‡

## æ ¸å¿ƒ dbt ç»„ä»¶

`dbt_project.yml`æ–‡ä»¶ä¿å­˜äº†æˆ‘ä»¬çš„ dbt é¡¹ç›®çš„æ ¸å¿ƒè®¾ç½®ã€‚

![](img/74a48810eee24b3132e51d53a1aff549.png)

ä½œè€…å›¾ç‰‡

æ–‡ä»¶å¤¹å­˜æ”¾ç€æˆ‘ä»¬çš„æ¨¡å‹ã€‚åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ä¸­ï¼Œæˆ‘ä»¬ç”¨`SELECT`è¯­å¥ç¼–å†™ SQL æ¨¡å‹ã€‚ç„¶å dbt åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹æŸ¥æ‰¾ï¼Œå¹¶å°†æ•°æ®è½¬æ¢åˆ°æ•°æ®ä»“åº“ä¸­ã€‚åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†åªä½¿ç”¨`models`ã€‚

æˆ‘ä»¬è¿˜æœ‰å¦ä¸€ä¸ªéå¸¸é‡è¦çš„æ–‡ä»¶ï¼Œå®ƒä¿å­˜äº† dbt çš„æ•°æ®åº“å‡­è¯ã€‚è¯¥æ–‡ä»¶ä½äº`~/.dbt/profiles.yml`ä¸­ã€‚åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å¿…é¡»è®¾ç½®æˆ‘ä»¬çš„æ•°æ®åº“å‡­è¯ï¼Œå¹¶ä¸”æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°åœ¨ç”Ÿäº§å’Œå¼€å‘ç¯å¢ƒä¹‹é—´è¿›è¡Œè½¬æ¢ã€‚

![](img/81c0103c90a41246e9ea6c2f0cb8b3da.png)

ä½œè€…å›¾ç‰‡

ç°åœ¨ï¼Œæˆ‘è¦ä¸ºæˆ‘ä»¬çš„`WarehouseDB`æ›´æ”¹è¿™ä¸ªæ–‡ä»¶ã€‚

![](img/e48f4746d6972874ca50831000affd82.png)

ä½œè€…å›¾ç‰‡

dbt è‡ªåŠ¨å°†è½¬æ¢åçš„æ•°æ®åŠ è½½åˆ°æˆ‘ä»¬åœ¨è¯¥æ–‡ä»¶ä¸­è®¾ç½®çš„æ¨¡å¼ä¸­ã€‚

## åˆ›å»ºæˆ‘ä»¬çš„ç¬¬ä¸€ä¸ª dbt æ¨¡å‹

æˆ‘å°†åœ¨`models`æ–‡ä»¶å¤¹ä¸‹åˆ›å»ºä¸€ä¸ªåŸºæœ¬çš„`sql` SQL æ–‡ä»¶:`first_model.sql`ã€‚æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªæ¨¡å‹æ¥è¿è¡Œä¸‹é¢çš„çº¯ SQL æŸ¥è¯¢ã€‚

```
select 
o."STATUS" as "ORDERSTATUS", p."PAYMENTMETHOD", p."STATUS" as "PAYMENTSTATUS", count(o."ID") as "ORDERCOUNT"
from jaffle_shop.orders o 
left join stripe.payments p on o."ID" = p."ORDERID" 
group by o."STATUS",  p."PAYMENTMETHOD", p."STATUS"
```

è¯¥æŸ¥è¯¢è¿”å›ä»¥ä¸‹ç»“æœã€‚

![](img/fdc4339be79462de304e1f15ae31eacd.png)

ä½œè€…å›¾ç‰‡

åœ¨ dbt æ¨¡å‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨é€šè¿‡ä½¿ç”¨`WITH`å­å¥åˆ›å»ºçš„ä¸´æ—¶è¡¨ã€‚æˆ‘ä»¬åœ¨ä¸‹é¢çœ‹åˆ°äº†å¯¹æˆ‘ä»¬çš„`first_model.sql`æ¨¡å‹çš„æŸ¥è¯¢ã€‚

```
with orders as (select * from jaffle_shop."orders"),payments as (select * from stripe."payments"),final as (selecto."STATUS" as "ORDERSTATUS", p."PAYMENTMETHOD", p."STATUS" as "PAYMENTSTATUS", count(o."ID") as "ORDERCOUNT"from orders oleft join payments p on o."ID" = p."ORDERID"group by o."STATUS",  p."PAYMENTMETHOD", p."STATUS")select * from final
```

ç„¶åæˆ‘ä»¬è¿è¡Œ`dbt run`æ¥è¿è¡Œæ‰€æœ‰çš„è½¬æ¢æ¨¡å‹ã€‚

![](img/f832c7783c4a4e5b82774e032dcc0915.png)

ä½œè€…å›¾ç‰‡

dbt å°†æ‰€æœ‰æ¨¡å‹è½¬æ¢æˆè§†å›¾ã€‚æˆ‘ä»¬å¯ä»¥åœ¨æˆ‘ä»¬çš„`WarehouseDB`æ•°æ®åº“ä¸­çš„`first_model`è§†å›¾ä¸‹çœ‹åˆ°æˆ‘ä»¬çš„è½¬æ¢æ¨¡å‹ã€‚

![](img/e1273b52211fc6e9e4a6ba0c483379d1.png)

ä½œè€…å›¾ç‰‡

## æ›´æ”¹ dbt å‹å·çš„é…ç½®

å¦‚æœæˆ‘ä»¬æƒ³å°†æˆ‘ä»¬çš„æ¨¡å‹åŠ è½½åˆ°ä¸€ä¸ªè¡¨ä¸­ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ¨¡å‹æ–‡ä»¶çš„é¡¶éƒ¨ä½¿ç”¨`config`ã€‚

```
{{
config(
materialized = "table"
)
}}...
```

ç°åœ¨ï¼Œæˆ‘åœ¨æ‰§è¡Œäº†`dbt run`ä¹‹åæŸ¥çœ‹æ•°æ®åº“ã€‚

![](img/73ac4afbe6516311fc6b015394a0f93b.png)

ä½œè€…å›¾ç‰‡

å¯ä»¥æŸ¥çœ‹[è¿™é‡Œ](https://docs.getdbt.com/reference/model-configs)äº†è§£ dbt è½¦å‹ä¸Šçš„å…¶ä»–é…ç½®ã€‚

## å‚è€ƒ dbt æ¨¡å‹

æˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨`{{ref('model')}}`åœ¨ä¸åŒçš„ dbt æ¨¡å‹ä¸­ä½¿ç”¨ dbt æ¨¡å‹ã€‚æˆ‘è¦æ”¹è¿›æˆ‘çš„æ¨¡å‹ã€‚

![](img/950339754b7338445107694817af49f0.png)

ä½œè€…å›¾ç‰‡

åœ¨`orders.sql`ä¸­ï¼Œæˆ‘ä»`orders`è¡¨ä¸­æå–ä¸€äº›åˆ—æ¥åˆ›å»ºæˆ‘çš„æœ€ç»ˆæ¨¡å‹ã€‚

```
selecto."ID", o."STATUS" as "ORDERSTATUS"from jaffle_shop."orders" o
```

åœ¨`payments.sql`ä¸­ï¼Œæˆ‘ä»`payments`è¡¨ä¸­æå–æ‰€éœ€çš„åˆ—æ¥åˆ›å»ºæˆ‘çš„æœ€ç»ˆæ¨¡å‹ã€‚

```
selectp."PAYMENTMETHOD", p."STATUS" as "PAYMENTSTATUS", p."ORDERID"from stripe."payments" p
```

ç„¶åï¼Œæˆ‘åˆ›å»ºäº†`final_model.sql`ã€‚åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œæˆ‘ä½¿ç”¨äº†ä¸Šé¢åˆ›å»ºçš„æ¨¡å‹ã€‚

```
with orders as (select * from {{ref('orders')}}),payments as (select * from {{ref('payments')}}), final as (selecto."ORDERSTATUS", p."PAYMENTMETHOD", p."PAYMENTSTATUS", count(o."ID") as "ORDERCOUNT"from orders oleft join payments p on o."ID" = p."ORDERID"group by o."ORDERSTATUS",  p."PAYMENTMETHOD", p."PAYMENTSTATUS")select * from final
```

æˆ‘ä»¬çœ‹åˆ°æ•°æ®é€šè¿‡ä½¿ç”¨æˆ‘ä»¬åˆ›å»ºå¹¶åŠ è½½åˆ°ä»“åº“ä¸­çš„æ¨¡å‹è¿›è¡Œäº†è½¬æ¢ã€‚

![](img/6449cbb917f9c50f7f46265bcace227a.png)

ä½œè€…å›¾ç‰‡

# æœ€å

å¸Œæœ›ä½ å–œæ¬¢ã€‚æˆ‘å¾ˆå–œæ¬¢å†™ä½œã€‚å­¦ä¹ æ–°äº‹ç‰©å¯¹æˆ‘æ¥è¯´æ˜¯å¦‚æ­¤çš„æ„‰å¿«ã€‚å°¤å…¶æ˜¯ï¼Œå¦‚æœæˆ‘å¯ä»¥ç”¨å®ƒä»¬æ¥èµšé’±ğŸ™ƒæˆ‘å¯¹ dbt å¾ˆé™Œç”Ÿã€‚æˆ‘ä¼šç»§ç»­å­¦ä¹  dbtã€‚æˆ‘è¿˜å°†æ‰©å±•æˆ‘åˆ›å»ºçš„å›è´­ï¼Œä»¥éµå¾ªå®˜æ–¹çš„ [dbt åŸ¹è®­è®¡åˆ’](https://courses.getdbt.com/collections)ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„é“¾æ¥è®¿é—®å›è´­ã€‚

[](https://github.com/mebaysan/DBT-Training) [## GitHub - mebaysan/DBT-Training:æˆ‘åˆ›å»ºäº†è¿™ä¸ª repo æ¥éµå¾ª DBT çš„å®˜æ–¹åŸ¹è®­è·¯å¾„

### æˆ‘åˆ›å»ºäº†è¿™ä¸ªå›è´­éµå¾ª DBT dbt åŸºç¡€ 1-dbt-åŸºç¡€æ–‡ä»¶å¤¹çš„å®˜æ–¹åŸ¹è®­è·¯å¾„æ˜¯ä¸ºâ€¦

github.com](https://github.com/mebaysan/DBT-Training) 

é—®å€™