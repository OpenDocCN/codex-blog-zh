<html>
<head>
<title>Pre-Commit Hooks DevOps Engineer Should Know To Control Kubernetes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">DevOps工程师应该知道如何控制Kubernetes</h1>
<blockquote>原文：<a href="https://medium.com/codex/pre-commit-hooks-devops-engineer-should-know-to-control-kubernetes-febf5557df0b?source=collection_archive---------3-----------------------#2022-04-04">https://medium.com/codex/pre-commit-hooks-devops-engineer-should-know-to-control-kubernetes-febf5557df0b?source=collection_archive---------3-----------------------#2022-04-04</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/ef72232818bc241e2c620debb6861746.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*48oKSuGErQr7NQUv1wzdDg.jpeg"/></div><figcaption class="im in et er es io ip bd b be z dx translated">照片由<a class="ae iq" href="https://unsplash.com/@itsliamtucker?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> <em class="ir">利亚姆塔克</em> </a> <em class="ir">上</em> <a class="ae iq" href="https://unsplash.com/s/photos/security?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> <em class="ir"> Unsplash </em> </a></figcaption></figure><p id="6ad5" class="pw-post-body-paragraph is it hi iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp hb bi translated">一般来说，所有公司都在寻求提高各个层面的生产率:人力、基础设施、流程等。通常，这种生产率是通过增加自动化流程来促进和提高生产速度来实现的。这种自动化需要对历史上使用的概念进行演变、调整甚至完全转变。这包括安全策略的实施和控制。</p><p id="ef46" class="pw-post-body-paragraph is it hi iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp hb bi translated">事实上，自从基于敏捷性和灵活性的新工作方法(如DevOps)出现以来，一些安全概念不得不适应基础架构组件的开发和管理步伐。今天，最好的安全实践之一是在集成链中尽可能早地移动这些控制点，以便尽快检测到任何值得特别注意的异常情况。</p><h1 id="01ec" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">你为什么要转移左边的安全？</h1><p id="c80c" class="pw-post-body-paragraph is it hi iu b iv ko ix iy iz kp jb jc jd kq jf jg jh kr jj jk jl ks jn jo jp hb bi translated">术语“左移”是由DevSecOps方法通过增加开发、安全和操作团队之间的协作而引入的。其思想是通过将安全性和测试过程移到SDLC的传统线性表示的左侧，从开发周期的开始就保证应用程序的安全性。</p><p id="8de1" class="pw-post-body-paragraph is it hi iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp hb bi translated">这种方法多年来一直被认为是最佳开发实践，自从DevOps方法出现以来，由于其使用和配置的简单性以及在复杂项目(如使用Terraform、Ansible或Kubernetes进行基础设施管理)的团队协作方面的难以置信的好处，这种方法得到了广泛采用。</p><figure class="ku kv kw kx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="er es kt"><img src="../Images/03d307916a9bdaaa47bf1818288e66f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6-lUeN0ux7ZR3mS0BZ-mMQ.png"/></div></div><figcaption class="im in et er es io ip bd b be z dx translated"><a class="ae iq" href="https://snyk.io/learn/shift-left-security/" rel="noopener ugc nofollow" target="_blank">左移安全性:入门最佳实践</a></figcaption></figure><p id="71a9" class="pw-post-body-paragraph is it hi iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp hb bi translated">强制在YAML定义文件开发级别和它们的内容和配置级别使用标准有助于它们的阅读、采用和维护。今天任何项目都应该实现的三个原则。</p><p id="6709" class="pw-post-body-paragraph is it hi iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp hb bi translated">安全性左移的目的是设计具有集成安全性最佳实践的软件，并在开发过程中尽可能早地检测和解决潜在的安全问题和漏洞。这使得解决安全问题更容易、更快、更经济。</p><h1 id="f941" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">怎么左移？</h1><p id="058a" class="pw-post-body-paragraph is it hi iu b iv ko ix iy iz kp jb jc jd kq jf jg jh kr jj jk jl ks jn jo jp hb bi translated"><a class="ae iq" href="https://pre-commit.com/" rel="noopener ugc nofollow" target="_blank">预提交</a>是一个命令行工具，是该系列工具的一部分，用于通过在每次提交后添加自动控制点来左移某些安全方面。</p><p id="5b8e" class="pw-post-body-paragraph is it hi iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp hb bi translated">这使得在集成管道中尽早检测和控制任何异常成为可能，从而在投入生产之前对其进行纠正。</p><p id="4265" class="pw-post-body-paragraph is it hi iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp hb bi translated">为此，需要三个步骤:</p><ul class=""><li id="084c" class="lc ld hi iu b iv iw iz ja jd le jh lf jl lg jp lh li lj lk bi translated">预提交要求安装在您的机器上</li><li id="15d3" class="lc ld hi iu b iv ll iz lm jd ln jh lo jl lp jp lh li lj lk bi translated">名为“”的配置文件。pre-commit-config.yaml”必须在Git项目的根目录下创建，并使用钩子进行配置</li><li id="ecb1" class="lc ld hi iu b iv ll iz lm jd ln jh lo jl lp jp lh li lj lk bi translated">Git项目需要在本地配置，以便在每次提交时自动执行命令</li></ul><figure class="ku kv kw kx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="er es lq"><img src="../Images/87578dab7ab4b30567ab425aa3d312f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6beL_JpmIbzTEMsNLN5P0g.png"/></div></div></figure><h1 id="d485" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">重要考虑事项</h1><p id="313b" class="pw-post-body-paragraph is it hi iu b iv ko ix iy iz kp jb jc jd kq jf jg jh kr jj jk jl ks jn jo jp hb bi translated">正如您在上一节中所理解的，预提交命令和Git项目必须在本地配置为自动运行。这不是可以从远程源控制器强制执行的配置。这需要在入职阶段进行项目配置，以确保其应用。因此，需要文件来传播信息并确保其被采纳。</p><p id="f0ea" class="pw-post-body-paragraph is it hi iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp hb bi translated">根据上下文，通过开发一个环境配置脚本(在这种情况下，所有团队成员的笔记本电脑)或者甚至创建、共享和鼓励团队使用一个带有所有必要开发工具的公共容器映像，仍然可以实现其使用的自动化。这种做法有很多优点，特别是在新员工入职时，最大限度地减少了配置开发环境所需的操作。</p><p id="56da" class="pw-post-body-paragraph is it hi iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp hb bi translated">然而，如果这不适用或者看起来太复杂，总是有可能将这些控件进一步向下移动到集成链中，从而在部署之前自动使用它们。</p><h1 id="c3e5" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">您可以使用哪些钩子来控制Kubernetes资源？</h1><p id="104b" class="pw-post-body-paragraph is it hi iu b iv ko ix iy iz kp jb jc jd kq jf jg jh kr jj jk jl ks jn jo jp hb bi translated">本节列出了一组钩子，这些钩子可以免费使用，并且可以通过预提交很容易地安装和使用。这是一个固执己见的列表，显然可以根据上下文用其他钩子来补充。为了便于阅读，我们已主动将该名单缩减至Kubernetes生态系统。</p><p id="4e4e" class="pw-post-body-paragraph is it hi iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp hb bi translated">下面是一个预提交扩展列表，有助于在集成管道中尽快检查Kubernetes资源的开发和维护:</p><ul class=""><li id="47a4" class="lc ld hi iu b iv iw iz ja jd le jh lf jl lg jp lh li lj lk bi translated"><a class="ae iq" href="https://github.com/pre-commit/pre-commit-hooks#check-merge-conflict" rel="noopener ugc nofollow" target="_blank">检查-合并-冲突</a>在提交任何事情之前检查合并冲突</li><li id="9103" class="lc ld hi iu b iv ll iz lm jd ln jh lo jl lp jp lh li lj lk bi translated"><a class="ae iq" href="https://github.com/pre-commit/pre-commit-hooks#trailing-whitespace" rel="noopener ugc nofollow" target="_blank">尾随空格</a>，将代码从无用的空格中清除</li><li id="3f20" class="lc ld hi iu b iv ll iz lm jd ln jh lo jl lp jp lh li lj lk bi translated"><a class="ae iq" href="https://github.com/pre-commit/pre-commit-hooks#check-added-large-files" rel="noopener ugc nofollow" target="_blank">检查添加的大文件</a>以控制存储在您的存储库中的文件的大小</li><li id="4302" class="lc ld hi iu b iv ll iz lm jd ln jh lo jl lp jp lh li lj lk bi translated">确保文件以一个新行结束，并且只有一个新行</li><li id="36df" class="lc ld hi iu b iv ll iz lm jd ln jh lo jl lp jp lh li lj lk bi translated"><a class="ae iq" href="https://github.com/adrienverge/yamllint" rel="noopener ugc nofollow" target="_blank"> Yamllint </a>在每次提交前自动识别代码的格式错误，这对于规范代码和方便阅读非常重要</li><li id="c0d8" class="lc ld hi iu b iv ll iz lm jd ln jh lo jl lp jp lh li lj lk bi translated"><a class="ae iq" href="https://github.com/lyz-code/yamlfix" rel="noopener ugc nofollow" target="_blank"> Yamlfix </a>自动化格式修正</li><li id="d421" class="lc ld hi iu b iv ll iz lm jd ln jh lo jl lp jp lh li lj lk bi translated">根据最佳开发实践和定制规则，检查Kubernetes定义文件的符合性</li><li id="1311" class="lc ld hi iu b iv ll iz lm jd ln jh lo jl lp jp lh li lj lk bi translated"><a class="ae iq" href="https://github.com/Agilicus/pre-commit-hook-k8svalidate" rel="noopener ugc nofollow" target="_blank"> K8svalidate </a>根据使用的Kubernetes版本检查Kubernetes定义文件的符合性</li><li id="81b3" class="lc ld hi iu b iv ll iz lm jd ln jh lo jl lp jp lh li lj lk bi translated"><a class="ae iq" href="https://github.com/Yelp/detect-secrets" rel="noopener ugc nofollow" target="_blank"> Detect-secrets </a>检测任何敏感数据，避免它们存储在代码中</li></ul><p id="63cd" class="pw-post-body-paragraph is it hi iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp hb bi translated">这些挂钩中的大多数也适用于其他上下文。根据项目的性质，可以添加其他几个挂钩来控制文件及其内容的格式。然而，保持一个简短的清单，以尽量减少这些对你的生产力的影响。</p><p id="3692" class="pw-post-body-paragraph is it hi iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp hb bi translated">这里有一个预提交配置文件，可以在您的Kubernetes项目上快速测试这些钩子:</p><pre class="ku kv kw kx fd lr ls lt lu aw lv bi"><span id="4f3a" class="lw jr hi ls b fi lx ly l lz ma">---<br/>repos:<br/>  - repo: https://github.com/adrienverge/yamllint.git<br/>    rev: v1.17.0<br/>    hooks:<br/>      - id: yamllint<br/>        args: [-c=.yamllint]<br/>  - repo: https://github.com/pre-commit/pre-commit-hooks<br/>    rev: v4.1.0<br/>    hooks:<br/>      - id: check-merge-conflict<br/>      - id: trailing-whitespace<br/>      - id: check-added-large-files<br/>      - id: end-of-file-fixer<br/>        args: [--no-ensure-ascii, --autofix]<br/>  - repo: https://github.com/bridgecrewio/checkov.git<br/>    rev: 2.0.975<br/>    hooks:<br/>      - id: checkov<br/>        args: [-d .]<br/>  - repo: https://github.com/Agilicus/pre-commit-hook-k8svalidate.git<br/>    rev: v0.0.8<br/>    hooks:<br/>      - id: k8svalidate<br/>        files: .yaml$<br/>  - repo: https://github.com/Yelp/detect-secrets<br/>    rev: v1.2.0<br/>    hooks:<br/>      - id: detect-secrets</span></pre><p id="9174" class="pw-post-body-paragraph is it hi iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp hb bi translated">复制此文件的内容，并将其粘贴到名为“”的文件中。项目根文件夹中的“pre-commit-config.yaml”。然后运行预提交命令来获得结果！</p><figure class="ku kv kw kx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="er es mb"><img src="../Images/fa403d494b6c747b85e65773ac32aa33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NsaS7KnAwVzTIIhcwVYh-g.png"/></div></div><figcaption class="im in et er es io ip bd b be z dx translated">成功的预提交挂钩示例</figcaption></figure><h1 id="e1ad" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">下一个？</h1><p id="69e1" class="pw-post-body-paragraph is it hi iu b iv ko ix iy iz kp jb jc jd kq jf jg jh kr jj jk jl ks jn jo jp hb bi translated">在本文中，我们列出了一组预提交挂钩，对于任何管理一个或多个Kubernetes集群的人来说都非常有用。当然，还有许多其他适应不同环境的方法。例如，DevOps工程师会对控制<a class="ae iq" href="https://github.com/fortman/pre-commit-prometheus" rel="noopener ugc nofollow" target="_blank"> Prometheus配置</a>甚至格式化规则的扩展，或者<a class="ae iq" href="https://github.com/ashwin153/pre-commit-vagrant" rel="noopener ugc nofollow" target="_blank">浮动文件控制</a>等感兴趣。</p><p id="aa06" class="pw-post-body-paragraph is it hi iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp hb bi translated">可以控制的东西是没有限制的，但是仍然有必要衡量这些挂钩的积累对一个人的生产力的影响以及它们带来的好处。</p><p id="22a1" class="pw-post-body-paragraph is it hi iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp hb bi translated">有关预提交的更多信息，请参考以下链接:</p><ul class=""><li id="5f4e" class="lc ld hi iu b iv iw iz ja jd le jh lf jl lg jp lh li lj lk bi translated"><a class="ae iq" href="https://pre-commit.com/" rel="noopener ugc nofollow" target="_blank">预提交网站</a></li><li id="ccfd" class="lc ld hi iu b iv ll iz lm jd ln jh lo jl lp jp lh li lj lk bi translated"><a class="ae iq" href="https://snyk.io/learn/shift-left-security/" rel="noopener ugc nofollow" target="_blank">左移安全性:入门最佳实践</a></li></ul><h1 id="02b6" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">关于作者</h1><p id="af7d" class="pw-post-body-paragraph is it hi iu b iv ko ix iy iz kp jb jc jd kq jf jg jh kr jj jk jl ks jn jo jp hb bi translated">Hicham Bouissoumer  —现场可靠性工程师(SRE) — DevOps</p><p id="f061" class="pw-post-body-paragraph is it hi iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp hb bi translated"><a class="ae iq" href="https://www.linkedin.com/in/nicolas-giron-6129b0a1/" rel="noopener ugc nofollow" target="_blank"> Nicolas Giron </a> —现场可靠性工程师(SRE) — DevOps</p></div></div>    
</body>
</html>