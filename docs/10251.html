<html>
<head>
<title>TryHackMe: RootMe</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">TryHackMe: RootMe</h1>
<blockquote>原文：<a href="https://medium.com/codex/tryhackme-rootme-b40be1f19f29?source=collection_archive---------15-----------------------#2022-12-14">https://medium.com/codex/tryhackme-rootme-b40be1f19f29?source=collection_archive---------15-----------------------#2022-12-14</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/df88611cd11d1e0ddba62d8f2d6de1d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Hc1rmgIo8Miv3pv7WnzXWw.png"/></div></div></figure><p id="4478" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Rootme是一个简单的TryHackMe机器，我们将绕过文件上传过滤器，利用SUID来提升系统权限。</p></div><div class="ab cl jo jp gp jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="hb hc hd he hf"><p id="a26c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">像往常一样，在TryHackMe中，我们必须连接到VPN或使用攻击箱。我会选择VPN。我们按下启动机器按钮，一分钟后，他们给我们显示IP地址。现在，我们继续使用Nmap进行初始识别:</p><pre class="jv jw jx jy fd jz ka kb bn kc kd bi"><span id="127f" class="ke kf hi ka b be kg kh l ki kj">nmap -p- -sV -Pn $IP</span></pre><p id="fcb6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">带连字符的-p参数表示扫描所有端口,-sV参数表示对使用的版本进行指纹识别，而-Pn参数表示扫描机器，即使它不响应ping。</p><figure class="jv jw jx jy fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kk"><img src="../Images/0c6f549143c69c2dd1a6235f7ca56778.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bbA7-usZHh3ULdhfBa9M8A.png"/></div></div></figure><p id="f4c4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们可以看到机器上几乎没有打开的服务，只有SSH和一个web服务器。让我们深入研究一下web服务器。</p><p id="d82c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">网络服务器枚举</strong></p><p id="1e10" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">模糊化目录后，我们发现了几个有趣的条目:</p><figure class="jv jw jx jy fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kl"><img src="../Images/36ed373257e41bc6258c1faeb1c32573.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WeWmanicCq7WZi1XL0-lgQ.png"/></div></div></figure><p id="2439" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在/panel中，我们找到一个文件上传表单。它似乎不允许用。php扩展。我们可以尝试其他扩展。</p><figure class="jv jw jx jy fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es km"><img src="../Images/0c5ac3b70c6cae0135006aa49570b73e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zWSQR7acjIpCSv_k0JCg-w.png"/></div></div></figure><p id="ab39" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们的首要任务应该是找出服务器允许的扩展名。我将使用BurpSuite的入侵者，虽然它可以简单地通过在上传中尝试不同的扩展来完成。</p><figure class="jv jw jx jy fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kn"><img src="../Images/24cfb9e2fa61f502b0b97183d7fefb91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l7PiKnxoSievb7HU9a78qg.png"/></div></div></figure><p id="e262" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，我们添加一个常见扩展的单词列表，然后发起攻击。</p><figure class="jv jw jx jy fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ko"><img src="../Images/83cc94614f5b5fd7967b8243b70af8ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eBO4t4Tu4B0h_IhIhdurig.png"/></div></div></figure><p id="6c14" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这种情况下，似乎我们可以上传除php之外的任何扩展名的文件。我们需要检查服务器是否将任何其他扩展作为php代码执行。对于这个任务，我们可以访问所有带有dangeroues扩展名的文件，我们可以看到. php5和。phtml作为php执行。</p><figure class="jv jw jx jy fd ij er es paragraph-image"><div class="er es kp"><img src="../Images/0642ea178f764aeab3731348f31ccfc7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1384/format:webp/1*boRZBDFA_znEH7w-MlkM0w.png"/></div></figure><p id="8919" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，我们可以通过修改扩展将任何PHP web shell作为c99或类似的文件上传到服务器。为了方便起见，我将上传PentestMonkey反向shell来连接到我的机器，而不是使用web shell。</p><div class="kq kr ez fb ks kt"><a href="https://github.com/pentestmonkey/php-reverse-shell" rel="noopener  ugc nofollow" target="_blank"><div class="ku ab dw"><div class="kv ab kw cl cj kx"><h2 class="bd hj fi z dy ky ea eb kz ed ef hh bi translated">GitHub-pentest monkey/PHP-reverse-shell</h2><div class="la l"><h3 class="bd b fi z dy ky ea eb kz ed ef dx translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="lb l"><p class="bd b fp z dy ky ea eb kz ed ef dx translated">github.com</p></div></div><div class="lc l"><div class="ld l le lf lg lc lh io kt"/></div></div></a></div><p id="9114" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要使用这个web shell，我们需要修改与连接的IP和端口对应的两行代码。在我的例子中，我使用端口443作为监听器和我的TryHackMe机器的IP。我们可以使用以下命令打开监听器:</p><pre class="jv jw jx jy fd jz ka kb bn kc kd bi"><span id="f386" class="ke kf hi ka b be kg kh l ki kj">nc -lvnp 443</span></pre><p id="434e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，我们只需要上传我们的web shell并访问文件来接收连接。</p><figure class="jv jw jx jy fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es li"><img src="../Images/ef3ec241567b3df39e83c38a3d793093.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DlGG-JwPYpX6mwwNyQpkVg.png"/></div></div></figure><p id="76c1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">正如我们所看到的，我们作为<strong class="is hj"> www-data </strong>用户获得了命令执行权。是时候看看我们是否可以转向另一个用户并提升系统中的权限了。</p><p id="1b72" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先，我们将测试通常的嫌疑人的能力，SUID，作为另一个用户的可执行命令等。我们将从使用以下命令检查SUID活动的二进制文件开始:</p><pre class="jv jw jx jy fd jz ka kb bn kc kd bi"><span id="df97" class="ke kf hi ka b be kg kh l ki kj">find / -perm /4000 2&gt; /dev/null</span></pre><p id="ab2d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在结果中，我们将看到/bin/python，这是一个已知的gtfobin，它允许我们通过执行以下命令序列来提升权限:</p><pre class="jv jw jx jy fd jz ka kb bn kc kd bi"><span id="551a" class="ke kf hi ka b be kg kh l ki kj">python -c 'import os; os.execl("/bin/sh", "sh", "-p")'</span></pre><p id="f7c1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，我们可以简单地执行该命令，并获得一个具有根组权限的shell。</p><figure class="jv jw jx jy fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lj"><img src="../Images/12bb0a10ad22459ba08b613443b713dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WmltLszdDpzisCrSe4DT-g.png"/></div></div><figcaption class="lk ll et er es lm ln bd b be z dx translated"><strong class="bd lo"> PWNed！</strong></figcaption></figure></div><div class="ab cl jo jp gp jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="hb hc hd he hf"><p id="9287" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我希望你喜欢我的文章，并发现我的内容有用。下一篇文章再见。</p></div></div>    
</body>
</html>