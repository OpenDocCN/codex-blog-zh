<html>
<head>
<title>Why the Raptors Lost: Levering Python and Pulp to Make Automated Decisions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为什么迅猛龙失败了:利用Python和Pulp进行自动化决策</h1>
<blockquote>原文：<a href="https://medium.com/codex/levering-pulp-to-make-automated-decisions-b40cc55b946b?source=collection_archive---------12-----------------------#2021-07-02">https://medium.com/codex/levering-pulp-to-make-automated-decisions-b40cc55b946b?source=collection_archive---------12-----------------------#2021-07-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="ecd5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">想要利用优化的力量做出最佳决策吗？如果有，继续读下去！</p><h2 id="f0e6" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">定义挑战</h2><p id="9051" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">你有没有想过，你是否可以自动决策，但也确保最好的结果？也许，比如预算，资源分配，甚至招聘？在这篇文章中，我们将使用Python纸浆库来完成这个任务。我们的用例将是猛禽队在2020年自由球员期间的名单。现在，几乎每个加拿大人都知道迅猛龙，科怀·伦纳德和德雷克。这也意味着几乎每个人都知道科怀·伦纳德的释放和第二年被踢出锦标赛。这让我想知道猛龙队还有什么其他选择，我们是否可以使用决策分析来模拟和解释他们在淡季的行为。如果你对猛龙在预算限制和其他关键限制(如伤病和攻防指标)下可能建立的潜在球队感兴趣，为什么猛龙没有留住像林书豪和科怀这样的球员，或者对学习如何使用决策分析优化你的业务感兴趣，请继续阅读！</p><h1 id="3fa3" class="kd je hi bd jf ke kf kg jj kh ki kj jn kk kl km jq kn ko kp jt kq kr ks jw kt bi translated">定义团队力量</h1><p id="99b1" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">为了自动化决策，首先要做的是收集数据供我们的模型使用。在这样的项目中，有必要考虑你要优化什么。是时间花了吗？是预算吗？如果有，你有什么数据？比如在组建团队的时候，我们如何定义一个团队有多强？如果你是一个铁杆体育分析师，你可能已经知道这些。在这个项目中，我们用获胜份额来衡量篮球运动员的素质。作为参考，像科怀·伦纳德这样的球员在2019年后的胜率为9.3，而像诺曼·鲍威尔这样的球员(当时主要是替补)的胜率为2.3。如果您希望更好地了解如何计算赢得份额，请访问<a class="ae ku" href="https://www.basketball-reference.com/about/ws.html" rel="noopener ugc nofollow" target="_blank">basketball-reference.com。</a></p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es kv"><img src="../Images/7e7310d76119762c1100aeb2209369d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kbg8rbWY9deDBxiPo6gj8Q.png"/></div></div><figcaption class="lh li et er es lj lk bd b be z dx translated">赢股的定义</figcaption></figure><p id="9b81" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">太好了！既然我们已经定量地定义了什么是一个好的玩家，让我们开始优化。</p><h1 id="365a" class="kd je hi bd jf ke kf kg jj kh ki kj jn kk kl km jq kn ko kp jt kq kr ks jw kt bi translated"><strong class="ak">优化目标</strong></h1><p id="504b" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">优化听起来很花哨。然而，在这种情况下，我们真正要做的只是最大化团队的总体WS份额。我们称最大化总WS为目标函数。我们考虑目标函数使用的任何其他变量(即在这种情况下，Agent_i)是“决策变量”。我们认为Agent_i = 1意味着我们将该代理添加到我们的花名册中。Agent_i = 0意味着他们不在我们的花名册上。这实际上就是最大化乘积之和:即。如果我们选择WS为9.5的科怀和WS为2.3的诺曼·鲍威尔，我们的结果将是9.5 *代理_科怀+2.3 *代理_鲍威尔= 11.8。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div class="er es ll"><img src="../Images/7d8d247ac9624d2408704990744a12d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:792/format:webp/1*8a0GDrHIuOy9xUsWoc4c5w.png"/></div><figcaption class="lh li et er es lj lk bd b be z dx translated">目标函数</figcaption></figure><figure class="kw kx ky kz fd la er es paragraph-image"><div class="er es lm"><img src="../Images/9c907cdda85ea6005ae859d69fab51d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:754/format:webp/1*l2oBtaFVFkP2HTTB5Q5ojQ.png"/></div><figcaption class="lh li et er es lj lk bd b be z dx translated">我们使用的一些决策变量。</figcaption></figure><h1 id="e599" class="kd je hi bd jf ke kf kg jj kh ki kj jn kk kl km jq kn ko kp jt kq kr ks jw kt bi translated">限制</h1><p id="39d1" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">既然我们已经定义了目标和决策变量，我们还必须定义一些约束。显然，我们有一些支出和名册限制，让我们来定义这些。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es ln"><img src="../Images/d721f4a19c86721aed18ecfe05cad8d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NBDZqYms_WrHBx4RZrCjCQ.png"/></div></div><figcaption class="lh li et er es lj lk bd b be z dx translated">预算限制，最大球员限制和非自由球员定义。</figcaption></figure><p id="b4d9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">预算限制规定，花在工资上的钱必须少于NBA规定的官方球队支出上限。非自由球员猛龙队球员被保留/出售限制定义了非自由球员猛龙队球员的释放。因为球员有合同，我们不得不考虑卖掉猛禽的合同，或者冒险释放球员，同时支付整个合同期限的费用。他们收回整个合同的可能性是由他们的百分位数和赢得份额决定的。因此我们使用他们被出售的平均工资的期望值。例如，就win份额而言，Kawhi处于99%的百分位数。因此，收回合同的期望值是他平均工资的99%。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es lo"><img src="../Images/c5da6f700e865740ca3a48b5912aa0e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Fw1mTiANDVhnHZugpY4iWw.png"/></div></div><figcaption class="lh li et er es lj lk bd b be z dx translated">位置约束</figcaption></figure><p id="c8e4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">篮球有三个主要位置:中锋、后卫和前锋。我们必须至少有3名中锋，5名后卫和5名前锋。此外，我们可能不希望有球员有受伤的历史，所以我们会试图将过去受伤的总人数限制在一定的数量。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es lp"><img src="../Images/7932d1543cdc4a70cb9d9025474e4635.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NqJqOqjFGKy6wmModda1vg.png"/></div></div><figcaption class="lh li et er es lj lk bd b be z dx translated">每个位置的四个因素位置约束</figcaption></figure><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es lq"><img src="../Images/2954f4ad3b00e97ec173e3f4f55a2a07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1364/format:webp/1*g8vbe3EBbGzf0xFZJnx5eQ.png"/></div></div><figcaption class="lh li et er es lj lk bd b be z dx translated">四个因素制约着整个团队</figcaption></figure><p id="9e63" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">位置统计是NBA中很多决策的驱动力。虽然我们的目标是最大限度地赢得市场份额，但记住诸如失误率、投篮、篮板和罚球之类的东西也很重要。我们将使用Dean Oliver的四个因素衡量标准，这只是一个问题的答案——篮球队如何赢得比赛？在他定义的统计数据中，他认为投篮是最重要的因素，其次是失误，然后是篮板，最后是罚球。他给每个方面分别分配了40%、25%、20%、15%的权重。他用有效投篮命中率(eFG%)、失误率(TOV%)、篮板率(进攻和防守篮板率)(ORB%和DRB%)来衡量投篮，最后用罚球次数除以投篮次数(FT/FGA)来衡量罚球。因此，当一个团队的四个因素公式的值很高时，这表明该团队的球员在游戏的所有重要方面都很好地互补。在我们的例子中，我们选择给游戏中的每个位置一个最大/最小阈值。举例来说，这确保了我们不会有一支胜率很高的球队，但我们的前锋失误率极高，或者我们的中锋篮板率很低。</p><p id="961c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，我们有年龄限制，必须有球员(即。我们必须有Kawhi等…)。</p><h1 id="83c7" class="kd je hi bd jf ke kf kg jj kh ki kj jn kk kl km jq kn ko kp jt kq kr ks jw kt bi translated">编写代码</h1><p id="1c20" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">您可以在helper.py文件中看到包含以下代码和数据处理函数的存储库。</p><div class="lr ls ez fb lt lu"><a href="https://github.com/RScicomp/Teambuilder/blob/main/helper.py" rel="noopener  ugc nofollow" target="_blank"><div class="lv ab dw"><div class="lw ab lx cl cj ly"><h2 class="bd hj fi z dy lz ea eb ma ed ef hh bi translated">RScicomp/Teambuilder</h2><div class="mb l"><h3 class="bd b fi z dy lz ea eb ma ed ef dx translated">在GitHub上创建一个帐户，为RScicomp/Teambuilder的开发做出贡献。</h3></div><div class="mc l"><p class="bd b fp z dy lz ea eb ma ed ef dx translated">github.com</p></div></div><div class="md l"><div class="me l mf mg mh md mi lf lu"/></div></div></a></div><figure class="kw kx ky kz fd la"><div class="bz dy l di"><div class="mj mk l"/></div></figure><p id="ee8a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了运行我们的优化，我们需要纸浆库。您可以从命令行安装这个库:pip3 install pulp。纸浆是一个惊人的图书馆，我推荐任何有兴趣的人在这里找到更多:<a class="ae ku" href="https://coin-or.github.io/pulp/" rel="noopener ugc nofollow" target="_blank">https://coin-or.github.io/pulp/</a></p><p id="4a14" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上面我们看到了多个不同的目标函数。我们通过使用lpSum函数来定义目标。该函数会将您的数组转换为产品的总和，纸浆库可以对其进行线性优化。如第13行所示，我们的目标是赢得份额。我们在第14行也有一个四因素目标函数，我们可以交替切换。我们还使用这些优化函数中使用的LpVariable.dicts函数在第7–10行定义了决策变量。这个函数将创建多个代理，并将它们存储在一个字典中(从0到代理的数量:存储在我们的变量free_agents中)。我们确保它们是二进制的，这意味着要么代理被保留，要么被出售。</p><figure class="kw kx ky kz fd la"><div class="bz dy l di"><div class="mj mk l"/></div></figure><p id="315f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上面我们有约束。我们使用addConstraint函数来创建约束。positionalconstraint函数是我创建的简单函数，用于定义每个位置的约束。您可以在存储库中的helper.py文件中找到详细信息。</p><p id="78b9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了运行优化，我们使用prob.solve()函数。这将通过我们的二元决策变量返回最佳花名册。即。如果模型决定保留科怀，与科怀相关的决策变量将为1。否则它将是0。</p><h1 id="b401" class="kd je hi bd jf ke kf kg jj kh ki kj jn kk kl km jq kn ko kp jt kq kr ks jw kt bi translated">结果</h1><figure class="kw kx ky kz fd la er es paragraph-image"><div class="er es ml"><img src="../Images/0913ce25f503824472d94c1d2bca4a01.png" data-original-src="https://miro.medium.com/v2/resize:fit:998/format:webp/1*IyxtTR0UuF-h6p9F9woqUw.png"/></div></figure><p id="3178" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 2020年模型总赢股份— 52 </strong></p><p id="32dd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 2020年实际总赢股— 47.8 </strong></p><p id="e792" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">既然我们理解了我们的目标函数是如何建模/预测团队成功的，我们可以看看由我们的模型生成的最佳名单，并将其与猛龙队2020赛季的实际名单进行比较。最佳名册在2019年有59.7个Win份额，四因素值为0.23。就上下文而言，当我们运行一个模型来单独最大化四个因素的值时，目标函数的最佳值是0.24，因此我们的最佳解决方案在赢得份额和四个因素之间取得了良好的平衡。我们看到很多核心球员被保留了下来。我们的优化问题做出类似的决定，比如让科怀和林书豪走。通过敏感性分析，我们发现这仅仅是因为预算限制。如果科怀继续留在车队，我们会发现我们根本无法满足所有的限制。然而，当涉及到新玩家时，它会做出非常不同的决定。</p><p id="9150" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">很明显，猛龙不想过于激进地接近自由球员，因为他们签下了多个廉价的未选秀自由球员。我们的模型是建立在这样一个理念上的，一个团队想要在即将到来的赛季给自己最好的成功机会，而不是计划未来。很可能一旦猛龙队意识到科怀·伦纳德不会随队辞职，他们就决定通过节省一些钱和带走年轻球员来为未来建立更多的基础，而不是为即将到来的赛季建立最好的球队。也有可能猛龙确实瞄准了这些球员中的一些，只是无法签下他们，但我们无法知道这是不是真的。</p><p id="c4f7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然而，我们可以看到，就胜利份额而言，2020赛季最佳球队比实际的2020年猛龙队更好(还要注意，2020年的胜利份额数字更低，因为球队由于新冠肺炎而打了更少的比赛)。这并不保证球队会比实际的球队表现得更好，但是由于名册之间近5胜的差距，他们很可能会这样做。这表明，我们的解决方案是有意义的，并且可以向希望在即将到来的赛季中改善球队的NBA球队提供可靠的建议，考虑到球队面临的所有限制。也许，如果猛龙签下这些自由球员中的一些，他们可以重复成为NBA冠军。</p><h1 id="1953" class="kd je hi bd jf ke kf kg jj kh ki kj jn kk kl km jq kn ko kp jt kq kr ks jw kt bi translated">额外见解</h1><p id="3c96" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">如果您想看看用Plotly Dash和Tableau构建的仪表板，可以在存储库代码中查看。您可以调整模型的预算、最小和最大周转因素输入等，以便建立您的最佳团队版本。此外，还可以浏览Tableau仪表盘，了解团队绩效和位置绩效的一些可视化信息。你可能会发现一些有趣的事情，比如小前锋的崛起正在成为获胜球队的一部分。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es mm"><img src="../Images/55e568dede63c881c8ae5c0db83b6fa1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XHmoq-4UnR6gA2yF0cxgOA.png"/></div></div><figcaption class="lh li et er es lj lk bd b be z dx translated">交互式仪表板</figcaption></figure><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es mn"><img src="../Images/eef5393083a7835bfa380b8f2585726e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8I3HjC55wJVA_YTLM5cbHg.png"/></div></div><figcaption class="lh li et er es lj lk bd b be z dx translated">2017年，金州勇士队在中锋上的花费(前4名球队中)最少。</figcaption></figure><p id="eaf5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可以从Tableau仪表盘上看到金州勇士队在2017年赢得冠军时，在小前锋身上花了最多的钱，远离了对巨型中锋的传统支出，更多地关注快速和矮小的球员。事实上，我们看到这位小前锋在金州勇士队的场均WS/48排名第二。当你建立自己的团队时，这可能是需要考虑的事情！</p><p id="2ab8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您希望有一篇关于这些仪表板是如何创建的独立文章，请在下面发表评论！</p><h1 id="d402" class="kd je hi bd jf ke kf kg jj kh ki kj jn kk kl km jq kn ko kp jt kq kr ks jw kt bi translated">承认</h1><p id="9c4a" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">山姆·格林:提供了NBA球员实力的数据和指标，并将模型的名单与2020年的实际名单进行了比较。</p><p id="d7e8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">袁凯马:帮助写下优化函数</p><p id="a837" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">吴彦祖:结束语中的帮助。</p></div></div>    
</body>
</html>