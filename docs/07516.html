<html>
<head>
<title>Using SQS with Shoryuken in Rails (basics)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Rails中使用SQS和Shoryuken(基础)</h1>
<blockquote>原文：<a href="https://medium.com/codex/using-sqs-with-shoryuken-in-rails-basics-78ab87cd8734?source=collection_archive---------7-----------------------#2022-06-17">https://medium.com/codex/using-sqs-with-shoryuken-in-rails-basics-78ab87cd8734?source=collection_archive---------7-----------------------#2022-06-17</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/d052a48b8d02147c5294143e6ea2e06f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2PCTauFkJnWvPS3nMr2m6w.png"/></div></div></figure><div class=""/></div><div class="ab cl iq ir gp is" role="separator"><span class="it bw bk iu iv iw"/><span class="it bw bk iu iv iw"/><span class="it bw bk iu iv"/></div><div class="hb hc hd he hf"><p id="8633" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">后台作业是在不影响系统正常操作的情况下在后台运行的过程，并向用户返回快速响应，它用于减少手动工作并使过程自动化。</p><blockquote class="jv jw jx"><p id="bf68" class="ix iy jy iz b ja jb jc jd je jf jg jh jz jj jk jl ka jn jo jp kb jr js jt ju hb bi translated">为后台作业设置队列的最佳方式之一是亚马逊简单队列服务(SQS ),它是一种完全托管的消息队列服务，使您能够分离和扩展微服务、分布式系统和无服务器应用程序。在<a class="ae kc" href="https://aws.amazon.com/sqs/" rel="noopener ugc nofollow" target="_blank"/>中阅读更多关于<strong class="iz hu">的好处</strong></p></blockquote><p id="b27a" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">Shoryuken是ruby gem，帮助我们轻松地与SQS一起工作，它是一个超级高效的<a class="ae kc" href="https://aws.amazon.com/sqs/" rel="noopener ugc nofollow" target="_blank">亚马逊SQS </a>基于线程的消息处理器，支持持续轮询和基于线程的处理。</p><p id="4d88" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated"><strong class="iz hu">让我们开始吧</strong></p><p id="fd42" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">首先，我们需要将这些gem添加到gem文件中，并运行软件包安装:</p><figure class="ke kf kg kh fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es kd"><img src="../Images/232944efb56b819558f7048b3ea80fc5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dJ5AihImcBvp1P5jFmmD7w.png"/></div></div></figure><p id="8741" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated"><strong class="iz hu">设置Shoryuken配置</strong></p><p id="e7c3" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">您可以在初始化器中使用凭据指定Shoryuken.sqs_client，如下所示:</p><figure class="ke kf kg kh fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ki"><img src="../Images/f91ab223d8254705583f1523742b35ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GnQZeEy9VQVRpsjKFlt_wQ.png"/></div></div></figure><p id="36ba" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">或者在<code class="du kj kk kl km b">shoryuken.yml</code>文件中定义如下:</p><figure class="ke kf kg kh fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es kn"><img src="../Images/0bf6b2b1a37eb8946db66b65ba301523.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KvrvsaiNyqZFbZk3dpVoRg.png"/></div></div></figure><p id="b2de" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">现在让我们这样定义我们的工人:</p><figure class="ke kf kg kh fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ko"><img src="../Images/3767123bd56541c8926706307dd155a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NDGksPDiH6gm3Ll5gljSEw.png"/></div></div></figure><p id="e644" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">并确保队列名称与AWS中的队列名称相同，或者您可以通过Shoryuken添加:<a class="ae kc" href="https://github.com/ruby-shoryuken/shoryuken/wiki/Multiple-ways-of-configuring-queues-in-Shoryuken" rel="noopener ugc nofollow" target="_blank">configuring-queues-in-Shoryuken</a>。</p><p id="7a8a" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">现在我们可以调用我们的工人，将一条消息排队，然后像这样发送到SQS<code class="du kj kk kl km b">HelloWorker.perform_async('test sqs')</code></p><figure class="ke kf kg kh fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es kp"><img src="../Images/4e82f10e5a193817c192e60ca16521da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OaL03ZvaU6kElQLOL_I9Rg.png"/></div></div><figcaption class="kq kr et er es ks kt bd b be z dx translated"><strong class="bd ku"> HelloWorker.perform_async('测试sqs') </strong></figcaption></figure><p id="c213" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">或者，如果我们需要添加延迟来运行worker，我们可以这样使用:</p><p id="fcea" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated"><code class="du kj kk kl km b">HelloWorker.perform_in(interval(delay_seconds), 'test sqs')</code></p><figure class="ke kf kg kh fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es kv"><img src="../Images/fdc4e21501e3102c29defa47bba855ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8OSlPV3ar_sCQkpGM9TVSw.png"/></div></div><figcaption class="kq kr et er es ks kt bd b be z dx translated">你好，工作人员。执行_in( <strong class="bd ku"> 3 </strong>、<strong class="bd ku"> ' </strong>测试sqs <strong class="bd ku"> ' </strong>)</figcaption></figure><p id="2494" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated"><strong class="iz hu">启动Shoryuken </strong></p><p id="a0a8" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated"><code class="du kj kk kl km b">shoryuken -q queue_name_in_aws -R</code></p><p id="533e" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">在<a class="ae kc" href="https://github.com/ruby-shoryuken/shoryuken/wiki/Shoryuken-options" rel="noopener ugc nofollow" target="_blank"> Shoryuken-options </a>中阅读更多选项</p><blockquote class="jv jw jx"><p id="344b" class="ix iy jy iz b ja jb jc jd je jf jg jh jz jj jk jl ka jn jo jp kb jr js jt ju hb bi translated">通过运行shoryuken，它将使用和接收来自SQS的消息，并通过调用perform方法和传递sqs_msg和body来开始处理它们。</p></blockquote><figure class="ke kf kg kh fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es kw"><img src="../Images/0604c8b87b1c1e04b204b398b832f2eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-_9YW2KgBsh63Lvzaq5vRw.png"/></div></div></figure><p id="4f32" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">好了🤷‍♂️，你可以深入参考和shoryuken <a class="ae kc" href="https://github.com/ruby-shoryuken/shoryuken" rel="noopener ugc nofollow" target="_blank">宝石</a>和定制它与你需要的。</p></div><div class="ab cl iq ir gp is" role="separator"><span class="it bw bk iu iv iw"/><span class="it bw bk iu iv iw"/><span class="it bw bk iu iv"/></div><div class="hb hc hd he hf"><p id="f6a5" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">我希望这篇文章对SQS有所帮助。祝你今天愉快 ☀️.</p></div></div>    
</body>
</html>