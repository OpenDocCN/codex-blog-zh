<html>
<head>
<title>Visualising satellite data with Pydeck and Streamlit to discover possible forest fires worldwide</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Pydeck和Streamlit可视化卫星数据，发现世界范围内可能的森林火灾</h1>
<blockquote>原文：<a href="https://medium.com/codex/visualising-satellite-data-with-pydeck-and-streamlit-to-discover-possible-forest-fires-worldwide-7cb4f25351ba?source=collection_archive---------5-----------------------#2022-09-29">https://medium.com/codex/visualising-satellite-data-with-pydeck-and-streamlit-to-discover-possible-forest-fires-worldwide-7cb4f25351ba?source=collection_archive---------5-----------------------#2022-09-29</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/dbc5afe726f3f84704af96178cedc5d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-rpNNPoaP0Tng_Vj"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">美国宇航局在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</figcaption></figure><p id="d5f3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">根据<a class="ae iu" href="https://www.unoosa.org/oosa/osoindex/search-ng.jspx#?c=%7B%22filters%22:%5B%7B%22fieldName%22:%22en%23object.status.inOrbit_s1%22,%22value%22:%22Yes%22%7D%5D,%22sortings%22:%5B%7B%22fieldName%22:%22object.launch.dateOfLaunch_s1%22,%22dir%22:%22desc%22%7D%5D,%22match%22:null%7D" rel="noopener ugc nofollow" target="_blank">联合国</a>的消息，9686颗卫星正围绕地球运行，执行监测、通信和成像等任务。已执行任务的一个例子是分析世界范围的森林火灾。不同的项目一直在使用卫星数据来更好地可视化和协助森林火灾控制，而<a class="ae iu" href="https://queimadas.dgi.inpe.br/queimadas/portal" rel="noopener ugc nofollow" target="_blank">项目Queimadas </a>就是其中之一。在巴西政府的支持下，Projeto Queimadas致力于提供与火灾爆发、气象火灾风险和火烧区地图相关的公开数据。</p><p id="6fd9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">目前，该项目每天分析、使用和共享来自十颗卫星的数据。卫星输出被管理并用于调查和他们门户网站上的可视化。此外，研究人员可以在<a class="ae iu" href="https://queimadas.dgi.inpe.br/queimadas/dados-abertos/" rel="noopener ugc nofollow" target="_blank"> Projeto Queimadas数据门户</a>轻松检索数据集。</p><p id="8b8d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">从Projeto Queimadas数据开始，我们将开发一个带有Streamlit的简单应用程序，以可视化基于Pydeck的卫星捕捉到的全球可能的火灾。这个项目的最终结果可以在<a class="ae iu" href="https://matheusfeijoo-forestfires-app-q9x54z.streamlitapp.com/" rel="noopener ugc nofollow" target="_blank">这里</a>看到。</p></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><h2 id="0484" class="ka kb hi bd kc kd ke kf kg kh ki kj kk jg kl km kn jk ko kp kq jo kr ks kt ku bi translated">正在检索数据集</h2><p id="b396" class="pw-post-body-paragraph iv iw hi ix b iy kv ja jb jc kw je jf jg kx ji jj jk ky jm jn jo kz jq jr js hb bi translated">Programa Queimadas数据门户提供了一系列按巴西各州和时期分类的独特数据集。这些数据集提供了与捕获的火灾像素相关的基本信息。火点(或热点)可以定义为通过卫星图像获得的可能的植被火点。</p><p id="7e97" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在我们的例子中，我们将使用2022年8月的数据集，它提供了世界范围的数据(可以在门户中随意使用另一个数据集)。由于数据集的大小，我们首先创建一个dataextractor.py脚本来下载并提取项目所需的数据，其中每一行都是一个火像素，相关的列有:</p><ul class=""><li id="a5ba" class="la lb hi ix b iy iz jc jd jg lc jk ld jo le js lf lg lh li bi translated"><strong class="ix hj"> lat </strong>:热点所在的纬度。</li><li id="4d2f" class="la lb hi ix b iy lj jc lk jg ll jk lm jo ln js lf lg lh li bi translated"><strong class="ix hj"> lon </strong>:热点的经度</li><li id="56f3" class="la lb hi ix b iy lj jc lk jg ll jk lm jo ln js lf lg lh li bi translated"><strong class="ix hj"> data_hora_gmt </strong>:热点所在gmt时区的日期和时间</li><li id="39f0" class="la lb hi ix b iy lj jc lk jg ll jk lm jo ln js lf lg lh li bi translated"><strong class="ix hj">卫星</strong>:捕捉热spor的卫星</li><li id="d933" class="la lb hi ix b iy lj jc lk jg ll jk lm jo ln js lf lg lh li bi translated"><strong class="ix hj"> pais </strong>:观察到这个热点的国家。</li></ul><figure class="lo lp lq lr fd ij"><div class="bz dy l di"><div class="ls lt l"/></div></figure><h2 id="3920" class="ka kb hi bd kc kd ke kf kg kh ki kj kk jg kl km kn jk ko kp kq jo kr ks kt ku bi translated">创建我们的简化应用程序</h2><p id="44a6" class="pw-post-body-paragraph iv iw hi ix b iy kv ja jb jc kw je jf jg kx ji jj jk ky jm jn jo kz jq jr js hb bi translated">生成数据集后，我们可以开始编写app.py脚本来运行我们的应用程序。首先需要安装<a class="ae iu" href="https://docs.streamlit.io/library/get-started/installation" rel="noopener ugc nofollow" target="_blank"><strong class="ix hj"/></a><a class="ae iu" href="https://pandas.pydata.org/getting_started.html" rel="noopener ugc nofollow" target="_blank"><strong class="ix hj">熊猫</strong> </a>和<a class="ae iu" href="https://deckgl.readthedocs.io/en/latest/installation.html" rel="noopener ugc nofollow" target="_blank"> <strong class="ix hj"> Pydeck </strong> </a>库并导入到代码中。接下来，我们用<code class="du lu lv lw lx b">st.title()</code>函数添加我们的app的标题，并在终端中执行<code class="du lu lv lw lx b">streamlit run app.py</code>。</p><figure class="lo lp lq lr fd ij"><div class="bz dy l di"><div class="ls lt l"/></div></figure><p id="9da7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">执行streamlit后，应用程序将在默认的web浏览器中运行:</p><figure class="lo lp lq lr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ly"><img src="../Images/3217bb1867b02ef2a5cb0f3233ea9026.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DXQ9EYk1OJQDmO4RHWRCDA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">简化应用程序</figcaption></figure><h2 id="9266" class="ka kb hi bd kc kd ke kf kg kh ki kj kk jg kl km kn jk ko kp kq jo kr ks kt ku bi translated">导入和格式化数据集</h2><p id="a98c" class="pw-post-body-paragraph iv iw hi ix b iy kv ja jb jc kw je jf jg kx ji jj jk ky jm jn jo kz jq jr js hb bi translated">处理Programa Queimadas数据的一个问题是数据集的大小。我们已经将该数据集从717 MB减少到187 MB。但是，我们也可以通过将数据集列类型从object改为category以及从float64改为float32来减少内存使用。通过这些更改，我们可以将内存使用量减少到79MB。以下函数导入数据集并执行格式化df_heatSpots数据帧任务:</p><figure class="lo lp lq lr fd ij"><div class="bz dy l di"><div class="ls lt l"/></div></figure><p id="254b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Streamlit库提供了一系列的输入部件，在<code class="du lu lv lw lx b">choosing_variables()</code>中，我们将使用<code class="du lu lv lw lx b">st.date_input() </code>和<code class="du lu lv lw lx b">st.multiselect()</code>函数来过滤数据，以便用Pydeck绘制在地图上。这些功能通过<code class="du lu lv lw lx b">with st.sidebar:</code>放在app侧边栏上。</p><p id="4872" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">本机<code class="du lu lv lw lx b">st.multiselect()</code>不提供选择所有选项的方式。我们可以配置这个多选，这样当字段为空时，所有选项都将被选中。为此，我们首先在<code class="du lu lv lw lx b">all_options = df_heatSpots[''].unique()</code>之前收集所有选项。之后，<code class="du lu lv lw lx b">select</code>变量接收multiselect的输出，<code class="du lu lv lw lx b">if len(select) &gt; 0:</code>条件返回过滤数据帧的变量。</p><figure class="lo lp lq lr fd ij"><div class="bz dy l di"><div class="ls lt l"/></div></figure><h2 id="08d2" class="ka kb hi bd kc kd ke kf kg kh ki kj kk jg kl km kn jk ko kp kq jo kr ks kt ku bi translated">查询热点数据框架</h2><p id="a6d3" class="pw-post-body-paragraph iv iw hi ix b iy kv ja jb jc kw je jf jg kx ji jj jk ky jm jn jo kz jq jr js hb bi translated">在调用编码的<code class="du lu lv lw lx b">importing_dataset()</code>和<code class="du lu lv lw lx b">choosing_variables()</code>函数后，我们可以执行查询来过滤<code class="du lu lv lw lx b">df_heatSpots</code>。此外，我们添加了一些初始变量，当应用程序被访问时，这些变量将显示在生成的地图中。</p><figure class="lo lp lq lr fd ij"><div class="bz dy l di"><div class="ls lt l"/></div></figure><h2 id="35f3" class="ka kb hi bd kc kd ke kf kg kh ki kj kk jg kl km kn jk ko kp kq jo kr ks kt ku bi translated">设置Pydeck地图</h2><p id="4ff1" class="pw-post-body-paragraph iv iw hi ix b iy kv ja jb jc kw je jf jg kx ji jj jk ky jm jn jo kz jq jr js hb bi translated">为了渲染Pydeck地图和绘制过滤后的数据，我们需要定义<code class="du lu lv lw lx b">pdk.ViewState()</code>、<code class="du lu lv lw lx b">pdk.Layer()</code>、<code class="du lu lv lw lx b">tooltip</code>和<code class="du lu lv lw lx b">mapstyle</code>。<code class="du lu lv lw lx b">view_state</code>接收等于零的纬度和经度以使地图居中，零度的方位和45度的俯仰(随意改变这些变量并查看应用程序中的更新)。</p><figure class="lo lp lq lr fd ij"><div class="bz dy l di"><div class="ls lt l"/></div></figure><p id="0715" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Pydeck地图的第二部分是图层定义。该层的基本变量是:</p><ul class=""><li id="beb3" class="la lb hi ix b iy iz jc jd jg lc jk ld jo le js lf lg lh li bi translated"><strong class="ix hj">类型</strong>:要渲染的层的类型，如HexagonLayer或ColumnLayer。</li><li id="28d0" class="la lb hi ix b iy lj jc lk jg ll jk lm jo ln js lf lg lh li bi translated"><strong class="ix hj"> id: </strong>层的唯一名称。</li><li id="5ed1" class="la lb hi ix b iy lj jc lk jg ll jk lm jo ln js lf lg lh li bi translated"><strong class="ix hj">数据:</strong>要加载的数据的URL或者数据的数组。</li><li id="7871" class="la lb hi ix b iy lj jc lk jg ll jk lm jo ln js lf lg lh li bi translated"><strong class="ix hj"> **kwargs: </strong>可用于层的任何参数。</li></ul><figure class="lo lp lq lr fd ij"><div class="bz dy l di"><div class="ls lt l"/></div></figure><p id="f240" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">最后一个参数是<code class="du lu lv lw lx b">tooltip</code>和<code class="du lu lv lw lx b">map_style</code>。对于地图样式，我们通过使用关联的样式URL采用了<a class="ae iu" href="https://docs.mapbox.com/api/maps/styles/" rel="noopener ugc nofollow" target="_blank"> Mapbox </a>样式定义。对于工具提示，我们在使它们在Streamlit中可执行时遇到了一些问题。Pydeck提供的工具提示示例在Streamlit应用程序中不起作用。以下代码是为地图中的每个点生成工具提示的一种可能方式，在本例中引用相关的卫星。</p><figure class="lo lp lq lr fd ij"><div class="bz dy l di"><div class="ls lt l"/></div></figure><p id="a605" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果一切按计划进行，您的Streamlit应用程序将如下所示:</p><figure class="lo lp lq lr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ly"><img src="../Images/7c1b6136a0270b4975af33df2a8ec137.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W3hKnZiaYoaYemsaSL0c-A.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">全球森林火灾应用程序</figcaption></figure></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><h2 id="1076" class="ka kb hi bd kc kd ke kf kg kh ki kj kk jg kl km kn jk ko kp kq jo kr ks kt ku bi translated">摘要</h2><p id="f556" class="pw-post-body-paragraph iv iw hi ix b iy kv ja jb jc kw je jf jg kx ji jj jk ky jm jn jo kz jq jr js hb bi translated">卫星数据是一种强大的人工制品，可用于不同的领域。在我们的项目中，收集的数据集可以更好地可视化和过滤，以跟踪全球潜在的森林火灾。通过使用Pandas、Streamlit和Pydeck，我们可以提供一种创新的方式来可视化提取的数据并进行更好的调查。</p><p id="2c16" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">你可以在我的GitHub库找到这个项目的代码:<a class="ae iu" href="https://github.com/MatheusFeijoo/forestfires" rel="noopener ugc nofollow" target="_blank">https://github.com/MatheusFeijoo/forestfires</a></p><p id="6a5b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">最后，这个应用也在流云在线:<a class="ae iu" href="https://matheusfeijoo-forestfires-app-q9x54z.streamlitapp.com/" rel="noopener ugc nofollow" target="_blank">https://matheusfeijoo-forest fires-app-q9x 54 z . streamlitapp . com/</a></p></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><p id="773f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我希望你喜欢这个教程！</p><p id="d83e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">请随意评论你对它的看法。</p><p id="2c5f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="lz">还有，别忘了连线上</em> <a class="ae iu" href="https://www.linkedin.com/in/feijo%C3%B3/" rel="noopener ugc nofollow" target="_blank"> <em class="lz"> LinkedIn </em> </a> <em class="lz">和</em><a class="ae iu" href="https://github.com/MatheusFeijoo" rel="noopener ugc nofollow" target="_blank"><em class="lz">GitHub</em></a><em class="lz">来多聊聊数据科学！</em></p></div></div>    
</body>
</html>