<html>
<head>
<title>Flutter MVP Architecture</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">颤振MVP架构</h1>
<blockquote>原文：<a href="https://medium.com/codex/mvp-architecture-pattern-in-flutter-b7bfe712a0ba?source=collection_archive---------4-----------------------#2022-08-16">https://medium.com/codex/mvp-architecture-pattern-in-flutter-b7bfe712a0ba?source=collection_archive---------4-----------------------#2022-08-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/a627e607e097b9d3a9dec78b794b4812.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jrSmU-v9WIhbFOo0cA8Wew.png"/></div></div></figure><h1 id="7345" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">什么是MVP？</h1><blockquote class="jo"><p id="83ce" class="jp jq hi bd jr js jt ju jv jw jx jy dx translated">MVP代表<strong class="ak">模型视图演示者。</strong></p></blockquote><blockquote class="jz ka kb"><p id="22d5" class="kc kd ke kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz jy hb bi translated"><em class="hi"/><strong class="kf hj">模型</strong> <em class="hi">是定义要在用户界面中显示或以其他方式操作的数据的界面。</em></p><p id="6d75" class="kc kd ke kf b kg la ki kj kk lb km kn ko lc kq kr ks ld ku kv kw le ky kz jy hb bi translated"><em class="hi"/><strong class="kf hj">视图</strong> <em class="hi">是一个被动的界面，它显示数据(模型)并将用户命令(</em> <a class="ae lf" href="https://en.wikipedia.org/wiki/Event_(computing)" rel="noopener ugc nofollow" target="_blank"> <em class="hi">事件</em> </a> <em class="hi">)发送给演示者，以便对数据进行操作。</em></p><p id="99bf" class="kc kd ke kf b kg la ki kj kk lb km kn ko lc kq kr ks ld ku kv kw le ky kz jy hb bi translated"><em class="hi"/><strong class="kf hj">演示者</strong> <em class="hi">作用于模型和视图。它从存储库(模型)中检索数据，并将其格式化以显示在视图中</em></p></blockquote><h1 id="1cd3" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">通信流程</h1><p id="3f5b" class="pw-post-body-paragraph kc kd hi kf b kg lg ki kj kk lh km kn li lj kq kr lk ll ku kv lm ln ky kz jy hb bi translated">从这个流程图中，我们将看到模型视图和表示器是如何连接的，以使我们的代码更具可读性，更易于测试。</p><figure class="lp lq lr ls fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lo"><img src="../Images/10caa58ac92dc15b54812602fbee301b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tvlv-zFL-cnbk9O8pgIgIw.png"/></div></div></figure><p id="5889" class="pw-post-body-paragraph kc kd hi kf b kg la ki kj kk lb km kn li lc kq kr lk ld ku kv lm le ky kz jy hb bi translated"><strong class="kf hj"> MVP </strong>由<strong class="kf hj">模型视图</strong>和<strong class="kf hj">展示者</strong>组成，两者绑定在一起，最顶层的视图负责向用户展示数据，并从用户处获取数据。</p><p id="cc7f" class="pw-post-body-paragraph kc kd hi kf b kg la ki kj kk lb km kn li lc kq kr lk ld ku kv lm le ky kz jy hb bi translated">presenter包含视图的UI业务逻辑。视图中的所有调用都直接委托给演示者。</p><p id="66d2" class="pw-post-body-paragraph kc kd hi kf b kg la ki kj kk lb km kn li lc kq kr lk ld ku kv lm le ky kz jy hb bi translated">视图是体系结构的最顶层，它与用户交互，接受传递给演示者的输入，并从模型中获取数据，然后将数据发送回视图以呈现给用户。</p><ul class=""><li id="f239" class="lt lu hi kf b kg la kk lb li lv lk lw lm lx jy ly lz ma mb bi translated">视图与模型的耦合更加松散。演示者负责将模型绑定到视图。</li><li id="d00d" class="lt lu hi kf b kg mc kk md li me lk mf lm mg jy ly lz ma mb bi translated">更容易进行单元测试，因为与视图的交互是通过接口进行的。</li><li id="9d16" class="lt lu hi kf b kg mc kk md li me lk mf lm mg jy ly lz ma mb bi translated">通常视图与演示者一一对应。复杂视图可能有多个演示者。</li></ul><h1 id="1345" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">本库的使用</h1><p id="6f56" class="pw-post-body-paragraph kc kd hi kf b kg lg ki kj kk lh km kn li lj kq kr lk ll ku kv lm ln ky kz jy hb bi translated">假设我们有我们喜欢的反样本:</p><pre class="lp lq lr ls fd mh mi mj mk aw ml bi"><span id="7c2a" class="mm ir hi mi b fi mn mo l mp mq">class CounterExample extends StatefulWidget {</span><span id="c567" class="mm ir hi mi b fi mr mo l mp mq"><em class="ke"> const</em> CounterExample({</span><span id="7c17" class="mm ir hi mi b fi mr mo l mp mq">   Key? key,</span><span id="e625" class="mm ir hi mi b fi mr mo l mp mq">}) : super(key: key);</span><span id="0f7e" class="mm ir hi mi b fi mr mo l mp mq">@override</span><span id="de43" class="mm ir hi mi b fi mr mo l mp mq">_MyHomePageState <em class="ke">createState</em>() =&gt; _MyHomePageState();</span><span id="4579" class="mm ir hi mi b fi mr mo l mp mq">}</span><span id="3d93" class="mm ir hi mi b fi mr mo l mp mq">class _MyHomePageState extends State&lt;CounterExample&gt;<br/>implements Counter {</span><span id="2901" class="mm ir hi mi b fi mr mo l mp mq"><em class="ke">final</em> BasicCounterPresenter presenter = BasicCounterPresenter();</span><span id="33cd" class="mm ir hi mi b fi mr mo l mp mq">CounterModel _viewModel = CounterModel(0);</span><span id="fb34" class="mm ir hi mi b fi mr mo l mp mq">@override</span><span id="bc85" class="mm ir hi mi b fi mr mo l mp mq">void <em class="ke">initState</em>() {</span><span id="e3d3" class="mm ir hi mi b fi mr mo l mp mq">super.<em class="ke">initState</em>();</span><span id="fc32" class="mm ir hi mi b fi mr mo l mp mq">    presenter.counterView = this;</span><span id="6d22" class="mm ir hi mi b fi mr mo l mp mq">}</span><span id="2647" class="mm ir hi mi b fi mr mo l mp mq">@override</span><span id="1262" class="mm ir hi mi b fi mr mo l mp mq">void <em class="ke">refreshCounter</em>(CounterModel viewModel) {</span><span id="3bcb" class="mm ir hi mi b fi mr mo l mp mq"><em class="ke">setState</em>(() {</span><span id="d78d" class="mm ir hi mi b fi mr mo l mp mq">  _viewModel = viewModel;</span><span id="044d" class="mm ir hi mi b fi mr mo l mp mq">});</span><span id="aab7" class="mm ir hi mi b fi mr mo l mp mq">}</span><span id="7066" class="mm ir hi mi b fi mr mo l mp mq">@override</span><span id="c462" class="mm ir hi mi b fi mr mo l mp mq">Widget <em class="ke">build</em>(BuildContext context) {</span><span id="7bdb" class="mm ir hi mi b fi mr mo l mp mq"><em class="ke">  return</em> Scaffold(</span><span id="18b4" class="mm ir hi mi b fi mr mo l mp mq">    appBar: AppBar(</span><span id="07d4" class="mm ir hi mi b fi mr mo l mp mq">      title: <em class="ke">const</em> Text('Mvp demo'),</span><span id="3569" class="mm ir hi mi b fi mr mo l mp mq">     ),</span><span id="97bf" class="mm ir hi mi b fi mr mo l mp mq">     body: Center(</span><span id="5aff" class="mm ir hi mi b fi mr mo l mp mq">         child: Column(</span><span id="3233" class="mm ir hi mi b fi mr mo l mp mq">             mainAxisAlignment: MainAxisAlignment.center,</span><span id="3084" class="mm ir hi mi b fi mr mo l mp mq">             children: &lt;Widget&gt;[</span><span id="cc44" class="mm ir hi mi b fi mr mo l mp mq"><em class="ke">                const</em> Padding(<br/>                    padding: EdgeInsets.<em class="ke">only</em>(bottom: 30.0),</span><span id="e73c" class="mm ir hi mi b fi mr mo l mp mq">                child: Text("Click buttons to add and substract.",),</span><span id="1836" class="mm ir hi mi b fi mr mo l mp mq">                ),</span><span id="1ebe" class="mm ir hi mi b fi mr mo l mp mq">              Row(</span><span id="b9fd" class="mm ir hi mi b fi mr mo l mp mq">                mainAxisAlignment: MainAxisAlignment.spaceEvenly,</span><span id="b4c9" class="mm ir hi mi b fi mr mo l mp mq">              children: &lt;Widget&gt;[</span><span id="9c24" class="mm ir hi mi b fi mr mo l mp mq">                 FloatingActionButton(</span><span id="4040" class="mm ir hi mi b fi mr mo l mp mq">                   onPressed: () {</span><span id="1a65" class="mm ir hi mi b fi mr mo l mp mq">                      presenter.<em class="ke">decrementCounter</em>();</span><span id="9868" class="mm ir hi mi b fi mr mo l mp mq">                   },</span><span id="9271" class="mm ir hi mi b fi mr mo l mp mq">                 child: <em class="ke">const</em> Icon(Icons.remove),</span><span id="1089" class="mm ir hi mi b fi mr mo l mp mq">                ),</span><span id="04b0" class="mm ir hi mi b fi mr mo l mp mq">                Text("${_viewModel.counter}",</span><span id="22c2" class="mm ir hi mi b fi mr mo l mp mq">                ),</span><span id="7eed" class="mm ir hi mi b fi mr mo l mp mq">                FloatingActionButton(</span><span id="5565" class="mm ir hi mi b fi mr mo l mp mq">                onPressed: () {</span><span id="639f" class="mm ir hi mi b fi mr mo l mp mq">                   presenter.<em class="ke">incrementCounter</em>();</span><span id="b21c" class="mm ir hi mi b fi mr mo l mp mq">                 },</span><span id="2d68" class="mm ir hi mi b fi mr mo l mp mq">               child: <em class="ke">const</em> Icon(Icons.add),</span><span id="5eaf" class="mm ir hi mi b fi mr mo l mp mq">              ),</span><span id="06e1" class="mm ir hi mi b fi mr mo l mp mq">           ],</span><span id="229e" class="mm ir hi mi b fi mr mo l mp mq">       ),</span><span id="4c5f" class="mm ir hi mi b fi mr mo l mp mq">    ],</span><span id="f4b1" class="mm ir hi mi b fi mr mo l mp mq">  ),</span><span id="3515" class="mm ir hi mi b fi mr mo l mp mq"> ),</span><span id="2694" class="mm ir hi mi b fi mr mo l mp mq">);</span><span id="0a69" class="mm ir hi mi b fi mr mo l mp mq">}</span><span id="e967" class="mm ir hi mi b fi mr mo l mp mq">}</span></pre><p id="00e5" class="pw-post-body-paragraph kc kd hi kf b kg la ki kj kk lb km kn li lc kq kr lk ld ku kv lm le ky kz jy hb bi translated">在这个简单的应用程序中，我们的模型是实际的计数器值，让我们将计数器var提取到一个专用的模型类中:</p><pre class="lp lq lr ls fd mh mi mj mk aw ml bi"><span id="6436" class="mm ir hi mi b fi mn mo l mp mq"><strong class="mi hj">class</strong> <strong class="mi hj">MainModel</strong> {<br/>  MainModel({<strong class="mi hj">this</strong>.counter = 0});<br/>  <br/>  int counter;<br/>}</span></pre><p id="5a18" class="pw-post-body-paragraph kc kd hi kf b kg la ki kj kk lb km kn li lc kq kr lk ld ku kv lm le ky kz jy hb bi translated">我们需要一个presenter，它将接收用户输入(单击increment counter按钮)，计算新的计数器值，然后将其应用于视图:</p><pre class="lp lq lr ls fd mh mi mj mk aw ml bi"><span id="fd80" class="mm ir hi mi b fi mn mo l mp mq">class BasicCounterPresenter {</span><span id="3abf" class="mm ir hi mi b fi mr mo l mp mq"><em class="ke">  final</em> CounterModel _counterViewModel = CounterModel(0);</span><span id="1e2f" class="mm ir hi mi b fi mr mo l mp mq">  Counter _counterView = Counter();</span><span id="25bd" class="mm ir hi mi b fi mr mo l mp mq">void <em class="ke">incrementCounter</em>() {</span><span id="7645" class="mm ir hi mi b fi mr mo l mp mq"> _counterViewModel.counter++;</span><span id="2c16" class="mm ir hi mi b fi mr mo l mp mq"> _counterView.<em class="ke">refreshCounter</em>(_counterViewModel);</span><span id="168c" class="mm ir hi mi b fi mr mo l mp mq">}</span><span id="7122" class="mm ir hi mi b fi mr mo l mp mq">void <em class="ke">decrementCounter</em>() {</span><span id="7f7b" class="mm ir hi mi b fi mr mo l mp mq"> _counterViewModel.counter--;</span><span id="42b3" class="mm ir hi mi b fi mr mo l mp mq"> _counterView.<em class="ke">refreshCounter</em>(_counterViewModel);</span><span id="e1c8" class="mm ir hi mi b fi mr mo l mp mq">}</span><span id="708b" class="mm ir hi mi b fi mr mo l mp mq">set <em class="ke">counterView</em>(Counter value) {</span><span id="9d0d" class="mm ir hi mi b fi mr mo l mp mq"> _counterView = value;</span><span id="1d43" class="mm ir hi mi b fi mr mo l mp mq"> _counterView.<em class="ke">refreshCounter</em>(_counterViewModel);</span><span id="929d" class="mm ir hi mi b fi mr mo l mp mq"> }</span><span id="524b" class="mm ir hi mi b fi mr mo l mp mq">}</span></pre><p id="c21a" class="pw-post-body-paragraph kc kd hi kf b kg la ki kj kk lb km kn li lc kq kr lk ld ku kv lm le ky kz jy hb bi translated">最后，我们将视图从计算新计数器值的任务中释放出来，只接收用户输入并呈现当前视图模型:</p><pre class="lp lq lr ls fd mh mi mj mk aw ml bi"><span id="8c19" class="mm ir hi mi b fi mn mo l mp mq">class Counter {</span><span id="f267" class="mm ir hi mi b fi mr mo l mp mq">void <em class="ke">refreshCounter</em>(CounterModel viewModel) {}</span><span id="97e8" class="mm ir hi mi b fi mr mo l mp mq">}</span></pre></div></div>    
</body>
</html>