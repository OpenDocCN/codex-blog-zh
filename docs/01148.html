<html>
<head>
<title>Dedicated SQL pools in Azure Synapse Analytics</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Azure Synapse Analytics中的专用SQL池</h1>
<blockquote>原文：<a href="https://medium.com/codex/dedicated-sql-pools-in-azure-synapse-analytics-d3ac7c394a95?source=collection_archive---------6-----------------------#2021-04-07">https://medium.com/codex/dedicated-sql-pools-in-azure-synapse-analytics-d3ac7c394a95?source=collection_archive---------6-----------------------#2021-04-07</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/dd5a5890275d7587bb7e2f7499c8bd2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OPAGpYMUTxR8o7ey"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae iu" href="https://unsplash.com/@milogrodskiy?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Yehor milohroskyi</a>拍摄的照片</figcaption></figure><p id="8658" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="jt">本文由Betacom分析和创新团队撰写。Betacom是一家总部位于意大利和德国的公司，在IT领域使用创新技术、数字解决方案和尖端编程方法开展业务。你可以在我们的</em> <a class="ae iu" href="https://betacom.eu/" rel="noopener ugc nofollow" target="_blank"> <em class="jt">网站</em> </a> <em class="jt">了解更多。</em></p><h1 id="4780" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">介绍</h1><p id="fa00" class="pw-post-body-paragraph iv iw hi ix b iy ks ja jb jc kt je jf jg ku ji jj jk kv jm jn jo kw jq jr js hb bi translated">在本文中，我们将讨论Azure Synapse Analytics的核心:专用SQL池。在第一部分中，我们将学习它们的体系结构，而在剩下的三部分中，我们将研究专用SQL池中的表可能具有的不同属性。</p><h1 id="8031" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">体系结构</h1><p id="bc2a" class="pw-post-body-paragraph iv iw hi ix b iy ks ja jb jc kt je jf jg ku ji jj jk kv jm jn jo kw jq jr js hb bi translated">专用SQL池指的是Azure Synapse Analytics中提供的企业数据仓库功能。它们的架构是基于节点的，可以描述如下。</p><figure class="ky kz la lb fd ij er es paragraph-image"><div class="er es kx"><img src="../Images/393465d0ebddd90a716657d083bcffc1.png" data-original-src="https://miro.medium.com/v2/resize:fit:880/0*z7CjC_KWIizYQSpp"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">来源:<a class="ae iu" href="https://docs.microsoft.com/en-us/azure/synapse-analytics/sql-data-warehouse/massively-parallel-processing-mpp-architecture" rel="noopener ugc nofollow" target="_blank">专用SQL池(以前的SQL DW)架构— Azure Synapse Analytics </a></figcaption></figure><p id="5fc8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">控制节点</strong>代表专用SQL池的大脑，是应用程序和连接的前端。<strong class="ix hj"> MPP </strong>(大规模并行处理)<strong class="ix hj"> </strong>引擎在控制节点上运行，以优化和协调并行查询的执行。计算节点执行查询，并通过在它们之间平均分配工作来使用。根据所选的数据仓库单位(DWU ),它们可以是1到60。请记住，DWU是对计算资源和性能的抽象和标准化度量。Azure Synapse Analytics提供的服务是按照DWU付费的。</p><p id="0101" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">对于DMS，我们指的是<strong class="ix hj">数据移动服务</strong>，或者在节点之间移动数据以允许并行执行查询并获得准确结果的内部服务(在系统级别)。</p><p id="0c36" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">每个查询分为60个部分，每个部分由一个分布执行，分布是对分布式数据运行的并行查询的基本存储和处理单元。</p><h1 id="dbc5" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">碎片图案</h1><p id="df45" class="pw-post-body-paragraph iv iw hi ix b iy ks ja jb jc kt je jf jg ku ji jj jk kv jm jn jo kw jq jr js hb bi translated">专用SQL池中的数据分布在分片中，以优化系统性能。创建表格时，可以选择使用哪种分片模式:</p><ul class=""><li id="46a3" class="lc ld hi ix b iy iz jc jd jg le jk lf jo lg js lh li lj lk bi translated">复制的，</li><li id="370e" class="lc ld hi ix b iy ll jc lm jg ln jk lo jo lp js lh li lj lk bi translated">循环法(默认)，</li><li id="ed90" class="lc ld hi ix b iy ll jc lm jg ln jk lo jo lp js lh li lj lk bi translated">哈希。</li></ul><p id="a95b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在<strong class="ix hj">复制表</strong>中，表的完整副本存储在每个计算节点上。因此，在运行查询之前，没有必要在节点之间传输数据。需要额外的存储空间，并且在写入数据时会产生开销，这使得大型表不切实际。</p><figure class="ky kz la lb fd ij er es paragraph-image"><div class="er es lq"><img src="../Images/c06f34a0f338bba24f3229af13ddc040.png" data-original-src="https://miro.medium.com/v2/resize:fit:834/0*nIoyYq7x57uqLlpW"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">来源:<a class="ae iu" href="https://docs.microsoft.com/en-us/azure/synapse-analytics/sql-data-warehouse/massively-parallel-processing-mpp-architecture" rel="noopener ugc nofollow" target="_blank">专用SQL池(原SQL DW)架构——Azure Synapse Analytics</a></figcaption></figure><p id="11ec" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">数据均匀分布在<strong class="ix hj">循环分配表</strong>中，但没有进一步优化。首先选择随机分布，然后将行缓冲区顺序分配给分布。如果用作装载数据的临时表，这是创建表并获得快速性能的最简单的分布。但是，查询性能可能需要额外的时间。</p><p id="22b9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在<strong class="ix hj">散列分布表</strong>定义中，其中一列被指定为分布列，散列函数使用该列的值将每一行分配给一个分布。哈希分布式表为大型表上的连接和聚合提供了最高的查询性能。</p><figure class="ky kz la lb fd ij er es paragraph-image"><div class="er es lr"><img src="../Images/0224ba0211c49620438e4fe26837fc58.png" data-original-src="https://miro.medium.com/v2/resize:fit:932/0*Wd7o-Dt6kCtTJsva"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">来源:<a class="ae iu" href="https://docs.microsoft.com/en-us/azure/synapse-analytics/sql-data-warehouse/massively-parallel-processing-mpp-architecture" rel="noopener ugc nofollow" target="_blank">专用SQL池(以前的SQL DW)架构— Azure Synapse Analytics </a></figcaption></figure><p id="7036" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">一个好的分发密钥</p><ul class=""><li id="e7e4" class="lc ld hi ix b iy iz jc jd jg le jk lf jo lg js lh li lj lk bi translated">平均分配数据；</li><li id="b145" class="lc ld hi ix b iy ll jc lm jg ln jk lo jo lp js lh li lj lk bi translated">用于聚合(然后将被分组的所有记录应该在相同的分布中)；</li><li id="899c" class="lc ld hi ix b iy ll jc lm jg ln jk lo jo lp js lh li lj lk bi translated">用于连接(对于大型事实表尤其如此)；</li><li id="8670" class="lc ld hi ix b iy ll jc lm jg ln jk lo jo lp js lh li lj lk bi translated">不能更改(要更改，必须删除，重新输入数据)；</li><li id="3abb" class="lc ld hi ix b iy ll jc lm jg ln jk lo jo lp js lh li lj lk bi translated">有60多个不同的值，因此所有分布都获得相同数量的数据。</li></ul><p id="563d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如何选择使用哪种分片模式？</p><figure class="ky kz la lb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ls"><img src="../Images/9a0633de71270e6af61c5bdf65c6d52e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W-hJv-OQ4ZRCHOvxxI4sBw.png"/></div></div></figure><h1 id="a469" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">表格类型</h1><p id="5434" class="pw-post-body-paragraph iv iw hi ix b iy ks ja jb jc kt je jf jg ku ji jj jk kv jm jn jo kw jq jr js hb bi translated">表的主要索引选项有:</p><ul class=""><li id="edae" class="lc ld hi ix b iy iz jc jd jg le jk lf jo lg js lh li lj lk bi translated">聚集列存储索引(默认)，</li><li id="78d8" class="lc ld hi ix b iy ll jc lm jg ln jk lo jo lp js lh li lj lk bi translated">堆表，</li><li id="ed74" class="lc ld hi ix b iy ll jc lm jg ln jk lo jo lp js lh li lj lk bi translated">聚集索引。</li></ul><p id="4f43" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">聚集列存储索引</strong>是大型表的最佳选择，但不建议用于少于6000万行的表。</p><ul class=""><li id="4a07" class="lc ld hi ix b iy iz jc jd jg le jk lf jo lg js lh li lj lk bi translated">表是按列组织的，这允许高度压缩</li><li id="d2d1" class="lc ld hi ix b iy ll jc lm jg ln jk lo jo lp js lh li lj lk bi translated">非常适合只读操作。</li><li id="515e" class="lc ld hi ix b iy ll jc lm jg ln jk lo jo lp js lh li lj lk bi translated">无法定义辅助索引。</li><li id="9ad5" class="lc ld hi ix b iy ll jc lm jg ln jk lo jo lp js lh li lj lk bi translated">rowgroup是一组以columnstore格式压缩的行。rowgroup中的一列数据称为列段，理想情况下应该包含一百万行。</li></ul><p id="8f6d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">堆表</strong>推荐用于临时或暂存表，以及少于6000万行的小型查找表。</p><ul class=""><li id="0263" class="lc ld hi ix b iy iz jc jd jg le jk lf jo lg js lh li lj lk bi translated">数据没有排序，事实上也没有索引。</li><li id="bd89" class="lc ld hi ix b iy ll jc lm jg ln jk lo jo lp js lh li lj lk bi translated">没有数据压缩。</li><li id="3c49" class="lc ld hi ix b iy ll jc lm jg ln jk lo jo lp js lh li lj lk bi translated">允许定义二级索引。</li></ul><p id="80cc" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">聚集索引</strong>是最常见的索引类型，也称为聚集B树。它是一个索引，保存的顺序与数据的索引顺序相同。</p><ul class=""><li id="9669" class="lc ld hi ix b iy iz jc jd jg le jk lf jo lg js lh li lj lk bi translated">没有压缩。</li><li id="b0d7" class="lc ld hi ix b iy ll jc lm jg ln jk lo jo lp js lh li lj lk bi translated">它通过非常有选择性的过滤器使得查询的执行非常快。</li><li id="dc54" class="lc ld hi ix b iy ll jc lm jg ln jk lo jo lp js lh li lj lk bi translated">允许定义二级索引。</li></ul><p id="5d21" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如何选择桌子的类型？</p><figure class="ky kz la lb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lt"><img src="../Images/efa44a93404a44b34397cb979929fd72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*urt2J7CRSbd5Sonjxlr6IA.png"/></div></div></figure><h1 id="2482" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">分割</h1><p id="825d" class="pw-post-body-paragraph iv iw hi ix b iy ks ja jb jc kt je jf jg ku ji jj jk kv jm jn jo kw jq jr js hb bi translated">分区表是这样一种表，其中数据被分成数据桶内的小组。通常，分区基于表中代表记录加载日期的列。</p><p id="3caf" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">使用分区的优点是:</p><ul class=""><li id="210a" class="lc ld hi ix b iy iz jc jd jg le jk lf jo lg js lh li lj lk bi translated">由于分区的删除、切换和合并，提高了数据加载的效率和性能；</li><li id="653d" class="lc ld hi ix b iy ll jc lm jg ln jk lo jo lp js lh li lj lk bi translated">更好的查询执行性能；</li><li id="1d28" class="lc ld hi ix b iy ll jc lm jg ln jk lo jo lp js lh li lj lk bi translated">装卸方便；</li><li id="a5b5" class="lc ld hi ix b iy ll jc lm jg ln jk lo jo lp js lh li lj lk bi translated">易于维护、改造和组织。</li></ul><p id="1311" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在定义分区时，您应该遵循一些实践:</p><ul class=""><li id="1dfe" class="lc ld hi ix b iy iz jc jd jg le jk lf jo lg js lh li lj lk bi translated">您不应该创建带有太多分区的表，因为在某些情况下这会降低性能；</li><li id="3f53" class="lc ld hi ix b iy ll jc lm jg ln jk lo jo lp js lh li lj lk bi translated">好的分区方案有10个或几百个分区；</li><li id="d40e" class="lc ld hi ix b iy ll jc lm jg ln jk lo jo lp js lh li lj lk bi translated">对于聚集的columnstore表，考虑每个分区中有多少行是很重要的。</li></ul><p id="d81d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">⚠️ <strong class="ix hj">注意</strong> ⚠️ <br/>在创建分区之前，表已经被MPP引擎分成了60个分布。</p><p id="0e8e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们看一个例子。选择根据一年中插入记录的日期对一个聚集的columnstore表进行分区将导致365个分区。总行数将如下所示:</p><blockquote class="lu lv lw"><p id="d433" class="iv iw jt ix b iy iz ja jb jc jd je jf lx jh ji jj ly jl jm jn lz jp jq jr js hb bi translated">60个分布* 365个分区= 21 900个数据桶</p><p id="7dda" class="iv iw jt ix b iy iz ja jb jc jd je jf lx jh ji jj ly jl jm jn lz jp jq jr js hb bi translated">21 900个数据桶* 1M(理想段大小)= 21 900 000 000行</p></blockquote><p id="f412" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">因此，建议使用较低的粒度，例如每周或每月一次。</p><h1 id="e53c" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">结论</h1><p id="44a9" class="pw-post-body-paragraph iv iw hi ix b iy ks ja jb jc kt je jf jg ku ji jj jk kv jm jn jo kw jq jr js hb bi translated">总而言之，让我们回顾一下如何将这些原则应用于事实表和维度表。</p><p id="9a66" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">事实数据表</strong></p><ul class=""><li id="1a2d" class="lc ld hi ix b iy iz jc jd jg le jk lf jo lg js lh li lj lk bi translated">如果很大，建议选择聚集列存储索引；</li><li id="b291" class="lc ld hi ix b iy ll jc lm jg ln jk lo jo lp js lh li lj lk bi translated">使用散列键控分布，只要数据在所有碎片上平均分割；</li><li id="7c62" class="lc ld hi ix b iy ll jc lm jg ln jk lo jo lp js lh li lj lk bi translated">只有当表大到足以填满每个列段时，才对表进行分区。</li></ul><p id="6bcc" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">尺寸表</strong></p><ul class=""><li id="b91f" class="lc ld hi ix b iy iz jc jd jg le jk lf jo lg js lh li lj lk bi translated">如果没有候选的连接键，使用散列或循环分布；</li><li id="0d1a" class="lc ld hi ix b iy ll jc lm jg ln jk lo jo lp js lh li lj lk bi translated">只有当表很大时，才选择聚集列存储索引；</li><li id="fcb2" class="lc ld hi ix b iy ll jc lm jg ln jk lo jo lp js lh li lj lk bi translated">为备用联接列添加辅助索引；</li><li id="bbc7" class="lc ld hi ix b iy ll jc lm jg ln jk lo jo lp js lh li lj lk bi translated">不建议分区。</li></ul><p id="b0a7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，您应该能够将自己的表定义到一个专用的SQL池中。请参考<a class="ae iu" href="https://docs.microsoft.com/en-us/azure/synapse-analytics/sql-data-warehouse/create-data-warehouse-portal" rel="noopener ugc nofollow" target="_blank">本教程</a>了解关于创建一个专用SQL池并将数据加载到其中的更多信息。</p></div></div>    
</body>
</html>