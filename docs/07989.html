<html>
<head>
<title>Manually obtain GoogleOAuth2 access token with your web browser and curl</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用web浏览器和curl手动获取GoogleOAuth2访问令牌</h1>
<blockquote>原文：<a href="https://medium.com/codex/manually-obtain-googleoauth2-access-token-with-your-web-browser-and-curl-fd93effe15ff?source=collection_archive---------3-----------------------#2022-07-09">https://medium.com/codex/manually-obtain-googleoauth2-access-token-with-your-web-browser-and-curl-fd93effe15ff?source=collection_archive---------3-----------------------#2022-07-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="49e5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果出于开发(或其他)原因，您需要手动从GoogleOAuth2获取访问令牌，您可以使用web浏览器和curl通过几个简单的步骤来完成。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/d1f860b15619820808cfa390d54a79e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*o9SI7XJT2ZoMU971"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">照片由<a class="ae jt" href="https://unsplash.com/@zisun_word?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">孙富</a>在<a class="ae jt" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</figcaption></figure><p id="2cf0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="ju">注意:本文部分基于以下两个资源。过去曾有过</em> <a class="ae jt" href="https://www.daimto.com/how-to-get-a-google-access-token-with-curl/" rel="noopener ugc nofollow" target="_blank"> <em class="ju">另一种方式做这个</em> </a> <em class="ju">，最近停止工作了。在我寻找新的解决方案的过程中，我在StackOverflow </em>  <em class="ju">上找到了这个</em> <a class="ae jt" href="https://stackoverflow.com/questions/66940072/get-google-oauth2-access-token-using-only-curl" rel="noopener ugc nofollow" target="_blank"> <em class="ju">的帖子，里面正在讨论这个方法。</em></a></p><h1 id="8fe3" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">向GoogleOAuth2注册应用程序</h1><p id="d931" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">为了从GoogleOAuth2获得一个访问令牌，你首先需要在<a class="ae jt" href="https://console.cloud.google.com/" rel="noopener ugc nofollow" target="_blank"> Google Cloud控制台</a>注册你的应用。</p><ol class=""><li id="2ceb" class="ky kz hi ih b ii ij im in iq la iu lb iy lc jc ld le lf lg bi translated">创建新项目</li><li id="13a8" class="ky kz hi ih b ii lh im li iq lj iu lk iy ll jc ld le lf lg bi translated">定义您的<a class="ae jt" href="https://console.cloud.google.com/apis/credentials/consent" rel="noopener ugc nofollow" target="_blank"> OAuth同意屏幕</a></li><li id="eb9c" class="ky kz hi ih b ii lh im li iq lj iu lk iy ll jc ld le lf lg bi translated">创建<a class="ae jt" href="https://console.cloud.google.com/apis/credentials" rel="noopener ugc nofollow" target="_blank">凭证</a></li></ol><h2 id="0d85" class="lm jw hi bd jx ln lo lp kb lq lr ls kf iq lt lu kj iu lv lw kn iy lx ly kr lz bi translated">创建凭据</h2><p id="fbc8" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">我们从第<a class="ae jt" href="https://console.cloud.google.com/apis/credentials" rel="noopener ugc nofollow" target="_blank">页的</a>开始:</p><ol class=""><li id="a2a3" class="ky kz hi ih b ii ij im in iq la iu lb iy lc jc ld le lf lg bi translated">选择页面顶部的<code class="du ma mb mc md b">+ Create Credentials</code></li><li id="b8a0" class="ky kz hi ih b ii lh im li iq lj iu lk iy ll jc ld le lf lg bi translated">选择<code class="du ma mb mc md b">OAuth client ID</code></li><li id="3135" class="ky kz hi ih b ii lh im li iq lj iu lk iy ll jc ld le lf lg bi translated"><code class="du ma mb mc md b">Web application</code>为申请类型</li><li id="9c4c" class="ky kz hi ih b ii lh im li iq lj iu lk iy ll jc ld le lf lg bi translated">随你的便吧</li><li id="a7f1" class="ky kz hi ih b ii lh im li iq lj iu lk iy ll jc ld le lf lg bi translated">在<code class="du ma mb mc md b">Authorized redirect URIs</code>下选择<code class="du ma mb mc md b">+ Add URI</code>并添加<code class="du ma mb mc md b"><a class="ae jt" href="http://127.0.0.1" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1</a></code></li><li id="2f59" class="ky kz hi ih b ii lh im li iq lj iu lk iy ll jc ld le lf lg bi translated">选择<code class="du ma mb mc md b">Create</code></li><li id="5f0f" class="ky kz hi ih b ii lh im li iq lj iu lk iy ll jc ld le lf lg bi translated">复制并保存显示的<code class="du ma mb mc md b">Client ID</code>和<code class="du ma mb mc md b">Client Secret</code></li></ol><h1 id="b5b6" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">获取访问令牌</h1><h2 id="98e7" class="lm jw hi bd jx ln lo lp kb lq lr ls kf iq lt lu kj iu lv lw kn iy lx ly kr lz bi translated">用户认证</h2><p id="9fa1" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">在您的web浏览器中，打开以下URI(不要忘记填写您的客户端id)并验证您的应用程序(如果需要，请登录您的帐户)。</p><pre class="je jf jg jh fd me md mf mg aw mh bi"><span id="84fd" class="lm jw hi md b fi mi mj l mk ml">https://accounts.google.com/o/oauth2/auth?client_id=&lt;CLIENT-ID&gt;&amp;redirect_uri=http://127.0.0.1&amp;scope=profile&amp;email&amp;response_type=code&amp;include_granted_scopes=true&amp;access_type=offline&amp;state=state_parameter_passthrough_value</span></pre><p id="1f94" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">认证后，Google将您重定向到您指定的重定向URI，它负责处理认证请求响应。由于没有服务器在此URI上运行，您的浏览器会显示一个错误页面。但是，在浏览器的地址栏中，你会发现来自谷歌的重定向请求。</p><pre class="je jf jg jh fd me md mf mg aw mh bi"><span id="ea4e" class="lm jw hi md b fi mi mj l mk ml">http://127.0.0.1/?...&amp;code=&lt;CODE&gt;&amp;...</span></pre><p id="45fd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在您的内部有一个名为<code class="du ma mb mc md b">code</code>的参数，我们将为下一步复制并保存它。</p><h2 id="2cf6" class="lm jw hi bd jx ln lo lp kb lq lr ls kf iq lt lu kj iu lv lw kn iy lx ly kr lz bi translated">请求访问令牌</h2><p id="208d" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">利用之前获得的代码参数，我们现在运行一个curl请求，向Google请求访问令牌。填写您的<code class="du ma mb mc md b">code</code>、<code class="du ma mb mc md b">client id</code>、<code class="du ma mb mc md b">client secret</code>和<code class="du ma mb mc md b">redirect URI</code>，并在您的终端中运行该命令。</p><pre class="je jf jg jh fd me md mf mg aw mh bi"><span id="4859" class="lm jw hi md b fi mi mj l mk ml">curl -X POST https://oauth2.googleapis.com/token \<br/>-d "code=&lt;CODE&gt;&amp;client_id=&lt;CLIENT-ID&gt;&amp;client_secret=&lt;CLIENT-SECRET&gt;&amp;redirect_uri=&lt;REDIRECT-URI&gt;&amp;access_type=offline&amp;grant_type=authorization_code"</span></pre><p id="0ef6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这会给你一个这样的回答:</p><pre class="je jf jg jh fd me md mf mg aw mh bi"><span id="90b1" class="lm jw hi md b fi mi mj l mk ml">{</span><span id="7362" class="lm jw hi md b fi mm mj l mk ml">  "access_token": "&lt;ACCESS-TOKEN&gt;",</span><span id="0c6d" class="lm jw hi md b fi mm mj l mk ml">  "expires_in": 3599,</span><span id="c239" class="lm jw hi md b fi mm mj l mk ml">  "refresh_token": "&lt;REFRESH-TOKEN&gt;",</span><span id="50fb" class="lm jw hi md b fi mm mj l mk ml">  "scope": "https://www.googleapis.com/auth/user.birthday.read     https://www.googleapis.com/auth/userinfo.email  https://www.googleapis.com/auth/userinfo.profile openid",</span><span id="cfbf" class="lm jw hi md b fi mm mj l mk ml">  "token_type": "Bearer",</span><span id="0aed" class="lm jw hi md b fi mm mj l mk ml">  "id_token": "XXX"</span><span id="2ef5" class="lm jw hi md b fi mm mj l mk ml">}</span></pre><p id="46d8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在您有了一个访问令牌，您可以将它用于开发等目的。</p><h2 id="cf9a" class="lm jw hi bd jx ln lo lp kb lq lr ls kf iq lt lu kj iu lv lw kn iy lx ly kr lz bi translated">刷新访问令牌</h2><p id="f044" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">如果您的访问令牌过期，请使用以下命令刷新它:</p><pre class="je jf jg jh fd me md mf mg aw mh bi"><span id="82a5" class="lm jw hi md b fi mi mj l mk ml">curl -X POST https://oauth2.googleapis.com/token \<br/>-d "access_type=offline&amp;refresh_token=[ZZZZ]&amp;client_id=&lt;CLIENT-ID&gt;&amp;client_secret=&lt;CLIENT-SECRET&gt;&amp;grant_type=refresh_token"</span></pre><h2 id="27eb" class="lm jw hi bd jx ln lo lp kb lq lr ls kf iq lt lu kj iu lv lw kn iy lx ly kr lz bi translated">其他范围</h2><p id="3257" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">在本例中，我们请求了用户的电子邮件和个人资料信息。如果您想使用您的访问令牌获取其他作用域，请将所需的作用域添加到您的请求中。</p><h1 id="99aa" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">结论</h1><p id="66c2" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">通过这些简单的步骤，您可以快速从GoogleOAuth2获得一个访问令牌。然后，您可以在开发过程中使用它来测试(部分)您的软件。</p></div></div>    
</body>
</html>