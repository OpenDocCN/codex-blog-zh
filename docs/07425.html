<html>
<head>
<title>Baby Name Analysis</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">婴儿名字分析</h1>
<blockquote>原文：<a href="https://medium.com/codex/baby-name-analysis-d611f0697802?source=collection_archive---------14-----------------------#2022-06-14">https://medium.com/codex/baby-name-analysis-d611f0697802?source=collection_archive---------14-----------------------#2022-06-14</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="848b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你搜索关于婴儿名字流行的文章，就不会缺少关于这个主题的文章。但是你看过真实的数据吗？</p><p id="aad9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如，2021年的大多数文章声称<em class="jd">加里、戴尔、哈德良、梅尔文和斯图尔特</em>是最不受欢迎的男孩名。这是真的吗？</p><p id="316e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">于是，我把6+M的行放在雪花里，自己看了看。从下面的图表可以看出，那些名字确实不受欢迎。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es je"><img src="../Images/7074d85088fce6e88873a5f5890df7bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*pWeyLhspn0NYOwk-jflE3g.png"/></div><figcaption class="jm jn et er es jo jp bd b be z dx translated">2021年最冷门的宝宝名字</figcaption></figure><p id="d20c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">不开玩笑！他们也已经不受欢迎很多年了。这篇2021年的文章可能是20年前写的，仍然是真实的。</p><p id="5c5c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当我想到这个问题时，我更感兴趣的是找到人气下降最快的名字。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es jq"><img src="../Images/1241d3c06e97b1a1419d1457f2376db5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1250/format:webp/1*eZpBk8AQDbUoFGwn8ZGiSQ.png"/></div><figcaption class="jm jn et er es jo jp bd b be z dx translated">截至2021年，减少最多的婴儿名字</figcaption></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es je"><img src="../Images/8962c044f12aec902bf4ca4b6e497828.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*_yuFQT2LO3maEW4wNY-ytg.png"/></div><figcaption class="jm jn et er es jo jp bd b be z dx translated">截至2021年，越来越多的婴儿名字</figcaption></figure><p id="caaa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">最减</strong>:艾登、伊森、雅各布、约书亚、亨特、瑞恩、马修<br/>T5】最增:亚舍、以斯拉、利奥、利亚姆、马华力、传奇、迈尔斯、奥利弗</p><p id="a579" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">马修并不令人惊讶——它在1957年达到顶峰，自20世纪70年代以来一直在下降。</p><p id="b941" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">另一方面，艾登在90年代之前几乎是闻所未闻的，并且在11年前才达到顶峰！现在，它是下降最快的国家之一。那么<em class="jd">艾登</em>怎么了？</p><p id="5b4e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我还觉得有趣的是，西奥多和狮子座曾在20世纪20年代达到顶峰，之后稳步下降，现在又开始快速攀升。</p><p id="a023" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">写这篇文章的时候(2022年)，电影《特立独行》刚刚上映。有趣的是,<em class="jd"> Maverick </em>这个名字已经开始流行，并且是增长最快的婴儿名字之一。</p></div><div class="ab cl jr js gp jt" role="separator"><span class="ju bw bk jv jw jx"/><span class="ju bw bk jv jw jx"/><span class="ju bw bk jv jw"/></div><div class="hb hc hd he hf"><blockquote class="jy"><p id="2729" class="jz ka hi bd kb kc kd ke kf kg kh jc dx translated">即使是像婴儿名字这样无聊的数据集，也可能包含有趣的见解(如果你知道如何去观察的话)</p></blockquote></div><div class="ab cl jr js gp jt" role="separator"><span class="ju bw bk jv jw jx"/><span class="ju bw bk jv jw jx"/><span class="ju bw bk jv jw"/></div><div class="hb hc hd he hf"><p id="5d69" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这篇博文的整个观点是，如果你知道如何寻找，即使是像婴儿名字这样无聊的数据集也可以包含一些有趣的见解。</p><p id="c14a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，我将带您浏览一些概念和代码，将来您可以将它们应用到自己的数据中。</p><h1 id="231d" class="ki kj hi bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">技术细节</h1><h2 id="ab34" class="lg kj hi bd kk lh li lj ko lk ll lm ks iq ln lo kw iu lp lq la iy lr ls le lt bi translated">决定绝对还是相对</h2><p id="b30a" class="pw-post-body-paragraph if ig hi ih b ii lu ik il im lv io ip iq lw is it iu lx iw ix iy ly ja jb jc hb bi translated">关于这个数据集，你会注意到一件事，那就是每年的婴儿总数波动很大。这可能会让人们觉得所有的婴儿名字都越来越不受欢迎，因为每个人生的孩子都越来越少了。所以我不得不问自己——我真的想知道哪些婴儿的名字用得更少了吗？还是我对<em class="jd">相对于其他</em>的衰落感兴趣？</p><p id="a3ad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我决定只关心婴儿名字受欢迎程度的相对下降，所以我在我的数据集中添加了一列，这是给定年份所有婴儿的总数，然后除以总数。这表示婴儿名字占当年婴儿的比例。</p><pre class="jf jg jh ji fd lz ma mb mc aw md bi"><span id="a248" class="lg kj hi ma b fi me mf l mg mh">WITH AGG_YEAR AS (<br/>  SELECT YEAR, SUM(BABYNAMECOUNT) AS BABYCOUNT_YEAR<br/>  FROM {{ main_table }}<br/>  GROUP BY YEAR<br/>  HAVING SUM(BABYNAMECOUNT) &gt; 0 <br/>),<br/>AGG_BABYNAME AS (<br/>  SELECT A.YEAR, A.BABYNAME, SUM(BABYNAMECOUNT) AS NAME_COUNT<br/>  FROM {{ main_table }}<br/>  GROUP BY A.YEAR, A.BABYNAME<br/>)<br/>SELECT AGG_BABYNAME.YEAR<br/>       AGG_BABYNAME.BABYNAME,<br/>       AGG_BABYNAME.NAME_COUNT,<br/>       AGG_BABYNAME.NAME_COUNT/AGG_YEAR.BABYCOUNT_YEAR AS NAME_PCT<br/>FROM AGG_BABYNAME<br/>INNER JOIN AGG_YEAR<br/>ON AGG_YEAR.YEAR = AGG_BABYNAME.YEAR;</span></pre><h2 id="6477" class="lg kj hi bd kk lh li lj ko lk ll lm ks iq ln lo kw iu lp lq la iy lr ls le lt bi translated">日晷</h2><p id="a35a" class="pw-post-body-paragraph if ig hi ih b ii lu ik il im lv io ip iq lw is it iu lx iw ix iy ly ja jb jc hb bi translated">婴儿名字数为零的年份呢？通常，数据库不会存储丢失或为零的东西。因此，为了表示每个婴儿名字的年份，即使它是零，我也必须应用一个叫做datespine的函数。</p><p id="f591" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">概念是这样的:<br/> -生成一个唯一婴儿名字的列表<br/> -生成一个唯一年份的列表<br/> -笛卡尔连接上面2个列表，得到每个组合<br/> -从笛卡尔连接的左外连接，到你的实际数据</p><p id="b80f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在雪花中，我利用了生成器功能:</p><pre class="jf jg jh ji fd lz ma mb mc aw md bi"><span id="060b" class="lg kj hi ma b fi me mf l mg mh">WITH GLOBAL_SPINE AS (<br/> SELECT<br/>  ROW_NUMBER() OVER (ORDER BY NULL) as INTERVAL_ID,<br/>  DATEADD('year', (INTERVAL_ID - 1), '1910-01-01T00:00'::timestamp_ntz) as SPINE_START,<br/>  DATEADD('year', INTERVAL_ID, '1910-01-01T00:00'::timestamp_ntz) as SPINE_END<br/> FROM TABLE (GENERATOR(ROWCOUNT =&gt; 111))<br/>),<br/>GROUPS AS (<br/> SELECT BABYNAME, MIN(YEAR) AS LOCAL_START, MAX(YEAR) AS LOCAL_END<br/> FROM {{ prior_table }}<br/> GROUP BY BABYNAME<br/>),<br/>GROUP_SPINE AS (<br/> SELECT BABYNAME, SPINE_START AS GROUP_START, SPINE_END AS GROUP_END<br/> FROM GROUPS G<br/> CROSS JOIN LATERAL <br/>   (SELECT SPINE_START, SPINE_END <br/>    FROM GLOBAL_SPINE S<br/>    )<br/>)<br/>SELECT G.BABYNAME AS GROUP_BY_BABYNAME,<br/>GROUP_START,<br/>GROUP_END,<br/>T.*<br/>FROM GROUP_SPINE G<br/>LEFT JOIN {{ prior_table }} T<br/>ON YEAR &gt;= G.GROUP_START<br/>AND YEAR &lt; G.GROUP_END<br/>AND G.BABYNAME = T.BABYNAME</span></pre><h2 id="ccfa" class="lg kj hi bd kk lh li lj ko lk ll lm ks iq ln lo kw iu lp lq la iy lr ls le lt bi translated">单位呢？</h2><p id="18c9" class="pw-post-body-paragraph if ig hi ih b ii lu ik il im lv io ip iq lw is it iu lx iw ix iy ly ja jb jc hb bi translated">一旦我这样做了，我就在处理百分比。你的分析是不是没问题？我只想比较不同时间的百分比，所以我认为这对于这个用例是可以的。但是，如果你想再次处理真实的单位呢？处理这种情况的一种方法是将百分比乘以一个固定的指数(如2000年的婴儿总数)。这代表你的“2000年婴儿”数据我决定不这样做，但想提一下，因为这是我考虑的事情。</p><h2 id="e1bf" class="lg kj hi bd kk lh li lj ko lk ll lm ks iq ln lo kw iu lp lq la iy lr ls le lt bi translated">定义增加/减少</h2><p id="5577" class="pw-post-body-paragraph if ig hi ih b ii lu ik il im lv io ip iq lw is it iu lx iw ix iy ly ja jb jc hb bi translated">有许多方法来定义增加/减少。一种方法是:<br/> -计算前5年的移动平均值<br/> -延迟移动平均值以得到10年前的移动平均值<br/> -计算当前平均值和10年前平均值之间的百分比差异</p><p id="7853" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">另一种选择是计算前10年的斜率。SQL可能会变得复杂，但是因为我使用的是<a class="ae mi" href="http://app.rasgoml.com" rel="noopener ugc nofollow" target="_blank"> Rasgo </a>，SQL是为我编写的，所以我选择了这个方法(顺便说一下，它是免费的)。</p><pre class="jf jg jh ji fd lz ma mb mc aw md bi"><span id="784f" class="lg kj hi ma b fi me mf l mg mh">WITH  CTE_RANK AS (<br/>  SELECT *, ROW_NUMBER() OVER(PARTITION BY GROUP_BY_BABYNAME <br/>  ORDER BY GROUP_START ASC) AS RANK_GROUP_START<br/>  FROM {{ prior_table }}<br/>),<br/>CTE_WINDOW AS (<br/>  SELECT A.GROUP_BY_BABYNAME, A.RANK_GROUP_START,<br/>   ARRAY_AGG(ARRAY_CONSTRUCT(B.BABYCOUNT, B.RANK_GROUP_START)) ARRAY_AGG_OBJ<br/>  FROM CTE_RANK A<br/>  JOIN CTE_RANK B<br/>  ON A.GROUP_BY_BABYNAME=B.GROUP_BY_BABYNAME<br/>  AND A.RANK_GROUP_START BETWEEN B.RANK_GROUP_START <br/>  AND B.RANK_GROUP_START+10<br/>  GROUP BY A.GROUP_BY_BABYNAME, A.RANK_GROUP_START<br/>),<br/>CTE_SLOPE AS (<br/>  SELECT GROUP_BY_BABYNAME, RANK_GROUP_START, <br/>   regr_slope(X.VALUE[0], X.VALUE[1]) AS BABYCOUNT_SLOPE_10<br/>  FROM CTE_WINDOW, table(flatten(ARRAY_AGG_OBJ)) X<br/>  GROUP BY GROUP_BY_BABYNAME, RANK_GROUP_START<br/>),<br/>CTE_RESULT AS (<br/>  SELECT A.GROUP_BY_BABYNAME, A.GROUP_START, B.BABYCOUNT_SLOPE_10<br/>  FROM CTE_RANK A<br/>  INNER JOIN CTE_SLOPE B<br/>  ON A.GROUP_BY_BABYNAME = B.GROUP_BY_BABYNAME<br/>  AND A.RANK_GROUP_START = B.RANK_GROUP_START<br/>)<br/>SELECT A.*, B.BABYCOUNT_SLOPE_10<br/>FROM {{ prior_table }} A<br/>LEFT OUTER JOIN CTE_RESULT B<br/>ON A.GROUP_BY_BABYNAME = B.GROUP_BY_BABYNAME<br/>AND A.GROUP_START = B.GROUP_START</span></pre><h2 id="5e94" class="lg kj hi bd kk lh li lj ko lk ll lm ks iq ln lo kw iu lp lq la iy lr ls le lt bi translated">移除异常值</h2><p id="6bbb" class="pw-post-body-paragraph if ig hi ih b ii lu ik il im lv io ip iq lw is it iu lx iw ix iy ly ja jb jc hb bi translated">在处理百分比、斜率等时，可能会出现极端的罕见名称。例如，一个名字可能每年有3个，现在有30个，增长了10倍。我可能不太在乎这些，因为它们太稀有了。</p><p id="e8c6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">处理这种情况的一种方法是对您的分析应用一个过滤器，只考虑在前一年中出现至少250次的婴儿名字。</p><p id="59fe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">处理这个问题的另一种方法是使用经验贝叶斯来调整婴儿的百分比。我不认为它适用于这种情况，但我想提一下，因为有时这是一种有效的方法。我计划将来某个时候写一篇关于这种方法的博客。对于这个分析，我只是应用了一个简单的过滤器来去掉那些超级罕见的名字。</p></div><div class="ab cl jr js gp jt" role="separator"><span class="ju bw bk jv jw jx"/><span class="ju bw bk jv jw jx"/><span class="ju bw bk jv jw"/></div><div class="hb hc hd he hf"><p id="e34c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过将上面的步骤串联起来，我能够很快得到一个增加和减少最多的名字列表。我只是简单地将这个列表与原始数据连接起来，这样我就可以绘制它们随时间变化的计数。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="er es mj"><img src="../Images/42fb60a17f67a20ef9a8b6a4d9b13d6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_I1hWz_cnv7R-_dSUgGfIw.png"/></div></div><figcaption class="jm jn et er es jo jp bd b be z dx translated">最终图表</figcaption></figure><p id="d3f7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我希望这对你有用！如果你有任何问题、意见或新想法，可以在Slack上联系我。我在<a class="ae mi" href="https://datatalks.club/" rel="noopener ugc nofollow" target="_blank"> DataTalks.club </a>或者<a class="ae mi" href="https://rasgousergroup.slack.com/" rel="noopener ugc nofollow" target="_blank"> RasgoUserGroup </a>都是最活跃的。</p></div></div>    
</body>
</html>