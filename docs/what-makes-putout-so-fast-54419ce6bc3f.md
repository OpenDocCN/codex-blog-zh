# æ˜¯ä»€ä¹ˆè®©è¾“å‡ºè¿™ä¹ˆå¿«ï¼Ÿ

> åŸæ–‡ï¼š<https://medium.com/codex/what-makes-putout-so-fast-54419ce6bc3f?source=collection_archive---------14----------------------->

![](img/1e5ba2fb48abd05fbc26ad13da937183.png)

> â€œé€Ÿåº¦ä¸æ˜¯çœŸæ­£çš„æˆ˜ç•¥æ–¹å¼çš„ä¸€éƒ¨åˆ†ã€‚é€Ÿåº¦æ„å‘³ç€äº‹ç‰©çœ‹èµ·æ¥å¿«æˆ–æ…¢ï¼Œå–å†³äºå®ƒä»¬æ˜¯å¦æœ‰èŠ‚å¥ã€‚ä¸ç®¡æ˜¯å“ªç§æ–¹å¼ï¼Œæˆ˜ç•¥å¤§å¸ˆéƒ½ä¸ä¼šå¾ˆå¿«å‡ºç°ã€‚â€â€”å®«æœ¬æ­¦è—

å—¨ä¼™è®¡ä»¬ï¼é™¤äº† AST ä¹‹å¤–ï¼Œæˆ‘ä»Šå¤©æœ€æ¿€åŠ¨äººå¿ƒçš„æ¶ˆæ¯æ˜¯æˆ‘çš„é€Ÿåº¦å†’é™©ï¼Œæ‰€ä»¥ç³»å¥½å®‰å…¨å¸¦ï¼Œæˆ‘ä»¬èµ°å§ï¼

# éšè—ç‰©

å¥½çš„ï¼Œè®©æˆ‘ä»¬æ£€æŸ¥ä¸€ä¸‹ğŸŠ[æ”¾å‡º](https://github.com/coderaiser/putout)æœ¬èº«ã€‚åœ¨æ’°å†™æœ¬æ–‡æ—¶ï¼Œå®ƒæœ‰ **2402** ä¸ªæ–‡ä»¶ï¼ŒåŒ…æ‹¬:
-âœ…JavaScriptï¼›
-âœ…JSONï¼›
- âœ…é™ä»·(+ jsï¼Œtsï¼ŒJSON)ï¼›
â€”â€”âœ…YAMLï¼›
- âœ… `.gitignore 'å’Œ`. npmignore '

ä»¥ä¸‹æ˜¯å…³äº[æ•°å­—æµ·æ´‹æ°´æ»´](https://m.do.co/c/331c4947c5df)çš„ç»“æœ:

```
coderaiser@cloudcmd:~/putout$ time redrun lint
> putout . â€” raw â€” rulesdir rulesreal 0m23.321s
user 0m21.971s
sys 0m1.137s
```

ä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«å°±é—®ï¼ŸåŸå› æ˜¯:ç¼“å­˜ä½äº

```
node_modules/.cache/putout/places
```

å®ƒæ˜¯åœ¨ç¬¬ä¸€ä¸ªæ­£ç¡®çš„åŸºç¡€ä¸Šåˆ›å»ºçš„ï¼Œæœ‰ 3 ä¸ªç‹¬ç‰¹ä¹‹å¤„:
-node . js çš„ç‰ˆæœ¬ï¼›
-ç‰ˆæœ¬ğŸŠè¾“å‡ºï¼›
-é€‰é¡¹ï¼›

å½“è¿™éƒ¨åˆ†å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨`â€” fresh 'æ ‡å¿—:

```
coderaiser@cloudcmd:~/putout$ time redrun lint â€” â€” fresh
> putout . â€” raw â€” rulesdir rules â€œ â€” freshâ€real 4m24.870s
user 4m16.093s
sys 0m5.757s
```

**4 åˆ†é’Ÿ**ï¼Œæ‰€ä»¥å¤§çº¦æ˜¯ **264 ç§’ï¼Œ**æ‰€ä»¥å¦‚æœæˆ‘ä»¬æŒ‰æ—¶é—´åˆ’åˆ†æ–‡ä»¶æ•°ï¼Œæˆ‘ä»¬å°†å¾—åˆ°:

```
2402 / 264 = 9
```

**ä¸ä½¿ç”¨ç¼“å­˜æ¯ç§’ 9 ä¸ªæ–‡ä»¶ï¼**

è¿™æ˜¯è·‘æ­¥çš„ç»“æœğŸŠ**è¾“å‡º** + **ESLint** è¿™ä¹ˆå¤šæ”¯æŒçš„æ ¼å¼ï¼è€Œè¿™ä»…ä»…æ˜¯ä¸ºäº†ä¸€ä¸ªå¦‚æ­¤å¤§çš„é¡¹ç›®çš„æ–°è¿è¡Œã€‚

**è®°å¿†åŒ–**

> **è®°å¿†åŒ–â€”â€”ä¸€ç§ä¼˜åŒ–æŠ€æœ¯ï¼Œä¸»è¦ç”¨äºé€šè¿‡å­˜å‚¨æ˜‚è´µçš„å‡½æ•°è°ƒç”¨çš„ç»“æœå¹¶åœ¨ç›¸åŒçš„è¾“å…¥å†æ¬¡å‡ºç°æ—¶è¿”å›ç¼“å­˜çš„ç»“æœæ¥åŠ é€Ÿè®¡ç®—æœºç¨‹åº**ã€‚
> 
> ç»´åŸºç½‘

æœ€ç®€å•çš„æ’ä»¶æ ¼å¼æ˜¯[**Replacer**](https://github.com/coderaiser/putout/tree/master/packages/engine-runner#replacer)**ã€‚**å®ƒç”¨äº†å¾ˆå¤šğŸ¦ [**è¾“å‡ºè„šæœ¬**](https://github.com/coderaiser/putout/blob/master/docs/putout-script.md#-putoutscript) ï¼Œä¸‹é¢æ˜¯ä¾‹å­:

```
module.exports.report = () => 'any message here';

module.exports.replace = () => ({
    'let __a = __b': 'const __a = __b',
});
```

åƒè¿™æ ·çš„è¡¨æƒ…:

```
let __a = __b
```

è¢«è§£ææˆ [AST](https://github.com/coderaiser/putout/blob/master/docs/the-book-of-ast.md#the-book-of-ast) æ ¼å¼ã€‚è¿™æ˜¯ä¸€ä¸ªæ‰©å±•çš„æ“ä½œï¼Œä½†æ˜¯è¿™ä¸ªç®€çŸ­çš„è¡¨è¾¾å¼ç»å¸¸é‡å¤ï¼Œæ‰€ä»¥è®°å¿†ç‰ˆæœ¬çš„è§£æç”¨æ¥ä½¿äº‹æƒ…å˜å¾—æ›´å¿«ã€‚

# ä»€ä¹ˆèƒ½è®©äº‹æƒ…å˜å¾—æ›´å¿«ï¼Ÿ

åœ¨ä¸­ä½¿ç”¨äº†å‡ ä¸ªæ“ä½œğŸŠ**è¾“å‡º**å¤§éƒ¨åˆ†æ—¶é—´:

*   è¯»/å†™æ–‡ä»¶ï¼›
*   è§£ææ–‡ä»¶ï¼›
*   ä»è¯­æ³•ä¸Šåˆ†æğŸ¦**PutoutScriptï¼›**
*   ç©¿è¶Šï¼›

ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿä¸ä¼šç»™æˆ‘ä»¬å¸¦æ¥ä»»ä½•å¥½å¤„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è·³è¿‡å®ƒã€‚

è§£ææ–‡ä»¶æ›´å¥½ï¼Œä½†æ˜¯æˆ‘ä»¬ç¨åå†å›æ¥ã€‚éå†åº”è¯¥åœ¨ JavaScript ç«¯è¿›è¡Œï¼Œå› ä¸ºæ‰€æœ‰çš„æ’ä»¶éƒ½æ˜¯åŸºäº JavaScript çš„ã€‚

æ‰€ä»¥æˆ‘ä»¬å¯ä»¥è§£æğŸ¦**è¾“å‡ºè„šæœ¬**æ›´å¿«**ã€‚**å¦‚ä½•**ï¼Ÿ**

## [çš®å¨œ-rs](https://github.com/napi-rs/napi-rs)

> ç”¨äºåœ¨`Rust`ä¸­ç¼–è¯‘`Node.js`é™„åŠ ç»„ä»¶çš„æœ€å°åº“ã€‚

æˆ‘é¦–å…ˆæƒ³åˆ°çš„æ˜¯ç”¨ Rust æ¥åŠ é€Ÿã€‚ä½†æ˜¯å¦‚å‰æ‰€è¿°ï¼Œmemoization ç”¨äºè§£æç›®çš„ï¼Œå½“æˆ‘ä»¬éœ€è¦ [**æ¯”è¾ƒ**](https://github.com/coderaiser/putout/tree/master/packages/compare#readme) èŠ‚ç‚¹æ—¶ï¼Œè¿™ä¹Ÿæ˜¯éå¸¸å¿«é€Ÿçš„æ“ä½œ(å¤§çº¦ 2ms)ï¼Œå¹¶ä¸”ä¸ºäº†ä½¿ç”¨ Rust æˆ‘ä»¬éœ€è¦åšä¸€ä»¶äº‹æƒ…:

*   ä½¿ç”¨ Rust éå† JSON
*   è½¬æ¢ä¸º BSONï¼Œç„¶åå°†ç»“æœä¼ é€’ç»™ Rustï¼Œç„¶åå†æ¬¡è½¬æ¢ï¼›

è¿™ä¸¤ç§æƒ…å†µéƒ½å¾ˆéš¾è¶…è¶ŠåŸºäº JavaScript çš„ 2 æ¯«ç§’**æ¯”è¾ƒ**ã€‚

## [wasm-bindgen](https://github.com/rustwasm/wasm-bindgen)

> ä¿ƒè¿› Wasm æ¨¡å—å’Œ JavaScript ä¹‹é—´çš„é«˜çº§äº¤äº’ã€‚

å‡ ä¹ç›¸åŒï¼Œä½†åŸºäº WebAssembly çš„è§£å†³æ–¹æ¡ˆã€‚åŒæ ·ï¼Œæœ‰ä¸€ä¸ªé—®é¢˜æ²¡æœ‰ç­”æ¡ˆï¼Œé‚£å°±æ˜¯åœ¨é“é”ˆä¸Šåº”è¯¥å†™äº›ä»€ä¹ˆğŸ¤·â€â™‚ï¸.

## swc

> åŸºäº Rust çš„ç½‘ç»œå¹³å°

å¥½å§ï¼Œè¿™æ˜¯ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼Œå› ä¸ºæˆ‘ä»¬ä»ç„¶æœ‰ä¸€ä¸ªæ–‡ä»¶è§£æï¼Œè¿™è‚¯å®šæ˜¯å¯ä»¥åŠ é€Ÿçš„ã€‚

ä¸‹é¢æ˜¯æˆ‘ä»¬ç”¨æ¥æ¯”è¾ƒä¸€ä¸ªéå¸¸å¤§çš„æ–‡ä»¶( **44k** )çš„é€Ÿåº¦çš„ä»£ç :

```
const {readFileSync} = require('fs');const {parseSync} = require('[@swc/core](http://twitter.com/swc/core)');
const {parse} = require('putout');const source = readFileSync('./lib/cli/index.spec.js', 'utf8');console.time('swc #1');
parseSync(source);
console.timeEnd('swc #1');console.time('swc #2');
parseSync(source);
console.timeEnd('swc #2');console.time('babel #1');
parse(source);
console.timeEnd('babel #1');console.time('babel #2');
parse(source);
console.timeEnd('babel #2');
```

ç»“æœå¦‚ä¸‹:

```
swc #1: 13.898ms
swc #2: 13.33ms
babel #1: 236.062ms
babel #2: 132.123ms
```

**SWC** æ¯”**å¿« 10 å€**æ¯”**é€šå¤©å¡”**ï¼æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥è§£æã€‚

é…ªå®ƒæœ‰ä¸åŒçš„å†…éƒ¨æ ¼å¼:ASTã€‚è¿™ä¸ªå…¶å®æ˜¯å¯ä»¥è§£å†³çš„ï¼Œæœ‰ä¸€ä¸ªå·¥å…·[**SWC-to-Babel**](https://github.com/coderaiser/swc-to-babel)**æ—¨åœ¨å°† **SWC** æ ¼å¼è½¬æ¢ä¸º **Babel** ï¼Œä½†æ˜¯å·®åˆ«å¾ˆå¤§ï¼Œ **SWC** ä¸æ”¯æŒ:**

*   **è¯„è®ºï¼›**
*   **ä½ç½®æ•°æ®(å·²æ±‚è§£)ï¼›**
*   **éƒ¨åˆ†è§£æï¼›**
*   **æ‰€æœ‰æ–°è¯­æ³•**å·´åˆ«å¡”**æ”¯æŒ**

**ç”šè‡³åœ¨è¿›è¡Œäº†ä¸€äº›è½¬æ¢ä¹‹åï¼Œåƒåˆ é™¤èŠ‚ç‚¹è¿™æ ·ç®€å•çš„è½¬æ¢ä¹Ÿä¸èµ·ä½œç”¨ã€‚ä½¿ç”¨é¢å¤–çš„è§£æå™¨ä¹Ÿä¼šä½¿äº‹æƒ…å˜å¾—ä¸ç¨³å®šï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»ä½¿ç”¨äº†[é‡é“¸](https://github.com/benjamn/recast)ã€[å·´åˆ«å¡”](https://babeljs.io/)å’Œ [ESLint](https://eslint.org/) ã€‚ä»–ä»¬æ¯ä¸ªäººéƒ½æœ‰è‡ªå·±çš„å†’é™©ç»å†ã€‚**

# **ç»“è®º**

**æ˜¯çš„ï¼Œæœ‰äº›äº‹æƒ…æ˜¯å¯ä»¥æ”¹è¿›çš„ï¼Œè€Œä¸”è‚¯å®šä¼šæ”¹è¿›ï¼æˆ‘å¾ˆæ„Ÿæ¿€ä»»ä½•æ–¹å‘çš„å¸®åŠ©ã€‚ä¸ç®¡æ€æ ·ï¼Œäº‹æƒ…ä»ç„¶è¿›è¡Œå¾—å¾ˆå¿«ã€‚**

**å¦‚æœä½ å–œæ¬¢æˆ‘æ­£åœ¨åšçš„äº‹æƒ…ï¼Œä½ å¯ä»¥åœ¨ [Patreon](https://www.patreon.com/coderaiser) æˆ– [ko-fi](https://ko-fi.com/coderaiser) ä¸Šæ”¯æŒæˆ‘ã€‚å¦‚æœæ‚¨éœ€è¦ä»»ä½•ä»£ç è½¬æ¢ï¼Œåªéœ€[åˆ›å»ºä¸€ä¸ªé—®é¢˜](https://github.com/coderaiser/putout/issues/new)ï¼Œæˆ‘éšæ—¶ä¹æ„æä¾›å¸®åŠ©ğŸ™‚ã€‚**