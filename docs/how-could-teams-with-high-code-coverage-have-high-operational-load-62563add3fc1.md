# 高代码覆盖率的团队怎么可能有高的操作负载？？？

> 原文：<https://medium.com/codex/how-could-teams-with-high-code-coverage-have-high-operational-load-62563add3fc1?source=collection_archive---------3----------------------->

## 关于成功和失败的故事

![](img/6e5bd2f8093d8004e4276c8aa4d17b8d.png)

在我 25 年的从业生涯中，我工作过的所有 3 家公司(谷歌、亚马逊和微软)在收集数据方面都很自律，并且在商业决策中以数据为导向。今天，我想结合我生活中的三个小插曲，涵盖成功和失败的有趣方面。

# [1]我在写自己的宣传片时学会了什么是黄鼠狼的话

![](img/d90424d8a41df357a6537b0d9f1b2de9.png)

你能找出这幅画中的狡猾的词语吗？

2011 年，我告诉我的老板，我相信我已经准备好被提升为高级工程师。“好，写你的宣传片正当理由！”他问。所以我启动了微软的 Word，写了几页，用电子邮件发给了他。第二天，他给我回了邮件，里面大概有 40 到 50 个重点句子。

唯一的评论是“**黄鼠狼的话！**

我不知道那是什么意思，所以第二天早上我去了他的办公室，给自己上了一堂课。**[**黄鼠狼语**](https://en.wikipedia.org/wiki/Weasel_word) **“是对一个句子没有什么价值的词。**这个术语的起源不清楚，一种解释是黄鼠狼通过一个小孔吸取鸟蛋，留下空壳(一个黄鼠狼的词基本上就是那个壳:表面上看起来很好，但里面没有实际价值)。“黄鼠狼”这个词在非正式英语中确实有负面含义，用来形容人们狡诈、偷偷摸摸、狡猾或不值得信任，但黄鼠狼词汇与此无关。如果有人在你写的文章中指出一个含糊的词，这并不意味着他们说你卑鄙或狡猾，这只是意味着他们希望你用数据和事实代替废话。**

**这并不是我所希望的吉祥的开始。我对晋升文件并不陌生:我在微软被提升过几次，在我担任经理期间也提升过我的四名工程师。没有人抱怨过我之前写的宣传片。但是亚马逊是一家不同的公司，亚马逊人对模糊性有一种特别的本能反应。**

**所以我回去试着用确凿的事实和数据代替尽可能多的黄鼠狼式的话，去掉**个人观点、主观陈述、绒毛和没有增加太多价值的话。我给他发了修订版#2。第二天它也回来了，但这次有大约 20 个突出显示的部分。****

**唯一的评论又是“**黄鼠狼的话！****

**这份文件来来回回又过了大约四次，直到没有闪烁其词。每修改一次，我就越来越恼火他一直把它退回来。但是每一次修订，我都更加了解自己，我是谁，以及如何讲述我的故事。我的经理不是一个混蛋，但他非常清楚我目前的报告在晋升委员会面前是站不住脚的。**

**这是我对亚马逊处理含糊其辞的方式的尝试性介绍。从那时起，我就非常热衷于去除技术文档中的绒毛，尽可能用事实和数据取代主观陈述。**

# **[2]具有高代码覆盖率的团队怎么会有高的操作负载呢？？？**

**快进一年。2012 年，让忙碌的亚马逊开发人员编写合适的单元测试就像拔牙一样困难。今天，这是一个行业标准的做法，但十年，十五年前不是。[我创建了一个工具，以一些新颖的方式测量代码覆盖率，这有助于突出单元测试中的差距。令我兴奋的是，它让人们关注一个问题(缺乏适当的测试覆盖)，并且改变了行为和文化(将单元测试变成你一直在做的事情)。我的团队喜欢它，所以我想把它推广到其他团队。我在周末和晚上把它作为一个辅助项目来推广，并把它放在那里给公司里的任何人使用。令我失望的是，它最初并没有起飞。](https://carloarg02.medium.com/16a5818a57a5)**

**我的草根、自下而上的领养方法并没有奏效。自上而下的方法可行吗？我想知道。所以我抽出时间和我的副总裁在一起，向他解释了我的想法。我想让他正式认可我的小工具，这样他的经理们就会试一试。他对这个想法持开放态度，但需要数据来证明这是值得的。**

**我的论点很简单:**

*   **我的工具突出了代码覆盖中的缺口，以便开发人员能够解决它们。这将推动更高的代码覆盖率。**
*   **更高的代码覆盖率意味着更少的产品区域没有被测试。**
*   **较少的产品区域未经测试意味着较少的缺陷进入生产。**
*   **更少的缺陷进入生产意味着团队更少的操作痛苦。**

**我不能完全证明[因果关系](https://www.scribbr.com/methodology/correlation-vs-causation/#:~:text=does%20the%20other.-,A%20correlation%20is%20a%20statistical%20indicator%20of%20the%20relationship%20between,a%20causal%20link%20between%20them.)，但是也许我可以找到高代码覆盖率和低操作问题之间的[相关性](https://www.scribbr.com/methodology/correlation-vs-causation/#:~:text=does%20the%20other.-,A%20correlation%20is%20a%20statistical%20indicator%20of%20the%20relationship%20between,a%20causal%20link%20between%20them.)。**

**因此，我花了一周时间为我组织中的每个团队启用我的工具，获取每个团队的代码覆盖度量和票证计数，运行过去几年的统计分析，并将其绘制在一个精美的 Excel 电子表格中。我为大约 45 个团队这样做过。**

****我发现有*高代码覆盖率*的团队有*高操作负载*。****

**等等，什么？？？？**

**![](img/59379479c35bccba7947ae867be799ca.png)**

**这和我预料的相反。这没有任何意义。直觉上，在测试覆盖率上有巨大差距的团队应该更有可能让问题逃脱到生产中，不是吗？**

**我反复检查了我的数据和数学。这都是正确的。我对我的发现非常恼火。当我不得不告诉我的副总裁我的数据证明我的论文不成立时，我和他进行了一次非常不愉快的一对一谈话。他只是傻笑着说:“那好，去搞清楚为什么！”**

**接下来的几周，我深入研究了这种相关性。最终，我明白了罪魁祸首。**

***具有较高代码覆盖率的团队通常是更强调操作和工程优秀的团队。*随着对卓越运营的重视，出现了出色的 prod 遥测和非常严格的警报阈值，因为这些团队非常关心了解他们的系统何时处于降级状态，以及早期干预和缓解。他们有很多警报，这反过来又导致了监控系统中相当高数量的自动切割罚单，因此带来了很高的操作难度。**

**代码覆盖率低的团队通常没有在他们的度量和警报上投入大量的精力或思想，所以他们没有很多自动切割的标签。*问题正在转移到生产中，但是它们没有被发现。他们的顾客没有抱怨吗？我想知道。事实上，没有，因为他们已经习惯了那些不可靠的系统，所以他们把呼叫包装在重试中，这掩盖了剥落。有些人甚至建立了完整的缓解机制，如缓存，以承受一段时间的不可靠依赖。他们没有伟大的系统，他们有蹩脚的系统，但他们不知道他们有多蹩脚！***

**我论文的基础有缺陷。事实上，我的论文太简单了。当我开始深入思考这个问题时，我意识到代码覆盖率是可能影响操作负载的几十个维度之一。更多的警报可能会影响操作负载，更高的代码变动，使用更多未经证实的尖端技术，团队中工程师的资历，产品复杂性，等等。**

**即使我可以证明高代码覆盖率和低操作负载之间的因果关系或相关性，我也刚刚意识到*的操作负载*无论如何都不是*产品质量*的一个很好的代表。**

**我从未说服我的副总裁授权他的团队使用我的工具，但这个故事确实有一个美好的结局。如果你对剩下的部分感兴趣，你可以在我的故事[中读到它:“当猫照镜子时，它们看到了狮子——我如何改变了我们在亚马逊处理代码覆盖的方式，并结识了杰夫·贝索斯！”](https://carloarg02.medium.com/16a5818a57a5)**

***【虽然我已经引起了您对代码覆盖主题的关注，但我与几位优秀的高级工程师合作撰写了一份关于 Google* *代码覆盖最佳实践的白皮书，您可能会感兴趣！】***

# **[3]很难获得工程生产率提高的数据**

**我在*工程生产力*工作。我是谷歌集成测试产品的技术主管。我的最终目标和热情是减少大约十万名谷歌工程师在测试过程中的辛劳，这样他们就有更多的时间来创建你们都使用和喜爱的面向客户的功能。在谷歌之前，我在亚马逊的 Builder Tools 工作，也负责编辑、审查、构建、测试和发布代码的全公司开发工具。**

**面向客户的产品通常会赚钱，所以很容易用美元符号来量化你所做的影响。但是当你的工作是让别人更有效率时，你如何量化你的影响呢？**

**我思考我所做的任何事情的影响的一个方面是，我这样做是为了帮助他人节约资源。这通常转化为开发人员的时间(这是一种非常昂贵的资源)，但有时也可能是硬件(运行测试或操作生产车队所需要的)。**

**但是节约资源只是一个维度。人们测试的原因是为了防止错误进入生产环境并影响真正的客户。因此，我也可以将我的影响转化为较少的缺陷影响到使用我们产品的人。**

**你节省了多少时间，防止了多少错误，通常很难量化。有时候，就是没有数据。其他时候，数据是间接的，所以您只能用代理数据来近似它。**

**早在 2013 年，[我创建了负载和性能测试平台，亚马逊用它来确保其数以千计的服务准备好处理峰值流量](https://carloarg02.medium.com/how-i-grew-an-engineering-productivity-tool-to-impact-thousands-of-engineers-at-amazon-and-how-28a990091207)(“TPS generator”)。在早期，我需要量化它的影响，以说服领导层继续投资于它，因为它只是我的一个宠物项目，一直处于被取消资助的边缘。**

**我可以很容易地测量**客户采用**:有多少团队加入，他们多久运行一次负载测试，我的平台每天运行多少测试，它多久基于延迟回归发布一次。但是客户采用是一个*间接指标*。只是因为有更多的人在用我的东西，并不一定证明它对公司有更多的商业价值。直觉上，如果你认为一个东西提供了价值，使用它的人越多，它为公司提供的价值就越大。但是你首先需要证明价值。**

**我相信这个平台减少了负载测试的工作量，从几周减少到几天。我想，如果我能收集一些数据来支持这一说法，这将增加我的客户采用指标。数学可能很简单。我有 X 个客户，我为每个客户节省了 Y 天的辛劳，所以我为公司节省了 X*Y/365 年的开发时间。**

**我进行了一项大型调查，询问人们在使用我的平台之前花了多长时间进行负载测试，以及他们使用我的平台花了多长时间。**

**这个数据仍然是主观的。每个参与调查的人都没有用秒表准确测量他们浪费了多少时间，但是他们有一个粗略的估计。尽管每一个单独的数据点都是主观的，但是大规模地聚集起来增加了度量的可信度，因为“XXX 开发人员对调查的回应表明该框架为他们节省了 YYY 的辛苦时间”这句话比“Carlos 感觉该框架节省了 ZZZ 的辛苦时间”更可信**

**像这样的调查不能保证是完美的。也许我发送调查的人并不能代表整个公司([选择偏差](https://catalogofbias.org/biases/selection-bias/))。或者也许他们对辛劳的评估是错误的。**

**我意识到我永远不会收集到一个完美的度量标准，但是我不想让完美成为好的敌人。在我从调查中收集到的节省时间(一个*估计值*)和使用我的产品的实际客户数量(一个*事实*)之间，我可以在一定程度上自信地说，该产品为 NNN 公司节省了多年的辛劳。是的，*估计*事实=估计*，但是我从有意测量我的工作的影响中获得了巨大的价值，即使它在统计学上并不合理。**

**我也开始收集个人故事。我收到的每一封来自客户的电子邮件都说“你的东西很酷，我可以做我以前不能做的事情！”变成了一份 23 页的客户评价文件。这不是确凿的事实，但它捕捉到了一种对我所建造的工程的满足感。**

**不要害怕捕捉主观信息——这是对你正在收集的数据的一个很好的检查。它扩大了它。如果你的事实和数据告诉你你是成功的，但是你的客户告诉你你不是…你不是。反之亦然。这两者之间应该有一致性，才能有一个可信的、整体的故事。**

# **一些离别的想法**

*   **不断收集数据来验证你的信念系统，尽可能用客观的、数据驱动的事实来代替模糊的陈述**
*   **即使你认为数据不会 100%准确，即使是粗略的估计，也不要让完美成为好的敌人。**
*   **用主观的客户意见补充客观的数据——它们应该讲述一个连贯的故事**
*   **有时，甚至定期思考你需要什么数据的思维过程也是一种有用的思维练习。**
*   **如果你的论文有缺陷，你的整个数据收集过程就会失败。**
*   **当数据揭穿你的论点时，运用常识，深入探究！**