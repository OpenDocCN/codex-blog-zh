<html>
<head>
<title>Your Detailed Guide to Apache ShardingSphere’s Operating Modes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Apache ShardingSphere操作模式的详细指南</h1>
<blockquote>原文：<a href="https://medium.com/codex/your-detailed-guide-to-apache-shardingspheres-operating-modes-e50df1ee56e4?source=collection_archive---------5-----------------------#2021-12-30">https://medium.com/codex/your-detailed-guide-to-apache-shardingspheres-operating-modes-e50df1ee56e4?source=collection_archive---------5-----------------------#2021-12-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="7628" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">在<a class="ae jf" href="https://shardingsphere.apache.org" rel="noopener ugc nofollow" target="_blank">Apache sharding sphere</a>5 . 0 . 0 GA版本中，我们加入了新概念操作模式，并提供了三种配置方式:内存、独立和集群。为什么ShardingSphere提供这些操作模式？它们在实际开发场景中有哪些区别？</p><p id="e9cb" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">这篇文章可以帮助你更好地理解ShardingSphere的新操作模式。</p><h2 id="7574" class="jg jh hi bd ji jj jk jl jm jn jo jp jq is jr js jt iw ju jv jw ja jx jy jz ka bi translated"><strong class="ak">背景:分布式治理</strong></h2><p id="bd36" class="pw-post-body-paragraph ih ii hi ij b ik kb im in io kc iq ir is kd iu iv iw ke iy iz ja kf jc jd je hb bi translated">分布式治理是ShardingSphere中集群部署的基础。在以前的版本中，用户需要在配置文件中配置治理标记来启用分布式治理:</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="68a8" class="jg jh hi kl b fi kp kq l kr ks">governance:<br/>name: # Governance Name<br/> registryCenter: # Configuration Center <br/> type: # Governance Persistence Governance Type such as Zookeeper             and etcd<br/>serverLists: # Governance Service Lists, including IP address and   port number (comma-separated), such as host1:2181,host2:2181 <br/>overwrite: #Decide whether the local configuration overwrites the configuration of the configuration center. If yes, after every startup, the local configuration still works.</span></pre><p id="0971" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">分布式治理最重要的特性包括持久的用户配置和<a class="ae jf" href="https://dzone.com/articles/shardingshpheres-metadata-loading-process" rel="noopener ugc nofollow" target="_blank">元数据</a>。</p><p id="32a5" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">它们也是支持<a class="ae jf" href="https://opensource.com/article/21/9/distsql" rel="noopener ugc nofollow" target="_blank">分布式SQL </a> (DistSQL)的基本能力。在之前的ShardingSphere 5.0.0故事中，DistSQL的核心开发人员已经详细分享了<a class="ae jf" rel="noopener" href="/nerd-for-tech/intro-to-distsql-an-open-source-more-powerful-sql-bada4099211"> DistSQL </a>的概念、语法和用法，他们还展示了如何<a class="ae jf" rel="noopener" href="/codex/how-to-develop-your-distributed-sql-statement-in-apache-shardingsphere-2939eb689c61">开发自己的DistSQL </a>。</p><p id="c13c" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">总的来说，DistSQL为ShardingSphere的用户提供了类似数据库的体验:用户可以使用DistSQL来构建和管理整个ShardingSphere分布式数据库生态系统。</p><p id="3a7b" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">与其他标准SQL一样，DistSQL(被称为分布式数据库生态系统的操作语言)需要确保任何配置和操作元数据都可以持久化，以在系统恢复时保持数据一致性。</p><p id="d7da" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">在以前的版本中，只有当您启用分布式治理时，才能实现该特性。这就是DistSQL在其早期开发阶段只在分布式治理场景中可用的原因。</p><figure class="kg kh ki kj fd ku er es paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="er es kt"><img src="../Images/8f043ed134a3d330cad1f993bdb7ae07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V-E67IutGbKuf183xFjJFg.png"/></div></div></figure><h2 id="47e4" class="jg jh hi bd ji jj jk jl jm jn jo jp jq is jr js jt iw ju jv jw ja jx jy jz ka bi translated">我们为什么创建操作模式</h2><p id="c577" class="pw-post-body-paragraph ih ii hi ij b ik kb im in io kc iq ir is kd iu iv iw ke iy iz ja kf jc jd je hb bi translated">基于当前分布式治理功能给出的集群部署能力，ShardingSphere现在将其分布式能力重新定义为<strong class="ij hj">集群模式</strong>。</p><p id="6dbb" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">集群模式支持将ShardingSphere作为无状态计算节点进行多实例部署，并且通过注册中心，它可以实时同步集群中所有实例的元数据。</p><p id="8894" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">该模式自然支持DistSQL:在该模式下，您可以使用DistSQL在计算/存储节点上执行节点联机/脱机或禁用等操作。</p><p id="87a9" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">过去，DistSQL仅限于分布式场景。为了解决这个问题，ShardingSphere首先需要弄清楚如何在非分布式环境中存储元数据。最简单的解决方案是将元数据写入本地文件，因此当服务重新启动时，可以根据不同的配置从本地文件加载元数据。</p><p id="2e0d" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">与分布式场景中使用的集群模式不同，本地文件不能在多个ShardingSphere实例之间实时共享配置。在<strong class="ij hj">独立模式</strong>下，所有配置更新仅在各自的实例中有效。</p><p id="58db" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">ShardingSphere 5.0.0不仅为用户提供了更好的功能，还构建了稳定且用户友好的API来优化用户体验。</p><p id="2158" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">除了集群模式和独立模式，另一种有用的模式叫做<strong class="ij hj">内存模式</strong>。我们为什么要设计它？因为有些用户需要快速启动ShardingSphere的集成但不需要持久化配置。例如，有些人可能使用ShardingSphere来快速验证一些功能，或者只是想测试集成。考虑到这样的场景需求，我们创建了内存模式。</p><p id="89a8" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">到目前为止，ShardingSphere有三种模式，即内存、独立和集群。就我们的API设计而言，操作模式并不难理解，它们非常适合ShardingSphere的实际用例场景。此外，三种操作模式可以<strong class="ij hj">支持DistSQL </strong>快速构建和管理分布式数据库服务。</p><p id="8caf" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">5.0.0版本中删除了<code class="du lb lc ld kl b">governance</code>配置方法，取而代之的是，我们开始使用不同的操作模式。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="037a" class="jg jh hi kl b fi kp kq l kr ks">mode:<br/> type: # Mode Type Standalone/Cluster<br/> repository:<br/> type: # Persistence Type, Different modes have different implementations: Standalone-File and Cluster-ZooKeeper/Etcd<br/> props: # Different persistence types have different user-defined configurations. <br/> …<br/> overwrite: false # Decide whether to use local configuration to overwrite local/remote configuration</span></pre><p id="661e" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">接下来，我将详细解释三种操作模式的基本概念，并向您展示如何在使用ShardingSphere进行开发时选择正确的操作模式。</p><h2 id="a52b" class="jg jh hi bd ji jj jk jl jm jn jo jp jq is jr js jt iw ju jv jw ja jx jy jz ka bi translated">概念和应用场景</h2><p id="ad5c" class="pw-post-body-paragraph ih ii hi ij b ik kb im in io kc iq ir is kd iu iv iw ke iy iz ja kf jc jd je hb bi translated"><strong class="ij hj">记忆模式</strong></p><p id="677d" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">内存是默认的工作模式，所以不需要配置<code class="du lb lc ld kl b">mode</code>。在这种模式下，用户不需要配置任何持久性组件或策略，因为由本地初始化配置或SQL/DistSQL操作引起的任何元数据更改只在当前线程中起作用，并且在服务重新启动后会恢复配置。</p><p id="0daf" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">内存模式非常适合集成测试:这很方便，因为开发人员在集成ShardingSphere并进行集成测试后，不必清理运行痕迹。</p><p id="c851" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated"><strong class="ij hj">独立模式</strong></p><p id="bb36" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">默认情况下，ShardingSphere的独立模式为本地文件提供了一种持久性方法。它可以将元数据信息(例如数据源和规则)保存到本地文件中，因此即使服务重新启动，仍可以从本地文件中读取配置，以确保元数据的一致性。</p><p id="fff6" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">独立模式便于开发工程师快速构建ShardingSphere的本地开发环境，测试集成和验证特性。</p><p id="4eb2" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">该模式的配置如下所示:</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="e566" class="jg jh hi kl b fi kp kq l kr ks">mode:<br/> type: Standalone<br/> repository:<br/> type: File<br/> props:<br/> path: …<br/> overwrite: false</span></pre><p id="f53e" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">默认情况下，独立模式可以保存本地文件。默认情况下，配置保存在用户目录<code class="du lb lc ld kl b">.shardingsphere</code>中，但是您也可以通过配置<code class="du lb lc ld kl b">path</code>来定制您的存储路径。</p><p id="bb6a" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated"><strong class="ij hj">集群模式</strong></p><p id="aa15" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">我们建议您在实际的部署和生产环境中应用集群模式。此外，如果您采用同时具有JDBC和代理的混合部署架构，则必须使用集群模式。</p><p id="9099" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">该模式可以提供分布式治理能力。通过集成独立部署的第三方注册中心，该模式可以实现元数据持久化，在多个实例之间共享数据，实现分布式场景下的状态协调。集群模式也是ShardingSphere的横向扩展能够极大地增强计算能力并为高可用性等核心特性奠定基础的原因。</p><p id="1745" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">我们以Zookeeper为例，演示模式配置:</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="6b49" class="jg jh hi kl b fi kp kq l kr ks">mode:<br/> type: Cluster<br/> repository:<br/> type: ZooKeeper<br/> props:<br/> namespace: governance_ds<br/> server-lists: localhost:2181<br/> retryIntervalMilliseconds: 500<br/> timeToLiveSeconds: 60<br/> maxRetries: 3<br/> operationTimeoutMilliseconds: 500<br/> overwrite: false</span></pre><p id="8d6c" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">我们还比较了三种模式之间的差异(如下表所示)。我们的建议是，你先考虑自己的需求，再选择合适的模式。</p><figure class="kg kh ki kj fd ku er es paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="er es le"><img src="../Images/35d71470ce2dd9d049a7816e057b5340.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c-HfcfZUmSTRyt5rzME9hw.png"/></div></div></figure><h2 id="f0d9" class="jg jh hi bd ji jj jk jl jm jn jo jp jq is jr js jt iw ju jv jw ja jx jy jz ka bi translated"><strong class="ak">总结</strong></h2><p id="7bad" class="pw-post-body-paragraph ih ii hi ij b ik kb im in io kc iq ir is kd iu iv iw ke iy iz ja kf jc jd je hb bi translated">ShardingSphere的三种操作模式几乎可以满足各种环境中从测试到开发到部署的所有用户需求。</p><p id="d24f" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">结合ShardingSphere卓越的可插拔架构，开发者还可以灵活定制每种模式的持久化方法，创建自己的操作模式，使操作模式更适合自己的开发和业务需求。如果您对分布式治理感兴趣，请随时联系ShardingSphere社区。</p><h1 id="51ed" class="lf jh hi bd ji lg lh li jm lj lk ll jq lm ln lo jt lp lq lr jw ls lt lu jz lv bi translated">Apache ShardingSphere开源项目链接:</h1><p id="d717" class="pw-post-body-paragraph ih ii hi ij b ik kb im in io kc iq ir is kd iu iv iw ke iy iz ja kf jc jd je hb bi translated"><a class="ae jf" href="https://github.com/apache/shardingsphere" rel="noopener ugc nofollow" target="_blank"> ShardingSphere Github </a></p><p id="0bdf" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated"><a class="ae jf" href="https://twitter.com/ShardingSphere" rel="noopener ugc nofollow" target="_blank"> ShardingSphere Twitter </a></p><p id="1b7d" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated"><a class="ae jf" href="https://join.slack.com/t/apacheshardingsphere/shared_invite/zt-sbdde7ie-SjDqo9%7EI4rYcR18bq0SYTg" rel="noopener ugc nofollow" target="_blank">切割球松弛通道</a></p><p id="1bc3" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated"><a class="ae jf" href="https://shardingsphere.apache.org/community/cn/contribute/" rel="noopener ugc nofollow" target="_blank">投稿指南</a></p><p id="ceb3" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated"><strong class="ij hj">作者</strong></p><p id="1691" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">孟浩让</p><blockquote class="lw lx ly"><p id="f0a3" class="ih ii lz ij b ik il im in io ip iq ir ma it iu iv mb ix iy iz mc jb jc jd je hb bi translated">SphereEx高级开发工程师&amp; Apache ShardingSphere PMC。</p><p id="89eb" class="ih ii lz ij b ik il im in io ip iq ir ma it iu iv mb ix iy iz mc jb jc jd je hb bi translated">他之前在京东科技负责数据库产品R&amp;D，对开源和数据库生态系统充满热情。目前，他专注于ShardingSphere数据库生态系统的开发和开源社区建设。</p></blockquote><figure class="kg kh ki kj fd ku er es paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="er es md"><img src="../Images/14779c260c0341f9cd34159eeb662f48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v3FarsZC3Z3Iumqh4BIUvQ.png"/></div></div></figure></div></div>    
</body>
</html>