# 编写活性检查器

> 原文：<https://medium.com/codex/writing-a-liveness-checker-acaf0ab6f3d1?source=collection_archive---------10----------------------->

![](img/18c92f4976a541f80d31939e04421634.png)

可用性是当今应用程序最受欢迎的特征之一。应用程序始终在线，全球有数百万用户始终处于活跃状态。为了确保应用程序继续工作，没有计划外停机，监控应用程序变得非常重要。

> 我们生活在一个半虚拟半真实的世界里。我们在虚拟世界有真实的朋友，在现实世界有虚拟的助手。

无论应用程序是作为微服务部署，还是作为使用 map reduce 的后端数据处理器部署，监控都可以确保应用程序健康且高效地工作。这篇文章讨论了一个基本的机制，它可以用来执行心跳检查，以达到实时监控的目的。

我记得，在内部基础设施仍有需求的时候(现在云已经占据了主导地位)。我当时正在为一家电子商务巨头处理订单的微服务工作。那时它还不在云上，必须设置监控。我们需要能够模拟每个微服务实例的心跳，并从监控系统调用的东西。

当我们想到这个主意时，我们已经为业务需求编写了许多 api。如果我们编写另一个主要目的是充当心跳的 api 会怎么样？我们可以每 3 秒钟调用一次 api 来检查实例的活性，并使用它来为监控系统绘制图形。我们编写并部署了那个 api，并确保它得到了适当的保护，并且只能从内部网中访问(不应该是公共 api)。

我们做的另一件事是通过负载平衡器每 3 秒调用一次 api。我们围绕它构建了一些逻辑，如果某个实例的心跳在一定的重试次数后没有回复成功响应，它会自动提醒我们。效果很好！我们后来还添加了一些智能，允许它关闭不活动的实例，并停止向它们发送新的请求，同时在准备新实例时将负载重新分配给活动的实例。

后来，我们将它应用于其他服务，并转变了这一想法，使其能够很好地与基于事件的架构和独立的批处理作业处理器一起工作。

api 可以简单到发送一个不带属性的简单 http 请求并接收一个 OK (HTTP 200 ),也可以复杂到在准备和发送正确的回复之前检查应用程序是否可以连接到数据库、消息代理或其他中间件。

> 这是我最近写的一本关于设计模式的书的链接。希望你会觉得有用。

[](https://www.amazon.in/Software-Design-Patterns-Java-Developers/dp/9391392474) [## 面向 Java 开发人员的软件设计模式:专家主导的构建可重用软件的方法和…

### 面向 Java 开发人员的软件设计模式讨论了软件设计的基础，以及公认的…

www .亚马逊. in](https://www.amazon.in/Software-Design-Patterns-Java-Developers/dp/9391392474)