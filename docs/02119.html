<html>
<head>
<title>Does your application perform the same as it scales? K6 Load testing</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">您的应用程序在扩展时性能是否相同？K6负载测试</h1>
<blockquote>原文：<a href="https://medium.com/codex/does-your-application-perform-the-same-as-it-scales-k6-load-testing-f46c7b4a5257?source=collection_archive---------14-----------------------#2021-07-01">https://medium.com/codex/does-your-application-perform-the-same-as-it-scales-k6-load-testing-f46c7b4a5257?source=collection_archive---------14-----------------------#2021-07-01</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/db94a52b1ef09790f84180c01fa5c56b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*HJJlyFoMatZuyf3d"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">埃里克·范·迪克在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="6539" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">最近在工作中，他们让我测试一下<strong class="ix hj">发生了什么事情</strong>如果我们的<a class="ae iu" href="https://k6.io/docs/using-k6/http-requests/" rel="noopener ugc nofollow" target="_blank"> <em class="jt"> HTTP API </em> </a>不得不<strong class="ix hj">处理许多对它包含的不同<em class="jt">端点</em>的请求</strong>。也许如果你生活中没有做过<a class="ae iu" href="https://en.wikipedia.org/wiki/Load_testing" rel="noopener ugc nofollow" target="_blank"> <strong class="ix hj"> <em class="jt">负载测试</em> </strong> </a>，首先想到的可能是自己制作脚本，用自己配置的请求数测试响应时间。我也有同样的想法，但幸运的是<strong class="ix hj">有解决方案</strong>已经想好了。</p><p id="c652" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我寻找不同的解决方案，直到我找到了最适合我需要的工具<a class="ae iu" href="https://k6.io/" rel="noopener ugc nofollow" target="_blank"><strong class="ix hj"><em class="jt">K6</em></strong></a><strong class="ix hj"><em class="jt"/></strong>。为什么我选择这个选项，而不是其他同样众所周知的，会给我们另一个好时光。可选地，你可以看看<a class="ae iu" href="https://artillery.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ix hj"> <em class="jt">火炮</em> </strong> </a>因为它与<a class="ae iu" href="https://k6.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ix hj"> <em class="jt"> K6 </em> </strong> </a>履行相同的领域，但它比<a class="ae iu" href="https://k6.io/docs/using-k6/http-requests/" rel="noopener ugc nofollow" target="_blank"> <strong class="ix hj">更简单</strong> </a>，至少对我来说。</p><p id="4f46" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">尽管我在这些性能测量问题上没有什么经验，我还是决定记录自己如何使用<a class="ae iu" href="https://k6.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ix hj"> <em class="jt"> K6 </em> </strong> </a>语法定义测试。</p><p id="ab05" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我做一个简短的插入语来提及这个工具<strong class="ix hj">不仅</strong>用于测量<a class="ae iu" href="https://k6.io/docs/using-k6/http-requests/" rel="noopener ugc nofollow" target="_blank"><strong class="ix hj"><em class="jt">HTTP API</em></strong></a>的性能，它还用于<a class="ae iu" href="https://k6.io/docs/using-k6/protocols/" rel="noopener ugc nofollow" target="_blank"> <strong class="ix hj">比可以直接使用的<strong class="ix hj">多得多的</strong> </strong></a>类型的API或<strong class="ix hj">资源</strong>。</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><p id="9c1f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">请记住，即使我们已经用JavaScript编写了测试，它也不会是执行这段代码的运行时节点。除此之外，这个工具没有使用什么来<strong class="ix hj">构建</strong>我们的代码是最纯粹形式的<a class="ae iu" href="https://webpack.js.org/" rel="noopener ugc nofollow" target="_blank"><strong class="ix hj"><em class="jt">web pack</em></strong></a>。这就是为什么如果我们带着其他测试框架如<a class="ae iu" href="https://jestjs.io" rel="noopener ugc nofollow" target="_blank"><strong class="ix hj"><em class="jt">Jest</em></strong></a>或<a class="ae iu" href="https://mochajs.org/" rel="noopener ugc nofollow" target="_blank"><strong class="ix hj"><em class="jt">Mocha</em></strong></a>的<strong class="ix hj">心态来，我们<strong class="ix hj">将无法</strong>利用与<strong class="ix hj"> <em class="jt"> NodeJS </em> </strong>有某种依赖关系的<strong class="ix hj">模块</strong>。</strong></p><p id="c658" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">一个非常常见的情况是试图使用<a class="ae iu" href="https://www.npmjs.com/package/dotenv" rel="noopener ugc nofollow" target="_blank"> <em class="jt"> dotenv </em> </a>这样的包，这些包可以在<a class="ae iu" href="http://npmjs.com/" rel="noopener ugc nofollow" target="_blank"> npm </a>的公共注册表中找到，但尽管如此，我们还是必须<strong class="ix hj">使用这些包的改编版本</strong>用于<a class="ae iu" href="https://webpack.js.org/" rel="noopener ugc nofollow" target="_blank"><strong class="ix hj"><em class="jt">web pack</em></strong></a>(如果有的话)。如果你需要使用这个包，我们可以使用名为<a class="ae iu" href="https://www.npmjs.com/package/dotenv-webpack" rel="noopener ugc nofollow" target="_blank"><em class="jt">dotenv-web pack</em></a>的改编。</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><p id="6f8e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">通过这种方式，我们将能够生成一个包，这样k6实例就可以执行它，并给我们一个带有测试结果的输出。别忘了遵循<a class="ae iu" href="https://k6.io/docs/getting-started/installation/" rel="noopener ugc nofollow" target="_blank"> <em class="jt"> k6安装指南</em> </a>。</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><p id="29bc" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在生成我们的<a class="ae iu" href="https://docs.npmjs.com/cli/v7/configuring-npm/package-json/" rel="noopener ugc nofollow" target="_blank"> <em class="jt"> package.json </em> </a>文件及其相应的脚本和依赖项之后，我们将通过运行以下命令为我们的测试生成输出:</p><pre class="ju jv jw jx fd ka kb kc kd aw ke bi"><span id="d7c0" class="kf kg hi kb b fi kh ki l kj kk">npm install --quiet<br/>npm start</span></pre><p id="db9f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">看看<a class="ae iu" href="https://docs.npmjs.com/cli/v7/using-npm/scripts" rel="noopener ugc nofollow" target="_blank"><strong class="ix hj"><em class="jt">NodeJs</em></strong><strong class="ix hj"><em class="jt">钩子</em> </strong> </a>就明白这次的“<em class="jt">start”</em>命令是怎么工作的了。基本上，当调用“<em class="jt">start”</em>脚本时，通过启动以下名为“<em class="jt"> bundle </em>的脚本，将自动<strong class="ix hj">执行“<em class="jt"> prestart </em>”脚本，该脚本也将<strong class="ix hj">先前执行</strong>命令“<em class="jt"> prebundle </em>”。</strong></p><p id="ca05" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">值得一提的是"<em class="jt"> set:unix:source:env </em>"脚本的存在，因为它将负责使用<strong class="ix hj"> <em class="jt"> WebPack </em> </strong>进行构建，以找到名为"<em class="jt"> URL </em>"的环境变量。为此我们将不得不生成一个<strong class="ix hj"> <em class="jt">。env </em> </strong>文件包含以下内容:</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kl"><img src="../Images/91b02896b5ba892a80b79f59c007d88d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q7l_tr9a4VnKTGHiK1kKxA.png"/></div></div></figure><p id="b505" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">通过这种方式，我们可以<strong class="ix hj">知道</strong>每秒有多少<strong class="ix hj">请求</strong>我们的<em class="jt"> API </em>能够<strong class="ix hj">无误地处理</strong>。这将有助于我们了解如何自动扩展基础架构，以适应我们的需求。</p><p id="18c9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这是一个使用<a class="ae iu" href="http://k6.io" rel="noopener ugc nofollow" target="_blank"><strong class="ix hj"><em class="jt">【K6】</em></strong></a>进行测试的简单示例，但是如果您想了解更复杂的测试情况，请不要犹豫给我们留下评论。现在是测试您的API的时候了🔥</p></div></div>    
</body>
</html>