# 缓存—下一级开发人员的基本概念(续。)

> 原文：<https://medium.com/codex/caching-basic-concept-for-next-level-developers-cont-35ae88824b87?source=collection_archive---------10----------------------->

在本文中，我将继续通过一个基于 web 的应用程序的实现来说明接下来的 3 个缓存级别。这是我上一篇文章的延续，你可以在这里阅读。

# 第 3 级:带 SPA 的 Web API

在这个级别，应用程序被扩展为支持移动版本和单页应用程序(SPA)。现在我们需要优化 API，以确保响应请求的时间应该在 50 毫秒到 100 毫秒之间。

让我们回顾一下 Web API 和 Web SPA 的一些基本特征。

*   SPA 包含所有 HTML、JS、CSS 内容，可以以静态方式部署
*   Web APIs 只处理(请求和响应)数据，因此应用程序不必分配资源来呈现 HTML 模板。
*   从客户端到服务器可能会有更多的请求。
*   分离无状态和有状态组件可以简化应用程序的容器化过程。

现在，我们通过将 HTML、JS、CSS 等静态数据从数据中完全分离出来，实际上改进了缓存。我们关注以下项目:

![](img/cd028f18ea0c13711e7785cc1e94c47b.png)

具体来说，

![](img/689ccee41678ab290915ffb1fed3e43d.png)

**1。使用第三存储器缓存数据对象**

这是关于使用 Redis 或 Memcache 通过跟踪命中或缺失缓存数据的比率和更新 API 流来优化数据对象的缓存。这个方法我在之前的帖子里已经讨论过了。

**2。在 CDN 上缓存静态资产**

这比我们在以前的关卡中做的要简单一些。这是因为当前的 JS 框架提供了将 HTML、CSS、JS 分成静态文件的能力，这些文件很容易缓存在 CDN 上。

**3。缓存来自客户端的 HTTP 响应**

由于客户端必须向服务器发送更多的请求，所以通过 HTTP 头在客户端启用缓存来考虑用户的体验非常重要。有几种方法:

*   在客户端完全缓存响应，**不需要新请求**。这种方法使用**缓存控制**头，或者像 **Pragma** 、 **Expires** 这样的老派头。
*   事实上，当客户端的缓存过期时，浏览器会创建一个新的请求。现在，验证服务器端的数据是否与客户端的数据不匹配是 Etag、If-none-match 和 Last-modified、If-Modified-Since 等标头的职责。如果没有任何变化，将返回一个 HTTP 代码为 304 的空响应，以节省网络资源。

注 1:默认情况下，浏览器优先考虑头缓存和自动缓存，没有任何具体的配置。相比之下，移动应用程序不缓存，除非在 HTTP 请求库上有缓存设置。

注意 2:缓存来自客户端的 HTTP 响应需要小心执行。如果出现问题，也就是说，如果您缓存了所有内容，包括不应该缓存的内容，那么解决这个问题(如果有的话)将是一项非常重要的任务。在最坏的情况下，您必须告诉每个用户清除他们设备上的缓存。

# 第四级:微服务

在这一级别，我们关注于优化数据处理组件，因为静态资产已经从其他级别进行了优化。一些基本特征是:

*   具有不同数据库的多种服务
*   部署为容器，因此使用文件进行缓存并不可取。
*   高性能、高工作负载
*   数据量大，需要扩展缓存系统。

请注意，微服务缓存可以是一个单独的主题，因为它必须满足各种需求，而不是缓存。

![](img/40301dfa1502dcb1573c1376852b2931.png)

正如你所看到的，这张图上的许多点，例如缓存数据对象、HTTP 响应，在前面的级别已经提到过了。它们在这个级别上被重用，但是更高级一些。

![](img/1d9899c7ecb85ba72a4a5914f9ce7443.png)

**1。缓存数据库索引和热数据**

从技术上讲，这与缓存无关，而是优化数据库。然而，我在这里提到它是因为它可以被认为是缓存的一部分。作为一名开发人员和系统设计人员，您需要配置数据库来优化索引缓存和 RAM 上的热数据。它包括一些任务，如:

*   优化索引大小
*   容量规划
*   优化数据库配置

**2。缓存数据对象**

尽管这已经从以前的级别实现了，但对于微服务系统来说，缓存数据对象是至关重要的。

这里主要使用 2 种存储机制:**第三存储** (Redis，Memcached)和**内存** (Hashmap，variable)。现在，选择一个合适的存储机制是非常重要的(是的，下一篇文章再见，了解更多细节)，这里有一些你可以考虑的要点:

*   得益于集群部署的能力，第三代存储具有可扩展性，因此在大多数情况下都能获得相当好的性能。
*   就可扩展性和性能而言，内存缓存不如第三代存储，因为它适用于每个应用程序实例。然而，它比 Redis 等远程缓存方法快得多。因此，在内存上缓存是针对特定应用(即延迟敏感的应用)的解决方案。

**3。使用反向代理和 CDN 缓存 API 响应**

使用反向代理和 CDN 进行缓存是这个级别的基本要求。然而，为了高效地缓存 API 响应，您需要非常好地理解每个端点:哪个端点需要被缓存以及缓存多长时间。为每个端点实现缓存头以及检查数据完整性确实是一项非常耗时的任务。因此，我认为如果你没有巨大的流量要处理，启动它并不是一个好主意。

**4。主动缓存客户端的数据对象**

在这个层次上，客户端应用程序可能更加复杂(和复杂？).因此，提高用户体验的质量非常重要。在前端，我们更进一步，以主动的方式在客户端缓存数据。还记得脸书是如何工作的吗，即显示文章内容，即使它处于离线模式？在客户端缓存数据可以减少发送到服务器的大量请求，因此在早期可能没有必要这样做。一件事是，由于数据完整性的一些问题，管理客户端上的缓存数据具有挑战性。

# 结论

到目前为止还好吗？我希望为您提供缓存的另一个视角，以及我们在现实中可以用它做什么。在下一篇文章中，我将详细介绍一个具体的案例，并解释如何以适当的方式进行缓存。

# 承认

我想对光明(又名明孟门)允许翻译他的[原文](https://viblo.asia/p/caching-dai-phap-1-nac-thang-len-level-cua-developer-V3m5WdO8KO7)表示我的感谢。