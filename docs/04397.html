<html>
<head>
<title>Building an Economic Calendar using Python and APIs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python和API构建经济日历</h1>
<blockquote>原文：<a href="https://medium.com/codex/building-an-economic-calendar-using-python-and-apis-9abe4a40dc9a?source=collection_archive---------2-----------------------#2021-11-28">https://medium.com/codex/building-an-economic-calendar-using-python-and-apis-9abe4a40dc9a?source=collection_archive---------2-----------------------#2021-11-28</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="1275" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">承认最近经济事件的一种简短而甜蜜的方式</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/23d44e64d2da60ed3304bd4770457446.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1HPzCbnawFOWRVLZ"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">尼克·希利尔在<a class="ae jn" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="1d76" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">金融新闻不仅是影响股票市场的主要因素，也是另一个突出的方面，即经济事件。用简单的英语来定义，经济事件是指与公司财务相关的具有经济意义并影响股票市场和公司财务状况的事件。</p><p id="1e01" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">就像股票筛选程序是如何构建的，以轻松获得所需股票的最新价格变化信息一样，经济日历也用于更新最新和即将发生的经济事件，并据此进行投资。</p><p id="b8f4" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">由于我不太喜欢使用外部经济日历工具，而自己动手制作东西是我的强项，所以我总是使用Python来完成这项任务，在EOD历史数据公司(EODhd)API的帮助下，这个过程变得更加容易。在本文中，我们将使用EOD历史数据公司的Python经济日历API构建两种不同类型的经济日历。事不宜迟，让我们进入文章吧！</p><blockquote class="kk kl km"><p id="8477" class="jo jp kn jq b jr js ij jt ju jv im jw ko jy jz ka kp kc kd ke kq kg kh ki kj hb bi translated"><strong class="jq hj">注</strong>:本文强烈基于<a class="ae jn" href="https://eodhistoricaldata.com/?utm_source=medium&amp;utm_medium=post&amp;utm_campaign=building_an_economic_calendar_using_python_and_apis" rel="noopener ugc nofollow" target="_blank"> EOD史料</a>提供的API。因此，为了顺利地跟进即将到来的内容，请确保您拥有自己的帐户，因为它使您能够访问您的私有API密钥。您可以在 处使用<a class="ae jn" href="https://eodhistoricaldata.com/register?utm_source=medium&amp;utm_medium=post&amp;utm_campaign=building_an_economic_calendar_using_python_and_apis" rel="noopener ugc nofollow" target="_blank"> <strong class="jq hj">链接创建账户。此外，并非本文中提到的所有API都是免费提供的，但需要订阅。点击</strong> </a>查看所有套餐的价格，并选择最适合您的套餐。</p></blockquote><h1 id="4c5c" class="kr ks hi bd kt ku kv kw kx ky kz la lb io lc ip ld ir le is lf iu lg iv lh li bi translated">导入包</h1><p id="4a82" class="pw-post-body-paragraph jo jp hi jq b jr lj ij jt ju lk im jw jx ll jz ka kb lm kd ke kf ln kh ki kj hb bi translated">让我们首先将所需的包导入到我们的python环境中，因为这是任何编程项目中最重要的过程。本文中我们需要的唯一包是进行API调用的请求和处理数据的Pandas。如果您尚未安装这两个软件包，请在命令行中输入以下代码行:</p><pre class="iy iz ja jb fd lo lp lq lr aw ls bi"><span id="21a9" class="lt ks hi lp b fi lu lv l lw lx">pip install requests<br/>pip install pandas</span></pre><p id="c8a7" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">安装完包后，我们现在可以使用下面的代码将它们导入到我们的python环境中:</p><pre class="iy iz ja jb fd lo lp lq lr aw ls bi"><span id="4a2a" class="lt ks hi lp b fi lu lv l lw lx">import requests<br/>import pandas as pd</span><span id="70fa" class="lt ks hi lp b fi ly lv l lw lx">api_key = 'YOUR API KEY'</span></pre><p id="3e50" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">现在，我们已经成功地将基本包导入到我们的环境中，并将API键存储到<code class="du lz ma mb lp b">api_key</code>变量中。</p><h1 id="ad27" class="kr ks hi bd kt ku kv kw kx ky kz la lb io lc ip ld ir le is lf iu lg iv lh li bi translated">收入经济日历</h1><p id="bf22" class="pw-post-body-paragraph jo jp hi jq b jr lj ij jt ju lk im jw jx ll jz ka kb lm kd ke kf ln kh ki kj hb bi translated">我们将在本文中构建的第一种日历是收益日历。对于那些不知道收益日历是什么的人来说，它是一种揭示特定公司收益表的报告和发布日期的日历。投资者利用收益报表来评估股票的表现，并据此调整他们的投资组合。因此可以说，收益表对投资者和市场有着直接的影响，具有经济意义。</p><p id="68ed" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在本文中，我们将建立两种不同类型的收益日历:一个即将到来的收益日历和一个特定股票的历史收益日历。让我们从第一种日历开始。</p><h2 id="9338" class="lt ks hi bd kt mc md me kx mf mg mh lb jx mi mj ld kb mk ml lf kf mm mn lh mo bi translated">即将到来的收益日历</h2><p id="14c4" class="pw-post-body-paragraph jo jp hi jq b jr lj ij jt ju lk im jw jx ll jz ka kb lm kd ke kf ln kh ki kj hb bi translated">本节的基本思想是定义一个函数，该函数构建一个基本的即将到来的收益日历，该日历表示特定收益报表的报告日期及其对市场的影响。构建日历的python代码如下所示:</p><pre class="iy iz ja jb fd lo lp lq lr aw ls bi"><span id="e37c" class="lt ks hi lp b fi lu lv l lw lx">def get_upcoming_earnings(start_report_date, end_report_date, currency, api_key, n_limit):<br/>    <br/>    url = f'https://eodhistoricaldata.com/api/calendar/earnings?api_token={api_key}&amp;fmt=json&amp;from={start_report_date}&amp;to={end_report_date}'<br/>    u_earnings = requests.get(url).json()<br/>    <br/>    u_earnings_df = pd.DataFrame(u_earnings['earnings']).drop('before_after_market', axis = 1).fillna(0)<br/>    u_earnings_df = u_earnings_df[u_earnings_df.currency == f'{currency}']<br/>    u_earnings_df = u_earnings_df[u_earnings_df.actual != 0]<br/>    u_earnings_df = u_earnings_df.rename(columns = {'code':'stock'})<br/>    u_earnings_df = u_earnings_df.iloc[-n_limit:]<br/>    u_earnings_df.index = range(len(u_earnings_df))<br/>    <br/>    return u_earnings_df<br/><br/>us_stocks_u_earnings = get_upcoming_earnings('2021-11-23', '2021-11-26', 'USD', api_key, 10)<br/>us_stocks_u_earnings</span></pre><p id="fcca" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">现在让我们来分解上面的代码。首先，我们定义一个名为<code class="du lz ma mb lp b">get_upcoming_earnings</code>的函数，它将以下内容作为参数:收益日历的开始日期(<code class="du lz ma mb lp b">start_report_date</code>)、收益数据的货币(<code class="du lz ma mb lp b">currency</code>)、收益日历的结束日期(<code class="du lz ma mb lp b">end_report_date</code>)、API键(<code class="du lz ma mb lp b">api_key</code>)，最后是输出的长度(<code class="du lz ma mb lp b">n_limit</code>)。</p><p id="54ac" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在函数内部，我们首先将API URL存储到<code class="du lz ma mb lp b">url</code>变量中，然后，我们使用Requests包提供的<code class="du lz ma mb lp b">get</code>函数进行API调用，提取JSON格式的数据。现在让我们花点时间来看看API URL的结构。这是在上面定义的函数中使用的URL:</p><pre class="iy iz ja jb fd lo lp lq lr aw ls bi"><span id="65ec" class="lt ks hi lp b fi lu lv l lw lx">https://eodhistoricaldata.com/api/calendar/earnings?api_token={api_key}&amp;fmt=json&amp;from={start_report_date}&amp;to={end_report_date}</span></pre><p id="470f" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">URL中的第一个参数是<code class="du lz ma mb lp b">api_token</code>参数，我们必须在这里指定API键。第二个参数是<code class="du lz ma mb lp b">fmt</code>参数，这是一个可选参数，这里我们必须提到我们想要的输出类型，JSON或CSV。第三和第四个参数是<code class="du lz ma mb lp b">from</code>和<code class="du lz ma mb lp b">to</code>参数，其中需要指定收益日历的开始和结束日期。</p><p id="2a56" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">回到代码，在将API响应存储到<code class="du lz ma mb lp b">data</code>变量之后，我们将它转换成一个Pandas数据帧，同时进行一些数据操作，并将其存储到另一个变量<code class="du lz ma mb lp b">u_earnings_df</code>。下面几行代码是基于给定输入执行的进一步数据操作。最后，我们将返回最终的数据帧，并调用创建的函数来构建即将到来的收益日历，如下所示:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mp"><img src="../Images/9f66a08b5d6ad1d15ce1c999109985ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BmsQwGctlHb1nE8_wP40vw.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">作者图片</figcaption></figure><h2 id="097b" class="lt ks hi bd kt mc md me kx mf mg mh lb jx mi mj ld kb mk ml lf kf mm mn lh mo bi translated">历史收入日历</h2><p id="36a5" class="pw-post-body-paragraph jo jp hi jq b jr lj ij jt ju lk im jw jx ll jz ka kb lm kd ke kf ln kh ki kj hb bi translated">本节的概念是创建一个日历，表示特定时间范围内给定股票的历史收益数据，其中包含报表报告日期的信息及其对市场的影响。代码的结构或多或少类似于我们之前在创建即将到来的收益日历时看到的代码，如下所示:</p><pre class="iy iz ja jb fd lo lp lq lr aw ls bi"><span id="fd2e" class="lt ks hi lp b fi lu lv l lw lx">def get_historical_earnings(stock, start_date, api_key):<br/>    <br/>    url = f'https://eodhistoricaldata.com/api/calendar/earnings?api_token={api_key}&amp;fmt=json&amp;symbols={stock}&amp;from={start_date}'<br/>    h_earnings = requests.get(url).json()<br/>    h_earnings_df = pd.DataFrame(h_earnings['earnings']).rename(columns = {'code':'stock'})<br/>    <br/>    return h_earnings_df<br/><br/>aapl_h_earnings = get_historical_earnings('AAPL.US', '2020-01-01', api_key)<br/>aapl_h_earnings</span></pre><p id="b127" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">正如我之前所说的，除了函数的参数和API URL略有不同之外，代码的结构与前一节的代码几乎相同。因此，我们现在将重点关注这两个不同的领域。</p><p id="b8b5" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">第一个是函数的参数。上面定义的函数有三个参数:股票的符号(<code class="du lz ma mb lp b">stock</code>)、收益数据的开始日期(<code class="du lz ma mb lp b">start_date</code>)，最后是API键(<code class="du lz ma mb lp b">api_key</code>)。第二个是API URL。这个部分的URL和前面的没有太大的区别，但是我们只是增加了一个参数，即<code class="du lz ma mb lp b">stock</code>参数，来指定我们想要访问其历史收益数据的股票。该函数的输出是一个日历，如下所示:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mq"><img src="../Images/5be2c4a4f41016b996f5f438838474ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aXztSZ2_yNsxVpfoCy3baQ.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">作者图片</figcaption></figure><h1 id="6216" class="kr ks hi bd kt ku kv kw kx ky kz la lb io lc ip ld ir le is lf iu lg iv lh li bi translated">IPO日历</h1><p id="43fe" class="pw-post-body-paragraph jo jp hi jq b jr lj ij jt ju lk im jw jx ll jz ka kb lm kd ke kf ln kh ki kj hb bi translated">IPO是最重要的经济事件之一，对市场有直接影响。要定义IPO，它是首次公开募股的缩写，一家公司成为公开交易的资产，通过欢迎新的投资者来为他们的公司筹集资金。本文这一部分的概念是创建一个日历，显示即将到来的IPO日期以及一些信息，创建IPO日历的代码如下所示:</p><pre class="iy iz ja jb fd lo lp lq lr aw ls bi"><span id="9665" class="lt ks hi lp b fi lu lv l lw lx">def get_upcoming_ipos(start_report_date, end_report_date, api_key):<br/>    <br/>    url = f'https://eodhistoricaldata.com/api/calendar/ipos?api_token={api_key}&amp;fmt=json&amp;from={start_report_date}&amp;to={end_report_date}'<br/>    u_ipos = requests.get(url).json()<br/>    u_ipos_df = pd.DataFrame(u_ipos['ipos']).drop('name', axis = 1).rename(columns = {'code':'stock'}).fillna(0)<br/>    u_ipos_df = u_ipos_df[u_ipos_df.amended_date != 0]<br/>    u_ipos_df = u_ipos_df[u_ipos_df.stock != 'N/A']<br/>    u_ipos_df.index = range(len(u_ipos_df))<br/>    <br/>    return u_ipos_df<br/><br/>upcoming_ipos = get_upcoming_ipos('2021-11-20', '2021-11-26', api_key)<br/>upcoming_ipos</span></pre><p id="853f" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">上面定义的函数与之前看到的代码片段没有太大的不同，但是API URL发生了变化，所以我们只关注它。代码中使用的API URL如下所示:</p><pre class="iy iz ja jb fd lo lp lq lr aw ls bi"><span id="2f73" class="lt ks hi lp b fi lu lv l lw lx">https://eodhistoricaldata.com/api/calendar/ipos?api_token={api_key}&amp;fmt=json&amp;from={start_report_date}&amp;to={end_report_date}</span></pre><p id="cdd9" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">API URL与我们之前看到的不太一样。在前面看到的URL中，我们将从“收益”页面(<code class="du lz ma mb lp b">/calendar/earnings</code>)提取数据，但由于我们愿意访问不同类型的信息，在我们的IPO数据中，我们将从“IPO”页面(<code class="du lz ma mb lp b">/calendar/ipos</code>)提取数据。谈到参数，这是非常相同的，在这方面没有什么大的变化。输出将是一个IPO日历，包含所有重要的细节，如下所示:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mr"><img src="../Images/ff4f81251c6004a167655dbfa5db793c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m4N1mikz8LX6ZHnhC5gdKQ.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">作者图片</figcaption></figure><h1 id="aa42" class="kr ks hi bd kt ku kv kw kx ky kz la lb io lc ip ld ir le is lf iu lg iv lh li bi translated">结束语</h1><p id="4b19" class="pw-post-body-paragraph jo jp hi jq b jr lj ij jt ju lk im jw jx ll jz ka kb lm kd ke kf ln kh ki kj hb bi translated">在本文中，我们看到了如何使用EODhd的日历API来构建几种不同类型的经济日历。还有更多的方法来定制日历以及一些其他的API特性，这些在本文中没有涉及，但是我认为值得花时间来看一看。</p><p id="1d39" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这篇文章的重要信息是，据我所知，许多人完全依赖新闻进行市场预测和投资，但那些也在关注和更新重大经济事件的人将在市场上占据强大的优势。在本文中，我们找到了一种轻松管理这项任务的方法。</p><p id="6b54" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">话虽如此，你已经到了文章的结尾。希望你学到了新的有用的东西。此外，如果您想查看原始文档以了解更多信息，请使用以下链接查看:<a class="ae jn" href="https://eodhistoricaldata.com/financial-apis/calendar-upcoming-earnings-ipos-and-splits?utm_source=medium&amp;utm_medium=post&amp;utm_campaign=building_an_economic_calendar_using_python_and_apis" rel="noopener ugc nofollow" target="_blank">https://eodhistoricaldata . com/financial-APIs/calendar-upcoming-earnings-IPOs-and-splits/</a></p></div></div>    
</body>
</html>