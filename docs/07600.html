<html>
<head>
<title>AWS Certified Solutions Architect Professional — Identity Federation &amp; Cognito</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">AWS认证解决方案架构师专家—身份联盟和认知</h1>
<blockquote>原文：<a href="https://medium.com/codex/aws-certified-solutions-architect-professional-identity-federation-cognito-ec80783c3fd1?source=collection_archive---------15-----------------------#2022-06-19">https://medium.com/codex/aws-certified-solutions-architect-professional-identity-federation-cognito-ec80783c3fd1?source=collection_archive---------15-----------------------#2022-06-19</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><h1 id="9503" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">介绍</h1><p id="c90a" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">关于AWS身份联邦&amp; Cognito的一个简短说明。这篇文章是由夏羽·马瑞克教授的《终极AWS认证解决方案架构师》课程的一个简要说明。这个帖子的唯一目的是一个总结，如果你想要详细的学习，请购买夏羽·马瑞克的课程。</p></div><div class="ab cl kb kc gp kd" role="separator"><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg"/></div><div class="hb hc hd he hf"><figure class="kj kk kl km fd kn er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es ki"><img src="../Images/b2c28b0cc5fb533d3766a7909984148c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*m7-ofPtVsMR2hqfA.png"/></div></div><figcaption class="ku kv et er es kw kx bd b be z dx translated">图片来自AWS</figcaption></figure><h1 id="4e6b" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">身份联盟</h1><p id="d53d" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">授予AWS以外的用户访问您帐户中的AWS资源的权限。我们不需要创建IAM用户，因为我们想要管理AWS之外的用户。</p><figure class="kj kk kl km fd kn er es paragraph-image"><div class="er es ky"><img src="../Images/e18fea9fd52107430703cc9e40d6e06a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1118/format:webp/0*OBQQ5hcROzCilOyB.png"/></div></figure><p id="fe6b" class="pw-post-body-paragraph jd je hi jf b jg kz ji jj jk la jm jn jo lb jq jr js lc ju jv jw ld jy jz ka hb bi translated">身份联盟工作方式如下:</p><ul class=""><li id="5bb6" class="le lf hi jf b jg kz jk la jo lg js lh jw li ka lj lk ll lm bi translated">首先，我们设置身份提供者和AWS之间的信任关系。我们告诉AWS，可以从这个提供者那里获得一个身份。</li><li id="367c" class="le lf hi jf b jg ln jk lo jo lp js lq jw lr ka lj lk ll lm bi translated">然后，用户登录身份提供者，并接收AWS的临时凭据。</li><li id="8e45" class="le lf hi jf b jg ln jk lo jo lp js lq jw lr ka lj lk ll lm bi translated">用户将使用这些临时凭证访问AWS。</li></ul><figure class="kj kk kl km fd kn er es paragraph-image"><div class="er es ls"><img src="../Images/9768d2b7bf65e93ec99bee1829d1820b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1110/format:webp/0*C1_XhYuoYl4LCI4p.png"/></div></figure><h2 id="fa1b" class="lt ig hi bd ih lu lv lw il lx ly lz ip jo ma mb it js mc md ix jw me mf jb mg bi translated">用例</h2><p id="0e76" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">我们构建需要访问AWS资源的应用程序(web/app)。例如，我们需要建立一个web应用程序，只允许登录用户可以上传文件到AWS S3桶。</p><figure class="kj kk kl km fd kn er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es mh"><img src="../Images/46f73d1e41709538b4d62ff136bc9fae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*V4yfEbyJXGZGJpBR.png"/></div></div></figure><p id="d0c3" class="pw-post-body-paragraph jd je hi jf b jg kz ji jj jk la jm jn jo lb jq jr js lc ju jv jw ld jy jz ka hb bi translated">一个公司有它的身份系统，他们想使用它的系统。例如，一家公司使用window服务器，并有一个活动目录身份系统。</p><figure class="kj kk kl km fd kn er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es mi"><img src="../Images/fd8b648f15b687a77c58370c1ad10cb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*x0XEN07mpYCvnuX4.png"/></div></div></figure><h2 id="2420" class="lt ig hi bd ih lu lv lw il lx ly lz ip jo ma mb it js mc md ix jw me mf jb mg bi translated">身份联盟实现</h2><p id="c075" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">身份联盟有一些实现方式:</p><ul class=""><li id="c356" class="le lf hi jf b jg kz jk la jo lg js lh jw li ka lj lk ll lm bi translated">SAML 2.0联邦。</li><li id="6ae4" class="le lf hi jf b jg ln jk lo jo lp js lq jw lr ka lj lk ll lm bi translated">自定义身份代理。</li><li id="5d4a" class="le lf hi jf b jg ln jk lo jo lp js lq jw lr ka lj lk ll lm bi translated">Web身份联盟。</li><li id="1b50" class="le lf hi jf b jg ln jk lo jo lp js lq jw lr ka lj lk ll lm bi translated">单点登录(SSO)。</li></ul><h1 id="fad7" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">SAML 2.0联盟</h1><p id="d70b" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">SAML代表安全声明标记语言2.0 (SAML 2.0)。它在在线安全方面的主要作用是使您能够使用一组登录凭据访问多个web应用程序。</p><p id="46e6" class="pw-post-body-paragraph jd je hi jf b jg kz ji jj jk la jm jn jo lb jq jr js lc ju jv jw ld jy jz ka hb bi translated">支持与Microsoft Active Directory联合身份验证服务(ADFS)或任何与AWS身份提供者(IdP)兼容的SAML 2.0集成。</p><p id="e57c" class="pw-post-body-paragraph jd je hi jf b jg kz ji jj jk la jm jn jo lb jq jr js lc ju jv jw ld jy jz ka hb bi translated">为了接收临时凭证，身份提供者使用STS API AssumeRoleWithSAML。</p><p id="427a" class="pw-post-body-paragraph jd je hi jf b jg kz ji jj jk la jm jn jo lb jq jr js lc ju jv jw ld jy jz ka hb bi translated">注意，SAML是旧的方式，而AWS SSO Federation是更简单的新方式。这个我们以后再说。</p><h2 id="cd05" class="lt ig hi bd ih lu lv lw il lx ly lz ip jo ma mb it js mc md ix jw me mf jb mg bi translated">使用SAML 2.0联合来接收AWS API访问的凭据</h2><p id="ee9b" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">例如，登录到身份提供者的用户使用SAML 2.0并接收临时凭据以访问S3存储桶。</p><figure class="kj kk kl km fd kn er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es mj"><img src="../Images/6c9e7260522d37cd2063a612a69e1025.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*OTPNarPP43RXBe_s.png"/></div></div><figcaption class="ku kv et er es kw kx bd b be z dx translated">图片来自夏羽·马雷克</figcaption></figure><ol class=""><li id="17b0" class="le lf hi jf b jg kz jk la jo lg js lh jw li ka mk lk ll lm bi translated">用户对IdP执行身份验证。</li><li id="b826" class="le lf hi jf b jg ln jk lo jo lp js lq jw lr ka mk lk ll lm bi translated">IdP将通过身份存储验证用户。</li><li id="64a9" class="le lf hi jf b jg ln jk lo jo lp js lq jw lr ka mk lk ll lm bi translated">如果登录成功，返回SAML断言。</li><li id="a9aa" class="le lf hi jf b jg ln jk lo jo lp js lq jw lr ka mk lk ll lm bi translated">用户可以调用STS API AssumeRoleWithSAML，如果断言可信，STS将验证断言并返回临时凭证。</li><li id="91a2" class="le lf hi jf b jg ln jk lo jo lp js lq jw lr ka mk lk ll lm bi translated">用户可以使用临时凭证访问S3存储桶。</li></ol><h2 id="30ec" class="lt ig hi bd ih lu lv lw il lx ly lz ip jo ma mb it js mc md ix jw me mf jb mg bi translated">使用SAML 2.0联合接收AWS控制台访问的凭据</h2><p id="359a" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">左边和上面的例子差不多，但是右边有一点不同。我们使用SAML 2.0联邦来访问AWS控制台。</p><figure class="kj kk kl km fd kn er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es ml"><img src="../Images/d93dbc376350ca767bc6f5d3319c3e8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*s4JbfwJ9Q7WF061Q.png"/></div></div><figcaption class="ku kv et er es kw kx bd b be z dx translated">图片来自夏羽·马雷克</figcaption></figure><ol class=""><li id="fe94" class="le lf hi jf b jg kz jk la jo lg js lh jw li ka mk lk ll lm bi translated">用户对IdP执行身份验证。</li><li id="6451" class="le lf hi jf b jg ln jk lo jo lp js lq jw lr ka mk lk ll lm bi translated">IdP将通过身份存储验证用户。</li><li id="9075" class="le lf hi jf b jg ln jk lo jo lp js lq jw lr ka mk lk ll lm bi translated">如果登录成功，返回SAML断言。</li><li id="158c" class="le lf hi jf b jg ln jk lo jo lp js lq jw lr ka mk lk ll lm bi translated">用户发布到以<code class="du mm mn mo mp b">/saml</code>结尾的AWS登录URL。</li><li id="bf09" class="le lf hi jf b jg ln jk lo jo lp js lq jw lr ka mk lk ll lm bi translated">请求临时凭据。</li><li id="d3f9" class="le lf hi jf b jg ln jk lo jo lp js lq jw lr ka mk lk ll lm bi translated">向用户返回一个登录URL。</li><li id="676a" class="le lf hi jf b jg ln jk lo jo lp js lq jw lr ka mk lk ll lm bi translated">用户重定向到AWS控制台。</li></ol><h2 id="4550" class="lt ig hi bd ih lu lv lw il lx ly lz ip jo ma mb it js mc md ix jw me mf jb mg bi translated">将SAML 2.0联合用于Active Directory</h2><p id="d1bf" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">右边和上面的例子差不多，但是左边有一点不同。我们使用SAML 2.0 Federation和Active Directory来访问AWS控制台。</p><figure class="kj kk kl km fd kn er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es mq"><img src="../Images/83f63d01108fe8694a9882d8619659a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*fphF0Df4slSexGPL.png"/></div></div><figcaption class="ku kv et er es kw kx bd b be z dx translated">图片来自夏羽·马雷克</figcaption></figure><h1 id="5053" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">自定义身份代理</h1><p id="67f3" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">仅当身份提供者与SAML 2.0不兼容时使用，代理应用程序对用户进行身份验证，向AWS请求用户的临时凭据，然后向用户提供这些凭据以访问AWS资源。</p><figure class="kj kk kl km fd kn er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es mr"><img src="../Images/8748b98807e0759e06c6f358e2b5394c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*HgtOvQGoBI-PqXH8.png"/></div></div><figcaption class="ku kv et er es kw kx bd b be z dx translated">图片来自夏羽·马雷克</figcaption></figure><ol class=""><li id="d079" class="le lf hi jf b jg kz jk la jo lg js lh jw li ka mk lk ll lm bi translated">用户浏览到一个URL并访问自定义身份代理。</li><li id="d6ed" class="le lf hi jf b jg ln jk lo jo lp js lq jw lr ka mk lk ll lm bi translated">身份代理对用户进行身份验证。</li><li id="9fb7" class="le lf hi jf b jg ln jk lo jo lp js lq jw lr ka mk lk ll lm bi translated">如果用户可以登录，Identity Broker将请求临时凭据。</li><li id="88dd" class="le lf hi jf b jg ln jk lo jo lp js lq jw lr ka mk lk ll lm bi translated">Identity Broker将令牌或URL返回给用户。</li><li id="619b" class="le lf hi jf b jg ln jk lo jo lp js lq jw lr ka mk lk ll lm bi translated">用户使用令牌或URL来访问AWS资源。</li></ol><p id="dac4" class="pw-post-body-paragraph jd je hi jf b jg kz ji jj jk la jm jn jo lb jq jr js lc ju jv jw ld jy jz ka hb bi translated">这个场景与前一个场景(使用自定义身份验证系统的移动应用程序)类似，只是需要访问AWS资源的应用程序都在公司网络内运行，并且公司有一个现有的身份验证系统。</p><p id="e48b" class="pw-post-body-paragraph jd je hi jf b jg kz ji jj jk la jm jn jo lb jq jr js lc ju jv jw ld jy jz ka hb bi translated"><strong class="jf hj">请注意，自定义身份代理是旧方法，而AWS SSO联合是更简单的新方法。</strong></p><h1 id="31f3" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">Web身份联盟</h1><p id="18dc" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">有了web identity federation，您无需创建自定义登录代码或管理自己的用户身份。相反，应用程序的用户可以使用知名的外部身份提供商(IdP)登录，例如使用亚马逊、脸书、谷歌或任何其他OpenID Connect兼容的IdP登录。</p><h2 id="2a13" class="lt ig hi bd ih lu lv lw il lx ly lz ip jo ma mb it js mc md ix jw me mf jb mg bi translated">不带cogn ITO(AWS不推荐)</h2><figure class="kj kk kl km fd kn er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es ms"><img src="../Images/851aa8f7142ed621a951f9a1630d0d25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*2R_zKQYXDExcknE-.png"/></div></div><figcaption class="ku kv et er es kw kx bd b be z dx translated">图片来自夏羽·马雷克</figcaption></figure><ol class=""><li id="3dc8" class="le lf hi jf b jg kz jk la jo lg js lh jw li ka mk lk ll lm bi translated">客户端登录到第三方身份提供者。</li><li id="3f21" class="le lf hi jf b jg ln jk lo jo lp js lq jw lr ka mk lk ll lm bi translated">Web身份令牌返回给客户端。</li><li id="fad6" class="le lf hi jf b jg ln jk lo jo lp js lq jw lr ka mk lk ll lm bi translated">客户端将使用Web标识令牌调用STS AssumeRoleWithWebIdentity API来接收临时凭据。</li><li id="5cbe" class="le lf hi jf b jg ln jk lo jo lp js lq jw lr ka mk lk ll lm bi translated">STS向客户端返回临时凭证。</li><li id="b0dc" class="le lf hi jf b jg ln jk lo jo lp js lq jw lr ka mk lk ll lm bi translated">客户端访问AWS资源。</li></ol><h2 id="6fc9" class="lt ig hi bd ih lu lv lw il lx ly lz ip jo ma mb it js mc md ix jw me mf jb mg bi translated">带cogn ITO(AWS推荐)</h2><p id="71b7" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">有了Cognito，它更安全、更简单。</p><figure class="kj kk kl km fd kn er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es mt"><img src="../Images/1396278f06da33d801125a62727afd93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*adBXuxmDWcJWCgth.png"/></div></div><figcaption class="ku kv et er es kw kx bd b be z dx translated">图片来自夏羽·马雷克</figcaption></figure><ol class=""><li id="8728" class="le lf hi jf b jg kz jk la jo lg js lh jw li ka mk lk ll lm bi translated">客户端登录到第三方身份提供者。</li><li id="fe73" class="le lf hi jf b jg ln jk lo jo lp js lq jw lr ka mk lk ll lm bi translated">ID令牌返回给客户端。</li><li id="6fc4" class="le lf hi jf b jg ln jk lo jo lp js lq jw lr ka mk lk ll lm bi translated">该应用程序使用Amazon Cognito API操作来交换ID令牌的登录。</li><li id="9fea" class="le lf hi jf b jg ln jk lo jo lp js lq jw lr ka mk lk ll lm bi translated">Amazon Cognito向客户端返回Cognito令牌。</li><li id="1316" class="le lf hi jf b jg ln jk lo jo lp js lq jw lr ka mk lk ll lm bi translated">该应用程序向AWS STS请求临时安全凭证，传递Amazon Cognito令牌。</li><li id="39db" class="le lf hi jf b jg ln jk lo jo lp js lq jw lr ka mk lk ll lm bi translated">STS向客户端返回临时凭据。</li><li id="c268" class="le lf hi jf b jg ln jk lo jo lp js lq jw lr ka mk lk ll lm bi translated">应用程序可以使用临时安全凭据来访问任何AWS资源。</li></ol><h1 id="74c2" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">结束</h1><p id="80bf" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">结束关于AWS身份联盟&amp; Cognito的快速说明。</p><p id="8967" class="pw-post-body-paragraph jd je hi jf b jg kz ji jj jk la jm jn jo lb jq jr js lc ju jv jw ld jy jz ka hb bi translated">关于身份联盟的所有帖子:</p><ol class=""><li id="1ae2" class="le lf hi jf b jg kz jk la jo lg js lh jw li ka mk lk ll lm bi translated"><a class="ae mu" rel="noopener" href="/codex/aws-certified-solutions-architect-professional-identity-federation-iam-c67d0259ac90">身份&amp;联邦——IAM</a>。</li><li id="70da" class="le lf hi jf b jg ln jk lo jo lp js lq jw lr ka mk lk ll lm bi translated"><a class="ae mu" rel="noopener" href="/codex/aws-certified-solutions-architect-professional-identity-federation-sts-to-assume-a-role-1ca67105b81a">身份&amp;联邦— STS承担角色</a>。</li><li id="0553" class="le lf hi jf b jg ln jk lo jo lp js lq jw lr ka mk lk ll lm bi translated"><a class="ae mu" rel="noopener" href="/codex/aws-certified-solutions-architect-professional-identity-federation-cognito-ec80783c3fd1">身份联盟&amp;认知联盟</a>。</li><li id="8723" class="le lf hi jf b jg ln jk lo jo lp js lq jw lr ka mk lk ll lm bi translated"><a class="ae mu" rel="noopener" href="/codex/aws-certified-solutions-architect-professional-identity-federation-directory-services-895807d86497">身份联盟—目录服务</a>。</li><li id="0e9d" class="le lf hi jf b jg ln jk lo jo lp js lq jw lr ka mk lk ll lm bi translated"><a class="ae mu" rel="noopener" href="/codex/aws-certified-solutions-architect-professional-identity-federation-aws-organizations-dd63cd701a72">身份联盟— AWS组织</a>。</li><li id="d7bd" class="le lf hi jf b jg ln jk lo jo lp js lq jw lr ka mk lk ll lm bi translated"><a class="ae mu" rel="noopener" href="/codex/aws-certified-solutions-architect-professional-identity-federation-organizations-service-6192fab06d98">身份联盟—组织服务控制策略</a>。</li><li id="d24a" class="le lf hi jf b jg ln jk lo jo lp js lq jw lr ka mk lk ll lm bi translated"><a class="ae mu" rel="noopener" href="/codex/aws-certified-solutions-architect-professional-identity-federation-single-sign-on-7731df09e9a5">身份联盟—单点登录</a>。</li></ol><p id="4010" class="pw-post-body-paragraph jd je hi jf b jg kz ji jj jk la jm jn jo lb jq jr js lc ju jv jw ld jy jz ka hb bi translated">下一个<a class="ae mu" rel="noopener" href="/codex/aws-certified-solutions-architect-professional-security-cloudtrail-850006168acb">安全— CloudTrail </a>。</p></div></div>    
</body>
</html>