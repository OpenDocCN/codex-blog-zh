<html>
<head>
<title>Add RabbitMQ and gocron to your DigitalOcean droplet [Part 1]</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将RabbitMQ和gocron添加到您的数字海洋液滴中[第1部分]</h1>
<blockquote>原文：<a href="https://medium.com/codex/add-rabbitmq-and-gocron-to-your-digitalocean-droplet-part-1-a191856ae06f?source=collection_archive---------10-----------------------#2022-04-21">https://medium.com/codex/add-rabbitmq-and-gocron-to-your-digitalocean-droplet-part-1-a191856ae06f?source=collection_archive---------10-----------------------#2022-04-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="0b19" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">在您的DigitalOcean droplet上设置您自己的消息队列和cron-job。</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/1ec79fe4a72d7ed518e593bc10e9b628.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ZCe8583-MeA5AgUn"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">帕特尔王子在<a class="ae jn" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="d960" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">2022年的现代网络应用程序将使用数十种第三方服务。这些服务极大地简化了应用程序开发，使得web开发变得几乎太容易了。</p><p id="4b53" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这对于分布式系统来说更加明显。使用云提供商的不同服务可以让您专注于开发对业务更重要的核心组件。</p><p id="302f" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">例如，您可以使用“队列即服务”解决方案，而不是在Linux服务器上配置消息代理。您想运行计划任务吗？不要费心在服务器上设置cron workers，只需使用“功能即服务”的解决方案。</p><p id="e93e" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">如果您在高流量环境中工作，无法容忍停机，那么使用这些第三方解决方案是完全合理的。与其自己动手解决，不如将责任委托给第三方服务。</p><h1 id="5cf1" class="kk kl hi bd km kn ko kp kq kr ks kt ku io kv ip kw ir kx is ky iu kz iv la lb bi translated">所以何必呢？</h1><p id="96ab" class="pw-post-body-paragraph jo jp hi jq b jr lc ij jt ju ld im jw jx le jz ka kb lf kd ke kf lg kh ki kj hb bi translated">在本文中，我将介绍一个VPS(虚拟专用服务器)配置。本文的主要焦点是队列(<strong class="jq hj"> rabbitMQ </strong>)和cron-jobs( <strong class="jq hj"> gocron </strong>)。</p><p id="9825" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我写这篇文章有两个主要原因。如果你是出于同样的好奇而来，无论你的水平如何，这篇文章都适合你。</p><ol class=""><li id="5e5f" class="lh li hi jq b jr js ju jv jx lj kb lk kf ll kj lm ln lo lp bi translated">能够欣赏过去的事情是如何进行的。</li><li id="8731" class="lh li hi jq b jr lq ju lr jx ls kb lt kf lu kj lm ln lo lp bi translated">培养对队列和cron-worker如何在web服务器中实现的实际理解。</li></ol><p id="7046" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">你会听到业内资深人士的故事。想象你开始在一家新公司工作。您被指派设置或维护部署在本地服务器上的应用程序。配置庞大。也许在同一台机器上运行着多个RDBMSes。有cron-workers通宵运行来处理一些任务。事情很容易变得太复杂。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lv"><img src="../Images/d3ad6f7994820605b71cbfbc98f38a7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*YtlOf3iohBc-j_jp"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">由<a class="ae jn" href="https://unsplash.com/@cakirchoff?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Chad Kirchoff </a>在<a class="ae jn" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</figcaption></figure><p id="f1e3" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">第二，我认为在一个你不了解不同组成部分如何在较低层次运作的环境中运作是非常困难的。这让我想起了电影《极速车王》。传奇的汽车设计师兼机械师肯·迈尔斯也是一名伟大的赛车手。你可能听说过许多其他赛车手也是优秀的机械师(例如迈克尔·舒马赫)。</p><h1 id="f2c4" class="kk kl hi bd km kn ko kp kq kr ks kt ku io kv ip kw ir kx is ky iu kz iv la lb bi translated">为什么选择数字海洋？</h1><p id="292f" class="pw-post-body-paragraph jo jp hi jq b jr lc ij jt ju ld im jw jx le jz ka kb lf kd ke kf lg kh ki kj hb bi translated">对于这个练习，我决定使用DigitalOcean droplet来代替流行的AWS EC2(或类似的替代品)。DO液滴真的很好设置。我也发现DO Dashboard非常直观。</p><p id="ff7f" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">您可以将他们最基本的计划与最新的Ubuntu发行版结合使用，并部署到最近的数据中心。如果你陷入困境，你可以在他们的博客上找到非常好的文章。</p><h1 id="10c0" class="kk kl hi bd km kn ko kp kq kr ks kt ku io kv ip kw ir kx is ky iu kz iv la lb bi translated">假设</h1><p id="4c1d" class="pw-post-body-paragraph jo jp hi jq b jr lc ij jt ju ld im jw jx le jz ka kb lf kd ke kf lg kh ki kj hb bi translated">为了让这个练习更具交互性，我决定部署一个RESTful API来处理触发入队过程的HTTP请求。该应用程序在后台作为<code class="du lw lx ly lz b">systemd</code>服务运行，如果服务器重启，它也会重启。你可以在这里找到这个应用<a class="ae jn" href="https://github.com/asungur/simple_api_postgres" rel="noopener ugc nofollow" target="_blank">的回购。注意，这个应用程序使用了<strong class="jq hj"> Postgresql </strong>，这需要额外的配置。如果您想使用这个应用程序，您可能想简化它或编写自己的代码。</a></p><p id="82e9" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">构建RESTful API不是本练习的强制步骤，我也不会介绍如何构建它或者如何将这个应用程序部署到我们的VPS。</p><p id="196a" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我们会让事情变得简单而愚蠢。我们将在消息和电子邮件中使用硬编码的值。本练习的目的是复制工作流，而不是结果。</p><h1 id="1fdb" class="kk kl hi bd km kn ko kp kq kr ks kt ku io kv ip kw ir kx is ky iu kz iv la lb bi translated">最终VPS配置</h1><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ma"><img src="../Images/dd56691e503c7a3c99fafb90fd7a687e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vLCf6QQVXhrhWO6WX83cbQ.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">部署在我们的虚拟专用服务器上的最终工作流</figcaption></figure><p id="b6b9" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在下一章，<strong class="jq hj">第1部分</strong>中，我们将设置RabbitMQ，并将<strong class="jq hj"> enqueue </strong>功能添加到我们的应用程序中。</p><p id="a2c4" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在我们确认我们的队列保存了由我们的应用程序排队的消息之后，我们将继续到<strong class="jq hj">第2部分</strong>。在这里，我们将构建一个Go应用程序，它将消息从队列中取出。我们将保持应用程序作为<code class="du lw lx ly lz b">systemd</code>服务运行。</p><p id="1c8f" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">消费者应用程序将使用时钟功能(使用<code class="du lw lx ly lz b">gocron</code>库),每天(或每小时，取决于你的选择)检查消息队列，并发送电子邮件。对于电子邮件交付，我们将使用Mailgun的Go客户端库。</p><p id="0d74" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">第二章见👋</p><h1 id="e91f" class="kk kl hi bd km kn ko kp kq kr ks kt ku io kv ip kw ir kx is ky iu kz iv la lb bi translated">资源</h1><ul class=""><li id="66da" class="lh li hi jq b jr lc ju ld jx mb kb mc kf md kj me ln lo lp bi translated"><a class="ae jn" href="https://www.digitalocean.com/community/tutorials/initial-server-setup-with-ubuntu-20-04" rel="noopener ugc nofollow" target="_blank">数字海洋博客:初始服务器设置</a></li><li id="5801" class="lh li hi jq b jr lq ju lr jx ls kb lt kf lu kj me ln lo lp bi translated"><a class="ae jn" href="https://www.digitalocean.com/community/tutorials/how-to-install-postgresql-on-ubuntu-20-04-quickstart" rel="noopener ugc nofollow" target="_blank">如何在Ubuntu上安装PostgreSQL</a></li><li id="82a7" class="lh li hi jq b jr lq ju lr jx ls kb lt kf lu kj me ln lo lp bi translated"><a class="ae jn" href="https://www.imdb.com/title/tt1950186/" rel="noopener ugc nofollow" target="_blank">极速车王(2019) </a></li><li id="58ba" class="lh li hi jq b jr lq ju lr jx ls kb lt kf lu kj me ln lo lp bi translated"><a class="ae jn" href="http://adam.herokuapp.com/past/2010/4/13/rethinking_cron/" rel="noopener ugc nofollow" target="_blank">反思克朗-亚当·威金斯</a></li><li id="9e91" class="lh li hi jq b jr lq ju lr jx ls kb lt kf lu kj me ln lo lp bi translated"><a class="ae jn" href="http://adam.herokuapp.com/past/2010/6/30/replace_cron_with_clockwork/" rel="noopener ugc nofollow" target="_blank">克朗vs发条——亚当·威金斯</a></li><li id="3aa2" class="lh li hi jq b jr lq ju lr jx ls kb lt kf lu kj me ln lo lp bi translated"><a class="ae jn" href="https://www.rabbitmq.com/tutorials/tutorial-one-go.html" rel="noopener ugc nofollow" target="_blank"> RabbitMQ教程一</a></li></ul></div></div>    
</body>
</html>