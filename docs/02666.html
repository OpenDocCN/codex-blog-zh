<html>
<head>
<title>SIP Integrations with WebRTC: How it Works</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SIP与WebRTC的集成:工作原理</h1>
<blockquote>原文：<a href="https://medium.com/codex/sip-integrations-with-webrtc-how-it-works-4a4f44e2c42d?source=collection_archive---------15-----------------------#2021-07-30">https://medium.com/codex/sip-integrations-with-webrtc-how-it-works-4a4f44e2c42d?source=collection_archive---------15-----------------------#2021-07-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div class="ab fe cl ij"><img src="../Images/e14812f223fa17995fcae0609962bb52.png" data-original-src="https://miro.medium.com/v2/format:webp/0*ZRfed3WirX-IXpeY.png"/></div></figure><p id="3b98" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">如果您在问这个问题，那么很有可能您已经有了SIP基础设施，并且正在寻找与支持<a class="ae jk" href="https://webrtc.org/" rel="noopener ugc nofollow" target="_blank"> Web实时通信(WebRTC) </a>的端点互联的方法，或者您已经有了Web应用程序，并且正在寻找与电话网络互联的方法。</p><p id="a18c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在这两种情况下，目标是相同的——互联——这就是SIP的全部意义。</p><p id="5a8b" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">但是，在我们回答主要问题之前，我们需要清楚地了解SIP实际上是什么，为了做到这一点，我们需要了解一点技术。</p><h1 id="587f" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">SIP是什么？</h1><p id="b073" class="pw-post-body-paragraph im in hi io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated"><a class="ae jk" href="https://en.wikipedia.org/wiki/Session_Initiation_Protocol" rel="noopener ugc nofollow" target="_blank">会话发起协议，简称SIP，</a>从90年代就已经出现了。它是一种基于文本的信令协议，用于管理两个IP连接的端点之间的媒体会话。它经常被用在<a class="ae jk" href="https://en.wikipedia.org/wiki/Voice_over_IP" rel="noopener ugc nofollow" target="_blank">IP语音(VoIP) </a>通信中，这极大地拓展了SIP的应用范围。最初是一个相对简单的规范，现在是一个相当大的RFC、提案和扩展的集合。</p><p id="4ce5" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">不过，最终SIP的基础非常简单。其结构与HTTP非常相似；每条SIP消息由几个头部组成，每个头部占一行，后面是消息体。</p><p id="cb57" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">SIP消息主体使用称为<a class="ae jk" href="https://en.wikipedia.org/wiki/Session_Description_Protocol#:~:text=The%20Session%20Description%20Protocol%20(SDP,(VoIP)%20and%20video%20conferencing." rel="noopener ugc nofollow" target="_blank">会话描述协议(SDP) </a>的东西，它在一些SIP消息中用于描述关于最终将在两个端点之间流动的媒体流的信息，如流的数量和类型(例如音频、视频)以及允许什么编码(例如711、Opus、VP8、H.264)。</p><p id="ad1e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在典型的呼叫建立中，将发送两个SDP消息——提议和应答。呼叫发起者首先发送提议，尽可能多地描述即将建立的会话以及提议方的能力/需求。然后，呼叫接收者将(如果它接受呼叫)发送回一个应答，包括在所提供的内容的上下文中关于它自己的能力/期望的信息。</p><p id="7a92" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">如果一切顺利，这是足够双方形成连接并开始发送和接收数据的信息。</p><h1 id="7939" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">SIP和WebRTC有什么关系？</h1><p id="f6ab" class="pw-post-body-paragraph im in hi io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated">WebRTC非常自然地与所有这些相关。像SIP一样，它旨在支持在两个IP连接的端点之间创建媒体会话。像SIP一样，一旦信令完成，连接使用<a class="ae jk" href="https://en.wikipedia.org/wiki/Real-time_Transport_Protocol" rel="noopener ugc nofollow" target="_blank">实时传输协议(RTP) </a>用于媒体平面中的分组。和SIP一样，它使用SDP来描述自己。</p><p id="9a07" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">不同之处在于两个关键领域:</strong></p><ol class=""><li id="5920" class="ko kp hi io b ip iq it iu ix kq jb kr jf ks jj kt ku kv kw bi translated">它不要求在信令平面中使用SIP消息。事实上，它根本没有决定使用SIP还是任何其他信令协议。SDP消息的实际信令(发送/接收)有意留给应用。另一方面，SIP定义了一种非常特定的消息格式，必须使用这种格式来封装和发送用于呼叫建立的SDP消息。</li><li id="5e20" class="ko kp hi io b ip kx it ky ix kz jb la jf lb jj kt ku kv kw bi translated">它要求在媒体平面中使用一些SIP可选特征。具体来说:</li></ol><ul class=""><li id="f307" class="ko kp hi io b ip iq it iu ix kq jb kr jf ks jj lc ku kv kw bi translated">特定编解码器的使用。音频需要G.711和Opus，而视频需要VP8和H.264/AVC。(请注意，从技术上讲，web浏览器是唯一需要同时支持VP8和H.264的浏览器，但实际上，每个支持WebRTC的端点都应该同时考虑最大的兼容性和性能。)</li><li id="2618" class="ko kp hi io b ip kx it ky ix kz jb la jf lb jj lc ku kv kw bi translated">使用<a class="ae jk" href="https://en.wikipedia.org/wiki/Secure_Real-time_Transport_Protocol" rel="noopener ugc nofollow" target="_blank">安全实时传输协议(SRTP) </a>配置文件为媒体分组提供加密和消息认证。</li><li id="69c2" class="ko kp hi io b ip kx it ky ix kz jb la jf lb jj lc ku kv kw bi translated">使用<a class="ae jk" href="https://en.wikipedia.org/wiki/Datagram_Transport_Layer_Security" rel="noopener ugc nofollow" target="_blank">数据报传输层安全(DTLS) </a>生成SRTP使用的密钥。DTLS证书指纹必须在SDP中用信号表示。(请注意，以前支持使用安全描述(SDES ),但现在不再允许了。)</li><li id="5b7d" class="ko kp hi io b ip kx it ky ix kz jb la jf lb jj lc ku kv kw bi translated">使用交互式连接建立、NAT的会话遍历实用程序，以及使用NAT周围的中继、(ICE、STUN和TURN)进行网络遍历的<a class="ae jk" href="https://en.wikipedia.org/wiki/Traversal_Using_Relays_around_NAT" rel="noopener ugc nofollow" target="_blank">遍历。</a></li></ul><p id="b4c1" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">抛开这些差异是好是坏的争论，它们确实存在，所以我们必须与它们合作。让我们分别来看看这两者。</p><h1 id="8512" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">信令平面</h1><p id="abde" class="pw-post-body-paragraph im in hi io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated">假设现有的SIP基础设施不会切换到不同的信令协议(不会有太大的变化)，WebRTC将不得不学习如何使用SIP。</p><p id="e282" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">有两种方法可以实现这一点:</p><ol class=""><li id="a992" class="ko kp hi io b ip iq it iu ix kq jb kr jf ks jj kt ku kv kw bi translated">使用SIP作为支持WebRTC的应用程序的信令栈。</li><li id="dcee" class="ko kp hi io b ip kx it ky ix kz jb la jf lb jj kt ku kv kw bi translated">为支持WebRTC的应用程序使用另一个信令解决方案，但是要添加一个信令网关来在这个和SIP之间进行转换。</li></ol><p id="ab7a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">哪种选择更适合您，这在很大程度上取决于您现有的基础架构和扩展计划。</p><ul class=""><li id="4646" class="ko kp hi io b ip iq it iu ix kq jb kr jf ks jj lc ku kv kw bi translated">您现有SIP基础设施吗？</li><li id="7f4b" class="ko kp hi io b ip kx it ky ix kz jb la jf lb jj lc ku kv kw bi translated">您是否有选择性转发单元(SFU)或多点控制单元(MCU)来帮助扩展您的WebRTC连接？</li><li id="5ba7" class="ko kp hi io b ip kx it ky ix kz jb la jf lb jj lc ku kv kw bi translated">您的web应用程序是否已经使用了WebSync或XMPP之类的系统来进行实时文本通信？</li><li id="b790" class="ko kp hi io b ip kx it ky ix kz jb la jf lb jj lc ku kv kw bi translated">您的应用程序在哪些客户端平台上运行？</li><li id="6311" class="ko kp hi io b ip kx it ky ix kz jb la jf lb jj lc ku kv kw bi translated">您有运行在这些平台上的SIP信令栈吗？</li></ul><p id="75bf" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">你的正确道路将在很大程度上取决于这些问题的答案，甚至可能更多。</p><h1 id="4ed9" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">媒体平面</h1><p id="dbae" class="pw-post-body-paragraph im in hi io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated">如果您没有现有的SIP基础设施，那么正确的选择可能是简单地选择被列为兼容WebRTC的SIP技术。</p><p id="e7a5" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">许多SIP网关(例如FreeSWITCH)和SIP中继服务(例如Voxbone)可以配置为使用DTLS/ICE和WebRTC规定的编解码器。</p><p id="5c5c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">如果您已经有一个现有的SIP基础设施，那么可能有必要添加一个<a class="ae jk" href="https://en.wikipedia.org/wiki/Session_border_controller" rel="noopener ugc nofollow" target="_blank">会话边界控制器(SBC) </a>，例如Sonus的SBC产品系列，或者可以充当WebRTC和VoIP端点之间的媒体网关的另一个类似设备，其中SBC-to-WebRTC分支满足WebRTC的要求，而SBC-to-VoIP分支满足VoIP端点的需求。</p><p id="9bdd" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">如果您有一个<a class="ae jk" href="https://www.liveswitch.io/" rel="noopener ugc nofollow" target="_blank"> SFU/MCU来帮助您扩展WebRTC连接</a>，那么媒体服务器可能能够充当这个网关。</p><p id="7ede" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">同样，对你来说正确的道路可能需要一些讨论和对你需求的评估。在开始您的SIP集成项目之前，<a class="ae jk" href="https://www.liveswitch.io/" rel="noopener ugc nofollow" target="_blank">将风险最小化，让您的应用程序经得起未来考验</a>。</p></div></div>    
</body>
</html>