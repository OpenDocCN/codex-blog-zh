<html>
<head>
<title>ShardingSphere-JDBC Driver Released: A JDBC Driver That Requires No Code Modifications</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ShardingSphere-JDBC驱动发布:一个不需要修改代码的JDBC驱动</h1>
<blockquote>原文：<a href="https://medium.com/codex/shardingsphere-jdbc-driver-released-a-jdbc-driver-that-requires-no-code-modifications-5464c30bcd64?source=collection_archive---------11-----------------------#2022-07-06">https://medium.com/codex/shardingsphere-jdbc-driver-released-a-jdbc-driver-that-requires-no-code-modifications-5464c30bcd64?source=collection_archive---------11-----------------------#2022-07-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><h1 id="7155" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">背景</h1><p id="fa52" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><code class="du kb kc kd ke b">ShardingSphereDataSourceFactory</code>是<a class="ae kf" href="https://shardingsphere.apache.org/document/current/en/overview/#shardingsphere-jdbc" rel="noopener ugc nofollow" target="_blank">Apache sharding sphere-JDBC</a>最基本的用户API，用于转换用户的规则配置对象，生成<code class="du kb kc kd ke b">DataSource</code>的标准实现。</p><p id="5c85" class="pw-post-body-paragraph jd je hi jf b jg kg ji jj jk kh jm jn jo ki jq jr js kj ju jv jw kk jy jz ka hb bi translated">它还提供了用于<code class="du kb kc kd ke b">YAML</code>配置的<code class="du kb kc kd ke b">YamlShardingSphereDataSourceFactory</code>，以及用于Spring和<code class="du kb kc kd ke b">Spring Boot Starter</code>的定制名称空间。</p><p id="35a5" class="pw-post-body-paragraph jd je hi jf b jg kg ji jj jk kh jm jn jo ki jq jr js kj ju jv jw kk jy jz ka hb bi translated"><code class="du kb kc kd ke b">DataSource</code>是一个标准的Java JDBC接口。工程师可以使用它进一步创建符合JDBC标准的<code class="du kb kc kd ke b">Connection</code>、<code class="du kb kc kd ke b">Statement</code>、<code class="du kb kc kd ke b">PreparedStatement</code>、<code class="du kb kc kd ke b">ResultSet,</code>和其他熟悉的标准对象。它与JDBC接口的实现完全一致，所以当工程师使用Apache ShardingSphere-JDBC或使用本地JDBC时没有区别。此外，它还可以透明地与各种<a class="ae kf" href="https://stackoverflow.com/questions/1279613/what-is-an-orm-how-does-it-work-and-how-should-i-use-one" rel="noopener ugc nofollow" target="_blank"> ORM </a>框架接口。</p><h1 id="6be9" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">棘手问题</h1><p id="9f4f" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">虽然标准的JDBC接口可以在开发过程中完全适应，但是通过ShardingSphere API创建一个<code class="du kb kc kd ke b">DataSource</code>可以改变工程师最初加载数据库驱动程序的方式。</p><p id="a4ce" class="pw-post-body-paragraph jd je hi jf b jg kg ji jj jk kh jm jn jo ki jq jr js kj ju jv jw kk jy jz ka hb bi translated">尽管只有一小部分(一行)启动代码需要修改，但这实际上增加了希望平稳迁移到ShardingSphere的系统的额外开发成本。而对于无法掌握源代码的系统(比如外部采购系统)来说，使用ShardingSphere确实很困难。</p><p id="e402" class="pw-post-body-paragraph jd je hi jf b jg kg ji jj jk kh jm jn jo ki jq jr js kj ju jv jw kk jy jz ka hb bi translated">很大程度上由于其设计，ShardingSphere一直缺乏JDBC驱动的实现。Java配置的ShardingSphere-JDBC可以实现可编程的灵活性，但JDBC的驱动程序接口没有为额外的配置提供太多空间。</p><p id="15e0" class="pw-post-body-paragraph jd je hi jf b jg kg ji jj jk kh jm jn jo ki jq jr js kj ju jv jw kk jy jz ka hb bi translated">通过鞋底<code class="du kb kc kd ke b">URL</code>和<code class="du kb kc kd ke b">Properties</code>将极大地限制切割球的配置灵活性。虽然<code class="du kb kc kd ke b">YAML</code>配置可以更好的适应司机的<code class="du kb kc kd ke b">URL</code>，可读性更强，但是属于静态配置的范畴，灵活性明显不如动态配置。</p><p id="cb7f" class="pw-post-body-paragraph jd je hi jf b jg kg ji jj jk kh jm jn jo ki jq jr js kj ju jv jw kk jy jz ka hb bi translated">因此，ShardingSphere-JDBC使用类似的数据库连接池策略，绕过JDBC标准接口的限制，直接向用户公开<code class="du kb kc kd ke b">DataSource</code>。</p><p id="2e69" class="pw-post-body-paragraph jd je hi jf b jg kg ji jj jk kh jm jn jo ki jq jr js kj ju jv jw kk jy jz ka hb bi translated">但是，不改一行代码几乎是牢不可破的壁垒，这是在提高ShardingSphere-JDBC易用性的同时最大的痛点。</p><h1 id="b90d" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">机会</h1><p id="44ec" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">随着<a class="ae kf" href="https://shardingsphere.apache.org/document/current/en/quick-start/shardingsphere-proxy-quick-start/" rel="noopener ugc nofollow" target="_blank"> ShardingSphere-Proxy </a>的开发(ShardingSphere客户端)，它的两个主要生态系统特性出现了，即混合部署和<a class="ae kf" href="https://shardingsphere.apache.org/document/5.1.0/en/concepts/distsql/" rel="noopener ugc nofollow" target="_blank"> DistSQL </a>。</p><p id="5813" class="pw-post-body-paragraph jd je hi jf b jg kg ji jj jk kh jm jn jo ki jq jr js kj ju jv jw kk jy jz ka hb bi translated">ShardingSphere-JDBC的轻量级和高性能特性使其更适合面向应用的<a class="ae kf" href="https://en.wikipedia.org/wiki/Create,_read,_update_and_delete" rel="noopener ugc nofollow" target="_blank"> CRUD </a>操作。ShardingSphere-Proxy的易用性和兼容性使其更适合面向数据库管理和控制的DDL操作。这两个客户端可以一起使用，相互补充，以提供一个新的和更完整的架构解决方案。</p><p id="bdde" class="pw-post-body-paragraph jd je hi jf b jg kg ji jj jk kh jm jn jo ki jq jr js kj ju jv jw kk jy jz ka hb bi translated">凭借编程和SQL功能，DistSQL在灵活性和易用性之间取得了完美的平衡。在一个架构模型中，ShardingSphere-JDBC的配置属性显著减少，使用JDBC URL连接到治理中心和DistSQL进行配置操作是最佳解决方案。</p><p id="dcb7" class="pw-post-body-paragraph jd je hi jf b jg kg ji jj jk kh jm jn jo ki jq jr js kj ju jv jw kk jy jz ka hb bi translated">DistSQL确保了Java和YAML所缺乏的安全性，它自然支持权限控制和SQL审计，以及其他高阶功能。使用DistSQL，DBA(数据库管理员)可以非常轻松地操作和维护数据库集群。</p><h1 id="1a3b" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">履行</h1><p id="fc1b" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">前提条件满足后，ShardingSphere-JDBC版本5.1.2借机提供了一个JDBC驱动程序，它只能通过配置更改来使用，而不需要工程师修改代码。</p><h2 id="2951" class="kl ig hi bd ih km kn ko il kp kq kr ip jo ks kt it js ku kv ix jw kw kx jb ky bi translated">驱动程序类名</h2><p id="e01f" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><code class="du kb kc kd ke b">org.apache.shardingsphere.driver.ShardingSphereDriver</code></p><h2 id="d750" class="kl ig hi bd ih km kn ko il kp kq kr ip jo ks kt it js ku kv ix jw kw kx jb ky bi translated">URL配置描述</h2><ul class=""><li id="2d14" class="kz la hi jf b jg jh jk jl jo lb js lc jw ld ka le lf lg lh bi translated">前缀:<code class="du kb kc kd ke b">jdbc:shardingsphere:</code></li><li id="836a" class="kz la hi jf b jg li jk lj jo lk js ll jw lm ka le lf lg lh bi translated">配置文件:<code class="du kb kc kd ke b">xxx.yaml</code>，格式与<code class="du kb kc kd ke b">YAML</code>配置一致。</li><li id="723b" class="kz la hi jf b jg li jk lj jo lk js ll jw lm ka le lf lg lh bi translated">配置文件的加载规则:</li></ul><p id="63cc" class="pw-post-body-paragraph jd je hi jf b jg kg ji jj jk kh jm jn jo ki jq jr js kj ju jv jw kk jy jz ka hb bi translated">如果没有前缀，则从绝对路径(AP)加载配置文件。</p><p id="2b6c" class="pw-post-body-paragraph jd je hi jf b jg kg ji jj jk kh jm jn jo ki jq jr js kj ju jv jw kk jy jz ka hb bi translated"><code class="du kb kc kd ke b">classpath:</code>前缀表示从类路径加载配置文件。</p><h1 id="e4ea" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">程序</h1><h2 id="0cdb" class="kl ig hi bd ih km kn ko il kp kq kr ip jo ks kt it js ku kv ix jw kw kx jb ky bi translated">使用本机驱动程序</h2><pre class="ln lo lp lq fd lr ke ls lt aw lu bi"><span id="926e" class="kl ig hi ke b fi lv lw l lx ly">Class.forName("org.apache.shardingsphere.driver.ShardingSphereDriver");<br/>String jdbcUrl = "jdbc:shardingsphere:classpath:config.yaml";<br/><br/>String sql = "SELECT i.* FROM t_order o JOIN t_order_item i ON o.order_id=i.order_id WHERE o.user_id=? AND o.order_id=?";<br/>try (<br/>        Connection conn = DriverManager.getConnection(jdbcUrl);<br/>        PreparedStatement ps = conn.prepareStatement(sql)) {<br/>    ps.setInt(1, 10);<br/>    ps.setInt(2, 1000);<br/>    try (ResultSet rs = preparedStatement.executeQuery()) {<br/>        while(rs.next()) {<br/>            // ...        }<br/>    }<br/>}</span></pre><h2 id="202f" class="kl ig hi bd ih km kn ko il kp kq kr ip jo ks kt it js ku kv ix jw kw kx jb ky bi translated">使用数据库连接池</h2><pre class="ln lo lp lq fd lr ke ls lt aw lu bi"><span id="d621" class="kl ig hi ke b fi lv lw l lx ly">String driverClassName = "org.apache.shardingsphere.driver.ShardingSphereDriver";<br/>String jdbcUrl = "jdbc:shardingsphere:classpath:config.yaml";// take HikariCP as an example HikariDataSource dataSource = new HikariDataSource();<br/>dataSource.setDriverClassName(driverClassName);<br/>dataSource.setJdbcUrl(jdbcUrl);<br/><br/>String sql = "SELECT i.* FROM t_order o JOIN t_order_item i ON o.order_id=i.order_id WHERE o.user_id=? AND o.order_id=?";<br/>try (<br/>        Connection conn = dataSource.getConnection();<br/>        PreparedStatement ps = conn.prepareStatement(sql)) {<br/>    ps.setInt(1, 10);<br/>    ps.setInt(2, 1000);<br/>    try (ResultSet rs = preparedStatement.executeQuery()) {<br/>        while(rs.next()) {<br/>            // ...        }<br/>    }<br/>}</span></pre><h2 id="881e" class="kl ig hi bd ih km kn ko il kp kq kr ip jo ks kt it js ku kv ix jw kw kx jb ky bi translated">参考</h2><ul class=""><li id="90c7" class="kz la hi jf b jg jh jk jl jo lb js lc jw ld ka le lf lg lh bi translated"><a class="ae kf" href="https://shardingsphere.apache.org/document/current/cn/user-manual/shardingsphere-jdbc/jdbc-driver/" rel="noopener ugc nofollow" target="_blank"> JDBC司机</a></li></ul><h1 id="739d" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">结论</h1><p id="24ac" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">JDBC驱动程序使ShardingSphere比以往任何时候都更容易使用。</p><p id="f3fc" class="pw-post-body-paragraph jd je hi jf b jg kg ji jj jk kh jm jn jo ki jq jr js kj ju jv jw kk jy jz ka hb bi translated">在不久的将来，通过直接在<code class="du kb kc kd ke b">URL</code>中提供治理中心地址，可以进一步简化JDBC驱动程序。Apache ShardingSphere在多样化的分布式集群方面取得了长足的进步。</p><h2 id="d823" class="kl ig hi bd ih km kn ko il kp kq kr ip jo ks kt it js ku kv ix jw kw kx jb ky bi translated">相关链接:</h2><p id="2160" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><a class="ae kf" href="https://github.com/apache/shardingsphere/issues" rel="noopener ugc nofollow" target="_blank"> GitHub问题</a></p><p id="dfe7" class="pw-post-body-paragraph jd je hi jf b jg kg ji jj jk kh jm jn jo ki jq jr js kj ju jv jw kk jy jz ka hb bi translated"><a class="ae kf" href="https://shardingsphere.apache.org/community/en/contribute/" rel="noopener ugc nofollow" target="_blank">投稿指南</a></p><p id="bf2a" class="pw-post-body-paragraph jd je hi jf b jg kg ji jj jk kh jm jn jo ki jq jr js kj ju jv jw kk jy jz ka hb bi translated"><a class="ae kf" href="https://twitter.com/ShardingSphere" rel="noopener ugc nofollow" target="_blank"> ShardingSphere Twitter </a></p><p id="e681" class="pw-post-body-paragraph jd je hi jf b jg kg ji jj jk kh jm jn jo ki jq jr js kj ju jv jw kk jy jz ka hb bi translated"><a class="ae kf" href="https://join.slack.com/t/apacheshardingsphere/shared_invite/zt-sbdde7ie-SjDqo9~I4rYcR18bq0SYTg" rel="noopener ugc nofollow" target="_blank">切割球松弛度</a></p><p id="460f" class="pw-post-body-paragraph jd je hi jf b jg kg ji jj jk kh jm jn jo ki jq jr js kj ju jv jw kk jy jz ka hb bi translated"><a class="ae kf" href="https://community.sphere-ex.com/" rel="noopener ugc nofollow" target="_blank">华人社区</a></p><h1 id="e657" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">作者</h1><p id="2b62" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><strong class="jf hj">张亮</strong></p><p id="7479" class="pw-post-body-paragraph jd je hi jf b jg kg ji jj jk kh jm jn jo ki jq jr js kj ju jv jw kk jy jz ka hb bi translated"><strong class="jf hj"> Github: </strong> @terrymanu</p><p id="816f" class="pw-post-body-paragraph jd je hi jf b jg kg ji jj jk kh jm jn jo ki jq jr js kj ju jv jw kk jy jz ka hb bi translated">张亮，<a class="ae kf" href="https://www.sphere-ex.com/" rel="noopener ugc nofollow" target="_blank"> SphereEx </a>创始人兼CEO，曾担任多家大型知名互联网企业的架构和数据库团队负责人。他热衷于开源，是Apache ShardingSphere、<a class="ae kf" href="https://shardingsphere.apache.org/elasticjob/" rel="noopener ugc nofollow" target="_blank"> ElasticJob </a>和其他知名开源项目的创始人和PMC主席。</p><p id="cd86" class="pw-post-body-paragraph jd je hi jf b jg kg ji jj jk kh jm jn jo ki jq jr js kj ju jv jw kk jy jz ka hb bi translated">他是<a class="ae kf" href="https://www.apache.org/" rel="noopener ugc nofollow" target="_blank"> Apache软件基金会</a>成员、<a class="ae kf" href="https://mvp.microsoft.com/" rel="noopener ugc nofollow" target="_blank">微软MVP </a>、<a class="ae kf" href="https://cloud.tencent.com/tvp" rel="noopener ugc nofollow" target="_blank">腾讯云TVP </a>和<a class="ae kf" href="https://developer.huaweicloud.com/mvp" rel="noopener ugc nofollow" target="_blank">华为云MVP </a>成员，在架构和数据库领域拥有超过10年的经验。他崇尚优雅的代码，在分布式数据库技术和学术研究方面取得了很大的成就。他曾在数十个主要的国内外工业和技术峰会上担任制片人和演讲人，包括ApacheCon、QCon、AWS summit、DTCC、SACC和DTC。此外，他还出版了《未来架构:从服务到原生云》(Future Architecture:From Service to Cloud Native)(T9)一书，以及在今年的ICDE(数据库领域的顶级会议)上发表的论文《Apache ShardingSphere:一个整体的可插拔的数据分片平台》(T11)。</p></div></div>    
</body>
</html>