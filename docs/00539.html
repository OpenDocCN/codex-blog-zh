<html>
<head>
<title>A Quick and (hopefully) Clean Way to Reorganize Excel Data with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python重新组织Excel数据的一种快速且干净的方法</h1>
<blockquote>原文：<a href="https://medium.com/codex/a-quick-and-hopefully-clean-way-to-filter-and-separate-data-into-worksheets-in-a-single-excel-e22e982ef70b?source=collection_archive---------2-----------------------#2021-02-23">https://medium.com/codex/a-quick-and-hopefully-clean-way-to-filter-and-separate-data-into-worksheets-in-a-single-excel-e22e982ef70b?source=collection_archive---------2-----------------------#2021-02-23</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><h2 id="3193" class="hg hh hi bd b fp hj hk hl hm hn ho dx hp translated" aria-label="kicker paragraph"><a class="ae ge" href="http://medium.com/codex" rel="noopener">法典</a></h2><div class=""/><div class=""><h2 id="8ae1" class="pw-subtitle-paragraph io hr hi bd b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf dx translated">使用Python在单个工作簿中将Excel数据过滤和分离到不同工作表的实践指南</h2></div><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es jg"><img src="../Images/cfe1676344b02ed60d50ac0c0d34b1f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z1C2Rc6ayYkQP2Hs4Py61g.jpeg"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx translated">使用Python代码将Excel数据过滤到一个Excel工作簿中的多个工作表中—作者照片</figcaption></figure><h1 id="719f" class="jw jx hi bd jy jz ka kb kc kd ke kf kg ix kh iy ki ja kj jb kk jd kl je km kn bi translated">紧急请求！</h1><p id="6009" class="pw-post-body-paragraph ko kp hi kq b kr ks is kt ku kv iv kw kx ky kz la lb lc ld le lf lg lh li lj hb bi translated">最近，我收到一个朋友的紧急请求，要我帮她处理一个Excel文件。她需要将数据分离到不同的表中，并将所有内容保存在一个excel工作簿中。每个表的数据将来自原始文件，根据特定列中的每个唯一元素进行过滤。因此，每个工作表名称将来自该列中的每个唯一项。</p><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es lk"><img src="../Images/0828aea168bd1f158d8f770be7b3d7a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FGaxbEbOvg53qbu5mDVN0A.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx translated">我的朋友需要根据名为“<strong class="bd jy">客户类别描述</strong>”的列中的唯一项目，将数据分离到不同的工作表中所有内容都必须保存在一个工作簿中。</figcaption></figure><p id="3ce1" class="pw-post-body-paragraph ko kp hi kq b kr ll is kt ku lm iv kw kx ln kz la lb lo ld le lf lp lh li lj hb bi translated">我朋友的要求听起来很简单。但是，我不是Excel专家。在明确告诉她不要对我期望过高之后，我继续在谷歌上搜索解决方案(我想她可能已经这样做了。)</p><blockquote class="lq lr ls"><p id="b5c4" class="ko kp lt kq b kr ll is kt ku lm iv kw lu ln kz la lv lo ld le lw lp lh li lj hb bi translated">高度定制的问题需要高度灵活的解决方案。</p><p id="4d1a" class="ko kp lt kq b kr ll is kt ku lm iv kw lu ln kz la lv lo ld le lw lp lh li lj hb bi translated">—作者</p></blockquote><p id="aa78" class="pw-post-body-paragraph ko kp hi kq b kr ll is kt ku lm iv kw kx ln kz la lb lo ld le lf lp lh li lj hb bi translated">我用<a class="ae lx" href="https://en.wikipedia.org/wiki/Visual_Basic_for_Applications" rel="noopener ugc nofollow" target="_blank"> VBA代码</a>的几行找到了一个解决方案。我立即测试了它，从表面上看，它令人满意。我用VBA代码处理了给定的Excel文件，并在她要求的同一天早上把修改后的文件交给了她。</p><p id="bba8" class="pw-post-body-paragraph ko kp hi kq b kr ll is kt ku lm iv kw kx ln kz la lb lo ld le lf lp lh li lj hb bi translated">当天晚上，我决定做一个比早上更精确的人，并检查了由此产生的结果。xltm文件(启用宏的Excel文件)。我发现有一些没有名字和数据的空白表格。我立即联系了我的朋友，带着她所有的友好和感激，她承认她也发现了这个问题，但不愿意向我寻求另一种帮助。</p><p id="a275" class="pw-post-body-paragraph ko kp hi kq b kr ll is kt ku lm iv kw kx ln kz la lb lo ld le lf lp lh li lj hb bi translated">作为一名Python实践者和数据科学学徒，我把通过纠正这些错误来彻底满足她的需求作为我的责任，希望她的老板还没有因为给了他一个有缺陷的Excel工作簿而责骂她。</p><p id="4ab4" class="pw-post-body-paragraph ko kp hi kq b kr ll is kt ku lm iv kw kx ln kz la lb lo ld le lf lp lh li lj hb bi translated">这次没有VBA，我决心用<a class="ae lx" href="https://www.python.org/" rel="noopener ugc nofollow" target="_blank"> Python </a>解决问题。我会告诉你怎么做。</p></div><div class="ab cl ly lz gp ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="hb hc hd he hf"><p id="cfdf" class="pw-post-body-paragraph ko kp hi kq b kr ll is kt ku lm iv kw kx ln kz la lb lo ld le lf lp lh li lj hb bi translated"><strong class="kq hs"> <em class="lt">注意事项I: </em> </strong> <em class="lt">在本文中，出于演示的目的，我修改了原始数据，以保护姓名在原始Excel文件中的客户的隐私。然而，修改后的文件的数据结构和整洁度仍然是原始的。</em></p><p id="f492" class="pw-post-body-paragraph ko kp hi kq b kr ll is kt ku lm iv kw kx ln kz la lb lo ld le lf lp lh li lj hb bi translated"><strong class="kq hs"> <em class="lt">预告二:</em> </strong> <em class="lt">本文基于</em><a class="ae lx" href="https://www.python.org/downloads/release/python-391/" rel="noopener ugc nofollow" target="_blank"><strong class="kq hs"><em class="lt">Python 3 . 9 . 1</em></strong></a><strong class="kq hs"><em class="lt">，</em></strong><a class="ae lx" href="https://en.wikipedia.org/wiki/Project_Jupyter" rel="noopener ugc nofollow" target="_blank"><strong class="kq hs"><em class="lt">Jupyter笔记本6 . 1 . 6</em></strong></a><strong class="kq hs"><em class="lt"/></strong><em class="lt">和</em> <a class="ae lx" href="https://en.wikipedia.org/wiki/Microsoft_Excel#Excel_2019,_Office_365_and_subsequent_(v16.0)" rel="noopener ugc nofollow" target="_blank"> <strong class="kq hs"> <em class="lt">微软365的Excel</em></strong></a></p></div><div class="ab cl ly lz gp ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="hb hc hd he hf"><h1 id="bd5b" class="jw jx hi bd jy jz mf kb kc kd mg kf kg ix mh iy ki ja mi jb kk jd mj je km kn bi translated">动手部分</h1><p id="dcf2" class="pw-post-body-paragraph ko kp hi kq b kr ks is kt ku kv iv kw kx ky kz la lb lc ld le lf lg lh li lj hb bi translated">为了跟进，你可以在这里下载这个项目中使用的模拟数据集:<a class="ae lx" href="https://github.com/pkx8326/python-excel-splitsheets" rel="noopener ugc nofollow" target="_blank">https://github.com/pkx8326/python-excel-splitsheets</a></p><h2 id="10a1" class="mk jx hi bd jy ml mm mn kc mo mp mq kg kx mr ms ki lb mt mu kk lf mv mw km ho bi translated">数据探索</h2><p id="b61f" class="pw-post-body-paragraph ko kp hi kq b kr ks is kt ku kv iv kw kx ky kz la lb lc ld le lf lg lh li lj hb bi translated">如果我们要在Python中处理任何表格数据，Pandas  是一个必备的库。在将数据复制到运行Python会话的同一个文件夹中之后，我们可以导入<strong class="kq hs"> pandas </strong>库，并使用它在下面的代码中导入我们的excel数据:</p><pre class="jh ji jj jk fd mx my mz na aw nb bi"><span id="057a" class="mk jx hi my b fi nc nd l ne nf">import pandas as pd</span><span id="6e88" class="mk jx hi my b fi ng nd l ne nf">df = pd.read_excel("mockupData.xlsx")</span></pre><p id="1d9d" class="pw-post-body-paragraph ko kp hi kq b kr ll is kt ku lm iv kw kx ln kz la lb lo ld le lf lp lh li lj hb bi translated">我显式地将数据命名为“<strong class="kq hs"> mockupData.xlsx </strong>”，并确保我切断并屏蔽了所有将链接到我朋友的公司的真实客户的纽带。我分配了一个名为“<strong class="kq hs"> df </strong>的数据帧来包含来自<strong class="kq hs"> mockupData.xlsx </strong>的数据。</p><p id="82b2" class="pw-post-body-paragraph ko kp hi kq b kr ll is kt ku lm iv kw kx ln kz la lb lo ld le lf lp lh li lj hb bi translated">让我们用下面的代码来研究这些数据:</p><pre class="jh ji jj jk fd mx my mz na aw nb bi"><span id="5b79" class="mk jx hi my b fi nc nd l ne nf">df.info()</span><span id="25c9" class="mk jx hi my b fi ng nd l ne nf">&lt;class 'pandas.core.frame.DataFrame'&gt;<br/>RangeIndex: 9039 entries, 0 to 9038<br/>Data columns (total 6 columns):<br/> #   Column                      Non-Null Count  Dtype <br/>---  ------                      --------------  ----- <br/> 0   Province                    9039 non-null   object<br/> 1   Customer Name               9039 non-null   object<br/> 2   Customer Class Description  9039 non-null   object<br/> 3   Item Description            9039 non-null   object<br/> 4   SumOfQty Sold               9039 non-null   int64 <br/> 5   Sales AMT                   9039 non-null   object<br/>dtypes: int64(1), object(5)<br/>memory usage: 423.8+ KB</span></pre><p id="121b" class="pw-post-body-paragraph ko kp hi kq b kr ll is kt ku lm iv kw kx ln kz la lb lo ld le lf lp lh li lj hb bi translated">表格数据包含9039行和6列。我的朋友需要使用一个列作为过滤器来将数据分成单独的工作表，这个列叫做“客户类描述”</p><p id="81e3" class="pw-post-body-paragraph ko kp hi kq b kr ll is kt ku lm iv kw kx ln kz la lb lo ld le lf lp lh li lj hb bi translated">让我们进一步研究一下这些数据:</p><pre class="jh ji jj jk fd mx my mz na aw nb bi"><span id="c80e" class="mk jx hi my b fi nc nd l ne nf">df.head(20)</span></pre><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es nh"><img src="../Images/7be60b48d6d149df13bf979a1662e94d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Pr8GxC9-GXcrbjuKL8zS6w.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx translated"><strong class="bd jy"> df.head(20) </strong>结果—作者照片</figcaption></figure><p id="e5e1" class="pw-post-body-paragraph ko kp hi kq b kr ll is kt ku lm iv kw kx ln kz la lb lo ld le lf lp lh li lj hb bi translated">唱片的结局怎么样？</p><pre class="jh ji jj jk fd mx my mz na aw nb bi"><span id="72f7" class="mk jx hi my b fi nc nd l ne nf">df.tail(20)</span></pre><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es ni"><img src="../Images/ee66f6beadacee96aae3f34a6f511080.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-xyRd5w4N3xgpbq_mO0UHA.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx translated"><strong class="bd jy"> df.tail(20) </strong>的结果——作者照片</figcaption></figure><p id="090a" class="pw-post-body-paragraph ko kp hi kq b kr ll is kt ku lm iv kw kx ln kz la lb lo ld le lf lp lh li lj hb bi translated">我们现在可以看到目标列包含混合的字符串类别。我们将在即将创建的Excel文件中使用这些类别作为唯一的工作表名称。我们还将根据每个工作表中的每个类别过滤数据。</p><p id="8acd" class="pw-post-body-paragraph ko kp hi kq b kr ll is kt ku lm iv kw kx ln kz la lb lo ld le lf lp lh li lj hb bi translated">让我们看看目标列中所有独特类别的列表:</p><pre class="jh ji jj jk fd mx my mz na aw nb bi"><span id="5ba7" class="mk jx hi my b fi nc nd l ne nf">df[“Customer Class Description”].unique()</span></pre><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es nj"><img src="../Images/a29302105037cd3705cfc1e3c52bf048.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ek951jj4y0QiaUNvcd6xXQ.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx translated"><strong class="bd jy"> df[“客户类描述”]的结果。唯一()</strong> —作者照片</figcaption></figure><p id="ee89" class="pw-post-body-paragraph ko kp hi kq b kr ll is kt ku lm iv kw kx ln kz la lb lo ld le lf lp lh li lj hb bi translated">在那一栏中有“许多”独特的项目。多少？</p><pre class="jh ji jj jk fd mx my mz na aw nb bi"><span id="d07a" class="mk jx hi my b fi nc nd l ne nf">df["Customer Class Description"].nunique()</span><span id="1e3d" class="mk jx hi my b fi ng nd l ne nf">&gt;&gt;&gt;107</span></pre><p id="4284" class="pw-post-body-paragraph ko kp hi kq b kr ll is kt ku lm iv kw kx ln kz la lb lo ld le lf lp lh li lj hb bi translated">总共有107个独特的项目，我们似乎也有一些特殊的字符，如“<strong class="kq hs"> &amp; </strong>”或“<strong class="kq hs"> / </strong>”在一些项目中。</p><p id="ca7d" class="pw-post-body-paragraph ko kp hi kq b kr ll is kt ku lm iv kw kx ln kz la lb lo ld le lf lp lh li lj hb bi translated">不仅是那些特殊字符，在扫描列表(数组)后，人们可能会发现有些项目名称相同，但字符大小写不同，例如“<strong class="kq hs">汽车OEM </strong>”和“<strong class="kq hs">汽车OEM </strong>”，并且有些项目包含相当长的字符串。</p><p id="0eb2" class="pw-post-body-paragraph ko kp hi kq b kr ll is kt ku lm iv kw kx ln kz la lb lo ld le lf lp lh li lj hb bi translated">因为我们将根据这些项目来命名工作表，所以当我们保存新的Excel文件时，上述任何观察特征都可能导致问题。</p><p id="f0d6" class="pw-post-body-paragraph ko kp hi kq b kr ll is kt ku lm iv kw kx ln kz la lb lo ld le lf lp lh li lj hb bi translated"><strong class="kq hs"> Excel工作表命名</strong> <a class="ae lx" href="https://support.microsoft.com/en-ie/office/rename-a-worksheet-3f1f7148-ee83-404d-8ef0-9ff99fbad1f9" rel="noopener ugc nofollow" target="_blank"> <strong class="kq hs">规则</strong> </a> <strong class="kq hs"> : </strong></p><ul class=""><li id="3c6c" class="nk nl hi kq b kr ll ku lm kx nm lb nn lf no lj np nq nr ns bi translated">工作表必须有名称(名称选项卡不能为空。)</li><li id="154c" class="nk nl hi kq b kr nt ku nu kx nv lb nw lf nx lj np nq nr ns bi translated">同一工作簿中的每个工作表都必须有唯一的名称。</li><li id="6903" class="nk nl hi kq b kr nt ku nu kx nv lb nw lf nx lj np nq nr ns bi translated">名称不能超过31个字符。</li><li id="182b" class="nk nl hi kq b kr nt ku nu kx nv lb nw lf nx lj np nq nr ns bi translated">“禁止”字符是/ \？* : [ ]</li></ul><p id="9052" class="pw-post-body-paragraph ko kp hi kq b kr ll is kt ku lm iv kw kx ln kz la lb lo ld le lf lp lh li lj hb bi translated">上面的列表也是我们的Python代码从目标列中管理和提取唯一元素的规则，并将它们用作新Excel文件中工作表的名称。</p><h2 id="067c" class="mk jx hi bd jy ml mm mn kc mo mp mq kg kx mr ms ki lb mt mu kk lf mv mw km ho bi translated">数据准备</h2><p id="4c45" class="pw-post-body-paragraph ko kp hi kq b kr ks is kt ku kv iv kw kx ky kz la lb lc ld le lf lg lh li lj hb bi translated">我们应该关注的唯一一列是名为“客户类别描述”的列我们将使用该列作为筛选器，将数据划分到工作表中，以该列中每个唯一的项目命名它们，所有这些都在一个新的工作簿中。我们不会创建数据帧的副本；我们将直接修改我们感兴趣的栏目中的项目。</p><p id="db13" class="pw-post-body-paragraph ko kp hi kq b kr ll is kt ku lm iv kw kx ln kz la lb lo ld le lf lp lh li lj hb bi translated"><strong class="kq hs">将“禁止”字符替换为“_”:</strong>根据工作表命名规则，看起来“&amp;是可以的，但是其他的“禁止”字符还是需要替换。我们将用“_”替换它们</p><p id="c645" class="pw-post-body-paragraph ko kp hi kq b kr ll is kt ku lm iv kw kx ln kz la lb lo ld le lf lp lh li lj hb bi translated">因为在我们关注的列中有许多独特的项目，对于彻底的手工挑选来说太多了，如果Python在该列的任何项目中找到任何禁止的字符，我们将用下面的代码告诉Python用“_”替换它们:</p><pre class="jh ji jj jk fd mx my mz na aw nb bi"><span id="96b1" class="mk jx hi my b fi nc nd l ne nf">for i in df.index:<br/>    if ":" or "\\" or "?" or "*" or "[" or "]" in df["Customer Class Description"].iloc[i]:<br/>        df["Customer Class Description"].iloc[i] = df["Customer Class Description"].iloc[i].replace(":", "_").replace("\\", "_").replace("/", "_").replace("?", "_").replace("*", "_").replace("[", "_").replace("]", "_")</span></pre><p id="8d30" class="pw-post-body-paragraph ko kp hi kq b kr ll is kt ku lm iv kw kx ln kz la lb lo ld le lf lp lh li lj hb bi translated">在df.index中用“<strong class="kq hs"> for i:，</strong>”我们告诉Python迭代索引为I的列中的每一项。Python用<strong class="kq hs">知道这一点。iloc[i] </strong>段。</p><p id="362d" class="pw-post-body-paragraph ko kp hi kq b kr ll is kt ku lm iv kw kx ln kz la lb lo ld le lf lp lh li lj hb bi translated">为了方便起见，我们还利用Python将方法链接在一起的能力。在这里，我们链上<strong class="kq hs">。replace() </strong> string方法将每个列项中的所有禁用字符替换为“_”。</p><p id="b045" class="pw-post-body-paragraph ko kp hi kq b kr ll is kt ku lm iv kw kx ln kz la lb lo ld le lf lp lh li lj hb bi translated"><strong class="kq hs">截断字符串长度超过31个字符的项目:</strong>现在，需要考虑的另一点是，工作表的名称不能超过31个字符。我们可以用下面的代码快速解决这个问题:</p><pre class="jh ji jj jk fd mx my mz na aw nb bi"><span id="8ee7" class="mk jx hi my b fi nc nd l ne nf">for i in df.index:<br/>    if len(df["Customer Class Description"].iloc[i]) &gt; 31:<br/>        df["Customer Class Description"].iloc[i] = df["Customer Class Description"].iloc[i][:31]</span></pre><p id="5242" class="pw-post-body-paragraph ko kp hi kq b kr ll is kt ku lm iv kw kx ln kz la lb lo ld le lf lp lh li lj hb bi translated">上面代码末尾的<strong class="kq hs"> [:30] </strong>段明确地告诉Python选择当前项的第一个字符到第30个字符的字符串，并丢弃其余的。总共，我们将有31个字符在每个项目中(从第0到第30个字符。)</p><p id="722e" class="pw-post-body-paragraph ko kp hi kq b kr ll is kt ku lm iv kw kx ln kz la lb lo ld le lf lp lh li lj hb bi translated"><strong class="kq hs">消除具有不同字符大小写的重复项目名称:</strong>这是最棘手的部分，但有一个非常简单的解决方案。</p><p id="8c81" class="pw-post-body-paragraph ko kp hi kq b kr ll is kt ku lm iv kw kx ln kz la lb lo ld le lf lp lh li lj hb bi translated">从该列唯一项目的整个列表(数组)中，我们可以初步看到至少有“<strong class="kq hs">汽车OEM </strong>”和“<strong class="kq hs">汽车OEM </strong>”到目前为止，我们还不知道是否还有其他如“<strong class="kq hs">汽车代工</strong>”(均为小写字母)或极端情况如“<strong class="kq hs">汽车代工】</strong>(有交替格)<strong class="kq hs"> </strong>或<strong class="kq hs"/><strong class="kq hs">automotiveoem</strong><strong class="kq hs"/>(不带任何空格。)<strong class="kq hs"> </strong>而不仅仅是<strong class="kq hs"> <em class="lt">这个</em> </strong>项；其他项目有平等的权利有自己的变化。</p><p id="d69f" class="pw-post-body-paragraph ko kp hi kq b kr ll is kt ku lm iv kw kx ln kz la lb lo ld le lf lp lh li lj hb bi translated">假设我们可以安全地忘记“<em class="lt">极端情况</em>”，我们可以“正常化”所有项目，在这种情况下，通过将它们全部变成大写或小写。我选择用下面的代码使它们都是大写的:</p><pre class="jh ji jj jk fd mx my mz na aw nb bi"><span id="3961" class="mk jx hi my b fi nc nd l ne nf">for i in df.index:<br/>    df["Customer Class Description"].iloc[i] = df["Customer Class Description"].iloc[i].upper()</span></pre><p id="8d4c" class="pw-post-body-paragraph ko kp hi kq b kr ll is kt ku lm iv kw kx ln kz la lb lo ld le lf lp lh li lj hb bi translated">现在，每个项目只有一种变化。在<strong class="kq hs"> <em class="lt">汽车代工</em></strong><em class="lt"/>的情况下我们只有“<strong class="kq hs">汽车代工</strong>”</p><p id="3292" class="pw-post-body-paragraph ko kp hi kq b kr ll is kt ku lm iv kw kx ln kz la lb lo ld le lf lp lh li lj hb bi translated">在完成列大写中的所有项目后，我们现在应该有106个唯一项目，假设只有“<strong class="kq hs">Automotive OEM”</strong>是唯一的重复项目。让我们用下面的代码来验证这个假设:</p><pre class="jh ji jj jk fd mx my mz na aw nb bi"><span id="1cac" class="mk jx hi my b fi nc nd l ne nf">df["Customer Class Description"].nunique()</span><span id="60b7" class="mk jx hi my b fi ng nd l ne nf">&gt;&gt;&gt;106</span></pre><p id="a40d" class="pw-post-body-paragraph ko kp hi kq b kr ll is kt ku lm iv kw kx ln kz la lb lo ld le lf lp lh li lj hb bi translated">我们有钱了！让我们快速浏览一下我们列中修改后的项目列表(数组):</p><pre class="jh ji jj jk fd mx my mz na aw nb bi"><span id="bd1c" class="mk jx hi my b fi nc nd l ne nf">df["Customer Class Description"].unique()</span></pre><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es ny"><img src="../Images/935695ef74bc1ebdca559b455619294b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ub3NiJurV2ZUqmNzt2CxIQ.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx translated"><strong class="bd jy"> df[“客户类描述”]的新结果。唯一()</strong> —作者照片</figcaption></figure><p id="2eec" class="pw-post-body-paragraph ko kp hi kq b kr ll is kt ku lm iv kw kx ln kz la lb lo ld le lf lp lh li lj hb bi translated">好像栏里所有项目都是大写的，这里那里都有“_”，原来是“禁”字的地方。</p><h2 id="811a" class="mk jx hi bd jy ml mm mn kc mo mp mq kg kx mr ms ki lb mt mu kk lf mv mw km ho bi translated">保存新的Excel文件</h2><p id="98ff" class="pw-post-body-paragraph ko kp hi kq b kr ks is kt ku kv iv kw kx ky kz la lb lc ld le lf lg lh li lj hb bi translated">现在可以安全地将该列用作新Excel工作簿的筛选器了。要继续，我们必须根据筛选列中的每个唯一项目筛选数据，并将它们作为单独的工作表保存在新的excel工作簿中。我们可以用下面的代码完成这项任务:</p><pre class="jh ji jj jk fd mx my mz na aw nb bi"><span id="ac83" class="mk jx hi my b fi nc nd l ne nf">writer = pd.ExcelWriter("Sorted_by_Sheets.xlsx")</span><span id="49b0" class="mk jx hi my b fi ng nd l ne nf">for i in df["Customer Class Description"].unique()<br/>    df[df["Customer Class Description"].str.contains(i)].to_excel(writer, sheet_name = i, index = False)</span><span id="96ae" class="mk jx hi my b fi ng nd l ne nf">writer.save()</span></pre><p id="563c" class="pw-post-body-paragraph ko kp hi kq b kr ll is kt ku lm iv kw kx ln kz la lb lo ld le lf lp lh li lj hb bi translated">名为“<strong class="kq hs"> Sorted_by_Sheets.xlsx </strong>的结果文件将包含以下数据结构和表格(更多表格隐藏在视图之外):</p><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es lk"><img src="../Images/9e55ceb0e7f085eca8726ef2c94a39a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Hn1cZDNFL8zHyihc1SJTsg.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx translated">最终结果是一个<strong class="bd jy"> Excel </strong>工作簿，根据“<strong class="bd jy">客户类别描述</strong>”列中的每个唯一项目，每个工作表中的数据都是独立的——作者照片</figcaption></figure><h1 id="b011" class="jw jx hi bd jy jz ka kb kc kd ke kf kg ix kh iy ki ja kj jb kk jd kl je km kn bi translated"><strong class="ak">整理好一切</strong></h1><p id="1856" class="pw-post-body-paragraph ko kp hi kq b kr ks is kt ku kv iv kw kx ky kz la lb lc ld le lf lg lh li lj hb bi translated">我们可以将上述所有步骤合并成一个功能。确保原始数据文件位于运行Python的同一文件夹中后，可以使用以下函数:</p><pre class="jh ji jj jk fd mx my mz na aw nb bi"><span id="097c" class="mk jx hi my b fi nc nd l ne nf">def sort_by_sheet_excel(inputFileName, byColumn, outputFileName):<br/>    import pandas as pd<br/>    <br/>    readFileName = inputFileName<br/>    df = pd.read_excel(readFileName)<br/>    <br/>    #Eliminate unwatned characters:<br/>    for i in df.index:<br/>        if ":" or "\\" or "?" or "*" or "[" or "]" in df[byColumn].iloc[i]:<br/>            df[byColumn].iloc[i] = df[byColumn].iloc[i].replace(":", "_").replace("\\", "_").replace("/", "_").replace("?", "_").replace("*", "_").replace("[", "_").replace("]", "_")<br/>            <br/>    <br/>    <br/>    #Eliminate records that has more than 31 characters:<br/>    for i in df.index:<br/>        if len(df[byColumn].iloc[i]) &gt; 31:<br/>            df[byColumn].iloc[i] = df[byColumn].iloc[i][:30]<br/>            <br/>    <br/>    #Eliminate same record names but with different cases:<br/>    for i in df.index:<br/>        df[byColumn].iloc[i] = df[byColumn].iloc[i].upper()</span><span id="9427" class="mk jx hi my b fi ng nd l ne nf">#Write to excel file:<br/>    writer = pd.ExcelWriter(outputFileName)<br/>    <br/>    for i in df[byColumn].unique():<br/>        df[df[byColumn].str.contains(i)].to_excel(writer, sheet_name = i, index = False)</span><span id="040d" class="mk jx hi my b fi ng nd l ne nf">writer.save()<br/>    <br/>    newFile = pd.ExcelFile(outputFileName)<br/>    print("An excel file named {} is created with {} unique sheets.".format(outputFileName, len(newFile.sheet_names)))</span></pre><p id="4c7a" class="pw-post-body-paragraph ko kp hi kq b kr ll is kt ku lm iv kw kx ln kz la lb lo ld le lf lp lh li lj hb bi translated">使用<strong class="kq hs"> sort_by_sheet_excel </strong>，您可以给出原始文件名、感兴趣的列的名称以及预期的输出文件名，一切都准备好了！</p><pre class="jh ji jj jk fd mx my mz na aw nb bi"><span id="8ef6" class="mk jx hi my b fi nc nd l ne nf">sort_by_sheet_excel("mockupData.xlsx", "Customer Class Description", "sorted_by_sheets_1.xlsx")</span><span id="ad23" class="mk jx hi my b fi ng nd l ne nf">&gt;&gt;&gt;An excel file named sorted_by_sheets_1.xlsx is created with 106 unique sheets.</span></pre><p id="c730" class="pw-post-body-paragraph ko kp hi kq b kr ll is kt ku lm iv kw kx ln kz la lb lo ld le lf lp lh li lj hb bi translated">检查结果后。xlsx文件中，我没有发现“空白表”,就像我使用通过谷歌搜索找到的VBA代码得到的结果一样。为Python欢呼三声！</p><h1 id="d05a" class="jw jx hi bd jy jz ka kb kc kd ke kf kg ix kh iy ki ja kj jb kk jd kl je km kn bi translated">结论</h1><p id="7521" class="pw-post-body-paragraph ko kp hi kq b kr ks is kt ku kv iv kw kx ky kz la lb lc ld le lf lg lh li lj hb bi translated">我已经向您展示了我们可以使用Python编码将过滤后的数据分离到单个Excel工作簿中的表中。在我的情况下。xlsx文件不像我用VBA编码得到的文件那样错误百出。然而，本文并不是说Python比VBA好。高度定制的问题需要高度灵活的解决方案。无论是VBA还是Python，编码都是正确的选择。这一切都取决于你知道你可以做得更好。</p><p id="cf02" class="pw-post-body-paragraph ko kp hi kq b kr ll is kt ku lm iv kw kx ln kz la lb lo ld le lf lp lh li lj hb bi translated">既然这里一直在说Excel，你有没有想过Excel和SQL有什么区别？查看本文了解更多信息。</p><p id="cab5" class="pw-post-body-paragraph ko kp hi kq b kr ll is kt ku lm iv kw kx ln kz la lb lo ld le lf lp lh li lj hb bi translated">下次见，编码快乐！</p></div></div>    
</body>
</html>