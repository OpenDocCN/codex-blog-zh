<html>
<head>
<title>Simulate Poor Network Conditions in iOS Development</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在iOS开发中模拟恶劣的网络条件</h1>
<blockquote>原文：<a href="https://medium.com/codex/simulate-poor-network-conditions-in-ios-development-1c1912a33a51?source=collection_archive---------4-----------------------#2021-04-21">https://medium.com/codex/simulate-poor-network-conditions-in-ios-development-1c1912a33a51?source=collection_archive---------4-----------------------#2021-04-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/8fbba5388c23ecf03a768dd4acf38499.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UphZ73MRENXrHqld1wMmUw.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">弗雷德里克·李佛特在<a class="ae iu" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="1548" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在软件开发中，我们总是专注于实现最终结果，有时会忽略另一个重要的衡量标准，以确保我们向用户提供最好的应用程序。</p><p id="b114" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我知道现在的大多数用户都有很好的互联网连接，有高速WiFi和4G。然而，我们不能否认，在某些情况下，连接有时会变得很差，这肯定会影响应用程序的正常行为。</p><p id="aaf5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">作为开发人员，我们应该为处理网络故障做好充分的准备，例如添加重试功能、网络连接监听器，当然，还要显示适当的错误消息。</p><h1 id="99b0" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">我们需要什么工具？</h1><p id="2dba" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">从<a class="ae iu" href="https://developer.apple.com/videos/play/wwdc2019/422/" rel="noopener ugc nofollow" target="_blank"> WWDC19 </a>开始，Xcode 11就配备了<strong class="ix hj">网络调节器链接</strong>来模拟多种网络状况。如果我们能准备一个测试计划来测试不同条件下的预期结果，那就更好了。例如，完全丢包(请求失败)和LTE连接之间的处理应该不同，我们需要模拟这两种情况。</p><h1 id="8cea" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">怎么用？</h1><p id="196c" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">在iOS开发中，我们可以使用两种方法。</p><h2 id="53cd" class="kw ju hi bd jv kx ky kz jz la lb lc kd jg ld le kh jk lf lg kl jo lh li kp lj bi translated">1.在开发者设置中使用设备网络链接调节器</h2><p id="43be" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">在“设置”中，转到“开发者”部分，并选择“网络链接调节器”。从那里，将其切换到“启用”并选择任何首选条件。哇，这么简单对吧？</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lk"><img src="../Images/3cc05fbdf4be896000246ae065ff8ab5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZOr1hnzPxmE8kpW7RutcrQ.png"/></div></div></figure><h2 id="c9d0" class="kw ju hi bd jv kx ky kz jz la lb lc kd jg ld le kh jk lf lg kl jo lh li kp lj bi translated">2.使用Xcode设备条件</h2><p id="ca5f" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">这个方法非常类似，除了我们从Xcode触发它到一个调试设备。</p><p id="ff20" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">从Xcode菜单“窗口”中打开它，然后转到“设备和模拟器”并检查您连接的设备。<strong class="ix hj">确保解锁</strong> <strong class="ix hj">您的设备</strong>，您应该会看到类似如下的视图。在下拉条件中选择“网络链接”。</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lk"><img src="../Images/8b25cc36af9bd7862c115d29c0b416e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*97EcAgLol193I6FkaDQmEQ.png"/></div></div></figure><p id="316e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然后，只需选择任何首选的网络条件进行测试。单击底部的“开始”按钮，您应该会看到“网络状况”图标(红色圆圈中，对于其他设备可能略有不同)</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lp"><img src="../Images/b0c9a677025d21dc9d03c85e4c1ee533.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7-Jx5CW32Dm-N0LXltODqQ.png"/></div></div></figure><h1 id="f30e" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">我们现在要试试吗？</h1><p id="e690" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">是的，我们写一个简单的代码，看看如何在开发中实现。我创建了包含对<a class="ae iu" href="https://docs.github.com/en/rest" rel="noopener ugc nofollow" target="_blank"> GitHub公共API </a>的json请求并记录执行时间的项目(您可以使用自己的项目)。</p><p id="12ca" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">首先，简单地将这段代码粘贴到<code class="du lq lr ls lt b">ViewController</code>中。请记住，它只能在真实的iOS设备上运行，而不能在模拟器上运行。在这个测试中，我使用了第二种方法来从Xcode设置(对我来说，这要容易得多)。</p><p id="eb5f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这段代码中，我使用了由<a class="ae iu" href="https://www.hackingwithswift.com/example-code/system/measuring-execution-speed-using-cfabsolutetimegetcurrent" rel="noopener ugc nofollow" target="_blank">hackingwithswithswith</a>解释的速度测量。另外，我使用<code class="du lq lr ls lt b">URLSession</code>和<a class="ae iu" href="https://developer.apple.com/documentation/dispatch/dispatchgroup" rel="noopener ugc nofollow" target="_blank"> DispatchGroup </a>以异步模式执行5个GET请求。</p><figure class="ll lm ln lo fd ij"><div class="bz dy l di"><div class="lu lv l"/></div></figure><h1 id="c772" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">分析</h1><figure class="ll lm ln lo fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lw"><img src="../Images/c09921d1cc23cc7e1d981cf680ee9073.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EuHvw5YehfULnDxVJCPegg.png"/></div></div></figure><p id="fad7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">以上是我得到的结果(可能会因设备和您的实际互联网连接而异)。从这个结果，我们可以知道什么将是最好的情况，中等和最坏的情况。因此，我们可以确定如何正确处理延迟。</p><p id="ac66" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">例如，我们可以将请求超时设置为25-30秒，这样当连接很差时，用户不会等到60秒。其次，我们还可以测试当请求失败或缓慢时如何显示错误消息。</p><p id="2099" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">厉害！</p><h1 id="7fa5" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">有办法在模拟器上测试吗？</h1><p id="6395" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">答案是肯定的。但是当然，精确度不会像使用真实设备那样好。网络调节器链接实际上在Mac上<a class="ae iu" href="https://developer.apple.com/download/more/?q=Additional%20Tools" rel="noopener ugc nofollow" target="_blank">可用</a>用于测试Mac应用。尝试使用mac应用程序并设置首选网络条件。</p></div><div class="ab cl lx ly gp lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="hb hc hd he hf"><p id="ed44" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">感谢您的阅读，不要忘记与您的朋友分享。非常欢迎反馈。</p><p id="da1c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">“学习，这是我们增长技能的方式”</p><h1 id="6b96" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">参考</h1><p id="575b" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated"><a class="ae iu" href="https://developer.apple.com/videos/play/wwdc2019/422/" rel="noopener ugc nofollow" target="_blank">https://developer.apple.com/videos/play/wwdc2019/422/</a></p><p id="09ad" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae iu" href="https://developer.apple.com/documentation/xcode-release-notes/xcode-11-release-notes" rel="noopener ugc nofollow" target="_blank">https://developer . apple . com/documentation/xcode-release-notes/xcode-11-release-notes</a></p><p id="4149" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae iu" href="https://developer.apple.com/documentation/dispatch/dispatchgroup" rel="noopener ugc nofollow" target="_blank">https://developer . apple . com/documentation/dispatch/dispatch group</a></p><p id="13b0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae iu" href="https://docs.github.com/en/rest" rel="noopener ugc nofollow" target="_blank">https://docs.github.com/en/rest</a></p><p id="1878" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae iu" href="https://www.hackingwithswift.com/example-code/system/measuring-execution-speed-using-cfabsolutetimegetcurrent" rel="noopener ugc nofollow" target="_blank">https://www . hacking with swift . com/example-code/system/measuring-execution-speed-using-cfabsolutetimegetcurrent</a></p></div></div>    
</body>
</html>