<html>
<head>
<title>Algorithmic Trading with MACD in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python中MACD的算法交易</h1>
<blockquote>原文：<a href="https://medium.com/codex/algorithmic-trading-with-macd-in-python-1c2769a6ad1b?source=collection_archive---------0-----------------------#2021-05-01">https://medium.com/codex/algorithmic-trading-with-macd-in-python-1c2769a6ad1b?source=collection_archive---------0-----------------------#2021-05-01</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="398f" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">实施强有力战略的逐步指南</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/5bc1df345feed083b54bedb3b711252b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*zEqYdV3ozR9i7ma_"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated"><a class="ae jn" href="https://unsplash.com/@m_b_m?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> M. B. M. </a>在<a class="ae jn" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><h1 id="40e5" class="jo jp hi bd jq jr js jt ju jv jw jx jy io jz ip ka ir kb is kc iu kd iv ke kf bi translated">介绍</h1><p id="b0a2" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">在这个算法交易系列的前一篇文章中，我们看到了如何使用布林线来进行成功的交易。在这篇文章中，我们将发现另一个强大的技术指标，被认为是最受交易者欢迎的指标之一。这不是别人，正是移动平均线收敛/发散(MACD)。我们将首先了解这个交易指标是什么，然后，我们将在python中实现并回测基于该指标的交易策略，以了解它在现实世界中的工作情况。让我们深入文章！</p><p id="1407" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">在继续之前，如果你想在没有任何代码的情况下回溯测试你的交易策略，有一个解决方案。这是<a class="ae jn" href="https://www.backtestzone.com/" rel="noopener ugc nofollow" target="_blank">的后验区</a>。这是一个平台，可以免费对不同类型的可交易资产的任意数量的交易策略进行回溯测试，无需编码。点击这里的链接，你可以马上使用这个工具:<a class="ae jn" href="https://www.backtestzone.com/" rel="noopener ugc nofollow" target="_blank">https://www.backtestzone.com/</a></p><h1 id="6163" class="jo jp hi bd jq jr js jt ju jv jw jx jy io jz ip ka ir kb is kc iu kd iv ke kf bi translated">MACD</h1><p id="5859" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">在学习MACD之前，有必要知道指数移动平均线(EMA)是什么意思。EMA是一种移动平均线(MA ),它自动为最近的数据点分配较大的权重(除了重要性之外),而为遥远过去的数据点分配较小的权重。例如，一份试卷将由10%的一分问题、40%的三分问题和50%的长答案问题组成。从这个例子中，您可以观察到，我们根据重要性级别为试卷的每个部分分配了唯一的权重(长答案问题可能比一分问题更重要)。</p><p id="d5d1" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">现在，MACD是一个趋势跟踪领先指标，通过减去两个指数移动平均线(一个周期较长，另一个周期较短)来计算。MACD指标有三个显著的组成部分。</p><ul class=""><li id="0713" class="lh li hi ki b kj lc km ld kp lj kt lk kx ll lb lm ln lo lp bi translated"><strong class="ki hj"> MACD线:</strong>这条线是两个给定的指数均线之差。为了计算MACD线，需要计算一个周期较长的均线(慢速线)和一个周期较短的均线(快速线)。最快和最慢的长度分别是12，26。从快速均线中减去慢速均线可以得到最终的MACD线值。计算MACD线的公式可以表示如下:</li></ul><pre class="iy iz ja jb fd lq lr ls lt aw lu bi"><span id="0b96" class="lv jp hi lr b fi lw lx l ly lz"><strong class="lr hj">MACD LINE = FAST LENGTH EMA - SLOW LENGTH EMA</strong></span></pre><ul class=""><li id="b7cb" class="lh li hi ki b kj lc km ld kp lj kt lk kx ll lb lm ln lo lp bi translated"><strong class="ki hj">信号线:</strong>这条线是MACD线本身在给定时间段内的指数移动平均线。计算信号线最流行的时期是9。由于我们平均了MACD线本身，信号线将比MACD线更平滑。</li><li id="b9d9" class="lh li hi ki b kj ma km mb kp mc kt md kx me lb lm ln lo lp bi translated"><strong class="ki hj">直方图:</strong>顾名思义，是特意绘制出来揭示MACD线和信号线区别的直方图。这是用来识别趋势的一个很好的组件。计算直方图的公式可表示如下:</li></ul><pre class="iy iz ja jb fd lq lr ls lt aw lu bi"><span id="1f53" class="lv jp hi lr b fi lw lx l ly lz"><strong class="lr hj">HISTOGRAM = MACD LINE - SIGNAL LINE</strong></span></pre><p id="9381" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">既然我们已经了解了MACD到底是什么。让我们对将要建立的交易策略有一些直觉。</p><p id="2ec9" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated"><strong class="ki hj">关于交易策略:</strong>在这篇文章中，我们将建立一个简单的交叉策略，只要MACD线穿过信号线，就会显示买入信号。同样，当信号线穿过MACD线时，这个策略会显示卖出信号。我们的MACD交叉交易策略可以表述如下:</p><pre class="iy iz ja jb fd lq lr ls lt aw lu bi"><span id="69c5" class="lv jp hi lr b fi lw lx l ly lz"><strong class="lr hj">IF MACD LINE &gt; SIGNAL LINE =&gt; BUY THE STOCK<br/>IF SIGNAL LINE &gt; MACD LINE =&gt; SELL THE STOCK</strong></span></pre><p id="cfa3" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">在继续之前，免责声明:本文的唯一目的是教育人们，必须被视为信息，而不是投资建议或其他。</p><h1 id="6047" class="jo jp hi bd jq jr js jt ju jv jw jx jy io jz ip ka ir kb is kc iu kd iv ke kf bi translated">用Python实现</h1><p id="63a6" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">在学习了什么是MACD并对我们的交易策略有了一些了解之后，我们现在开始用python编写我们的策略，并看到一些有趣的结果。编码部分分为以下几个步骤:</p><pre class="iy iz ja jb fd lq lr ls lt aw lu bi"><span id="67c4" class="lv jp hi lr b fi lw lx l ly lz"><strong class="lr hj">1. Importing Packages<br/>2. Extracting Data from Alpha Vantage<br/>3. MACD Calculation<br/>4. MACD Plot<br/>5. Creating the Trading Strategy<br/>6. Plotting the Trading Lists<br/>7. Creating our Position<br/>8. Backtesting<br/>9. SPY ETF Comparison</strong></span></pre><p id="29f1" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">我们将按照上面列表中提到的顺序，系好安全带，跟随每一个即将到来的编码部分。</p><h2 id="90f4" class="lv jp hi bd jq mf mg mh ju mi mj mk jy kp ml mm ka kt mn mo kc kx mp mq ke mr bi translated">步骤1:导入包</h2><p id="5cfd" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">将所需的包导入python环境是一个不可跳过的步骤。主要的包是处理数据的Pandas，处理数组和复杂函数的NumPy，用于绘图的Matplotlib，以及进行API调用的请求。二级包是数学函数的Math和字体定制的Termcolor(可选)。</p><p id="8400" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated"><strong class="ki hj"> Python实现:</strong></p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ms mt l"/></div></figure><p id="43e7" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">既然我们已经将所有基本的包导入到python环境中。让我们用Alpha Vantage强大的股票API来提取Google的历史数据。</p><h2 id="dc78" class="lv jp hi bd jq mf mg mh ju mi mj mk jy kp ml mm ka kt mn mo kc kx mp mq ke mr bi translated">步骤2:从Alpha Vantage中提取数据</h2><p id="b8ee" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">在这一步，我们将使用Alpha Vantage提供的API端点提取Google的历史数据。在此之前，关于Alpha Vantage的一个说明:Alpha Vantage提供免费的股票API，用户可以通过这些API访问各种数据，如实时更新，以及股票、货币和加密货币的历史数据。确保你在Alpha Vantage上有一个帐户，只有这样，你才能访问你的秘密API密匙(使用API提取数据的一个关键元素)。</p><p id="4fde" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated"><strong class="ki hj"> Python实现:</strong></p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ms mt l"/></div></figure><p id="6f68" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated"><strong class="ki hj">输出:</strong></p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mu"><img src="../Images/eecaa1cdaab0d095dd306d04ee081a30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L5yvU73hBxbLh6CBx6YAAw.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">作者图片</figcaption></figure><p id="61e4" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated"><strong class="ki hj">代码解释:</strong>我们做的第一件事是定义一个名为‘get _ historical _ data’的函数，该函数将股票的符号(‘symbol’)作为必需参数，将历史数据的开始日期(‘start _ date’)作为可选参数。在函数内部，我们定义了API键和URL，并将它们存储到各自的变量中。接下来，我们使用“get”函数提取JSON格式的历史数据，并将其存储到“raw_df”变量中。在对原始JSON数据进行清理和格式化之后，我们将以干净的Pandas数据帧的形式返回它。最后，我们调用创建的函数来提取Google从2020年开始的历史数据，并将其存储到“googl”变量中。</p><h2 id="ae37" class="lv jp hi bd jq mf mg mh ju mi mj mk jy kp ml mm ka kt mn mo kc kx mp mq ke mr bi translated">第三步:MACD计算</h2><p id="e584" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">在这一步中，我们将从Google提取的历史数据中计算MACD指标的所有组成部分。</p><p id="21d0" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated"><strong class="ki hj"> Python实现:</strong></p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ms mt l"/></div></figure><p id="e882" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated"><strong class="ki hj">输出:</strong></p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mv"><img src="../Images/06cdd0d76e195b899cfe00723e22b0cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1376/format:webp/1*vAzvuJIfHLNFAKkDspPUKw.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">作者图片</figcaption></figure><p id="dd9f" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated"><strong class="ki hj">代码解释:</strong>首先，我们定义一个名为“get_macd”的函数，它获取股票的价格(“prices”)、慢速均线的长度(“slow”)、快速均线的长度(“fast”)以及信号线的周期(“smooth”)。</p><p id="5a28" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">在函数内部，我们首先使用Pandas提供的“ewm”函数计算快速和慢速长度ema，并将它们分别存储到“ema1”和“ema2”变量中。接下来，我们通过从快速均线中减去慢速均线来计算macd线的值，并以熊猫数据帧的形式存储到“MACD”变量中。接下来，我们定义了一个名为“signal”的变量来存储信号线的值，该值是通过在指定的时间段内获取macd线值(“MACD”)的均线来计算的。然后，我们通过从信号线的值(“信号”)中减去macd线的值(“MACD”)来计算直方图值，并将它们存储到“hist”变量中。</p><p id="f5b1" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">最后，我们使用Pandas包的“concat”函数将所有计算出的值合并到一个数据帧中，并返回最终的数据帧。使用创建的函数，我们存储了从Google的股票价格计算出的所有MACD成分，并将其存储到变量“googl_macd”中。从输出中，您可以看到我们的数据帧包含了我们之前讨论过的所有组件。</p><h2 id="72bd" class="lv jp hi bd jq mf mg mh ju mi mj mk jy kp ml mm ka kt mn mo kc kx mp mq ke mr bi translated">第四步:MACD情节</h2><p id="c81e" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">在这一步中，我们将绘制计算出的MACD分量，以便更好地理解它们。在继续之前，有必要知道领先指标是在股价下方单独绘制的。作为领先指标的MACD也需要以同样的方式绘制。</p><p id="2d7d" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated"><strong class="ki hj"> Python实现:</strong></p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ms mt l"/></div></figure><p id="cac5" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated"><strong class="ki hj">输出:</strong></p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mw"><img src="../Images/eb6fc1444944d4eefe7a1cf7c5d3a897.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J1W9acgTF_UBHHyn_BGgmQ.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">作者图片</figcaption></figure><p id="3165" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">我们不打算深入研究用于生成上述MACD图的代码，而是讨论该图。在这个图中有两个面板:顶部面板是谷歌收盘价的图，底部面板是计算的MACD成分的一系列图。让我们拆开来看看每一个部件。</p><p id="5923" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">底部面板中第一个也是最明显的部分显然是计算直方图值的图。你可以注意到，每当市场显示负趋势时，该图就会变红，每当市场显示正趋势时，该图就会变绿。直方图的这个特性在识别市场趋势时变得非常方便。每当MACD线和信号线之间的差异很大时，直方图就扩展得更大，并且值得注意的是，直方图有时收缩，表示两个其他分量之间的差异相对较小。</p><p id="27b5" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">接下来的两个组件是MACD线和信号线。MACD线是灰色的线图，显示了谷歌股价的慢速均线和快速均线之间的差异。同样，蓝色的线图是代表MACD线本身的均线的信号线。正如我们之前讨论的，信号线看起来更像是MACD线的平滑版本，因为它是通过平均MACD线本身的值计算出来的。这就是上面作为输出显示的图表。让我们进行下一步。</p><h2 id="5060" class="lv jp hi bd jq mf mg mh ju mi mj mk jy kp ml mm ka kt mn mo kc kx mp mq ke mr bi translated">步骤5:创建交易策略</h2><p id="19c7" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">在这一步中，我们将使用python实现讨论过的MACD交易策略。</p><p id="d67f" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated"><strong class="ki hj"> Python实现:</strong></p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ms mt l"/></div></figure><p id="35b0" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated"><strong class="ki hj">代码解释:</strong>首先，我们定义一个名为‘implement _ macd _ strategy’的函数，它将股票价格(‘data’)和MACD数据(‘data’)作为参数。</p><p id="88c4" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">在该函数中，我们创建了三个空列表(buy_price、sell_price和macd_signal ),在创建交易策略时，将在这些列表中追加值。</p><p id="653e" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">之后，我们通过for循环实施交易策略。在for循环内部，我们传递某些条件，如果条件得到满足，相应的值将被追加到空列表中。如果购买股票的条件得到满足，买入价将被追加到“buy_price”列表中，信号值将被追加为1，表示购买股票。类似地，如果卖出股票的条件得到满足，卖价将被追加到“sell_price”列表中，信号值将被追加为-1，表示卖出股票。</p><p id="5232" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">最后，我们返回附加了值的列表。然后，我们调用创建的函数并将值存储到各自的变量中。除非我们画出这些值，否则这个列表没有任何意义。所以，让我们画出创建的交易列表的值。</p><h2 id="dabe" class="lv jp hi bd jq mf mg mh ju mi mj mk jy kp ml mm ka kt mn mo kc kx mp mq ke mr bi translated">步骤6:绘制交易清单</h2><p id="b3ab" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">在这一步，我们将绘制已创建的交易列表，以使它们有意义。</p><p id="5f8e" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated"><strong class="ki hj"> Python实现:</strong></p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ms mt l"/></div></figure><p id="0dae" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated"><strong class="ki hj">输出:</strong></p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mw"><img src="../Images/2f87d2ed74169c1a15b695bf1e57e647.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rPwQl6BYzdgg0fuRWvtYjA.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">作者图片</figcaption></figure><p id="0a9a" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated"><strong class="ki hj">代码解释:</strong>我们正在绘制MACD成分以及交易策略产生的买入和卖出信号。我们可以观察到，每当MACD线穿过信号线时，买入信号用绿色绘制，同样，每当信号线穿过MACD线时，卖出信号用红色绘制。现在，使用交易信号，让我们建立我们的股票头寸。</p><h2 id="d46b" class="lv jp hi bd jq mf mg mh ju mi mj mk jy kp ml mm ka kt mn mo kc kx mp mq ke mr bi translated">步骤7:创建我们的职位</h2><p id="a249" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">在这一步中，我们将创建一个列表，如果我们持有股票，该列表将指示1；如果我们不拥有或持有股票，该列表将指示0。</p><p id="81fe" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated"><strong class="ki hj"> Python实现:</strong></p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ms mt l"/></div></figure><p id="420c" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated"><strong class="ki hj">输出:</strong></p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mx"><img src="../Images/134a5ffdb1dcc682bb279962d461d9ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6GKr-fjU2IxDiZrViwSwKA.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">作者图片</figcaption></figure><p id="2ca2" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated"><strong class="ki hj">代码解释:</strong>首先，我们创建一个名为‘position’的空列表。我们传递两个for循环，一个是为“位置”列表生成值，以匹配“信号”列表的长度。另一个for循环是我们用来生成实际位置值的循环。在第二个for循环中，我们对“signal”列表的值进行迭代，而“position”列表的值被附加到满足哪个条件上。如果我们持有股票，头寸的价值仍为1；如果我们卖出或不持有股票，头寸的价值仍为0。最后，我们正在进行一些数据操作，将所有创建的列表合并到一个数据帧中。</p><p id="4b8e" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">从显示的输出中，我们可以看到，在第一行中，我们在股票中的位置仍然是1(因为MACD信号没有任何变化)，但是当MACD交易信号代表卖出信号(-1)时，我们的位置突然变成了0。现在是时候实现一些回溯测试过程了！</p><h2 id="5411" class="lv jp hi bd jq mf mg mh ju mi mj mk jy kp ml mm ka kt mn mo kc kx mp mq ke mr bi translated">步骤8:回溯测试</h2><p id="6d77" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">在继续之前，有必要知道什么是回溯测试。回溯测试是查看我们的交易策略在给定股票数据上表现如何的过程。在我们的例子中，我们将针对Google股票数据为我们的MACD交易策略实现一个回溯测试过程。</p><p id="5d00" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated"><strong class="ki hj"> Python实现:</strong></p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ms mt l"/></div></figure><p id="5c0b" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated"><strong class="ki hj">输出:</strong></p><pre class="iy iz ja jb fd lq lr ls lt aw lu bi"><span id="1337" class="lv jp hi lr b fi lw lx l ly lz"><strong class="lr hj">Profit gained from the MACD strategy by investing $100k in GOOGL : 55549.26</strong><br/><strong class="lr hj">Profit percentage of the MACD strategy : 55%</strong></span></pre><p id="9b8a" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated"><strong class="ki hj">代码解释:</strong>首先，我们使用NumPy包提供的“diff”函数计算Google股票的回报，并将其作为dataframe存储到“googl_ret”变量中。接下来，我们将传递一个for循环来迭代“googl_ret”变量的值，以计算我们从MACD交易策略中获得的回报，这些回报值将被追加到“macd_strategy_ret”列表中。接下来，我们将“macd_strategy_ret”列表转换为数据帧，并将其存储到“macd_strategy_ret_df”变量中。</p><p id="b5d2" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">接下来是回溯测试过程。我们将通过投资10万美元到我们的交易策略中来回测我们的策略。首先，我们将投资金额存储到“投资值”变量中。之后，我们正在计算使用投资金额可以购买的谷歌股票数量。你可以注意到，我使用了Math软件包提供的“下限”函数，因为当投资金额除以谷歌股票的收盘价时，它会输出一个十进制数。股票数量应该是整数，而不是小数。使用“底数”函数，我们可以去掉小数。请记住,“floor”函数比“round”函数要复杂得多。然后，我们传递一个for循环来寻找投资回报，随后是一些数据操作任务。</p><p id="4124" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">最后，我们打印了我们通过投资10万到我们的交易策略中得到的总回报，并且显示我们在一年中获得了大约55，500美元的利润。那还不错！现在，让我们将我们的回报与SPY ETF(一种旨在跟踪标准普尔500股票市场指数的ETF)的回报进行比较。</p><h2 id="a7f8" class="lv jp hi bd jq mf mg mh ju mi mj mk jy kp ml mm ka kt mn mo kc kx mp mq ke mr bi translated">步骤9: SPY ETF对比</h2><p id="039a" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">这一步是可选的，但强烈推荐，因为我们可以了解我们的交易策略相对于基准(间谍ETF)的表现如何。在这一步，我们将使用我们创建的“get_historical_data”函数提取SPY ETF的数据，并将我们从SPY ETF获得的回报与我们在Google上的MACD策略回报进行比较。</p><p id="fa21" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated"><strong class="ki hj"> Python实现:</strong></p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ms mt l"/></div></figure><p id="fab0" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated"><strong class="ki hj">输出:</strong></p><pre class="iy iz ja jb fd lq lr ls lt aw lu bi"><span id="18b0" class="lv jp hi lr b fi lw lx l ly lz"><strong class="lr hj">Benchmark profit by investing $100k : 28376.01</strong><br/><strong class="lr hj">Benchmark Profit percentage : 28%</strong><br/><strong class="lr hj">MACD Strategy profit is 27% higher than the Benchmark Profit</strong></span></pre><p id="5113" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated"><strong class="ki hj">代码解释:</strong>这一步中使用的代码几乎与前一个回溯测试步骤中使用的代码相似，但我们不是投资谷歌，而是通过不实施任何交易策略来投资SPY ETF。从输出中，我们可以看到我们的MACD交易策略比SPY ETF高出27%。太好了！</p><h1 id="f28b" class="jo jp hi bd jq jr js jt ju jv jw jx jy io jz ip ka ir kb is kc iu kd iv ke kf bi translated">最后的想法！</h1><p id="95e0" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">MACD是目前最强有力的策略之一，当应用于现实市场时，它会非常有效。如果你决定在现实市场中使用MACD，有一件重要的事情要记住。MACD有泄露虚假交易信号的倾向。因此，除了MACD之外，强烈建议使用技术指标来交叉验证所显示的信号是否是真实的交易信号。我们还没有讨论使用多个指标来构建MACD策略，因为本文的唯一目的是理解什么是MACD以及如何使用python来实现它。</p><p id="e0a3" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">你也可以注意到，我们用来执行MACD交易策略的股票是随机选择的，这不是一个好方法。处理挑选股票的方法可以通过定量方法或基于ML算法的方法来完成。这可以显著改善我们的结果。就是这样！希望你能从这篇文章中学到一些有用的东西。如果您忘记了遵循一些编码部分，不要担心！我在文章末尾提供了完整的源代码。</p><h2 id="115b" class="lv jp hi bd jq mf mg mh ju mi mj mk jy kp ml mm ka kt mn mo kc kx mp mq ke mr bi translated">完整代码:</h2><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ms mt l"/></div></figure></div></div>    
</body>
</html>