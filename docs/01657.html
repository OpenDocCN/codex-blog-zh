<html>
<head>
<title>Algorithmic Trading with Aroon Indicator in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python中带Aroon指标的算法交易</h1>
<blockquote>原文：<a href="https://medium.com/codex/algorithmic-trading-with-the-aroon-indicator-in-python-3d2277d2f664?source=collection_archive---------1-----------------------#2021-05-19">https://medium.com/codex/algorithmic-trading-with-the-aroon-indicator-in-python-3d2277d2f664?source=collection_archive---------1-----------------------#2021-05-19</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="d7ac" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">学习用python中强大的指标来检测市场趋势并据此进行交易</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/ba92fcfa1e4b5439d339386bf825897f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XI5p6YJjGu8teQFGy5Povw.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated"><a class="ae jn" href="https://wallpapercave.com/stock-exchange-wallpapers" rel="noopener ugc nofollow" target="_blank">来源</a></figcaption></figure><p id="e3ba" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">有很多技术指标可以用于研究或交易目的，但它们有一个共同的相似之处，那就是它们都只服务于一个特定的任务。例如，RSI可用于识别市场中的超买和超卖水平，波动指数可用于观察市场波动，等等。但是，今天我们要探索一个指标，它既可以用来确认市场趋势，也可以用来确认市场波动。看，阿隆指示器！在本文中，我们将讨论Aroon指标是什么，它的用法和计算，以及如何使用python构建基于它的交易策略。事不宜迟，让我们直接进入正题。</p><p id="0fdd" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在继续之前，如果你想在没有任何代码的情况下回溯测试你的交易策略，有一个解决方案。这是<a class="ae jn" href="https://www.backtestzone.com/" rel="noopener ugc nofollow" target="_blank">回测区</a>。这是一个平台，可以免费对不同类型的可交易资产的任意数量的交易策略进行回溯测试，无需编码。点击这里的链接，你可以马上使用这个工具:【https://www.backtestzone.com/ T4】</p><h1 id="f3f5" class="kk kl hi bd km kn ko kp kq kr ks kt ku io kv ip kw ir kx is ky iu kz iv la lb bi translated">阿伦指示器</h1><p id="f8e8" class="pw-post-body-paragraph jo jp hi jq b jr lc ij jt ju ld im jw jx le jz ka kb lf kd ke kf lg kh ki kj hb bi translated">Aroon指标由Tushar Chande于1995年创立，是一种动量振荡器，专门用于跟踪市场的趋势以及趋势的强度。交易者广泛使用这个指标来识别市场的新趋势，并据此确定潜在的进场点和出场点。作为一个振荡器，Aroon指示器的值在0到100之间。</p><p id="b105" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">Aroon指标由两部分组成:Aroon上行线和Aroon下行线。阿隆上升线衡量市场上升趋势的强度，同样，阿隆下降线衡量市场下降趋势的强度。Aroon指标的传统设置是14(短期)或25(长期)作为回望期。在本文中，我们将使用25作为设置，因为我们将处理一年半的数据。以25为回望期计算这两条线的公式如下:</p><pre class="iy iz ja jb fd lh li lj lk aw ll bi"><span id="2e46" class="lm kl hi li b fi ln lo l lp lq">AROON UP = [ <strong class="li hj">25</strong> - <strong class="li hj">PERIODS SINCE 25 PERIOD HIGH</strong> ] / <strong class="li hj">25</strong> * [ <strong class="li hj">100</strong> ]<br/>AROON DOWN = [ <strong class="li hj">25</strong> - <strong class="li hj">PERIODS SINCE 25 PERIOD LOW </strong>] / <strong class="li hj">25</strong> * [ <strong class="li hj">100</strong> ]</span></pre><p id="e858" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">Aroon上涨线的计算方法是，首先确定股票在25天的时间框架内达到新高的时间，然后将该值减去并除以25，最后乘以100。这也适用于计算Aroon下行线，但这里我们确定的是自出现新低以来的天数，而不是观察到的新高。</p><p id="45b0" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">Aroon指标的主要概念是，在强劲的上升趋势中，市场往往会达到更多的新高，同样，在强劲的下降趋势中，市场也必然会达到更多的新低。也就是说，让我们来探讨如何使用Aroon指标来建立交易策略。</p><p id="c4d6" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">据我所知，Aroon指标可以通过两种方式建立交易策略。首先是交叉交易策略。如果上涨线从下方穿越到下跌线上方，这个策略显示出买入信号，同样，如果上涨线从上方移动到下跌线下方，显示出卖出信号。交叉策略可以表示如下:</p><pre class="iy iz ja jb fd lh li lj lk aw ll bi"><span id="00f5" class="lm kl hi li b fi ln lo l lp lq">IF <strong class="li hj">P.UP LINE</strong> &lt; <strong class="li hj">P.DOWN LINE </strong>AND <strong class="li hj">C.UP LINE</strong> &gt; <strong class="li hj">C.DOWN LINE</strong> --&gt; <strong class="li hj">BUY</strong><br/>IF <strong class="li hj">P.UP LINE</strong> &gt; <strong class="li hj">P.DOWN LINE </strong>AND <strong class="li hj">C.UP LINE</strong> &lt; <strong class="li hj">C.DOWN LINE</strong> --&gt; <strong class="li hj">SELL</strong></span></pre><p id="3ae0" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">第二个策略是构建一个较高和较低的阈值，如果Aroon上行线的读数大于等于70，Aroon下行线的读数小于等于30，则代表买入信号。同样，当Aroon上升线的读数等于或低于30，而Aroon下降线的读数等于或高于70时，就显示出卖出信号。该策略可以表示如下:</p><pre class="iy iz ja jb fd lh li lj lk aw ll bi"><span id="430b" class="lm kl hi li b fi ln lo l lp lq">IF <strong class="li hj">AROON UP LINE =&gt; 70</strong> AND <strong class="li hj">AROON DOWN LINE &lt;= 30</strong> --&gt; <strong class="li hj">BUY SIGNAL<br/></strong>IF <strong class="li hj">AROON UP LINE &lt;= 30</strong> AND <strong class="li hj">AROON DOWN LINE &gt;= 70</strong> --&gt; <strong class="li hj">SELL SIGNAL</strong></span></pre><p id="278f" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这两种交易策略都非常有效，可以用来交易任何股票。在这篇文章中，我们将实施第二个交易策略，构建阈值，只是为了使事情变得简单。现在，我们对Aroon指标及其计算和使用有了一个概念。让我们进入编程部分，我们将在python中从头开始构建第二个Aroon指标策略，并在Tesla上对其进行回测。在继续之前，关于免责声明的一个注意事项:本文的唯一目的是教育人们，必须被视为一个信息，而不是投资建议等。</p><h1 id="9df5" class="kk kl hi bd km kn ko kp kq kr ks kt ku io kv ip kw ir kx is ky iu kz iv la lb bi translated">用Python实现</h1><p id="afd4" class="pw-post-body-paragraph jo jp hi jq b jr lc ij jt ju ld im jw jx le jz ka kb lf kd ke kf lg kh ki kj hb bi translated">编码部分分为以下几个步骤:</p><pre class="iy iz ja jb fd lh li lj lk aw ll bi"><span id="3081" class="lm kl hi li b fi ln lo l lp lq"><strong class="li hj">1. Importing Packages<br/>2. Extracting Stock Data from Twelve Data<br/>3. Extracting the Aroon Indicator values<br/>4. Aroon Indicator Plot<br/>5. Creating the Trading Strategy<br/>6. Plotting the Trading Lists<br/>7. Creating our Position<br/>8. Backtesting<br/>9. SPY ETF Comparison</strong></span></pre><p id="f6ca" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我们将按照上面列表中提到的顺序，系好安全带，跟随每一个即将到来的编码部分。</p><h2 id="7c0d" class="lm kl hi bd km lr ls lt kq lu lv lw ku jx lx ly kw kb lz ma ky kf mb mc la md bi translated">步骤1:导入包</h2><p id="9811" class="pw-post-body-paragraph jo jp hi jq b jr lc ij jt ju ld im jw jx le jz ka kb lf kd ke kf lg kh ki kj hb bi translated">将所需的包导入python环境是一个不可跳过的步骤。主要的包是处理数据的Pandas，处理数组和复杂函数的NumPy，用于绘图的Matplotlib，以及进行API调用的请求。二级包是数学函数的Math和字体定制的Termcolor(可选)。</p><p id="6f4b" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj"> Python实现:</strong></p><pre class="iy iz ja jb fd lh li lj lk aw ll bi"><span id="fdc6" class="lm kl hi li b fi ln lo l lp lq">import pandas as pd<br/>import numpy as np<br/>import requests<br/>import matplotlib.pyplot as plt<br/>from math import floor<br/>from termcolor import colored as cl<br/><br/>plt.style.use('fivethirtyeight')<br/>plt.rcParams['figure.figsize'] = (20, 10)</span></pre><p id="07be" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">现在我们已经将所有需要的包导入到python中。我们用十二数据的API端点来拉特斯拉的历史数据。</p><h2 id="0315" class="lm kl hi bd km lr ls lt kq lu lv lw ku jx lx ly kw kb lz ma ky kf mb mc la md bi translated">步骤2:从12个数据中提取数据</h2><p id="cf12" class="pw-post-body-paragraph jo jp hi jq b jr lc ij jt ju ld im jw jx le jz ka kb lf kd ke kf lg kh ki kj hb bi translated">在这一步，我们将使用由<a class="ae jn" href="https://twelvedata.com/" rel="noopener ugc nofollow" target="_blank">twelvedata.com</a>提供的API端点提取特斯拉的历史股票数据。在此之前，请注意twelvedata.com<a class="ae jn" href="https://twelvedata.com/" rel="noopener ugc nofollow" target="_blank"/>:十二数据公司是领先的市场数据提供商之一，拥有大量各种市场数据的API端点。它非常容易与十二数据提供的API进行交互，并且拥有有史以来最好的文档。此外，确保你有一个twelvedata.com<a class="ae jn" href="https://twelvedata.com/" rel="noopener ugc nofollow" target="_blank">的账户，只有这样，你才能访问你的API密匙(用API提取数据的重要元素)。</a></p><p id="8df9" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj"> Python实现:</strong></p><pre class="iy iz ja jb fd lh li lj lk aw ll bi"><span id="3ede" class="lm kl hi li b fi ln lo l lp lq">def get_historical_data(symbol, start_date):<br/>    api_key = 'YOUR API KEY'<br/>    api_url = f'https://api.twelvedata.com/time_series?symbol={symbol}&amp;interval=1day&amp;outputsize=5000&amp;apikey={api_key}'<br/>    raw_df = requests.get(api_url).json()<br/>    df = pd.DataFrame(raw_df['values']).iloc[::-1].set_index('datetime').astype(float)<br/>    df = df[df.index &gt;= start_date]<br/>    df.index = pd.to_datetime(df.index)<br/>    return df<br/><br/>tsla = get_historical_data('TSLA', '2020-01-01')<br/>tsla</span></pre><p id="047b" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">输出:</strong></p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es me"><img src="../Images/f1136075707a61e5e44114ae57acfa93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*slSKoqqJRTRnm-AnWJhZGg.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">作者图片</figcaption></figure><p id="2e97" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">代码解释:</strong>我们做的第一件事是定义一个名为‘get _ historical _ data’的函数，该函数将股票的符号(‘symbol’)和历史数据的起始日期(‘start _ date’)作为参数。在函数内部，我们定义了API键和URL，并将它们存储到各自的变量中。接下来，我们使用“get”函数提取JSON格式的历史数据，并将其存储到“raw_df”变量中。在对原始JSON数据进行清理和格式化之后，我们将以干净的Pandas数据帧的形式返回它。最后，我们调用创建的函数来提取特斯拉从2020年开始的历史数据，并将其存储到“tsla”变量中。</p><h2 id="b502" class="lm kl hi bd km lr ls lt kq lu lv lw ku jx lx ly kw kb lz ma ky kf mb mc la md bi translated">步骤3:提取Aroon指标值</h2><p id="07b1" class="pw-post-body-paragraph jo jp hi jq b jr lc ij jt ju ld im jw jx le jz ka kb lf kd ke kf lg kh ki kj hb bi translated">在这一步中，我们将借助于十二数据提供的API端点来提取特斯拉的Aroon指标值。这一步和我们上一步做的差不多。</p><p id="ba9e" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj"> Python实现:</strong></p><pre class="iy iz ja jb fd lh li lj lk aw ll bi"><span id="3637" class="lm kl hi li b fi ln lo l lp lq">def get_aroon(symbol, lookback, start_date):<br/>    api_key = 'YOUR API KEY'<br/>    api_url = f'https://api.twelvedata.com/aroon?symbol={symbol}&amp;interval=1day&amp;time_period={lookback}&amp;outputsize=5000&amp;apikey={api_key}'<br/>    raw_df = requests.get(api_url).json()<br/>    df = pd.DataFrame(raw_df['values']).iloc[::-1].set_index('datetime').astype(float)<br/>    df = df[df.index &gt;= start_date]<br/>    df.index = pd.to_datetime(df.index)<br/>    aroon_up = df['aroon_up']<br/>    aroon_down = df['aroon_down']<br/>    return aroon_up, aroon_down<br/><br/>tsla['aroon_up'], tsla['aroon_down'] = get_aroon('TSLA', 25, '2020-01-01')<br/>tsla.tail()</span></pre><p id="912c" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">输出:</strong></p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mf"><img src="../Images/abfd66b301da5bc25676a7cfd82e5847.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j_veKzXUcV_TMMIKTfFVTw.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">作者图片</figcaption></figure><p id="2c45" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">代码解释:</strong>首先，我们定义一个名为‘get _ aroon’的函数，它将股票的符号(‘symbol’)、指标的回看周期(‘look back’)和数据的开始日期(‘start _ date’)作为参数。在函数内部，我们首先分配两个名为“api_key”和“url”的变量，分别存储api键和API URL。使用Requests包提供的“get”函数，我们调用API并将响应存储到“raw”变量中。在做了一些数据操作后，我们返回Aroon上线和下线值。最后，我们调用函数来提取Tesla的Aroon指标值。</p><h2 id="52a2" class="lm kl hi bd km lr ls lt kq lu lv lw ku jx lx ly kw kb lz ma ky kf mb mc la md bi translated">步骤4: Aroon指示图</h2><p id="9ae7" class="pw-post-body-paragraph jo jp hi jq b jr lc ij jt ju ld im jw jx le jz ka kb lf kd ke kf lg kh ki kj hb bi translated">在这一步，我们将绘制提取的特斯拉Aroon指标值，以使其更有意义。这一部分的主要目的不是在编码部分，而是观察图，以获得对Aroon指标的牢固理解。</p><p id="567c" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj"> Python实现:</strong></p><pre class="iy iz ja jb fd lh li lj lk aw ll bi"><span id="7bf2" class="lm kl hi li b fi ln lo l lp lq">ax1 = plt.subplot2grid((11,1), (0,0), rowspan = 5, colspan = 1)<br/>ax2 = plt.subplot2grid((11,1), (6,0), rowspan = 4, colspan = 1)<br/>ax1.plot(tsla['close'], linewidth = 2.5, color = '#2196f3')<br/>ax1.set_title('TSLA CLOSE PRICES')<br/>ax2.plot(tsla['aroon_up'], color = '#26a69a', linewidth = 2, label = 'AROON UP')<br/>ax2.plot(tsla['aroon_down'], color = '#ef5350', linewidth = 2, label = 'AROON DOWN')<br/>ax2.legend()<br/>ax2.set_title('TSLA AROON 25')<br/>plt.show()</span></pre><p id="0eb5" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">输出:</strong></p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mg"><img src="../Images/6dd722a6570c4ba63c81457a9753f956.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uJWXJjIemiZbE23PxuAgOQ.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">作者图片</figcaption></figure><p id="e13a" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">上面的图表分为两个面板:上面的面板包括特斯拉的收盘价，下面的面板包括Aroon上涨线和下跌线。我提到过Aroon指标不仅有助于识别趋势，也有助于识别区间市场。为了识别波动的市场周期，我们必须仔细观察上涨线和下跌线。每当两条线之间的空间越来越小，那么市场就被认为是在波动。类似地，当两条线之间的空间变宽时，趋势市场被观察到。</p><p id="1bcd" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">你也可以看到，每当市场似乎在一个强劲的上升趋势中上升，Aroon上升线的读数也上升，平行地，Aroon下降线的读数下降。同样地，在一个强烈下跌的时期，Aroon下行线的读数会越过Aroon上行线。由此，我们可以说两条直线成反比。</p><p id="7cc6" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">有时，可以观察到Aroon上行线在100停留一段时间。这代表市场处于一个非常强劲的上升趋势，创造新高。这也适用于Aroon下行线。当Aroon下行线停留在100点一段时间时，市场被认为是高度看跌的，创造了新低。Aroon指标识别非常强劲的上涨趋势和下跌趋势的这一特性对现实市场中的交易者来说很方便。</p><h2 id="9f96" class="lm kl hi bd km lr ls lt kq lu lv lw ku jx lx ly kw kb lz ma ky kf mb mc la md bi translated">步骤5:创建交易策略</h2><p id="1453" class="pw-post-body-paragraph jo jp hi jq b jr lc ij jt ju ld im jw jx le jz ka kb lf kd ke kf lg kh ki kj hb bi translated">这一步，我们要用python实现讨论过的Aroon指标交易策略。</p><p id="eee3" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj"> Python实现:</strong></p><pre class="iy iz ja jb fd lh li lj lk aw ll bi"><span id="aada" class="lm kl hi li b fi ln lo l lp lq">def implement_aroon_strategy(prices, up, down):<br/>    buy_price = []<br/>    sell_price = []<br/>    aroon_signal = []<br/>    signal = 0<br/>    <br/>    for i in range(len(prices)):<br/>        if up[i] &gt;= 70 and down[i] &lt;= 30:<br/>            if signal != 1:<br/>                buy_price.append(prices[i])<br/>                sell_price.append(np.nan)<br/>                signal = 1<br/>                aroon_signal.append(signal)<br/>            else:<br/>                buy_price.append(np.nan)<br/>                sell_price.append(np.nan)<br/>                aroon_signal.append(0)<br/>        elif up[i] &lt;= 30 and down[i] &gt;= 70:<br/>            if signal != -1:<br/>                buy_price.append(np.nan)<br/>                sell_price.append(prices[i])<br/>                signal = -1<br/>                aroon_signal.append(signal)<br/>            else:<br/>                buy_price.append(np.nan)<br/>                sell_price.append(np.nan)<br/>                aroon_signal.append(0)<br/>        else:<br/>            buy_price.append(np.nan)<br/>            sell_price.append(np.nan)<br/>            aroon_signal.append(0)<br/>            <br/>    return buy_price, sell_price, aroon_signal<br/><br/>buy_price, sell_price, aroon_signal = implement_aroon_strategy(tsla['close'], tsla['aroon_up'], tsla['aroon_down'])</span></pre><p id="cdc2" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">代码解释:</strong>首先，我们定义一个名为‘implement _ aroon _ strategy’的函数，它将股票价格(‘price’)和Aroon指标线(‘up’，‘down’)作为参数。</p><p id="e876" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在这个函数中，我们创建了三个空列表(buy_price、sell_price和aroon_signal ),在创建交易策略时，这些值将被追加到这些列表中。</p><p id="7f12" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">之后，我们通过for循环实施交易策略。在for循环内部，我们传递某些条件，如果条件得到满足，相应的值将被追加到空列表中。如果购买股票的条件得到满足，买入价将被追加到“buy_price”列表中，信号值将被追加为1，表示购买股票。类似地，如果卖出股票的条件得到满足，卖价将被追加到“sell_price”列表中，信号值将被追加为-1，表示卖出股票。</p><p id="6870" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">最后，我们返回附加了值的列表。然后，我们调用创建的函数并将值存储到各自的变量中。除非我们画出这些值，否则这个列表没有任何意义。所以，让我们画出创建的交易列表的值。</p><h2 id="7d12" class="lm kl hi bd km lr ls lt kq lu lv lw ku jx lx ly kw kb lz ma ky kf mb mc la md bi translated">步骤6:绘制交易信号</h2><p id="b58d" class="pw-post-body-paragraph jo jp hi jq b jr lc ij jt ju ld im jw jx le jz ka kb lf kd ke kf lg kh ki kj hb bi translated">在这一步，我们将绘制已创建的交易列表，以使它们有意义。</p><p id="69c3" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj"> Python实现:</strong></p><pre class="iy iz ja jb fd lh li lj lk aw ll bi"><span id="38ff" class="lm kl hi li b fi ln lo l lp lq">ax1 = plt.subplot2grid((11,1), (0,0), rowspan = 5, colspan = 1)<br/>ax2 = plt.subplot2grid((11,1), (6,0), rowspan = 4, colspan = 1)<br/>ax1.plot(tsla['close'], linewidth = 2.5, color = '#2196f3')<br/>ax1.plot(tsla.index, buy_price, marker = '^', color = '#26a69a', markersize = 12)<br/>ax1.plot(tsla.index, sell_price, marker = 'v', color = '#ef5350', markersize = 12)<br/>ax1.set_title('TSLA CLOSE PRICES')<br/>ax2.plot(tsla['aroon_up'], color = '#26a69a', linewidth = 2, label = 'AROON UP')<br/>ax2.plot(tsla['aroon_down'], color = '#ef5350', linewidth = 2, label = 'AROON DOWN')<br/>ax2.legend()<br/>ax2.set_title('TSLA AROON 25')<br/>plt.show()</span></pre><p id="97d2" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">输出:</strong></p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mg"><img src="../Images/307287b1f068566c84b0b1748ab16a02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kN9c-LG8FGEeL8qpmimqsA.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">作者图片</figcaption></figure><p id="5ca6" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">代码解释:</strong>我们正在绘制Aroon指标成分以及交易策略产生的买入和卖出信号。我们可以观察到，每当Aroon上行线的读数大于等于70，Aroon下行线的读数小于等于30时，图表中就会出现绿色的买入信号。类似地，当Aroon上升线的读数低于30，Aroon下降线的读数高于70时，图表中就会出现红色的卖出信号。</p><h2 id="8e97" class="lm kl hi bd km lr ls lt kq lu lv lw ku jx lx ly kw kb lz ma ky kf mb mc la md bi translated">步骤7:创建我们的职位</h2><p id="5ac9" class="pw-post-body-paragraph jo jp hi jq b jr lc ij jt ju ld im jw jx le jz ka kb lf kd ke kf lg kh ki kj hb bi translated">在这一步中，我们将创建一个列表，如果我们持有股票，该列表将指示1；如果我们不拥有或持有股票，该列表将指示0。</p><p id="3d06" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj"> Python实现:</strong></p><pre class="iy iz ja jb fd lh li lj lk aw ll bi"><span id="ea58" class="lm kl hi li b fi ln lo l lp lq">position = []<br/>for i in range(len(aroon_signal)):<br/>    if aroon_signal[i] &gt; 1:<br/>        position.append(0)<br/>    else:<br/>        position.append(1)<br/>        <br/>for i in range(len(tsla['close'])):<br/>    if aroon_signal[i] == 1:<br/>        position[i] = 1<br/>    elif aroon_signal[i] == -1:<br/>        position[i] = 0<br/>    else:<br/>        position[i] = position[i-1]<br/>        <br/>aroon_up = tsla['aroon_up']<br/>aroon_down = tsla['aroon_down']<br/>close_price = tsla['close']<br/>aroon_signal = pd.DataFrame(aroon_signal).rename(columns = {0:'aroon_signal'}).set_index(tsla.index)<br/>position = pd.DataFrame(position).rename(columns = {0:'aroon_position'}).set_index(tsla.index)<br/><br/>frames = [close_price, aroon_up, aroon_down, aroon_signal, position]<br/>strategy = pd.concat(frames, join = 'inner', axis = 1)<br/><br/>strategy</span></pre><p id="dd9e" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">输出:</strong></p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mh"><img src="../Images/fed79e27fabd45870a701f96c0ef6eff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U2nRrTH3daFlxc8QKPJQOQ.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">作者图片</figcaption></figure><p id="eed9" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">代码解释:</strong>首先，我们创建一个名为‘position’的空列表。我们传递两个for循环，一个是为“位置”列表生成值，以匹配“信号”列表的长度。另一个for循环是我们用来生成实际位置值的循环。在第二个for循环中，我们对“signal”列表的值进行迭代，而“position”列表的值被附加到满足哪个条件上。如果我们持有股票，头寸的价值仍为1；如果我们卖出或不持有股票，头寸的价值仍为0。最后，我们正在进行一些数据操作，将所有创建的列表合并到一个数据帧中。</p><p id="902b" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">从显示的输出中，我们可以看到，在第一行中，我们在股票中的头寸仍然是1(因为Aroon指标信号没有任何变化)，但当Aroon指标交易信号代表卖出信号(-1)时，我们的头寸突然变为-1。我们的头寸将保持为0，直到交易信号发生一些变化。现在是时候实现一些回溯测试过程了！</p><h2 id="5791" class="lm kl hi bd km lr ls lt kq lu lv lw ku jx lx ly kw kb lz ma ky kf mb mc la md bi translated">步骤8:回溯测试</h2><p id="07e3" class="pw-post-body-paragraph jo jp hi jq b jr lc ij jt ju ld im jw jx le jz ka kb lf kd ke kf lg kh ki kj hb bi translated">在继续之前，有必要知道什么是回溯测试。回溯测试是查看我们的交易策略在给定股票数据上表现如何的过程。在我们的案例中，我们将对特斯拉股票数据的Aroon指标交易策略实施回溯测试流程。</p><p id="2931" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj"> Python实现:</strong></p><pre class="iy iz ja jb fd lh li lj lk aw ll bi"><span id="5f27" class="lm kl hi li b fi ln lo l lp lq">tsla_ret = pd.DataFrame(np.diff(tsla['close'])).rename(columns = {0:'returns'})<br/>aroon_strategy_ret = []<br/><br/>for i in range(len(tsla_ret)):<br/>    returns = tsla_ret['returns'][i]*strategy['aroon_position'][i]<br/>    aroon_strategy_ret.append(returns)<br/>    <br/>aroon_strategy_ret_df = pd.DataFrame(aroon_strategy_ret).rename(columns = {0:'aroon_returns'})<br/>investment_value = 100000<br/>number_of_stocks = floor(investment_value/tsla['close'][-1])<br/>aroon_investment_ret = []<br/><br/>for i in range(len(aroon_strategy_ret_df['aroon_returns'])):<br/>    returns = number_of_stocks*aroon_strategy_ret_df['aroon_returns'][i]<br/>    aroon_investment_ret.append(returns)<br/><br/>aroon_investment_ret_df = pd.DataFrame(aroon_investment_ret).rename(columns = {0:'investment_returns'})<br/>total_investment_ret = round(sum(aroon_investment_ret_df['investment_returns']), 2)<br/>profit_percentage = floor((total_investment_ret/investment_value)*100)<br/>print(cl('Profit gained from the Aroon strategy by investing $100k in TSLA : {}'.format(total_investment_ret), attrs = ['bold']))<br/>print(cl('Profit percentage of the Aroon strategy : {}%'.format(profit_percentage), attrs = ['bold']))</span></pre><p id="2799" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">输出:</strong></p><pre class="iy iz ja jb fd lh li lj lk aw ll bi"><span id="4550" class="lm kl hi li b fi ln lo l lp lq"><strong class="li hj">Profit gained from the Aroon strategy by investing $100k in TSLA : 55354.46</strong><br/><strong class="li hj">Profit percentage of the Aroon strategy : 55%</strong></span></pre><p id="2c50" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">代码解释:</strong>首先，我们使用NumPy包提供的“diff”函数计算Tesla股票的回报，并将其作为dataframe存储到“tsla_ret”变量中。接下来，我们将传递一个for循环来迭代' tsla_ret '变量的值，以计算我们从Aroon指标交易策略中获得的回报，并将这些回报值追加到' aroon_strategy_ret '列表中。接下来，我们将“aroon_strategy_ret”列表转换为数据帧，并将其存储到“aroon_strategy_ret_df”变量中。</p><p id="8df1" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">接下来是回溯测试过程。我们将通过投资10万美元到我们的交易策略中来回测我们的策略。首先，我们将投资金额存储到“投资值”变量中。之后，我们正在计算使用投资金额可以购买的特斯拉股票数量。你可以注意到，我使用了Math package提供的“floor”函数，因为当投资金额除以特斯拉股票的收盘价时，它会输出一个十进制数。股票数量应该是整数，而不是小数。使用“底数”函数，我们可以去掉小数。请记住,“floor”函数比“round”函数要复杂得多。然后，我们传递一个for循环来寻找投资回报，随后是一些数据操作任务。</p><p id="c34c" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">最后，我们打印了我们通过投资10万到我们的交易策略中得到的总回报，并且显示我们在一年中获得了大约55，000美元的利润。那还不错！现在，让我们将我们的回报与SPY ETF(一种旨在跟踪标准普尔500股票市场指数的ETF)的回报进行比较。</p><h2 id="d2ee" class="lm kl hi bd km lr ls lt kq lu lv lw ku jx lx ly kw kb lz ma ky kf mb mc la md bi translated">步骤9: SPY ETF对比</h2><p id="36d9" class="pw-post-body-paragraph jo jp hi jq b jr lc ij jt ju ld im jw jx le jz ka kb lf kd ke kf lg kh ki kj hb bi translated">这一步是可选的，但强烈推荐，因为我们可以了解我们的交易策略相对于基准(间谍ETF)的表现如何。在这一步，我们将使用我们创建的“get_historical_data”函数提取SPY ETF的数据，并将我们从SPY ETF获得的回报与我们在Tesla上的Aroon指标策略回报进行比较。</p><p id="68ea" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj"> Python实现:</strong></p><pre class="iy iz ja jb fd lh li lj lk aw ll bi"><span id="4d39" class="lm kl hi li b fi ln lo l lp lq">def get_benchmark(start_date, investment_value):<br/>    spy = get_historical_data('SPY', start_date)['close']<br/>    benchmark = pd.DataFrame(np.diff(spy)).rename(columns = {0:'benchmark_returns'})<br/>    <br/>    investment_value = investment_value<br/>    number_of_stocks = floor(investment_value/spy[-1])<br/>    benchmark_investment_ret = []<br/>    <br/>    for i in range(len(benchmark['benchmark_returns'])):<br/>        returns = number_of_stocks*benchmark['benchmark_returns'][i]<br/>        benchmark_investment_ret.append(returns)<br/><br/>    benchmark_investment_ret_df = pd.DataFrame(benchmark_investment_ret).rename(columns = {0:'investment_returns'})<br/>    return benchmark_investment_ret_df<br/><br/>benchmark = get_benchmark('2020-01-01', 100000)<br/><br/>investment_value = 100000<br/>total_benchmark_investment_ret = round(sum(benchmark['investment_returns']), 2)<br/>benchmark_profit_percentage = floor((total_benchmark_investment_ret/investment_value)*100)<br/>print(cl('Benchmark profit by investing $100k : {}'.format(total_benchmark_investment_ret), attrs = ['bold']))<br/>print(cl('Benchmark Profit percentage : {}%'.format(benchmark_profit_percentage), attrs = ['bold']))<br/>print(cl('Aroon Strategy profit is {}% higher than the Benchmark Profit'.format(profit_percentage - benchmark_profit_percentage), attrs = ['bold']))</span></pre><p id="bbfe" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">输出:</strong></p><pre class="iy iz ja jb fd lh li lj lk aw ll bi"><span id="ca15" class="lm kl hi li b fi ln lo l lp lq"><strong class="li hj">Benchmark profit by investing $100k : 21090.3</strong><br/><strong class="li hj">Benchmark Profit percentage : 21%</strong><br/><strong class="li hj">Aroon Strategy profit is 34% higher than the Benchmark Profit</strong></span></pre><p id="d26d" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">代码解释:</strong>此步骤中使用的代码几乎与前一回测步骤中使用的代码相似，但我们不是投资特斯拉，而是通过不实施任何交易策略来投资SPY ETF。从输出可以看出，我们的Aroon指标交易策略已经跑赢了SPY ETF 34%。太好了！</p><h1 id="a037" class="kk kl hi bd km kn ko kp kq kr ks kt ku io kv ip kw ir kx is ky iu kz iv la lb bi translated">最后的想法！</h1><p id="d08f" class="pw-post-body-paragraph jo jp hi jq b jr lc ij jt ju ld im jw jx le jz ka kb lf kd ke kf lg kh ki kj hb bi translated">经过一个漫长的过程，理论和编码部分都粉碎了，我们已经成功地了解了Aroon指标是什么，以及如何建立一个基于它的交易策略。Aroon指标一直是我个人的最爱，因为它有助于同时完成两项工作(识别趋势、波动)，而且它也是独一无二的。尽管我们已经超越了SPY ETF的回报，但仍有改进的空间:</p><ul class=""><li id="cf1f" class="mi mj hi jq b jr js ju jv jx mk kb ml kf mm kj mn mo mp mq bi translated"><strong class="jq hj">策略优化:</strong>在本文中，我们使用了一种基于Aroon指标的最基本的交易策略，这种策略仅可用于理解或获得关于该指标的直觉，但不可能在现实市场中预期可见的回报。所以，我强烈推荐你去发现其他先进的基于Aroon的交易策略，比如突破策略，拉回策略，等等。除了发现之外，用尽可能多的股票对策略进行回溯测试，因为结果可能会因人而异。</li><li id="bc4e" class="mi mj hi jq b jr mr ju ms jx mt kb mu kf mv kj mn mo mp mq bi translated"><strong class="jq hj">风险管理:</strong>无论是交易还是长期投资，这个话题都是必须要考虑的。只要你紧紧抓住这个概念，你就在市场上拥有强大的优势。我们没有涉及这个话题，因为这篇文章的唯一目的只是理解和集思广益Aroon指标的基本思想，而不是为了盈利。但是，在进入疯狂的现实世界市场之前，强烈建议对这个主题进行深入研究。</li></ul><p id="1230" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">说到这里，我们已经到了文章的结尾。希望你能从这篇文章中学到一些有用的东西。此外，如果您忘记了遵循任何编码部分，不要担心。我在文章末尾提供了完整的源代码。</p><h2 id="3506" class="lm kl hi bd km lr ls lt kq lu lv lw ku jx lx ly kw kb lz ma ky kf mb mc la md bi translated">完整代码:</h2><pre class="iy iz ja jb fd lh li lj lk aw ll bi"><span id="5bcc" class="lm kl hi li b fi ln lo l lp lq">import pandas as pd<br/>import numpy as np<br/>import requests<br/>import matplotlib.pyplot as plt<br/>from math import floor<br/>from termcolor import colored as cl<br/><br/>plt.style.use('fivethirtyeight')<br/>plt.rcParams['figure.figsize'] = (20, 10)<br/><br/>def get_historical_data(symbol, start_date):<br/>    api_key = 'YOUR API KEY'<br/>    api_url = f'https://api.twelvedata.com/time_series?symbol={symbol}&amp;interval=1day&amp;outputsize=5000&amp;apikey={api_key}'<br/>    raw_df = requests.get(api_url).json()<br/>    df = pd.DataFrame(raw_df['values']).iloc[::-1].set_index('datetime').astype(float)<br/>    df = df[df.index &gt;= start_date]<br/>    df.index = pd.to_datetime(df.index)<br/>    return df<br/><br/>tsla = get_historical_data('TSLA', '2020-01-01')<br/>print(tsla)<br/><br/>def get_aroon(symbol, lookback, start_date):<br/>    api_key = 'YOUR API KEY'<br/>    api_url = f'https://api.twelvedata.com/aroon?symbol={symbol}&amp;interval=1day&amp;time_period={lookback}&amp;outputsize=5000&amp;apikey={api_key}'<br/>    raw_df = requests.get(api_url).json()<br/>    df = pd.DataFrame(raw_df['values']).iloc[::-1].set_index('datetime').astype(float)<br/>    df = df[df.index &gt;= start_date]<br/>    df.index = pd.to_datetime(df.index)<br/>    aroon_up = df['aroon_up']<br/>    aroon_down = df['aroon_down']<br/>    return aroon_up, aroon_down<br/><br/>tsla['aroon_up'], tsla['aroon_down'] = get_aroon('TSLA', 25, '2020-01-01')<br/>print(tsla.tail())<br/><br/>ax1 = plt.subplot2grid((11,1), (0,0), rowspan = 5, colspan = 1)<br/>ax2 = plt.subplot2grid((11,1), (6,0), rowspan = 4, colspan = 1)<br/>ax1.plot(tsla['close'], linewidth = 2.5, color = '#2196f3')<br/>ax1.set_title('TSLA CLOSE PRICES')<br/>ax2.plot(tsla['aroon_up'], color = '#26a69a', linewidth = 2, label = 'AROON UP')<br/>ax2.plot(tsla['aroon_down'], color = '#ef5350', linewidth = 2, label = 'AROON DOWN')<br/>ax2.legend()<br/>ax2.set_title('TSLA AROON 25')<br/>plt.show()<br/><br/>def implement_aroon_strategy(prices, up, down):<br/>    buy_price = []<br/>    sell_price = []<br/>    aroon_signal = []<br/>    signal = 0<br/>    <br/>    for i in range(len(prices)):<br/>        if up[i] &gt;= 70 and down[i] &lt;= 30:<br/>            if signal != 1:<br/>                buy_price.append(prices[i])<br/>                sell_price.append(np.nan)<br/>                signal = 1<br/>                aroon_signal.append(signal)<br/>            else:<br/>                buy_price.append(np.nan)<br/>                sell_price.append(np.nan)<br/>                aroon_signal.append(0)<br/>        elif up[i] &lt;= 30 and down[i] &gt;= 70:<br/>            if signal != -1:<br/>                buy_price.append(np.nan)<br/>                sell_price.append(prices[i])<br/>                signal = -1<br/>                aroon_signal.append(signal)<br/>            else:<br/>                buy_price.append(np.nan)<br/>                sell_price.append(np.nan)<br/>                aroon_signal.append(0)<br/>        else:<br/>            buy_price.append(np.nan)<br/>            sell_price.append(np.nan)<br/>            aroon_signal.append(0)<br/>            <br/>    return buy_price, sell_price, aroon_signal<br/><br/>buy_price, sell_price, aroon_signal = implement_aroon_strategy(tsla['close'], tsla['aroon_up'], tsla['aroon_down'])<br/><br/>ax1 = plt.subplot2grid((11,1), (0,0), rowspan = 5, colspan = 1)<br/>ax2 = plt.subplot2grid((11,1), (6,0), rowspan = 4, colspan = 1)<br/>ax1.plot(tsla['close'], linewidth = 2.5, color = '#2196f3')<br/>ax1.plot(tsla.index, buy_price, marker = '^', color = '#26a69a', markersize = 12)<br/>ax1.plot(tsla.index, sell_price, marker = 'v', color = '#ef5350', markersize = 12)<br/>ax1.set_title('TSLA CLOSE PRICES')<br/>ax2.plot(tsla['aroon_up'], color = '#26a69a', linewidth = 2, label = 'AROON UP')<br/>ax2.plot(tsla['aroon_down'], color = '#ef5350', linewidth = 2, label = 'AROON DOWN')<br/>ax2.legend()<br/>ax2.set_title('TSLA AROON 25')<br/>plt.show()<br/><br/>position = []<br/>for i in range(len(aroon_signal)):<br/>    if aroon_signal[i] &gt; 1:<br/>        position.append(0)<br/>    else:<br/>        position.append(1)<br/>        <br/>for i in range(len(tsla['close'])):<br/>    if aroon_signal[i] == 1:<br/>        position[i] = 1<br/>    elif aroon_signal[i] == -1:<br/>        position[i] = 0<br/>    else:<br/>        position[i] = position[i-1]<br/>        <br/>aroon_up = tsla['aroon_up']<br/>aroon_down = tsla['aroon_down']<br/>close_price = tsla['close']<br/>aroon_signal = pd.DataFrame(aroon_signal).rename(columns = {0:'aroon_signal'}).set_index(tsla.index)<br/>position = pd.DataFrame(position).rename(columns = {0:'aroon_position'}).set_index(tsla.index)<br/><br/>frames = [close_price, aroon_up, aroon_down, aroon_signal, position]<br/>strategy = pd.concat(frames, join = 'inner', axis = 1)<br/><br/>strategy.head()<br/><br/>print(strategy[43:48])<br/><br/>tsla_ret = pd.DataFrame(np.diff(tsla['close'])).rename(columns = {0:'returns'})<br/>aroon_strategy_ret = []<br/><br/>for i in range(len(tsla_ret)):<br/>    returns = tsla_ret['returns'][i]*strategy['aroon_position'][i]<br/>    aroon_strategy_ret.append(returns)<br/>    <br/>aroon_strategy_ret_df = pd.DataFrame(aroon_strategy_ret).rename(columns = {0:'aroon_returns'})<br/>investment_value = 100000<br/>number_of_stocks = floor(investment_value/tsla['close'][-1])<br/>aroon_investment_ret = []<br/><br/>for i in range(len(aroon_strategy_ret_df['aroon_returns'])):<br/>    returns = number_of_stocks*aroon_strategy_ret_df['aroon_returns'][i]<br/>    aroon_investment_ret.append(returns)<br/><br/>aroon_investment_ret_df = pd.DataFrame(aroon_investment_ret).rename(columns = {0:'investment_returns'})<br/>total_investment_ret = round(sum(aroon_investment_ret_df['investment_returns']), 2)<br/>profit_percentage = floor((total_investment_ret/investment_value)*100)<br/>print(cl('Profit gained from the Aroon strategy by investing $100k in TSLA : {}'.format(total_investment_ret), attrs = ['bold']))<br/>print(cl('Profit percentage of the Aroon strategy : {}%'.format(profit_percentage), attrs = ['bold']))<br/><br/>def get_benchmark(start_date, investment_value):<br/>    spy = get_historical_data('SPY', start_date)['close']<br/>    benchmark = pd.DataFrame(np.diff(spy)).rename(columns = {0:'benchmark_returns'})<br/>    <br/>    investment_value = investment_value<br/>    number_of_stocks = floor(investment_value/spy[-1])<br/>    benchmark_investment_ret = []<br/>    <br/>    for i in range(len(benchmark['benchmark_returns'])):<br/>        returns = number_of_stocks*benchmark['benchmark_returns'][i]<br/>        benchmark_investment_ret.append(returns)<br/><br/>    benchmark_investment_ret_df = pd.DataFrame(benchmark_investment_ret).rename(columns = {0:'investment_returns'})<br/>    return benchmark_investment_ret_df<br/><br/>benchmark = get_benchmark('2020-01-01', 100000)<br/><br/>investment_value = 100000<br/>total_benchmark_investment_ret = round(sum(benchmark['investment_returns']), 2)<br/>benchmark_profit_percentage = floor((total_benchmark_investment_ret/investment_value)*100)<br/>print(cl('Benchmark profit by investing $100k : {}'.format(total_benchmark_investment_ret), attrs = ['bold']))<br/>print(cl('Benchmark Profit percentage : {}%'.format(benchmark_profit_percentage), attrs = ['bold']))<br/>print(cl('Aroon Strategy profit is {}% higher than the Benchmark Profit'.format(profit_percentage - benchmark_profit_percentage), attrs = ['bold']))</span></pre></div></div>    
</body>
</html>