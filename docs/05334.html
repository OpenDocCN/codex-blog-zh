<html>
<head>
<title>Consistency In Azure Cosmos DB</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Azure Cosmos DB中的一致性</h1>
<blockquote>原文：<a href="https://medium.com/codex/consistency-in-azure-cosmos-db-1e19868c4cef?source=collection_archive---------10-----------------------#2022-02-18">https://medium.com/codex/consistency-in-azure-cosmos-db-1e19868c4cef?source=collection_archive---------10-----------------------#2022-02-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="d48b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">任何数据库中的一致性都意味着确保发生的任何事务都不会影响数据库的结构完整性。在任何给定的时间点，可能会有多个写事务影响数据库中的一个实体。如果用户试图在更改后读取同一个实体，那么他们会看到什么，是实体的更新值还是更新前的值？这个问题的答案取决于为NoSQL数据库设置了什么样的一致性级别。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/107e6a86fcbf4ea0f772e09b2c9f0657.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aXBDM2P0hOWknH3hMdxrwQ.png"/></div></div></figure><p id="124f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Cosmos DB是Azure的NoSQL，旨在供要求低延迟响应时间的关键任务应用程序使用。Azure提供的一致性级别有:</p><ul class=""><li id="83f6" class="jp jq hi ih b ii ij im in iq jr iu js iy jt jc ju jv jw jx bi translated"><em class="jy">强</em></li><li id="1775" class="jp jq hi ih b ii jz im ka iq kb iu kc iy kd jc ju jv jw jx bi translated"><em class="jy">有界无状态</em></li><li id="26ae" class="jp jq hi ih b ii jz im ka iq kb iu kc iy kd jc ju jv jw jx bi translated"><em class="jy">会期</em></li><li id="6f25" class="jp jq hi ih b ii jz im ka iq kb iu kc iy kd jc ju jv jw jx bi translated"><em class="jy">一致前缀</em></li><li id="b961" class="jp jq hi ih b ii jz im ka iq kb iu kc iy kd jc ju jv jw jx bi translated"><em class="jy">最终</em></li></ul></div><div class="ab cl ke kf gp kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="hb hc hd he hf"><p id="6076" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> Strong — </strong>在这种情况下，对所有地区的数据库的任何读取都将显示最新的数据。一旦提交了写事务，它将被写入到提供数据库的所有区域。</p><p id="daba" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在要求用户无论身在何处都能查看更新信息的应用程序中，强一致性非常重要。这方面的一个例子是需要显示正确库存数量的电子商务和售票应用程序。每当发生任何销售/预购时，所有地区的库存量都应更新，这一点很重要，因为交易是在离用户最近的供应地区处理的。</p><p id="5a40" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">有界无状态— </strong>在此一致性级别下，我们引入两个参数来确定读取和写入之间的延迟。这两个参数是T和K: <strong class="ih hj"> T — <em class="jy"> </em> </strong> <em class="jy">时间间隔，</em> <strong class="ih hj"> K— </strong> <em class="jy">更新。</em>读取可以远离最新版本最多K次提交或T个时间间隔。对区域的更新取决于首先到达哪个参数。</p><p id="a8cf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">会话— </strong>在特定的会话窗口内，保证相同区域内的客户端的所有读取都是一致的。这是管理员尚未配置的新建数据库的默认一致性级别。与强一致性相比，这种配置的主要好处是节省成本。</p><p id="68b3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">一致前缀— </strong>根据微软文档，“T28”在一致前缀选项中，返回的更新包含所有更新的一些前缀，没有间隔。一致的前缀一致性级别保证读取永远不会看到无序写入。这仅仅意味着接收事务的顺序与更新数据库的顺序相同。</p><p id="869d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">最终— </strong>在这种情况下，读取没有顺序保证。这是一致性的最弱形式。在这种情况下，客户端可能会读取被认为是旧的/陈旧的数据。这种一致性用于不需要排序保证的情况。</p><p id="fdb0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上述一致性级别还取决于创建帐户时设置的全局分布设置。这决定了数据库是否有多区域写入，默认设置为enabled。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kl"><img src="../Images/1ce762d022d3d391de823350612c6697.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gA4XCEt4lnFuXGc9IZlVmA.png"/></div></div></figure><p id="e5d8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如前所述，默认一致性设置为会话。该信息可在菜单的<em class="jy">默认一致性</em>部分找到。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es km"><img src="../Images/1a063d0c9825e9119816e8ca64efcd52.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PhJD2aIP3lBw-CVycTlkWA.png"/></div></div></figure><p id="42e2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果多区域写入会产生强一致性等影响，则启用此功能非常重要。这可以在<em class="jy">全局复制数据</em>菜单选项下找到。这将允许写入比两个预定区域更多的区域。</p></div></div>    
</body>
</html>