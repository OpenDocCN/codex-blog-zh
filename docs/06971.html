<html>
<head>
<title>Logging Spring requests using aspect object programming</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用方面对象编程记录Spring请求</h1>
<blockquote>原文：<a href="https://medium.com/codex/logging-spring-requests-using-aspect-bf11bb3382da?source=collection_archive---------0-----------------------#2022-05-23">https://medium.com/codex/logging-spring-requests-using-aspect-bf11bb3382da?source=collection_archive---------0-----------------------#2022-05-23</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="f22c" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">简介:</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/f9f7cc9941388fedf37244d7e5dbdada.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*YRu3Di_J1_UIbPwz"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">詹姆斯·哈里逊在<a class="ae jn" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="4963" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在任何web应用程序中，我们都需要记录请求和响应，我们可以在java中使用Log4j来做到这一点，但在这种技术中，我们将在业务角色中编写日志，这很好，但我们有更好的行为。</p><p id="fadb" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在本文中，我们将使用spring boot Restful API和方面编程方法来记录请求。</p><p id="2eb7" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我们将看看我们如何能做到这一点。以及为什么我们需要编写方面方法来完成它。</p><p id="36c6" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">要查看java和spring boot中方面对象编程的概述，可以点击下面的链接。</p><p id="aa56" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">1.<a class="ae jn" rel="noopener" href="/codex/aspect-object-programming-with-spring-boot-part-one-4544a58d6a4c">用Spring boot进行方面对象编程(上)</a></p><p id="edb5" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">2.<a class="ae jn" rel="noopener" href="/codex/aspect-object-programing-with-spring-boot-example-a2d0bf8f1578">用弹簧靴编程的特征对象示例(零件牵引)</a></p></div><div class="ab cl kk kl gp km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="hb hc hd he hf"><h2 id="9e19" class="kr ks hi bd kt ku kv kw kx ky kz la lb jx lc ld le kb lf lg lh kf li lj lk ll bi translated">外观配置:</h2><p id="7fe1" class="pw-post-body-paragraph jo jp hi jq b jr lm ij jt ju ln im jw jx lo jz ka kb lp kd ke kf lq kh ki kj hb bi translated">在创建新的spring boot项目后的第一步中，我们需要将我们的配置放在<strong class="jq hj"> pom.xml </strong>文件中。</p><p id="aa9b" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我们有一个简单的依赖关系来运行spring boot应用程序。</p><pre class="iy iz ja jb fd lr ls lt lu aw lv bi"><span id="2d7f" class="kr ks hi ls b fi lw lx l ly lz">&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br/>&lt;project  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"<br/>         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;<br/>    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;<br/>    &lt;parent&gt;<br/>        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br/>        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;<br/>        &lt;version&gt;2.7.0&lt;/version&gt;<br/>        &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;<br/>    &lt;/parent&gt;<br/>    &lt;groupId&gt;com.logging.aspect&lt;/groupId&gt;<br/>    &lt;artifactId&gt;logging-spring-RestApi-using-aspect-object-programming&lt;/artifactId&gt;<br/>    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;<br/>    &lt;name&gt;logging-spring-RestApi-using-aspect-object-programming&lt;/name&gt;<br/>    &lt;description&gt;logging-spring-RestApi-using-aspect-object-programming&lt;/description&gt;<br/>    &lt;properties&gt;<br/>        &lt;java.version&gt;11&lt;/java.version&gt;<br/>    &lt;/properties&gt;<br/>    &lt;dependencies&gt;<br/>        &lt;dependency&gt;<br/>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br/>            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;<br/>        &lt;/dependency&gt;<br/><br/>        &lt;dependency&gt;<br/>            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;<br/>            &lt;artifactId&gt;lombok&lt;/artifactId&gt;<br/>            &lt;optional&gt;true&lt;/optional&gt;<br/>        &lt;/dependency&gt;<br/>        &lt;dependency&gt;<br/>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br/>            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;<br/>            &lt;scope&gt;test&lt;/scope&gt;<br/>        &lt;/dependency&gt;<br/>    &lt;/dependencies&gt;<br/><br/>    &lt;build&gt;<br/>        &lt;plugins&gt;<br/>            &lt;plugin&gt;<br/>                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br/>                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;<br/>                &lt;configuration&gt;<br/>                    &lt;excludes&gt;<br/>                        &lt;exclude&gt;<br/>                            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;<br/>                            &lt;artifactId&gt;lombok&lt;/artifactId&gt;<br/>                        &lt;/exclude&gt;<br/>                    &lt;/excludes&gt;<br/>                &lt;/configuration&gt;<br/>            &lt;/plugin&gt;<br/>        &lt;/plugins&gt;<br/>    &lt;/build&gt;<br/><br/>&lt;/project&gt;</span></pre><p id="9900" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">现在我将在这个项目中向活动方面添加方面依赖。</p><pre class="iy iz ja jb fd lr ls lt lu aw lv bi"><span id="3c45" class="kr ks hi ls b fi lw lx l ly lz">&lt;!-- enable aspect --&gt;<br/>&lt;dependency&gt;<br/>    &lt;groupId&gt;org.springframework&lt;/groupId&gt;<br/>    &lt;artifactId&gt;spring-aop&lt;/artifactId&gt;<br/>    &lt;version&gt;5.3.18&lt;/version&gt;<br/>&lt;/dependency&gt;<br/><br/>&lt;dependency&gt;<br/>    &lt;groupId&gt;org.aspectj&lt;/groupId&gt;<br/>    &lt;artifactId&gt;aspectjrt&lt;/artifactId&gt;<br/>    &lt;version&gt;1.9.9.1&lt;/version&gt;<br/>&lt;/dependency&gt;<br/><br/>&lt;dependency&gt;<br/>    &lt;groupId&gt;org.aspectj&lt;/groupId&gt;<br/>    &lt;artifactId&gt;aspectjweaver&lt;/artifactId&gt;<br/>    &lt;version&gt;1.9.9.1&lt;/version&gt;<br/>&lt;/dependency&gt;</span></pre><p id="c62c" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">上述依赖关系是在任何maven项目中激活AOP的重要依赖关系。</p></div><div class="ab cl kk kl gp km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="hb hc hd he hf"><h2 id="1b0f" class="kr ks hi bd kt ku kv kw kx ky kz la lb jx lc ld le kb lf lg lh kf li lj lk ll bi translated">为应用程序编写业务逻辑</h2><p id="c271" class="pw-post-body-paragraph jo jp hi jq b jr lm ij jt ju ln im jw jx lo jz ka kb lp kd ke kf lq kh ki kj hb bi translated">这个项目中我们需要什么？</p><p id="d457" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">实际上，在这个项目中，我们需要一些特性来完成你对AOP的设想。</p><ol class=""><li id="107f" class="ma mb hi jq b jr js ju jv jx mc kb md kf me kj mf mg mh mi bi translated">简单控制器:我们需要它来处理来自客户端的请求</li><li id="5e49" class="ma mb hi jq b jr mj ju mk jx ml kb mm kf mn kj mf mg mh mi bi translated">简单服务:我们需要它将请求从控制器传递到DTO</li><li id="442d" class="ma mb hi jq b jr mj ju mk jx ml kb mm kf mn kj mf mg mh mi bi translated">简单的DTO:我们需要在终端中使用AOP包登录</li><li id="3a98" class="ma mb hi jq b jr mj ju mk jx ml kb mm kf mn kj mf mg mh mi bi translated">简单枚举:我们需要创建一个枚举来知道我们需要记录什么数据<strong class="jq hj">请求，响应</strong></li></ol><p id="9ccc" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">让我们去做吧。</p><ol class=""><li id="1618" class="ma mb hi jq b jr js ju jv jx mc kb md kf me kj mf mg mh mi bi translated">创建控制器:</li></ol><p id="0700" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我们的控制器叫做Usercontroller，我们将在一个叫做Controller的包中创建它来安排我们的代码。</p><pre class="iy iz ja jb fd lr ls lt lu aw lv bi"><span id="87cd" class="kr ks hi ls b fi lw lx l ly lz">package com.logging.aspect.loggingspringrestapiusingaspectobjectprogramming.controller;<br/><br/>import com.logging.aspect.loggingspringrestapiusingaspectobjectprogramming.model.UserDto;<br/>import com.logging.aspect.loggingspringrestapiusingaspectobjectprogramming.service.UserService;<br/>import org.springframework.http.ResponseEntity;<br/>import org.springframework.web.bind.annotation.PostMapping;<br/>import org.springframework.web.bind.annotation.RequestBody;<br/>import org.springframework.web.bind.annotation.RequestMapping;<br/>import org.springframework.web.bind.annotation.RestController;<br/><br/>import java.net.URI;<br/><br/>@RestController<br/>@RequestMapping("user")<br/>public class UserController {<br/>    private UserService userService;<br/><br/>    public UserController(UserService userService){<br/>        this.userService=userService;<br/>    }<br/><br/>    @PostMapping("/login")<br/>    public ResponseEntity&lt;UserDto&gt; loginUser(@RequestBody UserDto userDto) throws Exception {<br/>        return ResponseEntity.<em class="mo">ok</em>().body(userService.login(userDto));<br/>    }<br/>}</span></pre><p id="b1a1" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">您可以通过<a class="ae jn" href="https://github.com/abdalrhmanAlkraien/logging-spring-RestApi-using-aspect-object-programming/blob/main/src/main/java/com/logging/aspect/loggingspringrestapiusingaspectobjectprogramming/controller/UserController.java" rel="noopener ugc nofollow" target="_blank"> UserController </a>在git hub中看到DataType enum</p><p id="9e14" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">2.创建服务:</p><p id="6d6b" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我们的服务叫做Userservice，我们将在一个叫做Service的包中创建它来安排我们的代码。</p><pre class="iy iz ja jb fd lr ls lt lu aw lv bi"><span id="0d0f" class="kr ks hi ls b fi lw lx l ly lz">package com.logging.aspect.loggingspringrestapiusingaspectobjectprogramming.service;<br/><br/>import com.logging.aspect.loggingspringrestapiusingaspectobjectprogramming.model.UserDto;<br/>import org.springframework.stereotype.Service;<br/><br/>@Service<br/>public class UserService {<br/><br/>    public UserDto login(UserDto userDto) throws Exception {<br/>        if(userDto.getUserName().equals(userDto.getPassword())){<br/>            throw new Exception();<br/>        }<br/>        return userDto;<br/>    }<br/>}</span></pre><p id="4c0c" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">您可以通过<a class="ae jn" href="https://github.com/abdalrhmanAlkraien/logging-spring-RestApi-using-aspect-object-programming/blob/main/src/main/java/com/logging/aspect/loggingspringrestapiusingaspectobjectprogramming/service/UserService.java" rel="noopener ugc nofollow" target="_blank"> UserService </a>在git hub中看到DataType enum</p><p id="0741" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">3.创建用户到:</p><p id="0c52" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我们的UserDto被称为<strong class="jq hj"> UserDto </strong>，我们将在一个名为model的包中创建它来安排我们的代码。</p><pre class="iy iz ja jb fd lr ls lt lu aw lv bi"><span id="7392" class="kr ks hi ls b fi lw lx l ly lz">package com.logging.aspect.loggingspringrestapiusingaspectobjectprogramming.model;<br/><br/>import lombok.Data;<br/><br/>@Data<br/>public class UserDto {<br/>  private String userName;<br/>  private String password;<br/>}</span></pre><p id="47c5" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">您可以通过<a class="ae jn" href="https://github.com/abdalrhmanAlkraien/logging-spring-RestApi-using-aspect-object-programming/blob/main/src/main/java/com/logging/aspect/loggingspringrestapiusingaspectobjectprogramming/model/UserDto.java" rel="noopener ugc nofollow" target="_blank">userdo</a>在git hub中查看数据类型enum</p><p id="fb12" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">4.枚举数据类型:在这个枚举中，我们有两种类型<strong class="jq hj">请求</strong>和<strong class="jq hj">响应，</strong>我将创建一个<strong class="jq hj">实用程序</strong>包来安排我们的项目。</p><pre class="iy iz ja jb fd lr ls lt lu aw lv bi"><span id="721d" class="kr ks hi ls b fi lw lx l ly lz">package com.logging.aspect.loggingspringrestapiusingaspectobjectprogramming.utile;<br/><br/>public enum DataType {<br/>    <em class="mo">REQUEST</em>,<em class="mo">RESPONSE<br/></em>}</span></pre><p id="a09f" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">您可以通过<a class="ae jn" href="https://github.com/abdalrhmanAlkraien/logging-spring-RestApi-using-aspect-object-programming/blob/main/src/main/java/com/logging/aspect/loggingspringrestapiusingaspectobjectprogramming/utile/DataType.java" rel="noopener ugc nofollow" target="_blank">数据类型</a>在git hub中看到数据类型枚举</p><p id="2877" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">现在，在完成业务逻辑之后，我们需要通过AOP方法跟踪请求和响应。</p></div><div class="ab cl kk kl gp km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="hb hc hd he hf"><h2 id="a43c" class="kr ks hi bd kt ku kv kw kx ky kz la lb jx lc ld le kb lf lg lh kf li lj lk ll bi translated"><strong class="ak">方面-对象编程(AOP) </strong></h2><p id="bd04" class="pw-post-body-paragraph jo jp hi jq b jr lm ij jt ju ln im jw jx lo jz ka kb lp kd ke kf lq kh ki kj hb bi translated">第一步，我们需要创建一个名为<strong class="jq hj"> aspect的新包，</strong>这个包将有aspect类。这个包中的第一个类叫做<strong class="jq hj"> UserAOP。</strong></p><p id="a9d8" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在这堂课中，我们将编写一个代码来完成以下过程。</p><ol class=""><li id="bf16" class="ma mb hi jq b jr js ju jv jx mc kb md kf me kj mf mg mh mi bi translated">我们需要捕捉所有的请求并记录下来。</li><li id="3bad" class="ma mb hi jq b jr mj ju mk jx ml kb mm kf mn kj mf mg mh mi bi translated">我们需要捕捉所有的响应并记录下来。</li><li id="4e8c" class="ma mb hi jq b jr mj ju mk jx ml kb mm kf mn kj mf mg mh mi bi translated">我们需要捕捉任何异常并记录错误及其位置。</li></ol><p id="1642" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">让我们去做吧。</p><p id="7be6" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我将在下面的代码块中解释重要的代码。</p><p id="c09a" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在课程的第一步，我们需要毫无问题地定义和运行。您可以看到下面的代码，并阅读注释行以便更好地理解。</p><pre class="iy iz ja jb fd lr ls lt lu aw lv bi"><span id="e08b" class="kr ks hi ls b fi lw lx l ly lz">package com.logging.aspect.loggingspringrestapiusingaspectobjectprogramming.aspect;<br/><br/>import com.logging.aspect.loggingspringrestapiusingaspectobjectprogramming.utile.DataType;<br/>import lombok.extern.log4j.Log4j2;<br/>import org.aspectj.lang.JoinPoint;<br/>import org.aspectj.lang.annotation.Aspect;<br/>import org.aspectj.lang.annotation.Before;<br/>import org.aspectj.lang.annotation.Pointcut;<br/>import org.springframework.stereotype.Component;<br/><br/>import java.util.Arrays;<br/><br/><em class="mo">/**<br/> Component: The aspect class must be Component Bean inside the spring context.<br/> Aspect: We need to write @Aspect above the class to interrupt each advice inside it.<br/> Log4j2: from Lombok for logger any message and debug the code<br/> **/<br/><br/></em>@Component<br/>@Aspect<br/>@Log4j2<br/>public class UserAOP {</span><span id="515f" class="kr ks hi ls b fi mp lx l ly lz">// our logic here </span><span id="e7b4" class="kr ks hi ls b fi mp lx l ly lz">}</span></pre></div><div class="ab cl kk kl gp km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="hb hc hd he hf"><p id="57a3" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">记录控制器收到的所有请求</strong></p><p id="d441" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">现在我们需要创建一个新的方法来捕获控制器将接收的所有请求。</p><p id="327a" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">下面的代码在注释行中解释了每一步</p><pre class="iy iz ja jb fd lr ls lt lu aw lv bi"><span id="ad43" class="kr ks hi ls b fi lw lx l ly lz"><em class="mo">/**<br/> * the following code will represent api Point cut value to set and reuse it inside any point cut method<br/> * log controller is a point cut method<br/> **/<br/></em>private final String apiPointCut="execution(* com.logging.aspect.loggingspringrestapiusingaspectobjectprogramming.controller.*.*(..))";<br/><br/>@Pointcut(apiPointCut)<br/>public void logController(){}<br/><br/><em class="mo">/**<br/> *<br/> * </em><strong class="ls hj"><em class="mo">@param </em></strong><em class="mo">joinPoint we can find inside it all the details of the method called inside the join point<br/> *<br/> * the AOP will execute this method before execute controller method<br/> */<br/></em>@Before("logController()")<br/>public void logRequest(JoinPoint joinPoint){<br/>    // for log the controller name<br/>    <em class="mo">log</em>.info(joinPoint.getSignature().getName());<br/>    // for log the request attributes form client side<br/>    <em class="mo">log</em>.info(createJoinPointForLogs(joinPoint,DataType.<em class="mo">REQUEST</em>));<br/>}<br/><br/><br/><em class="mo">/**<br/> *<br/> * </em><strong class="ls hj"><em class="mo">@param </em></strong><em class="mo">joinPoint we need to use it to see attributes in the original method<br/> * </em><strong class="ls hj"><em class="mo">@return </em></strong><em class="mo">will return String after building all the attributes<br/> */<br/></em>private String createJoinPointForLogs(JoinPoint joinPoint, DataType dataType) {<br/>    <em class="mo">/**<br/>     * the joinPoint has arguments from the controller,<br/>     * but we can see the args will receive here as an Array we need to check the length of it before making any Operations.<br/>     */<br/>    </em>if (joinPoint.getArgs().length &lt; 1) {<br/>        return joinPoint.getSignature().getName()<br/>                .concat(" method don`t have parameters");<br/>    }<br/>    Object[] obj = joinPoint.getArgs();<br/>    StringBuilder requestValue = new StringBuilder();<br/>    if(dataType.equals(DataType.<em class="mo">REQUEST</em>)){<br/>        requestValue.append("\r\n========== The request values ==========");<br/>    }<br/>    else {<br/>        requestValue.append("\r\n========== The response values ==========");<br/>    }<br/>    Arrays.<em class="mo">stream</em>(obj).forEach(x -&gt; {<br/>        requestValue.append("\r\n");<br/>        requestValue.append(x.toString());<br/>    });<br/>    requestValue<br/>            .append("\r\n============= ======="<br/>                    + "====== =============");<br/>    return requestValue.toString();<br/>}</span></pre></div><div class="ab cl kk kl gp km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="hb hc hd he hf"><p id="186d" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">记录所有来自控制器的响应:</strong></p><p id="6433" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在这一节中，我们需要实现代码来捕捉来自控制器的任何响应。</p><p id="e24f" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">下面的代码在注释行中解释了每一步。</p><pre class="iy iz ja jb fd lr ls lt lu aw lv bi"><span id="c33b" class="kr ks hi ls b fi lw lx l ly lz">@AfterReturning("logController()")<br/>public void logsResponse(JoinPoint joinPoint){<br/>    // for log the controller name<br/>    <em class="mo">log</em>.info(joinPoint.getSignature().getName());<br/>    <em class="mo">log</em>.info(createJoinPointForLogs(joinPoint,DataType.<em class="mo">RESPONSE</em>));<br/>}</span></pre><p id="90b7" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">实际上，我们只为响应后的日志添加了一个方法</p></div><div class="ab cl kk kl gp km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="hb hc hd he hf"><p id="9cb9" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">记录项目中的所有异常:</strong></p><p id="178a" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在这一节中，我们需要实现代码来捕捉项目内部将发生的任何异常。</p><p id="61c6" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">下面的实现将捕获并记录项目中的任何异常，从日志中我们将知道错误在哪里。</p><p id="80fa" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">为了补充它，我们需要一个新的变量和新的方法。</p><p id="ea07" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">下面的代码在注释行中解释了每一步。</p><pre class="iy iz ja jb fd lr ls lt lu aw lv bi"><span id="3085" class="kr ks hi ls b fi lw lx l ly lz"><em class="mo">/**<br/> * the following point cut will scan all the project and catch any errors inside the project files<br/> */<br/></em>private final String exceptionPointcut ="execution(* com.logging.aspect.loggingspringrestapiusingaspectobjectprogramming.*.*.*(..))";</span><span id="18e8" class="kr ks hi ls b fi mp lx l ly lz"><em class="mo">/**<br/> * This method will print<br/> * </em><strong class="ls hj"><em class="mo">@param </em></strong><em class="mo">joinPoint we can find inside it all the details of the method called inside the join point<br/> * </em><strong class="ls hj"><em class="mo">@param </em></strong><em class="mo">exception from here we can know more details about the exception like exception type and exception message<br/> */<br/></em>@AfterThrowing(value = exceptionPointcut ,throwing = "exception")<br/>public void logsErrors(JoinPoint joinPoint, Throwable exception){<br/>    <em class="mo">log</em>.info("========================== We have Error here ==========================");<br/>    // for log the controller name<br/>    <em class="mo">log</em>.info(joinPoint.getSignature().getName());<br/>    // for know what the exception message<br/>    <em class="mo">log</em>.info(exception.getMessage());<br/>    <em class="mo">log</em>.info("==========================================================================");<br/>}</span></pre><p id="7966" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">您可以使用下面的链接在git hub上找到这个项目。</p><p id="6edb" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><a class="ae jn" href="https://github.com/abdalrhmanAlkraien/logging-spring-RestApi-using-aspect-object-programming" rel="noopener ugc nofollow" target="_blank">https://github . com/abdalrhmanAlkraien/logging-spring-RestApi-using-aspect-object-programming</a></p></div><div class="ab cl kk kl gp km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="hb hc hd he hf"><p id="af55" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">使用PostMain和IDEA终端日志测试代码</strong></p><p id="bd0d" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">为了测试代码，我将使用postman，并通过IDEA终端查看日志。您可以使用任何其他工具。</p><p id="0b87" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">我们去测试代码吧。</strong></p><p id="8323" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">实际上，此时我们有一个Post方法URI<a class="ae jn" href="http://localhost:8080/user/login" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/user/log in</a>。</p><p id="d69e" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">请看下图，看看邮递员将如何工作。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mq"><img src="../Images/861e51bd75e0e1dd37cf5adedf02ee77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IfH4-UvdxE46Y2L576pTfw.png"/></div></div></figure><p id="6ec0" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">当发送此请求时，您必须看到类似下面的请求图像。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mr"><img src="../Images/59bcbb08c8435f30b76c619872f3e7c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*USRjlYhZff3U9x4Ww-GN2Q.png"/></div></div></figure><p id="097c" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">现在，当返回响应时，会出现类似下图的请求。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ms"><img src="../Images/515023c2f8e3d3a803b6d73aaf705b24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HNqJptU63pAj4khzgCruxA.png"/></div></div></figure><p id="b08d" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">现在如果试图为用户名和密码发送相同的值，将会抛出一个新的异常。</strong></p><p id="5649" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在发送具有相同的用户名和密码值<strong class="jq hj">的请求后，</strong>将会看到类似下图的日志。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mt"><img src="../Images/b116bcce5ec01a9f9c6f59b6344f29b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6p5Vz1u8riwRjcX8SGdgoA.png"/></div></div></figure><p id="8d17" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">您可以看到，当使用方面时，您可以用一个日志实现创建许多API。</p><h2 id="d52f" class="kr ks hi bd kt ku kv kw kx ky kz la lb jx lc ld le kb lf lg lh kf li lj lk ll bi translated">结论:</h2><p id="cb67" class="pw-post-body-paragraph jo jp hi jq b jr lm ij jt ju ln im jw jx lo jz ka kb lp kd ke kf lq kh ki kj hb bi translated">使用方面方法，您可以记录许多事情，而不需要在每个类中编写日志代码。您可以从<strong class="jq hj">冗余中保存代码。</strong></p><p id="cb81" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">使用方面方法，您的业务日志有自己的一面，而您的日志和跟踪代码有另一面。这意味着你的代码在未来保持有序，没有任何随机性。</p><p id="956b" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">使用spring-boot的方面对象编程为开发人员提供了许多提高代码质量的特性。例如，使用注释来记录特定的方法和许多其他特性。</p><p id="fa94" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">您可以使用下面的代码在git hub上看到项目代码。</p><div class="mu mv ez fb mw mx"><a href="https://github.com/abdalrhmanAlkraien/logging-spring-RestApi-using-aspect-object-programming" rel="noopener  ugc nofollow" target="_blank"><div class="my ab dw"><div class="mz ab na cl cj nb"><h2 class="bd hj fi z dy nc ea eb nd ed ef hh bi translated">GitHub-abdalrhmanAlkraien/logging-spring-RestApi-using-aspect-object-programming:logging all…</h2><div class="ne l"><h3 class="bd b fi z dy nc ea eb nd ed ef dx translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="nf l"><p class="bd b fp z dy nc ea eb nd ed ef dx translated">github.com</p></div></div><div class="ng l"><div class="nh l ni nj nk ng nl jh mx"/></div></div></a></div><p id="0f1e" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">别忘了在文章上拍手，每篇文章可以拍手50次。还有你在这里找到我的</strong><a class="ae jn" href="https://www.linkedin.com/in/abd-alrhman-alkraien-83a93a1b1/" rel="noopener ugc nofollow" target="_blank"><strong class="jq hj">LinkedIn</strong></a></p><h2 id="0bde" class="kr ks hi bd kt ku kv kw kx ky kz la lb jx lc ld le kb lf lg lh kf li lj lk ll bi translated">参考资料:</h2><p id="2c31" class="pw-post-body-paragraph jo jp hi jq b jr lm ij jt ju ln im jw jx lo jz ka kb lp kd ke kf lq kh ki kj hb bi translated"><a class="ae jn" href="https://github.com/abdalrhmanAlkraien/Aspect-example" rel="noopener ugc nofollow" target="_blank">https://github.com/abdalrhmanAlkraien/Aspect-example</a></p></div></div>    
</body>
</html>