<html>
<head>
<title>Things you should know before using AWS SQS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用自动气象站SQS之前您应该知道的事情</h1>
<blockquote>原文：<a href="https://medium.com/codex/things-you-should-know-before-using-aws-sqs-5a6d57fb1c9a?source=collection_archive---------1-----------------------#2021-11-06">https://medium.com/codex/things-you-should-know-before-using-aws-sqs-5a6d57fb1c9a?source=collection_archive---------1-----------------------#2021-11-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="e627" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">需要注意几个问题，这样您就可以毫无意外地享受SQS的可扩展性</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/25e49540840837acd377367b46a49e7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*yEb5-5jzty581qpv"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">沃洛季米尔·赫里先科在<a class="ae jn" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</figcaption></figure><h1 id="d1fe" class="jo jp hi bd jq jr js jt ju jv jw jx jy io jz ip ka ir kb is kc iu kd iv ke kf bi translated">SQS</h1><p id="c492" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">由于SQS是无服务器架构的一部分——AWS使您可以轻松地扩展发送数百或数千或更多的消息，忘记为message broker选择实例大小。但这是有代价的，你应该在孤注一掷之前知道这些棘手的事情。</p><h2 id="e3b2" class="lc jp hi bd jq ld le lf ju lg lh li jy kp lj lk ka kt ll lm kc kx ln lo ke lp bi translated">棘手的#1: sendMessage()不是“同步的”</h2><p id="346d" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">即使函数调用完成，也不能保证下面的receiveMessage()会收到您刚刚发送的消息。整个SQS系统是一个分布式系统，所以在时间上没有任何保证。然而，长时间的等待可能很少，大多数时候你会很快得到消息。尽管如此，即使您设置了很长的接收消息等待时间，这种延迟仍然可能发生。将等待时间设置为最长20秒也不能完全避免这种情况——你会惊讶地发现，长时间的20秒仍然不足以让SQS在队列中准备好你的消息。</p><p id="ac96" class="pw-post-body-paragraph kg kh hi ki b kj lq ij kl km lr im ko kp ls kr ks kt lt kv kw kx lu kz la lb hb bi translated">建议:使用轮询来确保消息最终得到处理</p><h2 id="8043" class="lc jp hi bd jq ld le lf ju lg lh li jy kp lj lk ka kt ll lm kc kx ln lo ke lp bi translated">棘手的#2:队列中的消息是不确定的</h2><p id="8bb8" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">很难确定一个队列在给定的时间点是否真的是“空”的。即使停止发送消息，也不容易确定队列是否被完全清空。AWS文档建议您持续轮询队列10分钟，如果有几个统计数据始终为零，那么您就可以确保队列被完全清空。</p><p id="388e" class="pw-post-body-paragraph kg kh hi ki b kj lq ij kl km lr im ko kp ls kr ks kt lt kv kw kx lu kz la lb hb bi translated">建议:如果您真的需要知道队列是否被清空，那么使用数据库来跟踪记录。</p><h2 id="b6b7" class="lc jp hi bd jq ld le lf ju lg lh li jy kp lj lk ka kt ll lm kc kx ln lo ke lp bi translated">棘手的# 3:FIFO队列中的阻塞问题</h2><p id="0b06" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">使用SQS时，首先要决定的几件事之一是选择标准或FIFO队列类型。虽然FIFO队列为您提供了排序保证，但它也有一定的成本和一些关键的限制。</p><p id="3230" class="pw-post-body-paragraph kg kh hi ki b kj lq ij kl km lr im ko kp ls kr ks kt lt kv kw kx lu kz la lb hb bi translated">当您调用receiveMessage()并决定“将消息放回队列”时，问题就出现了——唯一的方法是不删除它并忽略该消息。该消息将等待<code class="du lv lw lx ly b">visibilityTimeout</code>秒，然后它将再次出现在队列中。在等待过程中，当新的消息进来时会发生什么？当然——为了保持FIFO的顺序，SQS有效地阻塞了整个队列，不让receiveMessage()调用访问任何消息。</p><p id="728d" class="pw-post-body-paragraph kg kh hi ki b kj lq ij kl km lr im ko kp ls kr ks kt lt kv kw kx lu kz la lb hb bi translated">推荐:根据需要选择MessageGroupId，这样当某个Id的消息被阻止时，队列仍然可以传递其他id的消息。或者，如果您的消息不依赖于先前的消息，您可以只使用标准类型队列。</p></div><div class="ab cl lz ma gp mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="hb hc hd he hf"><p id="8173" class="pw-post-body-paragraph kg kh hi ki b kj lq ij kl km lr im ko kp ls kr ks kt lt kv kw kx lu kz la lb hb bi translated">这就是所有棘手的部分。一旦您找到了解决它们的方法，就可以轻而易举地享受SQS提供的高吞吐量和简单性，相比之下，RabbitMQ等其他选项需要您运行24/7服务器实例。</p></div></div>    
</body>
</html>