<html>
<head>
<title>Logical tabular network model of database “Polls” example — formalization using HTMS. Part 2. Data manipulation, filtering, and searching</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">数据库“轮询”示例的逻辑表格网络模型——使用HTMS进行形式化。第二部分。数据操作、过滤和搜索</h1>
<blockquote>原文：<a href="https://medium.com/codex/logical-tabular-network-model-of-database-polls-example-formalization-using-htms-634a858252a5?source=collection_archive---------17-----------------------#2021-09-04">https://medium.com/codex/logical-tabular-network-model-of-database-polls-example-formalization-using-htms-634a858252a5?source=collection_archive---------17-----------------------#2021-09-04</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="46f2" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">超表格或表格网络数据库——关系数据库和网络数据库概念与Python中面向对象编程的交叉点上的新方法</h2></div><p id="829d" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">【这是<em class="jt">表格网络数据模型</em>系列的第5部分。点击这里查看所有<a class="ae ju" rel="noopener" href="/@azur06400/tabular-network-data-model-series-f7b8469ed333">帖子的链接。本文提供了HTMS的一些类和方法的精简描述。完整描述见程序文档⁴ ⁵]</a></p><figure class="jw jx jy jz fd ka er es paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="er es jv"><img src="../Images/cc7ad105754ff0a2ab5c1a8ce8f13ce9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v1PMCqkioxP5nKJZ44A3sA.jpeg"/></div></div><figcaption class="kh ki et er es kj kk bd b be z dx translated">图一。用于表格网络数据库的HTed web编辑器的屏幕截图。</figcaption></figure><h2 id="0df5" class="kl km hi bd kn ko kp kq kr ks kt ku kv jg kw kx ky jk kz la lb jo lc ld le lf bi translated">主HTMS映射类</h2><p id="9e34" class="pw-post-body-paragraph ix iy hi iz b ja lg ij jc jd lh im jf jg li ji jj jk lj jm jn jo lk jq jr js hb bi translated">HTMS逻辑层API包含了最重要的<strong class="iz hj"> <em class="jt"> Obj_RAM </em> </strong>类，用它可以将对象从程序代码映射(转换)到表的行，反之亦然。</p><p id="5f12" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">每个对象(该类的一个实例)要么对应于某个表中的一行，该表包含其数据类型HT属性(DTA)字段的子集(在最简单的情况下，包含数据而不是链接的列，包含整个数据字段集)，要么用于向数据库添加新行。</p><p id="d0ec" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">该类还具有提供筛选和搜索数据的操作的方法。</p><p id="f7be" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">当初始化具有特定HT的类的对象时，必需的参数是:</p><ul class=""><li id="575c" class="ll lm hi iz b ja jb jd je jg ln jk lo jo lp js lq lr ls lt bi translated"><code class="du lu lv lw lx b">table</code> ( <em class="jt">对象</em>)-ram中已经存在的特定表(<strong class="iz hj"> <em class="jt">表</em> </strong> object⁴)的实例；</li></ul><p id="2af9" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">可以另外指定参数<code class="du lu lv lw lx b">new</code>:如果“<em class="jt">True”</em>，则创建一个新的数据库，作为一组文件和一个新的类；如果“<em class="jt">False”</em>(默认情况下)，则现有数据库“打开”，即打开其文件，并根据其中的信息创建该类的对象实例。</p><p id="37a8" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj"> <em class="jt"> Obj_RAM </em> </strong>“行”实例的主要属性有:</p><ul class=""><li id="3a13" class="ll lm hi iz b ja jb jd je jg ln jk lo jo lp js lq lr ls lt bi translated"><strong class="iz hj"> id — </strong>该对象在表中对应的行的物理编号，或者<strong class="iz hj"> <em class="jt"> None </em> </strong>表示在RAM中创建的实例尚未保存为表中的行；</li><li id="0795" class="ll lm hi iz b ja ly jd lz jg ma jk mb jo mc js lq lr ls lt bi translated"><strong class="iz hj">字段</strong> —字典，其中关键字是HT属性的名称，值是它们的值；</li><li id="9a1e" class="ll lm hi iz b ja ly jd lz jg ma jk mb jo mc js lq lr ls lt bi translated"><strong class="iz hj">表名</strong> -符号表名；</li><li id="19b7" class="ll lm hi iz b ja ly jd lz jg ma jk mb jo mc js lq lr ls lt bi translated"><strong class="iz hj"> HT_Obj_name </strong> -符号HT名称。</li></ul><p id="97c6" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">主要的<strong class="iz hj"> Obj_RAM </strong>方法有:</p><ol class=""><li id="2c5b" class="ll lm hi iz b ja jb jd je jg ln jk lo jo lp js md lr ls lt bi translated"><strong class="iz hj"> get_from_table </strong><code class="du lu lv lw lx b">rows</code> —所需行的物理编号列表(元组)；如果为空，则选择将在整个表格中继续。<code class="du lu lv lw lx b">with_fields</code> —具有用于过滤行的搜索模式的字典。</li><li id="848e" class="ll lm hi iz b ja ly jd lz jg ma jk mb jo mc js md lr ls lt bi translated"><strong class="iz hj"> get_clone </strong> <code class="du lu lv lw lx b">()</code>该方法使用<code class="du lu lv lw lx b">fields</code>字典中的<code class="du lu lv lw lx b">id = <strong class="iz hj"><em class="jt">None</em></strong></code>和“空”属性值在RAM中创建一个新实例。</li><li id="3a2f" class="ll lm hi iz b ja ly jd lz jg ma jk mb jo mc js md lr ls lt bi translated"><strong class="iz hj"> link_refs </strong> <code class="du lu lv lw lx b">(link_field='', to_table_objects=())</code>该方法用于添加(更新)RAM中“行”对象之间的链接。它为指定的<code class="du lu lv lw lx b">link_field</code>(RTA的符号名)更新对象中的字段值—添加到指定的<code class="du lu lv lw lx b">to_table_objects</code>(“rows”实例的元组)表行的链接。</li><li id="3a95" class="ll lm hi iz b ja ly jd lz jg ma jk mb jo mc js md lr ls lt bi translated"><strong class="iz hj"> source </strong> <code class="du lu lv lw lx b">(source_class=None, only_fields=set(), with_fields={})</code>获取引用它的对象列表。</li><li id="cf17" class="ll lm hi iz b ja ly jd lz jg ma jk mb jo mc js md lr ls lt bi translated"><strong class="iz hj">unlink</strong>T10】该方法用于移除(更新)RAM中“行”对象之间的链接。</li><li id="e873" class="ll lm hi iz b ja ly jd lz jg ma jk mb jo mc js md lr ls lt bi translated">使用指定的属性名<code class="du lu lv lw lx b">link_field</code>获取该对象引用的对象列表。这用于HT中的直接导航。<code class="du lu lv lw lx b">only_fields</code>–对象中必须存在的表格的一组字段(列)，<code class="du lu lv lw lx b">ref_class</code>–仅从给定表格创建对象列表(如果未指定，则从任何表格)。<code class="du lu lv lw lx b">ref_class</code>表格数据属性的名称(非RTA)，或一组这样的名称。将出现在此方法返回的每个实例中的表数据列集。如果该值是一个空集(默认情况下)，那么将使用所有表数据属性创建对象。</li><li id="0f18" class="ll lm hi iz b ja ly jd lz jg ma jk mb jo mc js md lr ls lt bi translated"><strong class="iz hj">保存</strong> <code class="du lu lv lw lx b">()</code>如果对象具有正确的标识符字段<code class="du lu lv lw lx b">id</code>，则将对象保存在表格行中(更新其字段)。如果<code class="du lu lv lw lx b">id==0 or None</code>，则新的一行被添加到表中(在末尾)，并且值<code class="du lu lv lw lx b">id</code>被设置为等于表行数加1。</li></ol><p id="8ae9" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">更新</strong>(2022年8月12日)</p><p id="5cf2" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">从HTMS第三版(2022年8月)开始，有两种链接:简单的<strong class="iz hj">链接</strong>(在HTMS第二版中)和<strong class="iz hj">编号或“加权”链接</strong>。编号(“加权”)链接—是一个简单的链接加上<strong class="iz hj">权重</strong>(实数):三元组(表号、行号、权重)。</p><p id="4520" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">新的<strong class="iz hj"> Obj_RAM </strong>方法(来自HTMS版本3.1):</p><ol class=""><li id="2dc2" class="ll lm hi iz b ja jb jd je jg ln jk lo jo lp js md lr ls lt bi translated"><strong class="iz hj">权重</strong> <code class="du lu lv lw lx b">(weight_field =’’, to_table_objects= ())</code>方法用于添加(更新)内存中对象之间的编号链接(权重)。它为指定的权重字段更新对象中的字段值，并将编号链接添加到表的指定对象(行)中。</li><li id="94af" class="ll lm hi iz b ja ly jd lz jg ma jk mb jo mc js md lr ls lt bi translated"><strong class="iz hj">un weight</strong>T5】方法按指定的属性名(带编号链接的表字段)删除RAM中指定Obj_RAM对象的编号链接。</li><li id="0583" class="ll lm hi iz b ja ly jd lz jg ma jk mb jo mc js md lr ls lt bi translated"><strong class="iz hj">weight _ change</strong>T6】方法用于更新RAM中对象之间的权重。它为指定的weight_field更新对象中字段值中的实数(weight)。</li><li id="2031" class="ll lm hi iz b ja ly jd lz jg ma jk mb jo mc js md lr ls lt bi translated"><strong class="iz hj"> weight_refs </strong> <code class="du lu lv lw lx b">(weight_field =’’, only_fields=set(), with_fields={})</code>使用指定的属性名(权重字段)获取该对象引用的对象列表。这用于HT中的导航。</li></ol><h2 id="fd2e" class="kl km hi bd kn ko kp kq kr ks kt ku kv jg kw kx ky jk kz la lb jo lc ld le lf bi translated">HTMS的程序代码示例</h2><p id="fe87" class="pw-post-body-paragraph ix iy hi iz b ja lg ij jc jd lh im jf jg li ji jj jk lj jm jn jo lk jq jr js hb bi translated"><strong class="iz hj">从JSON文件开始填充数据库的实用函数</strong> seed() <strong class="iz hj">的例子。</strong></p><p id="8496" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">投票示例的JSON <code class="du lu lv lw lx b">samples_file</code>文件</p><pre class="jw jx jy jz fd me lx mf mg aw mh bi"><span id="5013" class="kl km hi lx b fi mi mj l mk ml">[<br/>    {<br/>        "text": "What is your favorite time of the year?",<br/>        "choices": ["Winter", "Spring", "Summer", "Autumn"]<br/>    },<br/>    {<br/>        "text": "Where do you like to spend your holidays most of all?",<br/>        "choices": ["At home", "While traveling", "In the house of children (parents)"]<br/>    },<br/>    {<br/>        "text": "What programming language do you prefer?",<br/>        "choices": ["C", "C++", "Java", "Python"]<br/>    }<br/>]</span></pre><p id="7052" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">功能程序代码</p><pre class="jw jx jy jz fd me lx mf mg aw mh bi"><span id="b68e" class="kl km hi lx b fi mi mj l mk ml"><strong class="lx hj">import </strong>json<br/><strong class="lx hj">import</strong> datetime<br/><strong class="lx hj">def</strong> seed():<br/>    <strong class="lx hj">from</strong> config <strong class="lx hj">import</strong> polls_db, users, polls, answers, comments<br/>          <strong class="lx hj">#</strong> <em class="jt">for polls_db, users, polls, answers, comments<br/> </em>         <strong class="lx hj">#</strong> <em class="jt">definitions see </em><a class="ae ju" rel="noopener" href="/codex/hypertable-management-system-htms-for-tabular-network-databases-1e9ef617f0ad"><em class="jt">previous post</em></a><br/>    samples_path = ""  <strong class="lx hj"># </strong>path to JSON samples_file</span><span id="9cc6" class="kl km hi lx b fi mm mj l mk ml"><strong class="lx hj">    # </strong><em class="jt">reading and filling out a dictionary from JSON file:</em><br/>    <strong class="lx hj">with open</strong>(samples_path, "r", encoding="utf-8-sig")<br/>        <strong class="lx hj">as</strong> samples_file:<br/>        samples_polls = json.load(samples_file)</span><span id="ef85" class="kl km hi lx b fi mm mj l mk ml"><strong class="lx hj">    #</strong> <em class="jt">creation of "generic" objects for working with table rows:</em><br/>    poll_obj_model =   Obj_RAM(polls)  <strong class="lx hj"># </strong><em class="jt">polls table</em><br/>    answer_obj_model = Obj_RAM(        <strong class="lx hj">#</strong> <em class="jt">answers table</em><br/>        answers,<br/>        only_fields={ <strong class="lx hj">#</strong> <em class="jt">object is created with necessary attributes:</em><br/>            "answer_text",<br/>            "answer_number",         <strong class="lx hj"># </strong><em class="jt">serial number</em><br/>        },<br/>    )</span><span id="9fd7" class="kl km hi lx b fi mm mj l mk ml"><strong class="lx hj">    # </strong><em class="jt">creation of the initial database - the «answers« loop <br/>    </em><strong class="lx hj">#<em class="jt"> </em></strong><em class="jt">is embedded into the «polls« loop:<br/>    </em><strong class="lx hj">for </strong>sample_poll <strong class="lx hj">in </strong>samples_polls:<br/>        poll_obj = poll_obj_model.get_clone() <strong class="lx hj"># </strong><em class="jt">temp object for poll<br/>        </em><strong class="lx hj">#</strong> <em class="jt">attributes value are saved:<br/>        </em>poll_obj.fields["poll_text"] = sample_poll["text"]<br/>        poll_obj.fields["poll_pub_date"]=<br/>            datetime.datetime.now().strftime("%d.%m.%y %H:%M")<br/>        poll_obj.fields["poll_status"] = <strong class="lx hj">b</strong>"\x01"<br/>             <strong class="lx hj">#</strong> non-zero byte as a sign of poll activity<br/>        poll_obj.save() <strong class="lx hj">#</strong> saved in a new row (after the last)<br/>        n = 1<br/>        answers = ()    <strong class="lx hj">#</strong> temporary tuple of objects with answers<br/>        <strong class="lx hj">for </strong>sample_choice<strong class="lx hj"> in</strong> sample_poll["choices"]:<br/>            answer_obj = answer_obj_model.get_clone()<br/>                <strong class="lx hj"># </strong>temporary object for answer<br/>            <strong class="lx hj"># </strong>attributes value are saved:<br/>            answer_obj.fields["answer_text"] = sample_choice<br/>            answer_obj.fields["answer_number"] = n<br/>            answer_obj.save()  <strong class="lx hj"># </strong>the object is saved in a new row<br/>                               <strong class="lx hj">#</strong> (after the last)<br/>            answers += (answer_obj,) <br/>                <strong class="lx hj">#</strong> tuple of objects with answers is complemented<br/>            n += 1<br/>        <strong class="lx hj"># </strong>write tuples with links the answers into the poll row<br/>        poll_obj.link("poll_answers", answers)</span></pre><p id="d413" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">一个函数的例子</strong> get_queryset <strong class="iz hj">创建一个带有轮询的对象列表(queryset用于基于类的视图)</strong></p><pre class="jw jx jy jz fd me lx mf mg aw mh bi"><span id="b534" class="kl km hi lx b fi mi mj l mk ml"><strong class="lx hj">def</strong> get_queryset(self):<br/>    poll_obj = Obj_RAM(        <strong class="lx hj">#</strong> <em class="jt">temporary object for poll</em><br/>        polls,<br/>        only_fields={"poll_pub_date", "poll_text"},<br/>            <strong class="lx hj"># </strong><em class="jt">only with the necessary attributes</em><br/>    )<br/>    queryset = poll_obj.get_from_table(<br/>        <strong class="lx hj">#</strong> selection from polls of all "active" polls<br/>        with_fields={"poll_status": b"\x01"}<br/>            <strong class="lx hj">#</strong> <em class="jt">with_field "poll_status" filtering</em><br/>            <strong class="lx hj"># </strong><em class="jt">filter is a dictionary, where the keys are</em><br/>            <strong class="lx hj"># </strong><em class="jt">attribute names, and the values </em><br/>            <strong class="lx hj">#</strong> <em class="jt">are the selection conditions<br/>    </em>)<br/>    <strong class="lx hj">return</strong> queryset</span></pre><p id="d299" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">一个函数的例子</strong> get_queryset <strong class="iz hj">形成一个带有轮询答案的对象列表</strong></p><pre class="jw jx jy jz fd me lx mf mg aw mh bi"><span id="bc08" class="kl km hi lx b fi mi mj l mk ml"><strong class="lx hj">def </strong>get_queryset(self):<br/>    answer_obj = Obj_RAM(answers,<br/>        only_fields={"answer_text", "answer_number"}<br/>    )<br/>    poll_obj = Obj_RAM(only_fields={"poll_head"})<br/>    poll = poll_obj.get_from_table(<br/>        <strong class="lx hj">#</strong><em class="jt"> method get_from_table here is used to display <br/>        </em><strong class="lx hj">#<em class="jt"> </em></strong><em class="jt">only one row of the desired poll by its physical number        <br/>        </em><strong class="lx hj">#<em class="jt"> </em></strong><em class="jt">passed via "pk" argument from Django URL</em><br/>        int(self.kwargs["pk"])<br/>    )<br/>    <strong class="lx hj">if</strong> poll == []:<br/>        <strong class="lx hj">return</strong> []<br/>    poll = poll[0]<br/>    queryset = poll.ref(  <strong class="lx hj">#</strong> <em class="jt">get objects through the links from RTA<br/>                          </em><strong class="lx hj">#</strong><em class="jt"> ‘poll_answers’</em><br/>        "poll_answers",<br/>        only_fields={"answer_text", "answer_number"},<br/>            <strong class="lx hj">#</strong> <em class="jt">only with the necessary attributes</em><br/>    )<br/>    <strong class="lx hj">return </strong>queryset</span></pre><p id="9281" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">一个函数的例子</strong> get_queryset <strong class="iz hj">用投票结果创建一个对象列表</strong></p><pre class="jw jx jy jz fd me lx mf mg aw mh bi"><span id="5425" class="kl km hi lx b fi mi mj l mk ml"><strong class="lx hj">def </strong>get_queryset(self):<br/>    answer_obj = Obj_RAM(<br/>        answers,<br/>        only_fields={"answer_text", "answer_number"}<br/>    )<br/>    poll_obj = Obj_RAM(polls, only_fields={"poll_head"})<br/>    poll = poll_obj.get_from_table(<strong class="lx hj">int</strong>(self.kwargs["pk"]))[0]<br/>    queryset = poll.ref(<br/>        "poll_answers",<br/>        only_fields={<br/>            "answer_text", <br/>            "answer_number", <br/>            "answer_votes"<br/>        },<br/>        ref_class=Answers,<br/>    )<br/>    <strong class="lx hj">#</strong> <em class="jt">calculation of the sum of all votes cast for the poll:<br/>    </em>votes = 0<br/>    <strong class="lx hj">for </strong>choice<strong class="lx hj"> in</strong> queryset:<br/>        votes += (choice.fields["answer_votes"]<br/>            <strong class="lx hj">if</strong> choice.fields["answer_votes"] != None<br/>            <strong class="lx hj">else</strong> 0<br/>        )</span><span id="20e0" class="kl km hi lx b fi mm mj l mk ml"><strong class="lx hj">    # </strong><em class="jt">calculation of the percentage of votes for answers in percent:<br/>    </em><strong class="lx hj">for </strong>choice <strong class="lx hj">in </strong>queryset:<br/>        choice.percent = <strong class="lx hj">str</strong>(<br/>            choice.fields["answer_votes"]/<strong class="lx hj">float</strong>(votes)*100<br/>            <strong class="lx hj">if </strong>choice.fields["answer_votes"] != <strong class="lx hj">None</strong> <strong class="lx hj">and </strong>votes &gt; 0<br/>            <strong class="lx hj">else</strong> 0<br/>        )[:5]                <strong class="lx hj">#</strong> <em class="jt">show no more than 3 decimal places</em></span><span id="11a5" class="kl km hi lx b fi mm mj l mk ml"><strong class="lx hj">    return</strong> queryset</span></pre><p id="4a11" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">用于将投票结果保存在数据库中的函数</strong> vote <strong class="iz hj">的示例(通过Django投票表单中的URL调用)</strong></p><pre class="jw jx jy jz fd me lx mf mg aw mh bi"><span id="0c97" class="kl km hi lx b fi mi mj l mk ml"><strong class="lx hj">def</strong> vote(request, poll_id):<br/>    <strong class="lx hj">from</strong> config <strong class="lx hj">import</strong>  my_db, users, polls, answers, comments<br/>    poll_obj = Obj_RAM( polls, only_fields={"poll_text"})<br/>    poll = poll_obj.get_from_table(rows=<strong class="lx hj">int</strong>(poll_id))[0]<br/>    answer_obj = Obj_RAM(answers, only_fields={"answer_votes"})<br/>    <strong class="lx hj">try</strong>:<br/>        selected_choice = answer_obj.get_from_table( <br/>            <strong class="lx hj">#</strong> <em class="jt">the number (id) of the user selected answer<br/>        </em>rows=<strong class="lx hj">int</strong>(request.POST["choice"])<br/>            <strong class="lx hj">#</strong> is retrieved from the Django form<br/>        )[0]<br/>    <strong class="lx hj">except</strong> (KeyError):<br/>        <strong class="lx hj">#</strong> <em class="jt">if the user has not made a choice<br/>        </em><strong class="lx hj">#</strong> <em class="jt">(i.e., the choice field in the form is not defined)<br/>        </em>queryset = poll.ref(<br/>            <strong class="lx hj">#</strong> <em class="jt">poll form with answers is reloaded<br/>            </em>"poll_answers",<br/>            only_fields={"answer_text", "answer_number"},<br/>            ref_class=Answers,<br/>        )                  <br/>        for choice in queryset:<br/>            choice.number = choice.id<br/>            choice.text = choice.fields[ 'answer_text' ]<br/>        <strong class="lx hj">return</strong> render(<br/>            request,<br/>            "….html",<br/>            {<br/>                "poll_text": poll.fields["poll_ text"],<br/>                "poll_id": poll.id, <br/>                    <strong class="lx hj">#</strong> <em class="jt">"id" - an automatically generated attribute</em><br/>                    <strong class="lx hj">#</strong> <em class="jt">of the object with the physical number of</em><br/>                    <strong class="lx hj">#</strong> <em class="jt">the corresponding table row<br/>                </em>"choices": queryset,<br/>                "warning_message": "Please choose one answer",<br/>            }<br/>        )<br/>    <strong class="lx hj">else</strong>:<br/>        <strong class="lx hj">#</strong> <em class="jt">check that the user has already voted on this poll:<br/>        </em>user_obj = Obj_RAM(users, only_fields="user_name")<br/>        user_id = request.session["user_id"]<br/>            <strong class="lx hj">#</strong> <em class="jt">"user_id - the username in the Django Admin </em><br/>            <strong class="lx hj"># </strong><em class="jt">session dictionary<br/>        </em>user = user_obj.get_from_table(user_id)[0]<br/>        all_user_choices = user.ref(<br/>            "user_answers",<br/>            only_fields={"answer_votes"},<br/>            ref_class=Answers<br/>        )<br/>        all_poll_choices = poll.ref(<br/>            "poll_answers",<br/>            only_fields={"answer_number"},<br/>            ref_class=Answers<br/>        )<br/>        <strong class="lx hj">if</strong> all_user_choices != []<strong class="lx hj"> and</strong> all_poll_choices != []:<br/>            all_user_choices_ids = \<br/>                {user_choice.id <strong class="lx hj">for</strong> user_choice <strong class="lx hj">in</strong> all_user_choices}<br/>            all_poll_choices_ids = \<br/>                {poll_choice.id <strong class="lx hj">for</strong> poll_choice <strong class="lx hj">in</strong> all_poll_choices}<br/>            <strong class="lx hj">if</strong> (all_poll_choices_ids <strong class="lx hj">and</strong> \<br/>                all_user_choices_ids) <strong class="lx hj">!=</strong> <strong class="lx hj">set</strong>():<br/>                <strong class="lx hj"># </strong><em class="jt">already voted<br/>                </em><strong class="lx hj">return</strong> render(<br/>                    request,<br/>                    "….html",<br/>                    {<br/>                        "poll_text": poll.fields["poll_ text"],<br/>                        "error_message": "You have already voted !",<br/>                    }<br/>                )</span><span id="d3f2" class="kl km hi lx b fi mm mj l mk ml"><strong class="lx hj">        #</strong> <em class="jt">did not vote - add a link and increase the counter</em>:<br/>        user.link( "user_answers",(selected_choice,))<br/>        <strong class="lx hj">if </strong>selected_choice.fields["answer_votes"] <strong class="lx hj">==</strong> <strong class="lx hj">None</strong>:<br/>            selected_choice.fields["answer_votes"] = 1<br/>        <strong class="lx hj">else</strong>:<br/>            selected_choice.fields["answer_votes"] += 1<br/>        comment_text = request.POST.get("comment")<br/>        <strong class="lx hj">#</strong>  <em class="jt">add comment if available</em><br/>        <strong class="lx hj">if </strong>comment_text <strong class="lx hj">!=</strong> "":<br/>            new_comment = Obj_RAM(comments).get_clone()<br/>            new_comment.fields["comment_text"] = comment_text<br/>            new_comment.save()<br/>            selected_choice.link(<br/>                "answer_comments",<br/>                (new_comment,)<br/>            )<br/>            user.link("user_comments",(new_comment,))<br/>        user.save()<br/>        selected_choice.save()<br/>        <strong class="lx hj">return </strong>HttpResponseRedirect(<br/>            reverse("…", args=(poll_id, selected_choice.id))<br/>        )</span></pre><p id="99c8" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我计划继续撰写关于表格网络数据模型和我的HTMS实现的文章。</p><p id="3d27" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">本文授权文本:<a class="ae ju" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" rel="noopener ugc nofollow" target="_blank"> CC BY-NC-ND 4.0 </a></p><p id="d142" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">所示代码的许可:<a class="ae ju" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener ugc nofollow" target="_blank"> CC BY-NC-SA 4.0 </a></p><h1 id="2ced" class="mn km hi bd kn mo mp mq kr mr ms mt kv io mu ip ky ir mv is lb iu mw iv le mx bi translated">引文</h1><p id="bf12" class="pw-post-body-paragraph ix iy hi iz b ja lg ij jc jd lh im jf jg li ji jj jk lj jm jn jo lk jq jr js hb bi translated">[1]: <em class="jt">笼式系统。</em>T10】github.com/Arselon/Cage</p><p id="05e9" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">HTMS。<a class="ae ju" href="https://github.com/Arselon/HTMS" rel="noopener ugc nofollow" target="_blank">github.com/Arselon/HTMS</a></p><p id="22c9" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">[3]: <em class="jt"> HTMS对象级别</em>。<a class="ae ju" href="https://github.com/Arselon/HTMS/tree/main/htms_obj" rel="noopener ugc nofollow" target="_blank">github.com/Arselon/HTMS/tree/main/htms_obj</a></p><p id="d3ee" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">【4】:<em class="jt">HTMS中层。<a class="ae ju" href="https://github.com/Arselon/HTMS/tree/main/htms_mid" rel="noopener ugc nofollow" target="_blank">github.com/Arselon/HTMS/tree/main/htms_mid</a>T21</em></p><p id="fac7" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">【5】:<em class="jt">HTMS低水平。</em><a class="ae ju" href="https://github.com/Arselon/HTMS/tree/main/htms_low" rel="noopener ugc nofollow" target="_blank">github.com/Arselon/HTMS/tree/main/htms_low</a></p></div></div>    
</body>
</html>