<html>
<head>
<title>How to perform classification in Python with FLAML</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用FLAML在Python中执行分类</h1>
<blockquote>原文：<a href="https://medium.com/codex/how-to-perform-classification-in-python-with-flaml-f2cf7f68ef92?source=collection_archive---------6-----------------------#2022-09-21">https://medium.com/codex/how-to-perform-classification-in-python-with-flaml-f2cf7f68ef92?source=collection_archive---------6-----------------------#2022-09-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="f524" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你做的很多决定都不可避免地与分类联系在一起。例如，午餐吃什么或在哪里使用有限的资源。在这篇文章中，我将展示使用Python和FLAML从头到尾解决一个分类问题的步骤。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/67ca6c13a251bfb083334bf258cf52c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*FMs62-8sfKEkgUEa"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">在<a class="ae jt" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae jt" href="https://unsplash.com/@deonblack?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Deon Black </a>拍摄的照片</figcaption></figure><h1 id="e560" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">问题理解和数据收集</h1><p id="f2a5" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">使用分类有效分配有限资源的方法之一是正确识别您的客户。例如，当你能够识别一个网站访问者是否是潜在客户时，你就可以决定是否为该访问者使用有限的资源来增加收入。在这篇文章中，这是我将试图解决的问题。</p><p id="5f23" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最好是创建我自己的数据集，但是没有所有的工具来收集这样的数据是很难的。所以这一次，我将使用UCI机器学习库中上传的<a class="ae jt" href="https://archive-beta.ics.uci.edu/ml/datasets/online+shoppers+purchasing+intention+dataset#Descriptive" rel="noopener ugc nofollow" target="_blank">网购者购买意向数据集</a>。</p><h1 id="0814" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">数据清理</h1><p id="1569" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">如果我自己收集数据，它不会是一个整洁的表格格式。所以我必须花相当多的时间来清理它。幸运的是，奥莰·萨卡尔提供的数据集已经被清理过了，没有任何缺失值。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kx"><img src="../Images/a69ae3c1e774cf0488fbad600652c6d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oum8wgTfU_lveW_52DCEdA.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">数据集中没有缺失值</figcaption></figure><h1 id="eccd" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">探索性数据分析</h1><p id="4755" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">首先，让我们看看数据的大致情况。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ky"><img src="../Images/2b5719556970402c0d9650634a4f2a15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*asaMAyhey_40Ly_fT9sv8A.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">数据集中随机5行的转置版本</figcaption></figure><p id="e533" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从上面的图像中，列和行被调换，只是为了使它们适合一个图像。请记住，最左边的一列是特性变量和收入的列表，这是目标。最上面一行的数字是从总体中取样的随机观察指数。为了理解每个变量代表什么，我们可以看看UCI ML知识库网站的<a class="ae jt" href="https://archive-beta.ics.uci.edu/ml/datasets/online+shoppers+purchasing+intention+dataset#Descriptive" rel="noopener ugc nofollow" target="_blank">描述</a>。</p><p id="efb3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">目标变量“收入”表示访问者在离开网站前是否购物，真假。</p><p id="2766" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">“管理”、“管理持续时间”、“信息”、“信息持续时间”、“产品相关”和“产品相关持续时间”表示不同类型页面的数量以及访问者在每种类型页面上花费的总时间。如你所见，“管理”、“信息”和“产品相关”是整数，而其余的是浮点数。</p><p id="e3cb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">“跳出率”是在没有触发任何其他请求的情况下进入和离开网站的访问者的百分比。“退出率”是所有页面视图中最后一个页面视图的百分比。“页面价值”是用户在完成电子商务交易之前访问的网页的平均值。“特殊日”表示探访时间与特殊日(如母亲节或情人节)的接近程度，值介于0和1之间(含0和1)。</p><p id="34f5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">其余的特征是具有两个或更多级别的分类特征。</p><p id="d983" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是来自网站的描述与每一列的数据类型不匹配。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kz"><img src="../Images/0653d82860f1e8160ea9bdf629f1de43.png" data-original-src="https://miro.medium.com/v2/resize:fit:908/format:webp/1*kk9VPAxd7Ol89I9g0lPmbQ.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">每列的数据类型</figcaption></figure><h2 id="1b23" class="la jv hi bd jw lb lc ld ka le lf lg ke iq lh li ki iu lj lk km iy ll lm kq ln bi translated">一键编码</h2><p id="8d0a" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">从第11列到第14列，它们应该是categorical而不是int64。因此，我们应该改变这些。有两种可能的方法:标签编码或一键编码。在这种情况下，one-hot编码更合适，因为这些列中的不同类型之间没有数字关系。例如，浏览器类型1不大于浏览器类型2。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lo"><img src="../Images/ee0a9071638a06be0ef4d329de999991.png" data-original-src="https://miro.medium.com/v2/resize:fit:1134/format:webp/1*f736p9deFkqPQvVQH97X9Q.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">转换数据类型和应用一键编码</figcaption></figure><p id="648d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上面代码的一个问题是这4个分类列有很高的基数。这意味着有些值是唯一的，因此数据集中只有少数值存在。因此，当我对所有这些应用一键编码时，它将维度从18增加到75，这很容易导致维度的诅咒。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lp"><img src="../Images/e7ce78ac81053bacf263dbef40fe1b50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZiZ1A5c5-C9m-c5047JGAA.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">显示一些变量具有高基数</figcaption></figure><p id="4bed" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这可以通过对唯一值进行分组或将其从特征选择步骤中移除来解决。由于当我们保留那些特征时，一个模型可能在特征选择期间学习噪声，当某个值不超过总数的3%时，我决定首先将它们分组到“其他”中。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lq"><img src="../Images/f6daa152d506131f94c31326ed39316a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LOfCjZazJjOFKuXsWIwRBg.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">将相对唯一的值分组到其他值中</figcaption></figure><p id="b3e2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于月份变量，有几种方法可供选择。您可以对每个月应用一键编码，按季度对它们进行分组，将每个月转换为数值，或者应用正弦/余弦以便数值形成一个循环。对于这个项目，我对每个月应用了one-hot编码，因为有两个月缺失，所以我不能形成一个循环，并且值不是均匀分布的。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lr"><img src="../Images/0fed120cc9320f68ba20bb54afd28fa6.png" data-original-src="https://miro.medium.com/v2/resize:fit:454/format:webp/1*YJvo8w3MKUhmuyywaPUJuw.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">月份是如何分配的</figcaption></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ls"><img src="../Images/19c42cb2290a4605dd5338c21f3da58f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mBXiypHImzcB53DBlWqC5g.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">对一些值进行分组后应用一键编码的代码</figcaption></figure><h2 id="bfbb" class="la jv hi bd jw lb lc ld ka le lf lg ke iq lh li ki iu lj lk km iy ll lm kq ln bi translated">分割数据集和特征分布</h2><p id="8d56" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">然后，在绘制图表以查看点是如何分布的之前，我将数据集分为训练集和测试集，以便在最终测试模型性能之前，测试集中的信息不会泄漏。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lt"><img src="../Images/4c9f9565745cf7f98a6d25d73ed0e89f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sxQDGBgRv53TK9Wbr6GReQ.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">用于将数据集分成训练、验证、测试数据的代码</figcaption></figure><p id="4b00" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">分割数据集时，分层参数是必要的，因为目标是不平衡的，如下所示。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lo"><img src="../Images/0ab9d3ba4795b684fe64ab923c011c6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1134/format:webp/1*o6fWyezbMFYjruEKJiF9iw.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">目标变量是如何不平衡的</figcaption></figure><p id="1bb3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下一张图是连续变量的分布。</p><div class="je jf jg jh fd ab cb"><figure class="lu ji lv lw lx ly lz paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><img src="../Images/0d720cf7b290535e6d597bd31f9c1499.png" data-original-src="https://miro.medium.com/v2/resize:fit:1132/format:webp/1*oOrziYMzH1tzPBs--Tweig.png"/></div></figure><figure class="lu ji ma lw lx ly lz paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><img src="../Images/cd454377a7968dc98d1230ad23b86726.png" data-original-src="https://miro.medium.com/v2/resize:fit:870/format:webp/1*6ChYUVXIXWnC4yR4kBdv9Q.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx mb di mc md translated">连续变量的分布</figcaption></figure></div><p id="ee07" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正如你从上面的图表中看到的，观察结果极度向右倾斜。记住这一点很重要，因为根据我最终使用的模型，我可能不得不<a class="ae jt" href="https://stackoverflow.com/questions/41609711/does-a-dataset-need-to-be-a-normal-distribution-for-every-parameter" rel="noopener ugc nofollow" target="_blank">转换</a>它以获得更好的收敛性。</p><h2 id="e394" class="la jv hi bd jw lb lc ld ka le lf lg ke iq lh li ki iu lj lk km iy ll lm kq ln bi translated">相关性和多重共线性</h2><p id="ca8d" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">下一个关联。由于数据集既有数字特征又有分类特征，我们需要使用<a class="ae jt" href="https://www.researchgate.net/post/Can_I_use_Pearsons_correlation_coefficient_to_know_the_relation_between_perception_and_gender_age_income" rel="noopener ugc nofollow" target="_blank">几种方法</a>来检查它们之间的相关性。首先，对于数字变量，我使用了皮尔森的相关系数。接近1的值意味着它们是相关的。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es me"><img src="../Images/2b46c3c411dc6be3636f7724fbc4d358.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mCzhWH2lTkfgaC0FymG7Uw.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">皮尔逊相关系数热图</figcaption></figure><p id="782d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于分类变量之间的相关性，我可以使用卡方检验或克莱姆的v。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mf"><img src="../Images/8bf6585137f2cf432f37d9c9ec5ea2ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1wE7_wj1Yw6Fa7nQU9ZKXw.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">卡方检验的热图</figcaption></figure><p id="a37a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这种情况下，因为样本量很大，卡方检验很可能<a class="ae jt" href="https://www.semanticscholar.org/paper/Research-Commentary-Too-Big-to-Fail%3A-Large-Samples-Lin-Lucas/7241c748932deb734fff1681e951e50be0853a39?p2df" rel="noopener ugc nofollow" target="_blank">返回一个低p值</a>，即使是一个很小的差异。如您所见，许多特征组合的p值都低于0.05。因此，使用克莱姆的V是一个更好的主意。对于克莱姆的V，接近1的值意味着强关联。没有硬阈值，因为强关联的含义<a class="ae jt" href="https://www.statology.org/interpret-cramers-v/" rel="noopener ugc nofollow" target="_blank">取决于两个特征之间的较低自由度</a>。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mf"><img src="../Images/ed17acb892b89a71746fcad722441007.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*etGHZBUDzsvsk2y211-UUA.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">克莱姆V的热图</figcaption></figure><p id="f103" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于超过2个级别的数值和分类，使用eta相关性，0表示没有关联，1表示完全关联。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mg"><img src="../Images/494e4a1f78169cdd3eddf85806fbb176.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6XIwlCVbPfl77leN2Tz-SA.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">ETA相关测试的热图</figcaption></figure><p id="d7fc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于正好有两个级别的数字和分类，使用点双列相关。下面的热图是点-双列相关系数的p值。因此，低于0.05的值意味着存在关联。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mh"><img src="../Images/76caa36de620fe18998c4ad02bd84988.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uvz7zLpLwaJLzoC-FALwEw.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">点-双列相关p值的热图</figcaption></figure><p id="e915" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，为了检查多重共线性，我对数字特征使用了方差膨胀因子。就像其他指标一样，没有硬门槛。有人说是3。但也有人建议5或10。所以看你的选择了。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lo"><img src="../Images/571c6f872c5c9b46f369f6c3d8f33913.png" data-original-src="https://miro.medium.com/v2/resize:fit:1134/format:webp/1*cbaZLP6EbNutAgT7WqkZAQ.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">数值变量的VIF</figcaption></figure><h1 id="5115" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">型号选择</h1><p id="a663" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">对于模型选择，我运行FLAML来自动找出哪个模型更适合。FLAML用于分类的估计量列表可以大致分为两种类型:树模型和逻辑模型。</p><p id="0430" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于树和逻辑模型，正态分布不是一个假设。但是，在使用逻辑模型之前，还需要检查其他假设。值得一提的是，没有多重共线性，没有极端异常值，并且样本量足够大。关于这些的更多信息可以在找到<a class="ae jt" href="https://www.statology.org/assumptions-of-logistic-regression/" rel="noopener ugc nofollow" target="_blank">。</a></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mi"><img src="../Images/dd07d9845aa5f0b422f215028469ae56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f1Z-TLE_dCEjBHIjqVz7mA.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">连续变量的箱线图</figcaption></figure><p id="30e1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如您所见，异常值非常多，将其转换为平均值或中值等其他值是不合适的，因为异常值几乎是某些要素的整个可能值范围。即使是经过对数变换的数据也是如此。</p><div class="je jf jg jh fd ab cb"><figure class="lu ji mj lw lx ly lz paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><img src="../Images/4bd2e2c1ec31d1fcb68e425fbcb6bcd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1012/format:webp/1*PwOVOJReTvF24cLfQhdwCQ.png"/></div></figure><figure class="lu ji mk lw lx ly lz paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><img src="../Images/7ed889192117f2a56801d76db0ab450a.png" data-original-src="https://miro.medium.com/v2/resize:fit:990/format:webp/1*e4Pv0MQNZiMw3eoIUPr_AQ.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx ml di mm md translated">对数变换后连续变量的直方图和箱线图</figcaption></figure></div><p id="15a3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，我决定在这个项目中使用基于决策树的模型。我没有包括Light GBM，因为我没有足够的观察数据来使用Light GBM。没有硬性阈值，但建议超过10，000行。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mn"><img src="../Images/8dc839b4fd96d57166e1e85dd526dd6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9ZoQVTzO3HhJYWJSSuDDSw.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">型号选择的初始代码</figcaption></figure><p id="f4fe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因为不想让自己的模型过拟合，所以添加了带有X_val和y_val的eval_method= "holdout "，retrain_full=False，early_stop=True。为了处理不平衡的目标变量，我为每个模型添加了“weight”或“balanced”以及metric="macro_f1 "。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lr"><img src="../Images/324dd42864d36f9c055935a81e355da5.png" data-original-src="https://miro.medium.com/v2/resize:fit:454/format:webp/1*iJH0MsbVPwaCW4F-vB0AXQ.png"/></div></figure><p id="79c7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过运行上面的代码，结果证明xgb_limitdepth效果最好。所以我决定深入研究这个模型。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mo"><img src="../Images/40948298545110ce8728113add28be59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1124/format:webp/1*sHOa-oO0x21qQW3ZglUCeA.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">每个型号的f1宏分数</figcaption></figure><p id="a7d7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在继续之前，xgb_limitdepth是“xgboost”的一个子类，具有有限的深度以避免过度拟合。这个描述可以在FLAML软件开发工具包中找到。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mp"><img src="../Images/8f7aa421ade156c74dd6676bbbb875d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YjRCMhXAMu0u6p64P-FilA.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">来自<a class="ae jt" href="https://microsoft.github.io/FLAML/docs/reference/model/" rel="noopener ugc nofollow" target="_blank"> FLAML SDK </a>的截图</figcaption></figure><h1 id="d702" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">处理过度拟合</h1><p id="b742" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">即使我试图通过设置一些参数来处理过度拟合，这还不够。如下所示，模型在验证数据上的表现比在训练数据上的表现差得多。</p><div class="je jf jg jh fd ab cb"><figure class="lu ji mq lw lx ly lz paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><img src="../Images/49b28224fce0c6f028e0621b0dc41383.png" data-original-src="https://miro.medium.com/v2/resize:fit:988/format:webp/1*nL8tCArYgGL2sWcmxbnHxw.png"/></div></figure><figure class="lu ji mr lw lx ly lz paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><img src="../Images/4464cce79117caec70a39536f02a485d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1014/format:webp/1*EFajJX9jkrFtmHuFT0vncw.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx ms di mt md translated">用于验证和训练以显示过度拟合的混淆矩阵</figcaption></figure></div><p id="515a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，我需要采取进一步的行动来消除模型中的过度拟合。我尝试了几种方法，有效的方法是使用交叉验证递归特征消除(RFECV)选择特征，并使用XGBClassifier中的子样本参数增加一些随机性。</p><h2 id="2352" class="la jv hi bd jw lb lc ld ka le lf lg ke iq lh li ki iu lj lk km iy ll lm kq ln bi translated">使用RFECV选择功能</h2><p id="ad6f" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">即使特征选择被<a class="ae jt" href="https://towardsdatascience.com/why-how-and-when-to-apply-feature-selection-e9c69adfabf2" rel="noopener" target="_blank">嵌入到</a>决策树模型中，也不足以阻止模型学习数据中的噪声。所以我决定使用一种包装方法RFECV来选择将哪些特性输入到模型中。顾名思义，它递归地删除性能最差的特性。例如，当有4个特性a、b、c、d，并且c是性能最差的特性时，RFECV将在第一轮后返回a、b、d。</p><p id="4b0b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我的例子中，运行一次RFECV是不够的。模型仍然过拟合。所以我运行了RFECV，直到没有更多的特性被再次运行RFECV所消除，这是3次。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mu"><img src="../Images/c46fab0ca250fe5ad1f25962d435246e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YQ8N6j_9xaq0g6Mq2AWwDg.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mv"><img src="../Images/347ca85939c53ddcad3a37a229be8c06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wvZus-XqoJaEhCXZvCbs-w.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mw"><img src="../Images/9a51cf5fba9d7f86d64e784e093bf5d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H5XzqJZwJ0hbGOzABjwGiA.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">运行RFECV 3次(直到运行RFECV后不再有功能被删除)</figcaption></figure><h2 id="079a" class="la jv hi bd jw lb lc ld ka le lf lg ke iq lh li ki iu lj lk km iy ll lm kq ln bi translated">子样品</h2><p id="7e53" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">模型中的子样本参数限制了模型在训练时可以使用的训练数据的比例。在我的例子中，我将其设置为0.7。因此，模型中的树在拟合时只能使用70%的训练数据。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kz"><img src="../Images/1e442cb550b3c442428394a5d4188cf5.png" data-original-src="https://miro.medium.com/v2/resize:fit:908/format:webp/1*tu6898Krlcd_IEWyRs2Z1w.png"/></div></figure><p id="67d7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">可以用来避免过度拟合的其他参数有max_depth、min_child_weight、gamma和colsample_bytree，如XGBoost <a class="ae jt" href="https://xgboost.readthedocs.io/en/stable/tutorials/param_tuning.html" rel="noopener ugc nofollow" target="_blank">文档</a>中所示。</p><p id="dc79" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在应用这些之后，验证和训练数据之间的f1宏观差异不太严重。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mx"><img src="../Images/e4424d54d66d4641f46bc0264a413751.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D8h4WACJZ3JXL5gBi6oypA.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">运行RFECV 3次后运行FLAML</figcaption></figure><h1 id="5d3f" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">没有成功的事情</h1><h2 id="a12b" class="la jv hi bd jw lb lc ld ka le lf lg ke iq lh li ki iu lj lk km iy ll lm kq ln bi translated">重击</h2><p id="5de1" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">处理不平衡数据的另一种方法是过采样。其中一种方法是使用SMOTE包，该包利用KNN算法为少数类创建合成数据。但是在这种情况下，使用scale_pos_weight为minority类赋予更高的权重比过采样效果更好。</p><h2 id="068b" class="la jv hi bd jw lb lc ld ka le lf lg ke iq lh li ki iu lj lk km iy ll lm kq ln bi translated">全体</h2><p id="dd38" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">为了提高模型性能，我尝试使用软投票和硬投票来组合几个不同的模型。我还尝试在FLAML中使用系综参数。但是对于这两种方法，它只会降低性能。</p><h2 id="d62a" class="la jv hi bd jw lb lc ld ka le lf lg ke iq lh li ki iu lj lk km iy ll lm kq ln bi translated">其他模型的特征选择</h2><p id="8434" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">在对每个模型应用特性选择之后，为了防止其他模型可能比xgb_limitdepth工作得更好，我对其他树模型尝试了相同的过程。但是xgb_limitdepth仍然比其他的稍微好一点。</p><h1 id="ab53" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">模型评估和结论</h1><p id="9c85" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">FLAML的一个有用特性是，当您设置log_file_name参数时，它会保存其训练历史。通过这个日志文件，您可以看到评估指标是如何随着时间的推移而改进的，以及FLAML是如何调整超参数的。例如，下图显示了f1宏观分数在训练过程中的变化。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es my"><img src="../Images/1f01c2a4cd3c2dc9ef63acc9ae660228.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tmxm3AcGHKMSWjQafaj7WQ.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">f1宏分数在验证数据中如何变化</figcaption></figure><p id="11ae" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有了这个模型，我能够对测试数据进行分类，而与验证数据没有太大的差异。正如下面的混淆矩阵所示，该模型正确识别了大约78%的购物访客，但大约42.58%的积极标签访客被错误识别。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lo"><img src="../Images/8e4009c5126179401b412c9181cd46cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1134/format:webp/1*Lls8qGTbO9PL5bOjL3VtUg.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">模型如何处理测试数据</figcaption></figure><p id="e7b6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于默认的predict()，区分假(0)和真(1)的阈值是0.5。但是在很多情况下，第一类和第二类错误的代价是不一样的。在这种情况下，第1类错误是假阳性，从上面的输出来看是221，这意味着我将访问者分类为那些没有购物的人。因此，犯这种错误的代价将是浪费有限的资源或增加不满。</p><p id="08ce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">另一方面，第二类错误是假阴性，与上面的输出相比是84。所以这个错误的代价是收入的减少，因为模型不能识别购物的访问者。</p><p id="94ab" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，犯一个第一类错误和犯一个第二类错误是不同的。根据什么和多少是可接受的，您可以根据需要更改阈值。例如，如果第二类错误比第一类错误花费更多，我可以降低阈值，这样模型就可以分类更多的积极因素，如下所示。以0.47为阈值，我能够将13个以上的真阳性与18个以上的假阳性分类为其成本。</p><div class="je jf jg jh fd ab cb"><figure class="lu ji mz lw lx ly lz paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><img src="../Images/8198d1a8e6bb30f2a8148911ca7aa37b.png" data-original-src="https://miro.medium.com/v2/resize:fit:998/format:webp/1*aqMDvNxx2lAkGNeQkmeR2A.png"/></div></figure><figure class="lu ji na lw lx ly lz paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><img src="../Images/026e866a823030e30977c81482b4b420.png" data-original-src="https://miro.medium.com/v2/resize:fit:1004/format:webp/1*AGM5T6t3_cgO5KfXOh4ssA.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx nb di nc md translated">由于类型1和类型2错误之间的成本差异，应用不同的阈值</figcaption></figure></div></div><div class="ab cl nd ne gp nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="hb hc hd he hf"><h1 id="931c" class="ju jv hi bd jw jx nk jz ka kb nl kd ke kf nm kh ki kj nn kl km kn no kp kq kr bi translated">参考</h1><p id="3491" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">[1]<a class="ae jt" href="https://archive-beta.ics.uci.edu/ml/datasets/online+shoppers+purchasing+intention+dataset#Descriptive" rel="noopener ugc nofollow" target="_blank">https://archive-beta . ics . UCI . edu/ml/datasets/online+购物者+购买+意向+数据集#Descriptive </a></p><p id="c95d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">[2]<a class="ae jt" href="https://www.researchgate.net/post/Can_I_use_Pearsons_correlation_coefficient_to_know_the_relation_between_perception_and_gender_age_income" rel="noopener ugc nofollow" target="_blank">https://www . research gate . net/post/Can _ I _ use _ Pearsons _ correlation _ coefficient _ to _ know _ the _ relation _ between _ perception _ and _ gender _ age _ income</a></p><p id="7e2c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">[3]<a class="ae jt" href="https://www.semanticscholar.org/paper/Research-Commentary-Too-Big-to-Fail%3A-Large-Samples-Lin-Lucas/7241c748932deb734fff1681e951e50be0853a39?p2df" rel="noopener ugc nofollow" target="_blank">https://www . semantic scholar . org/paper/Research-Commentary-Too-Big-to-Fail % 3A-Large-Samples-Lin-Lucas/7241 c 748932 deb 734 fff 1681 e 951 e 50 be 0853 a 39？p2df </a></p><p id="a479" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jt" href="https://www.statology.org/interpret-cramers-v/" rel="noopener ugc nofollow" target="_blank">https://www.statology.org/interpret-cramers-v/</a></p><p id="c1aa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">[5]<a class="ae jt" href="http://onlinehelp.ihs.com/Energy/AnalyticsExplorer/AE_6.0/Webhelp/content/analyticsexplorer/VIF.htm" rel="noopener ugc nofollow" target="_blank">http://online help . IHS . com/Energy/AnalyticsExplorer/AE _ 6.0/web help/content/AnalyticsExplorer/Vif . htm</a></p><p id="bce6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">[6]<a class="ae jt" href="https://www.statology.org/assumptions-of-logistic-regression/" rel="noopener ugc nofollow" target="_blank">https://www . statology . org/assumptions-of-logistic-regression/</a></p><p id="68d6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">[7]<a class="ae jt" href="https://towardsdatascience.com/why-how-and-when-to-apply-feature-selection-e9c69adfabf2" rel="noopener" target="_blank">https://towards data science . com/why-how-and-when-to-apply-feature-selection-e 9c 69 adfabf 2</a></p><p id="fd8b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">[8]<a class="ae jt" href="https://xgboost.readthedocs.io/en/stable/tutorials/param_tuning.html" rel="noopener ugc nofollow" target="_blank">https://xgboost . readthedocs . io/en/stable/tutorials/param _ tuning . html</a></p></div></div>    
</body>
</html>