<html>
<head>
<title>Android: (Part1) Introduction to Coroutines</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Android:(第一部分)协程简介</h1>
<blockquote>原文：<a href="https://medium.com/codex/android-part1-introduction-to-coroutines-eb36e06fb5d9?source=collection_archive---------9-----------------------#2022-04-03">https://medium.com/codex/android-part1-introduction-to-coroutines-eb36e06fb5d9?source=collection_archive---------9-----------------------#2022-04-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/065387860b24fea7b8d638bd20212139.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xUP0WfHEAo0h0QqCUC5XUg.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">来源:谷歌图片</figcaption></figure><p id="f1ca" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi js translated">一个ndroid有许多异步编程技术，但是选择最好的一个可能很棘手。有些系统的学习曲线很陡。其他的需要大量的样板代码，并且不是很简洁。所有这些都会对你的应用程序的可伸缩性产生影响，并增加新开发者的认知负担。如果您使用的API易于使用，并且可以根据需要进行扩展，这是最理想的。</p><p id="e703" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">因为在JVM上运行的所有系统都面临同样的问题，JetBrains团队设计了一个新的API。它的目标是帮助你解决所有这些问题，而不需要很高的学习曲线。——<strong class="iw hj">科特林花冠</strong>。</p><p id="50aa" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">本系列包括以下文章:</strong></p><div class="kb kc ez fb kd ke"><a rel="noopener follow" target="_blank" href="/@vinod.baste/android-part-2-real-work-of-coroutines-881890f5acea"><div class="kf ab dw"><div class="kg ab kh cl cj ki"><h2 class="bd hj fi z dy kj ea eb kk ed ef hh bi translated">Android:(第2部分)协程的实际工作。</h2><div class="kl l"><h3 class="bd b fi z dy kj ea eb kk ed ef dx translated">这是关于使用Android协程的文章的一部分。这里使用了一次性请求来解决实际问题…</h3></div><div class="km l"><p class="bd b fp z dy kj ea eb kk ed ef dx translated">medium.com</p></div></div><div class="kn l"><div class="ko l kp kq kr kn ks io ke"/></div></div></a></div><h1 id="9005" class="kt ku hi bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">为什么应该使用协程？</h1><p id="cbbd" class="pw-post-body-paragraph iu iv hi iw b ix lr iz ja jb ls jd je jf lt jh ji jj lu jl jm jn lv jp jq jr hb bi translated">每个android应用程序都有一组指令，需要花费大量时间来处理数据并将数据绑定到UI，即所谓的长时间运行任务。</p><p id="c9d9" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">所有编写的代码都在主线程上按顺序执行。</p><figure class="lx ly lz ma fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lw"><img src="../Images/4e87f69d09cacac83df74f9c1b51f89d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t0nCtyuCuoLuFWLZ8PTbDw.png"/></div></div></figure><p id="9a93" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">并且通过这样做，指令2 main上的长时间运行的任务冻结应用程序或暂停主线程，直到它完全执行，这导致应用程序的不良行为。</p><p id="07dc" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">但是协程程序让它变得超级简单。它将长时间运行的任务放在主线程的顶部，即模仿主线程，并且在不冻结或暂停主线程或其他指令序列的情况下执行。</p></div><div class="ab cl mb mc gp md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="hb hc hd he hf"><p id="94a5" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在此过程中，您还会发现以下内容:</p><ul class=""><li id="b633" class="mi mj hi iw b ix iy jb jc jf mk jj ml jn mm jr mn mo mp mq bi translated">Kotlin协程的内部工作方式。</li><li id="9474" class="mi mj hi iw b ix mr jb ms jf mt jj mu jn mv jr mn mo mp mq bi translated">了解如何构建自己的协程。</li><li id="1121" class="mi mj hi iw b ix mr jb ms jf mt jj mu jn mv jr mn mo mp mq bi translated">如何使用协程来处理异常。</li></ul><h1 id="7102" class="kt ku hi bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated"><strong class="ak">要定义协程，我们需要理解:</strong></h1><p id="f7f5" class="pw-post-body-paragraph iu iv hi iw b ix lr iz ja jb ls jd je jf lt jh ji jj lu jl jm jn lv jp jq jr hb bi translated">在我们开始实现和使用协程之前，理解某些关键点是至关重要的。</p><h1 id="879c" class="kt ku hi bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated"><strong class="ak"> <em class="mw">协程作用域</em> </strong></h1><p id="df89" class="pw-post-body-paragraph iu iv hi iw b ix lr iz ja jb ls jd je jf lt jh ji jj lu jl jm jn lv jp jq jr hb bi translated">协程作用域跟踪它用launch或async builder函数生成的任何协程。它让您可以随时取消协程。范围仅限于单个生命周期。如果协程没有任何作用域，它就不能启动。当出现故障时，会向CoroutineScope发出警报。</p><p id="51ff" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">Android的KTX库包括一个与生命周期类相关的协同作用域，如viewModelScope和lifecycle scope。</p><h1 id="1f0f" class="kt ku hi bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated"><strong class="ak"> <em class="mw">协程上下文</em> </strong></h1><p id="7beb" class="pw-post-body-paragraph iu iv hi iw b ix lr iz ja jb ls jd je jf lt jh ji jj lu jl jm jn lv jp jq jr hb bi translated">它<strong class="iw hj"> </strong>包含一个协程调度器，它选择适当的协程在哪个(哪些)线程上执行。</p><p id="cdbb" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">以下部分组成了一个协程上下文，它决定了协程的行为:</p><ul class=""><li id="b59e" class="mi mj hi iw b ix iy jb jc jf mk jj ml jn mm jr mn mo mp mq bi translated">工作:管理协程的生命周期。</li><li id="e047" class="mi mj hi iw b ix mr jb ms jf mt jj mu jn mv jr mn mo mp mq bi translated"><strong class="iw hj"> CoroutineDispatcher: </strong>使用CoroutineDispatcher将工作分派给适当的线程。</li><li id="b7c9" class="mi mj hi iw b ix mr jb ms jf mt jj mu jn mv jr mn mo mp mq bi translated"><strong class="iw hj">协程名:</strong>协程名对于调试很有用。</li><li id="dccd" class="mi mj hi iw b ix mr jb ms jf mt jj mu jn mv jr mn mo mp mq bi translated"><strong class="iw hj">CoroutineExceptionHandler:</strong>未捕获的异常由CoroutineExceptionHandler处理。</li></ul><h1 id="8dc1" class="kt ku hi bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated"><em class="mw">调度员</em></h1><p id="78cc" class="pw-post-body-paragraph iu iv hi iw b ix lr iz ja jb ls jd je jf lt jh ji jj lu jl jm jn lv jp jq jr hb bi translated">调度程序是定义执行协程的线程的一种方式。</p><p id="d199" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">一些预定义的调度程序包括:</p><ul class=""><li id="9525" class="mi mj hi iw b ix iy jb jc jf mk jj ml jn mm jr mn mo mp mq bi translated"><strong class="iw hj">调度员。IO: </strong>将阻塞IO任务卸载到线程和网络操作的共享池是协程调度程序的目标。按需创建和关闭该池中的更多线程。</li><li id="4517" class="mi mj hi iw b ix mr jb ms jf mt jj mu jn mv jr mn mo mp mq bi translated"><strong class="iw hj">调度员。Main: </strong>一个协同程序调度器，它处理UI项，并且仅限于主线程。您可以直接或通过MainScope工厂使用此调度程序。通常，使用单线程调度程序。<br/>如果类路径中没有可用的主线程调度程序，访问该属性可能会导致IllegalStateException。</li><li id="f8bb" class="mi mj hi iw b ix mr jb ms jf mt jj mu jn mv jr mn mo mp mq bi translated"><strong class="iw hj">调度员。Default: </strong>如果在其上下文中没有给定Dispatcher或其他ContinuationInterceptor，则所有协同例程构造函数(如launch、async等)都会使用默认的协同例程dispatcher。它是为脱离主线程的CPU繁重任务而设计的。</li></ul><h1 id="0dc7" class="kt ku hi bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">暂停</h1><p id="9d13" class="pw-post-body-paragraph iu iv hi iw b ix lr iz ja jb ls jd je jf lt jh ji jj lu jl jm jn lv jp jq jr hb bi translated">暂停只不过是一个术语。挂起功能就是:一个可以被中断并在以后恢复的功能。我们可以执行长时间运行的流程，等待它们完成，而不必阻塞。挂起函数使用与传统函数相同的语法，但是增加了suspend关键字。</p><pre class="lx ly lz ma fd mx my mz na aw nb bi"><span id="5b91" class="nc ku hi my b fi nd ne l nf ng">suspend fun functionName<em class="nh">() {<br/>}</em></span></pre><blockquote class="ni nj nk"><p id="3782" class="iu iv nh iw b ix iy iz ja jb jc jd je nl jg jh ji nm jk jl jm nn jo jp jq jr hb bi translated"><strong class="iw hj"> <em class="hi">注</em> </strong> <em class="hi"> : </em>挂起应该只从一个<strong class="iw hj">协程</strong>或<strong class="iw hj">另一个挂起</strong> <strong class="iw hj">函数</strong>中调用，根据一个基本要求。</p></blockquote><h1 id="9bd6" class="kt ku hi bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated"><strong class="ak">工作</strong></h1><p id="98aa" class="pw-post-body-paragraph iu iv hi iw b ix lr iz ja jb ls jd je jf lt jh ji jj lu jl jm jn lv jp jq jr hb bi translated">任务是一个可终止的项目，其生命周期随着任务的完成而结束。启动协程生成器用于创建协程作业。它执行定义的代码块，并在完成时退出。</p><p id="4586" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">以下是作业界面提供的许多功能中的一部分:</p><ul class=""><li id="f7ae" class="mi mj hi iw b ix iy jb jc jf mk jj ml jn mm jr mn mo mp mq bi translated">join() :函数是一个挂起函数，这意味着它可以从另一个挂起函数或协程中调用。作业挂起所有线程，直到编写它的协程或编写它的上下文完成它的任务。只有当协程完成后，join()方法后面的行才会被执行。</li><li id="2e03" class="mi mj hi iw b ix mr jb ms jf mt jj mu jn mv jr mn mo mp mq bi translated"><strong class="iw hj"> cancel(): </strong>方法用于终止协程，而不必等待它完成任务。它与join方法类似，join()方法在阻塞所有其他线程之前等待协程完成其整个任务，而cancel()函数在检测到协程时会将其杀死或停止。让我们看一个展示cancel()函数如何工作的例子。</li><li id="9494" class="mi mj hi iw b ix mr jb ms jf mt jj mu jn mv jr mn mo mp mq bi translated"><strong class="iw hj"> withTimeOut(): </strong>当指定的时间过去后，协程将自动取消，不再执行进一步的计算，withTimeOut()可以对此有所帮助。</li></ul></div><div class="ab cl mb mc gp md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="hb hc hd he hf"><h1 id="e5fc" class="kt ku hi bd kv kw no ky kz la np lc ld le nq lg lh li nr lk ll lm ns lo lp lq bi translated">参考</h1><ul class=""><li id="2175" class="mi mj hi iw b ix lr jb ls jf nt jj nu jn nv jr mn mo mp mq bi translated"><a class="ae nw" href="https://developer.android.com/kotlin/coroutines?gclid=CjwKCAjwi6WSBhA-EiwA6Niok2lmU1xNMY8CxzZbHEY_wCNlsMHcjBUjzGamubkxndEXK33W61cZ9xoCTrIQAvD_BwE&amp;gclsrc=aw.ds" rel="noopener ugc nofollow" target="_blank">T5【科特林】安卓T7】</a></li><li id="78f9" class="mi mj hi iw b ix mr jb ms jf mt jj mu jn mv jr mn mo mp mq bi translated"><a class="ae nw" href="https://kotlinlang.org/docs/coroutines-basics.html" rel="noopener ugc nofollow" target="_blank"> <strong class="iw hj">协程基础知识</strong> </a></li><li id="dc91" class="mi mj hi iw b ix mr jb ms jf mt jj mu jn mv jr mn mo mp mq bi translated"><a class="ae nw" href="https://kotlinlang.org/docs/coroutines-overview.html" rel="noopener ugc nofollow" target="_blank"> <strong class="iw hj">协程</strong> </a></li></ul></div><div class="ab cl mb mc gp md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="hb hc hd he hf"><p id="be6c" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">您可能还想查看我的<a class="ae nw" rel="noopener" href="/@vinod.baste/android-part-2-real-work-of-coroutines-881890f5acea">(第2部分)协程的真实作品</a>，它已经在medium中发布。它带来了对Kotlin协程实现的更深入的了解。</p><div class="kb kc ez fb kd ke"><a rel="noopener follow" target="_blank" href="/@vinod.baste/android-part-2-real-work-of-coroutines-881890f5acea"><div class="kf ab dw"><div class="kg ab kh cl cj ki"><h2 class="bd hj fi z dy kj ea eb kk ed ef hh bi translated">Android:(第2部分)协程的实际工作。</h2><div class="kl l"><h3 class="bd b fi z dy kj ea eb kk ed ef dx translated">这是关于使用Android协程的文章的一部分。这里使用了一次性请求来解决实际问题…</h3></div><div class="km l"><p class="bd b fp z dy kj ea eb kk ed ef dx translated">medium.com</p></div></div><div class="kn l"><div class="ko l kp kq kr kn ks io ke"/></div></div></a></div></div><div class="ab cl mb mc gp md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="hb hc hd he hf"><p id="cd90" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><em class="nh">感谢您花时间阅读本文。如果你觉得这个帖子有用又有趣，请鼓掌推荐。</em></p><p id="298e" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果你做错了什么？请在评论中提及。我很想进步。</p></div></div>    
</body>
</html>