<html>
<head>
<title>Sidekiq Tutorial &amp; Overview: Is Sidekiq For Ruby Still Worth Working With After 10 Years?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Sidekiq教程&amp;概述:10年后，Sidekiq For Ruby还值得合作吗？</h1>
<blockquote>原文：<a href="https://medium.com/codex/sidekiq-tutorial-overview-is-sidekiq-for-ruby-still-worth-working-with-after-10-years-8b3daf524962?source=collection_archive---------2-----------------------#2022-02-08">https://medium.com/codex/sidekiq-tutorial-overview-is-sidekiq-for-ruby-still-worth-working-with-after-10-years-8b3daf524962?source=collection_archive---------2-----------------------#2022-02-08</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="0c6b" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">夏洛克·福尔摩斯需要华生医生。Ruby编程需要Sidekiq。还是Delayed_job，还是Resque？</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/3f1243b90494219c4f7d96cdb9a55233.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Mn6sxtcBdfjRrd6iTFNjVQ.png"/></div></div></figure><p id="96ed" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">有时我们的客户对我们使用什么技术来构建他们的web应用程序项目感兴趣。我们很乐意分享，尽管向人们讲授技术并不容易，也不容易成为一个令人厌烦的人。所以，做好准备，一年的时间又到了。</p><p id="9555" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">都是因为Sidekiq，可能是Ruby最常见的后台作业系统，刚满<a class="ae kf" href="https://www.mikeperham.com/2022/01/17/happy-10th-birthday-sidekiq/" rel="noopener ugc nofollow" target="_blank"> 10岁</a>！这个概述对于那些刚开始使用Ruby on Rails编程的人，以及那些对他们的技术堆栈很挑剔的人来说是很有用的。我们提供了关于如何启动Sidekiq、调度和测试Sidekiq工作人员、发送电子邮件等等的教程。</p><h1 id="ca47" class="kg kh hi bd ki kj kk kl km kn ko kp kq io kr ip ks ir kt is ku iu kv iv kw kx bi translated">什么是Sidekiq？</h1><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es ky"><img src="../Images/19b240a66cb627089457082e1dcf3ffb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5tMhbikEhXFWFNwQ.gif"/></div><figcaption class="kz la et er es lb lc bd b be z dx translated">李小龙对查克·诺里斯</figcaption></figure><p id="2534" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">Sidekiq是一个免费的开源Ruby任务调度程序，由<a class="ae kf" href="https://github.com/mperham" rel="noopener ugc nofollow" target="_blank">迈克·佩汉姆</a>创建。Ruby编程语言是我们尊敬和喜爱的使用最多和掌握最好的工具之一。如果你对我们为什么向客户的项目推荐它感兴趣，请查看我们关于Ruby 的另一篇文章<a class="ae kf" href="https://shakuro.com/blog/why-use-ruby-on-rails-and-when-its-better-for-your-project" rel="noopener ugc nofollow" target="_blank">。如果你没有多余的10分钟来了解我们的内在发展过程(我们完全理解)，那么让我们用4句话总结一下，并向你介绍这篇文章的主题:</a></p><p id="f9c4" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">1.Ruby是一种编程语言。</p><p id="b108" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">2.在开发Ruby on Rails应用程序时，您可能会发现自己被大量必须同时执行的任务淹没了。</p><p id="dd62" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">3.例如，发送电子邮件、为信用卡充电、与外部API交互以及其他数据处理。</p><p id="2ebb" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">4.开发人员使用Sidekiq之类的工具来运行后台作业，即请求-响应周期之外的自动化流程，这样用户就不必排队等候。</p><p id="8158" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">因此，<strong class="jl hj"> Sidekiq是Ruby应用程序的默认工具，可以提高其性能和响应等待时间</strong>。</p><h1 id="22c4" class="kg kh hi bd ki kj kk kl km kn ko kp kq io kr ip ks ir kt is ku iu kv iv kw kx bi translated">企业版</h1><p id="5ec1" class="pw-post-body-paragraph jj jk hi jl b jm ld ij jo jp le im jr js lf ju jv jw lg jy jz ka lh kc kd ke hb bi translated">虽然Sidekiq在默认情况下是免费的，但它不调度作业，只执行作业。该工具的付费版本——企业版——带有计划功能。它的创造者马克·佩勒姆并没有打算把这个工具分成付费和免费两个版本。确切地说，这个想法是他偶然想到的。</p><h1 id="5999" class="kg kh hi bd ki kj kk kl km kn ko kp kq io kr ip ks ir kt is ku iu kv iv kw kx bi translated">雷迪斯</h1><p id="bc43" class="pw-post-body-paragraph jj jk hi jl b jm ld ij jo jp le im jr js lf ju jv jw lg jy jz ka lh kc kd ke hb bi translated">Sidekiq与Redis 4.0+紧密合作来组织作业队列和存储统计数据。Redis(代表远程字典服务器)是一个快速的开源内存键值数据存储。它提供了亚毫秒级的响应时间，并允许实时应用程序每秒运行数百万个请求。</p><h1 id="f3d8" class="kg kh hi bd ki kj kk kl km kn ko kp kq io kr ip ks ir kt is ku iu kv iv kw kx bi translated">工人和队列</h1><p id="3695" class="pw-post-body-paragraph jj jk hi jl b jm ld ij jo jp le im jr js lf ju jv jw lg jy jz ka lh kc kd ke hb bi translated">调度程序作为应用程序的副本在单独的进程中运行，并且可以配置为使用多个工作线程。每个工作者被分配到一个或多个队列。队列按照任务添加的顺序表示任务列表，可以根据目的(默认、邮件、报告)或优先级(低、正常、高)来命名，这完全由开发人员决定。</p><p id="20e5" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated"><a class="ae kf" href="https://www.mikeperham.com/2021/11/07/whats-new-in-sidekiq-6.3/" rel="noopener ugc nofollow" target="_blank"> Sidekick 6.3 </a>，该工具的最新版本，于2021年11月问世。在介绍新版本时，Mark Perham详细阐述了如何正确使用术语“工人”。工人到底是什么？</p><blockquote class="li lj lk"><p id="51d0" class="jj jk ll jl b jm jn ij jo jp jq im jr lm jt ju jv ln jx jy jz lo kb kc kd ke hb bi translated"><em class="hi">“你是在说一个过程吗？一根线？一种工作？我鼓励开发人员停止使用术语</em> worker <em class="hi">而使用</em>include Sidekiq::Job<em class="hi">in your Job class”——m . p .</em></p></blockquote><pre class="iy iz ja jb fd lp lq lr ls aw lt bi"><span id="5f4c" class="lu kh hi lq b fi lv lw l lx ly">class SomeJob<br/>  include Sidekiq::Job<br/>  sidekiq_options ...</span><span id="5946" class="lu kh hi lq b fi lz lw l lx ly">  def perform(*args)<br/>  end<br/>end</span></pre><h1 id="8ec6" class="kg kh hi bd ki kj kk kl km kn ko kp kq io kr ip ks ir kt is ku iu kv iv kw kx bi translated">插件</h1><p id="a804" class="pw-post-body-paragraph jj jk hi jl b jm ld ij jo jp le im jr js lf ju jv jw lg jy jz ka lh kc kd ke hb bi translated">Sidekiq有无数突出的特性:可配置的重试周期、灵活的错误处理、web UI和大量进一步扩展其功能的插件。</p><p id="6b25" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">例如，其中一个<a class="ae kf" href="https://github.com/moove-it/sidekiq-scheduler" rel="noopener ugc nofollow" target="_blank">插件</a>引入了日程上的重复任务，这些任务在历史上是由基于cron的工具解决的。Cron更难配置，并且需要时间来启动整个应用程序以执行单个任务。</p><p id="ba88" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">另一个<a class="ae kf" href="https://github.com/sensu-plugins/sensu-plugins-sidekiq" rel="noopener ugc nofollow" target="_blank">插件</a>监控各种指标并检查Sidekiq以避免错误。你可以在GitHub上找到更多！</p><h1 id="a8da" class="kg kh hi bd ki kj kk kl km kn ko kp kq io kr ip ks ir kt is ku iu kv iv kw kx bi translated">Sidekiq是怎么这么火的？</h1><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es ky"><img src="../Images/00b012005d7053c9feca6ada3bb992b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*5hcdDdlltOVaOJUK.png"/></div><figcaption class="kz la et er es lb lc bd b be z dx translated">单身，已婚，多线程？图片由@dwfries在介质上制作</figcaption></figure><p id="5c04" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">2012年，Mike Perham率先推出了<strong class="jl hj">多线程</strong>后台作业系统。Resque是多进程单线程的。Delayed_job只能进行‌for单线程处理。Sidekiq是Ruby社区中第一个多线程工具。随着时间的推移，它成为Rails生态系统中避免线程安全缺陷的主要驱动力。因为Sidekiq无处不在，它稳定了Rails的线程安全。</p><h1 id="df93" class="kg kh hi bd ki kj kk kl km kn ko kp kq io kr ip ks ir kt is ku iu kv iv kw kx bi translated">谁用Sidekiq？</h1><p id="7c7d" class="pw-post-body-paragraph jj jk hi jl b jm ld ij jo jp le im jr js lf ju jv jw lg jy jz ka lh kc kd ke hb bi translated">如今，Sidekiq已经成为web应用程序事实上的标准。根据<a class="ae kf" href="https://stackshare.io/sidekiq" rel="noopener ugc nofollow" target="_blank"> Stackshare </a>的说法，Sidekiq被以下知名公司使用:</p><ul class=""><li id="bf69" class="ma mb hi jl b jm jn jp jq js mc jw md ka me ke mf mg mh mi bi translated">阿迪达斯，</li><li id="58a6" class="ma mb hi jl b jm mj jp mk js ml jw mm ka mn ke mf mg mh mi bi translated">GitLab，</li><li id="fcbd" class="ma mb hi jl b jm mj jp mk js ml jw mm ka mn ke mf mg mh mi bi translated">产品搜索，</li><li id="ced5" class="ma mb hi jl b jm mj jp mk js ml jw mm ka mn ke mf mg mh mi bi translated">发送网格，</li><li id="dbe8" class="ma mb hi jl b jm mj jp mk js ml jw mm ka mn ke mf mg mh mi bi translated">新遗迹，</li><li id="abdf" class="ma mb hi jl b jm mj jp mk js ml jw mm ka mn ke mf mg mh mi bi translated">500像素，</li><li id="aafc" class="ma mb hi jl b jm mj jp mk js ml jw mm ka mn ke mf mg mh mi bi translated">还有很多。</li></ul><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es ky"><img src="../Images/145ddc670c9c8f0a835d72027fd13ce5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*5ZIR1WsNEYuPu_uv.png"/></div><figcaption class="kz la et er es lb lc bd b be z dx translated">通过Stackshare了解使用Sidekiq的公司</figcaption></figure><h1 id="a75c" class="kg kh hi bd ki kj kk kl km kn ko kp kq io kr ip ks ir kt is ku iu kv iv kw kx bi translated">Sidekiq与其他类似工具相比如何？</h1><p id="3d67" class="pw-post-body-paragraph jj jk hi jl b jm ld ij jo jp le im jr js lf ju jv jw lg jy jz ka lh kc kd ke hb bi translated">有一些替代项目具有或多或少相同的特性。在本文中，我们将Sidekiq与其最受欢迎的竞争对手Resque和Delayed_job进行了比较。</p><h1 id="871d" class="kg kh hi bd ki kj kk kl km kn ko kp kq io kr ip ks ir kt is ku iu kv iv kw kx bi translated"><a class="ae kf" href="http://resque.github.io/" rel="noopener ugc nofollow" target="_blank">雷斯克</a></h1><p id="5fc9" class="pw-post-body-paragraph jj jk hi jl b jm ld ij jo jp le im jr js lf ju jv jw lg jy jz ka lh kc kd ke hb bi translated">Resque是一个用于创建后台作业的Ruby库。您可以将它们放在多个队列中，稍后再进行处理。后台作业可以是任何Ruby类或模块。现有类别可以转换为后台作业。Resque还提供了创建新类的选项。</p><p id="7be9" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">Resque的并发模型与Sidekiq略有不同，这可能是您想要的，也可能不是。虽然Sidekiq为其工作人员使用线程(并且不能扩展到许多CPU核心上)，但Resque使用进程，这使得它在一方面稍微更重，但允许它使用CPU核心。当单CPU线程模型不太适用时，这对于计算量大的任务非常重要。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es ky"><img src="../Images/991bc5d92cbf2f7cc8763957304e75c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*CeUbVaZRrbIxKWJp.png"/></div><figcaption class="kz la et er es lb lc bd b be z dx translated">Stackshare上的Sidekiq与Resque统计数据</figcaption></figure><p id="b60c" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">与Sidekiq不同，Resque不需要线程安全，可以与任何gem (Ruby程序和库)一起工作。据<a class="ae kf" href="https://stackoverflow.com/questions/11580954/resque-vs-sidekiq" rel="noopener ugc nofollow" target="_blank">开发者</a>称，Sidekiq运行速度更快，使用的内存更少。</p><h1 id="4ec4" class="kg kh hi bd ki kj kk kl km kn ko kp kq io kr ip ks ir kt is ku iu kv iv kw kx bi translated"><a class="ae kf" href="https://github.com/collectiveidea/delayed_job" rel="noopener ugc nofollow" target="_blank">延迟_作业</a></h1><p id="5fac" class="pw-post-body-paragraph jj jk hi jl b jm ld ij jo jp le im jr js lf ju jv jw lg jy jz ka lh kc kd ke hb bi translated">DJ是一个优先级队列、面向数据库的工具，允许异步执行后台任务。它最初是从Shopify中提取的，这些年来变得非常流行。</p><p id="3e17" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">根据Doug Breaker 对DJ和Sidekiq的比较研究，有几个特性是后者所没有的:</p><ul class=""><li id="b7fd" class="ma mb hi jl b jm jn jp jq js mc jw md ka me ke mf mg mh mi bi translated">与不依赖于关系数据库/非关系数据库的Rails轻松集成。</li><li id="56ca" class="ma mb hi jl b jm mj jp mk js ml jw mm ka mn ke mf mg mh mi bi translated">自定义数据存储。您可以使用主数据存储脱机处理任务，并自定义数据存储以满足您的需求。</li><li id="bb93" class="ma mb hi jl b jm mj jp mk js ml jw mm ka mn ke mf mg mh mi bi translated">不需要一次运行多个依赖项，例如，不需要多个服务和依赖项来运行程序，您可以限制您需要的依赖项。</li></ul><p id="397f" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">Delayed::job，可悲的是不支持多线程，不像Sidekiq。后者也运行得更快，可伸缩，并且具有自动运行Redis的能力。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es ky"><img src="../Images/74765c2867f3a67c6d24312365b348de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*HyfWAnEVDDxPdL5b.png"/></div><figcaption class="kz la et er es lb lc bd b be z dx translated">Stackshare上的Sidekiq与Delayed_job统计数据</figcaption></figure><h1 id="45f3" class="kg kh hi bd ki kj kk kl km kn ko kp kq io kr ip ks ir kt is ku iu kv iv kw kx bi translated">在普通Ruby中使用Sidekiq</h1><p id="30b1" class="pw-post-body-paragraph jj jk hi jl b jm ld ij jo jp le im jr js lf ju jv jw lg jy jz ka lh kc kd ke hb bi translated">现在您已经知道了替代方案，让我们学习如何在实践中使用Sidekiq。</p><p id="3d1c" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">Sidekiq是框架无关的，可以在任何Ruby应用程序中使用。官方的<a class="ae kf" href="https://github.com/mperham/sidekiq/wiki/Getting-Started" rel="noopener ugc nofollow" target="_blank">入门</a>指南提供了如何启动和运行的详细步骤。</p><p id="c858" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">要点是你:</p><p id="8f57" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">1.将Sidekiq添加到您的gem文件中:</p><pre class="iy iz ja jb fd lp lq lr ls aw lt bi"><span id="76e5" class="lu kh hi lq b fi lv lw l lx ly"># Gemfile<br/>    <br/>gem 'sidekiq'</span></pre><p id="16c8" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">2.定义工作类:</p><pre class="iy iz ja jb fd lp lq lr ls aw lt bi"><span id="78a2" class="lu kh hi lq b fi lv lw l lx ly"># app/workers/generate_report_worker.rb<br/>    <br/>class GenerateReportWorker<br/>  include Sidekiq::Worker<br/>    <br/>  def perform(user_id)<br/>    # do your reporting here<br/>  end<br/>end</span></pre><p id="d4b0" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">3.将Sidekiq作为单独的进程启动:</p><pre class="iy iz ja jb fd lp lq lr ls aw lt bi"><span id="e631" class="lu kh hi lq b fi lv lw l lx ly">$ bundle exec sidekiq</span></pre><p id="8702" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">4.开始安排您的员工:</p><pre class="iy iz ja jb fd lp lq lr ls aw lt bi"><span id="99f3" class="lu kh hi lq b fi lv lw l lx ly"># Task is to be executed as soon as possible<br/>GenerateReportWorker.perform_async(user.id)<br/>    <br/># Task is to be executed in 5 minutes<br/>GenerateReportWorker.perform_in(5 * 60, user.id)<br/>    <br/># Task is to be executed at a certain moment (3 hours from now)<br/>GenerateReportWorker.perform_at(Time.now + 10800, user.id</span></pre><p id="aa09" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">5.要立即执行员工，请执行以下操作:</p><pre class="iy iz ja jb fd lp lq lr ls aw lt bi"><span id="db00" class="lu kh hi lq b fi lv lw l lx ly">MySimpleWorker.new.perform("I was performed!")</span></pre><h1 id="305a" class="kg kh hi bd ki kj kk kl km kn ko kp kq io kr ip ks ir kt is ku iu kv iv kw kx bi translated">在Ruby on Rails中使用Sidekiq</h1><p id="9aa6" class="pw-post-body-paragraph jj jk hi jl b jm ld ij jo jp le im jr js lf ju jv jw lg jy jz ka lh kc kd ke hb bi translated">在普通的老式Ruby中使用Sidekiq和在Ruby on Rails编程中使用Sidekiq没有太大区别。您仍然可以很好地与Rails活动作业框架集成，并且可以在安排未来任务时使用日期/时间助手:</p><h1 id="a886" class="kg kh hi bd ki kj kk kl km kn ko kp kq io kr ip ks ir kt is ku iu kv iv kw kx bi translated">日期/时间助手示例</h1><pre class="iy iz ja jb fd lp lq lr ls aw lt bi"><span id="820c" class="lu kh hi lq b fi lv lw l lx ly"># Generate report next Monday<br/>GenerateReportWorker.perform_at(Time.current.next_week, user.id)</span></pre><p id="bc85" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated"><strong class="jl hj">例如，在5分钟内生成一份报告:</strong></p><pre class="iy iz ja jb fd lp lq lr ls aw lt bi"><span id="c7a0" class="lu kh hi lq b fi lv lw l lx ly">GenerateReportWorker.perform_in(5.minutes, user.id)</span></pre><h1 id="f9a0" class="kg kh hi bd ki kj kk kl km kn ko kp kq io kr ip ks ir kt is ku iu kv iv kw kx bi translated"><a class="ae kf" href="http://guides.rubyonrails.org/v5.2.5/active_job_basics.html" rel="noopener ugc nofollow" target="_blank">主动工作整合</a></h1><p id="4478" class="pw-post-body-paragraph jj jk hi jl b jm ld ij jo jp le im jr js lf ju jv jw lg jy jz ka lh kc kd ke hb bi translated">活动职务是与职务运行者交互的标准界面。根据官方指南，它是一个具有多种排队后端的框架。这些工作可能是:</p><ul class=""><li id="42d4" class="ma mb hi jl b jm jn jp jq js mc jw md ka me ke mf mg mh mi bi translated">定期的大扫除，</li><li id="177b" class="ma mb hi jl b jm mj jp mk js ml jw mm ka mn ke mf mg mh mi bi translated">计费费用，</li><li id="c2a5" class="ma mb hi jl b jm mj jp mk js ml jw mm ka mn ke mf mg mh mi bi translated">电子邮件，</li><li id="7a44" class="ma mb hi jl b jm mj jp mk js ml jw mm ka mn ke mf mg mh mi bi translated">任何你能想象的并行运行。</li></ul><p id="a393" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">如果你不希望你的员工是Sidekiq特有的，你需要采取几个步骤:</p><p id="6c22" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">1.将员工定义为活动职务职务:</p><pre class="iy iz ja jb fd lp lq lr ls aw lt bi"><span id="b347" class="lu kh hi lq b fi lv lw l lx ly"># app/jobs/generate_report_job.rb<br/>    <br/>class GenerateReportJob &lt; ActiveJob::Base<br/>  # The name of the queue to put this job into<br/>  queue_as :default</span><span id="69bb" class="lu kh hi lq b fi lz lw l lx ly">  def perform(user_id)<br/>    # do your reporting here<br/>  end<br/>end</span></pre><p id="d91b" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">2.配置Rails应用程序以使用正确的适配器:</p><pre class="iy iz ja jb fd lp lq lr ls aw lt bi"><span id="a46f" class="lu kh hi lq b fi lv lw l lx ly"># config/application.rb<br/>    <br/>class Application &lt; Rails::Application<br/>  # ...<br/>  config.active_job.queue_adapter = :sidekiq<br/>end</span></pre><p id="f572" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">3.使用ActiveJob语法进行调度:</p><pre class="iy iz ja jb fd lp lq lr ls aw lt bi"><span id="1a64" class="lu kh hi lq b fi lv lw l lx ly"># Generate report as soon as possible<br/>GenerateReportJob.perform_later(user.id)</span></pre><p id="0426" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">配置<a class="ae kf" href="https://github.com/mperham/sidekiq/wiki/Active-Job" rel="noopener ugc nofollow" target="_blank">选项</a>很多。</p><h1 id="22b4" class="kg kh hi bd ki kj kk kl km kn ko kp kq io kr ip ks ir kt is ku iu kv iv kw kx bi translated">使用<a class="ae kf" href="https://guides.rubyonrails.org/action_mailer_basics.html" rel="noopener ugc nofollow" target="_blank"> ActionMailer </a>和Sidekiq发送电子邮件</h1><p id="32af" class="pw-post-body-paragraph jj jk hi jl b jm ld ij jo jp le im jr js lf ju jv jw lg jy jz ka lh kc kd ke hb bi translated">ActionMailer允许你发送邮件(惊喜！)从你的Ruby应用。下面是您使用Sidekiq异步发送电子邮件所需的内容:</p><p id="3f45" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">1.要创建邮件程序:</p><pre class="iy iz ja jb fd lp lq lr ls aw lt bi"><span id="caaf" class="lu kh hi lq b fi lv lw l lx ly"># app/mailers/users_mailer.rb</span><span id="2a07" class="lu kh hi lq b fi lz lw l lx ly">class UsersMailer &lt; ActionMailer::Base<br/>  def welcome_email(user_id)<br/>    @user = User.find(user_id)<br/>  <br/>    mail(to: @user.email, subject: "Welcome") do |format|<br/>      format.text<br/>      format.html<br/>    end<br/>  end<br/>end</span></pre><p id="8675" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">2.查看电子邮件视图:</p><pre class="iy iz ja jb fd lp lq lr ls aw lt bi"><span id="a553" class="lu kh hi lq b fi lv lw l lx ly">app/views/users_mailer/welcome_email.html.erb - HTML version<br/>app/views/users_mailer/welcome_email.text.erb - TEXT version</span></pre><p id="18f8" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">3.最后，发送电子邮件:</p><pre class="iy iz ja jb fd lp lq lr ls aw lt bi"><span id="5656" class="lu kh hi lq b fi lv lw l lx ly">user = User.find(1)</span><span id="130f" class="lu kh hi lq b fi lz lw l lx ly">mail = UsersMailer.welcome_email(user.id)<br/># mail.deliver_now<br/>mail.deliver_later</span></pre><h1 id="cd1a" class="kg kh hi bd ki kj kk kl km kn ko kp kq io kr ip ks ir kt is ku iu kv iv kw kx bi translated">测试Sidekiq作业(使用<a class="ae kf" href="https://github.com/rspec/rspec-metagem" rel="noopener ugc nofollow" target="_blank"> RSpec </a>框架)</h1><p id="3846" class="pw-post-body-paragraph jj jk hi jl b jm ld ij jo jp le im jr js lf ju jv jw lg jy jz ka lh kc kd ke hb bi translated">Sidekiq提供工具，用于在员工生命周期的任何阶段测试他们的各个方面。要直接测试工作线程，请使用:</p><pre class="iy iz ja jb fd lp lq lr ls aw lt bi"><span id="3dea" class="lu kh hi lq b fi lv lw l lx ly">worker = MyWorker.new<br/>worker.perform(:my_arg)</span></pre><p id="7e45" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">或者您可以使用<a class="ae kf" href="https://sloboda-studio.com/blog/testing-sidekiq-jobs/" rel="noopener ugc nofollow" target="_blank">内嵌模式</a>:</p><pre class="iy iz ja jb fd lp lq lr ls aw lt bi"><span id="b91f" class="lu kh hi lq b fi lv lw l lx ly"># implementation<br/>class DeleteFromRemoteApiWorker<br/>  include Sidekiq::Worker</span><span id="41f0" class="lu kh hi lq b fi lz lw l lx ly">  def perform(item_ids)<br/>    ApiWrapper.delete_items(item_ids) # dependency<br/>  end<br/>end<br/></span><span id="e3fa" class="lu kh hi lq b fi lz lw l lx ly"># test<br/>describe DeleteFromRemoteApiWorker do<br/>  let(:items) do<br/>    # ...<br/>  end</span><span id="aee4" class="lu kh hi lq b fi lz lw l lx ly">  it "delegates the work to the API wrapper as expected" do<br/>    allow(ApiWrapper).to receive(:delete_items)<br/>    item_ids = items.map(&amp;:id)</span><span id="c21b" class="lu kh hi lq b fi lz lw l lx ly">    described_class.perform_async(item_ids)<br/></span><span id="8a98" class="lu kh hi lq b fi lz lw l lx ly">    expect(ApiWrapper).to(<br/>      have_received(:delete_items).with(item_ids)<br/>    )<br/>  end<br/>end</span></pre><h1 id="799f" class="kg kh hi bd ki kj kk kl km kn ko kp kq io kr ip ks ir kt is ku iu kv iv kw kx bi translated">为什么我们(仍然)在外包项目中使用Sidekiq？</h1><p id="137e" class="pw-post-body-paragraph jj jk hi jl b jm ld ij jo jp le im jr js lf ju jv jw lg jy jz ka lh kc kd ke hb bi translated">掌握Sidekiq并不需要三位数的智商。尽管如此，‌stable和可靠的软件是处理成千上万的工人必须的。这个工具专门使用Redis作为它的数据库，这可能并不适合所有人。内存泄漏也是一件需要注意的事情…</p><p id="8825" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">然而，当处理复杂的Ruby应用程序时，Sidekiq架构是完美的。例如，我们创建了一个<a class="ae kf" href="https://shakuro.com/works/cgma/" rel="noopener ugc nofollow" target="_blank">虚拟学习环境</a>,包括实时聊天、视频流、计费等等，Sidekiq是我们的技术堆栈。</p><p id="e9e8" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">Sidekiq非常适合那些需要高速度的人，每秒执行<a class="ae kf" href="https://github.com/mperham/sidekiq/" rel="noopener ugc nofollow" target="_blank"> 7100个任务</a>。多线程能力意味着多个作业可以在后台排队，而不会影响应用程序的同步工作流，从而提高整体性能。</p><p id="b5d6" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">那么，Sidekiq还是我们最好的伙伴吗？是啊！生日快乐，Sidekiq！🎂</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es ky"><img src="../Images/c66d3594066dbdc00dddec5aab1acce1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*o0G2z1jbn8wCcch2.gif"/></div><figcaption class="kz la et er es lb lc bd b be z dx translated">图片来自Giphy</figcaption></figure><p id="b1b5" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated"><a class="ae kf" href="https://shakuro.com/blog/sidekiq-tutorial-overview" rel="noopener ugc nofollow" target="_blank">作者阿列克谢·古列耶夫&amp;丽塔·恩威作者T7】</a></p></div></div>    
</body>
</html>