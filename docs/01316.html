<html>
<head>
<title>A clean way to handle loading and error state in React application.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React应用程序中处理加载和错误状态的干净方法。</h1>
<blockquote>原文：<a href="https://medium.com/codex/handling-loading-and-error-state-in-react-application-and-clean-state-mess-b3cbf28029fd?source=collection_archive---------1-----------------------#2021-04-19">https://medium.com/codex/handling-loading-and-error-state-in-react-application-and-clean-state-mess-b3cbf28029fd?source=collection_archive---------1-----------------------#2021-04-19</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/6eaacdcf947a1fc5a895b0e12e8cbe33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8hSjCQj1Z6ox91R8"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">由<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</figcaption></figure><p id="e1a8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">面向用户的应用程序处理不同状态的数据。有许多方法可以根据应用程序的状态来显示用户界面。这里我们将举一个主要基于HTTP请求的应用程序的例子。</p><p id="841e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">大部分react前端应用主要是做HTTP请求，并向用户展示响应。为了更好的UX，我们的用户界面需要向用户传达整个过程。</p></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><p id="c717" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们把它写在产品需求声明里吧。获取用户列表并显示用户。同时，正在获取数据，显示加载程序/消息。当请求完成时，显示错误响应。</p><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="ab0c" class="kj kk hi kf b fi kl km l kn ko"><em class="kp">export</em> <em class="kp">default</em> function DisplayUsers() {<br/>// Keeping code short with one API response</span><span id="ffa4" class="kj kk hi kf b fi kq km l kn ko">const [state, setState] = useState({</span><span id="3b34" class="kj kk hi kf b fi kq km l kn ko">loading: true,</span><span id="a43b" class="kj kk hi kf b fi kq km l kn ko">response: null,</span><span id="899a" class="kj kk hi kf b fi kq km l kn ko">error: null</span><span id="0bdc" class="kj kk hi kf b fi kq km l kn ko">});</span><span id="2fa3" class="kj kk hi kf b fi kq km l kn ko">useEffect(()=&gt;{</span><span id="0b63" class="kj kk hi kf b fi kq km l kn ko"><em class="kp">// make http request</em></span><span id="831a" class="kj kk hi kf b fi kq km l kn ko">fetch('https://jsonplaceholder.typicode.com/users')</span><span id="f786" class="kj kk hi kf b fi kq km l kn ko">.then&lt;IUser[]&gt;(res=&gt;res.json())</span><span id="8f8e" class="kj kk hi kf b fi kq km l kn ko">.then(response=&gt;setState({</span><span id="a210" class="kj kk hi kf b fi kq km l kn ko">loading: false,</span><span id="8e11" class="kj kk hi kf b fi kq km l kn ko">response,</span><span id="0e23" class="kj kk hi kf b fi kq km l kn ko">error:null</span><span id="c315" class="kj kk hi kf b fi kq km l kn ko">}))<br/>.catch(error=&gt;setState({<br/>loading: false,<br/>response: null,</span><span id="c28f" class="kj kk hi kf b fi kq km l kn ko">error</span><span id="3123" class="kj kk hi kf b fi kq km l kn ko">}));</span><span id="57d0" class="kj kk hi kf b fi kq km l kn ko">},[]);</span><span id="cc33" class="kj kk hi kf b fi kq km l kn ko"><em class="kp">return</em> &lt;div&gt;</span><span id="535e" class="kj kk hi kf b fi kq km l kn ko">{state.error ? 'Error' : null}</span><span id="8225" class="kj kk hi kf b fi kq km l kn ko">{state.loading</span><span id="eb85" class="kj kk hi kf b fi kq km l kn ko">? &lt;div&gt;Loading...&lt;/div&gt;</span><span id="2999" class="kj kk hi kf b fi kq km l kn ko">: &lt;div&gt;Display users:</span><span id="e511" class="kj kk hi kf b fi kq km l kn ko">&lt;div&gt;</span><span id="4c18" class="kj kk hi kf b fi kq km l kn ko">we have total users : {state.response.length}</span><span id="3091" class="kj kk hi kf b fi kq km l kn ko">{state.response.map(user=&gt;&lt;User user={user}/&gt;)}</span><span id="af01" class="kj kk hi kf b fi kq km l kn ko">&lt;/div&gt;</span><span id="be0a" class="kj kk hi kf b fi kq km l kn ko">&lt;/div&gt;</span><span id="e8cf" class="kj kk hi kf b fi kq km l kn ko">}</span><span id="869f" class="kj kk hi kf b fi kq km l kn ko">&lt;/div&gt;</span><span id="2bb9" class="kj kk hi kf b fi kq km l kn ko">}</span></pre><p id="36a2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">随着代码的增长或其他情况的出现，例如，如果用户列表为空，则显示自定义消息。它变成在<code class="du kr ks kt kf b">JSX</code>模板中导航。</p><p id="2452" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">第一步是清理这些混乱，分离出<code class="du kr ks kt kf b">state blocks.</code> Having，这将使浏览状态块变得容易，我们将能够讨论代码。</p><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="2a31" class="kj kk hi kf b fi kl km l kn ko"><em class="kp">export</em> <em class="kp">default</em> function DisplayUsers() {</span><span id="3ed1" class="kj kk hi kf b fi kq km l kn ko">const [state, setState] = useState({<br/>loading: true,<br/>response: null,<br/>error: null<br/>});</span><span id="e9f4" class="kj kk hi kf b fi kq km l kn ko">useEffect(()=&gt;{</span><span id="aaaa" class="kj kk hi kf b fi kq km l kn ko"><em class="kp">// make http request</em></span><span id="006c" class="kj kk hi kf b fi kq km l kn ko">fetch('https://jsonplaceholder.typicode.com/users')</span><span id="1868" class="kj kk hi kf b fi kq km l kn ko">.then&lt;IUser[]&gt;(res=&gt;res.json())</span><span id="4e44" class="kj kk hi kf b fi kq km l kn ko">.then(response=&gt;setState({</span><span id="820e" class="kj kk hi kf b fi kq km l kn ko">loading: false,</span><span id="ec8e" class="kj kk hi kf b fi kq km l kn ko">response,</span><span id="9934" class="kj kk hi kf b fi kq km l kn ko">error:null</span><span id="135f" class="kj kk hi kf b fi kq km l kn ko">})).catch(error=&gt;setState({</span><span id="87ac" class="kj kk hi kf b fi kq km l kn ko">loading: false,</span><span id="abf3" class="kj kk hi kf b fi kq km l kn ko">response: null,</span><span id="5f4d" class="kj kk hi kf b fi kq km l kn ko">error</span><span id="f5fd" class="kj kk hi kf b fi kq km l kn ko">}));</span><span id="633f" class="kj kk hi kf b fi kq km l kn ko">},[]);</span><span id="a2e4" class="kj kk hi kf b fi kq km l kn ko"><em class="kp">if</em>(state.error){<br/>// This is Error block. Do everything related to error hangling.</span><span id="3082" class="kj kk hi kf b fi kq km l kn ko"><em class="kp">return</em> &lt;div style={{color:'red'}}&gt; Error state/ every thing related to Error&lt;/div&gt;</span><span id="5895" class="kj kk hi kf b fi kq km l kn ko">}</span><span id="80a3" class="kj kk hi kf b fi kq km l kn ko"><em class="kp">if</em>(state.loading){<br/>// Loading state block. Do everything related to loading show loader/ animation. </span><span id="088f" class="kj kk hi kf b fi kq km l kn ko"><em class="kp">return</em> &lt;div&gt;Loading...&lt;/div&gt;</span><span id="4388" class="kj kk hi kf b fi kq km l kn ko">}</span><span id="2b43" class="kj kk hi kf b fi kq km l kn ko">// Better and clean code with less ternary conditions.</span><span id="074d" class="kj kk hi kf b fi kq km l kn ko"><em class="kp">return</em> &lt;div&gt;<br/>&lt;h3&gt;Display users:&lt;/h3&gt;<br/>we have total users : {state.response.length}{state.response.map(user=&gt;&lt;User user={user}/&gt;)}<br/>&lt;/div&gt;</span><span id="ebee" class="kj kk hi kf b fi kq km l kn ko">}</span></pre><p id="3dee" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">有了这些状态块，我们对相关的状态有了更多的控制。现在我们有了更好的积木。</p><p id="add2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这是针对单个组件完成的，但是对于一个大的应用程序，会有更多基于状态的组件。</p><p id="7cd0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">会有很多重复。这个问题可以用这个通用组件来解决并简化。</p><p id="cc16" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">// StateHandlerComponent.js来解决这种重复。</p><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="8f30" class="kj kk hi kf b fi kl km l kn ko">//This component will deal with state blocks <br/>const StateHandler = (props) =&gt;{</span><span id="0688" class="kj kk hi kf b fi kq km l kn ko">const {<br/>showLoader = false,<br/>showError = false,<br/>showEmpty = false,<br/>retryHandler = () =&gt; { console.log("Retry!!") } } = props;</span><span id="c7fa" class="kj kk hi kf b fi kq km l kn ko"><em class="kp">if</em> (showLoader) {<br/><em class="kp">return</em> &lt;Loader fullScreen={false} /&gt;;<br/>}</span><span id="f7c4" class="kj kk hi kf b fi kq km l kn ko"><em class="kp">if</em> (showError) {<br/><em class="kp">return</em> &lt;InfoComponent  icon={&lt;ErrorIcon /&gt;} buttonClickHandler={retryHandler} /&gt;<br/>}</span><span id="f75b" class="kj kk hi kf b fi kq km l kn ko"><em class="kp">if</em> (showEmpty) {<br/><em class="kp">return</em> &lt;div class={style.exceptionContainer}&gt;<br/>&lt;Empty message='No data available' /&gt;<br/>&lt;/div&gt;;<br/>}</span><span id="0e98" class="kj kk hi kf b fi kq km l kn ko"><em class="kp">return</em> props.children;<br/>}</span><span id="ba4a" class="kj kk hi kf b fi kq km l kn ko"><em class="kp">export</em> <em class="kp">default</em> StateHandler;</span></pre><p id="c2f3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">使用此<code class="du kr ks kt kf b">StateHandler</code>组件的最终输出。</p><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="434d" class="kj kk hi kf b fi kl km l kn ko"><em class="kp">export</em> <em class="kp">default</em> function DisplayUsers() {</span><span id="62b1" class="kj kk hi kf b fi kq km l kn ko">const [state, setState] = useState({<br/>loading: true,<br/>response: null,<br/>error: null<br/>});</span><span id="38ed" class="kj kk hi kf b fi kq km l kn ko">useEffect(()=&gt;{</span><span id="4812" class="kj kk hi kf b fi kq km l kn ko"><em class="kp">// make http request</em></span><span id="41b0" class="kj kk hi kf b fi kq km l kn ko">fetch('https://jsonplaceholder.typicode.com/users')</span><span id="0b74" class="kj kk hi kf b fi kq km l kn ko">.then&lt;IUser[]&gt;(res=&gt;res.json())<br/>.then(response=&gt;setState({<br/>loading: false,<br/>response,<br/>error:null<br/>})).catch(error=&gt;setState({<br/>loading: false,<br/>response: null,<br/>error<br/>}));</span><span id="2d01" class="kj kk hi kf b fi kq km l kn ko">},[]);</span><span id="2027" class="kj kk hi kf b fi kq km l kn ko">//This component deals will only the user list display </span><span id="5ac9" class="kj kk hi kf b fi kq km l kn ko"><em class="kp">return</em> &lt;StateHandler showError={state.error} showLoader={state.loading} showEmpty={state.response.length == 0}&gt;</span><span id="a8db" class="kj kk hi kf b fi kq km l kn ko">&lt;div&gt;&lt;h3&gt;Display users:&lt;/h3&gt;<br/>we have total users : {state.response.length}<br/>{state.response.map(user =&gt; &lt;User user={user} /&gt;)}&lt;/div&gt;</span><span id="50cf" class="kj kk hi kf b fi kq km l kn ko">&lt;/StateHandler&gt;;</span><span id="3911" class="kj kk hi kf b fi kq km l kn ko">}</span></pre><blockquote class="ku kv kw"><p id="b0df" class="iv iw kp ix b iy iz ja jb jc jd je jf kx jh ji jj ky jl jm jn kz jp jq jr js hb bi translated">现在，状态处理由“StateHandler”组件完成。弄得干净利落，容易讲道理。</p></blockquote><p id="4732" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我将很快分享更多的技巧。继续学习，让我知道这个组件是否帮助你清理了代码库中的一些混乱状态:)</p></div></div>    
</body>
</html>