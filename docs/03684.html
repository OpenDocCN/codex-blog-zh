<html>
<head>
<title>ğŸ’ªCreating a Linux virtual machine with Azure Bicep â€” template</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ğŸ’ªä½¿ç”¨Azure Bicepåˆ›å»ºLinuxè™šæ‹Ÿæœºâ€”æ¨¡æ¿</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://medium.com/codex/how-to-create-a-linux-virtual-machine-with-azure-bicep-template-e22f50f2baea?source=collection_archive---------1-----------------------#2021-09-16">https://medium.com/codex/how-to-create-a-linux-virtual-machine-with-azure-bicep-template-e22f50f2baea?source=collection_archive---------1-----------------------#2021-09-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="e668" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ä»Šå¤©ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªAzure Bicepæ¨¡æ¿æ¥é…ç½®åŸºäºLinuxçš„è™šæ‹Ÿæœºã€‚</p><p id="e89b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æœ¬æ–‡çš„ä¸»è¦ç›®çš„æ˜¯è®©æ‚¨äº†è§£å¦‚ä½•ä½¿ç”¨Azure Bicepæ¥éƒ¨ç½²åŸºäºLinuxçš„è™šæ‹Ÿæœºã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°†ç¼–å†™ä¸€ä¸ªBicepæ¨¡æ¿æ¥åœ¨Azureä¸­éƒ¨ç½²Kemp Flowmonã€‚</p><h1 id="8194" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">æ¦‚è§‚</h1><p id="9f93" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">åœ¨Azureä¸Šéƒ¨ç½²è¿™ä¸ªåŸºäºLinuxçš„è™šæ‹Ÿæœºä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥æœŸå¾…ä»€ä¹ˆï¼Ÿæˆ‘ä»¬å°†éƒ¨ç½²Kemp Flowmonæ”¶é›†å™¨è®¾å¤‡ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ï¼Œå› ä¸ºå®ƒæ˜¯åŸºäºLinuxçš„æœºå™¨ï¼Œå°†ä¸ºæ‚¨æä¾›é¢„æµ‹ç½‘ç»œæ€§èƒ½ç›‘æ§å’Œç½‘ç»œæ£€æµ‹åŠå“åº”åŠŸèƒ½ã€‚</p><p id="ad85" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æœ¬æ–‡å°†å…³æ³¨å¦‚ä½•åˆ©ç”¨Azure Bicepæ¨¡æ¿æ¥ç®€åŒ–è¿™ä¸ªåŸºäºLinuxçš„è™šæ‹Ÿæœºåœ¨Azureä¸Šçš„éƒ¨ç½²ã€‚</p><h1 id="e4cd" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">å…ˆå†³æ¡ä»¶ã€‚</h1><ul class=""><li id="a587" class="kg kh hi ih b ii kb im kc iq ki iu kj iy kk jc kl km kn ko bi translated">æœ‰æ•ˆçš„Azureè®¢é˜…ã€‚</li><li id="69fc" class="kg kh hi ih b ii kp im kq iq kr iu ks iy kt jc kl km kn ko bi translated">æ‹¥æœ‰æ‰€æœ‰è€…/è´¡çŒ®è€…è§’è‰²çš„ç”¨æˆ·</li><li id="1cfa" class="kg kh hi ih b ii kp im kq iq kr iu ks iy kt jc kl km kn ko bi translated">èµ„æºç»„</li></ul><p id="43dd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æˆ‘ä»¬å¼€å§‹å§ï¼</p><p id="8e7b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">åœ¨Azureä¸­åˆ›å»ºåŸºäºLinuxçš„è™šæ‹ŸæœºåŒ…æ‹¬å‡ ä¸ªæ­¥éª¤:</p><ul class=""><li id="2d6c" class="kg kh hi ih b ii ij im in iq ku iu kv iy kw jc kl km kn ko bi translated">åˆ›å»ºèµ„æºç»„</li><li id="d97a" class="kg kh hi ih b ii kp im kq iq kr iu ks iy kt jc kl km kn ko bi translated">åˆ›å»ºè™šæ‹ŸæœºåŠå…¶ç›¸å…³ç»„ä»¶(è™šæ‹Ÿç½‘ç»œã€å­ç½‘ã€ç½‘ç»œæ¥å£ã€DNSã€å®‰å…¨è§„åˆ™ã€‚)</li></ul><p id="d553" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æ³¨æ„ï¼Œè¿™ä¸ªç‰¹å®šçš„æœºå™¨â€” Kemp Flowmon â€”åªå…è®¸SSHéªŒè¯ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å°†åœ¨Bicepæ¨¡æ¿ä¸­åŒ…å«ä½¿ç”¨SSHè¿›è¡Œèº«ä»½éªŒè¯çš„èƒ½åŠ›ï¼Œè€Œä¸æ˜¯ä½¿ç”¨å¯†ç ã€‚</p><h1 id="c935" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">1.åˆ›å»ºSSHå¯†é’¥å¯¹</h1><p id="6c74" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">ç¬¬ä¸€æ­¥æ˜¯åˆ›å»ºä¸€ä¸ªSSHå¯†é’¥å¯¹ï¼›æ‚¨å¯ä»¥æŸ¥çœ‹ä»¥ä¸‹å…³äºå¦‚ä½•åœ¨Azureä¸­ä¸ºLinuxè™šæ‹Ÿæœºåˆ›å»ºSSHå¯†é’¥å¯¹çš„æ–‡ç« â€”<a class="ae kx" href="https://docs.microsoft.com/en-us/azure/virtual-machines/linux/mac-create-ssh-keys" rel="noopener ugc nofollow" target="_blank">https://docs . Microsoft . com/en-us/Azure/virtual-machines/Linux/MAC-create-SSH-keys</a></p><p id="9a74" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨Azure Bashæ§åˆ¶å°åˆ›å»ºä¸€ä¸ªSSHå¯†é’¥å¯¹ã€‚åœ¨Azureé—¨æˆ·ä¸­ï¼Œè¯·æ±‚ä¸€ä¸ªæ–°çš„æ§åˆ¶å°ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º:</p><figure class="kz la lb lc fd ld er es paragraph-image"><div class="er es ky"><img src="../Images/0b41554baac612720be6c4d4d1ec28bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1328/format:webp/1*yXPZ1Y8bu5lHXZFHdA9Uzg.png"/></div><figcaption class="lg lh et er es li lj bd b be z dx translated">Azureé—¨æˆ·â€”æ§åˆ¶å°</figcaption></figure><p id="33b7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ç„¶åï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ç”Ÿæˆä¸€ä¸ªSSHå¯†é’¥:</p><pre class="kz la lb lc fd lk ll lm ln aw lo bi"><span id="2582" class="lp je hi ll b fi lq lr l ls lt">ssh-keygen \<br/>    -m PEM \<br/>    -t rsa \<br/>    -b 4096 \<br/>    -C "flowmon" \<br/>    -f ~/.ssh/flowmon-priv-key \<br/>    -N yourpasshphrase</span></pre><p id="aed4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">è¿™å°†åœ¨æ–‡ä»¶å…±äº«ä¸­çš„SSHç›®å½•ä¸‹ç”Ÿæˆå¯†é’¥:</p><figure class="kz la lb lc fd ld er es paragraph-image"><div class="er es lu"><img src="../Images/de07f1045cdeb4459426be6d119ad355.png" data-original-src="https://miro.medium.com/v2/resize:fit:1308/format:webp/1*hvsrDQWQCwRWZdyoGKtpew.png"/></div><figcaption class="lg lh et er es li lj bd b be z dx translated">SSHå¯†é’¥</figcaption></figure><p id="be37" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">å¦‚æœæ‚¨ä¸ç†Ÿæ‚‰SSHå…¬é’¥çš„æ ¼å¼ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„catå‘½ä»¤æ˜¾ç¤ºæ‚¨çš„å…¬é’¥ï¼Œæ›¿æ¢'<em class="lv"> ~/ã€‚ssh/id_rsa.pub </em>ï¼Œå¦‚æœéœ€è¦çš„è¯ï¼Œå¸¦æœ‰æ‚¨è‡ªå·±çš„å…¬é’¥æ–‡ä»¶çš„è·¯å¾„å’Œæ–‡ä»¶å:</p><pre class="kz la lb lc fd lk ll lm ln aw lo bi"><span id="d24e" class="lp je hi ll b fi lq lr l ls lt">cat ~/.ssh/flowmon-priv-key.pub</span></pre><p id="39b0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ä¸Šé¢çš„å‘½ä»¤å°†åœ¨æ§åˆ¶å°ä¸­æ˜¾ç¤ºSSHå…¬é’¥ã€‚æˆ‘ä»¬å°†åœ¨éƒ¨ç½²æœŸé—´éœ€è¦å®ƒï¼Œæ‰€ä»¥è¯·å°†å®ƒæ”¾åœ¨æ‰‹è¾¹ã€‚</p><p id="e422" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">é…·ï¼ç°åœ¨æˆ‘ä»¬æœ‰äº†SSHå¯†é’¥å¯¹ã€‚</p><p id="3b80" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æ‚¨å¿…é¡»æ¥å—Kemp Flowmonæ”¶é›†å™¨çš„è®¸å¯æ¡æ¬¾ã€‚ç”±äºè¿™æ˜¯ä»å¸‚åœºéƒ¨ç½²çš„è™šæ‹Ÿæœºï¼Œæˆ‘ä»¬å¿…é¡»åœ¨éƒ¨ç½²è¯¥è®¾å¤‡ä¹‹å‰æ¥å—æ¡æ¬¾ã€‚</p><p id="edb7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æˆ‘ä»¬å¯ä»¥ä½¿ç”¨PowerShellé€šè¿‡ä¸‹é¢çš„cmdletæ¥å—æ¡æ¬¾å’Œæ¡ä»¶:</p><pre class="kz la lb lc fd lk ll lm ln aw lo bi"><span id="e169" class="lp je hi ll b fi lq lr l ls lt">Get-AzMarketplaceTerms `<br/>-Publisher 'flowmon' `<br/>-Product 'flowmon_collector' `<br/>-Name 'v1101-byol' |<br/>Set-AzMarketplaceTerms -Accept</span></pre><p id="a521" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æ—¢ç„¶æˆ‘ä»¬å·²ç»æ¥å—äº†å¸‚åœºæ¡æ¬¾ï¼Œç°åœ¨è®©æˆ‘ä»¬å¼€å§‹åˆ¶ä½œæˆ‘ä»¬çš„äºŒå¤´è‚Œæ¨¡æ¿ã€‚</p><h1 id="1766" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">2.AzureäºŒå¤´è‚Œæ¨¡æ¿-å‚æ•°</h1><p id="33fc" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">æˆ‘ä»¬å°†é€šè¿‡å®šä¹‰è™šæ‹Ÿæœºçš„å‚æ•°æ¥å®šä¹‰startã€‚</p><p id="e371" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ä¸‹é¢çš„ä»£ç æ˜¾ç¤ºäº†æ­¤éƒ¨ç½²è¦ä½¿ç”¨çš„å‚æ•°:</p><pre class="kz la lb lc fd lk ll lm ln aw lo bi"><span id="73b6" class="lp je hi ll b fi lq lr l ls lt">// The name of your Virtual Machine.<br/>param vmName string = 'flowmonVm'</span><span id="78e2" class="lp je hi ll b fi lw lr l ls lt">// Username for the Virtual Machine.<br/>param adminUsername string</span><span id="725a" class="lp je hi ll b fi lw lr l ls lt">// Type of authentication to use on the Virtual Machine. SSH key is recommended.<br/>param authenticationType string = 'sshPublicKey'</span><span id="96e1" class="lp je hi ll b fi lw lr l ls lt">// SSH Key or password for the Virtual Machine. SSH key is recommended.<br/><a class="ae kx" href="http://twitter.com/secure" rel="noopener ugc nofollow" target="_blank">@secure</a>()<br/>param adminPasswordOrKey string</span><span id="3bda" class="lp je hi ll b fi lw lr l ls lt">// Unique DNS Name for the Public IP used to access the Virtual Machine.<br/>param dnsLabelPrefix string = toLower('flowmon-${uniqueString(resourceGroup().id)}')</span><span id="e1c6" class="lp je hi ll b fi lw lr l ls lt">// Location for all resources.<br/>param location string = resourceGroup().location</span><span id="551f" class="lp je hi ll b fi lw lr l ls lt">// The size of the VM.<br/>param vmSize string = 'Standard_B4ms'</span><span id="ceee" class="lp je hi ll b fi lw lr l ls lt">// Name of the VNET.<br/>param virtualNetworkName string = 'vNet'</span><span id="8497" class="lp je hi ll b fi lw lr l ls lt">// Name of the subnet in the virtual network.<br/>param subnetName string = 'Subnet'</span><span id="219e" class="lp je hi ll b fi lw lr l ls lt">// Name of the Network Security Group.<br/>param networkSecurityGroupName string = 'SecGroupNet'</span></pre><p id="1f17" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æ³¨æ„ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ª<em class="lv"> "@secure()" </em>è£…é¥°å™¨æ¥å®‰å…¨åœ°ä¼ é€’SSHå¯†é’¥ã€‚æˆ‘å»ºè®®æ‚¨çœ‹çœ‹è¿™ç¯‡å…³äºå¦‚ä½•åˆ©ç”¨<a class="ae kx" rel="noopener" href="/codex/azure-bicep-secure-secrets-in-parameters-secure-decorator-ce6317cc0c23"> <em class="lv"> @secure() </em>è£…é¥°å™¨</a>å®‰å…¨åœ°ä¼ é€’å‚æ•°ä¸­çš„ç§˜å¯†çš„æ–‡ç« ã€‚</p><h1 id="900b" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">3.AzureäºŒå¤´è‚Œæ¨¡æ¿-å˜é‡</h1><p id="bceb" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†å®šä¹‰å‡ ä¸ªå˜é‡:</p><pre class="kz la lb lc fd lk ll lm ln aw lo bi"><span id="714b" class="lp je hi ll b fi lq lr l ls lt">var publicIPAddressName = '${vmName}PublicIP'<br/>var networkInterfaceName = '${vmName}Nic'<br/>var subnetRef = '${vnet.id}/subnets/${subnetName}'<br/>var osDiskType = 'Standard_LRS'<br/>var subnetAddressPrefix = '10.5.0.0/24'<br/>var addressPrefix = '10.5.0.0/16'<br/>var linuxConfiguration = {<br/>  disablePasswordAuthentication: true<br/>  ssh: {<br/>    publicKeys: [<br/>      {<br/>        path: '/home/${adminUsername}/.ssh/authorized_keys'<br/>        keyData: adminPasswordOrKey<br/>      }<br/>    ]<br/>  }<br/>}</span></pre><p id="94f1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æ³¨æ„ï¼Œåœ¨å˜é‡"<em class="lv"> linuxConfiguration </em>ä¸­ï¼Œæˆ‘ä»¬ç¦ç”¨äº†å¯†ç è®¤è¯ï¼Œä¼ é€’äº†SSHå¯†é’¥è·¯å¾„ï¼Œå¹¶å¼•ç”¨äº†å¯†é’¥å€¼ã€‚</p><h1 id="4c9c" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">4.AzureäºŒå¤´è‚Œæ¨¡æ¿â€”ç½‘ç»œ</h1><p id="bae5" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">ä¸‹ä¸€æ­¥æ˜¯å®šä¹‰ç½‘ç»œæ¥å£ã€‚æ‚¨å¯ä»¥æ ¹æ®éœ€è¦åˆ›å»ºæ›´å¤šæ¥å£ã€‚</p><pre class="kz la lb lc fd lk ll lm ln aw lo bi"><span id="3060" class="lp je hi ll b fi lq lr l ls lt">resource nic 'Microsoft.Network/networkInterfaces@2020-06-01' = {<br/>  name: networkInterfaceName<br/>  location: location<br/>  properties: {<br/>    ipConfigurations: [<br/>      {<br/>        name: 'ipconfig1'<br/>        properties: {<br/>          subnet: {<br/>            id: subnetRef<br/>          }<br/>          privateIPAllocationMethod: 'Dynamic'<br/>          publicIPAddress: {<br/>            id: publicIP.id<br/>          }<br/>        }<br/>      }<br/>    ]<br/>    networkSecurityGroup: {<br/>      id: nsg.id<br/>    }<br/>  }<br/>}</span></pre><p id="d7e3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ç„¶åï¼Œæˆ‘ä»¬å°†å®šä¹‰å…è®¸æˆ–æ‹’ç»è®¿é—®è¯¥è™šæ‹Ÿæœºçš„å®‰å…¨è§„åˆ™ã€‚Kemp Flowmonæ”¶é›†å™¨éœ€è¦ä¸€äº›è§„åˆ™æ¥æ¥æ”¶æ¥è‡ªä¸åŒæ¥æºçš„æµé‡:</p><pre class="kz la lb lc fd lk ll lm ln aw lo bi"><span id="d2be" class="lp je hi ll b fi lq lr l ls lt">resource nsg 'Microsoft.Network/networkSecurityGroups@2020-06-01' = {<br/>  name: networkSecurityGroupName<br/>  location: location<br/>  properties: {<br/>    securityRules: [<br/>      {<br/>           name: 'SSH'<br/>           properties : {<br/>               protocol : 'Tcp' <br/>               sourcePortRange :  '*'<br/>               destinationPortRange :  '22'<br/>               sourceAddressPrefix :  '*'<br/>               destinationAddressPrefix: '*'<br/>               access:  'Allow'<br/>               priority : 1010<br/>               direction : 'Inbound'<br/>               sourcePortRanges : []<br/>               destinationPortRanges : []<br/>               sourceAddressPrefixes : []<br/>               destinationAddressPrefixes : []<br/>          }<br/>      }<br/>      {<br/>           name : 'HTTPS'<br/>           properties : {<br/>               protocol :  'Tcp'<br/>               sourcePortRange :  '*'<br/>               destinationPortRange :  '443'<br/>               sourceAddressPrefix :  '*'<br/>               destinationAddressPrefix :  '*'<br/>               access :  'Allow'<br/>               priority : 1020<br/>               direction :  'Inbound'<br/>               sourcePortRanges : []<br/>               destinationPortRanges : []<br/>               sourceAddressPrefixes : []<br/>               destinationAddressPrefixes : []<br/>          }<br/>      }<br/>      {<br/>           name :  'Collector'<br/>           properties : {<br/>               protocol :  'Udp'<br/>               sourcePortRange :  '*'<br/>               destinationPortRange :  '3000'<br/>               sourceAddressPrefix :  '*'<br/>               destinationAddressPrefix :  '*'<br/>               access :  'Allow'<br/>               priority : 103<br/>               direction :  'Inbound'<br/>               sourcePortRanges : []<br/>               destinationPortRanges : []<br/>               sourceAddressPrefixes : []<br/>               destinationAddressPrefixes : []<br/>          }<br/>      }<br/>    ]<br/>  }<br/>}</span></pre><p id="c325" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">å®‰å…¨è§„åˆ™å°±ç»ªåï¼Œæˆ‘ä»¬å°†ç»§ç»­å®šä¹‰è™šæ‹Ÿç½‘ç»œ:</p><pre class="kz la lb lc fd lk ll lm ln aw lo bi"><span id="8dfc" class="lp je hi ll b fi lq lr l ls lt">resource vnet 'Microsoft.Network/virtualNetworks@2020-06-01' = {<br/>  name: virtualNetworkName<br/>  location: location<br/>  properties: {<br/>    addressSpace: {<br/>      addressPrefixes: [<br/>        addressPrefix<br/>      ]<br/>    }<br/>    subnets: [<br/>      {<br/>        name: subnetName<br/>        properties: {<br/>          addressPrefix: subnetAddressPrefix<br/>          privateEndpointNetworkPolicies: 'Enabled'<br/>          privateLinkServiceNetworkPolicies: 'Enabled'<br/>        }<br/>      }<br/>    ]<br/>  }<br/>}</span></pre><p id="52e9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ä¸‹ä¸€æ­¥æ˜¯å®šä¹‰å…¬å…±IPåœ°å€ã€‚æ ¹æ®æ‚¨çš„ç¯å¢ƒï¼Œæ‚¨å¯ä»¥ä»…å¯ç”¨ç§æœ‰IPï¼›å¯¹äºæœ¬ä¾‹ï¼Œæˆ‘ä»¬å°†å®šä¹‰ä¸€ä¸ªå…¬å…±IP</p><pre class="kz la lb lc fd lk ll lm ln aw lo bi"><span id="71cb" class="lp je hi ll b fi lq lr l ls lt">resource publicIP 'Microsoft.Network/publicIPAddresses@2020-06-01' = {<br/>  name: publicIPAddressName<br/>  location: location<br/>  properties: {<br/>    publicIPAllocationMethod: 'Dynamic'<br/>    publicIPAddressVersion: 'IPv4'<br/>    dnsSettings: {<br/>      domainNameLabel: dnsLabelPrefix<br/>    }<br/>    idleTimeoutInMinutes: 4<br/>  }<br/>  sku: {<br/>    name: 'Basic'<br/>  }<br/>}</span></pre><p id="5444" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ä¸€æ—¦æˆ‘ä»¬å®šä¹‰äº†å‰é¢çš„èµ„æºï¼Œæœ€åè¦å®šä¹‰çš„èµ„æºå°±æ˜¯è™šæ‹Ÿæœºã€‚</p><h1 id="681f" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">5.AzureäºŒå¤´è‚Œæ¨¡æ¿â€”è™šæ‹Ÿæœº</h1><p id="0180" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">ä¸‹é¢çš„ä»£ç æ˜¾ç¤ºäº†è™šæ‹Ÿæœºçš„å®šä¹‰ã€‚</p><pre class="kz la lb lc fd lk ll lm ln aw lo bi"><span id="0f21" class="lp je hi ll b fi lq lr l ls lt">resource vm 'Microsoft.Compute/virtualMachines@2021-03-01' = {<br/>  name: vmName<br/>  location: location<br/>  properties: {<br/>    hardwareProfile: {<br/>      vmSize: vmSize<br/>    }<br/>    storageProfile: {<br/>      osDisk: {<br/>        createOption: 'FromImage'<br/>        managedDisk: {<br/>          storageAccountType: osDiskType<br/>        }<br/>      }<br/>      imageReference: {<br/>        publisher: 'flowmon'<br/>        offer: 'flowmon_collector'<br/>        sku: 'v1101-byol'<br/>        version: 'latest'<br/>      }<br/>    }<br/>    networkProfile: {<br/>      networkInterfaces: [<br/>        {<br/>          id: nic.id<br/>        }<br/>      ]<br/>    }<br/>    osProfile: {<br/>      computerName: vmName<br/>      adminUsername: adminUsername<br/>      adminPassword: adminPasswordOrKey<br/>      linuxConfiguration: any(authenticationType == 'password' ? null : linuxConfiguration)<br/>    }<br/>    diagnosticsProfile: {<br/>      bootDiagnostics: {<br/>        enabled: true<br/>      }<br/>    }<br/>  }<br/>  plan: {<br/>    name: 'v1101-byol'<br/>    publisher: 'flowmon'<br/>    product: 'flowmon_collector'<br/>  }<br/>}</span></pre><p id="c485" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">è¯·æ³¨æ„ï¼ŒKemp Flowmonè™šæ‹Ÿæœºå¿…é¡»åŒ…æ‹¬è®¡åˆ’çš„å®šä¹‰ï¼Œå¹¶ä¸”åŒ…æ‹¬:åç§°ã€å‘å¸ƒè€…å’Œäº§å“ã€‚</p><p id="517a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æœ€åï¼Œæˆ‘ä»¬å°†åŒ…æ‹¬ç®¡ç†å‘˜ç”¨æˆ·åçš„è¾“å‡ºï¼Œå¦‚ä¸‹æ‰€ç¤º:</p><pre class="kz la lb lc fd lk ll lm ln aw lo bi"><span id="bc60" class="lp je hi ll b fi lq lr l ls lt">output administratorUsername string = adminUsername</span></pre><h1 id="3c4d" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">6.AzureäºŒå¤´è‚Œéƒ¨ç½²</h1><p id="c715" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">ä½œä¸ºæœ€ä½³å®è·µï¼Œæˆ‘å»ºè®®æ‚¨ä½¿ç”¨æ ‡å¿—-Cé¢„è§ˆéƒ¨ç½²ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥å¯ç”¨éƒ¨ç½²é¢„è§ˆ:</p><pre class="kz la lb lc fd lk ll lm ln aw lo bi"><span id="b59b" class="lp je hi ll b fi lq lr l ls lt">$date = Get-Date -Format "MM-dd-yyyy"<br/>$deploymentName = "AzInsiderDeployment"+"$date"</span><span id="0ed4" class="lp je hi ll b fi lw lr l ls lt">New-AzResourceGroupDeployment -Name $deploymentName -ResourceGroupName azinsider_demo -TemplateFile .\main.bicep -TemplateParameterFile .\azuredeploy.parameters.json -c</span></pre><p id="098a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æ³¨æ„ï¼Œæˆ‘ä»¬åœ¨å‘½ä»¤çš„æœ«å°¾æ·»åŠ äº†æ ‡å¿—-cï¼›è¿™å°†å¯ç”¨å‡è®¾éªŒè¯ã€‚è¿™æ ·ï¼Œæ‚¨å¯ä»¥åœ¨è¿›è¡Œå®é™…éƒ¨ç½²ä¹‹å‰é¢„è§ˆéƒ¨ç½²æ“ä½œã€‚</p><p id="3fcb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">åœ¨éƒ¨ç½²æ—¶ï¼Œä¼šè¦æ±‚æ‚¨è¾“å…¥adminUsernameã€‚è¯¥å€¼å¿…é¡»æ˜¯â€œ<em class="lv"> flowmon </em>â€ã€‚è¿™æ˜¯Kemp Flowmonè®¾å¤‡çš„ç‰¹å®šé…ç½®ã€‚</p><p id="62cb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ç„¶åæˆ‘ä»¬å°†æä¾›SSHå…¬é’¥ã€‚è¯¥å€¼ä½œä¸ºå®‰å…¨å‚æ•°ä¼ é€’ã€‚</p><p id="cf23" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ä¸‹å›¾æ˜¾ç¤ºäº†éƒ¨ç½²çš„é¢„è§ˆ:</p><figure class="kz la lb lc fd ld er es paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="er es lx"><img src="../Images/32202c4e26aee800617c9dae64e56004.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jZTd9WLjGAnTPc3qp6j1YQ.png"/></div></div><figcaption class="lg lh et er es li lj bd b be z dx translated">Azure Bicep â€”éƒ¨ç½²é¢„è§ˆ</figcaption></figure><p id="0313" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ä¸€æ—¦æ‰€æœ‰çš„é…ç½®éƒ½æ­£ç¡®ï¼Œæˆ‘ä»¬å°†ç»§ç»­è¿›è¡Œéƒ¨ç½²ã€‚ä¸‹å›¾æ˜¾ç¤ºäº†éƒ¨ç½²çš„è¾“å‡º:</p><figure class="kz la lb lc fd ld er es paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="er es mc"><img src="../Images/1382f9c8305dfe81b49b3146b9a95a78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ys_XxLySEWQ4SCJ9N3eMRw.png"/></div></div><figcaption class="lg lh et er es li lj bd b be z dx translated">Azure Bicep â€” Kemp Flowmonéƒ¨ç½²</figcaption></figure><p id="2c24" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ç°åœ¨å¯ä»¥é€šè¿‡<a class="ae kx" href="https://Your-IP-Address." rel="noopener ugc nofollow" target="_blank"> https://Your-IP-Addressè®¿é—®è™šæ‹Ÿæœºã€‚</a></p><figure class="kz la lb lc fd ld er es paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="er es md"><img src="../Images/23af48b42b2fa534f3a21c8681393515.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G_DxnY_nLJeQiLl-fwmDHg.png"/></div></div><figcaption class="lg lh et er es li lj bd b be z dx translated">è‚¯æ™®Â·å¼—æ´›è’™Â·å¤©è“è‰²</figcaption></figure><p id="29c0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">éƒ¨ç½²ä¹‹åï¼Œæˆ‘å»ºè®®æ‚¨é€šè¿‡SSHè®¿é—®è¯¥è®¾å¤‡ï¼Œå¹¶ä¿®æ”¹GUIç”¨æˆ·å¯†ç ä»¥è®¿é—®Webç”¨æˆ·ç•Œé¢ã€‚</p><p id="58b6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">å®Œæ•´çš„äºŒå¤´è‚Œæ¨¡æ¿å¦‚ä¸‹æ‰€ç¤º:</p><pre class="kz la lb lc fd lk ll lm ln aw lo bi"><span id="f966" class="lp je hi ll b fi lq lr l ls lt">// The name of your Virtual Machine.<br/>param vmName string = 'flowmonVm'</span><span id="c3b2" class="lp je hi ll b fi lw lr l ls lt">// Username for the Virtual Machine.<br/>param adminUsername string</span><span id="2cee" class="lp je hi ll b fi lw lr l ls lt">// Type of authentication to use on the Virtual Machine. SSH key is recommended.<br/>param authenticationType string = 'sshPublicKey'</span><span id="f2fc" class="lp je hi ll b fi lw lr l ls lt">// SSH Key or password for the Virtual Machine. SSH key is recommended.<br/><a class="ae kx" href="http://twitter.com/secure" rel="noopener ugc nofollow" target="_blank">@secure</a>()<br/>param adminPasswordOrKey string</span><span id="c007" class="lp je hi ll b fi lw lr l ls lt">// Unique DNS Name for the Public IP used to access the Virtual Machine.<br/>param dnsLabelPrefix string = toLower('flowmon-${uniqueString(resourceGroup().id)}')</span><span id="fff5" class="lp je hi ll b fi lw lr l ls lt">// Location for all resources.<br/>param location string = resourceGroup().location</span><span id="9d6b" class="lp je hi ll b fi lw lr l ls lt">// The size of the VM.<br/>param vmSize string = 'Standard_B4ms'</span><span id="2f51" class="lp je hi ll b fi lw lr l ls lt">// Name of the VNET.<br/>param virtualNetworkName string = 'vNet'</span><span id="f325" class="lp je hi ll b fi lw lr l ls lt">// Name of the subnet in the virtual network.<br/>param subnetName string = 'Subnet'</span><span id="b64f" class="lp je hi ll b fi lw lr l ls lt">// Name of the Network Security Group.<br/>param networkSecurityGroupName string = 'SecGroupNet'</span><span id="7f1c" class="lp je hi ll b fi lw lr l ls lt">var publicIPAddressName = '${vmName}PublicIP'<br/>var networkInterfaceName = '${vmName}Nic'<br/>var subnetRef = '${vnet.id}/subnets/${subnetName}'<br/>var osDiskType = 'Standard_LRS'<br/>var subnetAddressPrefix = '10.5.0.0/24'<br/>var addressPrefix = '10.5.0.0/16'<br/>var linuxConfiguration = {<br/>  disablePasswordAuthentication: true<br/>  ssh: {<br/>    publicKeys: [<br/>      {<br/>        path: '/home/${adminUsername}/.ssh/authorized_keys'<br/>        keyData: adminPasswordOrKey<br/>      }<br/>    ]<br/>  }<br/>}</span><span id="6e9a" class="lp je hi ll b fi lw lr l ls lt">resource nic 'Microsoft.Network/networkInterfaces@2020-06-01' = {<br/>  name: networkInterfaceName<br/>  location: location<br/>  properties: {<br/>    ipConfigurations: [<br/>      {<br/>        name: 'ipconfig1'<br/>        properties: {<br/>          subnet: {<br/>            id: subnetRef<br/>          }<br/>          privateIPAllocationMethod: 'Dynamic'<br/>          publicIPAddress: {<br/>            id: publicIP.id<br/>          }<br/>        }<br/>      }<br/>    ]<br/>    networkSecurityGroup: {<br/>      id: nsg.id<br/>    }<br/>  }<br/>}</span><span id="326c" class="lp je hi ll b fi lw lr l ls lt">resource nsg 'Microsoft.Network/networkSecurityGroups@2020-06-01' = {<br/>  name: networkSecurityGroupName<br/>  location: location<br/>  properties: {<br/>    securityRules: [<br/>      {<br/>           name: 'SSH'<br/>           properties : {<br/>               protocol : 'Tcp' <br/>               sourcePortRange :  '*'<br/>               destinationPortRange :  '22'<br/>               sourceAddressPrefix :  '*'<br/>               destinationAddressPrefix: '*'<br/>               access:  'Allow'<br/>               priority : 1010<br/>               direction : 'Inbound'<br/>               sourcePortRanges : []<br/>               destinationPortRanges : []<br/>               sourceAddressPrefixes : []<br/>               destinationAddressPrefixes : []<br/>          }<br/>      }<br/>      {<br/>           name : 'HTTPS'<br/>           properties : {<br/>               protocol :  'Tcp'<br/>               sourcePortRange :  '*'<br/>               destinationPortRange :  '443'<br/>               sourceAddressPrefix :  '*'<br/>               destinationAddressPrefix :  '*'<br/>               access :  'Allow'<br/>               priority : 1020<br/>               direction :  'Inbound'<br/>               sourcePortRanges : []<br/>               destinationPortRanges : []<br/>               sourceAddressPrefixes : []<br/>               destinationAddressPrefixes : []<br/>          }<br/>      }<br/>      {<br/>           name :  'Collector'<br/>           properties : {<br/>               protocol :  'Udp'<br/>               sourcePortRange :  '*'<br/>               destinationPortRange :  '3000'<br/>               sourceAddressPrefix :  '*'<br/>               destinationAddressPrefix :  '*'<br/>               access :  'Allow'<br/>               priority : 103<br/>               direction :  'Inbound'<br/>               sourcePortRanges : []<br/>               destinationPortRanges : []<br/>               sourceAddressPrefixes : []<br/>               destinationAddressPrefixes : []<br/>          }<br/>      }<br/>   ]<br/>  }<br/>}</span><span id="e57e" class="lp je hi ll b fi lw lr l ls lt">resource vnet 'Microsoft.Network/virtualNetworks@2020-06-01' = {<br/>  name: virtualNetworkName<br/>  location: location<br/>  properties: {<br/>    addressSpace: {<br/>      addressPrefixes: [<br/>        addressPrefix<br/>      ]<br/>    }<br/>    subnets: [<br/>      {<br/>        name: subnetName<br/>        properties: {<br/>          addressPrefix: subnetAddressPrefix<br/>          privateEndpointNetworkPolicies: 'Enabled'<br/>          privateLinkServiceNetworkPolicies: 'Enabled'<br/>        }<br/>      }<br/>    ]<br/>  }<br/>}</span><span id="ee4f" class="lp je hi ll b fi lw lr l ls lt">resource publicIP 'Microsoft.Network/publicIPAddresses@2020-06-01' = {<br/>  name: publicIPAddressName<br/>  location: location<br/>  properties: {<br/>    publicIPAllocationMethod: 'Dynamic'<br/>    publicIPAddressVersion: 'IPv4'<br/>    dnsSettings: {<br/>      domainNameLabel: dnsLabelPrefix<br/>    }<br/>    idleTimeoutInMinutes: 4<br/>  }<br/>  sku: {<br/>    name: 'Basic'<br/>  }<br/>}</span><span id="025d" class="lp je hi ll b fi lw lr l ls lt">resource vm 'Microsoft.Compute/virtualMachines@2021-03-01' = {<br/>  name: vmName<br/>  location: location<br/>  properties: {<br/>    hardwareProfile: {<br/>      vmSize: vmSize<br/>    }<br/>    storageProfile: {<br/>      osDisk: {<br/>        createOption: 'FromImage'<br/>        managedDisk: {<br/>          storageAccountType: osDiskType<br/>        }<br/>      }<br/>      imageReference: {<br/>        publisher: 'flowmon'<br/>        offer: 'flowmon_collector'<br/>        sku: 'v1101-byol'<br/>        version: 'latest'<br/>      }<br/>    }<br/>    networkProfile: {<br/>      networkInterfaces: [<br/>        {<br/>          id: nic.id<br/>        }<br/>      ]<br/>    }<br/>    osProfile: {<br/>      computerName: vmName<br/>      adminUsername: adminUsername<br/>      adminPassword: adminPasswordOrKey<br/>      linuxConfiguration: any(authenticationType == 'password' ? null : linuxConfiguration)<br/>    }<br/>    diagnosticsProfile: {<br/>      bootDiagnostics: {<br/>        enabled: true<br/>      }<br/>    }<br/>  }<br/>  plan: {<br/>    name: 'v1101-byol'<br/>    publisher: 'flowmon'<br/>    product: 'flowmon_collector'<br/>  }<br/>}</span><span id="9872" class="lp je hi ll b fi lw lr l ls lt">output administratorUsername string = adminUsername</span></pre><p id="4e31" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æˆ‘å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¸®åŠ©ä½ è¸ä¸ŠBicepä¹‹æ—…ï¼Œä»¥åŠå¦‚ä½•åˆ©ç”¨Bicepåœ¨Azureä¸­éƒ¨ç½²åŸºäºLinuxçš„è™šæ‹Ÿæœºã€‚</p><p id="a7bb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae kx" href="http://eepurl.com/gKmLdf" rel="noopener ugc nofollow" target="_blank"> <em class="lv">åœ¨æ­¤åŠ å…¥</em><strong class="ih hj"><em class="lv">azin sider</em></strong><em class="lv">é‚®ç®±åˆ—è¡¨ã€‚</em>T9ã€‘</a></p><p id="8612" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="lv">-æˆ´å¤«Â·rÂ·</em></p></div></div>    
</body>
</html>