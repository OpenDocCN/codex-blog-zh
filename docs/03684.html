<html>
<head>
<title>💪Creating a Linux virtual machine with Azure Bicep — template</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">💪使用Azure Bicep创建Linux虚拟机—模板</h1>
<blockquote>原文：<a href="https://medium.com/codex/how-to-create-a-linux-virtual-machine-with-azure-bicep-template-e22f50f2baea?source=collection_archive---------1-----------------------#2021-09-16">https://medium.com/codex/how-to-create-a-linux-virtual-machine-with-azure-bicep-template-e22f50f2baea?source=collection_archive---------1-----------------------#2021-09-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="e668" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">今天，我们将创建一个Azure Bicep模板来配置基于Linux的虚拟机。</p><p id="e89b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">本文的主要目的是让您了解如何使用Azure Bicep来部署基于Linux的虚拟机。在这种情况下，我们将编写一个Bicep模板来在Azure中部署Kemp Flowmon。</p><h1 id="8194" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">概观</h1><p id="9f93" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">在Azure上部署这个基于Linux的虚拟机之后，我们可以期待什么？我们将部署Kemp Flowmon收集器设备，这是一个很好的例子，因为它是基于Linux的机器，将为您提供预测网络性能监控和网络检测及响应功能。</p><p id="ad85" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">本文将关注如何利用Azure Bicep模板来简化这个基于Linux的虚拟机在Azure上的部署。</p><h1 id="e4cd" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">先决条件。</h1><ul class=""><li id="a587" class="kg kh hi ih b ii kb im kc iq ki iu kj iy kk jc kl km kn ko bi translated">有效的Azure订阅。</li><li id="69fc" class="kg kh hi ih b ii kp im kq iq kr iu ks iy kt jc kl km kn ko bi translated">拥有所有者/贡献者角色的用户</li><li id="1cfa" class="kg kh hi ih b ii kp im kq iq kr iu ks iy kt jc kl km kn ko bi translated">资源组</li></ul><p id="43dd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们开始吧！</p><p id="8e7b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在Azure中创建基于Linux的虚拟机包括几个步骤:</p><ul class=""><li id="2d6c" class="kg kh hi ih b ii ij im in iq ku iu kv iy kw jc kl km kn ko bi translated">创建资源组</li><li id="d97a" class="kg kh hi ih b ii kp im kq iq kr iu ks iy kt jc kl km kn ko bi translated">创建虚拟机及其相关组件(虚拟网络、子网、网络接口、DNS、安全规则。)</li></ul><p id="d553" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意，这个特定的机器— Kemp Flowmon —只允许SSH验证。因此，我们将在Bicep模板中包含使用SSH进行身份验证的能力，而不是使用密码。</p><h1 id="c935" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">1.创建SSH密钥对</h1><p id="6c74" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">第一步是创建一个SSH密钥对；您可以查看以下关于如何在Azure中为Linux虚拟机创建SSH密钥对的文章—<a class="ae kx" href="https://docs.microsoft.com/en-us/azure/virtual-machines/linux/mac-create-ssh-keys" rel="noopener ugc nofollow" target="_blank">https://docs . Microsoft . com/en-us/Azure/virtual-machines/Linux/MAC-create-SSH-keys</a></p><p id="9a74" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本例中，我们将使用Azure Bash控制台创建一个SSH密钥对。在Azure门户中，请求一个新的控制台，如下图所示:</p><figure class="kz la lb lc fd ld er es paragraph-image"><div class="er es ky"><img src="../Images/0b41554baac612720be6c4d4d1ec28bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1328/format:webp/1*yXPZ1Y8bu5lHXZFHdA9Uzg.png"/></div><figcaption class="lg lh et er es li lj bd b be z dx translated">Azure门户—控制台</figcaption></figure><p id="33b7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，我们将使用下面的命令生成一个SSH密钥:</p><pre class="kz la lb lc fd lk ll lm ln aw lo bi"><span id="2582" class="lp je hi ll b fi lq lr l ls lt">ssh-keygen \<br/>    -m PEM \<br/>    -t rsa \<br/>    -b 4096 \<br/>    -C "flowmon" \<br/>    -f ~/.ssh/flowmon-priv-key \<br/>    -N yourpasshphrase</span></pre><p id="aed4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这将在文件共享中的SSH目录下生成密钥:</p><figure class="kz la lb lc fd ld er es paragraph-image"><div class="er es lu"><img src="../Images/de07f1045cdeb4459426be6d119ad355.png" data-original-src="https://miro.medium.com/v2/resize:fit:1308/format:webp/1*hvsrDQWQCwRWZdyoGKtpew.png"/></div><figcaption class="lg lh et er es li lj bd b be z dx translated">SSH密钥</figcaption></figure><p id="be37" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您不熟悉SSH公钥的格式，可以使用下面的cat命令显示您的公钥，替换'<em class="lv"> ~/。ssh/id_rsa.pub </em>，如果需要的话，带有您自己的公钥文件的路径和文件名:</p><pre class="kz la lb lc fd lk ll lm ln aw lo bi"><span id="d24e" class="lp je hi ll b fi lq lr l ls lt">cat ~/.ssh/flowmon-priv-key.pub</span></pre><p id="39b0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上面的命令将在控制台中显示SSH公钥。我们将在部署期间需要它，所以请将它放在手边。</p><p id="e422" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">酷！现在我们有了SSH密钥对。</p><p id="3b80" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您必须接受Kemp Flowmon收集器的许可条款。由于这是从市场部署的虚拟机，我们必须在部署该设备之前接受条款。</p><p id="edb7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以使用PowerShell通过下面的cmdlet接受条款和条件:</p><pre class="kz la lb lc fd lk ll lm ln aw lo bi"><span id="e169" class="lp je hi ll b fi lq lr l ls lt">Get-AzMarketplaceTerms `<br/>-Publisher 'flowmon' `<br/>-Product 'flowmon_collector' `<br/>-Name 'v1101-byol' |<br/>Set-AzMarketplaceTerms -Accept</span></pre><p id="a521" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">既然我们已经接受了市场条款，现在让我们开始制作我们的二头肌模板。</p><h1 id="1766" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">2.Azure二头肌模板-参数</h1><p id="33fc" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">我们将通过定义虚拟机的参数来定义start。</p><p id="e371" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面的代码显示了此部署要使用的参数:</p><pre class="kz la lb lc fd lk ll lm ln aw lo bi"><span id="73b6" class="lp je hi ll b fi lq lr l ls lt">// The name of your Virtual Machine.<br/>param vmName string = 'flowmonVm'</span><span id="78e2" class="lp je hi ll b fi lw lr l ls lt">// Username for the Virtual Machine.<br/>param adminUsername string</span><span id="725a" class="lp je hi ll b fi lw lr l ls lt">// Type of authentication to use on the Virtual Machine. SSH key is recommended.<br/>param authenticationType string = 'sshPublicKey'</span><span id="96e1" class="lp je hi ll b fi lw lr l ls lt">// SSH Key or password for the Virtual Machine. SSH key is recommended.<br/><a class="ae kx" href="http://twitter.com/secure" rel="noopener ugc nofollow" target="_blank">@secure</a>()<br/>param adminPasswordOrKey string</span><span id="3bda" class="lp je hi ll b fi lw lr l ls lt">// Unique DNS Name for the Public IP used to access the Virtual Machine.<br/>param dnsLabelPrefix string = toLower('flowmon-${uniqueString(resourceGroup().id)}')</span><span id="e1c6" class="lp je hi ll b fi lw lr l ls lt">// Location for all resources.<br/>param location string = resourceGroup().location</span><span id="551f" class="lp je hi ll b fi lw lr l ls lt">// The size of the VM.<br/>param vmSize string = 'Standard_B4ms'</span><span id="ceee" class="lp je hi ll b fi lw lr l ls lt">// Name of the VNET.<br/>param virtualNetworkName string = 'vNet'</span><span id="8497" class="lp je hi ll b fi lw lr l ls lt">// Name of the subnet in the virtual network.<br/>param subnetName string = 'Subnet'</span><span id="219e" class="lp je hi ll b fi lw lr l ls lt">// Name of the Network Security Group.<br/>param networkSecurityGroupName string = 'SecGroupNet'</span></pre><p id="1f17" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意，我们使用了一个<em class="lv"> "@secure()" </em>装饰器来安全地传递SSH密钥。我建议您看看这篇关于如何利用<a class="ae kx" rel="noopener" href="/codex/azure-bicep-secure-secrets-in-parameters-secure-decorator-ce6317cc0c23"> <em class="lv"> @secure() </em>装饰器</a>安全地传递参数中的秘密的文章。</p><h1 id="900b" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">3.Azure二头肌模板-变量</h1><p id="bceb" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">接下来，我们将定义几个变量:</p><pre class="kz la lb lc fd lk ll lm ln aw lo bi"><span id="714b" class="lp je hi ll b fi lq lr l ls lt">var publicIPAddressName = '${vmName}PublicIP'<br/>var networkInterfaceName = '${vmName}Nic'<br/>var subnetRef = '${vnet.id}/subnets/${subnetName}'<br/>var osDiskType = 'Standard_LRS'<br/>var subnetAddressPrefix = '10.5.0.0/24'<br/>var addressPrefix = '10.5.0.0/16'<br/>var linuxConfiguration = {<br/>  disablePasswordAuthentication: true<br/>  ssh: {<br/>    publicKeys: [<br/>      {<br/>        path: '/home/${adminUsername}/.ssh/authorized_keys'<br/>        keyData: adminPasswordOrKey<br/>      }<br/>    ]<br/>  }<br/>}</span></pre><p id="94f1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意，在变量"<em class="lv"> linuxConfiguration </em>中，我们禁用了密码认证，传递了SSH密钥路径，并引用了密钥值。</p><h1 id="4c9c" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">4.Azure二头肌模板—网络</h1><p id="bae5" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">下一步是定义网络接口。您可以根据需要创建更多接口。</p><pre class="kz la lb lc fd lk ll lm ln aw lo bi"><span id="3060" class="lp je hi ll b fi lq lr l ls lt">resource nic 'Microsoft.Network/networkInterfaces@2020-06-01' = {<br/>  name: networkInterfaceName<br/>  location: location<br/>  properties: {<br/>    ipConfigurations: [<br/>      {<br/>        name: 'ipconfig1'<br/>        properties: {<br/>          subnet: {<br/>            id: subnetRef<br/>          }<br/>          privateIPAllocationMethod: 'Dynamic'<br/>          publicIPAddress: {<br/>            id: publicIP.id<br/>          }<br/>        }<br/>      }<br/>    ]<br/>    networkSecurityGroup: {<br/>      id: nsg.id<br/>    }<br/>  }<br/>}</span></pre><p id="d7e3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，我们将定义允许或拒绝访问该虚拟机的安全规则。Kemp Flowmon收集器需要一些规则来接收来自不同来源的流量:</p><pre class="kz la lb lc fd lk ll lm ln aw lo bi"><span id="d2be" class="lp je hi ll b fi lq lr l ls lt">resource nsg 'Microsoft.Network/networkSecurityGroups@2020-06-01' = {<br/>  name: networkSecurityGroupName<br/>  location: location<br/>  properties: {<br/>    securityRules: [<br/>      {<br/>           name: 'SSH'<br/>           properties : {<br/>               protocol : 'Tcp' <br/>               sourcePortRange :  '*'<br/>               destinationPortRange :  '22'<br/>               sourceAddressPrefix :  '*'<br/>               destinationAddressPrefix: '*'<br/>               access:  'Allow'<br/>               priority : 1010<br/>               direction : 'Inbound'<br/>               sourcePortRanges : []<br/>               destinationPortRanges : []<br/>               sourceAddressPrefixes : []<br/>               destinationAddressPrefixes : []<br/>          }<br/>      }<br/>      {<br/>           name : 'HTTPS'<br/>           properties : {<br/>               protocol :  'Tcp'<br/>               sourcePortRange :  '*'<br/>               destinationPortRange :  '443'<br/>               sourceAddressPrefix :  '*'<br/>               destinationAddressPrefix :  '*'<br/>               access :  'Allow'<br/>               priority : 1020<br/>               direction :  'Inbound'<br/>               sourcePortRanges : []<br/>               destinationPortRanges : []<br/>               sourceAddressPrefixes : []<br/>               destinationAddressPrefixes : []<br/>          }<br/>      }<br/>      {<br/>           name :  'Collector'<br/>           properties : {<br/>               protocol :  'Udp'<br/>               sourcePortRange :  '*'<br/>               destinationPortRange :  '3000'<br/>               sourceAddressPrefix :  '*'<br/>               destinationAddressPrefix :  '*'<br/>               access :  'Allow'<br/>               priority : 103<br/>               direction :  'Inbound'<br/>               sourcePortRanges : []<br/>               destinationPortRanges : []<br/>               sourceAddressPrefixes : []<br/>               destinationAddressPrefixes : []<br/>          }<br/>      }<br/>    ]<br/>  }<br/>}</span></pre><p id="c325" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">安全规则就绪后，我们将继续定义虚拟网络:</p><pre class="kz la lb lc fd lk ll lm ln aw lo bi"><span id="8dfc" class="lp je hi ll b fi lq lr l ls lt">resource vnet 'Microsoft.Network/virtualNetworks@2020-06-01' = {<br/>  name: virtualNetworkName<br/>  location: location<br/>  properties: {<br/>    addressSpace: {<br/>      addressPrefixes: [<br/>        addressPrefix<br/>      ]<br/>    }<br/>    subnets: [<br/>      {<br/>        name: subnetName<br/>        properties: {<br/>          addressPrefix: subnetAddressPrefix<br/>          privateEndpointNetworkPolicies: 'Enabled'<br/>          privateLinkServiceNetworkPolicies: 'Enabled'<br/>        }<br/>      }<br/>    ]<br/>  }<br/>}</span></pre><p id="52e9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下一步是定义公共IP地址。根据您的环境，您可以仅启用私有IP；对于本例，我们将定义一个公共IP</p><pre class="kz la lb lc fd lk ll lm ln aw lo bi"><span id="71cb" class="lp je hi ll b fi lq lr l ls lt">resource publicIP 'Microsoft.Network/publicIPAddresses@2020-06-01' = {<br/>  name: publicIPAddressName<br/>  location: location<br/>  properties: {<br/>    publicIPAllocationMethod: 'Dynamic'<br/>    publicIPAddressVersion: 'IPv4'<br/>    dnsSettings: {<br/>      domainNameLabel: dnsLabelPrefix<br/>    }<br/>    idleTimeoutInMinutes: 4<br/>  }<br/>  sku: {<br/>    name: 'Basic'<br/>  }<br/>}</span></pre><p id="5444" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦我们定义了前面的资源，最后要定义的资源就是虚拟机。</p><h1 id="681f" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">5.Azure二头肌模板—虚拟机</h1><p id="0180" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">下面的代码显示了虚拟机的定义。</p><pre class="kz la lb lc fd lk ll lm ln aw lo bi"><span id="0f21" class="lp je hi ll b fi lq lr l ls lt">resource vm 'Microsoft.Compute/virtualMachines@2021-03-01' = {<br/>  name: vmName<br/>  location: location<br/>  properties: {<br/>    hardwareProfile: {<br/>      vmSize: vmSize<br/>    }<br/>    storageProfile: {<br/>      osDisk: {<br/>        createOption: 'FromImage'<br/>        managedDisk: {<br/>          storageAccountType: osDiskType<br/>        }<br/>      }<br/>      imageReference: {<br/>        publisher: 'flowmon'<br/>        offer: 'flowmon_collector'<br/>        sku: 'v1101-byol'<br/>        version: 'latest'<br/>      }<br/>    }<br/>    networkProfile: {<br/>      networkInterfaces: [<br/>        {<br/>          id: nic.id<br/>        }<br/>      ]<br/>    }<br/>    osProfile: {<br/>      computerName: vmName<br/>      adminUsername: adminUsername<br/>      adminPassword: adminPasswordOrKey<br/>      linuxConfiguration: any(authenticationType == 'password' ? null : linuxConfiguration)<br/>    }<br/>    diagnosticsProfile: {<br/>      bootDiagnostics: {<br/>        enabled: true<br/>      }<br/>    }<br/>  }<br/>  plan: {<br/>    name: 'v1101-byol'<br/>    publisher: 'flowmon'<br/>    product: 'flowmon_collector'<br/>  }<br/>}</span></pre><p id="c485" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请注意，Kemp Flowmon虚拟机必须包括计划的定义，并且包括:名称、发布者和产品。</p><p id="517a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，我们将包括管理员用户名的输出，如下所示:</p><pre class="kz la lb lc fd lk ll lm ln aw lo bi"><span id="bc60" class="lp je hi ll b fi lq lr l ls lt">output administratorUsername string = adminUsername</span></pre><h1 id="3c4d" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">6.Azure二头肌部署</h1><p id="c715" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">作为最佳实践，我建议您使用标志-C预览部署。我们将使用下面的命令来启用部署预览:</p><pre class="kz la lb lc fd lk ll lm ln aw lo bi"><span id="b59b" class="lp je hi ll b fi lq lr l ls lt">$date = Get-Date -Format "MM-dd-yyyy"<br/>$deploymentName = "AzInsiderDeployment"+"$date"</span><span id="0ed4" class="lp je hi ll b fi lw lr l ls lt">New-AzResourceGroupDeployment -Name $deploymentName -ResourceGroupName azinsider_demo -TemplateFile .\main.bicep -TemplateParameterFile .\azuredeploy.parameters.json -c</span></pre><p id="098a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意，我们在命令的末尾添加了标志-c；这将启用假设验证。这样，您可以在进行实际部署之前预览部署操作。</p><p id="3fcb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在部署时，会要求您输入adminUsername。该值必须是“<em class="lv"> flowmon </em>”。这是Kemp Flowmon设备的特定配置。</p><p id="62cb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后我们将提供SSH公钥。该值作为安全参数传递。</p><p id="cf23" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下图显示了部署的预览:</p><figure class="kz la lb lc fd ld er es paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="er es lx"><img src="../Images/32202c4e26aee800617c9dae64e56004.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jZTd9WLjGAnTPc3qp6j1YQ.png"/></div></div><figcaption class="lg lh et er es li lj bd b be z dx translated">Azure Bicep —部署预览</figcaption></figure><p id="0313" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦所有的配置都正确，我们将继续进行部署。下图显示了部署的输出:</p><figure class="kz la lb lc fd ld er es paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="er es mc"><img src="../Images/1382f9c8305dfe81b49b3146b9a95a78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ys_XxLySEWQ4SCJ9N3eMRw.png"/></div></div><figcaption class="lg lh et er es li lj bd b be z dx translated">Azure Bicep — Kemp Flowmon部署</figcaption></figure><p id="2c24" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在可以通过<a class="ae kx" href="https://Your-IP-Address." rel="noopener ugc nofollow" target="_blank"> https://Your-IP-Address访问虚拟机。</a></p><figure class="kz la lb lc fd ld er es paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="er es md"><img src="../Images/23af48b42b2fa534f3a21c8681393515.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G_DxnY_nLJeQiLl-fwmDHg.png"/></div></div><figcaption class="lg lh et er es li lj bd b be z dx translated">肯普·弗洛蒙·天蓝色</figcaption></figure><p id="29c0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">部署之后，我建议您通过SSH访问该设备，并修改GUI用户密码以访问Web用户界面。</p><p id="58b6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">完整的二头肌模板如下所示:</p><pre class="kz la lb lc fd lk ll lm ln aw lo bi"><span id="f966" class="lp je hi ll b fi lq lr l ls lt">// The name of your Virtual Machine.<br/>param vmName string = 'flowmonVm'</span><span id="c3b2" class="lp je hi ll b fi lw lr l ls lt">// Username for the Virtual Machine.<br/>param adminUsername string</span><span id="2cee" class="lp je hi ll b fi lw lr l ls lt">// Type of authentication to use on the Virtual Machine. SSH key is recommended.<br/>param authenticationType string = 'sshPublicKey'</span><span id="f2fc" class="lp je hi ll b fi lw lr l ls lt">// SSH Key or password for the Virtual Machine. SSH key is recommended.<br/><a class="ae kx" href="http://twitter.com/secure" rel="noopener ugc nofollow" target="_blank">@secure</a>()<br/>param adminPasswordOrKey string</span><span id="c007" class="lp je hi ll b fi lw lr l ls lt">// Unique DNS Name for the Public IP used to access the Virtual Machine.<br/>param dnsLabelPrefix string = toLower('flowmon-${uniqueString(resourceGroup().id)}')</span><span id="fff5" class="lp je hi ll b fi lw lr l ls lt">// Location for all resources.<br/>param location string = resourceGroup().location</span><span id="9d6b" class="lp je hi ll b fi lw lr l ls lt">// The size of the VM.<br/>param vmSize string = 'Standard_B4ms'</span><span id="2f51" class="lp je hi ll b fi lw lr l ls lt">// Name of the VNET.<br/>param virtualNetworkName string = 'vNet'</span><span id="f325" class="lp je hi ll b fi lw lr l ls lt">// Name of the subnet in the virtual network.<br/>param subnetName string = 'Subnet'</span><span id="b64f" class="lp je hi ll b fi lw lr l ls lt">// Name of the Network Security Group.<br/>param networkSecurityGroupName string = 'SecGroupNet'</span><span id="7f1c" class="lp je hi ll b fi lw lr l ls lt">var publicIPAddressName = '${vmName}PublicIP'<br/>var networkInterfaceName = '${vmName}Nic'<br/>var subnetRef = '${vnet.id}/subnets/${subnetName}'<br/>var osDiskType = 'Standard_LRS'<br/>var subnetAddressPrefix = '10.5.0.0/24'<br/>var addressPrefix = '10.5.0.0/16'<br/>var linuxConfiguration = {<br/>  disablePasswordAuthentication: true<br/>  ssh: {<br/>    publicKeys: [<br/>      {<br/>        path: '/home/${adminUsername}/.ssh/authorized_keys'<br/>        keyData: adminPasswordOrKey<br/>      }<br/>    ]<br/>  }<br/>}</span><span id="6e9a" class="lp je hi ll b fi lw lr l ls lt">resource nic 'Microsoft.Network/networkInterfaces@2020-06-01' = {<br/>  name: networkInterfaceName<br/>  location: location<br/>  properties: {<br/>    ipConfigurations: [<br/>      {<br/>        name: 'ipconfig1'<br/>        properties: {<br/>          subnet: {<br/>            id: subnetRef<br/>          }<br/>          privateIPAllocationMethod: 'Dynamic'<br/>          publicIPAddress: {<br/>            id: publicIP.id<br/>          }<br/>        }<br/>      }<br/>    ]<br/>    networkSecurityGroup: {<br/>      id: nsg.id<br/>    }<br/>  }<br/>}</span><span id="326c" class="lp je hi ll b fi lw lr l ls lt">resource nsg 'Microsoft.Network/networkSecurityGroups@2020-06-01' = {<br/>  name: networkSecurityGroupName<br/>  location: location<br/>  properties: {<br/>    securityRules: [<br/>      {<br/>           name: 'SSH'<br/>           properties : {<br/>               protocol : 'Tcp' <br/>               sourcePortRange :  '*'<br/>               destinationPortRange :  '22'<br/>               sourceAddressPrefix :  '*'<br/>               destinationAddressPrefix: '*'<br/>               access:  'Allow'<br/>               priority : 1010<br/>               direction : 'Inbound'<br/>               sourcePortRanges : []<br/>               destinationPortRanges : []<br/>               sourceAddressPrefixes : []<br/>               destinationAddressPrefixes : []<br/>          }<br/>      }<br/>      {<br/>           name : 'HTTPS'<br/>           properties : {<br/>               protocol :  'Tcp'<br/>               sourcePortRange :  '*'<br/>               destinationPortRange :  '443'<br/>               sourceAddressPrefix :  '*'<br/>               destinationAddressPrefix :  '*'<br/>               access :  'Allow'<br/>               priority : 1020<br/>               direction :  'Inbound'<br/>               sourcePortRanges : []<br/>               destinationPortRanges : []<br/>               sourceAddressPrefixes : []<br/>               destinationAddressPrefixes : []<br/>          }<br/>      }<br/>      {<br/>           name :  'Collector'<br/>           properties : {<br/>               protocol :  'Udp'<br/>               sourcePortRange :  '*'<br/>               destinationPortRange :  '3000'<br/>               sourceAddressPrefix :  '*'<br/>               destinationAddressPrefix :  '*'<br/>               access :  'Allow'<br/>               priority : 103<br/>               direction :  'Inbound'<br/>               sourcePortRanges : []<br/>               destinationPortRanges : []<br/>               sourceAddressPrefixes : []<br/>               destinationAddressPrefixes : []<br/>          }<br/>      }<br/>   ]<br/>  }<br/>}</span><span id="e57e" class="lp je hi ll b fi lw lr l ls lt">resource vnet 'Microsoft.Network/virtualNetworks@2020-06-01' = {<br/>  name: virtualNetworkName<br/>  location: location<br/>  properties: {<br/>    addressSpace: {<br/>      addressPrefixes: [<br/>        addressPrefix<br/>      ]<br/>    }<br/>    subnets: [<br/>      {<br/>        name: subnetName<br/>        properties: {<br/>          addressPrefix: subnetAddressPrefix<br/>          privateEndpointNetworkPolicies: 'Enabled'<br/>          privateLinkServiceNetworkPolicies: 'Enabled'<br/>        }<br/>      }<br/>    ]<br/>  }<br/>}</span><span id="ee4f" class="lp je hi ll b fi lw lr l ls lt">resource publicIP 'Microsoft.Network/publicIPAddresses@2020-06-01' = {<br/>  name: publicIPAddressName<br/>  location: location<br/>  properties: {<br/>    publicIPAllocationMethod: 'Dynamic'<br/>    publicIPAddressVersion: 'IPv4'<br/>    dnsSettings: {<br/>      domainNameLabel: dnsLabelPrefix<br/>    }<br/>    idleTimeoutInMinutes: 4<br/>  }<br/>  sku: {<br/>    name: 'Basic'<br/>  }<br/>}</span><span id="025d" class="lp je hi ll b fi lw lr l ls lt">resource vm 'Microsoft.Compute/virtualMachines@2021-03-01' = {<br/>  name: vmName<br/>  location: location<br/>  properties: {<br/>    hardwareProfile: {<br/>      vmSize: vmSize<br/>    }<br/>    storageProfile: {<br/>      osDisk: {<br/>        createOption: 'FromImage'<br/>        managedDisk: {<br/>          storageAccountType: osDiskType<br/>        }<br/>      }<br/>      imageReference: {<br/>        publisher: 'flowmon'<br/>        offer: 'flowmon_collector'<br/>        sku: 'v1101-byol'<br/>        version: 'latest'<br/>      }<br/>    }<br/>    networkProfile: {<br/>      networkInterfaces: [<br/>        {<br/>          id: nic.id<br/>        }<br/>      ]<br/>    }<br/>    osProfile: {<br/>      computerName: vmName<br/>      adminUsername: adminUsername<br/>      adminPassword: adminPasswordOrKey<br/>      linuxConfiguration: any(authenticationType == 'password' ? null : linuxConfiguration)<br/>    }<br/>    diagnosticsProfile: {<br/>      bootDiagnostics: {<br/>        enabled: true<br/>      }<br/>    }<br/>  }<br/>  plan: {<br/>    name: 'v1101-byol'<br/>    publisher: 'flowmon'<br/>    product: 'flowmon_collector'<br/>  }<br/>}</span><span id="9872" class="lp je hi ll b fi lw lr l ls lt">output administratorUsername string = adminUsername</span></pre><p id="4e31" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我希望这篇文章能帮助你踏上Bicep之旅，以及如何利用Bicep在Azure中部署基于Linux的虚拟机。</p><p id="a7bb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae kx" href="http://eepurl.com/gKmLdf" rel="noopener ugc nofollow" target="_blank"> <em class="lv">在此加入</em><strong class="ih hj"><em class="lv">azin sider</em></strong><em class="lv">邮箱列表。</em>T9】</a></p><p id="8612" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="lv">-戴夫·r·</em></p></div></div>    
</body>
</html>