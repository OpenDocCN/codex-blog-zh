<html>
<head>
<title>Solving the Missing Prefab issue in Unity3d</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">解决Unity3d中的预设缺失问题</h1>
<blockquote>原文：<a href="https://medium.com/codex/solving-the-missing-prefab-issue-in-unity3d-ae5ba0a15ee9?source=collection_archive---------0-----------------------#2022-04-15">https://medium.com/codex/solving-the-missing-prefab-issue-in-unity3d-ae5ba0a15ee9?source=collection_archive---------0-----------------------#2022-04-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/200d2df7a25edab251150daa54dab06d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uORdeUo2iYG4J-SweX_48Q.png"/></div></div></figure><p id="bc23" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当你开始为你的Unity项目使用源代码控制解决方案时，你可能会在某个时候遇到可怕的缺少预置或者缺少引用的错误。在这篇文章中，我们将看看为什么会发生这种情况以及如何解决它。</p></div><div class="ab cl jo jp gp jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="hb hc hd he hf"><p id="2dca" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">痛苦。痛苦。您刚刚完成了一个复杂的特性，并且很高兴合并您的代码并切换到另一个分支来完成一个新特性或一些错误修复。但是当你看到上面的内容时，你的心会漏跳一拍。</p><p id="191d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我第一次看到这一点是在我的资产商店项目<a class="ae jv" href="https://assetstore.unity.com/packages/tools/game-toolkits/laser-system-for-unity-217289" rel="noopener ugc nofollow" target="_blank">Unity</a>激光系统中。我刚刚写完我的自动化测试，看起来我不得不从头开始，因为测试场景完全被破坏了。</p><p id="cc90" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">请注意，这里我添加了一个简化的示例，以保持文章简洁。游戏场景通常要复杂得多，即使你知道场景中有哪些资产，你也不一定记得它们的位置、脚本和所有其他东西。基本上你将不得不重新创建你的场景！</p><p id="6a63" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们探讨一下这个问题，了解其原因，看看有什么解决办法。</p><p id="8061" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">缺少参考文献</strong></p><p id="1612" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Unity使用<code class="du jw jx jy jz b">.meta</code>文件来存储你的资产信息。<em class="ka">全部</em>。原因是你不能以一种实际的标准文件格式编写Unity特定的导入信息，例如<code class="du jw jx jy jz b">.png</code>。在<a class="ae jv" href="https://docs.unity3d.com/Manual/AssetMetadata.html#:~:text=Meta%20files%20and%20asset%20files,moves%20or%20renames%20the%20corresponding%20." rel="noopener ugc nofollow" target="_blank">手册</a>中，第一行明确说明了为什么摆弄这些东西可能是导致头痛的主要原因:</p><blockquote class="kb kc kd"><p id="ae8c" class="iq ir ka is b it iu iv iw ix iy iz ja ke jc jd je kf jg jh ji kg jk jl jm jn hb bi translated">当Unity导入资产时，它还存储和管理关于资产的附加数据，例如Unity应该使用什么导入设置来导入资产，以及在整个项目中使用资产的位置。</p></blockquote><p id="7f80" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">简而言之，如果你弄乱了你的<code class="du jw jx jy jz b">.meta</code>文件，Unity将不知道你的资产在整个项目中被用于何处。让我们来看看我的一个有问题的元文件:</p><figure class="kh ki kj kk fd ij"><div class="bz dy l di"><div class="kl km l"/></div><figcaption class="kn ko et er es kp kq bd b be z dx translated">。我的资产receiver_cube.prefab的元文件</figcaption></figure><p id="debb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">从本质上来说，<code class="du jw jx jy jz b">.meta</code>文件是以<code class="du jw jx jy jz b">.yaml</code>格式提供的关于您资产的信息。<code class="du jw jx jy jz b">guid</code>用于在项目中的任何地方标识您的资产，包括您的场景。它在我的测试场景文件<code class="du jw jx jy jz b">RotatingEmitterTestScene </code>中是这样使用的:</p><figure class="kh ki kj kk fd ij"><div class="bz dy l di"><div class="kl km l"/></div><figcaption class="kn ko et er es kp kq bd b be z dx translated">RotatingEmitterScene截断到重要部分</figcaption></figure><p id="ce3f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">场景也是<code class="du jw jx jy jz b">.yaml</code>文件。注意修改目标的<code class="du jw jx jy jz b">guid </code>。场景文件的这一部分<em class="ka">将我的预设的变换属性</em>链接在一起，片段包含位置。</p><figure class="kh ki kj kk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kr"><img src="../Images/7c3c5d3852349ff7f2e48940a843c159.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I6YVIOA_T2xTMtk8Pin-XA.png"/></div></div></figure><p id="3c5c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">浏览上面的例子，你会知道Unity是如何在场景文件中使用资源的<code class="du jw jx jy jz b">guid</code>来关联特定的属性的。随着<code class="du jw jx jy jz b">.meta</code>文件的消失，<code class="du jw jx jy jz b">guid</code>没有指向任何有效的资产，换句话说，它丢失了。</p><p id="3ed8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">但是为什么这又是一个问题呢？如果我删除现有文件，Unity不会为我的资产生成新的 <code class="du jw jx jy jz b"><strong class="is hj">.meta</strong></code> <strong class="is hj">文件吗？</strong></p><p id="116f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">是的，它是。但是在删除该资产的<code class="du jw jx jy jz b">.meta</code>文件之前，它不会出现与您曾经拥有的<code class="du jw jx jy jz b">guid</code>完全相同的文件。如果您没有将您的<code class="du jw jx jy jz b">.meta</code>文件包含在您的git中，那么当您切换分支或获取其他人的提交时，它们将不会与您的资产一起使用。如果我这样做了，你会看到下面可怕的结果。</p><figure class="kh ki kj kk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ks"><img src="../Images/eaaa04de57ab91212e31d770a5701ee1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rcm7sSSk7IdNmcagstLbRg.png"/></div></div><figcaption class="kn ko et er es kp kq bd b be z dx translated">真实的恐惧:丢失的预置</figcaption></figure><p id="2b87" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">基本上，您需要采取两个步骤来恢复资产的原始<code class="du jw jx jy jz b">guid </code>:</p><ol class=""><li id="4107" class="kt ku hi is b it iu ix iy jb kv jf kw jj kx jn ky kz la lb bi translated"><strong class="is hj">识别您资产的旧版本</strong> <code class="du jw jx jy jz b"><strong class="is hj">guid</strong></code></li><li id="bdac" class="kt ku hi is b it lc ix ld jb le jf lf jj lg jn ky kz la lb bi translated"><strong class="is hj">用旧文件</strong>替换您资产的新 <code class="du jw jx jy jz b"><strong class="is hj">.meta</strong></code> <strong class="is hj">文件中的</strong> <code class="du jw jx jy jz b"><strong class="is hj">guid </strong></code> <strong class="is hj"/></li></ol><p id="b04b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">反之亦然，只要<code class="du jw jx jy jz b">guid</code>匹配就行。</p><p id="4861" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你给它起了一个好名字，在你的场景中找到一个<code class="du jw jx jy jz b">GameObject </code>是最容易的:</p><figure class="kh ki kj kk fd ij"><div class="bz dy l di"><div class="kl km l"/></div><figcaption class="kn ko et er es kp kq bd b be z dx translated">预设被引用到它的名称属性</figcaption></figure><p id="3486" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在你刚刚点击<code class="du jw jx jy jz b">Ctrl + F</code>的代码编辑器中打开你的场景文件，输入/粘贴你的<code class="du jw jx jy jz b">GameObject</code>的名字。Unity场景只是一堆被引用在一起的属性。在上面的代码片段中，名称在<code class="du jw jx jy jz b">value</code>中，ObjectReference的<code class="du jw jx jy jz b">target</code>文件的<code class="du jw jx jy jz b">guid</code>是您的资产的旧标识符。复制并粘贴到您的资产的<code class="du jw jx jy jz b">.meta</code>文件中，以替换其当前的新<code class="du jw jx jy jz b">guid</code>。</p><p id="9dfc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对我所有丢失的预设进行这样的操作产生了以下结果:</p><figure class="kh ki kj kk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lh"><img src="../Images/ac9c7a789b011aa07886cd83b5f2b105.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GW-vHRu6CueSSLUp8yCGgg.png"/></div></div><figcaption class="kn ko et er es kp kq bd b be z dx translated">失踪的预制解决</figcaption></figure><p id="a82a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">所有丢失的预制构件都以原始状态再次出现。</p><p id="ed54" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">以后如何避免这个问题</strong></p><p id="ffb4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">无论怎样强调都不为过</p><blockquote class="kb kc kd"><p id="ddb7" class="iq ir ka is b it iu iv iw ix iy iz ja ke jc jd je kf jg jh ji kg jk jl jm jn hb bi translated">使用git时，<strong class="is hj">资产和它们的</strong> <code class="du jw jx jy jz b"><strong class="is hj">.meta</strong></code> <strong class="is hj">文件总是一起</strong>。即使生成了这些<code class="du jw jx jy jz b">.meta</code>文件，它们<strong class="is hj">也必须包含在您的提交</strong>中，这样才能始终确保正确的标识。</p></blockquote><p id="bad6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">更不用说它们还包含导入设置。</p></div><div class="ab cl jo jp gp jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="hb hc hd he hf"><p id="150d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">感谢您阅读我的文章，我希望我能帮助您避免寻找解决方案的头痛。请考虑在推特上打个招呼，看看我在做什么。</p></div></div>    
</body>
</html>