<html>
<head>
<title>Deep Learning Setup: ECS GPU Task On Ubuntu (Part 1)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">深度学习设置:Ubuntu上的ECS GPU任务(第1部分)</h1>
<blockquote>原文：<a href="https://medium.com/codex/deep-learning-setup-ecs-gpu-task-on-ubuntu-part-1-87933804c050?source=collection_archive---------2-----------------------#2021-01-03">https://medium.com/codex/deep-learning-setup-ecs-gpu-task-on-ubuntu-part-1-87933804c050?source=collection_archive---------2-----------------------#2021-01-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="6322" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了在ECS中运行基于GPU的任务，我们需要创建自己的EC2实例，因为Fargate】仍然不支持GPU。有了<a class="ae jd" href="https://docs.aws.amazon.com/AmazonECS/latest/developerguide/ecs-gpu.html" rel="noopener ugc nofollow" target="_blank"> ECS GPU优化的ami</a>，这应该不会太难。</p><p id="f379" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然而，有时这是不可能的，因为团队已经在使用他们最喜欢的AMI设置，比如Ubuntu <a class="ae jd" href="https://aws.amazon.com/marketplace/seller-profile?id=dfa1e6a8-0b7b-4d35-a59c-ce272caee4fc" rel="noopener ugc nofollow" target="_blank"> CIS优化AMI </a>或任何其他风格。这意味着他们需要从头开始安装和配置设置。</p><p id="dbd2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这4篇文章中，我们将回顾在Ubuntu 18.04操作系统上使用GPU所需资源安装和配置ECS任务的过程。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/36ebbedc5474d1d407ca55f52276f501.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*u0lgcOByeANcVF1L"/></div></div></figure><p id="3ced" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第一部分:NVIDIA驱动程序</strong></p><p id="ca1b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" href="https://michael-41345.medium.com/deep-learning-setup-ecs-gpu-task-on-ubuntu-part-2-1c7abd6d14ad" rel="noopener">第2部分:ECS代理</a></p><p id="c1d5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" href="https://michael-41345.medium.com/deep-learning-setup-ecs-gpu-task-on-ubuntu-part-3-a6ffbc6a3c5a" rel="noopener">第三部分:NVIDIA-Docker运行时间</a></p><p id="921d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" rel="noopener" href="/codex/deep-learning-setup-ecs-gpu-task-on-ubuntu-part-4-46c364d1b556">第4部分:ECS代理上的GPU配置</a></p></div><div class="ab cl jq jr gp js" role="separator"><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv"/></div><div class="hb hc hd he hf"><h1 id="43df" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">NVIDIA驱动程序和工具包</h1><p id="34f8" class="pw-post-body-paragraph if ig hi ih b ii kv ik il im kw io ip iq kx is it iu ky iw ix iy kz ja jb jc hb bi translated">尽管安装和配置NVIDIA tool kit &amp; drivers有很好的文档<a class="ae jd" href="https://docs.nvidia.com/cuda/cuda-installation-guide-linux/index.html" rel="noopener ugc nofollow" target="_blank">记录</a>，但我还是遇到了一些问题，所以我发现自己记录所需的步骤很有价值。然而，我建议仔细阅读更详细的正式文档，而且步骤可能会根据个人需求/偏好而改变。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es la"><img src="../Images/71071b52586b3e8f1bd5a55f9d013f53.png" data-original-src="https://miro.medium.com/v2/resize:fit:788/format:webp/0*LkS4C_X6A-CZ6hMw.jpg"/></div></figure><p id="2c22" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="lb">预安装</em> </strong></p><p id="0e19" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">验证您是否拥有支持CUDA的GPU要验证您的GPU是否支持CUDA:</p><pre class="jf jg jh ji fd lc ld le lf aw lg bi"><span id="93db" class="lh jy hi ld b fi li lj l lk ll">$ lspci | grep -i nvidia</span><span id="5ad6" class="lh jy hi ld b fi lm lj l lk ll">If your graphics card is from NVIDIA and it is listed in <a class="ae jd" href="https://developer.nvidia.com/cuda-gpus" rel="noopener ugc nofollow" target="_blank">https://developer.nvidia.com/cuda-gpus</a>, your GPU is CUDA-capable.</span></pre><p id="2877" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">验证您是否拥有受支持的Linux版本</p><pre class="jf jg jh ji fd lc ld le lf aw lg bi"><span id="9c9f" class="lh jy hi ld b fi li lj l lk ll">$ uname -m &amp;&amp; cat /etc/*release</span><span id="4b80" class="lh jy hi ld b fi lm lj l lk ll">You should see output similar to the following, modified for your particular system: x86_64 Red Hat Enterprise Linux Workstation release 6.0 (Santiago)</span></pre><p id="e19e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">验证系统是否安装了GCC</p><pre class="jf jg jh ji fd lc ld le lf aw lg bi"><span id="66e2" class="lh jy hi ld b fi li lj l lk ll"><strong class="ld hj">$</strong> gcc --version</span></pre><p id="35cc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我没有安装gcc，并得到以下错误:“命令' GCC '未找到，但可以用sudo安装以安装GCC”，这很容易通过运行解决:</p><pre class="jf jg jh ji fd lc ld le lf aw lg bi"><span id="3d5c" class="lh jy hi ld b fi li lj l lk ll">sudo apt install gcc</span></pre><p id="f483" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">验证系统是否安装了正确的内核头文件和开发包</p><pre class="jf jg jh ji fd lc ld le lf aw lg bi"><span id="facb" class="lh jy hi ld b fi li lj l lk ll"><strong class="ld hj">$</strong> uname -r</span><span id="44f7" class="lh jy hi ld b fi lm lj l lk ll">This is the version of the kernel headers and development packages that must be installed prior to installing the CUDA Drivers.</span></pre><p id="f9e5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当前运行的内核的内核头文件和开发包可以安装在:</p><pre class="jf jg jh ji fd lc ld le lf aw lg bi"><span id="b945" class="lh jy hi ld b fi li lj l lk ll"><strong class="ld hj">$</strong> sudo apt-get install linux-headers-$(uname -r)</span><span id="3766" class="lh jy hi ld b fi lm lj l lk ll">This is for Ubuntu only, for a different OS please see the formal NVIDIA documentation.</span></pre></div><div class="ab cl jq jr gp js" role="separator"><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv"/></div><div class="hb hc hd he hf"><p id="bb65" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="lb">工具包安装</em> </strong></p><p id="4e9a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以只安装NVIDIA驱动程序，也可以安装NVIDIA工具包，这是一套工具和驱动程序。我更喜欢安装工具包，因为它将帮助我们稍后验证安装是否成功。</p><p id="26e5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下载NVIDIA CUDA工具包</p><p id="9ddd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">NVIDIA CUDA工具包在<a class="ae jd" href="https://developer.nvidia.com/cuda-downloads" rel="noopener ugc nofollow" target="_blank">https://developer.nvidia.com/cuda-downloads</a>上市。选择操作系统、发行版和版本。然后选择你喜欢的安装类型，我在这里选择了deb(local):</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es ln"><img src="../Images/e199273a9891b9995fbe06206e8fbd81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F1Z6nBiG9ib-zqiMsgQsOQ.png"/></div></div></figure><p id="3b5a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">和运行命令，对于Linux Ubuntu 18.04 x86_64:</p><pre class="jf jg jh ji fd lc ld le lf aw lg bi"><span id="9854" class="lh jy hi ld b fi li lj l lk ll"><strong class="ld hj">$ </strong>wget <a class="ae jd" href="https://developer.download.nvidia.com/compute/cuda/repos/ubuntu1804/x86_64/cuda-ubuntu1804.pin" rel="noopener ugc nofollow" target="_blank">https://developer.download.nvidia.com/compute/cuda/repos/ubuntu1804/x86_64/cuda-ubuntu1804.pin</a><br/><strong class="ld hj">$ </strong>sudo mv cuda-ubuntu1804.pin /etc/apt/preferences.d/cuda-repository-pin-600<br/><strong class="ld hj">$ </strong>wget https://developer.download.nvidia.com/compute/cuda/11.2.0/local_installers/cuda-repo-ubuntu1804-11-2-local_11.2.0-460.27.04-1_amd64.deb<br/><strong class="ld hj">$ </strong>sudo dpkg -i cuda-repo-ubuntu1804-11-2-local_11.2.0-460.27.04-1_amd64.deb<br/><strong class="ld hj">$ </strong>sudo apt-key add /var/cuda-repo-ubuntu1804-11-2-local/7fa2af80.pub <br/><strong class="ld hj">$ </strong>sudo apt-get update<br/><strong class="ld hj">$ </strong>sudo apt-get -y install cuda</span></pre></div><div class="ab cl jq jr gp js" role="separator"><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv"/></div><div class="hb hc hd he hf"><p id="0646" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="lb">岗位安装</em> </strong></p><p id="2aff" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">环境设置—添加路径:</p><pre class="jf jg jh ji fd lc ld le lf aw lg bi"><span id="2386" class="lh jy hi ld b fi li lj l lk ll"><strong class="ld hj">$</strong> export PATH=/usr/local/cuda-11.2/bin${PATH:+:${PATH}}</span></pre><p id="4d38" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">设置持久性守护程序:</p><pre class="jf jg jh ji fd lc ld le lf aw lg bi"><span id="115d" class="lh jy hi ld b fi li lj l lk ll"><strong class="ld hj">$</strong> sudo /usr/bin/nvidia-persistenced --verbose</span></pre><p id="b271" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">验证安装</p><p id="2c05" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在一切就绪，让我们验证驱动程序是否安装成功:</p><pre class="jf jg jh ji fd lc ld le lf aw lg bi"><span id="ade6" class="lh jy hi ld b fi li lj l lk ll"><strong class="ld hj">$ </strong>cat /proc/driver/nvidia/version</span><span id="7736" class="lh jy hi ld b fi lm lj l lk ll">The output should be similar to the following:<br/>NVRM version: NVIDIA UNIX x86_64 Kernel Module  460.27.04  Fri Dec 11 23:35:05 UTC 2020<br/>GCC version:  gcc version 7.5.0 (Ubuntu 7.5.0-3ubuntu1~18.04)</span></pre><p id="a38e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">并验证工具包安装:</p><pre class="jf jg jh ji fd lc ld le lf aw lg bi"><span id="c8cb" class="lh jy hi ld b fi li lj l lk ll"><strong class="ld hj">$ </strong>nvcc -V</span><span id="ec21" class="lh jy hi ld b fi lm lj l lk ll">The output should be similar to the following:</span><span id="8ca4" class="lh jy hi ld b fi lm lj l lk ll">nvcc: NVIDIA (R) Cuda compiler driver<br/>Copyright (c) 2005-2020 NVIDIA Corporation<br/>Built on Mon_Nov_30_19:08:53_PST_2020<br/>Cuda compilation tools, release 11.2, V11.2.67<br/>Build cuda_11.2.r11.2/compiler.29373293_0</span></pre><p id="4331" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">作为最后的测试，我们将运行一个示例GPU程序；请注意，这可能需要很长时间来执行。</p><pre class="jf jg jh ji fd lc ld le lf aw lg bi"><span id="c7bd" class="lh jy hi ld b fi li lj l lk ll">mkdir tmp &amp;&amp; cuda-install-samples-11.2.sh tmp &amp;&amp; cd NVIDIA_CUDA-11.2_Samples &amp;&amp; make &amp;&amp; cd 1_Utilities/deviceQuery &amp;&amp; ./deviceQuery</span><span id="d0af" class="lh jy hi ld b fi lm lj l lk ll">The output should be similar to the following image:</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lo"><img src="../Images/ccfd252855051343b2fd7e30c6fc1ec0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XcXAcTFkmZ9buKVnQyROBg.png"/></div></div></figure></div><div class="ab cl jq jr gp js" role="separator"><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv"/></div><div class="hb hc hd he hf"><p id="a897" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们已经安装并运行了NVIDIA驱动程序。在下一篇文章中，我们将安装和配置ECS代理，并对其进行调整以与我们刚刚安装的驱动程序一起工作。</p></div></div>    
</body>
</html>