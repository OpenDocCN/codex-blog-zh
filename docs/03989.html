<html>
<head>
<title>How I Extract Dashboard KPI Data with Selenium</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Selenium提取仪表板KPI数据</h1>
<blockquote>原文：<a href="https://medium.com/codex/how-i-extract-dashboard-kpi-data-with-selenium-6705bf4a8e47?source=collection_archive---------5-----------------------#2021-10-14">https://medium.com/codex/how-i-extract-dashboard-kpi-data-with-selenium-6705bf4a8e47?source=collection_archive---------5-----------------------#2021-10-14</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/9a76ce1564e09b7cef72527a92f29dc4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eyKusJDh-vMJM4FWlv_d9Q.jpeg"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">马丁·桑切斯在<a class="ae hv" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><div class=""/><p id="bc93" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">交互式仪表板对于商业智能世界来说并不新鲜。然而，当我们穿越2020年新冠肺炎的许多波浪时，这些仪表板真正吸引了公众的目光。对最新数据的迫切需求似乎引发了一场争夺<a class="ae hv" href="https://www.analyticsvidhya.com/blog/2020/07/top-20-covid-19-dashboard/" rel="noopener ugc nofollow" target="_blank">最佳仪表盘</a>的竞赛。对于我们这些数据搜索者来说，有时访问感兴趣的数据的唯一方式是通过这样的仪表板，这并不奇怪；因此，用有用的技巧升级我们的Selenium工具包来收集仪表板数据是完全有意义的。</p><p id="1d72" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们以我最近的项目为例:</p><p id="5984" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">该项目包括通过<a class="ae hv" href="https://otn.ca/" rel="noopener ugc nofollow" target="_blank">安大略省远程医疗网络(OTN) </a>跟踪基于医院的医疗从业者对虚拟医疗的使用。只是一些背景信息:作为世界上最大的远程医疗网络之一，随着虚拟护理成为许多诊所的规范，OTN在疫情的使用量急剧增加。对于患者和医疗服务提供者来说，这无疑是一个好消息，因为获得及时和高质量的医疗服务已经受到了巨大的影响！这个项目是作为一项持续的工作而诞生的，旨在衡量虚拟护理的接受程度，其中包括从OTN网站上发布的使用仪表板中收集数据，然后将数据转化为针对我们自己的受众的定制报告。</p><figure class="ju jv jw jx fd hk er es paragraph-image"><div class="er es jt"><img src="../Images/a596608d81f6470f3216e4a5e3d8fc7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1108/format:webp/1*6A7jjzNiLnzuqqHUsU0UCQ.png"/></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">包含相关数据的仪表板发布在OTN网站上。</figcaption></figure><p id="8108" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">任何常规任务都是自动化的机会。这也不例外；原来dashboard就像是网页中的网页，所以Selenium基础知识(点击<a class="ae hv" href="https://siqi-zhu.medium.com/rselenium-will-work-for-free-b6b3869d9968" rel="noopener">此处</a>快速刷新)仍然是最终脚本的基础，需要注意以下几点:</p><ul class=""><li id="08b9" class="jy jz hy ix b iy iz jc jd jg ka jk kb jo kc js kd ke kf kg bi translated"><strong class="ix hz">处理iframe:</strong></li></ul><p id="c43a" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在我们开始挖掘仪表盘上显示的内容之前，我们必须首先关注仪表盘是如何嵌入网页的。一个常见的策略是使用<a class="ae hv" href="https://en.wikipedia.org/wiki/HTML_element#Frames" rel="noopener ugc nofollow" target="_blank"> iframes </a>来显示外部内容。iframe的处理方式类似于不同的HTML页面；因此，Selenium需要一个手动开关来定位iframe中的任何元素。</p><p id="a665" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">通过对HTML的视觉检查，不难发现我们感兴趣的仪表板确实使用了iframe，并且是使用Power BI构建的:</p><figure class="ju jv jw jx fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es kh"><img src="../Images/a6c85eb752ee01d846a25959e7fb2b1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V1iQmf61DneIQzbDMRnByg.png"/></div></div></figure><p id="a2a9" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">另一种方法是使用Selenium命令<strong class="ix hz"> findElements() </strong>和方便命名的css句柄‘iframe’在R中直接查询:</p><figure class="ju jv jw jx fd hk er es paragraph-image"><div class="er es ki"><img src="../Images/2e5874a180c9c80ad8bb4b75711d31ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1014/format:webp/1*ejtFZAN8ECGFnG0INWzaEQ.png"/></div></figure><p id="60f5" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">从上面的代码中可以看出，结果保存在一个名为“frames”的列表中，其长度表明在当前页面上只能找到一个iframe——请注意，一些网页可能会使用多个iframe来管理不同的外部内容。</p><p id="3ed8" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">快速检查以确认仪表板位于唯一的iframe中:</p><figure class="ju jv jw jx fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es kj"><img src="../Images/ae5e631069ad96d995760e1c30452264.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EtcXJ2fbpFnaRiczmNQ8xg.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">在本例中，我使用仪表板上“事件类别”下的复选框选项作为“代理”web元素，以确认它只出现在iframe中，而不在网页的其他地方。</figcaption></figure><ul class=""><li id="ac92" class="jy jz hy ix b iy iz jc jd jg ka jk kb jo kc js kd ke kf kg bi translated"><strong class="ix hz">感兴趣的内容不在视野内:</strong></li></ul><p id="f98e" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">既然Selenium可以正确地定位仪表板，我们就可以开始生成我们想要的仪表板KPI数据了。交互式仪表板的一个明显优点是它的交互性。有许多内置的功能来帮助实现这一点:日期切片器、复选框等等。在后端，每个特性都与它自己独特的HTML相关联，可以像对待任何其他web元素一样对待。这也意味着我们可以愉快地应用Selenium命令<strong class="ix hz"> findElement() </strong>和<strong class="ix hz"> clickElement() </strong>来模拟手动步骤。</p><p id="b3bf" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">有些web元素只有在进入可视区域后才可以点击，就像这个仪表板上的复选框一样。默认视图从可见字段中删除了一些复选框，不方便地包括了“系统类型”的复选框——只是一些简单的背景信息:OTN平台提供了两种类型的系统:Studio/RBVC需要物理的现场设置，而PCVC，代表个人视频会议服务，类似于zoom，可以在个人计算机上访问。如果我们希望根据系统类型分析控制面板数据，我们需要手动向下滚动页面，以便将相关选项显示在视图中。硒的情况也是如此！需要注意的是，Selenium本身没有直接的滚动命令；相反，我们可以利用非常灵活的<a class="ae hv" href="https://cran.r-project.org/web/packages/RSelenium/vignettes/basics.html#injecting-javascript" rel="noopener ugc nofollow" target="_blank"><strong class="ix hz">execute script</strong></a><strong class="ix hz">()</strong>命令(从<a class="ae hv" rel="noopener" href="/codex/beyond-the-basics-here-are-3-ways-i-have-used-javascript-in-selenium-272e9417270a"> <strong class="ix hz">其他</strong> </a>可能的用途中得到启发！)和JavaScript中的<strong class="ix hz"> scrollIntoView </strong>命令，使复选框选项可见，从而可点击。</p><figure class="ju jv jw jx fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es kk"><img src="../Images/9777805ac8cc6fb2eae4fcbd518991aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2abD1Y8SamjRKFFRAfIWvg.png"/></div></div></figure><ul class=""><li id="25cf" class="jy jz hy ix b iy iz jc jd jg ka jk kb jo kc js kd ke kf kg bi translated"><strong class="ix hz">存储为文本的数字</strong></li></ul><p id="1774" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">最后，我们已经勾选了所有相关的复选框，并准备好抓取KPI数据“总事件”,它显示在卡片视图中。</p><figure class="ju jv jw jx fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es kl"><img src="../Images/613a18313e2dd1e36b02e4e3ff150c77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6iAMBXhHf8wI3I6TjzAyyw.png"/></div></div></figure><p id="a494" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">当涉及到抓取结构化数据时，我们在这个阶段不必太担心数据类型。但是，当我们从仪表板中抓取数据时，它们可能不是我们想要的格式，并影响我们检索数据的方法。例如，通过检查HTML，我们可以看到“总事件”的值实际上是作为文本存储的。方便的是，我们可以使用<strong class="ix hz"> getElementText() </strong>命令返回可见文本。不要就此打住:需要进行一些后期的字符串处理来删除用作千位分隔符的逗号，然后将数据类型转换为数字。幸运的是，由于这种情况下的字符串解析相对容易，所以我将这两个步骤结合在一起，只用了一行代码:</p><figure class="ju jv jw jx fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es km"><img src="../Images/4e55816bd4477dfad8b73af9bd85c577.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GUr77hW74A_rzjRrEcdJUA.png"/></div></div></figure><p id="7928" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hz">结论</strong></p><p id="dc44" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">由于交互式仪表板在传递来自大量底层数据的关键信息方面的多功能性和有效性，它们已经获得了广泛的应用。另一方面，对于处于数据生命周期另一端并渴望从所有骗子和缝隙中捕获数据的人来说，Selenium已经被证明是同样有价值的方式！</p></div></div>    
</body>
</html>