<html>
<head>
<title>Dealing with Deprecation in TensorFlow — Fixing a Convolutional Neural Network model using a worked example</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">处理TensorFlow中的弃用-使用工作示例修复卷积神经网络模型</h1>
<blockquote>原文：<a href="https://medium.com/codex/dealing-with-deprecation-in-tensorflow-fixing-a-convolutional-neural-network-model-using-a-worked-dc3113b93049?source=collection_archive---------14-----------------------#2021-04-05">https://medium.com/codex/dealing-with-deprecation-in-tensorflow-fixing-a-convolutional-neural-network-model-using-a-worked-dc3113b93049?source=collection_archive---------14-----------------------#2021-04-05</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/e2d08b8b4065db40a3df10fb1b76cca2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*VEwaEHeWX0ys4ob8dQHCAg.jpeg"/></div></figure><p id="6477" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">所有软件都会被弃用，人工智能库也不例外。事实上，TensorFlow库因被弃用而臭名昭著。TensorFlow是谷歌的深度学习库，于2015年推出，此后一直在发展。</p><p id="0978" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我正在关注YouTuber sentdex，他创造了一系列优秀的后续机器学习和深度学习教程。这里有一个卷积神经网络(CNN)的例子，它是由sentdex在2018年创建的，它无缝地工作，直到TensorFlow否决了它的一个功能。(教程可以在这里找到:<a class="ae jk" href="https://pythonprogramming.net/convolutional-neural-network-deep-learning-python-tensorflow-keras/" rel="noopener ugc nofollow" target="_blank">https://python programming . net/卷积-神经网络-深度学习-python-tensorflow-keras/ </a>)</p><p id="ebdc" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我想和你分享我解决这个问题的方法，原因有二:第一，你可以让这个CNN算法在你的环境中工作(我正在使用我强烈推荐的Google Colab)，但更重要的是，如果你遇到类似的问题，你可以应用我所做的相同的方法来修复你的废弃算法并让它再次工作。</p><p id="8e21" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">让我们开始吧…</p><p id="8576" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">先决条件:</p><p id="af1e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">1.完成深度学习模块中的前两个教程:</p><p id="fef0" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">深度学习入门——使用python、TensorFlow和Keras p.1的深度学习基础(<a class="ae jk" href="https://pythonprogramming.net/introduction-deep-learning-python-tensorflow-keras/" rel="noopener ugc nofollow" target="_blank">https://Python programming . net/introduction-Deep-Learning-Python-tensorflow-Keras/</a>)和加载自己的数据——使用Python、tensor flow和Keras p.2的深度学习基础(<a class="ae jk" href="https://pythonprogramming.net/loading-custom-data-deep-learning-python-tensorflow-keras/" rel="noopener ugc nofollow" target="_blank">https://Python programming . net/Loading-custom-data-Deep-Learning-Python-tensor flow-Keras/</a>)。这将导致酸洗对象的创建；x .泡菜和y .泡菜</p><p id="91b3" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">2.在Colab中安装您的Google Drive。如果你不知道如何做到这一点，请关注我的文章:点击3次鼠标在Google Colab中安装Google Drive \<a class="ae jk" href="https://miteshparmar1.medium.com/mounting-google-drive-in-google-colab-with-3-mouse-clicks-8d38d681aad5/" rel="noopener">https://miteshparmar 1 . medium . com/Mounting-Google-Drive-in-Google-Colab-with-3-mouse-clicks-8d 38d 681 aad 5 \</a></p><p id="1982" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我将导入语句放在第一个代码单元中，将pickled对象的加载放在第二个代码单元中。使用play按钮执行每个命令都不会导致错误。</p><figure class="jm jn jo jp fd ij er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es jl"><img src="../Images/8ed01f01a6a391c8a1fe667006145559.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o3gqIaFS71rmhPgcDTSDOA.png"/></div></div></figure><p id="23c9" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">第三个代码单元格包含用于构建和训练CNN模型的代码。在上述步骤之后执行该命令会导致如下所示的两个错误(还要注意第27行model.fit()函数是如何以红色突出显示的):</p><figure class="jm jn jo jp fd ij er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es ju"><img src="../Images/1dad16998328c1223bf687f58b32139e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tOjYOCRLCPS1C2zgE-GINw.png"/></div></div></figure><p id="11ae" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">第一个错误立即指向第27行；model.fit()函数。第二个错误是内部tensorflow python脚本，它被调用指向第1359行；数组在输入中找到以下类型:{}。格式(不可拆分))。</p><p id="bef3" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">就在这条蓝色线的上方，写着“validation_split仅支持张量或数字”。</p><p id="a291" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">上面的错误信息是什么意思？</p><p id="834c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">从表面上看，这意味着我们的代码出错了，因为我们在model.fit()函数中提供了参数validation_split。蓝色的句子告诉我们validation_split只支持Tensors或Numpy数据类型。</p><p id="31bc" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">所以这是我们的问题。但是错误描述有点简短，所以我们将深入研究以获得更好的理解。</p><p id="4591" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们知道“模型”是顺序型变量，对吗？如果您有所怀疑，您可以使用print(type())函数来检查您在变量赋值下面声明的任何变量数据类型，如下所示:</p><figure class="jm jn jo jp fd ij er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es jv"><img src="../Images/8e6b6aef1540eca08052b0cd0d520da0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J2x5jHF_7nYo1kwWV18neA.png"/></div></div></figure><p id="1ee1" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">接下来，让我们在谷歌上搜索Tensorflow Sequential以获得更多相关信息…</p><figure class="jm jn jo jp fd ij er es paragraph-image"><div class="er es jw"><img src="../Images/c358e2a01c86aa849907a1c382372107.png" data-original-src="https://miro.medium.com/v2/resize:fit:1350/format:webp/1*x5yQAAKHIvKZtAu-jDzJeQ.png"/></div></figure><p id="199b" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">搜索的第一个结果是官方的Tensorflow文档网页，所以点击…</p><figure class="jm jn jo jp fd ij er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es jx"><img src="../Images/4c36122b52090b2785fec7a6f4cd1e21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sSEaEdjKu5pNdysY_H0iAw.png"/></div></div></figure><p id="043f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">显示的是Tensorflow API的顺序功能细节；任何开发人员都必须去的一个地方，以找到关于Tensorflow库如何工作的详细信息:</p><figure class="jm jn jo jp fd ij er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es jy"><img src="../Images/8c10f573633415637c4a312c72fcf24e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J6eaiUIcnKlti34T_l7bGg.png"/></div></div></figure><p id="85a4" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们从代码中突出显示的弯曲红线中知道，model.fit()是错误发生的地方，因此滚动此网页并找到fit函数:</p><p id="ffb0" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">第一个函数带有删除线，因为它不再适用，已被绿色背景的函数所取代。如果仔细观察并比较两者，您会发现一些参数发生了变化，例如，verbose=1变成了verbose='auto ':</p><figure class="jm jn jo jp fd ij er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es jz"><img src="../Images/abffe387c6123ee1ed805e5babe1f8d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7OgOfIuM3_GQbD9dmznunQ.png"/></div></div></figure><p id="0b62" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">进一步向下滚动到参数部分，显示x和y的以下内容:</p><figure class="jm jn jo jp fd ij er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es ka"><img src="../Images/3a1e304b54ad63e517cbd09f25058ae5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NLSy_IXydMUK2_vgtxf1oQ.png"/></div></div></figure><p id="94ae" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这就是这个问题的症结所在！基本上，它告诉我们x；第一个参数和y；第二个参数只能是规定的几种类型。</p><p id="985f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">回到我们的脚本，我们可以检查加载的pickled对象的数据类型；x和y使用嵌套在print()函数中的type()函数:</p><figure class="jm jn jo jp fd ij er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es kb"><img src="../Images/9aa25295dab895c6ecd70bbab547b90c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i71bf9o0B2j7jtRh4JCPqg.png"/></div></div></figure><p id="ca34" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">它向我们展示了X是一个numpy.ndarray，y是一个list对象。</p><p id="7fbb" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">因此，通过检查Tensorflow API，我们知道X是受支持的数据类型:</p><figure class="jm jn jo jp fd ij er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es kc"><img src="../Images/e223e97915d01e2671432b9a6aebb500.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V9E6xQ9AXftb2NoMFDrNAw.png"/></div></div></figure><p id="0287" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们还知道y是不支持的数据类型:</p><figure class="jm jn jo jp fd ij er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es kd"><img src="../Images/a8cd953a73a29745c9c57aa7f7165f1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I7jOuOQJPYrD9DUtJC5mGQ.png"/></div></div></figure><p id="3b04" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">如上所述，y只能是Numpy数组或TensorFlow张量类型，并且应该与x一致。</p><p id="3186" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在我们的例子中，由于X的类型是Numpy.ndarray，我们需要y的类型也是Numpy.ndarray。</p><p id="a9f8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">那么我们如何将一个标准的Python list对象转换成Numpy.ndarray对象呢？</p><p id="2486" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">让我们谷歌一下:</p><figure class="jm jn jo jp fd ij er es paragraph-image"><div class="er es ke"><img src="../Images/1ec125f4e5664e7a1d59da53725906ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1264/format:webp/1*30wcesPODHRQwAfNxUOaeQ.png"/></div></figure><p id="5743" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">第一个结果是官方的numpy文档，让我们点击:</p><figure class="jm jn jo jp fd ij er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es kb"><img src="../Images/c3dbcb74338f02b6371d5f6dfa9816d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G90C4ySXFhq5FKp-ObpRkQ.png"/></div></div></figure><p id="9538" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">所以我们需要按照规定使用numpy.asarray()函数:</p><figure class="jm jn jo jp fd ij er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es kf"><img src="../Images/b634de90af7419b4b8f8699ab9042579.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iPPkdvihVNtKp9pugmzmoA.png"/></div></div></figure><p id="5072" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">如上所述，输入数据可以是任何可以转换成数组的数据。这包括一个列表对象。因为y的数据类型是list，所以我们可以使用这个函数。</p><p id="d119" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我在代码单元1中插入了“import numpy as np ”,并执行它来重新加载导入。在第二个代码单元中，我简单地在它上面插入了突出显示的一行注释来解释它的作用。我执行了代码单元格2，print语句显示X和y数据类型都是numpy.ndarray()类型:</p><figure class="jm jn jo jp fd ij er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es kg"><img src="../Images/af49bd6353d018de6584609c5a9b3947.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TUbYJVJ5SFVItu4gohsYGA.png"/></div></div></figure><p id="5d03" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">执行第三个细胞代码显示训练，虽然难以置信地慢！</p><figure class="jm jn jo jp fd ij er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es kh"><img src="../Images/1b61485231a8572ac00d3fd495497884.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Nv9Z3dWaC-GX2fhYRfDaUA.png"/></div></div></figure><p id="4e55" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">点击运行时间-&gt;中断执行，暂停训练:</p><figure class="jm jn jo jp fd ij er es paragraph-image"><div class="er es ki"><img src="../Images/d1f24c1b3a003b9e17e5ae6fb6962af5.png" data-original-src="https://miro.medium.com/v2/resize:fit:522/format:webp/1*5WJLp0gdL-4dnSuSEe829g.png"/></div></figure><p id="3932" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">是时候利用Colab的免费GPU了。</p><figure class="jm jn jo jp fd ij"><div class="bz dy l di"><div class="kj kk l"/></div></figure><p id="8792" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">点击运行时-&gt;更改运行时类型</p><figure class="jm jn jo jp fd ij er es paragraph-image"><div class="er es kl"><img src="../Images/1bf4cf9c7dbe3c8430d5dfa3e98c2704.png" data-original-src="https://miro.medium.com/v2/resize:fit:532/format:webp/1*_3gFDPzJAdgnbym5cLzJQQ.png"/></div></figure><p id="3b20" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">从硬件加速器下的下拉列表中选择“GPU”并单击“保存”:</p><figure class="jm jn jo jp fd ij er es paragraph-image"><div class="er es km"><img src="../Images/ac5dfbfce8b9dc3575058f09851cf6fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:750/format:webp/1*tELyF7O3ETSgojeSxvHqHg.png"/></div></figure><p id="7c41" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">运行时-&gt;全部运行:</p><figure class="jm jn jo jp fd ij er es paragraph-image"><div class="er es kn"><img src="../Images/825f1351a52e8369bdf8ee97555d06b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:540/format:webp/1*6kDwvlspcppXGcwV8jcHyA.png"/></div></figure><p id="d6b8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">训练现在应该快得多，因为它利用GPU而不是CPU:</p><figure class="jm jn jo jp fd ij er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es ko"><img src="../Images/8971c30a52149aa7ab7c7275f6c059ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PjW5J32zudO3Yxn2fh-laA.png"/></div></div></figure><p id="856a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我希望这篇文章有助于您理解弃用并访问相关的API来解决这个问题。快乐的Colab训练你的固定复杂的神经网络。如有任何问题或意见，请在回复部分留言…</p></div></div>    
</body>
</html>