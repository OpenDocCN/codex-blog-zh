<html>
<head>
<title>How to create GIFs with FFmpeg</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用FFmpeg创建gif</h1>
<blockquote>原文：<a href="https://medium.com/codex/small-sized-and-beautiful-gifs-with-ffmpeg-25c5082ed733?source=collection_archive---------1-----------------------#2019-05-31">https://medium.com/codex/small-sized-and-beautiful-gifs-with-ffmpeg-25c5082ed733?source=collection_archive---------1-----------------------#2019-05-31</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="a9b1" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">免费在任何平台上制作高质量的动画</h2></div><p id="cca8" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">GIF创建于1987年，至今仍是一种广泛使用的格式，用于在网络上保存短小、轻便的动画。尽管有许多优点，这种文件格式有许多限制。gif被限制为256色调色板，并且当动画的复杂性增加时会失去质量。因此，转换设置必须发挥平衡图像质量和文件大小。</p><p id="8b84" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我曾经在Adobe Photoshop中创建gif。然而，由于Photoshop有500帧的限制，长而平滑的动画必须使用变通方法来创建。这很耗时，而且Photoshop也不是我的主要设计工具，所以我不得不寻找其他选择。Giffox 只录制选定的屏幕片段，但不允许从本地文件夹上传视频。还有，在免费版里，它放水印，不做10秒以上的gif。更不用说它只在Mac上可用，而FFmpeg是跨平台的，没有这样的限制。<a class="ae jt" href="https://ezgif.com" rel="noopener ugc nofollow" target="_blank"> Ezgif </a>的上传限制为2000个文件，每个文件的最大大小为6MB或总共100MB。在在线转换器中，它是最好的之一，但它根据视频持续时间限制了FPS。FFmpeg具有良好的性能，可以处理大文件。</p><h2 id="2b2a" class="ju jv hi bd jw jx jy jz ka kb kc kd ke jg kf kg kh jk ki kj kk jo kl km kn ko bi translated">准备</h2><p id="b739" class="pw-post-body-paragraph ix iy hi iz b ja kp ij jc jd kq im jf jg kr ji jj jk ks jm jn jo kt jq jr js hb bi translated">在终端中安装运行以下脚本的<a class="ae jt" href="https://brew.sh" rel="noopener ugc nofollow" target="_blank">自制软件</a>。</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="286c" class="ju jv hi kz b fi ld le l lf lg">/usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"</span></pre><p id="3356" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">安装<a class="ae jt" href="https://www.ffmpeg.org/download.html" rel="noopener ugc nofollow" target="_blank"> FFmpeg </a>在终端中运行以下脚本。</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="efcf" class="ju jv hi kz b fi ld le l lf lg">brew install ffmpeg</span></pre><h2 id="5e38" class="ju jv hi bd jw jx jy jz ka kb kc kd ke jg kf kg kh jk ki kj kk jo kl km kn ko bi translated">将视频转换为GIF</h2><p id="0885" class="pw-post-body-paragraph ix iy hi iz b ja kp ij jc jd kq im jf jg kr ji jj jk ks jm jn jo kt jq jr js hb bi translated">在“终端”中，导航到包含您要转换的视频的文件夹，然后运行命令创建GIF。</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="26b3" class="ju jv hi kz b fi ld le l lf lg">ffmpeg -i recording.mov result.gif</span></pre><p id="1f5a" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这是最简单的命令，现在让我们添加可视过滤器来定制输出。</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="d0ee" class="ju jv hi kz b fi ld le l lf lg">ffmpeg -i recording.mov -vf fps=5,scale=1200:-1,smartblur=ls=-0.5,crop=iw:ih-2:0:0 result.gif</span></pre><ul class=""><li id="2f7d" class="lh li hi iz b ja jb jd je jg lj jk lk jo ll js lm ln lo lp bi translated"><strong class="iz hj"> -i </strong>是<strong class="iz hj"> </strong>一个输入键，后面跟随着你要转换的文件名。</li><li id="2cb9" class="lh li hi iz b ja lq jd lr jg ls jk lt jo lu js lm ln lo lp bi translated"><strong class="iz hj"> -vf </strong>是设置视觉滤镜的按键。</li><li id="0b98" class="lh li hi iz b ja lq jd lr jg ls jk lt jo lu js lm ln lo lp bi translated"><strong class="iz hj"> fps </strong>是描述输出帧率的字符串(默认为“25”)。</li><li id="c469" class="lh li hi iz b ja lq jd lr jg ls jk lt jo lu js lm ln lo lp bi translated"><strong class="iz hj">比例</strong>设置宽度和高度，“-1”保留纵横比。</li><li id="599b" class="lh li hi iz b ja lq jd lr jg ls jk lt jo lu js lm ln lo lp bi translated"><strong class="iz hj"> smartblur </strong>模糊或锐化视频，“ls”表示“亮度强度”——<a class="ae jt" href="https://ffmpeg.org/ffmpeg-filters.html#smartblur-1" rel="noopener ugc nofollow" target="_blank">smart blur</a>选项之一。从-1到0的值锐化图像。</li><li id="a299" class="lh li hi iz b ja lq jd lr jg ls jk lt jo lu js lm ln lo lp bi translated"><strong class="iz hj">裁剪</strong>修剪像素，“iw:ih-2:0:0”告诉从底部修剪2 px。</li></ul><blockquote class="lv"><p id="5146" class="lw lx hi bd ly lz ma mb mc md me js dx translated"><strong class="ak">可以通过降低帧速率、缩小图像和减少调色板来减小文件大小。</strong></p></blockquote><p id="fd82" class="pw-post-body-paragraph ix iy hi iz b ja mf ij jc jd mg im jf jg mh ji jj jk mi jm jn jo mj jq jr js hb bi translated">由于某种原因，QuickTime总是在屏幕底部显示一条黑线。很好的一点是，录音可以在FFmpeg中进行修剪，而不必打开额外的视频编辑软件。同样，帧速率被降低到5 fps，至于这个GIF动画的流畅度就不那么重要了。由于GIF大多是文本清晰度可以提高一点点。转换后的GIF如下图所示。</p><figure class="ku kv kw kx fd ml er es paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="er es mk"><img src="../Images/53060da5aaf6ab9258b5a78e1985cbb8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*zFke8dtwF9_R5DCLrTvyyw.gif"/></div></div><figcaption class="ms mt et er es mu mv bd b be z dx translated">分辨率:1200x586。时长:15秒。FPS: 5。大小:382 KB。</figcaption></figure><h2 id="1a65" class="ju jv hi bd jw jx jy jz ka kb kc kd ke jg kf kg kh jk ki kj kk jo kl km kn ko bi translated">将一系列图像转换为GIF</h2><p id="1568" class="pw-post-body-paragraph ix iy hi iz b ja kp ij jc jd kq im jf jg kr ji jj jk ks jm jn jo kt jq jr js hb bi translated">可以从一系列图像中创建动画，这有时非常有用。例如，旧版本的Adobe Media Encoder不能导出为GIF，因此可以从PNG序列创建动画。下面的命令从“框架”文件夹中从000到999枚举的图像创建GIF。</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="53dd" class="ju jv hi kz b fi ld le l lf lg">ffmpeg -i frames/%03d.png -vf fps=20,scale=720:-1 logo.gif</span></pre><figure class="ku kv kw kx fd ml er es paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="er es mw"><img src="../Images/8bb36ee7973fb24bef01a8a8561f3156.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*19P8BZflAxc-spO9A-ezwg.gif"/></div></div><figcaption class="ms mt et er es mu mv bd b be z dx translated">使用默认调色板的GIF是粒状的，需要24 MB。</figcaption></figure><h2 id="da83" class="ju jv hi bd jw jx jy jz ka kb kc kd ke jg kf kg kh jk ki kj kk jo kl km kn ko bi translated">定义自定义调色板</h2><p id="c77b" class="pw-post-body-paragraph ix iy hi iz b ja kp ij jc jd kq im jf jg kr ji jj jk ks jm jn jo kt jq jr js hb bi translated">转换后的GIF只有三种颜色:白色和两种蓝色，因此，默认的256色调色板可以减少到16色。自定义调色板是用<em class="mx">调色板根</em>过滤器创建的。</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="b282" class="ju jv hi kz b fi ld le l lf lg">ffmpeg -i frames/200.png -vf palettegen=16 palette.png</span></pre><p id="3cc5" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">创建调色板后，它可以用于GIF转换。</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="ff38" class="ju jv hi kz b fi ld le l lf lg">ffmpeg -i frames/%03d.png -i palette.png -filter_complex "fps=20,scale=720:-1:flags=lanczos[x];[x][1:v]paletteuse" logo.gif</span></pre><ul class=""><li id="15e4" class="lh li hi iz b ja jb jd je jg lj jk lk jo ll js lm ln lo lp bi translated"><strong class="iz hj">-当有多个输入和/或输出时，使用filter_complex </strong>。</li><li id="36c0" class="lh li hi iz b ja lq jd lr jg ls jk lt jo lu js lm ln lo lp bi translated"><strong class="iz hj"> flags=lanczos </strong>设置重新缩放算法。<em class="mx">与<em class="mx">双三次</em>相比，Lanczos </em>缩放器产生的模糊输入更少。</li><li id="62cc" class="lh li hi iz b ja lq jd lr jg ls jk lt jo lu js lm ln lo lp bi translated"><strong class="iz hj">【x】【1:v】</strong>是<a class="ae jt" href="https://ffmpeg.org/ffmpeg-filters.html#Filtergraph-syntax-1" rel="noopener ugc nofollow" target="_blank">链接标签</a> —给予输出过滤器的名称。</li><li id="47f2" class="lh li hi iz b ja lq jd lr jg ls jk lt jo lu js lm ln lo lp bi translated"><strong class="iz hj">调色板使用</strong>是一个过滤器，告诉使用自定义调色板。</li></ul><figure class="ku kv kw kx fd ml er es paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="er es mw"><img src="../Images/b5d81d872491f33255eb215dcc8314ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*zDtTdQiAjYInkJf__0j94g.gif"/></div></div><figcaption class="ms mt et er es mu mv bd b be z dx translated">带有自定义调色板的GIF具有更高的质量，需要279 KB。</figcaption></figure><h2 id="05e5" class="ju jv hi bd jw jx jy jz ka kb kc kd ke jg kf kg kh jk ki kj kk jo kl km kn ko bi translated">使用调色板将视频转换为GIF</h2><p id="5a29" class="pw-post-body-paragraph ix iy hi iz b ja kp ij jc jd kq im jf jg kr ji jj jk ks jm jn jo kt jq jr js hb bi translated">如前所述，GIF格式存储了一个全局调色板，可以用自定义颜色重新定义以获得更好的质量。首先，让我们用默认的调色板创建GIF，它将用于比较。顺便说一下，从输入文件只需要2秒钟，所以具体的部分将被转换为GIF。</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="57f1" class="ju jv hi kz b fi ld le l lf lg">ffmpeg -ss 1:24 -i avengers.mp4 -vf fps=15,scale=720:-1 -t 2 avengers.gif</span></pre><ul class=""><li id="fadd" class="lh li hi iz b ja jb jd je jg lj jk lk jo ll js lm ln lo lp bi translated"><strong class="iz hj"> -ss </strong>在输入文件中寻找特定的时间戳。在这种情况下，提取将从1分24秒开始。</li><li id="2372" class="lh li hi iz b ja lq jd lr jg ls jk lt jo lu js lm ln lo lp bi translated"><strong class="iz hj"> -t </strong>限制从输入文件读取数据的持续时间。在这种情况下，持续2秒钟。</li></ul><p id="4544" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为了创建调色板，需要提取一个帧。</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="73d5" class="ju jv hi kz b fi ld le l lf lg">ffmpeg -ss 1:25 -i avengers.mp4 -vframes 1 -vf scale=720:-1 snippet.jpg</span></pre><ul class=""><li id="0dff" class="lh li hi iz b ja jb jd je jg lj jk lk jo ll js lm ln lo lp bi translated"><strong class="iz hj"> -vframes </strong>设置要输出的视频帧数。</li></ul><p id="3921" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然后使用创建的片段生成256色调色板。</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="3af6" class="ju jv hi kz b fi ld le l lf lg">ffmpeg -i snippet.jpg -vf palettegen palette.png</span></pre><p id="b1ab" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">最后，调色板用于创建GIF。</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="8413" class="ju jv hi kz b fi ld le l lf lg">ffmpeg -ss 1:24 -i avengers.mp4 -i palette.png -filter_complex "fps=15,scale=720:-1:flags=lanczos[x];[x][1:v]paletteuse" -t 2 avengers2.gif</span></pre><h2 id="479b" class="ju jv hi bd jw jx jy jz ka kb kc kd ke jg kf kg kh jk ki kj kk jo kl km kn ko bi translated">每帧生成调色板</h2><p id="d29b" class="pw-post-body-paragraph ix iy hi iz b ja kp ij jc jd kq im jf jg kr ji jj jk ks jm jn jo kt jq jr js hb bi translated">每帧生成一个调色板并获得更好的质量是可能的。</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="1d6b" class="ju jv hi kz b fi ld le l lf lg">ffmpeg -ss 1:24 -t 2 -i avengers.mp4 -filter_complex "[0:v] fps=15,scale=w=720:h=-1,split [a][b];[a] palettegen=stats_mode=single [p];[b][p] paletteuse=new=1" avengers3.gif</span></pre><p id="15c2" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">下面比较了两张gif，第一张是用默认调色板创建的，占用2.5 MB。第二个是用每帧调色板创建的，占用5.4 MB。</p><figure class="ku kv kw kx fd ml er es paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="er es mw"><img src="../Images/3077fe1257ec970bd4ad07671cc6ef46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*lCuPQwwFMSmp0HE8OXFSHA.gif"/></div></div><figcaption class="ms mt et er es mu mv bd b be z dx translated">使用默认调色板的GIF具有最佳的质量/大小比。</figcaption></figure><figure class="ku kv kw kx fd ml er es paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="er es mw"><img src="../Images/6c707f91d76d5629626eb80742786894.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*y2DzPnhDGGY8PvoiiGAsyQ.gif"/></div></div><figcaption class="ms mt et er es mu mv bd b be z dx translated">每帧带调色板的GIF质量最好，但尺寸却翻倍了。</figcaption></figure><h2 id="b114" class="ju jv hi bd jw jx jy jz ka kb kc kd ke jg kf kg kh jk ki kj kk jo kl km kn ko bi translated">额外提示</h2><p id="501c" class="pw-post-body-paragraph ix iy hi iz b ja kp ij jc jd kq im jf jg kr ji jj jk ks jm jn jo kt jq jr js hb bi translated">使用<a class="ae jt" href="http://www.lcdf.org/gifsicle/" rel="noopener ugc nofollow" target="_blank"> Gifscisle </a>您可以进一步优化GIF并无损缩小其大小。要安装Gifsicle，请在终端中运行以下脚本。</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="6722" class="ju jv hi kz b fi ld le l lf lg">brew install gifsicle</span></pre><p id="9265" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">使用以下命令优化gif。</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="37e5" class="ju jv hi kz b fi ld le l lf lg">gifsicle -O3 animation.gif -o animation_optimized.gif</span></pre><ul class=""><li id="dad3" class="lh li hi iz b ja jb jd je jg lj jk lk jo ll js lm ln lo lp bi translated"><strong class="iz hj"> -O3 </strong>是一个优化级别，尝试多种方法来实现更好的压缩。<a class="ae jt" href="http://www.lcdf.org/gifsicle/man.html" rel="noopener ugc nofollow" target="_blank"> Gifsicle手册页</a>有更多信息。</li><li id="a22e" class="lh li hi iz b ja lq jd lr jg ls jk lt jo lu js lm ln lo lp bi translated"><strong class="iz hj"> -o </strong>是一个输出键，后面跟一个文件名。</li></ul><p id="7029" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">下面是一个用FFmpeg创建的例子，使用自定义调色板，并在Gifsicle中进一步优化。大小从15 MB减少到14.4 MB。</p><figure class="ku kv kw kx fd ml er es paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="er es mw"><img src="../Images/1717d75ef7b2aac781525387c74fc36d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*N2onDhIb_hd4FedS4rmNKw.gif"/></div></div><figcaption class="ms mt et er es mu mv bd b be z dx translated">分辨率:720x405。时长:7秒。FPS: 18。大小:14.4 MB。</figcaption></figure></div><div class="ab cl my mz gp na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="hb hc hd he hf"><p id="6f4a" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="mx">起初，所有这些可能看起来令人困惑，但安装和配置不超过5分钟。设置完成后，只需使用脚本并根据需要进行修改——非常简单。我希望这个指南对你有用。你转换gif的首选方法是什么？</em></p><h1 id="38c2" class="nf jv hi bd jw ng nh ni ka nj nk nl ke io nm ip kh ir nn is kk iu no iv kn np bi translated"><strong class="ak">喜欢这篇文章？</strong></h1><p id="e7ee" class="pw-post-body-paragraph ix iy hi iz b ja kp ij jc jd kq im jf jg kr ji jj jk ks jm jn jo kt jq jr js hb bi translated">请支持我的努力，我会经常写信的。</p><p id="7e20" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">BTC:15 xxw 1 jndrbzzzkvnyicffwtefxyte 7 CPS</p><p id="07f0" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">ETH:0x 5 f 88 ca 7 a 7 DFC 671 D1 e 618 D1 f 76d 05 a 0 BF 85 c 0d 44</p></div></div>    
</body>
</html>