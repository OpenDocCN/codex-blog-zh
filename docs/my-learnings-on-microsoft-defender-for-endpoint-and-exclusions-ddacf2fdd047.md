# æˆ‘å¯¹ Microsoft Defender for Endpoint å’Œ Exclusions çš„äº†è§£

> åŸæ–‡ï¼š<https://medium.com/codex/my-learnings-on-microsoft-defender-for-endpoint-and-exclusions-ddacf2fdd047?source=collection_archive---------0----------------------->

![](img/d610e0d2e516f14bfb4cdf505bcb6114.png)

Ashkan Forouzani åœ¨ [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) ä¸Šçš„ç…§ç‰‡

è¿‘å¹´æ¥ï¼Œæ¯å½“æˆ‘ä¸å¾—ä¸å¤„ç†åç—…æ¯’è§£å†³æ–¹æ¡ˆæ—¶ï¼Œæ’é™¤çš„è¯é¢˜æ€»ä¼šåœ¨æŸä¸ªæ—¶å€™å‡ºç°ã€‚é€šå¸¸ï¼Œäººä»¬æ€»æ˜¯å¾ˆå¿«è¾¾æˆä¸€è‡´ï¼Œå³å¤„ç†æ’é™¤æ¡æ¬¾çš„æœ€ä½³æ–¹å¼æ˜¯ä¸ä½¿ç”¨å®ƒä»¬ğŸ˜‰ã€‚å°½ç®¡å¦‚æ­¤ï¼Œæˆ‘åªé‡åˆ°è¿‡å°‘æ•°æ²¡æœ‰æ’é™¤çš„å…¬å¸ï¼Œå¹¶ä¸”å½“åˆ‡æ¢åˆ°æ–°çš„è§£å†³æ–¹æ¡ˆæ—¶ï¼Œä¸è¿ç§»å®ƒä»¬æ€»æ˜¯è¢«è®¤ä¸ºæ˜¯é¡¹ç›®é£é™©ã€‚

> æ˜ç¡®åœ°è¯´ï¼Œæˆ‘çš„å»ºè®®æ˜¯åˆ©ç”¨ä¸€åˆ‡æœºä¼šæ¶ˆé™¤(æ—§çš„)å¼‚å¸¸ï¼Œä¸è¦è¿ç§»ä»»ä½•å°šæœªè¢«è¯æ˜ä¼šç»™æ–°è§£å†³æ–¹æ¡ˆå¸¦æ¥é—®é¢˜çš„ä¸œè¥¿ã€‚

ç„¶è€Œï¼Œäº†è§£ä½ çš„æ•Œäººå¹¶æœ‰ä¸€ä¸ªè®¡åˆ’ä»¥é˜²ä½ è¢«è¿«ä½¿ç”¨æ’é™¤æ³•æ€»æ˜¯å¥½çš„ã€‚å› æ­¤ï¼Œåœ¨è¿™ç¯‡åšå®¢ä¸­ï¼Œæˆ‘å°†å°è¯•å±•ç¤ºå“ªäº›é™¤å¤–è´£ä»»ï¼Œå®ƒä»¬ä¼šå¸¦æ¥å“ªäº›é£é™©ï¼Œä»¥åŠå¦‚ä½•ä»¥ä¸€ç§å®ç”¨çš„æ–¹å¼å®æ–½å®ƒä»¬ã€‚

# ä»€ä¹ˆæ˜¯æ’é™¤ï¼Œä¸ºä»€ä¹ˆæˆ‘åº”è¯¥å…³å¿ƒï¼Ÿ

è¯¸å¦‚å¾®è½¯ Defender AV (MDAV)ä¹‹ç±»çš„ç—…æ¯’æ‰«æå™¨çš„å·¥ä½œå°±æ˜¯æ£€æµ‹æ¶æ„è½¯ä»¶å¹¶ä½¿å…¶å¤±æ•ˆã€‚ç”±äº Windows çš„æ™®åŠï¼Œè¿™ä¸ªé—®é¢˜è‡ª 90 å¹´ä»£ä»¥æ¥ä¸€ç›´å­˜åœ¨ã€‚è™½ç„¶åœ¨å¼€å§‹æ—¶ï¼Œäººä»¬éå¸¸å…³æ³¨å·²çŸ¥æ¶æ„è½¯ä»¶çš„ç‰¹å¾/æ¨¡å¼ï¼Œä½†è¿™ä¸ªä¸»é¢˜æœ€è¿‘å˜å¾—è¶Šæ¥è¶Šä¸é‡è¦ï¼Œå› ä¸ºè¿™äº›ç—…æ¯’å·²ç»å˜å¼‚äº†ä¸€æ®µæ—¶é—´(å°±åƒçœŸæ­£çš„ç—…æ¯’ä¸€æ ·)ï¼Œå¹¶ä¸”æ¯”ä¾›åº”å•†æ›´æ–°å…¶ç‰¹å¾çš„é€Ÿåº¦å¿«å¾—å¤šã€‚ç°ä»£è§£å†³æ–¹æ¡ˆï¼Œå¦‚ Microsoft Defender for Endpoint(Defender AV æ˜¯å…¶ä¸­çš„ä¸€éƒ¨åˆ†)ï¼Œé™¤äº†ç­¾åæ£€æµ‹ä¹‹å¤–ï¼Œè¿˜å…·æœ‰å¹¿æ³›çš„æ£€æµ‹æ–¹æ³•ï¼Œå¹¶ä¾èµ–æœºå™¨å­¦ä¹ å’Œè¡Œä¸ºç›‘æ§æ–¹æ³•è¿›è¡Œæ£€æµ‹ã€‚

MDAV çš„æ¶æ„è½¯ä»¶æ£€æµ‹å¯ä»¥é€šè¿‡å„ç§æœºåˆ¶æ¥æ‰§è¡Œã€‚é™¤äº†å„ç§é¢„è®¾æˆ–æŒ‰éœ€æ‰«æ(å¿«é€Ÿã€å®Œå…¨ã€è‡ªå®šä¹‰)ä¹‹å¤–ï¼Œå®æ—¶é˜²æŠ¤ä¹Ÿå¤„äºæ´»åŠ¨çŠ¶æ€ã€‚å®æ—¶ä¿æŠ¤[åœ¨æ‰“å¼€å’Œå…³é—­æ–‡ä»¶æ—¶ï¼Œä»¥åŠæ¯å½“ç”¨æˆ·å¯¼èˆªåˆ°ä¸€ä¸ªæ–‡ä»¶å¤¹](https://docs.microsoft.com/en-us/microsoft-365/security/defender-endpoint/run-scan-microsoft-defender-antivirus?view=o365-worldwide)æ—¶ï¼Œéƒ½ä¼šæ£€æŸ¥æ–‡ä»¶ã€‚

åƒä»»ä½•å…¶ä»–åç—…æ¯’è§£å†³æ–¹æ¡ˆä¸€æ ·ï¼Œå½“ç„¶å¯ä»¥åœ¨ MDAV ä¸­ä¸ºæ–‡ä»¶ã€æ–‡ä»¶å¤¹ã€è¿›ç¨‹å’Œè¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶åˆ›å»º(ç»å…¸)æ’é™¤ã€‚è¿™äº›ä¿¡æ¯å­˜å‚¨åœ¨ç«¯ç‚¹ä¸Šçš„æ³¨å†Œè¡¨ä¸­ï¼ŒGPO çš„æ’é™¤ä¿¡æ¯å¯ä»¥é€šè¿‡ Powershell è½»æ¾æ˜¾ç¤ºã€‚

æ’é™¤å¯é˜²æ­¢ Defender åœ¨æ‰«ææœŸé—´å’Œå®æ—¶é˜²æŠ¤ä¸­å°†ç›¸åº”çš„æ–‡ä»¶æˆ–è¿›ç¨‹æ£€æµ‹ä¸ºæ¶æ„è½¯ä»¶ï¼Œå¹¶é˜²æ­¢å¯åŠ¨å¯¹ç­–(å¦‚éš”ç¦»)ã€‚

## æ—¢ç„¶è¿™ç§è¡Œä¸ºä¸€å¼€å§‹å°±ç›¸å½“ç³Ÿç³•ï¼Œé‚£ä¹ˆé—®é¢˜å°±æ¥äº†:ä¸ºä»€ä¹ˆæ’æ–¥ä¼šå­˜åœ¨ï¼Ÿ

ä¸å¹¸çš„æ˜¯ï¼Œè®¸å¤šåˆ¶é€ å•†éƒ½æœ‰ä¸€ä¸ªæ’é™¤åˆ—è¡¨ï¼Œè¿™äº›åˆ—è¡¨æ˜¯è½¯ä»¶å·¥ä½œæ‰€å¿…éœ€çš„æˆ– T2 æ¨èçš„ã€‚ç”±äºæ¯ä¸ªç®¡ç†å‘˜éƒ½è®°å¾—åç—…æ¯’ä»£ç†æœ‰ç‚¹è¿‡äºé›„å¿ƒå‹ƒå‹ƒçš„æƒ…å†µï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸å›°éš¾çš„è®¨è®ºã€‚è¿™é‡Œæœ‰å‡ ä¸ªå¿…éœ€æ’é™¤çš„ä¾‹å­: [SCCM](https://docs.microsoft.com/en-us/troubleshoot/mem/configmgr/recommended-antivirus-exclusions) ï¼Œ [VEEAM](https://www.veeam.com/kb1999) ï¼Œ [Exchange](https://docs.microsoft.com/en-us/exchange/antispam-and-antimalware/windows-antivirus-software?view=exchserver-2019) ï¼Œ [Kaseya](https://helpdesk.kaseya.com/hc/en-gb/articles/229014948-Anti-Virus-and-Firewall-Exclusions-and-Trusted-Apps) ï¼Œ[MS SQL](https://support.microsoft.com/en-us/topic/how-to-choose-antivirus-software-to-run-on-computers-that-are-running-sql-server-feda079b-3e24-186b-945a-3051f6f3a95b)â€”â€”å¾®è½¯ç”šè‡³æœ‰ä¸€ä¸ª[çš„æ’é™¤åˆ—è¡¨](https://social.technet.microsoft.com/wiki/contents/articles/953.microsoft-anti-virus-exclusion-list.aspx)ğŸ˜‚

## å¥½å§ï¼Œè¿™ä¼¼ä¹æ˜¯æœ‰åŸå› çš„â€”â€”æ’æ–¥çš„å…·ä½“é—®é¢˜æ˜¯ä»€ä¹ˆï¼Ÿ

æ¯ä¸€ä¸ªæ’é™¤éƒ½ä¼šå‰Šå¼±æˆ‘ä»¬çš„é˜²å¾¡ï¼Œæ”»å‡»è€…çŸ¥é“ã€èƒ½çŒœåˆ°æˆ–è¯»åˆ°çš„æ¯ä¸€ä¸ªå¼±ç‚¹éƒ½ä¼šç»™ä»–æä¾›ä¸€ä¸ªå¥½æœºä¼šã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘çŸ¥é“è½¯ä»¶åˆ†å‘è·¯å¾„åœ¨æ‰€æœ‰ç³»ç»Ÿä¸Šéƒ½è¢«æ’é™¤äº†ï¼Œé‚£ä¹ˆè¿™æ˜¯ä¸€ä¸ªæ”¾ç½®æˆ‘æ”»å‡»çš„ä¸‹ä¸€æ­¥å·¥å…·å¹¶ä»é‚£é‡Œè¿è¡Œå®ƒä»¬çš„å¥½åœ°æ–¹ã€‚

> æˆ‘ä»¬çš„ä»»åŠ¡æ˜¯æŒ‘æˆ˜ä»»ä½•ç³»ç»Ÿä¸Šä»»ä½•æ’é™¤çš„å¿…è¦æ€§ï¼Œä»è€Œå‡å°‘å®ƒã€‚

# Microsoft Defender for Endpoint ä¸­æä¾›äº†å“ªäº›ç±»å‹çš„æ’é™¤ï¼Ÿ

åœ¨æˆ‘ä»¬å¼€å§‹äº†è§£ä¸åŒç±»å‹çš„æ’é™¤ä¹‹å‰ï¼Œæœ‰å¿…è¦äº†è§£ MDAV æ˜¯ Microsoft Defender for Endpoint(MDE)çš„ä¸€éƒ¨åˆ†ï¼Œä½†ä¹Ÿå¯ä»¥å•ç‹¬ä½¿ç”¨ã€‚å°±æ’é™¤è€Œè¨€ï¼Œè¿™æ„å‘³ç€å­˜åœ¨å±€é™äº MDAV çš„æ–¹æ³•å’Œè¦†ç›–æ•´ä¸ªå¥—ä»¶çš„æ–¹æ³•ã€‚

> æˆ‘å¼ºçƒˆæ¨èä½¿ç”¨ MDEï¼Œå› ä¸ºè¿™æå¤§åœ°å¢å¼ºäº†ä¿æŠ¤å¹¶æ”¯æŒè¿™é‡Œæè¿°çš„å„ç§ç‰¹æ€§ã€‚ä¸å¹¸çš„æ˜¯ï¼Œä»…ä»…ä¸€ä¸ªç—…æ¯’æ‰«æç¨‹åºâ€”â€”å³ä½¿å®ƒéå¸¸å¥½â€”â€”åœ¨ä»Šå¤©å·²ç»ä¸å¤Ÿäº†ã€‚

## Defender Antivirus ä¸­çš„æ’é™¤

åœ¨ MDAV ä¸­ï¼Œæœ‰ä»¥ä¸‹ç±»å‹çš„æ’é™¤:

*   [åŸºäºæ–‡ä»¶åã€æ‰©å±•åå’Œæ–‡ä»¶å¤¹ä½ç½®çš„æ’é™¤](https://docs.microsoft.com/en-us/microsoft-365/security/defender-endpoint/configure-extension-file-exclusions-microsoft-defender-antivirus?view=o365-worldwide)
*   [æ’é™¤è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶](https://docs.microsoft.com/en-us/microsoft-365/security/defender-endpoint/configure-process-opened-file-exclusions-microsoft-defender-antivirus?view=o365-worldwide)

è¿™äº›æ’é™¤å¯ä»¥é€šè¿‡å‡ ç§æ–¹å¼è¿›è¡Œç®¡ç†ã€‚é™¤äº†åé¢æè¿°çš„å·¥å…·(å¦‚ Intune)ä¹‹å¤–ï¼Œè¿˜æœ‰ä»¥ä¸‹æœ¬åœ°é€‰é¡¹:

*   åˆ›å»ºæœ¬åœ°ç­–ç•¥
*   ä½¿ç”¨ Windows å®‰å…¨ GUI
*   å¸¦æœ‰ CMDlet Add-MpPreference çš„ Powershell

æ˜¾ç¤ºæ‰€æœ‰æ’é™¤é¡¹çš„æœ€ç®€å•æ–¹æ³•æ˜¯ CMDlet Get-MpPreference(ä½†æ˜¯è¦é˜…è¯»æ’é™¤é¡¹ï¼Œæ‚¨éœ€è¦æ˜¯æœ¬åœ°ç®¡ç†å‘˜)ã€‚

![](img/f0f59c8e8a0e05ce53549bdf9562fc07.png)

ç”±äºè¿™äº›æ’é™¤é¡¹ä¹Ÿå­˜å‚¨åœ¨ç«¯ç‚¹ä¸Šçš„æ³¨å†Œè¡¨ä¸­ï¼Œå› æ­¤ä¹Ÿå¯ä»¥é€šè¿‡ Powershell è¯»å–ç›¸åº”çš„å¯†é’¥æ¥æ˜¾ç¤ºå®ƒä»¬:

![](img/1f8b9540d0953dfb2a983a2051f3c7e5.png)

> æœ‰è¶£çš„æ˜¯ï¼Œæœ¬åœ° hive ä¸­çš„å¯†é’¥åœ¨ Windows 11 ç³»ç»Ÿä¸Šå·²ç»æ— æ³•è¯»å–ã€‚æˆ‘è®¤ä¸ºè¿™æ˜¯å¾®è½¯çš„ä¸€é¡¹å¼ºåŒ–æªæ–½ã€‚

å¦‚æœä½ åœ¨ä½¿ç”¨**æµç¨‹æ’é™¤**ï¼Œåœ¨æˆ‘çœ‹æ¥ï¼Œè¿™å‡ ç‚¹éå¸¸å€¼å¾—æ³¨æ„:

*   [å½“æ‚¨å°†è¿›ç¨‹æ·»åŠ åˆ°è¿›ç¨‹æ’é™¤åˆ—è¡¨æ—¶ï¼ŒMicrosoft Defender Antivirus ä¸ä¼šæ‰«æç”±è¯¥è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶ï¼Œæ— è®ºè¿™äº›æ–‡ä»¶ä½äºä½•å¤„ã€‚ä½†æ˜¯ï¼Œè¿›ç¨‹æœ¬èº«å°†è¢«æ‰«æï¼Œé™¤éå®ƒä¹Ÿè¢«æ·»åŠ åˆ°æ–‡ä»¶ä¾‹å¤–åˆ—è¡¨ä¸­ã€‚](https://docs.microsoft.com/en-us/microsoft-365/security/defender-endpoint/configure-process-opened-file-exclusions-microsoft-defender-antivirus?view=o365-worldwide#:~:text=When%20you%20add%20a%20process,to%20the%20file%20exclusion%20list)
*   æ’é™¤ä»…é€‚ç”¨äº[å§‹ç»ˆåœ¨çº¿å®æ—¶ä¿æŠ¤å’Œç›‘æ§](https://docs.microsoft.com/en-us/microsoft-365/security/defender-endpoint/configure-real-time-protection-microsoft-defender-antivirus?view=o365-worldwide)ã€‚å®ƒä»¬ä¸é€‚ç”¨äºè®¡åˆ’æ‰«ææˆ–æŒ‰éœ€æ‰«æã€‚

## Defender Antivirus ä¸­çš„è‡ªåŠ¨æ’é™¤

é™¤äº†ç®¡ç†å‘˜é…ç½®çš„ä¾‹å¤–æƒ…å†µä¹‹å¤–ï¼Œè‡ªåŠ¨æ’é™¤ä»ç„¶é€‚ç”¨äº(2016/2019)æœåŠ¡å™¨ ***ï¼Œå…·ä½“å–å†³äºæœåŠ¡å™¨*** çš„è§’è‰²(å¦‚æœæœªç¦ç”¨)ã€‚ä¾‹å¦‚ï¼Œå¯¹äºåŸŸæ§åˆ¶å™¨ï¼ŒNTDS æ•°æ®åº“ã€äº‹åŠ¡æ—¥å¿—æ–‡ä»¶ã€NTDS å·¥ä½œæ–‡ä»¶å¤¹å’Œæ”¯æŒæ–‡ä»¶çš„ä¾‹å¤–æ˜¯æ´»åŠ¨çš„ã€‚

è¿™æ–¹é¢çš„ä¸€äº›æ³¨æ„äº‹é¡¹(æœ‰ç”¨çš„åŠŸèƒ½):

*   è¿™äº›æ’é™¤æœªæ˜¾ç¤ºåœ¨ä¸Šè¿°åˆ—è¡¨ä¸­
*   å®ƒä»¬ä»…é€‚ç”¨äºå®æ—¶ä¿æŠ¤ï¼Œä¸é€‚ç”¨äºè®¡åˆ’æ‰«ææˆ–æŒ‰éœ€æ‰«æ
*   è‡ªåŠ¨æ’é™¤åŠŸèƒ½ä»…é€‚ç”¨äºæœåŠ¡å™¨è§’è‰²çš„é»˜è®¤å®‰è£…ä½ç½®
*   æ›´å¤šä¿¡æ¯è¯·ç‚¹å‡»:
    [åœ¨ Windows æœåŠ¡å™¨ä¸Šé…ç½® Microsoft Defender é˜²ç—…æ¯’æ’é™¤| Microsoft Docs](https://docs.microsoft.com/en-us/microsoft-365/security/defender-endpoint/configure-server-exclusions-microsoft-defender-antivirus?view=o365-worldwide)

## MDE å…¶ä»–éƒ¨åˆ†çš„é™¤å¤–æ¡æ¬¾

é™¤äº†åç—…æ¯’è¿˜æœ‰å…¶ä»–å‡ ä¸ªç»„ä»¶å¯ä»¥é˜»æ­¢æ–‡ä»¶å’Œæ–‡ä»¶ä¸­çš„åŠŸèƒ½çš„æ‰§è¡Œã€‚å®ƒä»¬éƒ½æœ‰ä¸€ä¸ªå…±åŒç‚¹ï¼Œå³å¯ä»¥é€šè¿‡è‡ªå®šä¹‰æŒ‡ç¤ºå™¨åŠ å…¥ç™½åå•ã€‚

*   [ç«¯ç‚¹æ£€æµ‹å’Œå“åº”(EDR)](https://docs.microsoft.com/en-us/microsoft-365/security/defender-endpoint/overview-endpoint-detection-response)
*   [æ”»å‡»é¢å‡å°‘(ASR)è§„åˆ™](https://docs.microsoft.com/en-us/microsoft-365/security/defender-endpoint/attack-surface-reduction) â€”å‚è§ t [ä»–å…³äº ASR çš„ä¼Ÿå¤§åšå®¢](https://docs.microsoft.com/en-us/microsoft-365/security/defender-endpoint/enable-attack-surface-reduction?view=o365-worldwide#exclude-files-and-folders-from-asr-rules https://techcommunity.microsoft.com/t5/microsoft-defender-for-endpoint/demystifying-attack-surface-reduction-rules-part-2/ba-p/1326565)ã€‚
*   [å—æ§æ–‡ä»¶å¤¹è®¿é—®](https://docs.microsoft.com/en-us/microsoft-365/security/defender-endpoint/controlled-folders)

## è‡ªå®šä¹‰æŒ‡ç¤ºå™¨

Microsoft Defender for Endpoint åœ¨[è‡ªå®šä¹‰æŒ‡ç¤ºå™¨](https://docs.microsoft.com/en-us/microsoft-365/security/defender-endpoint/manage-indicators?view=o365-worldwide)éƒ¨åˆ†æä¾›äº†å¯¹[å±å®³æŒ‡ç¤ºå™¨(IoCs)](https://www.sans.org/reading-room/whitepapers/forensics/ioc-indicators-compromise-malware-forensics-34200) çš„é›†ä¸­ç®¡ç†ã€‚IOC å®é™…ä¸Šæ—¨åœ¨æ£€æµ‹å·²çŸ¥çš„æ¶æ„æ¨¡å¼ï¼Œå¹¶é˜»æ­¢å®ƒä»¬ï¼Œä¾‹å¦‚é€šè¿‡ MDE ä¹‹ç±»çš„å®‰å…¨äº§å“ã€‚

é™¤äº†è­¦æŠ¥å’Œè­¦æŠ¥+é˜»æ­¢æ“ä½œï¼Œè‡ªå®šä¹‰æŒ‡ç¤ºå™¨éƒ¨åˆ†è¿˜åŒ…æ‹¬å…è®¸æ“ä½œï¼Œå¯ç”¨äºç™½åå•ã€‚æ–‡ä»¶çš„ç™½åå•ä¸æ˜¯é€šè¿‡è·¯å¾„æˆ–æ–‡ä»¶åè€Œæ˜¯é€šè¿‡æ•£åˆ—æ¥å®Œæˆçš„ã€‚é™¤äº†æ–‡ä»¶ï¼Œè¿˜å¯ä»¥ä¸º IPs & URLs å’Œè¯ä¹¦åˆ›å»ºæ¡ç›®ã€‚

æ–‡ä»¶å“ˆå¸Œå¯ä»¥åœ¨ MD5ã€SHA-1 æˆ– SHA-256 ä¸­åˆ›å»ºã€‚å°½ç®¡è¿™äº›ç®—æ³•ä¸­çš„æ¯ä¸€ä¸ªéƒ½æ¯”æ–‡ä»¶åæˆ–æ–‡ä»¶å¤¹åå®‰å…¨å¾—å¤šï¼Œä½†è¿˜æ˜¯åº”è¯¥ä½¿ç”¨ SHA-256 æ•£åˆ—ï¼Œå› ä¸ºç”±äºæ•£åˆ—çš„é•¿åº¦(32 ä½)çš„ç¼˜æ•…[å‘ç”Ÿå†²çªçš„å¯èƒ½æ€§å¤§å¤§é™ä½](https://www.avira.com/en/blog/md5-the-broken-algorithm)ã€‚å¦‚æœæ‚¨ä½¿ç”¨ GUIï¼Œåœ¨è¾“å…¥ MD5 å“ˆå¸Œæ—¶ä¹Ÿä¼šæ”¶åˆ°è­¦å‘Š:

![](img/4a8dd84797e8870260396e012d7e6bc2.png)

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘è¿˜æ²¡æœ‰èƒ½å¤Ÿè¯»å‡ºåœ¨ç³»ç»Ÿä¸Šæœ‰æ•ˆçš„è‡ªå®šä¹‰æŒ‡ç¤ºå™¨â€”â€”è¿™å°†æ•…æ„ç¢°æ’çš„å¯èƒ½æ€§é™ä½åˆ°å‡ ä¹ä¸ºé›¶ã€‚

è‡ªå®šä¹‰æŒ‡ç¤ºå™¨çš„åˆ›å»ºå¯ä»¥é€šè¿‡ GUI æˆ–é€šè¿‡ [API](https://docs.microsoft.com/en-us/microsoft-365/security/defender-endpoint/post-ti-indicator?view=o365-worldwide) ä½¿ç”¨*ä¸»åŠ¨è¡¥æ•‘åŠ¨ä½œè®¸å¯*æ¥å®Œæˆã€‚é€šè¿‡ä½¿ç”¨ APIï¼Œè¯¥æµç¨‹è¿˜å¯ä»¥å¾ˆå¥½åœ°åµŒå…¥åˆ°ç¥¨è¯ã€æ–‡æ¡£å’Œå‘å¸ƒç­‰æµç¨‹ä¸­ã€‚

# ç®¡ç†æ’é™¤çš„æœ€ä½³å·¥å…·æ˜¯ä»€ä¹ˆï¼Ÿ

é€‰æ‹©åˆé€‚çš„å·¥å…·åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå–å†³äºå…·ä½“æƒ…å†µï¼Œå¹¶ä¸”å…·æœ‰æˆ˜ç•¥æ€§ã€‚
çš„æ„æ€æ˜¯:å¦‚æœæˆ‘ç°åœ¨æœ‰ä¸€ä¸ªå·¥å…·æ¥ç®¡ç†æˆ‘çš„å®¢æˆ·çš„é…ç½®ï¼Œæˆ‘ä¸€æ–¹é¢ä¼šè¯•ç€ç”¨å®ƒæ¥ç®¡ç†æ’é™¤ã€‚å¦ä¸€æ–¹é¢ï¼Œæˆ‘ä¸èƒ½ç”¨æ‰€æœ‰çš„å·¥å…·(åŒæ ·å¥½åœ°)ç®¡ç†æ‰€æœ‰çš„æ’é™¤ï¼Œè¿™å¯èƒ½æ˜¯æ”¹å˜ç­–ç•¥çš„åŸå› (ä¹Ÿè®¸å·²ç»è¿‡æœŸäº†)ã€‚

*   åœ¨ **MDE é—¨æˆ·**ä¸­ï¼Œåªæœ‰å®šåˆ¶çš„æŒ‡ç¤ºå™¨ï¼Œå³æ•£åˆ—ï¼Œå¯ä»¥è¢«æ’é™¤â€”â€”å¹¶ä¸”åªæœ‰åœ¨é‚£é‡Œã€‚å› ä¸ºè‡ªå®šä¹‰æŒ‡ç¤ºå™¨æ˜¯(å‡ ä¹æ€»æ˜¯)é¦–é€‰çš„ç™½åå•å˜ä½“ï¼Œæ‰€ä»¥è¿™ä¸ªé—¨æˆ·åœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½æ˜¯å›ºå®šçš„ã€‚
*   **Intune** å¯ä»¥è®¾ç½®é™¤å“ˆå¸Œ/è‡ªå®šä¹‰æŒ‡æ ‡ä»¥å¤–çš„æ‰€æœ‰æ’é™¤é¡¹ã€‚ä¸å¹¸çš„æ˜¯ï¼Œ [Intune ä¼¼ä¹ä¸èƒ½ç»„åˆæ’é™¤åˆ—è¡¨](https://microsoftintune.uservoice.com/forums/291681-ideas/suggestions/40594768-merge-windows-defender-antivirus-exclusions-from-m)ï¼Œè¿™åœ¨å¤§å‹å¼‚æ„ç¯å¢ƒä¸­å¯èƒ½æ˜¯ä¸€ä¸ªæŒ‘æˆ˜ã€‚
*   **GPO**è¿˜å¯ä»¥ç”¨äºé…ç½®é™¤å“ˆå¸Œ/è‡ªå®šä¹‰æŒ‡ç¤ºå™¨ä¹‹å¤–çš„æ‰€æœ‰æ’é™¤é¡¹â€”â€”GPO ç”šè‡³å¯ä»¥åœ¨è¿™é‡Œç»„åˆå¤šä¸ªåˆ—è¡¨ã€‚ç„¶è€Œï¼Œå¯¹äºå®¢æˆ·æ¥è¯´ï¼Œåº”è¯¥è®°ä½é€šè¿‡ VPN åˆ†å‘è®¡ç®—æœºç­–ç•¥å¹¶ä¸ç†æƒ³â€”â€”ä½†æ˜¯ä»Šå¤©å¤§å¤šæ•°è¿™æ ·åšçš„äººå¯èƒ½å·²ç»çŸ¥é“äº†è¿™ä¸€ç‚¹ï¼›-)
*   æœ‰äº† **SCCM** ï¼Œå¯ä»¥å¾ˆå¥½åœ°ç®¡ç† AV æ’é™¤ã€‚ç„¶è€Œï¼Œå¯¹äº ASR æ’é™¤ï¼Œç›®å‰ä»ç„¶å­˜åœ¨ä¸æ”¯æŒé€šé…ç¬¦çš„é™åˆ¶ï¼Œè¿™ä¸¥é‡é™åˆ¶äº†å¯ç”¨æ€§ã€‚
*   æœ€åä½†åŒæ ·é‡è¦çš„æ˜¯ï¼Œæ‰€æœ‰èƒ½å¤Ÿæ“ä½œæ³¨å†Œè¡¨å€¼çš„**å·¥å…·å’Œè„šæœ¬**ä¹Ÿå¯ä»¥ç”¨æ¥ç®¡ç†é™¤å®šåˆ¶æŒ‡ç¤ºå™¨ä¹‹å¤–çš„ä¸€åˆ‡ã€‚

# å¤„ç†æ’é™¤çš„æœ€å¥½æ–¹æ³•æ˜¯ä»€ä¹ˆï¼Ÿ

å¦‚æ‚¨æ‰€è§ï¼Œæœ‰å‡ ç§æ–¹æ³•å¯ä»¥å°†æ–‡ä»¶åˆ—å…¥ç™½åå•å’Œé˜»æ­¢æ–‡ä»¶ï¼Œè¿™å¸¦æ¥äº†ä¸€äº›æŒ‘æˆ˜ï¼Œå°¤å…¶æ˜¯åœ¨è¾ƒå¤§çš„ç¯å¢ƒä¸­ã€‚å¤„ç†æ–‡ä»¶æ’é™¤çš„ä¸€ç§ç­–ç•¥å¯èƒ½å¦‚ä¸‹æ‰€ç¤º:

## #1:é¿å…æ’é™¤

è¿™æ„å‘³ç€æˆ‘ä»¬ä¸å¸Œæœ›æ’é™¤ã€‚æˆ‘ä»¬ä¸æƒ³è¿ç§»æ–°çš„æ’é™¤ï¼Œä¹Ÿä¸æƒ³è¿ç§»ç°æœ‰çš„æ’é™¤ã€‚æ¯ä¸€é¡¹æ’é™¤éƒ½å¿…é¡»æœ‰å……åˆ†çš„ç†ç”±ã€‚

## #2:å°½å¯èƒ½ä½¿ç”¨è‡ªå®šä¹‰æŒ‡ç¤ºå™¨(æ•£åˆ—)!

å¦‚ä¸Šæ‰€è¿°ï¼Œé…ç½®é¡¹æœ‰å‡ ä¸ªä¼˜ç‚¹:

*   å®ƒä»¬è¦å®‰å…¨å¾—å¤šï¼Œå› ä¸ºç¢°æ’çš„å¯èƒ½æ€§å¾ˆå°ã€‚
*   åˆ›ä½œå¯ä»¥å¾ˆå®¹æ˜“åœ°é€šè¿‡æ“ä½œæ‰‹å†Œæ•´åˆåˆ°æµç¨‹ä¸­ã€‚
*   ç®¡ç†æ˜¯åœ¨å®‰å…¨ä¸­å¿ƒå®Œæˆçš„ï¼Œè€Œä¸æ˜¯åœ¨é…ç½®ç®¡ç†ä¸­ã€‚

## #3:ä½¿ç”¨æ­£ç¡®çš„(ç»å…¸çš„)æ’é™¤ç±»å‹ï¼Œé¿å…å¸¸è§é”™è¯¯

å¦‚æœå“ˆå¸Œä¸å¯è¡Œï¼Œè¯·æŒ‰ç…§ä»¥ä¸‹é¡ºåºè¿›è¡Œä¼ ç»Ÿæ’é™¤:

*   å¤„ç†
*   (å®Œæ•´)è·¯å¾„
*   æ‰©å±•ËŒæ‰©å¼ 

> ä½¿ç”¨è¿™ç§æ’é™¤æ˜¯ä½ è¦é¿å…çš„ï¼Œå› ä¸ºå®ƒä»¬å¯èƒ½ä¼šè¢«æ»¥ç”¨ã€‚ä¸éš¾çŒœå‡ºå“ªäº›æ–‡ä»¶å¤¹è¢«æ’é™¤åœ¨å¤–ï¼Œå¹¶ä¸”å¾ˆå®¹æ˜“æ£€æŸ¥ã€‚

**åœ¨åˆ›å»ºæ’é™¤é¡¹**ä¹‹å‰ï¼Œæ‚¨åº”è¯¥æŸ¥çœ‹ä»¥ä¸‹ä¸¤ä¸ªæ¥æº:

*   [å®šä¹‰é™¤å¤–è´£ä»»çš„å»ºè®®](https://docs.microsoft.com/en-us/microsoft-365/security/defender-endpoint/configure-exclusions-microsoft-defender-antivirus?view=o365-worldwide#recommendations-for-defining-exclusions)
*   [å®šä¹‰é™¤å¤–è´£ä»»æ—¶è¦é¿å…çš„å¸¸è§é”™è¯¯](https://docs.microsoft.com/en-us/microsoft-365/security/defender-endpoint/common-exclusion-mistakes-microsoft-defender-antivirus?view=o365-worldwide)

é™¤äº†ä¸å¾—æ’é™¤çš„ä½ç½®åˆ—è¡¨ä¹‹å¤–ï¼Œå…¶ä»–å…¸å‹é”™è¯¯ä¹ŸåŒ…æ‹¬åœ¨å†…ï¼Œä¾‹å¦‚åœ¨æ’é™¤ä¸­ä½¿ç”¨æ²¡æœ‰æ–‡ä»¶å¤¹çš„æ–‡ä»¶åæˆ–æ­£ç¡®ä½¿ç”¨ç¯å¢ƒå˜é‡ã€‚

## #4:è®©è‡ªå·±ç†Ÿæ‚‰æ’é™¤çš„èŒƒå›´

æˆ‘è®¤ä¸ºè‡ªå®šä¹‰æŒ‡æ ‡ä¸éœ€è¦è¿›è¡ŒèŒƒå›´ç•Œå®šï¼Œå› ä¸ºé£é™©éå¸¸å®¹æ˜“ç®¡ç†ï¼Œè€Œä¸”ä»˜å‡ºçš„åŠªåŠ›ä¸æˆæ¯”ä¾‹ã€‚(å®ç°è¿™ä¸€ç‚¹çš„æ–¹æ³•æ˜¯ MDE ä¸­çš„è®¾å¤‡ç»„)ã€‚

å¯¹äºå…¸å‹çš„æ’é™¤ï¼Œå»ºè®®ç¨å¾®åŒºåˆ†ä¸€ä¸‹ï¼Œæ‰¾åˆ°ä¸€ä¸ªå¥½çš„æŠ˜è¡·æ–¹æ¡ˆã€‚è¿™çœ‹èµ·æ¥æœåŠ¡å™¨é€šå¸¸æ˜æ˜¾ä¸åŒäºå®¢æˆ·ç«¯ï¼Œå› ä¸ºå®¢æˆ·ç«¯æ˜æ˜¾æ›´åŠ åŒè´¨ã€‚å°½ç®¡æœåŠ¡å™¨é€šå¸¸åœ¨ GPO ä¸­å¯¹æ¯ç§æœåŠ¡å™¨ç±»å‹è¿›è¡Œå¤„ç†ï¼Œä½†æ˜¯å®¢æˆ·ç«¯é€šå¸¸ä¼šå°è¯•ä½¿ç”¨éå¸¸ç»Ÿä¸€çš„ç­–ç•¥ã€‚

ä½†æ˜¯ï¼Œæ ¹æ®ç»“æ„çš„ä¸åŒï¼Œç»´æŠ¤å¤šä¸ªåˆ—è¡¨å¹¶æ ¹æ®éœ€è¦ç»„åˆå®ƒä»¬ä»¥å‡å°‘ç®¡ç†å·¥ä½œä»ç„¶æ˜¯æœ‰æ„ä¹‰çš„ã€‚å®é™…çš„ä¾‹å­æ˜¯ï¼Œå¦‚æœåªæœ‰æŸä¸ªç”¨æˆ·ç»„ä½¿ç”¨æŸä¸ªè½¯ä»¶ï¼Œç„¶åæ‚¨ä¸ºè¿™äº›å®¢æˆ·ç«¯ä½¿ç”¨ä¸¤ä¸ªåˆ—è¡¨çš„ç»„åˆ(GPO å’Œ SCCM å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹)ã€‚ä¸ºäº†æ‰¾åˆ°ä¸€ä¸ªå¥½çš„æŠ˜ä¸­æ–¹æ¡ˆï¼Œç¨å¾®è®¡åˆ’ä¸€ä¸‹æ˜¯å€¼å¾—çš„ã€‚

## #5:ç›‘æ§å’Œæ£€æŸ¥ä½ çš„ Exlusions

åœ¨ä»»ä½•ç¯å¢ƒä¸­ï¼Œæ’é™¤éƒ½ä¼šéšç€æ—¶é—´çš„æ¨ç§»è€Œç´¯ç§¯ï¼Œå¤„ç†è¿™ä¸¤ä¸ªé—®é¢˜éå¸¸é‡è¦:

1.  æˆ‘å¦‚ä½•é˜²æ­¢å’Œæ£€æŸ¥æ’é™¤æ¡æ¬¾æ˜¯å¦æœ‰(éæ³•)å˜æ›´ï¼Ÿ
2.  å¦‚ä½•ä»¥åŠä½•æ—¶æ£€æŸ¥åº“å­˜ï¼Œå¦‚ä½•å‡å°‘åº“å­˜ï¼Ÿ

å¯¹äºé—®é¢˜ 1ï¼Œè¯·æŸ¥çœ‹ä¸‹é¢çš„ç›‘æ§éƒ¨åˆ†ã€‚å¯¹äºé—®é¢˜ 2ï¼Œä½ éœ€è¦ä¸€ä¸ªè¿‡ç¨‹ã€‚

# ä¸åŒçš„æœºåˆ¶æ˜¯å¦‚ä½•ç›¸äº’ä½œç”¨çš„ï¼Ÿ

## å¦‚æœæˆ‘ä½¿ç”¨å¤šç§é…ç½®æ–¹æ³•ä¼šæ€ä¹ˆæ ·ï¼Ÿ

é»˜è®¤æƒ…å†µä¸‹ï¼Œæœ¬åœ°æ›´æ”¹å°†æŒ‰ç…§ç»„ç­–ç•¥ã€é…ç½®ç®¡ç†å™¨æˆ– Intune ä¸åˆ—è¡¨åˆå¹¶ã€‚å½“å­˜åœ¨å†²çªæ—¶ï¼Œç»„ç­–ç•¥åˆ—è¡¨ä¼˜å…ˆã€‚æ‚¨å¯ä»¥[é…ç½®å¦‚ä½•åˆå¹¶æœ¬åœ°å’Œå…¨å±€å®šä¹‰çš„æ’é™¤åˆ—è¡¨](https://docs.microsoft.com/en-us/microsoft-365/security/defender-endpoint/configure-local-policy-overrides-microsoft-defender-antivirus?view=o365-worldwide#merge-lists)ï¼Œä»¥å…è®¸æœ¬åœ°æ›´æ”¹è¦†ç›–æ‰˜ç®¡éƒ¨ç½²è®¾ç½®ã€‚([æ¥æº](https://docs.microsoft.com/en-us/microsoft-365/security/defender-endpoint/configure-extension-file-exclusions-microsoft-defender-antivirus?view=o365-worldwide)

æˆ‘è®¤ä¸ºç¦ç”¨åˆå¹¶é€šå¸¸æ˜¯ä¸€ä»¶éå¸¸æœ‰ç”¨çš„äº‹æƒ…ã€‚ç›¸åº”çš„è®¾ç½®å¯ä»¥é€šè¿‡ [GPO](https://docs.microsoft.com/en-us/microsoft-365/security/defender-endpoint/configure-local-policy-overrides-microsoft-defender-antivirus?view=o365-worldwide#configure-how-locally-and-globally-defined-threat-remediation-and-exclusions-lists-are-merged) æˆ–é€šè¿‡ Intune ä¸­å¸¦æœ‰[è‡ªå®šä¹‰ç­–ç•¥](https://www.jeffgilb.com/custom-microsoft-intune-oma-uri-policy-ins-and-outs/)çš„ [Defender CSP](https://docs.microsoft.com/en-us/windows/client-management/mdm/defender-csp) æ¥å¯ç”¨ã€‚ä»¥è¿™ç§æ–¹å¼è®¾ç½®çš„ [RegKey](https://admx.help/?Category=Windows_10_2016&Policy=Microsoft.Policies.WindowsDefender::DisableLocalAdminMerge) ç°åœ¨å¯ä»¥ç¡®ä¿æœ¬åœ°æ·»åŠ çš„æ’é™¤é¡¹è¢«è¦†ç›–ã€‚

## å†²çªä¸­ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ

[MS æ–‡æ¡£](https://docs.microsoft.com/en-us/microsoft-365/security/defender-endpoint/indicator-file?view=o365-worldwide#policy-conflict-handling)æ˜¯è¿™æ ·å›ç­”è¿™ä¸ªé—®é¢˜çš„:

*è¯ä¹¦å’Œæ–‡ä»¶ IoC æ”¿ç­–å¤„ç†å†²çªå°†éµå¾ªä»¥ä¸‹é¡ºåº:*

*å¦‚æœæ–‡ä»¶ä¸è¢« Windows Defender åº”ç”¨ç¨‹åºæ§åˆ¶å’Œ AppLocker å¼ºåˆ¶æ¨¡å¼ç­–ç•¥å…è®¸ï¼Œåˆ™* ***é˜»æ­¢*** *å¦åˆ™å¦‚æœæ–‡ä»¶è¢« Microsoft Defender é˜²ç—…æ¯’ç¨‹åºå…è®¸æ’é™¤ï¼Œåˆ™* ***å…è®¸*** *å¦åˆ™å¦‚æœæ–‡ä»¶è¢«é˜»æ­¢æˆ–è­¦å‘Šæ–‡ä»¶ IoCï¼Œ ç„¶å* ***é˜»æ­¢/è­¦å‘Š*** *å¦åˆ™å¦‚æœæ–‡ä»¶è¢«å…è®¸æ–‡ä»¶ IoC ç­–ç•¥å…è®¸ï¼Œåˆ™* ***å…è®¸*** *å¦åˆ™å¦‚æœæ–‡ä»¶è¢« ASR è§„åˆ™ã€CFAã€AVã€SmartScreen é˜»æ­¢ï¼Œåˆ™* ***é˜»æ­¢*** *å¦åˆ™* ***å…è®¸***

ç®€å•æ¥è¯´ï¼Œæˆ‘çš„æœ‹å‹æ³•æ¯”å®‰åˆ›é€ äº†è¿™ä¸ªå¥‡å¦™çš„è¿·å› ï¼ğŸ˜

![](img/c4ecf57819c671e1e5404a5350010cea.png)

# æˆ‘å¦‚ä½•é˜²æ­¢å’Œæ£€æŸ¥æ’é™¤æ¡æ¬¾æ˜¯å¦æœ‰(éæ³•)å˜æ›´ï¼Ÿ

## ä¸€èˆ¬æ“ä½œé¢„é˜²

åœ¨æˆ‘ä»¬æŸ¥çœ‹ AV æ’é™¤ç”¨ä¾‹ä¹‹å‰ï¼Œæˆ‘å»ºè®®æ¯ä¸ªäººæŸ¥çœ‹ä¸€ä¸‹è¿™ä¸ªåšå®¢ä»¥äº†è§£åœ¨ Defender AV ä¸­ä¸€èˆ¬å¯ä»¥æ“çºµä»€ä¹ˆï¼Œä»¥åŠå¦‚ä½•æœ€å¥½åœ°å¤„ç†å®ƒã€‚å°è¯•é˜²æ­¢å¯¹é…ç½®çš„æ“çºµæ˜¯åˆç†çš„ï¼Œå°½ç®¡ç¯¡æ”¹ä¿æŠ¤å¯¹ AV æ’é™¤æ²¡æœ‰å½±å“ï¼Œä½†å®ƒçš„ä½¿ç”¨éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºå®ƒå¯ä»¥é˜²æ­¢é˜²å¾¡è€…çš„è®¸å¤šåŸºæœ¬æ“çºµã€‚

æœ€åï¼Œ[ä¸º Microsoft Defender AV è®¾ç½®é…ç½®æœ¬åœ°è¦†ç›–](https://docs.microsoft.com/en-us/microsoft-365/security/defender-endpoint/configure-local-policy-overrides-microsoft-defender-antivirus?view=o365-worldwide#configure-how-locally-and-globally-defined-threat-remediation-and-exclusions-lists-are-merged)å¯ç”¨äºé€šè¿‡ç®€å•åœ°ç¦ç”¨åˆ—è¡¨åˆå¹¶æ¥é˜²æ­¢æœ¬åœ°æ’é™¤çš„ç”Ÿæˆã€‚è¿™æ„å‘³ç€åªæœ‰ GPO ä¸­çš„ä¾‹å¤–é€‚ç”¨ã€‚

## æ£€æµ‹å’Œé˜²æ­¢æœ¬åœ°æ’é™¤

ä¸Šè¿°ç”¨äºç»„åˆæ’é™¤åˆ—è¡¨çš„è¡Œä¸ºå¯¹äºç¡®å®šèŒƒå›´éå¸¸æœ‰ç”¨ã€‚ä½†æ˜¯ï¼Œè¿™ç§è¡Œä¸ºä¹Ÿå¯èƒ½è¢«æ”»å‡»è€…åˆ©ç”¨ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨æœ¬åœ°ç®¡ç†æƒé™åˆ›å»ºè‡ªå·±çš„æœ¬åœ°æ’é™¤ï¼Œæ ¹æ®æˆ‘çš„ç»éªŒï¼Œè®¸å¤šå…¬å¸ä¸­ä¹Ÿæœ‰ä¸€äº›å¸æˆ·æœ‰æƒç¼–è¾‘å½±å“å®¢æˆ·çš„ GPOã€‚æœ‰è¶³å¤Ÿçš„ç†ç”±çœ‹çœ‹æˆ‘ä»¬å¦‚ä½•è¢«å‘ŠçŸ¥å˜åŒ–ã€‚

ç¬¬ä¸€ç§æ–¹æ³•æ˜¯é€šè¿‡è‡ªå®šä¹‰æ£€æµ‹æ¥æŸ¥çœ‹ MDE å®¢æˆ·æœºã€‚Alex [Verboon å·²ç»å‘è¡¨äº†ä¸€äº›å…³äºè¿™ä¸ªçš„å¥½ä¸œè¥¿ã€‚](https://gist.github.com/alexverboon/f2f52279a8a38583bca0589fdf88f9d9)

![](img/2853f1145e2cdee6b6c85a5f2e9ba51e.png)

å› æ­¤ï¼Œæ ¹æ®æˆ‘çš„æµ‹è¯•ï¼Œå¯ä»¥ç¡®å®šä»¥ä¸‹åœºæ™¯:

*   åˆ›å»ºæœ¬åœ°ç­–ç•¥
*   ä½¿ç”¨ Windows å®‰å…¨ GUI
*   å¸¦æœ‰ CMDlet Add-MpPreference çš„ Powershell

ç„¶è€Œï¼Œé™¤äº†ä¸ºæ­¤æä¾›çš„æ–¹æ³•ä¹‹å¤–ï¼Œæˆ‘è¿˜å¯ä»¥å°è¯•å°†æˆ‘çš„æ’é™¤é¡¹**ä½œä¸ºé”®**ç›´æ¥æ”¾å…¥æ³¨å†Œè¡¨:

ä»ç†è®ºä¸Šè®²ï¼Œè¿™å¯ä»¥åœ¨é…ç½®å•å…ƒ*HKLM \è½¯ä»¶\å¾®è½¯\Windows Defender\â€¦* å’Œ*HKLM \è½¯ä»¶\æ”¿ç­–\å¾®è½¯\Windows Defender\â€¦* ä¸­ç”¨ä¸åŒçš„æƒé™(ç®¡ç†å‘˜æˆ–ç³»ç»Ÿ)ä»¥å‡ ç§æ–¹å¼å®Œæˆ

åœ¨æˆ‘çš„æµ‹è¯•ä¸­ï¼Œæˆ‘ä¸èƒ½ä»¥ admin æˆ– SYSTEM çš„èº«ä»½æ›´æ”¹éç­–ç•¥è·¯å¾„ä¸­çš„é”®ï¼Œå°½ç®¡ SYSTEM æ˜¯é…ç½®å•å…ƒçš„æ‰€æœ‰è€…ã€‚æˆ‘æ€€ç–‘è¿™æ˜¯å› ä¸º Defender AV é˜»æ­¢å†…æ ¸æ¨¡å¼é©±åŠ¨ç¨‹åºæ›´æ”¹æ³¨å†Œè¡¨çš„è¿™ä¸€éƒ¨åˆ†ã€‚

åœ¨ç­–ç•¥ä¸‹çš„é…ç½®å•å…ƒä¸­ï¼Œå¯ä»¥ä½œä¸ºæœ¬åœ°ç®¡ç†å‘˜åˆ›å»ºè¿›ä¸€æ­¥çš„æ’é™¤(åœ¨ä¸€æ®µæ—¶é—´æˆ–ä¸€æ¬¡ gpupdate å)å°†è¢«åº”ç”¨ã€‚é—æ†¾çš„æ˜¯ï¼Œå¯¹äºé€šè¿‡è¿™ç§æ–¹å¼æˆ– GPO æ‰€åšçš„ä»»ä½•æ›´æ”¹ï¼Œéƒ½ä¸ä¼šç”Ÿæˆæ—¥å¿—ã€‚

> å¦‚æœæ‚¨åœ¨ç­–ç•¥ä¸‹åˆ›å»ºé…ç½®å•å…ƒå¹¶æ·»åŠ å¯†é’¥ï¼Œå³ä½¿åœ¨æœªåŠ å…¥åŸŸçš„ Windows 10 è®¾å¤‡ä¸Šä¹Ÿèƒ½å·¥ä½œ(é‡å¯å)ã€‚ä»æˆ‘çš„è§’åº¦æ¥çœ‹ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸ä¸¥é‡çš„é—®é¢˜ï¼Œåº”è¯¥ç”± MS æ¥è§£å†³ã€‚å¦‚æœä½ å¯¹è¿™ä¸ªæ¼æ´ç©¶ç«Ÿæ˜¯å¦‚ä½•è¢«åˆ©ç”¨çš„æ„Ÿå…´è¶£ï¼Œè¯·æŸ¥çœ‹ Fabian Bader çš„åšå®¢ï¼

## æ£€æµ‹å¹¶é˜²æ­¢ä»é…ç½®ç³»ç»Ÿä¸­æ’é™¤

ç”±äºå¦‚ä¸Šæ‰€è¿°æœ‰è®¸å¤šé…ç½®æ–¹æ³•ï¼Œè¿™ä¸æ˜¯ä¸€ä¸ªå®Œæ•´çš„åˆ—è¡¨ï¼Œä½†æˆ‘å°†è‡ªå·±é™åˆ¶åœ¨æˆ‘å¯ä»¥ä½¿ç”¨çš„å·¥å…·ä¸Šã€‚

***åœ¨ MDE ä¸­æ·»åŠ è‡ªå®šä¹‰æŒ‡æ ‡***

å¦‚ä¸Šæ‰€è¿°ï¼Œæ‚¨éœ€è¦*ä¸»åŠ¨è¡¥æ•‘æªæ–½æƒé™*æ¥æ“ä½œé…ç½®é¡¹ã€‚æ¯ä¸ªé…ç½®é¡¹éƒ½å¯ä»¥ç›´æ¥è¯†åˆ«å…¶åˆ›å»ºæ—¶é—´å’Œåˆ›å»ºè€…ã€‚

ä¸å¹¸çš„æ˜¯ï¼Œåœ¨å®¡è®¡æ—¥å¿—ä¸­è¿˜æ²¡æœ‰ç”¨äºåˆ›å»ºé…ç½®é¡¹çš„äº‹ä»¶ï¼Œä½†æ˜¯å› ä¸ºå·²ç»æœ‰äº†è¿‡æ»¤å™¨ï¼Œæ‰€ä»¥æˆ‘ä¹è§‚åœ°è®¤ä¸ºå¾ˆå¿«å°±å¯ä»¥ä¸“é—¨æœç´¢å®ƒä»¬æˆ–è€…å¯¹å®ƒä»¬å‘å‡ºè­¦æŠ¥ã€‚

![](img/2b3550de34eea14585596ec9a7b098e9.png)

***åœ¨ Intune*** ä¸­æ·»åŠ æ’é™¤é¡¹

å½“ç„¶ï¼Œä¹Ÿå¯ä»¥ç”¨ Intune æ·»åŠ æ›´å¤šçš„æ’é™¤é¡¹ã€‚è¿™äº›å¯ä»¥ç”±(è‡³å°‘)ä»¥ä¸‹è§’è‰²åˆ›å»º:

*   **åœ¨ Intune:** *ç«¯ç‚¹å®‰å…¨ç®¡ç†å™¨å’Œè‡ªå®šä¹‰è§’è‰²*
*   **åœ¨ AAD ä¸­:** *å…¨å±€ç®¡ç†å‘˜ã€Intune ç®¡ç†å‘˜ã€å®‰å…¨ç®¡ç†å‘˜*

è¿™äº›æ›´æ”¹åŒ…å«åœ¨ Intune å®¡è®¡æ—¥å¿—ä¸­ï¼Œå¦‚æœéœ€è¦ï¼Œå¯ä»¥[æŸ¥è¯¢](https://github.com/crmhh/stuff/blob/main/NewMDAVExclusionbyInune.kql)ç›¸åº”åœ°å‘å‡ºè­¦æŠ¥ã€‚

![](img/0f057fe57832f0cfca8e7fd349e4b3e5.png)

***é€šè¿‡ GPO* æ·»åŠ æ’é™¤é¡¹**

æœ€åï¼Œæœ‰å¯èƒ½é€šè¿‡ GPO æ·»åŠ æ’é™¤ã€‚é€šè¿‡ä¸Šè¿°ç”¨äºåˆå¹¶åˆ—è¡¨çš„è¡Œä¸ºï¼Œå¯ä»¥ä¸ºä½œç”¨äºç³»ç»Ÿçš„æ¯ä¸ªç°æœ‰æˆ–æ–°çš„ GPO æ·»åŠ é¢å¤–çš„æ’é™¤ã€‚

ä¸å¹¸çš„æ˜¯ï¼Œæ— è®ºæ˜¯ GPO çš„ä¿®æ”¹è¿˜æ˜¯é…ç½®çš„ç³»ç»Ÿéƒ½æ²¡æœ‰æŒ‡ç¤ºå·²ç»æ·»åŠ äº†æ’é™¤çš„äº‹ä»¶ã€‚æ‚¨åªä¼šçœ‹åˆ° GPO å·²è¢«ä¿®æ”¹æˆ–åº”ç”¨ã€‚è¦ç¡®å®šè¿™ç§å˜åŒ–ï¼Œç›®å‰åªæœ‰å®šæœŸçš„å¯¼å‡ºå’Œæ¯”è¾ƒä¼šæœ‰æ‰€å¸®åŠ©ã€‚

å†æ·±å…¥ä¸€ç‚¹ï¼Œçœ‹çœ‹é«˜çº§ç‹©çŒ:

![](img/00b237a3618968f5d9eeae2c01042263.png)

åœ¨æ¥è‡ª*HKLM \è½¯ä»¶\ç­–ç•¥\å¾®è½¯\* ç­–ç•¥é…ç½®å•å…ƒçš„ DeviceRegistry äº‹ä»¶è¡¨ä¸­æœ‰ä¸€äº›æ¡ç›®ç”šè‡³åŒ…å«å¯¹ *Windows Defender* é¡¹çš„æ›´æ”¹ï¼Œä½†æ˜¯ä¸åŒ…å«æ¥è‡ªæ’é™¤é…ç½®å•å…ƒçš„ä»»ä½•å†…å®¹ã€‚

# ç»“è®º

åœ¨è¿™ç¯‡åšå®¢ä¸­ï¼Œæˆ‘å°è¯•æ€»ç»“äº†æˆ‘åœ¨ Defender for Endpoint ä¸­å…³äºæ’é™¤çš„çŸ¥è¯†ã€‚æˆ‘ä»¬é¦–å…ˆçœ‹äº†æœ‰å“ªäº›ç±»å‹çš„æ’é™¤ä»¥åŠå¦‚ä½•ç®¡ç†å®ƒä»¬ï¼ŒåŒ…æ‹¬ä½¿ç”¨å“ªäº›æ’é™¤çš„ç­–ç•¥ã€‚ç„¶åï¼Œæˆ‘ä»¬æ›´æ·±å…¥åœ°æ¢è®¨äº†æ’é™¤æœºåˆ¶ï¼Œå†²çªå‘ç”Ÿæ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼Œä»¥åŠæœ‰å“ªäº›èŒƒå›´é€‰æ‹©ã€‚æœ€åä¸€éƒ¨åˆ†è®¨è®ºäº†é£é™©ã€å¼ºåŒ–å’Œç›‘æ§ã€‚

æˆ‘æ‹…å¿ƒè¿™ä¸ªä¸»é¢˜å°†ç»§ç»­ç›¸å…³ï¼Œå¹¶å¸Œæœ›æˆ‘å¿½ç•¥äº†ä¸€äº›ä¸œè¥¿ï¼Œç‰¹åˆ«æ˜¯åœ¨ç¡¬åŒ–å’Œç›‘æ§æ–¹é¢ã€‚å¾ˆæ˜æ˜¾ï¼Œæ‹¥æœ‰ç®¡ç†å‘˜æƒé™çš„æ”»å‡»è€…å¾ˆéš¾è¢«é˜»æ­¢ï¼Œä½†æ˜¯ä»–å¯ä»¥åˆ›å»ºä¸å¯è§çš„æ’é™¤ï¼Œä»è€Œåˆ›å»ºä¸€ä¸ªç©ºé—´æ¥é‡æ–°åŠ è½½æ‰€æœ‰å¿…è¦çš„å·¥å…·ï¼Œè¿™ä½¿å¾—æƒ…å†µå˜å¾—æ›´åŠ å›°éš¾ã€‚

å¯¹æˆ‘æ¥è¯´ï¼Œå…³é”®çš„éƒ¨åˆ†æ˜¯åˆ¶å®šä¸€ä¸ªç°å®çš„ç­–ç•¥æ¥å¤„ç†æ’æ–¥:

> #1:é¿å…æ’é™¤
> 
> #2:å°½å¯èƒ½ä½¿ç”¨è‡ªå®šä¹‰æŒ‡ç¤ºå™¨(æ•£åˆ—)!
> 
> #3:ä½¿ç”¨æ­£ç¡®çš„(ç»å…¸çš„)æ’é™¤ç±»å‹ï¼Œé¿å…å¸¸è§é”™è¯¯
> 
> #4:è®©è‡ªå·±ç†Ÿæ‚‰æ’é™¤çš„èŒƒå›´
> 
> #5:ç›‘æ§å’Œæ£€æŸ¥ä½ çš„ Exlusions

ä½ å¤„ç† exlusions çš„ç­–ç•¥æ˜¯ä»€ä¹ˆï¼Ÿè”ç³»æˆ‘:[https://twitter.com/cbrhh](https://twitter.com/cbrhh)

# æ‰¿è®¤

æ„Ÿè°¢[æ³•æ¯”å®‰Â·å·´å¾·](https://twitter.com/fabian_bader?s=20)å’Œ[çº³ä¸Â·å…‹æ©](https://twitter.com/nadineausRT?s=20)å¯¹æ‰€æœ‰ææ–™çš„å®¡æŸ¥å’Œæ£€æŸ¥ã€‚ğŸ’–åˆ«å¿˜äº†é˜…è¯»[æ³•æ¯”å®‰çš„åšå®¢](https://cloudbrothers.info/)ï¼

## æ›´å¤šæ¥æº:

[](https://yongrhee.wordpress.com/2020/07/29/how-to-take-care-of-false-positives-fps-with-mdatp-microsoft-defender-antivirus-system-center-endpoint-protection/) [## å¦‚ä½•ç”¨ MDATPã€å¾®è½¯ Defender Antivirusã€Systemâ€¦

### å…è´£å£°æ˜:æˆ‘åœ¨è¿™ä¸ªç½‘ç«™ä¸Šå‘è¡¨çš„è§‚ç‚¹æ˜¯æˆ‘çš„&ä»…ä»…æ˜¯æˆ‘çš„&ä¸ä¸€å®šåæ˜ â€¦

yongrhee.wordpress.com](https://yongrhee.wordpress.com/2020/07/29/how-to-take-care-of-false-positives-fps-with-mdatp-microsoft-defender-antivirus-system-center-endpoint-protection/) [](https://www.linkedin.com/pulse/microsoft-defender-atp-indicators-compromise-ioc-ahmed/) [## å¾®è½¯åå« ATP å¦¥åæŒ‡æ ‡å›½é™…å¥¥å§”ä¼šè§£é‡Š

### å›½é™…å¥¥å§”ä¼šå¤§å¤šæ•°ç»„ç»‡æ²¡æœ‰æ„è¯†åˆ°ä»–ä»¬å—åˆ°äº†æ”»å‡»ï¼Œç›´åˆ°â€¦

www.linkedin.com](https://www.linkedin.com/pulse/microsoft-defender-atp-indicators-compromise-ioc-ahmed/)