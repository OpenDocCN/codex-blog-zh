<html>
<head>
<title>AWS Private API Gateway with Custom domain names</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带有自定义域名的AWS私有API网关</h1>
<blockquote>原文：<a href="https://medium.com/codex/aws-private-api-gateway-with-custom-domain-names-350fee48b406?source=collection_archive---------0-----------------------#2021-04-09">https://medium.com/codex/aws-private-api-gateway-with-custom-domain-names-350fee48b406?source=collection_archive---------0-----------------------#2021-04-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="1663" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated"><strong class="ak">使用自定义DNS创建私有REST端点的分步指南</strong></h2></div><p id="19da" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">API gateway在公开API方面非常棒，你会发现很多关于它的博客和视频。然而，大多数组织希望定义私有API，供组织内的其他子系统使用。在学习如何用自定义DNS定义私有API时，我经历了很多挣扎。本文给出了如何实现这一点的分步指南。下面是我们在本文末尾将要实现的目标的描述。</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es jt"><img src="../Images/97f93a5e56d334f2d9febc95e0fbad82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HsPK9eSWzm73hGeG7dWyoA.png"/></div></div></figure></div><div class="ab cl kf kg gp kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="hb hc hd he hf"><p id="a242" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">第一步:创建一个接口VPC端点</strong></p><p id="9fb6" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">登录到您的AWS控制台并选择VPC服务。从左侧导航窗格中选择“端点”,然后点击“创建端点”按钮。在AWS服务列表中，选择<em class="km">com . Amazon AWS . com .[地区]。执行-api。</em>确保选择正确的VPC、子网和安全组，允许端口80和443上的流量。您还可以根据需要定义自定义策略，或者将其保留为“完全访问”创建后，记下VPC端点ID。我们将在步骤3中用到它。还要记下子网选项卡中的IPV4地址。当我们创建一个内部负载平衡器时，这些是需要的。</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es kn"><img src="../Images/fda7b04bd95336ec2c3c07c4564f69e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AtyTwovPlczC0tublG744g.jpeg"/></div></div></figure></div><div class="ab cl kf kg gp kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="hb hc hd he hf"><p id="9753" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">第二步:在VPC中创建一个lambda函数</strong></p><p id="78a2" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">选择lambda服务并在VPC中创建Lambda函数。你可以用自己选择的编程语言创建一个简单的函数，返回“你好，来自VPC·拉姆达”。创建函数时需要注意的几件事:</p><blockquote class="ko kp kq"><p id="5049" class="ix iy km iz b ja jb ij jc jd je im jf kr jh ji jj ks jl jm jn kt jp jq jr js hb bi translated">a.创建一个IAM执行角色，该角色附加了<strong class="iz hj"><em class="hi">awslambdabasiceexecutionrole</em></strong>和<strong class="iz hj"><em class="hi">AWSLambdaVPCAccessExecutionRole</em></strong>策略。创建lambda函数时选择此角色。(更改默认执行角色→使用现有角色)</p><p id="8ae8" class="ix iy km iz b ja jb ij jc jd je im jf kr jh ji jj ks jl jm jn kt jp jq jr js hb bi translated">a.在<strong class="iz hj">高级设置</strong>中，确保选择您为VPC端点创建选择的相同子网。</p></blockquote><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es ku"><img src="../Images/39c5a7bd9f4a7fe23e4014bbd5fe465b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XVjpGFcpz57aI3zDsV0EYw.jpeg"/></div></div></figure><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es kv"><img src="../Images/e6106173eb6bed96a5d97fe48240254a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0MB1WEDFV9Sbcl9VIIkNkA.jpeg"/></div></div></figure></div><div class="ab cl kf kg gp kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="hb hc hd he hf"><p id="7c4b" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">步骤3:在API网关中创建私有REST API</strong></p><p id="cdf3" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">选择API网关服务并创建新的API。选择API为<strong class="iz hj"><em class="km">Rest API Private</em></strong>。提供API名称和描述，并在<em class="km">端点类型</em>中选择“私有”。在“VPC端点ID”中输入步骤1中的VPC端点ID，然后单击添加。点击<em class="km">创建API </em>。这就创建了新的私有REST API。</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es kw"><img src="../Images/22ea3c4879cd8a177c9c66306f129696.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mC6t9yqxehTHZ6gq2HLBLQ.jpeg"/></div></div></figure><p id="68cf" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">创建API后，单击左侧导航窗格中的<strong class="iz hj">资源策略</strong>并输入下面的资源策略。<em class="km">【注意:将vpce- &lt; id &gt;替换为VPC端点Id】</em></p><pre class="ju jv jw jx fd kx ky kz la aw lb bi"><span id="20a5" class="lc ld hi ky b fi le lf l lg lh">{<br/>    "Version": "2012-10-17",<br/>    "Statement": [<br/>        {<br/>            "Effect": "Deny",<br/>            "Principal": "*",<br/>            "Action": "execute-api:Invoke",<br/>            "Resource": "execute-api:/*/*/*",<br/>            "Condition": {<br/>                "StringNotEquals": {<br/>                    "aws:sourceVpce": "<strong class="ky hj">vpce-&lt;id&gt;</strong>"<br/>                }<br/>            }<br/>        },<br/>        {<br/>            "Effect": "Allow",<br/>            "Principal": "*",<br/>            "Action": "execute-api:Invoke",<br/>            "Resource": "execute-api:/*/*/*"<br/>        }<br/>    ]<br/>}</span></pre></div><div class="ab cl kf kg gp kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="hb hc hd he hf"><p id="4a96" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">第四步:将Lambda功能与API网关集成，部署并测试</strong></p><p id="ea0d" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">选择新创建的API，并从<strong class="iz hj">动作</strong>菜单中选择“GET”方法。选择<strong class="iz hj">积分类型</strong>作为<em class="km">λ函数</em>，并选择步骤2中创建的λ函数。</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es li"><img src="../Images/2d3f0b5dfdf69e5fc4e6348e7b919cea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bMnlrebTxlOPsrQ81mqTOw.jpeg"/></div></div></figure><p id="1c58" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">从<strong class="iz hj">动作</strong>菜单中，选择<strong class="iz hj">部署API。</strong>选择<strong class="iz hj">部署状态</strong>为<em class="km">【新阶段】</em>，给<strong class="iz hj">阶段名称</strong>为<strong class="iz hj"> </strong> <em class="km"> dev。</em>一旦部署了API，点击左侧导航窗格中的<strong class="iz hj">阶段</strong>，并选择<strong class="iz hj"> <em class="km">开发阶段。</em> </strong>你会在右手边看到API URL。尝试从VPC以外的浏览器访问该URL。您将无法访问该API，因为它是私有的。出于测试的目的，在VPC中创建一个EC2实例，并尝试使用curl命令测试带有stage URL的API。这应该很好，因为它是在VPC内定义的。</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es lj"><img src="../Images/3b7b29f67d429471894a10d0e80d080d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*70-gVIW5j3jaY-CRXbHZNw.jpeg"/></div></div></figure></div><div class="ab cl kf kg gp kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="hb hc hd he hf"><p id="3bfb" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">步骤5:创建SSL证书并上传到AWS证书管理器</strong></p><p id="cc65" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这是下一个重要的步骤。因为您正在定义一个私有的https REST API，所以您必须提供SSL证书来访问该API。我不能在这里详述这个步骤，因为您的组织将有生成SSL证书的方法。如果您只是在探索，可以使用openssl命令来生成自签名证书。生成证书后，进入AWS中的<strong class="iz hj">证书管理器</strong>，点击<em class="km">“导入证书”</em>提供详细信息并导入证书。记下创建证书时给出的域名。在配置API网关自定义域名时，我们将需要此域名。</p></div><div class="ab cl kf kg gp kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="hb hc hd he hf"><p id="99c2" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">步骤6:应用程序负载平衡器和目标组</strong></p><p id="7c26" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">AWS不支持私有API的自定义域名。因此，这是一个需要通过自定义域名访问API的解决方案。</p><p id="3ac1" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在顶部搜索栏中选择EC2服务。在左侧导航窗格中，选择<strong class="iz hj"> <em class="km">负载平衡器</em> </strong>，然后在右侧视图中点击<strong class="iz hj"> <em class="km">创建负载平衡器</em> </strong>。选择<strong class="iz hj"> <em class="km">应用负载平衡器</em> </strong>并点击<strong class="iz hj"> <em class="km">创建。</em> </strong>按照以下步骤完成负载平衡器创建向导:</p><p id="03a2" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj"> <em class="km">注意:这将是一个有点长的过程，必须准确完成。请小心地做这件事。</em>T53】</strong></p><ol class=""><li id="791e" class="lk ll hi iz b ja jb jd je jg lm jk ln jo lo js lp lq lr ls bi translated"><strong class="iz hj">配置负载均衡器</strong></li></ol><p id="0586" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">a.选择方案为<em class="km">内部</em></p><p id="9b46" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">b.监听器→添加HTTPS(默认端口是443)</p><p id="37f6" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">c.VPC和子网→确保选择创建VPC端点的正确VPC，并确保选择相同的子网集。</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es lt"><img src="../Images/c2e354a6e2350b8792b97500a0924b9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nwmOrC1T76DqEtJrGHejaw.jpeg"/></div></div></figure><p id="f7e9" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj"> 2。配置安全设置</strong></p><p id="691f" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">a.证书类型→从ACM中选择一个证书</p><p id="069b" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">b.证书名称→从下拉列表中选择证书的名称</p><p id="3607" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">c.安全策略→保留默认设置(<em class="km">ELBSecurityPolicy-2016–08</em></p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es lu"><img src="../Images/b1edfd95cb4a5b953fc67725aa9989bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3uCPUNZsuCZ9BrJCiFMS7Q.jpeg"/></div></div></figure><p id="76a5" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj"> 3。配置安全组</strong></p><p id="ffae" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">分配安全组→创建新的安全组→提供名称和描述，并确保从下拉列表中选择HTTPS</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es lv"><img src="../Images/a4734bbf5fb91f0e42fc5b0f42d77184.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z8y48NMTOE9Dl_SAgpnLtA.jpeg"/></div></div></figure><p id="104e" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj"> 4。配置路由</strong></p><p id="7f04" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">a.目标组→ <em class="km">【新目标组】</em></p><p id="074a" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">b.目标类型→ IP</p><p id="77d9" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">c.礼宾→ HTTPS</p><p id="31e9" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">d.健康检查→协议→ HTTPS</p><p id="8856" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">e.高级健康检查设置→端口→ <em class="km">【流量端口】</em></p><p id="74db" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">f.高级健康检查设置→成功代码→ [200，403]</p><p id="83f7" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">将其他值保留为默认值。</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es lw"><img src="../Images/791568cca4a10776d4bda28e22a6ce5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tmuWDJ9Qq_knrhSZDQqm1Q.png"/></div></div></figure><p id="f6f3" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj"> 5。注册目标</strong></p><p id="6986" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">网络下拉菜单→其他私有IP地址→输入步骤1中记录的IPV4地址，然后点击<em class="km">添加到列表</em></p><blockquote class="ko kp kq"><p id="5ad8" class="ix iy km iz b ja jb ij jc jd je im jf kr jh ji jj ks jl jm jn kt jp jq jr js hb bi translated">负载平衡器的目标应该是VPC端点创建的Eni的IP地址。这些是在步骤1中完成的。您可以通过选择您的VPC端点并打开“子网”选项卡来找到这些Eni。</p></blockquote><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es lx"><img src="../Images/5f60b45188f580caecb3105d680a1702.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3N6qbpJyMQ8OHKHaVea3gg.jpeg"/></div></div></figure><p id="d892" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">单击Review并创建负载平衡器。创建负载平衡器后，从左侧导航窗格打开<strong class="iz hj">目标组</strong>，并打开您在创建负载平衡器时创建的目标组。单击“Targets”选项卡，确保两个IP的运行状况检查显示为正常。这可能需要一些时间，但是如果您已经正确地配置了所有的东西，它应该在创建后不久就显示healthy。</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es ly"><img src="../Images/75e654a0dccc79e2ca191956c276628e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5-e4D1mZuTzDu31BvWydXw.jpeg"/></div></div></figure></div><div class="ab cl kf kg gp kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="hb hc hd he hf"><p id="747f" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">步骤7:在53号公路上创建私人托管区域</strong></p><p id="6607" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">下一步是设置私有托管区域，并将其指向应用程序负载平衡器。选择Route 53服务。点击托管区域→创建托管区域。按照以下步骤创建托管区域:</p><p id="856a" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">a.域名→<em class="km">us-east-1 . custom domain . AWS</em></p><p id="b119" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">b.类型→私有托管区域</p><p id="d7fa" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">c.地区→美国东部-1</p><p id="6e48" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">d.VPC ID → VPC ID，在这里您配置了所有资源。</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es lz"><img src="../Images/643ecc5287c1acb95fba5be0c2bb2291.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h8bzDG36wgYp6_NWaPNWkw.jpeg"/></div></div></figure><p id="8250" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">创建托管区域后，点击<em class="km">创建记录</em>并输入以下详细信息:</p><p id="9d7a" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">a.记录名称→ test_api</p><p id="165e" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">b.记录类型→ A</p><p id="c505" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">c.别名→启用别名，以便您可以选择负载平衡器</p><p id="eaa9" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">d.路由流量→应用和传统负载平衡器的别名</p><p id="7d70" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">e.地区→美国东部-1</p><p id="9ad0" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">f.从下拉列表中选择负载平衡器。(开头是<em class="km"> dualstack.internal… </em>)</p><p id="3242" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">将<em class="km">路由策略</em>和<em class="km">评估目标健康</em>保留为默认值，并点击<em class="km">创建记录。</em></p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es ma"><img src="../Images/461853a05053930e6a514f0af15a94f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J0w2bmYO7dikorshN7r8OQ.jpeg"/></div></div></figure></div><div class="ab cl kf kg gp kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="hb hc hd he hf"><p id="ab2c" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">步骤8:配置API网关自定义域名</strong></p><p id="c048" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">选择API网关服务并点击左侧导航窗格中的<strong class="iz hj">自定义域名</strong>。在右侧视图中点击“创建”,输入如下详细信息:</p><p id="3162" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">a.域名→在此提供域名。请注意，这必须与您在步骤5中创建SSL证书时给出的域名相匹配。</p><p id="2ff3" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">b.TLS版本→ 1.2</p><p id="be96" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">c.端点类型→区域</p><p id="f892" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">d.ACM证书→选择在步骤5中创建的证书。</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es mb"><img src="../Images/4458f785041feb764862de099b9b76aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e50540AiSdy6iOR9BfVIBg.jpeg"/></div></div></figure><p id="165b" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">创建域名后，选择域名并单击API mappings选项卡。在API映射窗口中，从下拉列表中选择API和阶段，然后单击保存。将<em class="km">路径</em>字段留空。这样，如果您在API中创建资源，您可以使用相同的域名和路径后缀访问所有资源。</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es mc"><img src="../Images/ab45201d4cd74ffc309da04e091c49d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4bZmEaEmCoKKUbQstJnHUQ.jpeg"/></div></div></figure><p id="9c78" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">配置完成后，请确保再次部署API，否则您将无法使用自定义域名调用API。</p><p id="d29e" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">就是这样。现在所有的配置都已完成，您应该能够从VPC内部测试API(域名为test _ API . us-east-1 . custom domain . AWS)。</p><p id="d5c4" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这是一种迂回的做法，但它确实减少了使用晦涩的API名称的麻烦，并且也有助于灾难恢复策略。</p><p id="8765" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我花了很长时间才把它修好。希望这对别人有帮助。如果你在某个地方遇到困难，请留下你的评论，我会随时帮助你。</p></div></div>    
</body>
</html>