<html>
<head>
<title>How Machine Learning can be used for AI-powered Autoscaling</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">机器学习如何用于人工智能驱动的自动缩放</h1>
<blockquote>原文：<a href="https://medium.com/codex/how-machine-learning-can-be-used-for-ai-powered-autoscaling-9d03385ff8a?source=collection_archive---------5-----------------------#2021-08-20">https://medium.com/codex/how-machine-learning-can-be-used-for-ai-powered-autoscaling-9d03385ff8a?source=collection_archive---------5-----------------------#2021-08-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="f387" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">许多公司基于微服务架构风格构建他们的IT服务，并在Kubernetes等容器虚拟化基础设施上运行它们，以提高可伸缩性。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/3b83dc19d4f25ba01c8e652bf93eb979.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c_elRjoU0zT30HXUv2X3pw.png"/></div></div></figure><p id="d529" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然而，尽管微服务可以通过并行运行多个实例来帮助提高性能，但它们并不能自动提供自动扩展的解决方案。这同样适用于容器虚拟化的基础设施。它们允许轻松地横向和纵向扩展应用程序。但是实例的数量和每个实例分配的资源还没有决定。启动新实例或停止备用实例的时间也是如此。</p><p id="c684" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本文中，我演示了如何通过预测未来的应用程序工作负载来使用机器学习来改进自动缩放。我还解释了为什么ML本身不能解决自动缩放的问题，但仍然需要人工智能的操作(ops)团队。</p><h1 id="e5dd" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">反应式自动缩放</h1><p id="03f7" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">通常，web应用程序的伸缩策略基于不同的指标，如<br/>过去几分钟内API请求的平均(或最大)响应时间<br/>应用程序运行的节点的CPU利用率<br/>每秒传入的HTTP请求数。</p><p id="2f1f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="ks">扩展策略是定义如何以及何时扩展的策略。一个非常简单的扩展策略是，每秒每100个传入的HTTP请求应该有一个微服务实例。例如，如果每秒有500个HTTP请求，这意味着有5个微服务实例。</em></p><p id="0f5e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">经过几个月的运营经验，ops团队对应用程序工作负载或传入API请求数量的增长速度有了合理的理解。此外，它们还能识别峰值最有可能出现的时间。基于这一经验，他们定义了一个扩展策略，允许应用程序在可接受的响应时间内为所有请求提供服务。</p><p id="4177" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然而，除了提供必要数量的资源之外，允许系统呼吸也很重要。这可以通过提供备用实例或超额配置资源作为安全余量来实现。</p><p id="2bfa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">安全余量也很重要，因为启动新的应用程序实例通常需要一些时间。对于有状态的应用程序，这个时间甚至更长，因为数据必须在准备好之前复制到新的实例中。</p><p id="931b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，例如，如果现在有五个实例就足以满足所有请求，那么扩展策略可能仍然定义运行七个实例，以应对未来几分钟内请求数量或峰值的快速增长。这是一种合理的方法，不需要任何机器学习。但是过度配置资源是浪费金钱，尤其是在云环境中，您需要为自己使用的资源付费。</p><p id="5d46" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在接下来的部分中，我们将探索和讨论通过机器学习和其他人工智能方法来缓解过度供应需求的方法。</p><h1 id="b14e" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">基于强化学习的自动缩放</h1><p id="3e9d" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">为了改进自动扩展并减少过度配置的需求，我们可能希望使用强化学习来找到最佳的扩展策略。概括来说，扩展策略定义了扩展的方式和时间。乍一看，这似乎是一个伟大的想法:一个人工智能<strong class="ih hj">代理</strong>将<em class="ks">学习</em>不同工作负载情况下的最佳扩展策略。因此，它将</p><p id="0e87" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">纵向扩展(为一个节点分配更多的CPU和内存资源)<br/>横向扩展(启动一个额外的应用程序实例)<br/>纵向扩展(为一个节点分配更少的资源)<br/>或纵向扩展(停止一个应用程序实例)</p><p id="408c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">同时观察CPU利用率、API响应时间和每秒请求数等指标。在与系统的交互过程中，AI代理将“记住”每个扩展决策对预定义KPI(如计算成本和API响应时间)的影响。因此，随着时间的推移，AI代理将了解在给定某些度量值(代表应用程序工作负载)的情况下，哪些扩展决策会导致高KPI值。因此，自动学习了缩放策略。</p><p id="355d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">用强化学习的术语来说，应用程序、其运行时环境以及运行它的节点就是<strong class="ih hj">环境</strong>。观察到的指标代表环境<strong class="ih hj">状态</strong>。可能的缩放决策是代理的一组<strong class="ih hj">动作</strong>。KPI是代理试图最大化的<strong class="ih hj">奖励</strong>。代理通过制定和应用扩展决策学习的扩展策略是通过与系统交互学习的<strong class="ih hj">策略</strong>。我在下图中展示了自动缩放术语到强化学习术语的映射。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kt"><img src="../Images/a5ec316f9d3a1a5b47cd003f5e07079f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cEl-Ox40eF1GlaeJa4TBug.png"/></div></div><figcaption class="ku kv et er es kw kx bd b be z dx translated">自动缩放术语到强化学习术语的映射。</figcaption></figure><p id="3296" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个模型看起来不错，但是对这样一个人工智能代理的训练工作将是巨大的，如果不是说对大多数用例不可行的话。这是因为代理必须做出许多(即数百万个)缩放决策，以了解它们对KPI的影响。更糟糕的是，这些缩放决策在训练阶段的开始会非常糟糕，因为AI代理没有任何关于自动缩放的先验知识。在生产环境中，这种糟糕的扩展决策是不可接受的，例如当工作负载(例如，API请求的数量)增加时，停止正在运行的应用程序实例而不是启动新的实例。客户可能会遇到服务短缺并请求超时。</p><p id="3244" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在生产环境中训练AI代理的替代方法是建立一个专门的训练环境。然而，以反映真实用户行为的方式来模拟用户交互，从而反映交互随时间的真实分布，至少与解决自动缩放问题本身一样具有挑战性。想想看:如果你可以很好地模拟用户交互，以反映真实的用户行为，那么你已经解决了自动缩放的问题，因为你确切地知道用户将做什么，以及在特定的时间点你预期有多少用户。因此，在模拟的训练环境中训练AI智能体也是不可能的。因此，强化学习不适合自动缩放——至少不适合上述方式。</p><h1 id="ec11" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">利用基于ML的工作负载预测进行主动自动扩展</h1><p id="8e50" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">所以，如果强化学习不能用于自动缩放，你可能想知道机器学习怎么能用于自动缩放…缺乏代表性的训练环境不总是一个问题吗？</p><p id="fdae" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">幸运的是，机器学习<em class="ks">可以</em>用于自动缩放。它只是不能(容易地)用于学习整个自动缩放策略。反而是把ops团队的经验和机器学习算法的实力结合起来要好得多。使用这种方法，运营团队将继续定义扩展策略，但机器学习将提供新的信息:预测的未来指标值，如分别在接下来的两分钟、五分钟和十分钟内的API请求的预期数量。这样，运营团队就可以定义一个扩展策略，该策略不仅依赖于当前和过去的应用程序工作负载，还依赖于预测的未来工作负载。</p><p id="3747" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为什么这比开始描述的反应式自动伸缩方法更好？我举个例子解释一下。我在下图中说明了这一点。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kt"><img src="../Images/dfc103d5ff21d663868baed6ca280f84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mJVccu2P2pvArML0wOmJ2A.png"/></div></div><figcaption class="ku kv et er es kw kx bd b be z dx translated">主动自动扩展与被动自动扩展。</figcaption></figure><p id="bf4d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">想象一下，在过去的一个小时中，每秒钟大约有500个API请求，这个数字在十分钟内下降到每秒100个API请求(棕色虚线)。被动的自动伸缩策略可能会在API请求数量减少五分钟后放大或缩小(蓝色虚线)。然而，如果您可以利用机器学习来预测API请求的数量将在5分钟后增长到每秒800个，您可以使用此信息在每秒只有100个API请求的valley中启动一个额外的应用程序实例，而不是停止已经运行的应用程序。除此之外，有了关于预测的未来工作负载的信息，当您预计工作负载将在一段时间内保持较低水平(图中的棕色虚线)时，您可以立即缩减/扩大，而不是等到您猜测较低的工作负载不只是短暂的下降，而是值得缩减/扩大。这将减少过度调配，并使调配的资源更好地适应实际应用程序工作负载。</p><p id="7bbf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我将这种方法称为“主动自动扩展”，因为它不仅能对当前和过去的应用程序工作负载做出反应，还能预测未来的工作负载，从而做出主动扩展决策。</p><h1 id="866d" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">预测未来的应用程序工作负载</h1><p id="e46f" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">现在的挑战是预测未来的应用程序工作负载。由于应用程序工作负载通常由指标表示，因此预测指标值作为未来应用程序工作负载的指标似乎是很自然的。您选择预测哪些指标主要取决于您的应用程序类型和托管环境。对于一个web API应用程序，每秒的API请求数和这些请求的响应时间可能会有所帮助。对于像数据库或身份和访问管理(IAM)应用程序这样的数据驱动型系统，最相关的指标可能取决于您的读访问次数多还是写访问次数多，因为这会影响用数据填充新应用程序实例所需的时间。如果您的应用程序进行繁重的计算，您可能希望预测它的CPU使用率。</p><p id="16ea" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如您所见，有些指标比其他指标更有助于您的自动伸缩策略。通常，您的运营团队可以判断哪些指标值对他们定义扩展策略最有价值。您应该使用机器学习来预测这些指标的值，因为像神经网络这样的机器学习模型可以在这些指标的时间序列数据中找到隐藏的相关性和长期相关性。</p><p id="417b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我的下一篇关于基于人工智能的自动缩放的文章中，我将描述如何使用神经网络实现指标预测，什么样的神经网络架构最适合，以及在训练机器学习模型并将其部署到生产中时会出现什么样的实际挑战。</p><p id="523a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我希望我可以提供一些关于机器学习如何支持自动缩放的见解。如果你有任何问题，请不要犹豫与我联系。</p></div></div>    
</body>
</html>