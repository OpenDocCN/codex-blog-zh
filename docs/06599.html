<html>
<head>
<title>How to implement message delivery receipts notifications in your Android chat app</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在您的Android聊天应用程序中实现消息送达回执通知</h1>
<blockquote>原文：<a href="https://medium.com/codex/how-to-implement-message-delivery-receipts-notifications-in-your-android-chat-app-fc95822f2089?source=collection_archive---------11-----------------------#2022-05-03">https://medium.com/codex/how-to-implement-message-delivery-receipts-notifications-in-your-android-chat-app-fc95822f2089?source=collection_archive---------11-----------------------#2022-05-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/6e81e6062807a0545cae9e79408c173d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ae2aXeSITFOLHaB0.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">仙鸟2022</figcaption></figure><div class=""/><div class=""><h2 id="e32d" class="pw-subtitle-paragraph iu hw hx bd b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl dx translated">关于使用Sendbird Chat SDK实现消息传递生命周期的分步教程</h2></div><p id="a054" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">解决方案工程师| <a class="ae ki" href="https://www.sendbird.com" rel="noopener ugc nofollow" target="_blank"> Sendbird </a></p><p id="678e" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated"><em class="kj">如果您需要额外的指导，请参见我们的</em> <a class="ae ki" href="https://sendbird.com/docs/chat/v3/platform-api/message/delivery-receipts/delivery-receipts-overview" rel="noopener ugc nofollow" target="_blank"> <em class="kj">文档</em> </a> <em class="kj">。别忘了查看应用内聊天的</em> <a class="ae ki" href="https://sendbird.com/demos/in-app-chat" rel="noopener ugc nofollow" target="_blank"> <em class="kj">演示</em> </a> <em class="kj">，并访问我们的</em> <a class="ae ki" href="https://sendbird.com/features/chat-messaging" rel="noopener ugc nofollow" target="_blank"> <em class="kj">网站</em> </a> <em class="kj">了解更多关于仙鸟聊天可以提供的服务。</em></p><blockquote class="kk kl km"><p id="6ebf" class="jm jn kj jo b jp jq iy jr js jt jb ju kn jw jx jy ko ka kb kc kp ke kf kg kh hb bi translated"><em class="hx">成为第一个了解新教程、开发者相关聊天/电话发布以及其他重要更新的人，</em> <a class="ae ki" href="https://get.sendbird.com/dev-newsletter-subscription.html" rel="noopener ugc nofollow" target="_blank"> <em class="hx">注册</em> </a> <em class="hx">我们的开发者简讯。</em></p></blockquote><h1 id="4446" class="kq kr hx bd ks kt ku kv kw kx ky kz la jd lb je lc jg ld jh le jj lf jk lg lh bi translated">介绍</h1><p id="a9c9" class="pw-post-body-paragraph jm jn hx jo b jp li iy jr js lj jb ju jv lk jx jy jz ll kb kc kd lm kf kg kh hb bi translated">Sendbird Chat是一个丰富的高级API，与其他解决方案不同，它支持<strong class="jo hy">交货收据</strong>。</p><p id="27a5" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">有了<strong class="jo hy">送达回执，</strong>用户就可以完全确信他们的消息已经送达了预定的收件人。作为开发人员，您现在可以更加灵活地选择消息交付后要做的事情。无论是简单到显示一个图标来显示消息已经发送，还是复杂到在消息发送后处理应用程序中的其他事件。<strong class="jo hy">交付收据</strong>的可用性是一个特性，使您作为开发人员能够继续为您的用户提供世界一流的聊天体验，而您只需付出很少的努力。</p><p id="b414" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">在本教程中，我们将讨论Sendbird中存在的消息生命周期，并为您提供一些如何在聊天中实现它的背景知识。</p><h1 id="cf78" class="kq kr hx bd ks kt ku kv kw kx ky kz la jd lb je lc jg ld jh le jj lf jk lg lh bi translated">什么是消息传递生命周期？</h1><p id="459a" class="pw-post-body-paragraph jm jn hx jo b jp li iy jr js lj jb ju jv lk jx jy jz ll kb kc kd lm kf kg kh hb bi translated">简单地说，信息生命周期是一条信息的旅程，从思想被输入文字，到接收者自己阅读信息。如果没有<strong class="jo hy">送达回执</strong>，从发送者的角度来看，消息传递的生命周期将如下所示:</p><ol class=""><li id="1781" class="ln lo hx jo b jp jq js jt jv lp jz lq kd lr kh ls lt lu lv bi translated">发送者键入信息并发送它</li><li id="a255" class="ln lo hx jo b jp lw js lx jv ly jz lz kd ma kh ls lt lu lv bi translated">消息被发送到服务器(使用内置的离线消息处理连接不良或无连接的情况)</li><li id="ccf9" class="ln lo hx jo b jp lw js lx jv ly jz lz kd ma kh ls lt lu lv bi translated">邮件由收件人阅读</li></ol><p id="5bf0" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">虽然这确实涵盖了大多数基础，但在第2步和第3步之间可能存在很多不确定性。直到接收者实际检查了该聊天并将消息标记为已读，发送者才知道消息是否被接收者成功接收。发送者可能会想，他们看不到回复的原因是因为连接不良，还是仅仅是因为接收者还没有检查他们的聊天记录。当生命周期看起来像这样时，所有这些担心都消失了:</p><ol class=""><li id="81b2" class="ln lo hx jo b jp jq js jt jv lp jz lq kd lr kh ls lt lu lv bi translated">发送者键入信息并发送它</li><li id="7160" class="ln lo hx jo b jp lw js lx jv ly jz lz kd ma kh ls lt lu lv bi translated">消息被发送到服务器(使用内置的离线消息处理连接不良或无连接的情况)</li><li id="7ec0" class="ln lo hx jo b jp lw js lx jv ly jz lz kd ma kh ls lt lu lv bi translated">该消息被传送到接收者的设备</li><li id="beec" class="ln lo hx jo b jp lw js lx jv ly jz lz kd ma kh ls lt lu lv bi translated">邮件由收件人阅读</li></ol><p id="4a20" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">随着之前的2和3之间的关键步骤的引入，生命周期现在给出了一个完整的画面。以前，在阅读回执更新之前，发件人不知道收件人是否收到了邮件，而现在，发件人可以在瞬间自信地看到邮件已经送达，并继续他们的一天。</p><figure class="mc md me mf fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mb"><img src="../Images/fe1664b9defcfe4c284b886b99489672.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*flxq8a6LzvZRe496.gif"/></div></div></figure><p id="3ff5" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">很好，现在我们已经讨论了为什么<strong class="jo hy">送达回执</strong>对完成消息生命周期如此重要，让我们继续从技术角度看一下Sendbird提供的一些功能，以及如何轻松地将它们实现到您的应用程序中。</p><h1 id="90b2" class="kq kr hx bd ks kt ku kv kw kx ky kz la jd lb je lc jg ld jh le jj lf jk lg lh bi translated">第一步。发件人键入信息</h1><p id="2d46" class="pw-post-body-paragraph jm jn hx jo b jp li iy jr js lj jb ju jv lk jx jy jz ll kb kc kd lm kf kg kh hb bi translated">消息生命周期的第一部分相当简单。在这一阶段，我们应该强调几个功能，这些功能将占用消息的生命周期，并使其更清楚地适应您的应用程序。在发送方，我们有发送消息的功能。下面你可以看到发送不同类型的信息是多么容易。</p><figure class="mc md me mf fd hk"><div class="bz dy l di"><div class="mg mh l"/></div></figure><figure class="mc md me mf fd hk"><div class="bz dy l di"><div class="mg mh l"/></div></figure><p id="87b0" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">Sendbird允许发送3种类型的消息:用户消息，或文本消息，文件消息，或二进制文件消息，以及管理员消息，或由管理员发送的文本消息。有了这三种类型的消息，你可以发送任何东西，从简单的文本消息到有趣的视频和图片到<a class="ae ki" href="https://sendbird.com/map-preview-and-location-sharing-on-android/" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy">位置消息</strong> </a>。有了Sendbird的自动缩略图生成等功能，发送这些消息就变得简单多了。</p><figure class="mc md me mf fd hk"><div class="bz dy l di"><div class="mg mh l"/></div></figure><p id="5c85" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">在接收者方面，良好的聊天体验让用户能够看到发送者何时输入消息。Sendbird为您提供了事件处理程序，让您知道用户何时输入。键入指示器是在聊天中提供更多自然对话的绝佳方式。</p><h1 id="f39f" class="kq kr hx bd ks kt ku kv kw kx ky kz la jd lb je lc jg ld jh le jj lf jk lg lh bi translated">第二步。消息已发送</h1><p id="1b96" class="pw-post-body-paragraph jm jn hx jo b jp li iy jr js lj jb ju jv lk jx jy jz ll kb kc kd lm kf kg kh hb bi translated">好了，现在你的发送者决定按发送，信息就可以发送了…对吗？不幸的是，并非总是如此。有很多原因可以解释为什么这个信息不能被发送出去，其中一个主要的原因是没有联系，我相信我们都有同感。谢天谢地，Sendbird也有这方面的功能。马上，我们在send函数上有一个回调函数，如果消息无法传送到服务器，它会通知您。</p><figure class="mc md me mf fd hk"><div class="bz dy l di"><div class="mg mh l"/></div></figure><p id="9a4b" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">Sendbird更进一步，为你提供了离线体验的能力。按照惯例，为了创建离线聊天体验，您必须在设备上创建一个本地数据库，用于下载消息/频道，并使它们与服务器保持同步。对于编辑消息或删除消息之类的事情，您必须确保编写的代码既能处理服务器上的数据，又能确保本地更改得到传播。维护这一点可能是乏味的、耗时的，并且使您的应用程序容易出现许多故障点。通过<a class="ae ki" href="https://sendbird.com/docs/syncmanager" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy">同步管理器</strong> </a>，Sendbird自动处理上述所有问题。显示消息和以前一样容易，但是传统上维护离线体验的困难部分由Sendbird本机处理，因此在建立到服务器的连接时，您只需调用resumeSync()来维护服务器和本地缓存之间的同步。</p><figure class="mc md me mf fd hk"><div class="bz dy l di"><div class="mg mh l"/></div></figure><p id="da8e" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">在设置SyncManager时，甚至能够在用户连接不良或没有连接的情况下指定重试策略，因此作为开发人员，您不必担心以编程方式处理重试。这将让你和你的用户都有信心点击发送，并相信连接或没有连接，当连接稳定时，消息将通过。</p><figure class="mc md me mf fd hk"><div class="bz dy l di"><div class="mg mh l"/></div></figure><h1 id="78f5" class="kq kr hx bd ks kt ku kv kw kx ky kz la jd lb je lc jg ld jh le jj lf jk lg lh bi translated">第三步。消息已发送</h1><p id="1854" class="pw-post-body-paragraph jm jn hx jo b jp li iy jr js lj jb ju jv lk jx jy jz ll kb kc kd lm kf kg kh hb bi translated">我们已经讨论了Sendbird如何确保发送者的基地被覆盖，但是接收者呢？到目前为止，我们已经知道消息通过了Sendbird服务器，但是我如何知道它是否被发送到了接收者的设备上呢？多亏了新的<strong class="jo hy">送达回执</strong>功能，你的用户现在可以立即知道收件人是否真的收到了信息。这是通过简单地在接收者方将消息标记为已传递来完成的。</p><figure class="mc md me mf fd hk"><div class="bz dy l di"><div class="mg mh l"/></div></figure><p id="ce9e" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">当这个动作完成时，一个事件处理程序将在发送者端触发，让他们知道消息已经到达预定接收者的设备。</p><figure class="mc md me mf fd hk"><div class="bz dy l di"><div class="mg mh l"/></div></figure><p id="7c36" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">在这里，您有很多种选择，您可以简单地显示复选标记，指示消息已成功传递，或者根据您的用例，您可以实现一些客户端响应来成功传递。</p><h1 id="f86a" class="kq kr hx bd ks kt ku kv kw kx ky kz la jd lb je lc jg ld jh le jj lf jk lg lh bi translated">第四步。邮件已阅读</h1><p id="7af6" class="pw-post-body-paragraph jm jn hx jo b jp li iy jr js lj jb ju jv lk jx jy jz ll kb kc kd lm kf kg kh hb bi translated">所以信息被打印，发送，投递现在呢？邮件生命周期的最后阶段是收件人阅读邮件。Sendbird有已读回执已经有一段时间了，这个功能允许邮件的发送者很容易地看到他们的邮件是什么时候被接收者阅读的。在接收器端，您需要做的就是将通道标记为已读。</p><figure class="mc md me mf fd hk"><div class="bz dy l di"><div class="mg mh l"/></div></figure><p id="18f5" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">完成后，发件人端的事件处理程序将会触发，并向您更新消息被读取的时间戳。</p><figure class="mc md me mf fd hk"><div class="bz dy l di"><div class="mg mh l"/></div></figure><p id="0a88" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">从这里开始，收件人现在可以成为发件人，这个生命周期可以重新开始。</p><h1 id="e67b" class="kq kr hx bd ks kt ku kv kw kx ky kz la jd lb je lc jg ld jh le jj lf jk lg lh bi translated">结论</h1><p id="f654" class="pw-post-body-paragraph jm jn hx jo b jp li iy jr js lj jb ju jv lk jx jy jz ll kb kc kd lm kf kg kh hb bi translated">就是这样！恭喜您，您现在知道了您需要做的一切，并快速将消息生命周期通知构建到您当前的工作流中！有了<strong class="jo hy">交付收据</strong>，Sendbird又增加了一项功能，让您可以更轻松地为客户提供现代化的、引人入胜的聊天体验。</p></div></div>    
</body>
</html>