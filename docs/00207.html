<html>
<head>
<title>Deep Learning Setup: ECS GPU Task On Ubuntu (Part 3)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">深度学习设置:Ubuntu上的ECS GPU任务(第3部分)</h1>
<blockquote>原文：<a href="https://medium.com/codex/deep-learning-setup-ecs-gpu-task-on-ubuntu-part-3-a6ffbc6a3c5a?source=collection_archive---------7-----------------------#2021-01-05">https://medium.com/codex/deep-learning-setup-ecs-gpu-task-on-ubuntu-part-3-a6ffbc6a3c5a?source=collection_archive---------7-----------------------#2021-01-05</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/38c178c22ef96afe64d9cdb4b0411579.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*WTc4WwdaJevFAWLu"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">丹尼尔·科尔派在<a class="ae hv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><div class=""/><p id="dc95" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为了在ECS中运行基于GPU的任务，我们需要创建自己的EC2实例，因为Fargate】仍然不支持GPU。有了<a class="ae hv" href="https://docs.aws.amazon.com/AmazonECS/latest/developerguide/ecs-gpu.html" rel="noopener ugc nofollow" target="_blank"> ECS GPU优化的ami</a>，这应该不会太难。</p><p id="2492" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然而，有时这是不可能的，因为团队已经在使用他们最喜欢的AMI设置，比如Ubuntu <a class="ae hv" href="https://aws.amazon.com/marketplace/seller-profile?id=dfa1e6a8-0b7b-4d35-a59c-ce272caee4fc" rel="noopener ugc nofollow" target="_blank"> CIS优化AMI </a>或任何其他风格。这意味着他们需要从头开始安装和配置设置。</p><p id="b062" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这4篇文章中，我们将回顾在Ubuntu 18.04操作系统上使用GPU所需资源安装和配置ECS任务的过程。</p><p id="0f16" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae hv" href="https://michael-41345.medium.com/deep-learning-setup-ecs-gpu-task-on-ubuntu-part-1-87933804c050" rel="noopener">第1部分:NVIDIA驱动程序</a></p><p id="020d" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae hv" href="https://michael-41345.medium.com/deep-learning-setup-ecs-gpu-task-on-ubuntu-part-2-1c7abd6d14ad" rel="noopener">第2部分:ECS代理</a></p><p id="4532" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hz">第三部分:NVIDIA-Docker运行时间</strong></p><p id="33dd" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae hv" rel="noopener" href="/codex/deep-learning-setup-ecs-gpu-task-on-ubuntu-part-4-46c364d1b556">第4部分:ECS代理上的GPU配置</a></p></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><h2 id="26c0" class="ka kb hy bd kc kd ke kf kg kh ki kj kk jg kl km kn jk ko kp kq jo kr ks kt ku bi translated">Docker NVIDIA运行时</h2><figure class="kw kx ky kz fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es kv"><img src="../Images/33724d35ae21318a2a234e79dc3326c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*kDvATaQ93ayqpFX2.png"/></div></div></figure><p id="c396" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">尽管安装和配置Docker NVIDIA runtime已经有很好的文档<a class="ae hv" href="https://github.com/nvidia/nvidia-container-runtime" rel="noopener ugc nofollow" target="_blank">记录</a>，但我还是遇到了一些问题，所以我发现自己记录所需的步骤很有价值。然而，我建议仔细阅读更详细的正式文档，而且步骤可能会根据个人需求/偏好而改变。</p><p id="2fdb" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">存储库配置</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="2003" class="ka kb hy lb b fi lf lg l lh li">$ curl -s -L https://nvidia.github.io/nvidia-container-runtime/gpgkey | \<br/>  sudo apt-key add -<br/>distribution<strong class="lb hz">=</strong>$(. /etc/os-release;echo $ID$VERSION_ID)<br/>$ curl -s -L https://nvidia.github.io/nvidia-container-runtime/$distribution/nvidia-container-runtime.list | \<br/>  sudo tee /etc/apt/sources.list.d/nvidia-container-runtime.list<br/>$ sudo apt-get update</span></pre><p id="d633" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">运行时安装</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="6e53" class="ka kb hy lb b fi lf lg l lh li">sudo apt-get install nvidia-container-runtime</span></pre><p id="4e41" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">创建Systemd插件文件</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="21a2" class="ka kb hy lb b fi lf lg l lh li">sudo mkdir -p /etc/systemd/system/docker.service.d<br/>sudo tee /etc/systemd/system/docker.service.d/override.conf &lt;&lt;EOF<br/>[Service]<br/>ExecStart=<br/>ExecStart=/usr/bin/dockerd --host=fd:// --add-runtime=nvidia=/usr/bin/nvidia-container-runtime<br/>EOF<br/>sudo systemctl daemon-reload<br/>sudo systemctl restart docker</span></pre><p id="48ba" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">创建守护程序配置文件</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="0ff7" class="ka kb hy lb b fi lf lg l lh li">sudo tee /etc/docker/daemon.json &lt;&lt;EOF<br/>{<br/>    "runtimes": {<br/>        "nvidia": {<br/>            "path": "/usr/bin/nvidia-container-runtime",<br/>            "runtimeArgs": []<br/>        }<br/>    }<br/>}<br/>EOF<br/>sudo pkill -SIGHUP dockerd</span></pre><p id="7895" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">测试运行时安装</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="8499" class="ka kb hy lb b fi lf lg l lh li">sudo docker run --gpus all --rm nvidia/cuda:10.1-base nvidia-smi</span></pre><p id="afaa" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">预期产出</p><figure class="kw kx ky kz fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lj"><img src="../Images/db0febefe808ab9f950568072ab8e67b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8siLEf6Qc1aOM_BeIdUKOg.png"/></div></div></figure></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><p id="f3f9" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在下一篇文章中，我们将使用GPU驱动程序配置ECS代理。</p></div></div>    
</body>
</html>