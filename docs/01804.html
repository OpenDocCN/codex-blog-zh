<html>
<head>
<title>The Battle of the Neighborhoods…</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">邻里之战…</h1>
<blockquote>原文：<a href="https://medium.com/codex/the-battle-of-the-neighborhoods-8de8f556e01e?source=collection_archive---------2-----------------------#2021-06-02">https://medium.com/codex/the-battle-of-the-neighborhoods-8de8f556e01e?source=collection_archive---------2-----------------------#2021-06-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="9e8c" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">应用数据科学</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es ix"><img src="../Images/63ab77b41941e53f702ef5f0fd9dfa93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*G9avEYzDOSP5h7Lxsk6dyQ.jpeg"/></div><figcaption class="jf jg et er es jh ji bd b be z dx translated"><a class="ae jj" href="https://www.greenpacks.org/wp-content/uploads/2010/12/Rome.jpg" rel="noopener ugc nofollow" target="_blank">https://www . green packs . org/WP-content/uploads/2010/12/Rome . jpg</a></figcaption></figure><h1 id="6c4b" class="jk jl hi bd jm jn jo jp jq jr js jt ju io jv ip jw ir jx is jy iu jz iv ka kb bi translated">目录</h1><ul class=""><li id="1f23" class="kc kd hi ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated"><a class="ae jj" href="http://fabappslab.com" rel="noopener ugc nofollow" target="_blank">简介:商业问题</a></li><li id="27de" class="kc kd hi ke b kf ku kh kv kj kw kl kx kn ky kp kq kr ks kt bi translated"><a class="ae jj" href="http://fabappslab.com" rel="noopener ugc nofollow" target="_blank">数据</a></li><li id="c7f2" class="kc kd hi ke b kf ku kh kv kj kw kl kx kn ky kp kq kr ks kt bi translated"><a class="ae jj" href="http://fabappslab.com" rel="noopener ugc nofollow" target="_blank">方法论</a></li><li id="d6ad" class="kc kd hi ke b kf ku kh kv kj kw kl kx kn ky kp kq kr ks kt bi translated"><a class="ae jj" href="http://fabappslab.com" rel="noopener ugc nofollow" target="_blank">分析</a></li><li id="1123" class="kc kd hi ke b kf ku kh kv kj kw kl kx kn ky kp kq kr ks kt bi translated"><a class="ae jj" href="http://fabappslab.com" rel="noopener ugc nofollow" target="_blank">结果和讨论</a></li><li id="fdcc" class="kc kd hi ke b kf ku kh kv kj kw kl kx kn ky kp kq kr ks kt bi translated"><a class="ae jj" href="http://fabappslab.com" rel="noopener ugc nofollow" target="_blank">结论</a></li></ul><h1 id="03a0" class="jk jl hi bd jm jn jo jp jq jr js jt ju io jv ip jw ir jx is jy iu jz iv ka kb bi translated">简介:业务问题</h1><p id="1400" class="pw-post-body-paragraph kz la hi ke b kf kg ij lb kh ki im lc kj ld le lf kl lg lh li kn lj lk ll kp hb bi translated">罗马以美味的食物而闻名，如意大利面、千层面、披萨和冰淇淋。这个意大利的首都以历史古迹而闻名，如罗马圆形大剧场、许愿池和梵蒂冈城。罗马是古罗马人创造我们沿用至今的系统和结构的地方。因此，由于这些原因和许多其他原因，这个城市吸引了许多不同背景的人..</p><p id="e2c3" class="pw-post-body-paragraph kz la hi ke b kf lm ij lb kh ln im lc kj lo le lf kl lp lh li kn lq lk ll kp hb bi translated">在这个项目中，我们将努力寻找一个餐厅的最佳位置，专门面向有意在意大利<strong class="ke hj">罗马</strong>开设<strong class="ke hj">法国餐厅</strong>的利益相关者。</p><p id="f02f" class="pw-post-body-paragraph kz la hi ke b kf lm ij lb kh ln im lc kj lo le lf kl lp lh li kn lq lk ll kp hb bi translated">因为义大利有很多餐厅，我们会试着找出还没有挤满餐厅的地点。我们还将关注附近没有法国餐馆的地点，这些地点也尽可能靠近市中心。</p><p id="0f25" class="pw-post-body-paragraph kz la hi ke b kf lm ij lb kh ln im lc kj lo le lf kl lp lh li kn lq lk ll kp hb bi translated">然后，我们将展示我们的数据科学知识，寻找新兴社区，分析它们，并表达我们的最佳可能最终位置，利益相关方可以从中选择…</p><h1 id="f21f" class="jk jl hi bd jm jn jo jp jq jr js jt ju io jv ip jw ir jx is jy iu jz iv ka kb bi translated">数据</h1><p id="8783" class="pw-post-body-paragraph kz la hi ke b kf kg ij lb kh ki im lc kj ld le lf kl lg lh li kn lj lk ll kp hb bi translated">在为利益相关方寻找最佳位置的过程中，我们需要收集一些数据，帮助我们设定和定义一些因素，这些因素包括:</p><ul class=""><li id="9b74" class="kc kd hi ke b kf lm kh ln kj lr kl ls kn lt kp kq kr ks kt bi translated">附近现有餐馆的数量(任何类型的餐馆)</li><li id="5040" class="kc kd hi ke b kf ku kh kv kj kw kl kx kn ky kp kq kr ks kt bi translated">附近<strong class="ke hj"> <em class="lu">法国餐厅</em> </strong>的数量和距离，如果有的话</li><li id="41ff" class="kc kd hi ke b kf ku kh kv kj kw kl kx kn ky kp kq kr ks kt bi translated">社区离市中心的距离</li></ul><p id="0a4e" class="pw-post-body-paragraph kz la hi ke b kf lm ij lb kh ln im lc kj lo le lf kl lp lh li kn lq lk ll kp hb bi translated">我们还将使用网格间距对话框指定网格线的精确位置，并使用<strong class="ke hj">规则间距网格</strong>指定以市中心为中心的位置，然后定义我们的社区。</p><p id="0339" class="pw-post-body-paragraph kz la hi ke b kf lm ij lb kh ln im lc kj lo le lf kl lp lh li kn lq lk ll kp hb bi translated">提取/生成所需信息还需要以下数据源:</p><ul class=""><li id="8953" class="kc kd hi ke b kf lm kh ln kj lr kl ls kn lt kp kq kr ks kt bi translated">候选区域的中心将通过算法生成，这些区域中心的大致地址将使用<strong class="ke hj"> GeoPy反向地理编码</strong>获得</li><li id="8e48" class="kc kd hi ke b kf ku kh kv kj kw kl kx kn ky kp kq kr ks kt bi translated">使用<strong class="ke hj"> Foursquare API </strong>将获得每个街区的餐馆数量及其类型和位置</li><li id="08b9" class="kc kd hi ke b kf ku kh kv kj kw kl kx kn ky kp kq kr ks kt bi translated">使用众所周知的<strong class="ke hj"> <em class="lu">罗马</em> </strong>位置的<strong class="ke hj">地理位置地理编码</strong>获得<strong class="ke hj"> <em class="lu">罗马</em> </strong>中心的坐标</li></ul><p id="a02e" class="pw-post-body-paragraph kz la hi ke b kf lm ij lb kh ln im lc kj lo le lf kl lp lh li kn lq lk ll kp hb bi translated">让我们首先导入所需的库</p><pre class="iy iz ja jb fd lv lw lx ly aw lz bi"><span id="010b" class="ma jl hi lw b fi mb mc l md me"><strong class="lw hj">import</strong> requests <em class="lu"># library to handle requests<br/></em><strong class="lw hj">import</strong> pandas <strong class="lw hj">as</strong> pd <em class="lu"># library for data analsysis<br/></em><strong class="lw hj">import</strong> numpy <strong class="lw hj">as</strong> np <em class="lu"># library to handle data in a vectorized manner<br/></em><strong class="lw hj">import</strong> random <em class="lu"># library for random number generation</em></span><span id="57d7" class="ma jl hi lw b fi mf mc l md me"><em class="lu">#!conda install -c conda-forge geopy --yes</em></span><span id="eab6" class="ma jl hi lw b fi mf mc l md me"><strong class="lw hj">from</strong> geopy.geocoders <strong class="lw hj">import</strong> Nominatim <em class="lu"># module to convert an address into latitude and longitude values<br/></em><strong class="lw hj">from</strong> IPython.display <strong class="lw hj">import</strong> Image<br/><strong class="lw hj">from</strong> IPython.core.display <strong class="lw hj">import</strong> HTML<br/><strong class="lw hj">from</strong> IPython.display <strong class="lw hj">import</strong> display_html<br/><strong class="lw hj">import</strong> pandas <strong class="lw hj">as</strong> pd<br/><strong class="lw hj">import</strong> numpy <strong class="lw hj">as</strong> np<br/><strong class="lw hj">from</strong> pandas.io.json <strong class="lw hj">import</strong> json_normalize<br/><strong class="lw hj">from</strong> bs4 <strong class="lw hj">import</strong> BeautifulSoup</span><span id="5334" class="ma jl hi lw b fi mf mc l md me"><em class="lu">#!conda install -c conda-forge folium=0.5.0 --yes<br/></em><strong class="lw hj">import</strong> folium <em class="lu"># plotting library<br/></em><strong class="lw hj">from</strong> sklearn.cluster <strong class="lw hj">import</strong> KMeans<br/><strong class="lw hj">import</strong> matplotlib.cm <strong class="lw hj">as</strong> cm<br/><strong class="lw hj">import</strong> matplotlib.colors <strong class="lw hj">as</strong> colors<br/><strong class="lw hj">import</strong> shapely.geometry<br/><strong class="lw hj">import</strong> pyproj<br/><strong class="lw hj">from</strong> pyproj <strong class="lw hj">import</strong> Transformer,transform<br/><strong class="lw hj">import</strong> math</span></pre><p id="e5ae" class="pw-post-body-paragraph kz la hi ke b kf lm ij lb kh ln im lc kj lo le lf kl lp lh li kn lq lk ll kp hb bi translated">获取我们城市目标“罗马”的纬度和经度…</p><pre class="iy iz ja jb fd lv lw lx ly aw lz bi"><span id="8879" class="ma jl hi lw b fi mb mc l md me">address <strong class="lw hj">=</strong> 'Rome, Italy'<br/>geolocator <strong class="lw hj">=</strong> Nominatim(user_agent<strong class="lw hj">=</strong>"foursquare_agent")</span><span id="7857" class="ma jl hi lw b fi mf mc l md me">location <strong class="lw hj">=</strong> geolocator.geocode(address, language<strong class="lw hj">=</strong>'en')<br/>lat <strong class="lw hj">=</strong> location.latitude<br/>lon <strong class="lw hj">=</strong> location.longitude<br/>rome_center <strong class="lw hj">=</strong> [lat,lon]</span></pre><p id="c556" class="pw-post-body-paragraph kz la hi ke b kf lm ij lb kh ln im lc kj lo le lf kl lp lh li kn lq lk ll kp hb bi translated">笛卡尔坐标系是笛卡尔最重要的遗产之一，它允许我们用代数来回答几何问题，并使代数关系可视化，否则这些关系将非常抽象。笛卡尔2D坐标系允许我们用米而不是纬度/经度来计算距离。因此，对于我们的项目，我们需要创建一个函数，在WGS84球面坐标系(纬度/经度)和UTM笛卡尔坐标系(X/Y坐标，单位为米)之间进行转换，然后将这些坐标(纬度/经度)投影到要显示的follow地图上..</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mg"><img src="../Images/8f346a52d299ac45989207fd0773fbc8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1144/format:webp/1*Ujts9viKLP5aLveBcrZ-dw.jpeg"/></div><figcaption class="jf jg et er es jh ji bd b be z dx translated"><a class="ae jj" href="https://ars.els-cdn.com/content/image/3-s2.0-B9781455731411500071-f07-04-9781455731411.jpg" rel="noopener ugc nofollow" target="_blank">https://ars . els-cdn . com/content/image/3-s 2.0-b 9781455731411500071-f07-04-97814</a></figcaption></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mh"><img src="../Images/c2e24c8e708ef92fde6e63701dba9036.png" data-original-src="https://miro.medium.com/v2/resize:fit:1328/1*pYVfbCsOsQbJSvpFbH_Cgg.gif"/></div><figcaption class="jf jg et er es jh ji bd b be z dx translated"><a class="ae jj" href="https://alienspacesciencenews.files.wordpress.com/2013/10/3d-geographic-transformations-datum-a-to-b-2d-cartesian-transformations-may-be-used-to-transform-coordinates-from-one-map-coordinate-system-to-another.gif" rel="noopener ugc nofollow" target="_blank">https://alienspacesciencenews . files . WordPress . com/2013/10/3d-geographic-transfor</a></figcaption></figure><p id="dc82" class="pw-post-body-paragraph kz la hi ke b kf lm ij lb kh ln im lc kj lo le lf kl lp lh li kn lq lk ll kp hb bi translated">现在，让我们使用笛卡尔2D坐标来创建一个以市中心为中心，距离我们的坐标约6公里的等距区域/邻域网格。我们的邻居将被定义为半径为300米的圆形区域，因此我们的邻居中心将相距600米。</p><pre class="iy iz ja jb fd lv lw lx ly aw lz bi"><span id="31d6" class="ma jl hi lw b fi mb mc l md me"><strong class="lw hj">def</strong> lonlat_to_xy(lon, lat):<br/>     <em class="lu">transformer = Transformer.from_crs("epsg:4326", "epsg:3857")</em><br/>     <em class="lu">xy = transformer.transform(lon,lat)</em><br/>    <strong class="lw hj">return</strong> xy[0], xy[1]<br/><br/><strong class="lw hj">def</strong> xy_to_lonlat(x, y):<br/>    <em class="lu">transformer = Transformer.from_crs("epsg:3857","epsg:4326")</em><br/>   <em class="lu">lonlat = transformer.transform(x,y)</em><br/>    <strong class="lw hj">return</strong> lonlat[0], lonlat[1]<br/><br/><strong class="lw hj">def</strong> calc_xy_distance(x1, y1, x2, y2):<br/>    dx = x2 - x1<br/>    dy = y2 - y1<br/>    <strong class="lw hj">return</strong> math.sqrt(dx*dx + dy*dy)<br/><br/>print('Coordinate transformation check')<br/>print('-------------------------------')<br/>print('Rome center longitude=<strong class="lw hj">{}</strong>, latitude=<strong class="lw hj">{}</strong>'.format(rome_center[1], rome_center[0]))<br/>x, y = lonlat_to_xy(rome_center[1], rome_center[0])<br/>print('Rome center UTM X=<strong class="lw hj">{}</strong>, Y=<strong class="lw hj">{}</strong>'.format(x, y))<br/>lo, la = xy_to_lonlat(x, y)<br/>print('Rome center longitude=<strong class="lw hj">{}</strong>, latitude=<strong class="lw hj">{}</strong>'.format(lo, la))</span></pre><p id="6c16" class="pw-post-body-paragraph kz la hi ke b kf lm ij lb kh ln im lc kj lo le lf kl lp lh li kn lq lk ll kp hb bi translated"><em class="lu">坐标转换检查<br/> - <br/>罗马中心经度=12.4829321，纬度=41.8933203 <br/>罗马中心UTM X=291187.2193899718，Y=4640995.599190208 <br/>罗马中心经度= 12.48293210000001，纬度= 41.89332001</em></p><p id="8bb6" class="pw-post-body-paragraph kz la hi ke b kf lm ij lb kh ln im lc kj lo le lf kl lp lh li kn lq lk ll kp hb bi translated">在下面的代码中创建一个六边形的单元格网格，其中单元格中心与所有相邻单元格的距离相等<strong class="ke hj"> … </strong></p><pre class="iy iz ja jb fd lv lw lx ly aw lz bi"><span id="f10d" class="ma jl hi lw b fi mb mc l md me">rome_center_x, rome_center_y = lonlat_to_xy(rome_center[1], rome_center[0]) <em class="lu"># City center in Cartesian coordinates</em></span><span id="a8fb" class="ma jl hi lw b fi mf mc l md me">k = math.sqrt(3) / 2 <em class="lu"># Vertical offset for hexagonal grid cells</em><br/>x_min = rome_center_x - 6000<br/>x_step = 600<br/>y_min = rome_center_y - 6000 - (int(21/k)*k*600 - 12000)/2<br/>y_step = 600 * k </span><span id="8ec4" class="ma jl hi lw b fi mf mc l md me">latitudes = []<br/>longitudes = []<br/>distances_from_center = []<br/>xs = []<br/>ys = []<br/><strong class="lw hj">for</strong> i <strong class="lw hj">in</strong> range(0, int(21/k)):<br/>    y = y_min + i * y_step<br/>    x_offset = 300 <strong class="lw hj">if</strong> i%<strong class="lw hj">2</strong>==0 else 0<br/>    <strong class="lw hj">for</strong> j <strong class="lw hj">in</strong> range(0, 21):<br/>        x = x_min + j * x_step + x_offset<br/>        distance_from_center = calc_xy_distance(rome_center_x, rome_center_y, x, y)<br/>        <strong class="lw hj">if</strong> (distance_from_center &lt;= 6001):<br/>            lon, lat = xy_to_lonlat(x, y)<br/>            latitudes.append(lat)<br/>            longitudes.append(lon)<br/>            distances_from_center.append(distance_from_center)<br/>            xs.append(x)<br/>            ys.append(y)</span><span id="d94a" class="ma jl hi lw b fi mf mc l md me">print(len(latitudes), 'candidate neighborhood centers generated.')</span><span id="f5e7" class="ma jl hi lw b fi mf mc l md me">print('Total number of restaurants:', len(restaurants))<br/>print('Total number of French restaurants:', len(french_restaurants))<br/>print('Percentage of French restaurants: <strong class="lw hj">{:.2f}</strong>%'.format(len(french_restaurants) / len(restaurants) * 100))<br/>print('Average number of restaurants in neighborhood:', np.array([len(r) <strong class="lw hj">for</strong> r <strong class="lw hj">in</strong> location_restaurants]).mean())</span></pre><p id="a6c5" class="pw-post-body-paragraph kz la hi ke b kf lm ij lb kh ln im lc kj lo le lf kl lp lh li kn lq lk ll kp hb bi translated"><em class="lu">餐厅总数:1579 <br/>法国餐厅总数:5 <br/>法国餐厅百分比:0.32% <br/>街区平均餐厅数:3.75 </em></p><pre class="iy iz ja jb fd lv lw lx ly aw lz bi"><span id="f01e" class="ma jl hi lw b fi mb mc l md me">print('List of all restaurants')<br/>print('-----------------------')<br/><strong class="lw hj">for</strong> r <strong class="lw hj">in</strong> list(restaurants.values())[:10]:<br/>    print(r)<br/>print('...')<br/>print('Total:', len(restaurants))</span></pre><p id="c80c" class="pw-post-body-paragraph kz la hi ke b kf lm ij lb kh ln im lc kj lo le lf kl lp lh li kn lq lk ll kp hb bi translated"><em class="lu"><em class="lu"><br/><br/><br/>【4fa7abc7e4b0b487cf9d4e5d’,‘Assyrtico’,41.8410974,12.4652566,‘Fira Santorini,意大利’,166,False,289549.452511014,4635240.053573056)<br/>【4d9dbeffc97a236a9f23c499’,‘704餐厅’,41.84170370486973,12.464632987976074,‘海路704,00144罗马拉齐奥,意大利’,115,FALSE,289499.6610658221,46358.90566257】<br/>【4e66567bd4c06542ac9 罗马 罗马 罗马 罗马 罗马 罗马 罗马 罗马 罗马 罗马 罗马 罗马 罗马 罗马 罗马 罗马 罗马 罗马 罗马 罗马 罗马 罗马 罗马 罗马 罗马 罗马 罗马 罗马 罗马 罗马 罗马 罗马 罗马 罗马 罗马 罗马 罗马 罗马 罗马 罗马 罗马 罗马 罗马 罗马 罗马 罗马 罗马 罗马 罗马 罗马 罗马 罗马 罗马 罗马 罗马 罗马 罗马 罗马 罗马 罗马 罗马 罗马 罗马 罗马 意大利 罗马 罗马 ……<br/>总计: 1579 </em></em></p><pre class="iy iz ja jb fd lv lw lx ly aw lz bi"><span id="1978" class="ma jl hi lw b fi mb mc l md me">print('List of French restaurants')<br/>print('---------------------------')<br/><strong class="lw hj">for</strong> r <strong class="lw hj">in</strong> list(french_restaurants.values())[:10]:<br/>    print(r)<br/>print('...')<br/>print('Total:', len(french_restaurants))</span></pre><p id="e7e1" class="pw-post-body-paragraph kz la hi ke b kf lm ij lb kh ln im lc kj lo le lf kl lp lh li kn lq lk ll kp hb bi translated">)(那)(就)(是)(我)(们)(的)(一)(年)(里)(,)(我)(们)(都)(不)(知)(道)(了)(,)(我)(们)(还)(不)(知)(道)(,)(我)(们)(还)(不)(知)(道)(,)(我)(们)(还)(不)(知)(道)(,)(我)(们)(还)(是)(这)(些)(人)(还)(有)(些)(人)(,)(我)(们)(还)(没)(听)(过)(这)(些)(话)(,)(我)(们)(还)(没)(听)(过)(这)(些)(话)(,)(我)(们)(还)(没)(听)(过)(这)(些)(话)(。……<br/>总计: 5 </p><pre class="iy iz ja jb fd lv lw lx ly aw lz bi"><span id="5b06" class="ma jl hi lw b fi mb mc l md me">print('Restaurants around location')<br/>print('---------------------------')<br/><strong class="lw hj">for</strong> i <strong class="lw hj">in</strong> range(100, 110):<br/>    rs = location_restaurants[i][:8]<br/>    names = ', '.join([r[1] <strong class="lw hj">for</strong> r <strong class="lw hj">in</strong> rs])<br/>    print('Restaurants around location <strong class="lw hj">{}</strong>: <strong class="lw hj">{}</strong>'.format(i+1, names))</span></pre><p id="3986" class="pw-post-body-paragraph kz la hi ke b kf lm ij lb kh ln im lc kj lo le lf kl lp lh li kn lq lk ll kp hb bi translated"><em class="lu">地点周围的餐厅<br/> - <br/>地点101周围的餐厅:Vecchi Sapori、frontoni &amp; frontoni <br/>地点102周围的餐厅:L'Osteria di Monteverde、Mezè Bistrot Mediterraneo <br/>地点103周围的餐厅:La Tavernaccia、Albaruja <br/>地点104周围的餐厅:Stazione Di Posta、Trattoria Pecorino、Checchino dal 1887 <br/>地点105周围的餐厅:Sushisen、Porto 107号位置周围的天堂美食俱乐部餐厅、Città Delle Meraviglie <br/>餐厅:Vivai、Roma Antica、Bull Steak Ristorante Bisteccheria<br/>餐厅108号位置周围的餐厅:无<br/>餐厅109号位置周围的餐厅:Los Cabos Tex Mex、Ristorante Hari、野餐<br/>餐厅110号位置周围的餐厅:傅贵阿莱格里亚的米托斯塔维尔纳餐厅(Mithos Taverna Dell'Allegria ),位于Due Al Tre、La Zingarella、quello checè</em></p><p id="fd57" class="pw-post-body-paragraph kz la hi ke b kf lm ij lb kh ln im lc kj lo le lf kl lp lh li kn lq lk ll kp hb bi translated">让我们将数据可视化…</p><pre class="iy iz ja jb fd lv lw lx ly aw lz bi"><span id="6bfa" class="ma jl hi lw b fi mb mc l md me">map_rome = folium.Map(location=rome_center, zoom_start=13)<br/>folium.Marker(rome_center, popup='Piazza del Campidoglio').add_to(map_rome)<br/><strong class="lw hj">for</strong> res <strong class="lw hj">in</strong> restaurants.values():<br/>    lat = res[2]; lon = res[3]<br/>    is_french = res[6]<br/>    color = 'red' <strong class="lw hj">if</strong> is_french <strong class="lw hj">else</strong> 'blue'<br/>    folium.CircleMarker([lat, lon], radius=3, color=color, fill=<strong class="lw hj">True</strong>, fill_color=color, fill_opacity=1).add_to(map_rome)<br/>map_rome</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="er es mi"><img src="../Images/375347d5a32df9d4e0c0dcb62da7c236.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lT-Ibgukw2ntfRJXVuHd0w.png"/></div></div></figure><p id="5c85" class="pw-post-body-paragraph kz la hi ke b kf lm ij lb kh ln im lc kj lo le lf kl lp lh li kn lq lk ll kp hb bi translated">看起来不错。所以现在我们有了距离Piazza del Campidoglio几公里范围内的所有餐馆，而且我们知道哪些是法国餐馆！我们还知道哪些餐馆正好在每个邻近候选中心的附近。</p><p id="496d" class="pw-post-body-paragraph kz la hi ke b kf lm ij lb kh ln im lc kj lo le lf kl lp lh li kn lq lk ll kp hb bi translated">数据收集阶段到此结束——我们现在准备使用这些数据进行分析，以生成关于新法国餐厅最佳位置的报告！</p><h1 id="ba4e" class="jk jl hi bd jm jn jo jp jq jr js jt ju io jv ip jw ir jx is jy iu jz iv ka kb bi translated">方法学</h1><p id="b30b" class="pw-post-body-paragraph kz la hi ke b kf kg ij lb kh ki im lc kj ld le lf kl lg lh li kn lj lk ll kp hb bi translated">在这个项目中，我们将致力于检测罗马餐厅密度低的区域，尤其是那些法国餐厅数量少的区域。我们将分析限制在市中心周围约6公里的区域。</p><p id="b959" class="pw-post-body-paragraph kz la hi ke b kf lm ij lb kh ln im lc kj lo le lf kl lp lh li kn lq lk ll kp hb bi translated">第一步，我们收集了所需的<strong class="ke hj">数据:距离罗马中心6公里以内的每家餐厅的位置和类型(类别)</strong>。我们还<strong class="ke hj">确定了法国餐馆</strong>(根据Foursquare的分类)。</p><p id="4778" class="pw-post-body-paragraph kz la hi ke b kf lm ij lb kh ln im lc kj lo le lf kl lp lh li kn lq lk ll kp hb bi translated">我们分析的第二步将是计算和探索罗马不同地区的'<strong class="ke hj">餐厅密度</strong>——我们将使用<strong class="ke hj">热图</strong>来确定一些靠近市中心的有希望的区域，这些区域一般餐厅数量较少(<em class="lu">和</em>附近没有法国餐厅)，并将我们的注意力集中在这些区域。</p><p id="819f" class="pw-post-body-paragraph kz la hi ke b kf lm ij lb kh ln im lc kj lo le lf kl lp lh li kn lq lk ll kp hb bi translated">第三步也是最后一步，我们将关注最有前景的区域，并在这些区域内创建符合与利益相关方讨论确定的一些基本要求的<strong class="ke hj">个地点集群:我们将考虑在<strong class="ke hj">半径250米</strong>内不超过两家餐厅的地点，我们希望在<strong class="ke hj">半径400米</strong>内没有法国餐厅的地点。我们将展示所有此类位置的地图，但也会创建这些位置的聚类(使用<strong class="ke hj"> k-means聚类</strong>)以确定一般区域/街区/地址，这些区域/街区/地址应该是利益相关方最终“街道级别”探索和搜索最佳场馆位置的起点。</strong></p><h1 id="9813" class="jk jl hi bd jm jn jo jp jq jr js jt ju io jv ip jw ir jx is jy iu jz iv ka kb bi translated">分析</h1><p id="1303" class="pw-post-body-paragraph kz la hi ke b kf kg ij lb kh ki im lc kj ld le lf kl lg lh li kn lj lk ll kp hb bi translated">让我们执行一些基本的解释性数据分析，并从原始数据中获得一些额外的信息。首先，让我们来数一数每个候选区域的<strong class="ke hj">家餐厅</strong>:</p><pre class="iy iz ja jb fd lv lw lx ly aw lz bi"><span id="b89b" class="ma jl hi lw b fi mb mc l md me">location_restaurants_count = [len(res) <strong class="lw hj">for</strong> res <strong class="lw hj">in</strong> location_restaurants]</span><span id="1209" class="ma jl hi lw b fi mf mc l md me">df_locations['Restaurants in area'] = location_restaurants_count</span><span id="22a2" class="ma jl hi lw b fi mf mc l md me">print('Average number of restaurants in every area with radius = 300m:', np.array(location_restaurants_count).mean())</span><span id="436d" class="ma jl hi lw b fi mf mc l md me">df_locations.head(10)</span><span id="b91f" class="ma jl hi lw b fi mf mc l md me">Average number of restaurants in every area with radius = 300m: 3.75</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="er es mn"><img src="../Images/06fdcce71135d855a4c6b80e5a2d6417.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QgQTcXA-oVYKfMLJ6xfaVA.png"/></div></div></figure><p id="c49b" class="pw-post-body-paragraph kz la hi ke b kf lm ij lb kh ln im lc kj lo le lf kl lp lh li kn lq lk ll kp hb bi translated">现在让我们计算从每个候选区域中心到最近的法国餐馆的距离(不仅仅是300米内的，我们想要到最近的法国餐馆的距离，不管它有多远)。</p><pre class="iy iz ja jb fd lv lw lx ly aw lz bi"><span id="cbab" class="ma jl hi lw b fi mb mc l md me">distances_to_french_restaurant = []</span><span id="f647" class="ma jl hi lw b fi mf mc l md me"><strong class="lw hj">for</strong> area_x, area_y <strong class="lw hj">in</strong> zip(xs, ys):<br/>    min_distance = 10000<br/>    <strong class="lw hj">for</strong> res <strong class="lw hj">in</strong> french_restaurants.values():<br/>        res_x = res[7]<br/>        res_y = res[8]<br/>        d = calc_xy_distance(area_x, area_y, res_x, res_y)<br/>        <strong class="lw hj">if</strong> d&lt;min_distance:<br/>            min_distance = d<br/>    distances_to_french_restaurant.append(min_distance)</span><span id="e775" class="ma jl hi lw b fi mf mc l md me">df_locations['Distance to French restaurant'] = distances_to_french_restaurant<br/>df_locations.head(10)<br/>print('Average distance to closest French restaurant from each area center:', df_locations['Distance to French restaurant'].mean())</span></pre><p id="e50e" class="pw-post-body-paragraph kz la hi ke b kf lm ij lb kh ln im lc kj lo le lf kl lp lh li kn lq lk ll kp hb bi translated"><em class="lu">从每个区域中心到最近的法国餐厅的平均距离:11305</em></p><p id="4dc0" class="pw-post-body-paragraph kz la hi ke b kf lm ij lb kh ln im lc kj lo le lf kl lp lh li kn lq lk ll kp hb bi translated">好的，那么平均来说，每个候选区域中心大约3公里内都可以找到法国餐厅。我们需要仔细筛选我们的区域！</p><p id="f958" class="pw-post-body-paragraph kz la hi ke b kf lm ij lb kh ln im lc kj lo le lf kl lp lh li kn lq lk ll kp hb bi translated">让我们创建一个显示<strong class="ke hj">热图/餐馆密度</strong>的地图，并尝试从中提取一些有意义的信息。此外，让我们在地图上显示出罗马行政区的边界，以及距离坎皮多利奥广场1公里、2公里和3公里的几个圆圈。</p><pre class="iy iz ja jb fd lv lw lx ly aw lz bi"><span id="7308" class="ma jl hi lw b fi mb mc l md me"><em class="lu">#Creating a geojson object named rome_boroughs with coordinates of each of the 15 boroughs in Rome..</em></span><span id="ee7d" class="ma jl hi lw b fi mf mc l md me">rome_boroughs={<br/>  "type": "Feature",<br/>  "geometry": {<br/>    "type": 'Polygon',<br/>    "coordinates": [[[41.91462085439633, 12.453880259351273],[41.9323252862348, 12.472743915862067],<br/>                    [41.95459853645301, 12.517301710976446],[41.927401191945876, 12.573984428765995],<br/>                    [41.90042507803908, 12.574239963824201],[41.87365902350219, 12.633031521668117],<br/>                    [41.878807470933715, 12.481057949431518],[41.84887494434637, 12.497835707490317],<br/>                    [41.839143578605835, 12.44446268112522],[41.75656198951887, 12.34778565644536],<br/>                    [41.83929732046143, 12.442616272611323],[41.871053634308964, 12.420010414810722],<br/>                    [41.89322490765442, 12.43834294376203],[41.92821724387105, 12.408302173512357],<br/>                    [41.94263655480194, 12.470443567468067]]]<br/>  },<br/>  "properties": {<br/>    "name": "Rome Boroughs"<br/>  }<br/>}</span><span id="984b" class="ma jl hi lw b fi mf mc l md me">restaurant_latlons = [[res[2], res[3]] <strong class="lw hj">for</strong> res <strong class="lw hj">in</strong> restaurants.values()]</span><span id="7a4a" class="ma jl hi lw b fi mf mc l md me">french_latlons = [[res[2], res[3]] <strong class="lw hj">for</strong> res <strong class="lw hj">in</strong> french_restaurants.values()]</span><span id="3219" class="ma jl hi lw b fi mf mc l md me"><strong class="lw hj">from</strong> <strong class="lw hj">folium</strong> <strong class="lw hj">import</strong> plugins<br/><strong class="lw hj">from</strong> <strong class="lw hj">folium.plugins</strong> <strong class="lw hj">import</strong> HeatMap</span><span id="671e" class="ma jl hi lw b fi mf mc l md me">map_rome = folium.Map(location=rome_center, zoom_start=13)<br/>folium.TileLayer('cartodbpositron').add_to(map_rome) <em class="lu">#cartodbpositron cartodbdark_matter</em><br/>HeatMap(restaurant_latlons).add_to(map_rome)<br/>folium.Marker(rome_center).add_to(map_rome)<br/>folium.Circle(rome_center, radius=1000, fill=<strong class="lw hj">False</strong>, color='white').add_to(map_rome)<br/>folium.Circle(rome_center, radius=2000, fill=<strong class="lw hj">False</strong>, color='white').add_to(map_rome)<br/>folium.Circle(rome_center, radius=3000, fill=<strong class="lw hj">False</strong>, color='white').add_to(map_rome)<br/>folium.GeoJson(rome_boroughs, style_function=boroughs_style, name='geojson').add_to(map_rome)<br/>map_rome</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="er es mo"><img src="../Images/0d1db608a5db77eed3253de746563ade.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EGYcOZ9ljtREqoP_M0jm5Q.png"/></div></div></figure><p id="84ca" class="pw-post-body-paragraph kz la hi ke b kf lm ij lb kh ln im lc kj lo le lf kl lp lh li kn lq lk ll kp hb bi translated">在世界上所有的城市中，很少有比罗马的街区更迷人、更有价值的地方了。罗马的里奥尼街区骄傲地站在纽约市的行政区和巴黎的行政区等著名街区的旁边，到处都是历史遗迹和博物馆，在酒店、餐馆、酒吧、咖啡馆和俱乐部方面，每一个街区都有自己的风格。</p><p id="bc70" class="pw-post-body-paragraph kz la hi ke b kf lm ij lb kh ln im lc kj lo le lf kl lp lh li kn lq lk ll kp hb bi translated">对流行的旅游指南和网站的分析经常提到罗马中心美丽、有趣、历史和文化丰富..罗马的历史中心T21很受游客和意大利人的喜爱。</p><p id="5792" class="pw-post-body-paragraph kz la hi ke b kf lm ij lb kh ln im lc kj lo le lf kl lp lh li kn lq lk ll kp hb bi translated">受游客欢迎，另类和波西米亚，但蓬勃发展和时尚，相对靠近市中心和良好的连接，这些区似乎证明了进一步的分析。</p><p id="8925" class="pw-post-body-paragraph kz la hi ke b kf lm ij lb kh ln im lc kj lo le lf kl lp lh li kn lq lk ll kp hb bi translated">让我们定义一个新的、更窄的感兴趣区域，它将包括罗马餐馆数量少的部分，并且最靠近Piazza del Campidoglio..</p><pre class="iy iz ja jb fd lv lw lx ly aw lz bi"><span id="69f4" class="ma jl hi lw b fi mb mc l md me">roi_x_min = rome_center_x - 2000<br/>roi_y_max = rome_center_y + 1000<br/>roi_width = 5000<br/>roi_height = 5000<br/>roi_center_x = roi_x_min + 2500<br/>roi_center_y = roi_y_max - 2500<br/>roi_center_lon, roi_center_lat = xy_to_lonlat(roi_center_x, roi_center_y)<br/>roi_center = [roi_center_lat, roi_center_lon]<br/><br/>map_rome = folium.Map(location=roi_center, zoom_start=14)<br/>HeatMap(restaurant_latlons).add_to(map_rome)<br/>folium.Marker(rome_center).add_to(map_rome)<br/>folium.Circle(roi_center, radius=2500, color='white', fill=<strong class="lw hj">True</strong>, fill_opacity=0.4).add_to(map_rome)<br/>folium.GeoJson(rome_boroughs, style_function=boroughs_style, name='geojson').add_to(map_rome)<br/>map_rome</span></pre><p id="f45d" class="pw-post-body-paragraph kz la hi ke b kf lm ij lb kh ln im lc kj lo le lf kl lp lh li kn lq lk ll kp hb bi translated"><em class="lu">生成了2261个候选邻域中心。</em></p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="er es mp"><img src="../Images/e1f808d95954a3cbde79cf1d41da1fb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ExkCrlKYZaxq-ZkNDxRVSw.png"/></div></div></figure><p id="e699" class="pw-post-body-paragraph kz la hi ke b kf lm ij lb kh ln im lc kj lo le lf kl lp lh li kn lq lk ll kp hb bi translated">好的。现在，让我们为每个候选位置计算两个最重要的事情:附近餐馆的数量(我们将使用250米的半径)和到最近的法国餐馆的距离(如果有的话)。</p><pre class="iy iz ja jb fd lv lw lx ly aw lz bi"><span id="9e41" class="ma jl hi lw b fi mb mc l md me"><strong class="lw hj">def</strong> count_restaurants_nearby(x, y, restaurants, radius=250):    <br/>    count = 0<br/>    <strong class="lw hj">for</strong> res <strong class="lw hj">in</strong> restaurants.values():<br/>        res_x = res[7]; res_y = res[8]<br/>        d = calc_xy_distance(x, y, res_x, res_y)<br/>        <strong class="lw hj">if</strong> d&lt;=radius:<br/>            count += 1<br/>    <strong class="lw hj">return</strong> count<br/><br/><strong class="lw hj">def</strong> find_nearest_restaurant(x, y, restaurants):<br/>    d_min = 100000<br/>    <strong class="lw hj">for</strong> res <strong class="lw hj">in</strong> restaurants.values():<br/>        res_x = res[7]; res_y = res[8]<br/>        d = calc_xy_distance(x, y, res_x, res_y)<br/>        <strong class="lw hj">if</strong> d&lt;=d_min:<br/>            d_min = d<br/>    <strong class="lw hj">return</strong> d_min<br/><br/>roi_restaurant_counts = []<br/>roi_french_distances = []<br/><br/>print('Generating data on location candidates... ', end='')<br/><strong class="lw hj">for</strong> x, y <strong class="lw hj">in</strong> zip(roi_xs, roi_ys):<br/>    count = count_restaurants_nearby(x, y, restaurants, radius=250)<br/>    roi_restaurant_counts.append(count)<br/>    distance = find_nearest_restaurant(x, y, french_restaurants)<br/>    roi_french_distances.append(distance)<br/>print('done.')</span></pre><p id="622f" class="pw-post-body-paragraph kz la hi ke b kf lm ij lb kh ln im lc kj lo le lf kl lp lh li kn lq lk ll kp hb bi translated"><em class="lu">生成候选位置数据...完成了。</em></p><pre class="iy iz ja jb fd lv lw lx ly aw lz bi"><span id="74b5" class="ma jl hi lw b fi mb mc l md me"><em class="lu"># Let's put this into dataframe</em><br/>df_roi_locations = pd.DataFrame({'Latitude':roi_latitudes,<br/>                                 'Longitude':roi_longitudes,<br/>                                 'X':roi_xs,<br/>                                 'Y':roi_ys,<br/>                                 'Restaurants nearby':roi_restaurant_counts,<br/>                                 'Distance to French restaurant':roi_french_distances})<br/><br/>df_roi_locations.head(10)</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="er es mq"><img src="../Images/9bd9bab59375c51f39f11ea92ab20267.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5cZobDKWXRPSB-m9xj9BCw.png"/></div></div></figure><p id="2c86" class="pw-post-body-paragraph kz la hi ke b kf lm ij lb kh ln im lc kj lo le lf kl lp lh li kn lq lk ll kp hb bi translated">好的。现在我们过滤这些位置:我们只对半径250米内不超过两家餐馆，半径400米内没有意大利餐馆的位置感兴趣。</p><pre class="iy iz ja jb fd lv lw lx ly aw lz bi"><span id="f85b" class="ma jl hi lw b fi mb mc l md me">good_res_count = np.array((df_roi_locations['Restaurants nearby']&lt;=2))<br/>print('Locations with no more than two restaurants nearby:', good_res_count.sum())<br/><br/>good_ita_distance = np.array(df_roi_locations['Distance to French restaurant']&gt;=400)<br/>print('Locations with no French restaurants within 400m:', good_ita_distance.sum())<br/><br/>good_locations = np.logical_and(good_res_count, good_ita_distance)<br/>print('Locations with both conditions met:', good_locations.sum())<br/><br/>df_good_locations = df_roi_locations[good_locations]</span></pre><p id="b3e4" class="pw-post-body-paragraph kz la hi ke b kf lm ij lb kh ln im lc kj lo le lf kl lp lh li kn lq lk ll kp hb bi translated"><em class="lu">附近没有两家以上餐厅的地点:1017<br/>400米内没有法国餐厅的地点:2070 <br/>两个条件都满足的地点:947 </em></p><p id="a12e" class="pw-post-body-paragraph kz la hi ke b kf lm ij lb kh ln im lc kj lo le lf kl lp lh li kn lq lk ll kp hb bi translated">让我们看看这在地图上是什么样子。</p><pre class="iy iz ja jb fd lv lw lx ly aw lz bi"><span id="1baa" class="ma jl hi lw b fi mb mc l md me">good_latitudes = df_good_locations['Latitude'].values<br/>good_longitudes = df_good_locations['Longitude'].values<br/><br/>good_locations = [[lat, lon] <strong class="lw hj">for</strong> lat, lon <strong class="lw hj">in</strong> zip(good_latitudes, good_longitudes)]<br/><br/>map_rome = folium.Map(location=roi_center, zoom_start=14)<br/>folium.TileLayer('cartodbpositron').add_to(map_rome)<br/>HeatMap(restaurant_latlons).add_to(map_rome)<br/>folium.Circle(roi_center, radius=2500, color='white', fill=<strong class="lw hj">True</strong>, fill_opacity=0.6).add_to(map_rome)<br/>folium.Marker(rome_center).add_to(map_rome)<br/><strong class="lw hj">for</strong> lat, lon <strong class="lw hj">in</strong> zip(good_latitudes, good_longitudes):<br/>    folium.CircleMarker([lat, lon], radius=2, color='blue', fill=<strong class="lw hj">True</strong>, fill_color='blue', fill_opacity=1).add_to(map_rome) <br/>folium.GeoJson(rome_boroughs, style_function=boroughs_style, name='geojson').add_to(map_rome)<br/>map_rome</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="er es mr"><img src="../Images/ce81c6035e7c9836c6d2c3408bb4c9e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8FUpz593LQoBx60m2QQJeg.png"/></div></div></figure><p id="4f17" class="pw-post-body-paragraph kz la hi ke b kf lm ij lb kh ln im lc kj lo le lf kl lp lh li kn lq lk ll kp hb bi translated">看起来不错。我们现在有一个清晰的指示，附近的餐馆数量很少，附近根本没有法国餐馆。</p><p id="3c26" class="pw-post-body-paragraph kz la hi ke b kf lm ij lb kh ln im lc kj lo le lf kl lp lh li kn lq lk ll kp hb bi translated">现在让我们将这些位置聚集起来，创建包含好位置的区域中心。这些区域、它们的中心和地址将是我们分析的最终结果。</p><pre class="iy iz ja jb fd lv lw lx ly aw lz bi"><span id="ac19" class="ma jl hi lw b fi mb mc l md me"><strong class="lw hj">from</strong> <strong class="lw hj">sklearn.cluster</strong> <strong class="lw hj">import</strong> KMeans</span><span id="5c57" class="ma jl hi lw b fi mf mc l md me">number_of_clusters = 15</span><span id="c750" class="ma jl hi lw b fi mf mc l md me">good_xys = df_good_locations[['X', 'Y']].values<br/>kmeans = KMeans(n_clusters=number_of_clusters, random_state=0).fit(good_xys)</span><span id="8b1b" class="ma jl hi lw b fi mf mc l md me">cluster_centers = [xy_to_lonlat(cc[0], cc[1]) <strong class="lw hj">for</strong> cc <strong class="lw hj">in</strong> kmeans.cluster_centers_]</span><span id="2971" class="ma jl hi lw b fi mf mc l md me">map_rome = folium.Map(location=roi_center, zoom_start=14)<br/>folium.TileLayer('cartodbpositron').add_to(map_rome)<br/>HeatMap(restaurant_latlons).add_to(map_rome)<br/>folium.Circle(roi_center, radius=2500, color='white', fill=<strong class="lw hj">True</strong>, fill_opacity=0.4).add_to(map_rome)<br/>folium.Marker(rome_center).add_to(map_rome)<br/><strong class="lw hj">for</strong> lon, lat <strong class="lw hj">in</strong> cluster_centers:<br/>    folium.Circle([lat, lon], radius=500, color='green', fill=<strong class="lw hj">True</strong>, fill_opacity=0.25).add_to(map_rome) <br/><strong class="lw hj">for</strong> lat, lon <strong class="lw hj">in</strong> zip(good_latitudes, good_longitudes):<br/>    folium.CircleMarker([lat, lon], radius=2, color='blue', fill=<strong class="lw hj">True</strong>, fill_color='blue', fill_opacity=1).add_to(map_rome)<br/>folium.GeoJson(rome_boroughs, style_function=boroughs_style, name='geojson').add_to(map_rome)<br/>map_rome</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="er es ms"><img src="../Images/8cc0682b7481bb20095ba84ec744450b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kTFHmWZg9_fZ70VRQSTaYw.png"/></div></div></figure><p id="e9ea" class="pw-post-body-paragraph kz la hi ke b kf lm ij lb kh ln im lc kj lo le lf kl lp lh li kn lq lk ll kp hb bi translated">不错——我们的聚类代表了大多数候选位置的分组，聚类中心正好位于候选位置“丰富”区域的中间。</p><p id="55c3" class="pw-post-body-paragraph kz la hi ke b kf lm ij lb kh ln im lc kj lo le lf kl lp lh li kn lq lk ll kp hb bi translated">这些聚类中心的地址将是探索邻域的良好起点，以便根据邻域的具体情况找到最佳位置。</p><p id="85af" class="pw-post-body-paragraph kz la hi ke b kf lm ij lb kh ln im lc kj lo le lf kl lp lh li kn lq lk ll kp hb bi translated">让我们在没有热图的城市地图上看到这些区域，用阴影区域表示我们的聚类:</p><pre class="iy iz ja jb fd lv lw lx ly aw lz bi"><span id="c674" class="ma jl hi lw b fi mb mc l md me">map_rome = folium.Map(location=roi_center, zoom_start=14)<br/>folium.Marker(rome_center).add_to(map_rome)<br/><strong class="lw hj">for</strong> lat, lon <strong class="lw hj">in</strong> zip(good_latitudes, good_longitudes):<br/>    folium.Circle([lat, lon], radius=250, color='#00000000', fill=<strong class="lw hj">True</strong>, fill_color='#0066ff', fill_opacity=0.07).add_to(map_rome)<br/><strong class="lw hj">for</strong> lat, lon <strong class="lw hj">in</strong> zip(good_latitudes, good_longitudes):<br/>    folium.CircleMarker([lat, lon], radius=2, color='blue', fill=<strong class="lw hj">True</strong>, fill_color='blue', fill_opacity=1).add_to(map_rome)<br/><strong class="lw hj">for</strong> lon, lat <strong class="lw hj">in</strong> cluster_centers:<br/>    folium.Circle([lat, lon], radius=500, color='green', fill=<strong class="lw hj">False</strong>).add_to(map_rome) <br/>folium.GeoJson(rome_boroughs, style_function=boroughs_style, name='geojson').add_to(map_rome)<br/>map_rome<br/></span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="er es mt"><img src="../Images/29745a371b1d944077c07bc195ae51a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FMCn8IU8tIxjbCdNY8lBXw.png"/></div></div></figure><p id="6b40" class="pw-post-body-paragraph kz la hi ke b kf lm ij lb kh ln im lc kj lo le lf kl lp lh li kn lq lk ll kp hb bi translated">最后，让我们<strong class="ke hj">对这些候选区域中心进行反向地理编码，以获得可以呈现给利益相关者的地址</strong>。</p><pre class="iy iz ja jb fd lv lw lx ly aw lz bi"><span id="68c4" class="ma jl hi lw b fi mb mc l md me">candidate_area_addresses = []<br/>print('==============================================================')<br/>print('Addresses of centers of areas recommended for further analysis')<br/>print('==============================================================<strong class="lw hj">\n</strong>')<br/><strong class="lw hj">for</strong> lon, lat <strong class="lw hj">in</strong> cluster_centers:<br/>    <em class="lu">#addr = get_address(google_api_key, lat, lon).replace(',Italy', '')</em><br/>    l = [lat,lon]<br/>    location = geolocator.reverse(l,language='en')<br/>    addr = location.address<br/>    candidate_area_addresses.append(addr)    <br/>    x, y = lonlat_to_xy(lon, lat)<br/>    d = calc_xy_distance(x, y, rome_center_x, rome_center_y)<br/>    print('<strong class="lw hj">{}{}</strong> =&gt; <strong class="lw hj">{:.1f}</strong>km from City center'.format(addr, ' '*(50-len(addr)), d/1000))</span></pre><p id="f1d1" class="pw-post-body-paragraph kz la hi ke b kf lm ij lb kh ln im lc kj lo le lf kl lp lh li kn lq lk ll kp hb bi translated"><em class="lu">= = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =<br/>推荐进一步分析的区域中心前5位地址<br/>= = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =</em></p><p id="bdb7" class="pw-post-body-paragraph kz la hi ke b kf lm ij lb kh ln im lc kj lo le lf kl lp lh li kn lq lk ll kp hb bi translated"><em class="lu"> *65，Via Giovannipoli，Garbatella，Ostiense，Quartiere X Ostiense，罗马，Roma Capitale，Lazio，00145，意大利= &gt;距离市中心3.7公里</em></p><p id="780f" class="pw-post-body-paragraph kz la hi ke b kf lm ij lb kh ln im lc kj lo le lf kl lp lh li kn lq lk ll kp hb bi translated"><em class="lu"> *卡拉卡拉浴场，Via Antonina，Municipio Roma I，罗马，罗马首都，拉齐奥，00154，意大利= &gt;距离市中心1.8公里</em></p><p id="e55d" class="pw-post-body-paragraph kz la hi ke b kf lm ij lb kh ln im lc kj lo le lf kl lp lh li kn lq lk ll kp hb bi translated"><em class="lu"> *Teatro India，1，Lungotevere维托里奥·加斯曼，Quartiere XI葡萄牙，罗马，罗马首都，拉齐奥，00146，意大利= &gt;距离市中心2.8公里</em></p><p id="5e3d" class="pw-post-body-paragraph kz la hi ke b kf lm ij lb kh ln im lc kj lo le lf kl lp lh li kn lq lk ll kp hb bi translated"><em class="lu">* pertinenza scuola Kennedy区，Via Dandolo，Rione XIII Trastevere，Municipio Roma I，罗马，Roma Capitale，Lazio，00120，意大利= &gt;距离市中心1.6公里</em></p><p id="cf74" class="pw-post-body-paragraph kz la hi ke b kf lm ij lb kh ln im lc kj lo le lf kl lp lh li kn lq lk ll kp hb bi translated"><em class="lu"> *Caserma Goffredo Zignani，Piazza Zama，San Giovanni，Municipio Roma VII，罗马，Roma Capitale，Lazio，00183，意大利= &gt;距离市中心3.2公里</em></p><p id="bb63" class="pw-post-body-paragraph kz la hi ke b kf lm ij lb kh ln im lc kj lo le lf kl lp lh li kn lq lk ll kp hb bi translated">让我们把它们放在地图上…</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="er es ms"><img src="../Images/12db59db6c3799ccd2f423533dd3bac6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UYzuQbqmRX51_9GtrNqSWA.png"/></div></div></figure><h1 id="20b5" class="jk jl hi bd jm jn jo jp jq jr js jt ju io jv ip jw ir jx is jy iu jz iv ka kb bi translated">结果和讨论</h1><p id="1cf1" class="pw-post-body-paragraph kz la hi ke b kf kg ij lb kh ki im lc kj ld le lf kl lg lh li kn lj lk ll kp hb bi translated">我们创建了15个代表区域中心的地址，这些区域包含餐馆数量较少且附近没有法国餐馆的位置，所有区域都离市中心相当近(所有区域都不到4公里，其中大约一半距离城市不到2公里)。虽然地图上显示的区域半径约为500米(绿色圆圈)，但它们的形状实际上非常不规则，它们的中心/地址仅应被视为搜索潜在餐厅位置时探索邻近区域的起点。大多数区域位于罗马的历史中心，我们认为这里很有趣，因为它很受游客欢迎，离市中心很近，公共交通也很便利。</p><p id="f875" class="pw-post-body-paragraph kz la hi ke b kf lm ij lb kh ln im lc kj lo le lf kl lp lh li kn lq lk ll kp hb bi translated">这些候选位置被聚类以创建包含最大数量的候选位置的感兴趣区域。还使用反向地理编码生成了这些区域的中心地址，以用作基于其他因素的更详细的本地分析的标记/起点。</p><p id="8d00" class="pw-post-body-paragraph kz la hi ke b kf lm ij lb kh ln im lc kj lo le lf kl lp lh li kn lq lk ll kp hb bi translated">所有这一切的结果是，根据现有场所的数量和距离，15个区域包含了最多的潜在新餐厅位置，包括一般餐厅和意大利餐厅。当然，这并不意味着这些区域就是新餐馆的最佳位置！此分析的目的是仅提供靠近罗马中心但现有餐厅(尤其是法国餐厅)不多的区域的信息—完全有可能在这些区域中的任何一个区域有少量餐厅，这些原因会使它们不适合新餐厅，尽管该区域缺乏竞争。因此，建议的区域应仅被视为更详细分析的起点，该分析最终会得出不仅没有邻近竞争，而且考虑了其他因素并满足所有其他相关条件的位置</p><h1 id="2446" class="jk jl hi bd jm jn jo jp jq jr js jt ju io jv ip jw ir jx is jy iu jz iv ka kb bi translated">结论</h1><p id="de07" class="pw-post-body-paragraph kz la hi ke b kf kg ij lb kh ki im lc kj ld le lf kl lg lh li kn lj lk ll kp hb bi translated">该项目的目的是确定罗马市中心附近餐馆(尤其是法国餐馆)数量较少的区域，以帮助利益相关方缩小寻找新法国餐馆最佳位置的范围。通过从Foursquare数据中计算餐厅密度分布，我们首先确定了证明进一步分析合理的一般行政区，然后生成了满足一些关于现有附近餐厅的基本要求的大量位置集合。然后对这些位置进行聚类，以创建主要的感兴趣区域(包含最大数量的潜在位置),并创建这些区域中心的地址，作为利益相关方最终勘探的起点。</p><p id="cd81" class="pw-post-body-paragraph kz la hi ke b kf lm ij lb kh ln im lc kj lo le lf kl lp lh li kn lq lk ll kp hb bi translated">最佳餐厅位置的最终决定将由利益相关方根据每个推荐区域的社区和位置的具体特征做出，并考虑其他因素，如每个位置的吸引力、交通/靠近主要道路、房地产可用性、价格、每个社区的社会和经济动态等。</p></div></div>    
</body>
</html>