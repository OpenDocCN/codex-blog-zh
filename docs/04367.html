<html>
<head>
<title>Integrating SCTL into RAL — Making Apache ShardingSphere Perfect for Database Management</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将SCTL集成到RAL——使Apache ShardingSphere成为数据库管理的完美之选</h1>
<blockquote>原文：<a href="https://medium.com/codex/integrating-sctl-into-ral-5c64ea45db02?source=collection_archive---------14-----------------------#2021-11-24">https://medium.com/codex/integrating-sctl-into-ral-5c64ea45db02?source=collection_archive---------14-----------------------#2021-11-24</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="ae7f" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">在孟浩然撰写的上一篇文章<a class="ae jf" href="https://shardingsphere.apache.org/blog/en/material/jul_26_an_introduction_to_distsql/" rel="noopener ugc nofollow" target="_blank">“DistSQL简介”</a>中，Apache ShardingSphere提交者分享了dist SQL设计背后的动机，解释了它的语法系统，并令人印象深刻地展示了如何使用一条SQL创建一个分片表。</p><p id="4955" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">最近，ShardingSphere社区重新设计了SCTL语法和执行引擎，将SCTL集成到DistSQL语法系统中。现在RAL包含了旧的SCTL函数，使得ShardingSphere的命令语言对于数据库管理来说更加方便。今天，我们的社区作者将介绍这些变化，并详细说明如何使用新的RAL命令行。我们总是追求更好的用户体验，我们这次开发的升级只是又一个典型的例子。</p><h1 id="347b" class="jg jh hi bd ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd bi translated">回顾:什么是RAL？</h1><p id="ea6c" class="pw-post-body-paragraph ih ii hi ij b ik ke im in io kf iq ir is kg iu iv iw kh iy iz ja ki jc jd je hb bi translated">RAL是DistSQL的一个子类型。DistSQL包含三种类型:RDL、RQL和RAL。</p><ul class=""><li id="a40d" class="kj kk hi ij b ik il io ip is kl iw km ja kn je ko kp kq kr bi translated">资源和规则定义语言(RDL):创建、修改或删除资源和规则。</li><li id="3bbf" class="kj kk hi ij b ik ks io kt is ku iw kv ja kw je ko kp kq kr bi translated">资源和规则查询语言(RQL):查询和显示资源和规则。</li><li id="c1d3" class="kj kk hi ij b ik ks io kt is ku iw kv ja kw je ko kp kq kr bi translated">资源和规则管理语言(RAL):控制资源和规则管理的高级功能。</li></ul><h1 id="57c7" class="jg jh hi bd ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd bi translated">SCTL是什么？</h1><p id="600f" class="pw-post-body-paragraph ih ii hi ij b ik ke im in io kf iq ir is kg iu iv iw kh iy iz ja ki jc jd je hb bi translated">ShardingSphere控制语言(SCTL)是Apache ShardingSphere对提示、交易类型切换、分片执行查询等增强功能执行一系列操作的命令语言。</p><p id="4f3c" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">SCTL发出了下面的命令:</p><figure class="ky kz la lb fd lc er es paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="er es kx"><img src="../Images/f701ec6574bc0492d4ab7d66043b5e78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1zC5S2VLgbx_aDHaWFFgcQ.png"/></div></div></figure><h1 id="5496" class="jg jh hi bd ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd bi translated">为什么现在整合SCTL？</h1><ul class=""><li id="3d6a" class="kj kk hi ij b ik ke io kf is lj iw lk ja ll je ko kp kq kr bi translated">SCTL特性在ShardingSphere v3.1.0中发布。当时，我们甚至没有创建DistSQL概念——现在DistSQL可以提供具有丰富特性和一致概念的新API。为了避免过度陡峭的学习曲线，我们选择将SCTL整合到RAL。</li><li id="a004" class="kj kk hi ij b ik ks io kt is ku iw kv ja kw je ko kp kq kr bi translated">SCTL语法实际上非常容易识别:它用特殊的前缀“sctl:”标记。解析SCTL命令依赖于字符串匹配，而不是使用我们的解析引擎。现在DistSQL已经足够成熟了，是时候删除这些特殊代码，让解析器引擎来处理它们了。</li><li id="c45c" class="kj kk hi ij b ik ks io kt is ku iw kv ja kw je ko kp kq kr bi translated">此外，SCTL语法不是真正的SQL。Apache ShardingSphere 5.0.0刚刚发布，DistSQL已经是管理资源和规则的最佳解决方案。这个由ShardingSphere创建的SQL在实践中是真正的SQL——那么为什么不将SCTL集成到DistSQL中呢？</li></ul><h1 id="1681" class="jg jh hi bd ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd bi translated">分析</h1><p id="758c" class="pw-post-body-paragraph ih ii hi ij b ik ke im in io kf iq ir is kg iu iv iw kh iy iz ja ki jc jd je hb bi translated">我们的社区已经详细讨论了如何应对这一变化。最后，我们决定用新的RAL命令替换SCTL语法(见下表):</p><figure class="ky kz la lb fd lc er es paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="er es lm"><img src="../Images/606e9e1d01d060b0ceaa5daaf5535452.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RA0X6hOVzXnI1KxoDZsJJw.png"/></div></div></figure><p id="23ab" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated"><strong class="ij hj">现在，让我们逐一分析这些命令:</strong></p><ul class=""><li id="a8f0" class="kj kk hi ij b ik il io ip is kl iw km ja kn je ko kp kq kr bi translated"><code class="du ln lo lp lq b">show variable transaction_type</code></li></ul><p id="7d04" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated"><em class="lr">查询当前交易类型。</em></p><p id="e742" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">输入命令</p><pre class="ky kz la lb fd ls lq lt lu aw lv bi"><span id="048d" class="lw jh hi lq b fi lx ly l lz ma">mysql&gt; show variable transaction_type;</span></pre><p id="a76b" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">输出</p><pre class="ky kz la lb fd ls lq lt lu aw lv bi"><span id="cd07" class="lw jh hi lq b fi lx ly l lz ma">+------------------+<br/>| TRANSACTION_TYPE |<br/>+------------------+<br/>| LOCAL            |<br/>+------------------+</span></pre><ul class=""><li id="7001" class="kj kk hi ij b ik il io ip is kl iw km ja kn je ko kp kq kr bi translated"><code class="du ln lo lp lq b">set variable transaction_type</code></li></ul><blockquote class="mb mc md"><p id="646e" class="ih ii lr ij b ik il im in io ip iq ir me it iu iv mf ix iy iz mg jb jc jd je hb bi translated"><em class="hi">修改当前交易类型(本地、XA或基础；不区分大小写)。</em></p></blockquote><p id="8fdb" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">输入命令</p><pre class="ky kz la lb fd ls lq lt lu aw lv bi"><span id="2a59" class="lw jh hi lq b fi lx ly l lz ma">mysql&gt; set variable transaction_type=XA;</span></pre><p id="07c0" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">输出</p><p id="b895" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">a.如果成功，显示“查询正常，0行受影响”；</p><p id="9360" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">b.再次执行<code class="du ln lo lp lq b">show variable transaction_type</code>，现在类型为XA。</p><ul class=""><li id="17af" class="kj kk hi ij b ik il io ip is kl iw km ja kn je ko kp kq kr bi translated"><code class="du ln lo lp lq b">show variable cached_connection</code></li></ul><blockquote class="mb mc md"><p id="5515" class="ih ii lr ij b ik il im in io ip iq ir me it iu iv mf ix iy iz mg jb jc jd je hb bi translated"><em class="hi">查询有多少物理数据库缓存连接。</em></p></blockquote><p id="9775" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">输入命令</p><pre class="ky kz la lb fd ls lq lt lu aw lv bi"><span id="835d" class="lw jh hi lq b fi lx ly l lz ma">mysql&gt; show variable cached_connections;</span></pre><p id="e56a" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">输出</p><pre class="ky kz la lb fd ls lq lt lu aw lv bi"><span id="feca" class="lw jh hi lq b fi lx ly l lz ma">+--------------------+<br/>| CACHED_CONNECTIONS |<br/>+--------------------+<br/>| 0                  |<br/>+--------------------+</span></pre><ul class=""><li id="4627" class="kj kk hi ij b ik il io ip is kl iw km ja kn je ko kp kq kr bi translated"><code class="du ln lo lp lq b">preview SQL</code></li></ul><blockquote class="mb mc md"><p id="3f53" class="ih ii lr ij b ik il im in io ip iq ir me it iu iv mf ix iy iz mg jb jc jd je hb bi translated"><em class="hi">预览实际的SQL。这里，我们举一个读写拆分场景的例子。ShardingSphere支持预览任何SQL命令。</em></p></blockquote><p id="746f" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">输入命令</p><pre class="ky kz la lb fd ls lq lt lu aw lv bi"><span id="4cd7" class="lw jh hi lq b fi lx ly l lz ma">mysql&gt; preview select * from t_order;</span></pre><p id="d695" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">输出</p><pre class="ky kz la lb fd ls lq lt lu aw lv bi"><span id="2433" class="lw jh hi lq b fi lx ly l lz ma">+-----------------+----------------------------------------------+<br/>| datasource_name | sql                                          |<br/>+-----------------+----------------------------------------------+<br/>| read_ds_0       | select * from t_order ORDER BY order_id ASC  |<br/>| read_ds_1       | select * from t_order ORDER BY order_id ASC  |<br/>+-----------------+----------------------------------------------+</span></pre><p id="6cce" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated"><strong class="ij hj">注意:这是读写拆分场景下的提示示例。我们配置了两个规则:读写拆分和分片。配置如下:</strong></p><pre class="ky kz la lb fd ls lq lt lu aw lv bi"><span id="25f4" class="lw jh hi lq b fi lx ly l lz ma">rules:<br/>- !READWRITE_SPLITTING<br/>dataSources:<br/>ds_0:<br/>  writeDataSourceName: write_ds_0<br/>  readDataSourceNames: <br/>    - read_ds_0<br/>ds_1:<br/>  writeDataSourceName: write_ds_1<br/>  readDataSourceNames: <br/>    - read_ds_1<br/>- !SHARDING<br/>tables:<br/>t_order:<br/>  actualDataNodes: ds_${0..1}.t_order<br/>defaultDatabaseStrategy:<br/>standard:<br/>  shardingColumn: user_id<br/>  shardingAlgorithmName: database_inline<br/>defaultTableStrategy:<br/>none:<br/>shardingAlgorithms:<br/>database_inline:<br/>  type: INLINE<br/>  props:<br/>    algorithm-expression: ds_${user_id % 2}</span></pre><ul class=""><li id="f124" class="kj kk hi ij b ik il io ip is kl iw km ja kn je ko kp kq kr bi translated"><code class="du ln lo lp lq b">show readwrite_splitting hint status</code></li></ul><blockquote class="mb mc md"><p id="ae82" class="ih ii lr ij b ik il im in io ip iq ir me it iu iv mf ix iy iz mg jb jc jd je hb bi translated"><em class="hi">仅用于当前连接。readwrite_splitting的查询提示状态。</em></p></blockquote><p id="5216" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">输入命令</p><pre class="ky kz la lb fd ls lq lt lu aw lv bi"><span id="5c2a" class="lw jh hi lq b fi lx ly l lz ma">mysql&gt; show readwrite_splitting hint status;</span></pre><p id="3676" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">输出</p><pre class="ky kz la lb fd ls lq lt lu aw lv bi"><span id="6538" class="lw jh hi lq b fi lx ly l lz ma">+--------+<br/>| source |<br/>+--------+<br/>| auto   |<br/>+--------+</span></pre><ul class=""><li id="01da" class="kj kk hi ij b ik il io ip is kl iw km ja kn je ko kp kq kr bi translated"><code class="du ln lo lp lq b">set readwrite_splitting hint source</code></li></ul><blockquote class="mb mc md"><p id="7e6d" class="ih ii lr ij b ik il im in io ip iq ir me it iu iv mf ix iy iz mg jb jc jd je hb bi translated"><em class="hi">仅用于当前连接。设置读写拆分提示策略(自动或写入)。支持的源类型包括:AUTO和WRITE(不区分大小写)。—自动:自动读写分割提示—写入:主库的强制提示</em></p></blockquote><p id="eb74" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">输入命令</p><pre class="ky kz la lb fd ls lq lt lu aw lv bi"><span id="f444" class="lw jh hi lq b fi lx ly l lz ma">mysql&gt; set readwrite_splitting hint source=write;</span></pre><p id="b588" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">输出</p><p id="aa04" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">a.如果成功，显示“查询成功，0行受影响”；</p><p id="bae3" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">b.重新执行<code class="du ln lo lp lq b">show readwrite_splitting hint status</code>；显示源转换为写；</p><p id="2d29" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">c.执行<code class="du ln lo lp lq b">preview select * from t_order</code>并查看查询的SQL将转到主数据库。</p><pre class="ky kz la lb fd ls lq lt lu aw lv bi"><span id="dd31" class="lw jh hi lq b fi lx ly l lz ma">mysql&gt; preview select * from t_order;<br/>+-----------------+----------------------------------------------+<br/>| datasource_name | sql                                          |<br/>+-----------------+----------------------------------------------+<br/>| write_ds_0      | select * from t_order ORDER BY order_id ASC  |<br/>| write_ds_1      | select * from t_order ORDER BY order_id ASC  |<br/>+-----------------+----------------------------------------------+</span></pre><ul class=""><li id="adda" class="kj kk hi ij b ik il io ip is kl iw km ja kn je ko kp kq kr bi translated"><code class="du ln lo lp lq b">clear readwrite_splitting hint</code></li></ul><blockquote class="mb mc md"><p id="082f" class="ih ii lr ij b ik il im in io ip iq ir me it iu iv mf ix iy iz mg jb jc jd je hb bi translated"><em class="hi">仅用于当前连接。清除读写拆分提示设置。</em></p></blockquote><p id="3342" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">输入命令</p><pre class="ky kz la lb fd ls lq lt lu aw lv bi"><span id="abdb" class="lw jh hi lq b fi lx ly l lz ma">mysql&gt; clear readwrite_splitting hint;</span></pre><p id="15f1" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">输出</p><p id="8ecb" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">a.如果成功，显示“查询正常，0行受影响”；</p><p id="70a8" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">b.恢复readwrite_splitting提示的默认值；使用<code class="du ln lo lp lq b">show readwrite_splitting hint status</code>命令查看结果。</p><p id="2bb5" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated"><strong class="ij hj">注意:这里有另一个切分示例作为提示。提示算法用于数据库分片和表分片。分片配置规则如下所示:</strong></p><pre class="ky kz la lb fd ls lq lt lu aw lv bi"><span id="8a1c" class="lw jh hi lq b fi lx ly l lz ma">rules:<br/>- !SHARDING<br/>tables:<br/>t_order_item:<br/>  actualDataNodes: ds_${0..1}.t_order_item_${0..1}<br/>  databaseStrategy:<br/>    hint:<br/>      shardingAlgorithmName: database_inline<br/>  tableStrategy:<br/>    hint:<br/>      shardingAlgorithmName: table_inline<br/>shardingAlgorithms:<br/>database_inline:<br/>  type: HINT_INLINE<br/>  props:<br/>    algorithm-expression: ds_${Integer.valueOf(value) % 2}<br/>table_inline:<br/>  type: HINT_INLINE<br/>  props:<br/>    algorithm-expression: t_order_item_${Integer.valueOf(value) % 2}</span></pre><p id="f2aa" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated"><code class="du ln lo lp lq b">show sharding hint status</code></p><blockquote class="mb mc md"><p id="2d54" class="ih ii lr ij b ik il im in io ip iq ir me it iu iv mf ix iy iz mg jb jc jd je hb bi translated"><em class="hi">仅用于当前连接。查询分片提示状态。</em></p></blockquote><p id="7075" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">输入命令</p><pre class="ky kz la lb fd ls lq lt lu aw lv bi"><span id="c1be" class="lw jh hi lq b fi lx ly l lz ma">mysql&gt; show sharding hint status;</span></pre><p id="2d36" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">输出</p><p id="b684" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">初始状态输出为:</p><p id="3d18" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">验证提示并输入命令:</p><pre class="ky kz la lb fd ls lq lt lu aw lv bi"><span id="1ae6" class="lw jh hi lq b fi lx ly l lz ma">preview select * from t_order_item;</span></pre><p id="3d07" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">现在不输出提示值。查询完全依赖于提示。</p><p id="2415" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated"><code class="du ln lo lp lq b">-set sharding hint database_value;</code></p><blockquote class="mb mc md"><p id="130f" class="ih ii lr ij b ik il im in io ip iq ir me it iu iv mf ix iy iz mg jb jc jd je hb bi translated"><em class="hi">仅用于当前连接。将提示设置为仅用于数据库分片，并添加数据库值=1。</em></p></blockquote><p id="b4a4" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">输入命令</p><pre class="ky kz la lb fd ls lq lt lu aw lv bi"><span id="0fb5" class="lw jh hi lq b fi lx ly l lz ma">mysql&gt; set sharding hint database_value = 1;</span></pre><p id="d413" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">输出</p><p id="c141" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">a.如果成功，显示“查询正常，0行受影响”；</p><p id="3584" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">b.执行<code class="du ln lo lp lq b">show sharding hint status</code>；将<code class="du ln lo lp lq b">t_order_item</code>的<code class="du ln lo lp lq b">database_sharding_values</code>显示为1。将<code class="du ln lo lp lq b">sharding_type value</code>更新为<code class="du ln lo lp lq b">databases_only</code>。</p><p id="0607" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">c.执行<code class="du ln lo lp lq b">preview select * from t_order_item</code>；SQL all提示给ds_1:</p><p id="7393" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">* <strong class="ij hj">注:根据YAML配置的分片规则，当数据库<em class="lr">值为奇数时，提示ds</em>1；当数据库<em class="lr">值为偶数时，提示ds </em> 0。</strong></p><p id="119e" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated"><code class="du ln lo lp lq b">-add sharding hint database_value;</code></p><blockquote class="mb mc md"><p id="0da0" class="ih ii lr ij b ik il im in io ip iq ir me it iu iv mf ix iy iz mg jb jc jd je hb bi translated"><em class="hi">仅用于当前连接。添加</em> <code class="du ln lo lp lq b"><em class="hi">t_order_item</em></code> <em class="hi">的数据库分片值。</em></p></blockquote><p id="13af" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">输入命令</p><pre class="ky kz la lb fd ls lq lt lu aw lv bi"><span id="5df4" class="lw jh hi lq b fi lx ly l lz ma">mysql&gt; add sharding hint database_value t_order_item = 5;</span></pre><p id="c4f1" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">输出</p><p id="555b" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">a.如果成功，显示“查询正常，0行受影响”；</p><p id="57fc" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">b.执行<code class="du ln lo lp lq b">show sharding hint status</code>；将<code class="du ln lo lp lq b">t_order_item</code>的<code class="du ln lo lp lq b">database_sharding_values</code>显示为5；将<code class="du ln lo lp lq b">sharding_type value</code>更新为<code class="du ln lo lp lq b">databases_tables</code>；</p><p id="cf18" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">c.执行<code class="du ln lo lp lq b">preview select * from t_order_item</code>；SQL命令都被暗示给ds_1:</p><p id="bfba" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">再次输入add命令添加一个偶数值。</p><pre class="ky kz la lb fd ls lq lt lu aw lv bi"><span id="54a1" class="lw jh hi lq b fi lx ly l lz ma">mysql&gt; add sharding hint database_value t_order_item = 10;</span></pre><p id="0d5f" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">输出:</p><p id="5eb6" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">a.如果成功，显示“查询正常，0行受影响”；</p><p id="1d75" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">b.执行<code class="du ln lo lp lq b">show sharding hint status</code>；显示<code class="du ln lo lp lq b">t_order_item</code>的<code class="du ln lo lp lq b">database_sharding_values</code>=‘5，10’:</p><p id="234f" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">c.执行<code class="du ln lo lp lq b">preview select * from t_order_item</code>；SQL提示包含ds <em class="lr"> 0和ds </em> 1:(因为提示值包含奇数和偶数，所以它包含所有目标数据源)</p><p id="e60a" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated"><code class="du ln lo lp lq b">-add sharding hint table_value;</code></p><blockquote class="mb mc md"><p id="0ddf" class="ih ii lr ij b ik il im in io ip iq ir me it iu iv mf ix iy iz mg jb jc jd je hb bi translated"><em class="hi">仅用于当前连接。为</em> <code class="du ln lo lp lq b"><em class="hi">t_order_item</em></code> <em class="hi">添加数据库分片值。</em></p></blockquote><p id="220f" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">输入命令</p><pre class="ky kz la lb fd ls lq lt lu aw lv bi"><span id="50c7" class="lw jh hi lq b fi lx ly l lz ma">mysql&gt; add sharding hint table_value t_order_item = 0;</span></pre><p id="d73f" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">输出</p><p id="cc05" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">a.如果成功，显示“查询正常，0行受影响”；</p><p id="808a" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">b.执行<code class="du ln lo lp lq b">show sharding hint status</code>；显示<code class="du ln lo lp lq b">t_order_item</code>的<code class="du ln lo lp lq b">database_sharding_values</code>为‘5，10’，而<code class="du ln lo lp lq b">table_sharding_values</code>为‘0’；</p><p id="6ae5" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">c.执行<code class="du ln lo lp lq b">preview select * from t_order_item</code>；提示条件如下图所示；每个数据库只查询<code class="du ln lo lp lq b">t_order_item_0</code>:</p><p id="2c4a" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated"><strong class="ij hj">注:根据YAML配置的分片规则，当</strong> <code class="du ln lo lp lq b"><strong class="ij hj">table_value</strong></code> <strong class="ij hj">为奇数时，提示</strong><code class="du ln lo lp lq b"><strong class="ij hj">t_order_item_1</strong></code><strong class="ij hj">；当</strong> <code class="du ln lo lp lq b"><strong class="ij hj">database_value</strong></code> <strong class="ij hj">是偶数时，提示</strong> <code class="du ln lo lp lq b"><strong class="ij hj">t_order_item_0</strong></code> <strong class="ij hj">。跟</strong> <code class="du ln lo lp lq b"><strong class="ij hj">add sharding hint database_value</strong></code>挺像的<strong class="ij hj">；您可以在</strong> <code class="du ln lo lp lq b"><strong class="ij hj">add sharding hint database_value</strong></code> <strong class="ij hj">中设置多个提示值，以覆盖更多碎片。</strong></p><p id="a406" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated"><code class="du ln lo lp lq b">clear sharding hint</code></p><blockquote class="mb mc md"><p id="6754" class="ih ii lr ij b ik il im in io ip iq ir me it iu iv mf ix iy iz mg jb jc jd je hb bi translated"><em class="hi">仅用于当前连接。清除分片提示设置。</em></p></blockquote><p id="799a" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">输入命令</p><pre class="ky kz la lb fd ls lq lt lu aw lv bi"><span id="993f" class="lw jh hi lq b fi lx ly l lz ma">mysql&gt; clear sharding hint;</span></pre><p id="8301" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">输出</p><p id="7cda" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">a.如果成功，显示“查询正常，0行受影响”；</p><p id="6567" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">b.清除分片提示并恢复默认；使用<code class="du ln lo lp lq b">show sharding hint status</code>；才能看到结果。初始状态是:</p><p id="0a38" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated"><code class="du ln lo lp lq b">clear hint</code></p><blockquote class="mb mc md"><p id="ad8a" class="ih ii lr ij b ik il im in io ip iq ir me it iu iv mf ix iy iz mg jb jc jd je hb bi translated"><em class="hi">是一个特殊的命令，因为它包含了</em> <code class="du ln lo lp lq b"><em class="hi">clear readwrite_splitting hint</em></code> <em class="hi">和</em> <code class="du ln lo lp lq b"><em class="hi">clear sharding hint</em></code> <em class="hi">的特性。它可以清除读写拆分和分片的所有提示值。使用命令，您将获得初始状态。</em></p></blockquote><p id="0c3c" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">设置提示值，然后执行命令；</p><pre class="ky kz la lb fd ls lq lt lu aw lv bi"><span id="e81a" class="lw jh hi lq b fi lx ly l lz ma">mysql&gt; clear hint;</span></pre><p id="ffce" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">输出</p><p id="aa81" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">a.如果成功，显示“查询正常，0行受影响”；</p><p id="b334" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">b.Get readwrite_splitting提示默认值和分片提示默认值；使用<code class="du ln lo lp lq b">show readwrite_splitting hint status ;</code>或<code class="du ln lo lp lq b">show sharding hint status;</code>命令查看结果。</p><p id="9f24" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated"><strong class="ij hj">注意:请记住:如果需要使用DistSQL提示，需要启用ShardingSphere-Proxy的配置</strong> <code class="du ln lo lp lq b"><strong class="ij hj">proxy-hint-enabled</strong></code> <strong class="ij hj">。更多信息请阅读:</strong><a class="ae jf" href="https://shardingsphere.apache.org/document/current/cn/user-manual/shardingsphere-proxy/props/" rel="noopener ugc nofollow" target="_blank">https://sharding sphere . Apache . org/document/current/cn/user-manual/sharding sphere-proxy/props/</a></p><h1 id="f466" class="jg jh hi bd ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd bi translated">还有更有用的RAL命令</h1><p id="773c" class="pw-post-body-paragraph ih ii hi ij b ik ke im in io kf iq ir is kg iu iv iw kh iy iz ja ki jc jd je hb bi translated">RAL不仅包含了所有的SCTL函数，还提供了其他有用的管理特性，包括弹性伸缩、实例断路器、禁用读写拆分的读数据库等。</p><p id="7721" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">关于RAL的更多详情，请查阅相关文档:<a class="ae jf" href="https://shardingsphere.apache.org/document/current/cn/user-manual/shardingsphere-proxy/distsql/syntax/ral/" rel="noopener ugc nofollow" target="_blank">https://sharding sphere . Apache . org/document/current/cn/user-manual/sharding sphere-proxy/dist SQL/syntax/ral/</a></p><h1 id="6f07" class="jg jh hi bd ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd bi translated">结论</h1><p id="286e" class="pw-post-body-paragraph ih ii hi ij b ik ke im in io kf iq ir is kg iu iv iw kh iy iz ja ki jc jd je hb bi translated">这是所有的乡亲。如果您有任何问题或建议，请随时评论我们的GitHub问题或讨论部分。欢迎您提交您的pull请求，并开始为开源社区做贡献。我们还建立了一个Slack频道，您可以在这里与我们社区的其他成员联系，并与我们讨论技术。</p><h1 id="875b" class="jg jh hi bd ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd bi translated">开源项目链接:</h1><p id="c496" class="pw-post-body-paragraph ih ii hi ij b ik ke im in io kf iq ir is kg iu iv iw kh iy iz ja ki jc jd je hb bi translated"><strong class="ij hj"><em class="lr">sharding sphere Github:</em></strong><a class="ae jf" href="https://github.com/apache/shardingsphere" rel="noopener ugc nofollow" target="_blank">https://github.com/apache/shardingsphere</a></p><p id="39a5" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated"><strong class="ij hj"><em class="lr">sharding sphere Twitter:</em></strong><a class="ae jf" href="https://twitter.com/ShardingSphere" rel="noopener ugc nofollow" target="_blank">https://twitter.com/ShardingSphere</a></p><p id="1a33" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated"><strong class="ij hj"> <em class="lr"> ShardingSphere Slack频道:</em></strong><a class="ae jf" href="https://join.slack.com/t/apacheshardingsphere/shared_invite/zt-sbdde7ie-SjDqo9~I4rYcR18bq0SYTg" rel="noopener ugc nofollow" target="_blank">https://join . Slack . com/t/Apache sharding sphere/shared _ invite/ZT-sbd de 7 ie-sjdqo 9 ~ I 4 rycr 18 bq 0 sytg</a></p><p id="7952" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated"><strong class="ij hj">GitHub问题:</strong><a class="ae jf" href="https://github.com/apache/shardingsphere/issues" rel="noopener ugc nofollow" target="_blank">https://github.com/apache/shardingsphere/issues</a></p><p id="bb14" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated"><strong class="ij hj"> <em class="lr">投稿指南:</em></strong><a class="ae jf" href="https://shardingsphere.apache.org/community/cn/contribute/" rel="noopener ugc nofollow" target="_blank">https://shardingsphere.apache.org/community/cn/contribute/</a></p><h1 id="6c70" class="jg jh hi bd ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd bi translated">参考</h1><p id="2d51" class="pw-post-body-paragraph ih ii hi ij b ik ke im in io kf iq ir is kg iu iv iw kh iy iz ja ki jc jd je hb bi translated"><a class="ae jf" href="https://github.com/apache/shardingsphere/pull/1586" rel="noopener ugc nofollow" target="_blank">https://github.com/apache/shardingsphere/pull/1586</a></p><div class="mh mi ez fb mj mk"><a href="https://github.com/apache/shardingsphere/issues/11677" rel="noopener  ugc nofollow" target="_blank"><div class="ml ab dw"><div class="mm ab mn cl cj mo"><h2 class="bd hj fi z dy mp ea eb mq ed ef hh bi translated">重构SCTL问题#11677 apache/shardingsphere</h2><div class="mr l"><h3 class="bd b fi z dy mp ea eb mq ed ef dx translated">在社区中，目前，SCTL语法是由前置关键字“sctl:”来标识的，并且在…</h3></div><div class="ms l"><p class="bd b fp z dy mp ea eb mq ed ef dx translated">github.com</p></div></div><div class="mt l"><div class="mu l mv mw mx mt my lh mk"/></div></div></a></div><h1 id="bc05" class="jg jh hi bd ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd bi translated">作者</h1><p id="2f40" class="pw-post-body-paragraph ih ii hi ij b ik ke im in io kf iq ir is kg iu iv iw kh iy iz ja ki jc jd je hb bi translated">江·</p><blockquote class="mb mc md"><p id="a2b1" class="ih ii lr ij b ik il im in io ip iq ir me it iu iv mf ix iy iz mg jb jc jd je hb bi translated"><em class="hi"> SphereEx中间件开发工程师&amp;Apache sharding sphere Committer。目前，他负责DistSQL和权限控制开发。</em></p></blockquote><figure class="ky kz la lb fd lc er es paragraph-image"><div class="er es mz"><img src="../Images/6c7b0552fb9283d5e5c5bad52b9c6ba5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1098/format:webp/1*ejzVrFYk4RHsfJATooniTw.png"/></div></figure><p id="e951" class="pw-post-body-paragraph ih ii hi ij b ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je hb bi translated">兰程响</p><blockquote class="mb mc md"><p id="5b00" class="ih ii lr ij b ik il im in io ip iq ir me it iu iv mf ix iy iz mg jb jc jd je hb bi translated"><em class="hi">spherex中间件开发工程师&amp; Apache ShardingSphere贡献者。他专注于DisSQL设计和开发。</em></p></blockquote><figure class="ky kz la lb fd lc er es paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="er es na"><img src="../Images/dba43cf932d4ae018b200dc6459c5cb8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RB6Is7M29tE9LPinoXGulg.png"/></div></div></figure></div></div>    
</body>
</html>