<html>
<head>
<title>How to Implement Lazy Minting in your NFT Contract</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在你的NFT合同中实现懒惰铸币</h1>
<blockquote>原文：<a href="https://medium.com/codex/how-to-implement-lazy-minting-in-your-nft-contract-f20082dda21c?source=collection_archive---------1-----------------------#2021-09-04">https://medium.com/codex/how-to-implement-lazy-minting-in-your-nft-contract-f20082dda21c?source=collection_archive---------1-----------------------#2021-09-04</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="b709" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated"><em class="ix">铸造每一件物品。一次一笔交易。而且你不用付油费。</em></h2></div><figure class="iz ja jb jc fd jd er es paragraph-image"><div role="button" tabindex="0" class="je jf di jg bf jh"><div class="er es iy"><img src="../Images/b378106a3ae76f5485c71620661a7342.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V-FQTu8beOol0rp6G7JnJQ.jpeg"/></div></div><figcaption class="jk jl et er es jm jn bd b be z dx translated">照片由<a class="ae jo" href="https://unsplash.com/@drawkit?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">画板上的</a>插图<a class="ae jo" href="https://unsplash.com/s/photos/ethereum?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">和</a>组成</figcaption></figure><p id="aba7" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">偷工减料是一种在NFT合同中越来越常用的技巧。这是一个单一问题的解决方案:以太坊高得离谱的燃气费。</p><p id="d14b" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">简单的解释就是将<code class="du kl km kn ko b">mint</code>功能从<code class="du kl km kn ko b">onlyOwner</code>改为<code class="du kl km kn ko b">payable</code>。如果你想得到额外的报酬。否则，你只需要改变<code class="du kl km kn ko b">mint</code>功能，并记住一些其他细节。</p><figure class="iz ja jb jc fd jd er es paragraph-image"><div class="er es kp"><img src="../Images/bb5bcda067b5decc7ac3484038f65cf6.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/1*d1lvTvtvQNxGdHO8IRmAXw.png"/></div><figcaption class="jk jl et er es jm jn bd b be z dx translated">NFT第四大城市——归我所有</figcaption></figure></div><div class="ab cl kq kr gp ks" role="separator"><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv"/></div><div class="hb hc hd he hf"><h1 id="c5c6" class="kx ky hi bd kz la lb lc ld le lf lg lh io li ip lj ir lk is ll iu lm iv ln lo bi translated">代码</h1><p id="8e5a" class="pw-post-body-paragraph jp jq hi jr b js lp ij ju jv lq im jx jy lr ka kb kc ls ke kf kg lt ki kj kk hb bi translated">在我们的例子中，我们将使用一个简单的OpenZeppelin向导契约。默认情况下，只有所有者可以铸造新令牌。如果您对可用令牌的数量没有限制，这将非常有用。但是由于大多数NFT收藏有一个限制，我们需要检查是否没有达到限制。</p><p id="a9e0" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">一个常规的<code class="du kl km kn ko b">safeMint</code>函数应该是这样的:</p><figure class="iz ja jb jc fd jd"><div class="bz dy l di"><div class="lu lv l"/></div></figure><p id="4e85" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">只有合同的所有者(你)可以调用它。这将花费你汽油费。你还需要知道把它铸造给谁作为<code class="du kl km kn ko b">to</code>参数。你也不能接受为你独特而美丽的代币付款。</p><p id="7f82" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">我们需要更改参数，就像我们将项目铸造给调用者一样，或者在函数本身内部更改<code class="du kl km kn ko b">msg.sender</code>。</p><p id="e618" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">如果我们希望用户能够铸造多个令牌，我们只需要<code class="du kl km kn ko b">uint256 _amount</code>作为参数，否则，我们不需要任何参数。我们还需要创建一个简单的<code class="du kl km kn ko b">for</code>循环来创建在<code class="du kl km kn ko b">_amount</code>参数中选择的令牌数。</p><p id="966b" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">如果我们想接受付款，我们需要使它成为一个<code class="du kl km kn ko b">payable</code>函数，并且我们需要移除<code class="du kl km kn ko b">onlyOwner</code>修饰符，因为我们希望我们的用户铸造他们自己的令牌。</p><p id="d7c2" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">这将给我们一个类似于下面的<code class="du kl km kn ko b">safeMint</code>函数:</p><figure class="iz ja jb jc fd jd"><div class="bz dy l di"><div class="lu lv l"/></div></figure></div><div class="ab cl kq kr gp ks" role="separator"><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv"/></div><div class="hb hc hd he hf"><h1 id="0e75" class="kx ky hi bd kz la lb lc ld le lf lg lh io li ip lj ir lk is ll iu lm iv ln lo bi translated">陷阱</h1><p id="9f8a" class="pw-post-body-paragraph jp jq hi jr b js lp ij ju jv lq im jx jy lr ka kb kc ls ke kf kg lt ki kj kk hb bi translated">到目前为止，<code class="du kl km kn ko b">safeMint</code>函数看起来不错，但是它有一些缺陷，我们真的需要修复。我将解释为什么以及如何做到这一点。</p><p id="9fa1" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">如果用户愿意，他或她可以在一次交易中铸造<em class="lw">所有</em>可用的代币。特别是在Polygon这样的网络上，这可能是一个问题，因为汽油费不是很高，用户不会这样做。为此，我们需要添加一个<code class="du kl km kn ko b">require</code>语句，该语句只让用户在单次交易中赚取一定的金额。</p><figure class="iz ja jb jc fd jd"><div class="bz dy l di"><div class="lu lv l"/></div></figure><p id="9817" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">另一个陷阱，也可以说是更重要的一个，我们没有定价。这将需要一段与上面类似的代码。我们需要核对<code class="du kl km kn ko b">msg.value</code>和我们的价格。</p><figure class="iz ja jb jc fd jd"><div class="bz dy l di"><div class="lu lv l"/></div></figure><p id="2433" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">它现在看起来越来越好，但我们可能有另一个问题。大多数NFT收藏或dApps对可以有多少代币有限制。该声明将类似于每次销售的代币数量，但我们需要用总供应量来检查它。</p><figure class="iz ja jb jc fd jd"><div class="bz dy l di"><div class="lu lv l"/></div></figure><p id="67f2" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">我们现在已经解决了最常见的问题，并且如果实施得当，消除了它们的影响。整个<code class="du kl km kn ko b">safeMint</code>函数现在看起来像这样(我还实现了一个变量来切换销售):</p><figure class="iz ja jb jc fd jd"><div class="bz dy l di"><div class="lu lv l"/></div></figure></div><div class="ab cl kq kr gp ks" role="separator"><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv"/></div><div class="hb hc hd he hf"><h1 id="b3a6" class="kx ky hi bd kz la lb lc ld le lf lg lh io li ip lj ir lk is ll iu lm iv ln lo bi translated">结论</h1><p id="ae87" class="pw-post-body-paragraph jp jq hi jr b js lp ij ju jv lq im jx jy lr ka kb kc ls ke kf kg lt ki kj kk hb bi translated">智能合约是使用区块链的一种很好的方式，但由于费用很高，我们希望在某些情况下将它放在我们的用户身上。多边形等链使其成为次要问题。</p><p id="2589" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">我们还需要在安全性方面下功夫，努力保护我们的dApp免受用户可能尝试的任何恶意攻击，例如铸造所有可用的令牌。</p><p id="5132" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">非常感谢您的阅读，祝您度过美好的一天。</p><p id="1e94" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated"><em class="lw">在</em><a class="ae jo" href="https://twitter.com/MVissers4" rel="noopener ugc nofollow" target="_blank"><em class="lw">Twitter</em></a><em class="lw">上查看我的第一张</em> <a class="ae jo" href="https://www.cryptoconcoctions.com/" rel="noopener ugc nofollow" target="_blank"> <em class="lw"> NFT作品集</em> </a> <em class="lw">在多边形网上查看。</em></p></div></div>    
</body>
</html>