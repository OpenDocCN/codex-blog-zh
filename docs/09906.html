<html>
<head>
<title>Code Readability &gt; Efficiency: Here’s Why</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">代码可读性&gt;效率:原因如下</h1>
<blockquote>原文：<a href="https://medium.com/codex/code-readability-efficiency-heres-why-725f017cfee9?source=collection_archive---------12-----------------------#2022-11-18">https://medium.com/codex/code-readability-efficiency-heres-why-725f017cfee9?source=collection_archive---------12-----------------------#2022-11-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="3e8a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">【2023年2月2日更新</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/65992a025a8d35a00095bf9c6edfe1a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*kANqwARbT-vXrpBw"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">这到底是干什么的？(作者<a class="ae ju" href="https://unsplash.com/@alpridephoto?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">андрейсизов</a></figcaption></figure><p id="1019" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">开发人员培训教会我们如何编写高效的代码。我们学习如何最小化UI重绘，如何避免内存中的重复结构，以及为什么使用快速排序比冒泡排序更好。</p><p id="fd14" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，一个好的开发人员会写出高效的代码。但是如果你想要代码经得起时间的考验，那么它也必须是<em class="jd">可读的</em>。根据我的经验，为了可读性，牺牲一些效率更好。</p><h1 id="eb6d" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">像书一样可读</h1><p id="33a8" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">这里有一个例子。代码是打字稿，但我要说的话当然对任何语言都成立。假设我们有一个人员列表，我们希望找到:</p><ul class=""><li id="3dfc" class="ky kz hi ih b ii ij im in iq la iu lb iy lc jc ld le lf lg bi translated">谁未成年</li><li id="5c67" class="ky kz hi ih b ii lh im li iq lj iu lk iy ll jc ld le lf lg bi translated">谁的名字以T开头</li></ul><p id="9774" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是我们的起点。一些数据:</p><pre class="jf jg jh ji fd lm ln lo bn lp lq bi"><span id="d5ec" class="lr jw hi ln b be ls lt l lu lv">interface Person {<br/>  name: string;<br/>  age: number;<br/>}<br/><br/>const people: Person[] = [<br/>  { name: "Tom", age: 22 },<br/>  { name: "Dick", age: 33 },<br/>  { name: "Harry", age: 44 },<br/>  ...<br/>];</span></pre><p id="59c5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里有一个可读的方法来找到未成年人，以及名字以T开头的人:</p><pre class="jf jg jh ji fd lm ln lo bn lp lq bi"><span id="cea8" class="lr jw hi ln b be ls lt l lu lv">const underage = people.filter(<br/>    (person) =&gt; person.age &lt; 18<br/>);<br/><br/>const namesBeginningWithT = people.filter(<br/>    (person) =&gt; person.name.startsWith("T")<br/>);</span></pre><p id="a402" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为什么这个<em class="jd">是可读的</em>？因为它与我们的自然语言不谋而合。从左到右阅读，你会明白未成年人变量设置为“筛选出的查找年龄小于18岁的人的列表”。它读起来几乎和评论一样清晰。</p><p id="601b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">没有必要遵循任何代码循环。不需要向后或向前跳。甚至不需要完全熟悉“过滤器”功能——如果你只是略读代码，你已经有足够的知识来理解它的功能。</p><p id="4613" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是，效率不高。为什么？因为它在人员列表中循环两次——一次是查找未成年用户，另一次是查找“T”名。</p><p id="5a25" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以下是相同代码的更高效版本:</p><pre class="jf jg jh ji fd lm ln lo bn lp lq bi"><span id="95da" class="lr jw hi ln b be ls lt l lu lv">const underAge = new Array&lt;Person&gt;();<br/>const namesBeginningWithT = new Array&lt;Person&gt;();<br/><br/>for (const person of people) {<br/>    if (person.age &lt; 18) {<br/>        underAge.push(person);<br/>    }<br/>    else if (person.name.startsWith("T")) {<br/>        namesBeginningWithT.push(person);<br/>    }<br/>}</span></pre><p id="5f05" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请注意，我们现在只遍历列表一次。</p><p id="6aea" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是，可读性如何呢？不是很大，肯定没有上面那么大。你必须阅读并理解“for”条件，并弄清楚循环中的代码是做什么的。只有这样，您才能跳回到变量定义，并弄清楚它们将包含什么数据。</p><p id="7620" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它不能像书一样从左到右，从上到下阅读。也许你将不得不多次阅读一些位，以了解它们是如何全部到位的。</p><h1 id="6a29" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">可读性=样板文件更少=错误更少</h1><p id="1a89" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">上面可读的代码实际上只有2行。没有样板文件——样板文件越少，出错的可能性就越小。</p><p id="df23" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">比如<strong class="ih hj">注意到上面</strong>高效代码的bug了吗？也许你这样做了——但是如果这段代码隐藏在你正在阅读的10，000行代码中，我就不会指望你这样做了。</p><p id="5161" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">错误在样板文件中。这一行:</p><pre class="jf jg jh ji fd lm ln lo bn lp lq bi"><span id="bfda" class="lr jw hi ln b be ls lt l lu lv">else if (person.name.startsWith("T")) {</span></pre><p id="8026" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">…应该是:</p><pre class="jf jg jh ji fd lm ln lo bn lp lq bi"><span id="753d" class="lr jw hi ln b be ls lt l lu lv">if (person.name.startsWith("T")) {</span></pre><p id="3da6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有了这个小错误(错误的<strong class="ih hj"> else </strong>),如果‘T’人也是未成年人，代码就不会正确识别他们。</p><p id="fcb1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里可读的代码更紧凑，所以它有更少的活动部分。bug会更明显。</p><p id="5812" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">可读代码更紧凑并不总是正确的。有时候，一个可读性最好的代码实际上有更多的行。但是，如果把它写在更多的行上是为了使它更易读，那么它包含的任何错误仍然会更明显。</p><h1 id="01c6" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">可读=更安全</h1><p id="d38a" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">类似上述的细微错误导致了许多安全问题。</p><p id="73da" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">开发安全性代码的一个重要部分是审计过程，在这个过程中，审计员/评审员会检查您的代码。你的代码能更好地传达它所做的事情，审计员就会更有效率。他们将能够更好地挑出错误，因为它们会从对代码的自然语言阅读中弹出。</p><p id="f3d6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当然，对于您自己的代码审计来说也是如此。写得越直截了当，你就越有机会发现自己的安全缺陷——或者最好不要把它们放在第一位。</p><h1 id="1132" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">可读性=维护成本更低</h1><p id="3433" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">回到我们上面的代码示例。假设一个新开发人员的任务是改变“未成年”的定义:我们现在需要挑选21岁以下的人，而不是18岁。</p><p id="18a8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于我们代码的可读版本来说，这是一件极其简单的事情。任何初级开发人员都能够看到“(person) =&gt; person.age &lt; 18”这一条件，并理解需要如何对其进行更改。这个条件是完全独立的——它周围没有代码，只有最少的样板文件——所以不用担心这样的改变会扰乱其他代码。并且只需要很少的测试或审核就可以确认变更是否成功。</p><p id="5289" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们代码的有效版本也有同样的情况，但是它也出现在处理其他事情的代码中。具体来说，这是一个处理未成年人和“T”人的循环——但在现实世界中可能会有更多。一个好的开发人员会想回顾循环的其余部分，以真正理解发生了什么，然后才能自信地做出改变。</p><p id="068c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">显然，在这里，具体的差异是最小的，但是随着项目的扩展，这些分钟变成了数周、数月甚至数年的额外工作，伴随着巨大的相关成本。</p><p id="d7ef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，可读代码在现在和将来都可以节省时间和金钱。</p><h1 id="da49" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">当效率高于可读性时</h1><p id="3ffb" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">可读性并不是在任何情况下都胜过效率。如果你正在为一个游戏编写一个物理引擎，那么你需要从你的代码中挤出每一个可能的效率下降，否则要维持一个高的FPS。如果你是一个处理千兆字节数据的后端开发人员，那么你如何对它进行排序就真的很重要。</p><p id="6aff" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们在上面已经假设‘people’数组的长度是合理的。如果它真的有可能包含1000万个项目，那么一切都会改变。每项操作都很重要，效率至关重要。为了可读性，在100个项目中循环两次是可以的，但不是1000万个。</p><p id="3fe9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">那么，如果效率是关键，你能做些什么来保持可读性呢？</p><p id="eda8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">写评论！注释正是为此目的而存在的。不要听信那些说自己从来不用的人:评论非常非常重要。如果你的代码不能像书一样被阅读，那么添加(并维护)一两个注释来帮助你。</p><p id="6f1a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是我们的高效循环(这次修复了错误)，并附有注释:</p><pre class="jf jg jh ji fd lm ln lo bn lp lq bi"><span id="8228" class="lr jw hi ln b be ls lt l lu lv">const underAge = new Array&lt;Person&gt;();<br/>const namesBeginningWithT = new Array&lt;Person&gt;();<br/><br/>//Loop through people to extract underage and those whose name begin with T<br/><br/>for (const person of people) {<br/>    if (person.age &lt; 18) {<br/>        underAge.push(person);<br/>    }<br/>    if (person.name.startsWith("T")) {<br/>        namesBeginningWithT.push(person);<br/>    }<br/>}</span></pre><p id="69df" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">那一条评论是神奇的。我们(稍微)不可读的代码现在又可以像书一样被阅读了。对于略读的读者来说，不用遵循循环就能清楚地知道它在做什么。对于代码审核员来说，很清楚你的<em class="jd">意味着</em>让循环去做什么——这样他们就可以检查它，看看它是否真的是这样。</p><p id="45d1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果一个评论者在没有评论的情况下发现了上面的“else”错误，那么它是否真的是一个错误或者代码是否应该对未成年的“T”人产生影响就不会立即清楚了。一个评论完全澄清了这一点。</p><p id="6194" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注释的唯一问题是它们必须像代码一样被维护。如果有一天你想改变未成年人的行为，那么评论也需要相应改变。这不应该太麻烦——开发人员应该养成对他们维护的代码进行评论的习惯，并在必要时进行更新。</p><p id="9e1a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以，总而言之:好的开发人员写出高效的代码，但是<strong class="ih hj">伟大的</strong>开发人员知道什么时候为了可读性而牺牲效率。</p><p id="a285" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">可读代码不容易出现错误和安全缺陷，审计和维护成本更低。</p><p id="c136" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd"> Tom Colvin是</em><a class="ae ju" href="http://www.consealsecurity.com/" rel="noopener ugc nofollow" target="_blank"><em class="jd">Conseal Security</em></a><em class="jd">的CTO，手机app安全测试专家；以及</em><a class="ae ju" href="http://www.apptaura.com/" rel="noopener ugc nofollow" target="_blank"><em class="jd">app taura</em></a><em class="jd">，app开发专员。</em> <a class="ae ju" href="http://www.linkedin.com/in/tdcolvin" rel="noopener ugc nofollow" target="_blank"> <em class="jd">联系</em> </a> <em class="jd">如果我能为任何移动安全或开发项目提供帮助！</em></p></div></div>    
</body>
</html>