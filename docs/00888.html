<html>
<head>
<title>Create android dependency package for your library</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为你的库创建android依赖包</h1>
<blockquote>原文：<a href="https://medium.com/codex/create-android-dependency-package-for-your-library-d6bf92fc220f?source=collection_archive---------10-----------------------#2021-03-23">https://medium.com/codex/create-android-dependency-package-for-your-library-d6bf92fc220f?source=collection_archive---------10-----------------------#2021-03-23</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="9a1c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有一次我接到一个任务，要把我们的android库项目转换成一个包，当我试图完成这个任务时，我遇到了这么多困难。为什么它成为我的痛苦，因为当我在谷歌或Stackoverflow上搜索我的问题时，没有人提供符合标准的答案，或者我可能没有从他们的答案或可用的文档中正确理解它。所以我决定提供所有可能的信息来为gradle创建一个依赖包，以及我所面临的问题和解决方案。</p><p id="386a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">让我们开始</strong></p><p id="5339" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建依赖包实际上是一个几步的过程。</p><p id="3a5a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第一步。创建一个库项目</strong></p><p id="876a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要创建一个库项目，你需要在应用程序的gradle文件顶部添加apply <strong class="ih hj">插件</strong>:<strong class="ih hj">' com . Android . library '</strong>。an和a库的gradle文件的基本区别在于，在android应用程序中，gradle的第一行将分别应用<strong class="ih hj">插件</strong>:<strong class="ih hj">' com . Android . application '</strong>，而在库中，则分别应用<strong class="ih hj">插件</strong>:<strong class="ih hj">' com . Android . library '</strong>。</p><p id="d487" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第二步。创建包含Github PAT和用户名的github.properties文件:</strong></p><p id="9f86" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这也是一个简单的步骤，只需在你的项目根目录下创建一个github.properties，即你的库项目/github.properties</p><p id="6320" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这个文件中，只需保存您的Github用户名和PAT(个人访问令牌),这是Github包注册(GPR)所必需的。也要确保你把它分两行粘贴，如下所述。</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="10c9" class="jm jn hi ji b fi jo jp l jq jr">gpr.usr=manishsharmaec<br/>gpr.key=9d90e3d5a34b566a7b2b77603XXXXXXXXXX</span></pre><blockquote class="js jt ju"><p id="e215" class="if ig jv ih b ii ij ik il im in io ip jw ir is it jx iv iw ix jy iz ja jb jc hb bi translated">我犯了一个大错，把它们粘贴在一行中，得到了授权错误401，但没有地方提到它应该在两行中提到。</p></blockquote><p id="466c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">点击右上角的个人资料图标&gt; &gt;设置&gt; &gt;转到开发者设置&gt;个人访问令牌&gt;生成新令牌</strong></p><p id="ea1a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤三。创建一个publish.gradle: </strong></p><p id="9438" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个gradle文件告诉你的库源代码创建一个包，通过Github验证它并生成相关细节的构建文件，这些文件最终将被集成这个库的应用程序使用。比如包名和版本，要包含和排除什么样的库。</p><p id="2588" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">出版</strong></p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="d2a0" class="jm jn hi ji b fi jo jp l jq jr">apply <strong class="ji hj">plugin</strong>: <strong class="ji hj">'maven-publish'<br/><br/><br/>def </strong>githubProperties = <strong class="ji hj">new </strong>Properties()<br/>githubProperties.load(<strong class="ji hj">new </strong>FileInputStream(rootProject.file(<strong class="ji hj">"github.properties"</strong>))) <em class="jv"><br/><br/></em><strong class="ji hj">def </strong>getArtificatId = { -&gt;<br/>    <strong class="ji hj">return "somename"<br/></strong>}<br/><br/><strong class="ji hj">def </strong>getGroupId = { -&gt;<br/>    <strong class="ji hj">return "com.mylib"<br/></strong>}<br/><br/><strong class="ji hj">def </strong>getVersionName = { -&gt;<br/>    <strong class="ji hj">return "1.0.0"<br/></strong>}<br/><br/>task sourceJar(<strong class="ji hj">type</strong>: Jar) {<br/>    from android.sourceSets.main.java.srcDirs<br/>    classifier <strong class="ji hj">"sources"<br/></strong>}<br/><br/>afterEvaluate {<br/>    publishing {<br/>        repositories {<br/>            maven {<br/>                name = <strong class="ji hj">"GithubPackages"<br/>                </strong><em class="jv">/** Configure path of your package repository on Github<br/>                 ** Replace GITHUB_USERID with your/organisation Github userID<br/>                 ** and REPOSITORY with the repository name on GitHub<br/>                 */<br/>                </em>url = uri(<strong class="ji hj">"https://maven.pkg.github.com/manishsharmaec/dependencypackage"</strong>)<br/>                credentials {<br/>                    <em class="jv">/** Create github.properties in root project folder file with<br/>                     ** gpr.usr=GITHUB_USER_ID &amp; gpr.key=PERSONAL_ACCESS_TOKEN<br/>                     ** Set env variable GPR_USER &amp; GPR_API_KEY if not adding a properties file**/<br/><br/>                    </em>username = githubProperties[<strong class="ji hj">'gpr.usr'</strong>] ?: System.<em class="jv">getenv</em>(<strong class="ji hj">"GPR_USER"</strong>)<br/>                    password = githubProperties[<strong class="ji hj">'gpr.key'</strong>] ?: System.<em class="jv">getenv</em>(<strong class="ji hj">"GPR_API_KEY"</strong>)<br/>                }<br/>            }<br/><br/>            maven {<br/>                name = <strong class="ji hj">'CustomMavenRepo'<br/>                </strong>url = <strong class="ji hj">"file://</strong>${buildDir}<strong class="ji hj">/repo"<br/>            </strong>}<br/>        }<br/>        publications {<br/>            release(MavenPublication) {<br/><em class="jv">//                from components.release<br/>                </em>groupId getGroupId()<br/>                artifactId getArtificatId()<br/>                version getVersionName()<br/>                artifact(<strong class="ji hj">"</strong>$buildDir<strong class="ji hj">/outputs/aar/</strong>${getArtificatId()}<strong class="ji hj">-release.aar"</strong>)<br/>                artifact(sourceJar)<br/><br/><br/>                pom.withXml {<br/>                    <strong class="ji hj">def </strong>dependenciesNode = asNode().appendNode(<strong class="ji hj">'dependencies'</strong>)<br/><br/>                    <em class="jv">//Iterate over the compile dependencies (we don't want the test ones), adding a &lt;dependency&gt; node for each<br/>                    </em>configurations.<strong class="ji hj">api</strong>.allDependencies.each {<br/>                        <strong class="ji hj">def </strong>dependencyNode =<br/>                                dependenciesNode.appendNode(<strong class="ji hj">'dependency'</strong>)<br/>                                dependencyNode.appendNode(<strong class="ji hj">'groupId'</strong>, it.group)<br/>                                dependencyNode.appendNode(<strong class="ji hj">'artifactId'</strong>, it.name)<br/>                                dependencyNode.appendNode(<strong class="ji hj">'version'</strong>, it.version)<br/>                    }<br/>                }<br/>            }<br/><br/>        }<br/><br/>    }<br/>}</span></pre><p id="6ef6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦创建了publish.gradle，就在应用程序的build.gradle文件中调用它，方法是添加一行apply<strong class="ih hj">from</strong>:file(<strong class="ih hj">' publish . gradle '</strong>)under apply<strong class="ih hj">plugin</strong>:<strong class="ih hj">' com . Android . library '</strong>，如下所述:</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="2431" class="jm jn hi ji b fi jo jp l jq jr">apply <strong class="ji hj">plugin</strong>: <strong class="ji hj">'com.android.library'<br/></strong>apply <strong class="ji hj">from</strong>: file(<strong class="ji hj">'publish.gradle'</strong>)</span></pre><p id="a479" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤四。。/gralew clean build publish发布一个包</strong></p><p id="9914" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您几乎可以在github上创建一个与您的gihub资源库相链接的包了。你所要做的就是使用。/gradlew命令的顺序与下面提到的顺序相同:</p><p id="2a02" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">。/gradlew clean </strong></p><p id="2b72" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">成功清除命令后，请等待操作完成</p><p id="c8bc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">。/gradlew build </strong></p><p id="63c2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这将构建您的项目，并将在app/build文件夹中生成库可执行文件。它还会在app/build/ path中生成/repo文件夹。这个repo文件夹包含使用pom.xml文件或可执行文件等包所需的所有必要文件。罐子还是。aar文件。</p><p id="3684" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，生成包的最后一步是</p><p id="5355" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">。/gradlew publish </strong></p><h2 id="0f7e" class="jm jn hi bd jz ka kb kc kd ke kf kg kh iq ki kj kk iu kl km kn iy ko kp kq kr bi translated">发布命令后，你将能够在github上成功地生成一个包，但是你不能在任何android项目中使用它，因为JVM或Android项目无法读取它。为了让JVM和Android项目可读，我们需要把它上传到jitpack、packr、nexus、central repository等地方。我们将使用jitpack.io，因为它快速且易于使用。</h2><p id="9b67" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated"><strong class="ih hj">第五步。为您的分支创建一个发布并上传到</strong> <a class="ae kx" href="https://jitpack.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> jitpack.io </strong> </a></p><p id="7a6c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过给这个释放赋予一个标记名来释放您的分支。我已经给了这个项目的标签1.0.0。当你发布了一个在github上生成包的分支后，只需提供githubusername/reponame并点击lookup。它将获取所有的版本，并运行任务来创建可执行文件，如。aar或. jar。</p><figure class="jd je jf jg fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es ky"><img src="../Images/7b09b768734f37ceba9776c5adb1cfe7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BhT9eKrHGKbR4mKvOwGwbQ.png"/></div></div></figure><p id="5e43" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第六步。怎么用？</p><p id="63bd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你的包可以在任何android项目中使用，你只需要在目标应用程序中做两个改变(应用程序将消耗你的库，请参考附上的截图。</p><figure class="jd je jf jg fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es lg"><img src="../Images/1a0930ab88a1135f1105c4e0cf61a481.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MtGOep4RGkc8obg806KKTg.png"/></div></div></figure><p id="b35a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> Hurray </strong>，你刚刚发布了一个android libray，可以通过调用实现<strong class="ih hj">' com . github . username:reponame:tagname '</strong>在app gradle文件中添加依赖项来导入</p><p id="c1bd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">源代码可在</strong> <a class="ae kx" href="https://github.com/manishsharmaec/LibraryKiddo" rel="noopener ugc nofollow" target="_blank"> Github </a>上获得</p></div></div>    
</body>
</html>